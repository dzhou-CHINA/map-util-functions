!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).mapmost=e()}(this,(function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var sipsdmapGl=createCommonjsModule((function(t,e){t.exports=function(){var t,e,r;function n(n,i){if(t)if(e){var a="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",o={};t(o),r=i(o),"undefined"!=typeof window&&(r.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else e=i;else t=i}return n(0,(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,a,o;for(void 0===e&&(e=1e-6),i=t,o=0;o<8;o++){if(a=this.sampleCurveX(i)-t,Math.abs(a)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(a=this.sampleCurveX(i),Math.abs(a-t)<e)return i;t>a?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var o="undefined"!=typeof self?self:{},s=Math.pow(2,53)-1,u=Math.PI/180,l=180/Math.PI;function c(t){return t*u}function h(t,e,n,i){var a=new r(t,e,n,i);return function(t){return a.solve(t)}}var f=h(.25,.1,.25,1);function d(t,e,r){return Math.min(r,Math.max(e,t))}function p(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function m(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var a=i[n];for(var o in a)t[o]=a[o]}return t}var v=1;function g(){return v++}function y(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function _(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function b(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function x(t,e){return-1!==t.indexOf(e,t.length-e.length)}function w(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function M(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function A(t){return Array.isArray(t)?t.map(A):"object"==typeof t&&t?w(t,A):t}var E={};function S(t){E[t]||("undefined"!=typeof console&&console.warn(t),E[t]=!0)}function T(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function C(t){for(var e=0,r=0,n=t.length,i=n-1,a=void 0,o=void 0;r<n;i=r++)e+=((o=t[i]).x-(a=t[r]).x)*(a.y+o.y);return e}function O(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function P(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,r,n,i){var a=n||i;return e[r]=!a||a.toLowerCase(),""})),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}var L=null;function I(t){if(null==L){var e=t.navigator?t.navigator.userAgent:null;L=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return L}function k(t){try{var e=o[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var R,D,B,F,j=o.performance&&o.performance.now?o.performance.now.bind(o.performance):Date.now.bind(Date),N=o.requestAnimationFrame||o.mozRequestAnimationFrame||o.webkitRequestAnimationFrame||o.msRequestAnimationFrame,U=o.cancelAnimationFrame||o.mozCancelAnimationFrame||o.webkitCancelAnimationFrame||o.msCancelAnimationFrame,z={now:j,frame:function(t){var e=N(t);return{cancel:function(){return U(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=o.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return R||(R=o.document.createElement("a")),R.href=t,R.href},hardwareConcurrency:o.navigator&&o.navigator.hardwareConcurrency||4,get devicePixelRatio(){return o.devicePixelRatio},get prefersReducedMotion(){return!!o.matchMedia&&(null==D&&(D=o.matchMedia("(prefers-reduced-motion: reduce)")),D.matches)}},G={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(t){!H&&F&&(W?$(t):B=t)}},H=!1,W=!1;function $(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,F),t.isContextLost())return;V.supported=!0}catch(t){}t.deleteTexture(e),H=!0}o.document&&((F=o.document.createElement("img")).onload=function(){B&&$(B),B=null,W=!0},F.onerror=function(){H=!0,B=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var q="01",X=Symbol("x"),K=function(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken(),this[X]=r};function Z(t){return 0===t.indexOf("mapbox:")}K.prototype._x=function(){return JSON.stringify(this[X])},K.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",q,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},K.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},K.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},K.prototype.normalizeStyleURL=function(t,e){if(!Z(t))return t;var r=et(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},K.prototype.normalizeGlyphsURL=function(t,e){if(!Z(t))return t;var r=et(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},K.prototype.normalizeSourceURL=function(t,e){if(!Z(t))return t;var r=et(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},K.prototype.normalizeSpriteURL=function(t,e,r,n){var i=et(t);return Z(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+e+r,rt(i))},K.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Z(t))return t;var r=et(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(z.devicePixelRatio>=2||512===e?"@2x":"")+(V.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var n=this._customAccessToken||function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e].match(/^access_token=(.*)$/);if(n)return n[1]}return null}(r.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&n&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,n)},K.prototype.canonicalizeTileURL=function(t,e){var r=et(t);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return t;var n="mapbox://tiles/";n+=r.path.replace("/v4/","");var i=r.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(n+="?"+i.join("&")),n},K.prototype.canonicalizeTileset=function(t,e){for(var r=!!e&&Z(e),n=[],i=0,a=t.tiles||[];i<a.length;i+=1){var o=a[i];J(o)?n.push(this.canonicalizeTileURL(o,r)):n.push(o)}return n},K.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=et(G.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==n.path&&(t.path=""+n.path+t.path),!G.REQUIRE_ACCESS_TOKEN)return rt(t);if(!(e=e||G.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),rt(t)};var Y=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function J(t){return Y.test(t)}function Q(t){return t.indexOf("sku=")>0&&J(t)}var tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function et(t){var e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function rt(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function nt(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(o.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var it=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};it.prototype.getStorageKey=function(t){var e,r=nt(G.ACCESS_TOKEN);return e=r&&r.u?o.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):G.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},it.prototype.fetchEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=o.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=o.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){S("Unable to read from LocalStorage")}},it.prototype.saveEventData=function(){var t=k("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{o.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&o.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},it.prototype.processRequests=function(t){},it.prototype.postEvent=function(t,e,r,n){var i=this;if(G.EVENTS_URL){var a=et(G.EVENTS_URL);a.params.push("access_token="+(n||G.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.4.1",skuId:q,userId:this.anonId},s=e?m(o,e):o,u={url:rt(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=cn(u,(function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests(n)}))}},it.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var at,ot,st=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r,n){this.skuToken=r,(G.EVENTS_URL&&n||G.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return Z(t)||J(t)})))&&this.queueRequest({id:e,timestamp:Date.now()},n)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),_(this.anonId)||(this.anonId=y()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||n&&(e.success[n]=!0)}),t))}},e}(it),ut=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return Z(t)||J(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=nt(G.ACCESS_TOKEN),n=r?r.u:G.ACCESS_TOKEN,i=n!==this.eventData.tokenU;_(this.anonId)||(this.anonId=y(),i=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),u=(a-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||o.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=a,e.eventData.tokenU=n)}),t)}},e}(it)),lt=ut.postTurnstileEvent.bind(ut),ct=new st,ht=ct.postMapLoadEvent.bind(ct),ft=500,dt=50;function pt(){o.caches&&!at&&(at=o.caches.open("mapbox-tiles"))}function mt(t,e,r){if(pt(),at){var n={status:e.status,statusText:e.statusText,headers:new o.Headers};e.headers.forEach((function(t,e){return n.headers.set(e,t)}));var i=P(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-r<42e4||function(t,e){if(void 0===ot)try{new Response(new ReadableStream),ot=!0}catch(t){ot=!1}ot?e(t.body):t.blob().then(e)}(e,(function(e){var r=new o.Response(e,n);pt(),at&&at.then((function(e){return e.put(vt(t.url),r)})).catch((function(t){return S(t.message)}))})))}}function vt(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}function gt(t,e){if(pt(),!at)return e(null);var r=vt(t.url);at.then((function(t){t.match(r).then((function(n){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),r=P(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(n);t.delete(r),i&&t.put(r,n.clone()),e(null,n,i)})).catch(e)})).catch(e)}var yt,_t=1/0;function bt(){return null==yt&&(yt=o.OffscreenCanvas&&new o.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof o.createImageBitmap),yt}var xt=e((function(t,e){var r;t.exports=r=r||function(t,e){var r=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),n={},i=n.lib={},a=i.Base={extend:function(t){var e=r(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a++)e[n+a>>>2]|=(r[a>>>2]>>>24-a%4*8&255)<<24-(n+a)%4*8;else for(a=0;a<i;a+=4)e[n+a>>>2]=r[a>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var r,n=[],i=function(e){var r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return i/=4294967296,(i+=.5)*(t.random()>.5?1:-1)}},a=0;a<e;a+=4){var s=i(4294967296*(r||t.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new o.init(n,e)}}),s=n.enc={},u=s.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++){var a=e[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new o.init(r,e/2)}},l=s.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i++)n.push(String.fromCharCode(e[i>>>2]>>>24-i%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new o.init(r,e)}},c=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},h=i.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r=this._data,n=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),u=(s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0))*a,l=t.min(4*u,i);if(u){for(var c=0;c<u;c+=a)this._doProcessBlock(n,c);var h=n.splice(0,u);r.sigBytes-=l}return new o.init(h,l)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),f=(i.Hasher=h.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new f.HMAC.init(t,r).finalize(e)}}}),n.algo={});return n}(Math)})),wt=(e((function(t,e){var r,n,i,a,o;t.exports=(n=(r=(o=xt).lib).Base,i=r.WordArray,(a=o.x64={}).Word=n.extend({init:function(t,e){this.high=t,this.low=e}}),a.WordArray=n.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=null!=e?e:8*t.length},toX32:function(){for(var t=this.words,e=t.length,r=[],n=0;n<e;n++){var a=t[n];r.push(a.high),r.push(a.low)}return i.create(r,this.sigBytes)},clone:function(){for(var t=n.clone.call(this),e=t.words=this.words.slice(0),r=e.length,i=0;i<r;i++)e[i]=e[i].clone();return t}}),o)})),e((function(t,e){var r;t.exports=(r=xt,function(){if("function"==typeof ArrayBuffer){var t=r.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var r=t.byteLength,n=[],i=0;i<r;i++)n[i>>>2]|=t[i]<<24-i%4*8;e.call(this,n,r)}else e.apply(this,arguments)}).prototype=t}}(),r.lib.WordArray)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r.lib.WordArray,e=r.enc;function n(t){return t<<8&4278255360|t>>>8&16711935}e.Utf16=e.Utf16BE={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],i=0;i<r;i+=2)n.push(String.fromCharCode(e[i>>>2]>>>16-i%4*8&65535));return n.join("")},parse:function(e){for(var r=e.length,n=[],i=0;i<r;i++)n[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(n,2*r)}},e.Utf16LE={stringify:function(t){for(var e=t.words,r=t.sigBytes,i=[],a=0;a<r;a+=2){var o=n(e[a>>>2]>>>16-a%4*8&65535);i.push(String.fromCharCode(o))}return i.join("")},parse:function(e){for(var r=e.length,i=[],a=0;a<r;a++)i[a>>>1]|=n(e.charCodeAt(a)<<16-a%2*16);return t.create(i,2*r)}}}(),r.enc.Utf16)})),e((function(t,e){var r,n;t.exports=(r=(n=xt).lib.WordArray,n.enc.Base64={stringify:function(t){var e=t.words,r=t.sigBytes,n=this._map;t.clamp();for(var i=[],a=0;a<r;a+=3)for(var o=(e[a>>>2]>>>24-a%4*8&255)<<16|(e[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|e[a+2>>>2]>>>24-(a+2)%4*8&255,s=0;s<4&&a+.75*s<r;s++)i.push(n.charAt(o>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;i.length%4;)i.push(u);return i.join("")},parse:function(t){var e=t.length,n=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var a=0;a<n.length;a++)i[n.charCodeAt(a)]=a}var o=n.charAt(64);if(o){var s=t.indexOf(o);-1!==s&&(e=s)}return function(t,e,n){for(var i=[],a=0,o=0;o<e;o++)if(o%4){var s=n[t.charCodeAt(o-1)]<<o%4*2,u=n[t.charCodeAt(o)]>>>6-o%4*2;i[a>>>2]|=(s|u)<<24-a%4*8,a++}return r.create(i,a)}(t,e,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),e((function(t,e){var r;t.exports=(r=xt,function(t){var e=r,n=e.lib,i=n.WordArray,a=n.Hasher,o=e.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var u=o.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a=this._hash.words,o=t[e+0],u=t[e+1],d=t[e+2],p=t[e+3],m=t[e+4],v=t[e+5],g=t[e+6],y=t[e+7],_=t[e+8],b=t[e+9],x=t[e+10],w=t[e+11],M=t[e+12],A=t[e+13],E=t[e+14],S=t[e+15],T=a[0],C=a[1],O=a[2],P=a[3];T=l(T,C,O,P,o,7,s[0]),P=l(P,T,C,O,u,12,s[1]),O=l(O,P,T,C,d,17,s[2]),C=l(C,O,P,T,p,22,s[3]),T=l(T,C,O,P,m,7,s[4]),P=l(P,T,C,O,v,12,s[5]),O=l(O,P,T,C,g,17,s[6]),C=l(C,O,P,T,y,22,s[7]),T=l(T,C,O,P,_,7,s[8]),P=l(P,T,C,O,b,12,s[9]),O=l(O,P,T,C,x,17,s[10]),C=l(C,O,P,T,w,22,s[11]),T=l(T,C,O,P,M,7,s[12]),P=l(P,T,C,O,A,12,s[13]),O=l(O,P,T,C,E,17,s[14]),T=c(T,C=l(C,O,P,T,S,22,s[15]),O,P,u,5,s[16]),P=c(P,T,C,O,g,9,s[17]),O=c(O,P,T,C,w,14,s[18]),C=c(C,O,P,T,o,20,s[19]),T=c(T,C,O,P,v,5,s[20]),P=c(P,T,C,O,x,9,s[21]),O=c(O,P,T,C,S,14,s[22]),C=c(C,O,P,T,m,20,s[23]),T=c(T,C,O,P,b,5,s[24]),P=c(P,T,C,O,E,9,s[25]),O=c(O,P,T,C,p,14,s[26]),C=c(C,O,P,T,_,20,s[27]),T=c(T,C,O,P,A,5,s[28]),P=c(P,T,C,O,d,9,s[29]),O=c(O,P,T,C,y,14,s[30]),T=h(T,C=c(C,O,P,T,M,20,s[31]),O,P,v,4,s[32]),P=h(P,T,C,O,_,11,s[33]),O=h(O,P,T,C,w,16,s[34]),C=h(C,O,P,T,E,23,s[35]),T=h(T,C,O,P,u,4,s[36]),P=h(P,T,C,O,m,11,s[37]),O=h(O,P,T,C,y,16,s[38]),C=h(C,O,P,T,x,23,s[39]),T=h(T,C,O,P,A,4,s[40]),P=h(P,T,C,O,o,11,s[41]),O=h(O,P,T,C,p,16,s[42]),C=h(C,O,P,T,g,23,s[43]),T=h(T,C,O,P,b,4,s[44]),P=h(P,T,C,O,M,11,s[45]),O=h(O,P,T,C,S,16,s[46]),T=f(T,C=h(C,O,P,T,d,23,s[47]),O,P,o,6,s[48]),P=f(P,T,C,O,y,10,s[49]),O=f(O,P,T,C,E,15,s[50]),C=f(C,O,P,T,v,21,s[51]),T=f(T,C,O,P,M,6,s[52]),P=f(P,T,C,O,p,10,s[53]),O=f(O,P,T,C,x,15,s[54]),C=f(C,O,P,T,u,21,s[55]),T=f(T,C,O,P,_,6,s[56]),P=f(P,T,C,O,S,10,s[57]),O=f(O,P,T,C,g,15,s[58]),C=f(C,O,P,T,A,21,s[59]),T=f(T,C,O,P,m,6,s[60]),P=f(P,T,C,O,w,10,s[61]),O=f(O,P,T,C,d,15,s[62]),C=f(C,O,P,T,b,21,s[63]),a[0]=a[0]+T|0,a[1]=a[1]+C|0,a[2]=a[2]+O|0,a[3]=a[3]+P|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var a=t.floor(n/4294967296),o=n;r[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),r[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,u=s.words,l=0;l<4;l++){var c=u[l];u[l]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}});function l(t,e,r,n,i,a,o){var s=t+(e&r|~e&n)+i+o;return(s<<a|s>>>32-a)+e}function c(t,e,r,n,i,a,o){var s=t+(e&n|r&~n)+i+o;return(s<<a|s>>>32-a)+e}function h(t,e,r,n,i,a,o){var s=t+(e^r^n)+i+o;return(s<<a|s>>>32-a)+e}function f(t,e,r,n,i,a,o){var s=t+(r^(e|~n))+i+o;return(s<<a|s>>>32-a)+e}e.MD5=a._createHelper(u),e.HmacMD5=a._createHmacHelper(u)}(Math),r.MD5)})),e((function(t,e){var r,n,i,a,o,s,u;t.exports=(i=(n=(r=u=xt).lib).WordArray,o=[],s=r.algo.SHA1=(a=n.Hasher).extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],s=r[3],u=r[4],l=0;l<80;l++){if(l<16)o[l]=0|t[e+l];else{var c=o[l-3]^o[l-8]^o[l-14]^o[l-16];o[l]=c<<1|c>>>31}var h=(n<<5|n>>>27)+u+o[l];h+=l<20?1518500249+(i&a|~i&s):l<40?1859775393+(i^a^s):l<60?(i&a|i&s|a&s)-1894007588:(i^a^s)-899497514,u=s,s=a,a=i<<30|i>>>2,i=n,n=h}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),e[15+(n+64>>>9<<4)]=r,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}}),r.SHA1=a._createHelper(s),r.HmacSHA1=a._createHmacHelper(s),u.SHA1)})),e((function(t,e){var r;t.exports=(r=xt,function(t){var e=r,n=e.lib,i=n.WordArray,a=n.Hasher,o=e.algo,s=[],u=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0}function r(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(s[i]=r(t.pow(n,.5))),u[i]=r(t.pow(n,1/3)),i++),n++}();var l=[],c=o.SHA256=a.extend({_doReset:function(){this._hash=new i.init(s.slice(0))},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],c=r[5],h=r[6],f=r[7],d=0;d<64;d++){if(d<16)l[d]=0|t[e+d];else{var p=l[d-15],m=l[d-2];l[d]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+l[d-7]+((m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10)+l[d-16]}var v=n&i^n&a^i&a,g=f+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&c^~s&h)+u[d]+l[d];f=h,h=c,c=s,s=o+g|0,o=a,a=i,i=n,n=g+(((n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22))+v)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0,r[4]=r[4]+s|0,r[5]=r[5]+c|0,r[6]=r[6]+h|0,r[7]=r[7]+f|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=t.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=a._createHelper(c),e.HmacSHA256=a._createHmacHelper(c)}(Math),r.SHA256)})),e((function(t,e){var r,n,i,a,o,s;t.exports=(n=(r=s=xt).lib.WordArray,o=(i=r.algo).SHA224=(a=i.SHA256).extend({_doReset:function(){this._hash=new n.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var t=a._doFinalize.call(this);return t.sigBytes-=4,t}}),r.SHA224=a._createHelper(o),r.HmacSHA224=a._createHmacHelper(o),s.SHA224)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib.Hasher,n=t.x64,i=n.Word,a=n.WordArray,o=t.algo;function s(){return i.create.apply(i,arguments)}var u=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],l=[];!function(){for(var t=0;t<80;t++)l[t]=s()}();var c=o.SHA512=e.extend({_doReset:function(){this._hash=new a.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(t,e){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],c=r[5],h=r[6],f=r[7],d=n.high,p=n.low,m=i.high,v=i.low,g=a.high,y=a.low,_=o.high,b=o.low,x=s.high,w=s.low,M=c.high,A=c.low,E=h.high,S=h.low,T=f.high,C=f.low,O=d,P=p,L=m,I=v,k=g,R=y,D=_,B=b,F=x,j=w,N=M,U=A,z=E,G=S,V=T,H=C,W=0;W<80;W++){var $=l[W];if(W<16)var q=$.high=0|t[e+2*W],X=$.low=0|t[e+2*W+1];else{var K=l[W-15],Z=K.high,Y=K.low,J=(Y>>>1|Z<<31)^(Y>>>8|Z<<24)^(Y>>>7|Z<<25),Q=l[W-2],tt=Q.high,et=Q.low,rt=(et>>>19|tt<<13)^(et<<3|tt>>>29)^(et>>>6|tt<<26),nt=l[W-7],it=l[W-16],at=it.low;$.high=q=(q=(q=((Z>>>1|Y<<31)^(Z>>>8|Y<<24)^Z>>>7)+nt.high+((X=J+nt.low)>>>0<J>>>0?1:0))+((tt>>>19|et<<13)^(tt<<3|et>>>29)^tt>>>6)+((X+=rt)>>>0<rt>>>0?1:0))+it.high+((X+=at)>>>0<at>>>0?1:0),$.low=X}var ot,st=F&N^~F&z,ut=j&U^~j&G,lt=O&L^O&k^L&k,ct=(P>>>28|O<<4)^(P<<30|O>>>2)^(P<<25|O>>>7),ht=u[W],ft=ht.low,dt=V+((F>>>14|j<<18)^(F>>>18|j<<14)^(F<<23|j>>>9))+((ot=H+((j>>>14|F<<18)^(j>>>18|F<<14)^(j<<23|F>>>9)))>>>0<H>>>0?1:0),pt=ct+(P&I^P&R^I&R);V=z,H=G,z=N,G=U,N=F,U=j,F=D+(dt=(dt=(dt=dt+st+((ot+=ut)>>>0<ut>>>0?1:0))+ht.high+((ot+=ft)>>>0<ft>>>0?1:0))+q+((ot+=X)>>>0<X>>>0?1:0))+((j=B+ot|0)>>>0<B>>>0?1:0)|0,D=k,B=R,k=L,R=I,L=O,I=P,O=dt+(((O>>>28|P<<4)^(O<<30|P>>>2)^(O<<25|P>>>7))+lt+(pt>>>0<ct>>>0?1:0))+((P=ot+pt|0)>>>0<ot>>>0?1:0)|0}p=n.low=p+P,n.high=d+O+(p>>>0<P>>>0?1:0),v=i.low=v+I,i.high=m+L+(v>>>0<I>>>0?1:0),y=a.low=y+R,a.high=g+k+(y>>>0<R>>>0?1:0),b=o.low=b+B,o.high=_+D+(b>>>0<B>>>0?1:0),w=s.low=w+j,s.high=x+F+(w>>>0<j>>>0?1:0),A=c.low=A+U,c.high=M+N+(A>>>0<U>>>0?1:0),S=h.low=S+G,h.high=E+z+(S>>>0<G>>>0?1:0),C=f.low=C+H,f.high=T+V+(C>>>0<H>>>0?1:0)},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),e[31+(n+128>>>10<<5)]=r,t.sigBytes=4*e.length,this._process(),this._hash.toX32()},clone:function(){var t=e.clone.call(this);return t._hash=this._hash.clone(),t},blockSize:32});t.SHA512=e._createHelper(c),t.HmacSHA512=e._createHmacHelper(c)}(),r.SHA512)})),e((function(t,e){var r,n,i,a,o,s,u,l;t.exports=(i=(n=(r=l=xt).x64).Word,a=n.WordArray,u=(o=r.algo).SHA384=(s=o.SHA512).extend({_doReset:function(){this._hash=new a.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var t=s._doFinalize.call(this);return t.sigBytes-=16,t}}),r.SHA384=s._createHelper(u),r.HmacSHA384=s._createHmacHelper(u),l.SHA384)})),e((function(t,e){var r;t.exports=(r=xt,function(t){var e=r,n=e.lib,i=n.WordArray,a=n.Hasher,o=e.x64.Word,s=e.algo,u=[],l=[],c=[];!function(){for(var t=1,e=0,r=0;r<24;r++){u[t+5*e]=(r+1)*(r+2)/2%64;var n=(2*t+3*e)%5;t=e%5,e=n}for(t=0;t<5;t++)for(e=0;e<5;e++)l[t+5*e]=e+(2*t+3*e)%5*5;for(var i=1,a=0;a<24;a++){for(var s=0,h=0,f=0;f<7;f++){if(1&i){var d=(1<<f)-1;d<32?h^=1<<d:s^=1<<d-32}128&i?i=i<<1^113:i<<=1}c[a]=o.create(s,h)}}();var h=[];!function(){for(var t=0;t<25;t++)h[t]=o.create()}();var f=s.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var t=this._state=[],e=0;e<25;e++)t[e]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(t,e){for(var r=this._state,n=this.blockSize/2,i=0;i<n;i++){var a=t[e+2*i],o=t[e+2*i+1];a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(L=r[i]).high^=o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),L.low^=a}for(var s=0;s<24;s++){for(var f=0;f<5;f++){for(var d=0,p=0,m=0;m<5;m++)d^=(L=r[f+5*m]).high,p^=L.low;var v=h[f];v.high=d,v.low=p}for(f=0;f<5;f++){var g=h[(f+4)%5],y=h[(f+1)%5],_=y.high,b=y.low;for(d=g.high^(_<<1|b>>>31),p=g.low^(b<<1|_>>>31),m=0;m<5;m++)(L=r[f+5*m]).high^=d,L.low^=p}for(var x=1;x<25;x++){var w=(L=r[x]).high,M=L.low,A=u[x];A<32?(d=w<<A|M>>>32-A,p=M<<A|w>>>32-A):(d=M<<A-32|w>>>64-A,p=w<<A-32|M>>>64-A);var E=h[l[x]];E.high=d,E.low=p}var S=h[0],T=r[0];for(S.high=T.high,S.low=T.low,f=0;f<5;f++)for(m=0;m<5;m++){var C=h[x=f+5*m],O=h[(f+1)%5+5*m],P=h[(f+2)%5+5*m];(L=r[x]).high=C.high^~O.high&P.high,L.low=C.low^~O.low&P.low}var L,I=c[s];(L=r[0]).high^=I.high,L.low^=I.low}},_doFinalize:function(){var e=this._data,r=e.words,n=8*e.sigBytes,a=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(t.ceil((n+1)/a)*a>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var o=this._state,s=this.cfg.outputLength/8,u=s/8,l=[],c=0;c<u;c++){var h=o[c],f=h.high,d=h.low;f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),l.push(d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)),l.push(f)}return new i.init(l,s)},clone:function(){for(var t=a.clone.call(this),e=t._state=this._state.slice(0),r=0;r<25;r++)e[r]=e[r].clone();return t}});e.SHA3=a._createHelper(f),e.HmacSHA3=a._createHmacHelper(f)}(Math),r.SHA3)})),e((function(t,e){var r;t.exports=(r=xt,function(t){var e=r,n=e.lib,i=n.WordArray,a=n.Hasher,o=e.algo,s=i.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),u=i.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=i.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=i.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=i.create([0,1518500249,1859775393,2400959708,2840853838]),f=i.create([1352829926,1548603684,1836072691,2053994217,0]),d=o.RIPEMD160=a.extend({_doReset:function(){this._hash=i.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a,o,d,b,x,w,M,A,E,S,T,C=this._hash.words,O=h.words,P=f.words,L=s.words,I=u.words,k=l.words,R=c.words;for(w=a=C[0],M=o=C[1],A=d=C[2],E=b=C[3],S=x=C[4],r=0;r<80;r+=1)T=a+t[e+L[r]]|0,T+=r<16?p(o,d,b)+O[0]:r<32?m(o,d,b)+O[1]:r<48?v(o,d,b)+O[2]:r<64?g(o,d,b)+O[3]:y(o,d,b)+O[4],T=(T=_(T|=0,k[r]))+x|0,a=x,x=b,b=_(d,10),d=o,o=T,T=w+t[e+I[r]]|0,T+=r<16?y(M,A,E)+P[0]:r<32?g(M,A,E)+P[1]:r<48?v(M,A,E)+P[2]:r<64?m(M,A,E)+P[3]:p(M,A,E)+P[4],T=(T=_(T|=0,R[r]))+S|0,w=S,S=E,E=_(A,10),A=M,M=T;T=C[1]+d+E|0,C[1]=C[2]+b+S|0,C[2]=C[3]+x+w|0,C[3]=C[4]+a+M|0,C[4]=C[0]+o+A|0,C[0]=T},_doFinalize:function(){var t=this._data,e=t.words,r=8*this._nDataBytes,n=8*t.sigBytes;e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(e.length+1),this._process();for(var i=this._hash,a=i.words,o=0;o<5;o++){var s=a[o];a[o]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}return i},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}});function p(t,e,r){return t^e^r}function m(t,e,r){return t&e|~t&r}function v(t,e,r){return(t|~e)^r}function g(t,e,r){return t&r|e&~r}function y(t,e,r){return t^(e|~r)}function _(t,e){return t<<e|t>>>32-e}e.RIPEMD160=a._createHelper(d),e.HmacRIPEMD160=a._createHmacHelper(d)}(),r.RIPEMD160)})),e((function(t,e){var r,n;t.exports=(n=(r=xt).enc.Utf8,void(r.algo.HMAC=r.lib.Base.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=n.parse(e));var r=t.blockSize,i=4*r;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var a=this._oKey=e.clone(),o=this._iKey=e.clone(),s=a.words,u=o.words,l=0;l<r;l++)s[l]^=1549556828,u[l]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,r=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(r))}})))})),e((function(t,e){var r,n,i,a,o,s,u,l;t.exports=(a=(n=(r=l=xt).lib).WordArray,s=(o=r.algo).HMAC,u=o.PBKDF2=(i=n.Base).extend({cfg:i.extend({keySize:4,hasher:o.SHA1,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=this.cfg,n=s.create(r.hasher,t),i=a.create(),o=a.create([1]),u=i.words,l=o.words,c=r.keySize,h=r.iterations;u.length<c;){var f=n.update(e).finalize(o);n.reset();for(var d=f.words,p=d.length,m=f,v=1;v<h;v++){m=n.finalize(m),n.reset();for(var g=m.words,y=0;y<p;y++)d[y]^=g[y]}i.concat(f),l[0]++}return i.sigBytes=4*c,i}}),r.PBKDF2=function(t,e,r){return u.create(r).compute(t,e)},l.PBKDF2)})),e((function(t,e){var r,n,i,a,o,s,u;t.exports=(a=(n=(r=u=xt).lib).WordArray,s=(o=r.algo).EvpKDF=(i=n.Base).extend({cfg:i.extend({keySize:4,hasher:o.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var r=this.cfg,n=r.hasher.create(),i=a.create(),o=i.words,s=r.keySize,u=r.iterations;o.length<s;){l&&n.update(l);var l=n.update(t).finalize(e);n.reset();for(var c=1;c<u;c++)l=n.finalize(l),n.reset();i.concat(l)}return i.sigBytes=4*s,i}}),r.EvpKDF=function(t,e,r){return s.create(r).compute(t,e)},u.EvpKDF)})),e((function(t,e){var r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b;t.exports=void((r=xt).lib.Cipher||(n=r,i=n.lib,a=i.Base,o=i.WordArray,s=i.BufferedBlockAlgorithm,u=n.enc,l=u.Base64,c=n.algo.EvpKDF,h=i.Cipher=s.extend({cfg:a.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,r){this.cfg=this.cfg.extend(r),this._xformMode=t,this._key=e,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?b:y}return function(e){return{encrypt:function(r,n,i){return t(n).encrypt(e,r,n,i)},decrypt:function(r,n,i){return t(n).decrypt(e,r,n,i)}}}}()}),i.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),f=n.mode={},d=i.BlockCipherMode=a.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),p=f.CBC=function(){var t=d.extend();function e(t,e,r){var n=this._iv;if(n){var i=n;this._iv=void 0}else i=this._prevBlock;for(var a=0;a<r;a++)t[e+a]^=i[a]}return t.Encryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize;e.call(this,t,r,i),n.encryptBlock(t,r),this._prevBlock=t.slice(r,r+i)}}),t.Decryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize,a=t.slice(r,r+i);n.decryptBlock(t,r),e.call(this,t,r,i),this._prevBlock=a}}),t}(),m=(n.pad={}).Pkcs7={pad:function(t,e){for(var r=4*e,n=r-t.sigBytes%r,i=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(i);var u=o.create(a,n);t.concat(u)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},i.BlockCipher=h.extend({cfg:h.cfg.extend({mode:p,padding:m}),reset:function(){h.reset.call(this);var t=this.cfg,e=t.iv,r=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else n=r.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==n?this._mode.init(this,e&&e.words):(this._mode=n.call(r,this,e&&e.words),this._mode.__creator=n)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4}),v=i.CipherParams=a.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),g=(n.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,r=t.salt;if(r)var n=o.create([1398893684,1701076831]).concat(r).concat(e);else n=e;return n.toString(l)},parse:function(t){var e=l.parse(t),r=e.words;if(1398893684==r[0]&&1701076831==r[1]){var n=o.create(r.slice(2,4));r.splice(0,4),e.sigBytes-=16}return v.create({ciphertext:e,salt:n})}},y=i.SerializableCipher=a.extend({cfg:a.extend({format:g}),encrypt:function(t,e,r,n){n=this.cfg.extend(n);var i=t.createEncryptor(r,n),a=i.finalize(e),o=i.cfg;return v.create({ciphertext:a,key:r,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,r,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(r,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),_=(n.kdf={}).OpenSSL={execute:function(t,e,r,n){n||(n=o.random(8));var i=c.create({keySize:e+r}).compute(t,n),a=o.create(i.words.slice(e),4*r);return i.sigBytes=4*e,v.create({key:i,iv:a,salt:n})}},b=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:_}),encrypt:function(t,e,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,t.keySize,t.ivSize);n.iv=i.iv;var a=y.encrypt.call(this,t,e,i.key,n);return a.mixIn(i),a},decrypt:function(t,e,r,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=n.kdf.execute(r,t.keySize,t.ivSize,e.salt);return n.iv=i.iv,y.decrypt.call(this,t,e,i.key,n)}})))})),e((function(t,e){var r;t.exports=((r=xt).mode.CFB=function(){var t=r.lib.BlockCipherMode.extend();function e(t,e,r,n){var i=this._iv;if(i){var a=i.slice(0);this._iv=void 0}else a=this._prevBlock;n.encryptBlock(a,0);for(var o=0;o<r;o++)t[e+o]^=a[o]}return t.Encryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize;e.call(this,t,r,i,n),this._prevBlock=t.slice(r,r+i)}}),t.Decryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize,a=t.slice(r,r+i);e.call(this,t,r,i,n),this._prevBlock=a}}),t}(),r.mode.CFB)})),e((function(t,e){var r,n,i;t.exports=((i=xt).mode.CTR=(n=(r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0);var o=a.slice(0);r.encryptBlock(o,0),a[n-1]=a[n-1]+1|0;for(var s=0;s<n;s++)t[e+s]^=o[s]}}),r.Decryptor=n,r),i.mode.CTR)})),e((function(t,e){var r;t.exports=((r=xt).mode.CTRGladman=function(){var t=r.lib.BlockCipherMode.extend();function e(t){if(255==(t>>24&255)){var e=t>>16&255,r=t>>8&255,n=255&t;255===e?(e=0,255===r?(r=0,255===n?n=0:++n):++r):++e,t=0,t+=e<<16,t+=r<<8,t+=n}else t+=1<<24;return t}var n=t.Encryptor=t.extend({processBlock:function(t,r){var n=this._cipher,i=n.blockSize,a=this._iv,o=this._counter;a&&(o=this._counter=a.slice(0),this._iv=void 0),function(t){0===(t[0]=e(t[0]))&&(t[1]=e(t[1]))}(o);var s=o.slice(0);n.encryptBlock(s,0);for(var u=0;u<i;u++)t[r+u]^=s[u]}});return t.Decryptor=n,t}(),r.mode.CTRGladman)})),e((function(t,e){var r,n,i;t.exports=((i=xt).mode.OFB=(n=(r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){var r=this._cipher,n=r.blockSize,i=this._iv,a=this._keystream;i&&(a=this._keystream=i.slice(0),this._iv=void 0),r.encryptBlock(a,0);for(var o=0;o<n;o++)t[e+o]^=a[o]}}),r.Decryptor=n,r),i.mode.OFB)})),e((function(t,e){var r,n;t.exports=((n=xt).mode.ECB=((r=n.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(t,e){this._cipher.encryptBlock(t,e)}}),r.Decryptor=r.extend({processBlock:function(t,e){this._cipher.decryptBlock(t,e)}}),r),n.mode.ECB)})),e((function(t,e){var r;t.exports=((r=xt).pad.AnsiX923={pad:function(t,e){var r=t.sigBytes,n=4*e,i=n-r%n,a=r+i-1;t.clamp(),t.words[a>>>2]|=i<<24-a%4*8,t.sigBytes+=i},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},r.pad.Ansix923)})),e((function(t,e){var r;t.exports=((r=xt).pad.Iso10126={pad:function(t,e){var n=4*e,i=n-t.sigBytes%n;t.concat(r.lib.WordArray.random(i-1)).concat(r.lib.WordArray.create([i<<24],1))},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},r.pad.Iso10126)})),e((function(t,e){var r;t.exports=((r=xt).pad.Iso97971={pad:function(t,e){t.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(t,e)},unpad:function(t){r.pad.ZeroPadding.unpad(t),t.sigBytes--}},r.pad.Iso97971)})),e((function(t,e){var r;t.exports=((r=xt).pad.ZeroPadding={pad:function(t,e){var r=4*e;t.clamp(),t.sigBytes+=r-(t.sigBytes%r||r)},unpad:function(t){for(var e=t.words,r=t.sigBytes-1;!(e[r>>>2]>>>24-r%4*8&255);)r--;t.sigBytes=r+1}},r.pad.ZeroPadding)})),e((function(t,e){var r;t.exports=((r=xt).pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)})),e((function(t,e){var r,n,i;t.exports=(r=(i=xt).lib.CipherParams,n=i.enc.Hex,i.format.Hex={stringify:function(t){return t.ciphertext.toString(n)},parse:function(t){var e=n.parse(t);return r.create({ciphertext:e})}},i.format.Hex)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib.BlockCipher,n=t.algo,i=[],a=[],o=[],s=[],u=[],l=[],c=[],h=[],f=[],d=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var r=0,n=0;for(e=0;e<256;e++){var p=n^n<<1^n<<2^n<<3^n<<4;i[r]=p=p>>>8^255&p^99,a[p]=r;var m,v=t[r],g=t[v],y=t[g];o[r]=(m=257*t[p]^16843008*p)<<24|m>>>8,s[r]=m<<16|m>>>16,u[r]=m<<8|m>>>24,l[r]=m,c[p]=(m=16843009*y^65537*g^257*v^16843008*r)<<24|m>>>8,h[p]=m<<16|m>>>16,f[p]=m<<8|m>>>24,d[p]=m,r?(r=v^t[t[t[y^v]]],n^=t[t[n]]):r=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=n.AES=e.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,r=t.sigBytes/4,n=4*((this._nRounds=r+6)+1),a=this._keySchedule=[],o=0;o<n;o++)if(o<r)a[o]=e[o];else{var s=a[o-1];o%r?r>6&&o%r==4&&(s=i[s>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s]):(s=i[(s=s<<8|s>>>24)>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[255&s],s^=p[o/r|0]<<24),a[o]=a[o-r]^s}for(var u=this._invKeySchedule=[],l=0;l<n;l++)o=n-l,s=l%4?a[o]:a[o-4],u[l]=l<4||o<=4?s:c[i[s>>>24]]^h[i[s>>>16&255]]^f[i[s>>>8&255]]^d[i[255&s]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,o,s,u,l,i)},decryptBlock:function(t,e){var r=t[e+1];t[e+1]=t[e+3],t[e+3]=r,this._doCryptBlock(t,e,this._invKeySchedule,c,h,f,d,a),r=t[e+1],t[e+1]=t[e+3],t[e+3]=r},_doCryptBlock:function(t,e,r,n,i,a,o,s){for(var u=this._nRounds,l=t[e]^r[0],c=t[e+1]^r[1],h=t[e+2]^r[2],f=t[e+3]^r[3],d=4,p=1;p<u;p++){var m=n[l>>>24]^i[c>>>16&255]^a[h>>>8&255]^o[255&f]^r[d++],v=n[c>>>24]^i[h>>>16&255]^a[f>>>8&255]^o[255&l]^r[d++],g=n[h>>>24]^i[f>>>16&255]^a[l>>>8&255]^o[255&c]^r[d++],y=n[f>>>24]^i[l>>>16&255]^a[c>>>8&255]^o[255&h]^r[d++];l=m,c=v,h=g,f=y}m=(s[l>>>24]<<24|s[c>>>16&255]<<16|s[h>>>8&255]<<8|s[255&f])^r[d++],v=(s[c>>>24]<<24|s[h>>>16&255]<<16|s[f>>>8&255]<<8|s[255&l])^r[d++],g=(s[h>>>24]<<24|s[f>>>16&255]<<16|s[l>>>8&255]<<8|s[255&c])^r[d++],y=(s[f>>>24]<<24|s[l>>>16&255]<<16|s[c>>>8&255]<<8|s[255&h])^r[d++],t[e]=m,t[e+1]=v,t[e+2]=g,t[e+3]=y},keySize:8});t.AES=e._createHelper(m)}(),r.AES)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib,n=e.WordArray,i=e.BlockCipher,a=t.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],s=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=a.DES=i.extend({_doReset:function(){for(var t=this._key.words,e=[],r=0;r<56;r++){var n=o[r]-1;e[r]=t[n>>>5]>>>31-n%32&1}for(var i=this._subKeys=[],a=0;a<16;a++){var l=i[a]=[],c=u[a];for(r=0;r<24;r++)l[r/6|0]|=e[(s[r]-1+c)%28]<<31-r%6,l[4+(r/6|0)]|=e[28+(s[r+24]-1+c)%28]<<31-r%6;for(l[0]=l[0]<<1|l[0]>>>31,r=1;r<7;r++)l[r]=l[r]>>>4*(r-1)+3;l[7]=l[7]<<5|l[7]>>>27}var h=this._invSubKeys=[];for(r=0;r<16;r++)h[r]=i[15-r]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._subKeys)},decryptBlock:function(t,e){this._doCryptBlock(t,e,this._invSubKeys)},_doCryptBlock:function(t,e,r){this._lBlock=t[e],this._rBlock=t[e+1],f.call(this,4,252645135),f.call(this,16,65535),d.call(this,2,858993459),d.call(this,8,16711935),f.call(this,1,1431655765);for(var n=0;n<16;n++){for(var i=r[n],a=this._lBlock,o=this._rBlock,s=0,u=0;u<8;u++)s|=l[u][((o^i[u])&c[u])>>>0];this._lBlock=o,this._rBlock=a^s}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,f.call(this,1,1431655765),d.call(this,8,16711935),d.call(this,2,858993459),f.call(this,16,65535),f.call(this,4,252645135),t[e]=this._lBlock,t[e+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function f(t,e){var r=(this._lBlock>>>t^this._rBlock)&e;this._rBlock^=r,this._lBlock^=r<<t}function d(t,e){var r=(this._rBlock>>>t^this._lBlock)&e;this._lBlock^=r,this._rBlock^=r<<t}t.DES=i._createHelper(h);var p=a.TripleDES=i.extend({_doReset:function(){var t=this._key.words;this._des1=h.createEncryptor(n.create(t.slice(0,2))),this._des2=h.createEncryptor(n.create(t.slice(2,4))),this._des3=h.createEncryptor(n.create(t.slice(4,6)))},encryptBlock:function(t,e){this._des1.encryptBlock(t,e),this._des2.decryptBlock(t,e),this._des3.encryptBlock(t,e)},decryptBlock:function(t,e){this._des3.decryptBlock(t,e),this._des2.encryptBlock(t,e),this._des1.decryptBlock(t,e)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=i._createHelper(p)}(),r.TripleDES)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib.StreamCipher,n=t.algo,i=n.RC4=e.extend({_doReset:function(){for(var t=this._key,e=t.words,r=t.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var a=0;i<256;i++){var o=i%r,s=n[i];n[i]=n[a=(a+n[i]+(e[o>>>2]>>>24-o%4*8&255))%256],n[a]=s}this._i=this._j=0},_doProcessBlock:function(t,e){t[e]^=a.call(this)},keySize:8,ivSize:0});function a(){for(var t=this._S,e=this._i,r=this._j,n=0,i=0;i<4;i++){var a=t[e=(e+1)%256];t[e]=t[r=(r+t[e])%256],t[r]=a,n|=t[(t[e]+t[r])%256]<<24-8*i}return this._i=e,this._j=r,n}t.RC4=e._createHelper(i);var o=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var t=this.cfg.drop;t>0;t--)a.call(this)}});t.RC4Drop=e._createHelper(o)}(),r.RC4)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib.StreamCipher,n=[],i=[],a=[],o=t.algo.Rabbit=e.extend({_doReset:function(){for(var t=this._key.words,e=this.cfg.iv,r=0;r<4;r++)t[r]=16711935&(t[r]<<8|t[r]>>>24)|4278255360&(t[r]<<24|t[r]>>>8);var n=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],i=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];for(this._b=0,r=0;r<4;r++)s.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(e){var a=e.words,o=a[0],u=a[1],l=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),c=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),h=l>>>16|4294901760&c,f=c<<16|65535&l;for(i[0]^=l,i[1]^=h,i[2]^=c,i[3]^=f,i[4]^=l,i[5]^=h,i[6]^=c,i[7]^=f,r=0;r<4;r++)s.call(this)}},_doProcessBlock:function(t,e){var r=this._X;s.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)n[i]=16711935&(n[i]<<8|n[i]>>>24)|4278255360&(n[i]<<24|n[i]>>>8),t[e+i]^=n[i]},blockSize:4,ivSize:2});function s(){for(var t=this._X,e=this._C,r=0;r<8;r++)i[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<i[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<i[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<i[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<i[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<i[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<i[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<i[6]>>>0?1:0)|0,this._b=e[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var n=t[r]+e[r],o=65535&n,s=n>>>16;a[r]=((o*o>>>17)+o*s>>>15)+s*s^((4294901760&n)*n|0)+((65535&n)*n|0)}t[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,t[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,t[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,t[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,t[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,t[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,t[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,t[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.Rabbit=e._createHelper(o)}(),r.Rabbit)})),e((function(t,e){var r;t.exports=(r=xt,function(){var t=r,e=t.lib.StreamCipher,n=[],i=[],a=[],o=t.algo.RabbitLegacy=e.extend({_doReset:function(){var t=this._key.words,e=this.cfg.iv,r=this._X=[t[0],t[3]<<16|t[2]>>>16,t[1],t[0]<<16|t[3]>>>16,t[2],t[1]<<16|t[0]>>>16,t[3],t[2]<<16|t[1]>>>16],n=this._C=[t[2]<<16|t[2]>>>16,4294901760&t[0]|65535&t[1],t[3]<<16|t[3]>>>16,4294901760&t[1]|65535&t[2],t[0]<<16|t[0]>>>16,4294901760&t[2]|65535&t[3],t[1]<<16|t[1]>>>16,4294901760&t[3]|65535&t[0]];this._b=0;for(var i=0;i<4;i++)s.call(this);for(i=0;i<8;i++)n[i]^=r[i+4&7];if(e){var a=e.words,o=a[0],u=a[1],l=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),c=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),h=l>>>16|4294901760&c,f=c<<16|65535&l;for(n[0]^=l,n[1]^=h,n[2]^=c,n[3]^=f,n[4]^=l,n[5]^=h,n[6]^=c,n[7]^=f,i=0;i<4;i++)s.call(this)}},_doProcessBlock:function(t,e){var r=this._X;s.call(this),n[0]=r[0]^r[5]>>>16^r[3]<<16,n[1]=r[2]^r[7]>>>16^r[5]<<16,n[2]=r[4]^r[1]>>>16^r[7]<<16,n[3]=r[6]^r[3]>>>16^r[1]<<16;for(var i=0;i<4;i++)n[i]=16711935&(n[i]<<8|n[i]>>>24)|4278255360&(n[i]<<24|n[i]>>>8),t[e+i]^=n[i]},blockSize:4,ivSize:2});function s(){for(var t=this._X,e=this._C,r=0;r<8;r++)i[r]=e[r];for(e[0]=e[0]+1295307597+this._b|0,e[1]=e[1]+3545052371+(e[0]>>>0<i[0]>>>0?1:0)|0,e[2]=e[2]+886263092+(e[1]>>>0<i[1]>>>0?1:0)|0,e[3]=e[3]+1295307597+(e[2]>>>0<i[2]>>>0?1:0)|0,e[4]=e[4]+3545052371+(e[3]>>>0<i[3]>>>0?1:0)|0,e[5]=e[5]+886263092+(e[4]>>>0<i[4]>>>0?1:0)|0,e[6]=e[6]+1295307597+(e[5]>>>0<i[5]>>>0?1:0)|0,e[7]=e[7]+3545052371+(e[6]>>>0<i[6]>>>0?1:0)|0,this._b=e[7]>>>0<i[7]>>>0?1:0,r=0;r<8;r++){var n=t[r]+e[r],o=65535&n,s=n>>>16;a[r]=((o*o>>>17)+o*s>>>15)+s*s^((4294901760&n)*n|0)+((65535&n)*n|0)}t[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,t[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,t[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,t[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,t[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,t[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,t[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,t[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.RabbitLegacy=e._createHelper(o)}(),r.RabbitLegacy)})),e((function(t,e){t.exports=xt}))),Mt=e((function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(256),n=0;n<t.length;n++)r[t.charCodeAt(n)]=n;e.encode=function(e){var r,n=new Uint8Array(e),i=n.length,a="";for(r=0;r<i;r+=3)a+=t[n[r]>>2],a+=t[(3&n[r])<<4|n[r+1]>>4],a+=t[(15&n[r+1])<<2|n[r+2]>>6],a+=t[63&n[r+2]];return i%3==2?a=a.substring(0,a.length-1)+"=":i%3==1&&(a=a.substring(0,a.length-2)+"=="),a},e.decode=function(t){var e,n,i,a,o,s=.75*t.length,u=t.length,l=0;"="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--);var c=new ArrayBuffer(s),h=new Uint8Array(c);for(e=0;e<u;e+=4)n=r[t.charCodeAt(e)],i=r[t.charCodeAt(e+1)],a=r[t.charCodeAt(e+2)],o=r[t.charCodeAt(e+3)],h[l++]=n<<2|i>>4,h[l++]=(15&i)<<4|a>>2,h[l++]=(3&a)<<6|63&o;return c}}()})),At=e((function(t,e){var r,n,i=["Argument must be a Buffer","inspect","match"," ... ","<Buffer ","out of range index","includes","Buffer.write(string, encoding, offset[, length]) is no longer supported","Attempt to write outside buffer bounds","toJSON","offset is not uint","Trying to access beyond buffer length",'"buffer" argument must be a Buffer instance','"value" argument is out of bounds',"Index out of range","readUIntLE","readUIntBE","readUInt32LE","readUInt32BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatBE","writeDoubleBE","Out of range index","Invalid code point","trim","replace","constructor","isBuffer","freeze","defineProperty","roundIndex","capacity","padding","allocUnsafe","absorb","squeeze","buffer","state","queue","reset","SHAKE","SHA3","Keccak","defaultSize","update","Not a string or buffer","format","SHA3Hash","sort","map","OKunEzm6fuM2zkUJ7egBbg==","digest","0x9","0xa","267BEJKMOUzm6fuM2zkUJbefggkmnuuzz==","0x0","0x1","0x2","0x4","0x5","0x6","0x3","0x8","0x7","function","amd","undefined","__esModule","hasOwnProperty","default","exports","length","charCodeAt","push","join","pow","abs","floor","log","LN2","toString","isArray","[object Array]","call","TYPED_ARRAY_SUPPORT","__proto__","prototype","number","If encoding is specified then the first argument must be a string","byteLength","'length' is out of bounds","string","utf8","isEncoding","write","slice","Buffer","data",'"size" argument must not be negative',"Attempt to allocate Buffer larger than maximum size: 0x"," bytes","_isBuffer","isView","ascii","latin1","binary","utf-8","ucs2","utf16le","hex","base64","toLowerCase","ucs-2","utf-16le","Unknown encoding: ","from","indexOf","lastIndexOf","readUInt16BE","Invalid hex string","min","fromCharCode","apply","poolSize","_augment","alloc","fill","allocUnsafeSlow","compare","concat",'"list" argument must be an Array of Buffers',"copy","swap32","Buffer size must be a multiple of 32-bits","swap64","Buffer size must be a multiple of 64-bits","equals"];r=i,n=398,function(t){for(;--t;)r.push(r.shift())}(++n);var a=function(t,e){return i[t-=0]};!function(t){function e(t){return t&&t[a("0x3")]&&Object.prototype[a("0x4")].call(t,a("0x5"))?t[a("0x5")]:t}function r(t,e){return t(e={exports:{}},e.exports),e[a("0x6")]}var n=a("0x2")!=typeof commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:a("0x2")!=typeof window?window:{},i=[],o=[],s=a("0x2")!=typeof Uint8Array?Uint8Array:Array,u=!1;function l(){u=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,r=t[a("0x7")];e<r;++e)i[e]=t[e],o[t[a("0x8")](e)]=e;o["-".charCodeAt(0)]=62,o["_"[a("0x8")](0)]=63}function c(t,e,r){for(var n,o,s=[],u=e;u<r;u+=3)n=(t[u]<<16)+(t[u+1]<<8)+t[u+2],s[a("0x9")](i[(o=n)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s[a("0xa")]("")}function h(t){var e;u||l();for(var r=t.length,n=r%3,o="",s=[],h=16383,f=0,d=r-n;f<d;f+=h)s[a("0x9")](c(t,f,f+h>d?d:f+h));return 1===n?(o+=i[(e=t[r-1])>>2],o+=i[e<<4&63],o+="=="):2===n&&(o+=i[(e=(t[r-2]<<8)+t[r-1])>>10],o+=i[e>>4&63],o+=i[e<<2&63],o+="="),s.push(o),s[a("0xa")]("")}function f(t,e,r,n,i){var o,s,u=8*i-n-1,l=(1<<u)-1,c=l>>1,h=-7,f=r?i-1:0,d=r?-1:1,p=t[e+f];for(f+=d,o=p&(1<<-h)-1,p>>=-h,h+=u;h>0;o=256*o+t[e+f],f+=d,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=n;h>0;s=256*s+t[e+f],f+=d,h-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math[a("0xb")](2,n),o-=c}return(p?-1:1)*s*Math[a("0xb")](2,o-n)}function d(t,e,r,n,i,o){var s,u,l,c=8*o-i-1,h=(1<<c)-1,f=h>>1,d=23===i?Math[a("0xb")](2,-24)-Math[a("0xb")](2,-77):0,p=n?0:o-1,m=n?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math[a("0xc")](e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,s=h):(s=Math[a("0xd")](Math[a("0xe")](e)/Math[a("0xf")]),e*(l=Math[a("0xb")](2,-s))<1&&(s--,l*=2),(e+=s+f>=1?d/l:d*Math[a("0xb")](2,1-f))*l>=2&&(s++,l/=2),s+f>=h?(u=0,s=h):s+f>=1?(u=(e*l-1)*Math.pow(2,i),s+=f):(u=e*Math[a("0xb")](2,f-1)*Math[a("0xb")](2,i),s=0));i>=8;t[r+p]=255&u,p+=m,u/=256,i-=8);for(s=s<<i|u,c+=i;c>0;t[r+p]=255&s,p+=m,s/=256,c-=8);t[r+p-m]|=128*v}var p={}[a("0x10")],m=Array[a("0x11")]||function(t){return a("0x12")==p[a("0x13")](t)};_[a("0x14")]=void 0===n.TYPED_ARRAY_SUPPORT||n[a("0x14")];var v=g();function g(){return _[a("0x14")]?2147483647:1073741823}function y(t,e){if(g()<e)throw new RangeError("Invalid typed array length");return _[a("0x14")]?(t=new Uint8Array(e))[a("0x15")]=_[a("0x16")]:(null===t&&(t=new _(e)),t[a("0x7")]=e),t}function _(t,e,r){if(!(_[a("0x14")]||this instanceof _))return new _(t,e,r);if(a("0x17")==typeof t){if("string"==typeof e)throw new Error(a("0x18"));return w(this,t)}return b(this,t,e,r)}function b(t,e,r,n){if(a("0x17")==typeof e)throw new TypeError('"value" argument must not be a number');return a("0x2")!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(a("0x19"),r<0||e[a("0x19")]<r)throw new RangeError("'offset' is out of bounds");if(e[a("0x19")]<r+(n||0))throw new RangeError(a("0x1a"));return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),_[a("0x14")]?(t=e)[a("0x15")]=_.prototype:t=M(t,e),t}(t,e,r,n):a("0x1b")==typeof e?function(t,e,r){if(a("0x1b")==typeof r&&""!==r||(r=a("0x1c")),!_[a("0x1d")](r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|S(e,r),i=(t=y(t,n))[a("0x1e")](e,r);return i!==n&&(t=t[a("0x1f")](0,i)),t}(t,e,r):function(t,e){if(E(e)){var r=0|A(e.length);return 0===(t=y(t,r))[a("0x7")]||e.copy(t,0,0,r),t}if(e){if(a("0x2")!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||a("0x7")in e)return"number"!=typeof e[a("0x7")]||(n=e[a("0x7")])!=n?y(t,0):M(t,e);if(a("0x20")===e.type&&m(e[a("0x21")]))return M(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function x(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError(a("0x22"))}function w(t,e){if(x(e),t=y(t,e<0?0:0|A(e)),!_[a("0x14")])for(var r=0;r<e;++r)t[r]=0;return t}function M(t,e){var r=e[a("0x7")]<0?0:0|A(e[a("0x7")]);t=y(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function A(t){if(t>=g())throw new RangeError(a("0x23")+g()[a("0x10")](16)+a("0x24"));return 0|t}function E(t){return!(null==t||!t[a("0x25")])}function S(t,e){if(E(t))return t.length;if(a("0x2")!=typeof ArrayBuffer&&a("0x0")==typeof ArrayBuffer[a("0x26")]&&(ArrayBuffer[a("0x26")](t)||t instanceof ArrayBuffer))return t[a("0x19")];a("0x1b")!=typeof t&&(t=""+t);var r=t[a("0x7")];if(0===r)return 0;for(var n=!1;;)switch(e){case a("0x27"):case a("0x28"):case a("0x29"):return r;case a("0x1c"):case a("0x2a"):case void 0:return Q(t).length;case a("0x2b"):case"ucs-2":case a("0x2c"):case"utf-16le":return 2*r;case a("0x2d"):return r>>>1;case a("0x2e"):return tt(t)[a("0x7")];default:if(n)return Q(t)[a("0x7")];e=(""+e)[a("0x2f")](),n=!0}}function T(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this[a("0x7")])return"";if((void 0===r||r>this[a("0x7")])&&(r=this[a("0x7")]),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t=a("0x1c"));;)switch(t){case"hex":return G(this,e,r);case a("0x1c"):case a("0x2a"):return j(this,e,r);case"ascii":return U(this,e,r);case a("0x28"):case a("0x29"):return z(this,e,r);case"base64":return F(this,e,r);case"ucs2":case a("0x30"):case a("0x2c"):case a("0x31"):return V(this,e,r);default:if(n)throw new TypeError(a("0x32")+t);t=(t+"")[a("0x2f")](),n=!0}}function C(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function O(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if(a("0x1b")==typeof e&&(e=_[a("0x33")](e,n)),E(e))return 0===e.length?-1:P(t,e,r,n,i);if(a("0x17")==typeof e)return e&=255,_[a("0x14")]&&"function"==typeof Uint8Array[a("0x16")].indexOf?i?Uint8Array[a("0x16")][a("0x34")][a("0x13")](t,e,r):Uint8Array[a("0x16")][a("0x35")][a("0x13")](t,e,r):P(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function P(t,e,r,n,i){var o,s=1,u=t[a("0x7")],l=e[a("0x7")];if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||a("0x30")===n||a("0x2c")===n||a("0x31")===n)){if(t[a("0x7")]<2||e.length<2)return-1;s=2,u/=2,l/=2,r/=2}function c(t,e){return 1===s?t[e]:t[a("0x36")](e*s)}if(i){var h=-1;for(o=r;o<u;o++)if(c(t,o)===c(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===l)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(r+l>u&&(r=u-l),o=r;o>=0;o--){for(var f=!0,d=0;d<l;d++)if(c(t,o+d)!==c(e,d)){f=!1;break}if(f)return o}return-1}function L(t,e,r,n){r=Number(r)||0;var i=t[a("0x7")]-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e[a("0x7")];if(o%2!=0)throw new TypeError(a("0x37"));n>o/2&&(n=o/2);for(var s=0;s<n;++s){var u=parseInt(e.substr(2*s,2),16);if(isNaN(u))return s;t[r+s]=u}return s}function I(t,e,r,n){return et(Q(e,t.length-r),t,r,n)}function k(t,e,r,n){return et(function(t){for(var e=[],r=0;r<t[a("0x7")];++r)e[a("0x9")](255&t[a("0x8")](r));return e}(e),t,r,n)}function R(t,e,r,n){return k(t,e,r,n)}function D(t,e,r,n){return et(tt(e),t,r,n)}function B(t,e,r,n){return et(function(t,e){for(var r,n,i,o=[],s=0;s<t[a("0x7")]&&!((e-=2)<0);++s)n=(r=t[a("0x8")](s))>>8,i=r%256,o[a("0x9")](i),o.push(n);return o}(e,t[a("0x7")]-r),t,r,n)}function F(t,e,r){return 0===e&&r===t[a("0x7")]?h(t):h(t[a("0x1f")](e,r))}function j(t,e,r){r=Math[a("0x38")](t.length,r);for(var n=[],i=e;i<r;){var o,s,u,l,c=t[i],h=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(h=c);break;case 2:128==(192&(o=t[i+1]))&&(l=(31&c)<<6|63&o)>127&&(h=l);break;case 3:s=t[i+2],128==(192&(o=t[i+1]))&&128==(192&s)&&(l=(15&c)<<12|(63&o)<<6|63&s)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=t[i+2],u=t[i+3],128==(192&(o=t[i+1]))&&128==(192&s)&&128==(192&u)&&(l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&u)>65535&&l<1114112&&(h=l)}null===h?(h=65533,f=1):h>65535&&(h-=65536,n[a("0x9")](h>>>10&1023|55296),h=56320|1023&h),n[a("0x9")](h),i+=f}return function(t){var e=t[a("0x7")];if(e<=N)return String[a("0x39")].apply(String,t);for(var r="",n=0;n<e;)r+=String[a("0x39")][a("0x3a")](String,t.slice(n,n+=N));return r}(n)}_[a("0x3b")]=8192,_[a("0x3c")]=function(t){return t.__proto__=_.prototype,t},_[a("0x33")]=function(t,e,r){return b(null,t,e,r)},_.TYPED_ARRAY_SUPPORT&&(_[a("0x16")][a("0x15")]=Uint8Array[a("0x16")],_.__proto__=Uint8Array),_[a("0x3d")]=function(t,e,r){return function(t,e,r,n){return x(e),e<=0?y(t,e):void 0!==r?a("0x1b")==typeof n?y(t,e).fill(r,n):y(t,e)[a("0x3e")](r):y(t,e)}(null,t,e,r)},_.allocUnsafe=function(t){return w(null,t)},_[a("0x3f")]=function(t){return w(null,t)},_.isBuffer=rt,_[a("0x40")]=function(t,e){if(!E(t)||!E(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t[a("0x7")],n=e[a("0x7")],i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},_.isEncoding=function(t){switch(String(t)[a("0x2f")]()){case a("0x2d"):case a("0x1c"):case a("0x2a"):case a("0x27"):case a("0x28"):case"binary":case"base64":case"ucs2":case a("0x30"):case a("0x2c"):case"utf-16le":return!0;default:return!1}},_[a("0x41")]=function(t,e){if(!m(t))throw new TypeError(a("0x42"));if(0===t[a("0x7")])return _[a("0x3d")](0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r][a("0x7")];var n=_.allocUnsafe(e),i=0;for(r=0;r<t[a("0x7")];++r){var o=t[r];if(!E(o))throw new TypeError(a("0x42"));o[a("0x43")](n,i),i+=o[a("0x7")]}return n},_[a("0x19")]=S,_.prototype[a("0x25")]=!0,_[a("0x16")].swap16=function(){var t=this[a("0x7")];if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)C(this,e,e+1);return this},_.prototype[a("0x44")]=function(){var t=this[a("0x7")];if(t%4!=0)throw new RangeError(a("0x45"));for(var e=0;e<t;e+=4)C(this,e,e+3),C(this,e+1,e+2);return this},_[a("0x16")][a("0x46")]=function(){var t=this[a("0x7")];if(t%8!=0)throw new RangeError(a("0x47"));for(var e=0;e<t;e+=8)C(this,e,e+7),C(this,e+1,e+6),C(this,e+2,e+5),C(this,e+3,e+4);return this},_[a("0x16")][a("0x10")]=function(){var t=0|this[a("0x7")];return 0===t?"":0===arguments[a("0x7")]?j(this,0,t):T[a("0x3a")](this,arguments)},_[a("0x16")][a("0x48")]=function(t){if(!E(t))throw new TypeError(a("0x49"));return this===t||0===_.compare(this,t)},_[a("0x16")][a("0x4a")]=function(){var t="";return this.length>0&&(t=this[a("0x10")](a("0x2d"),0,50)[a("0x4b")](/.{2}/g)[a("0xa")](" "),this[a("0x7")]>50&&(t+=a("0x4c"))),a("0x4d")+t+">"},_[a("0x16")].compare=function(t,e,r,n,i){if(!E(t))throw new TypeError(a("0x49"));if(void 0===e&&(e=0),void 0===r&&(r=t?t[a("0x7")]:0),void 0===n&&(n=0),void 0===i&&(i=this[a("0x7")]),e<0||r>t[a("0x7")]||n<0||i>this.length)throw new RangeError(a("0x4e"));if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),u=Math[a("0x38")](o,s),l=this[a("0x1f")](n,i),c=t.slice(e,r),h=0;h<u;++h)if(l[h]!==c[h]){o=l[h],s=c[h];break}return o<s?-1:s<o?1:0},_[a("0x16")][a("0x4f")]=function(t,e,r){return-1!==this.indexOf(t,e,r)},_[a("0x16")][a("0x34")]=function(t,e,r){return O(this,t,e,r,!0)},_[a("0x16")].lastIndexOf=function(t,e,r){return O(this,t,e,r,!1)},_[a("0x16")][a("0x1e")]=function(t,e,r,n){if(void 0===e)n=a("0x1c"),r=this[a("0x7")],e=0;else if(void 0===r&&a("0x1b")==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error(a("0x50"));e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this[a("0x7")]-e;if((void 0===r||r>i)&&(r=i),t[a("0x7")]>0&&(r<0||e<0)||e>this[a("0x7")])throw new RangeError(a("0x51"));n||(n=a("0x1c"));for(var o=!1;;)switch(n){case a("0x2d"):return L(this,t,e,r);case a("0x1c"):case a("0x2a"):return I(this,t,e,r);case a("0x27"):return k(this,t,e,r);case a("0x28"):case a("0x29"):return R(this,t,e,r);case"base64":return D(this,t,e,r);case a("0x2b"):case a("0x30"):case"utf16le":case a("0x31"):return B(this,t,e,r);default:if(o)throw new TypeError(a("0x32")+n);n=(""+n)[a("0x2f")](),o=!0}},_[a("0x16")][a("0x52")]=function(){return{type:"Buffer",data:Array[a("0x16")].slice[a("0x13")](this._arr||this,0)}};var N=4096;function U(t,e,r){var n="";r=Math[a("0x38")](t.length,r);for(var i=e;i<r;++i)n+=String[a("0x39")](127&t[i]);return n}function z(t,e,r){var n="";r=Math[a("0x38")](t[a("0x7")],r);for(var i=e;i<r;++i)n+=String[a("0x39")](t[i]);return n}function G(t,e,r){var n=t[a("0x7")];(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=J(t[o]);return i}function V(t,e,r){for(var n=t[a("0x1f")](e,r),i="",o=0;o<n[a("0x7")];o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function H(t,e,r){if(t%1!=0||t<0)throw new RangeError(a("0x53"));if(t+e>r)throw new RangeError(a("0x54"))}function W(t,e,r,n,i,o){if(!E(t))throw new TypeError(a("0x55"));if(e>i||e<o)throw new RangeError(a("0x56"));if(r+n>t[a("0x7")])throw new RangeError("Index out of range")}function $(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t[a("0x7")]-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function q(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math[a("0x38")](t[a("0x7")]-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function X(t,e,r,n,i,o){if(r+n>t[a("0x7")])throw new RangeError(a("0x57"));if(r<0)throw new RangeError("Index out of range")}function K(t,e,r,n,i){return i||X(t,0,r,4),d(t,e,r,n,23,4),r+4}function Z(t,e,r,n,i){return i||X(t,0,r,8),d(t,e,r,n,52,8),r+8}_.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),_.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e))[a("0x15")]=_.prototype;else{var i=e-t;r=new _(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},_[a("0x16")][a("0x58")]=function(t,e,r){t|=0,e|=0,r||H(t,e,this[a("0x7")]);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},_[a("0x16")][a("0x59")]=function(t,e,r){t|=0,e|=0,r||H(t,e,this[a("0x7")]);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},_[a("0x16")].readUInt8=function(t,e){return e||H(t,1,this[a("0x7")]),this[t]},_[a("0x16")].readUInt16LE=function(t,e){return e||H(t,2,this[a("0x7")]),this[t]|this[t+1]<<8},_[a("0x16")][a("0x36")]=function(t,e){return e||H(t,2,this[a("0x7")]),this[t]<<8|this[t+1]},_[a("0x16")][a("0x5a")]=function(t,e){return e||H(t,4,this[a("0x7")]),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},_[a("0x16")][a("0x5b")]=function(t,e){return e||H(t,4,this[a("0x7")]),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},_.prototype[a("0x5c")]=function(t,e,r){t|=0,e|=0,r||H(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math[a("0xb")](2,8*e)),n},_.prototype[a("0x5d")]=function(t,e,r){t|=0,e|=0,r||H(t,e,this[a("0x7")]);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math[a("0xb")](2,8*e)),o},_[a("0x16")][a("0x5e")]=function(t,e){return e||H(t,1,this[a("0x7")]),128&this[t]?-1*(255-this[t]+1):this[t]},_[a("0x16")][a("0x5f")]=function(t,e){e||H(t,2,this[a("0x7")]);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},_[a("0x16")][a("0x60")]=function(t,e){e||H(t,2,this[a("0x7")]);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},_.prototype.readInt32LE=function(t,e){return e||H(t,4,this[a("0x7")]),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},_.prototype[a("0x61")]=function(t,e){return e||H(t,4,this[a("0x7")]),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},_[a("0x16")][a("0x62")]=function(t,e){return e||H(t,4,this[a("0x7")]),f(this,t,!0,23,4)},_[a("0x16")][a("0x63")]=function(t,e){return e||H(t,4,this.length),f(this,t,!1,23,4)},_[a("0x16")][a("0x64")]=function(t,e){return e||H(t,8,this[a("0x7")]),f(this,t,!0,52,8)},_[a("0x16")].readDoubleBE=function(t,e){return e||H(t,8,this[a("0x7")]),f(this,t,!1,52,8)},_[a("0x16")].writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||W(this,t,e,r,Math[a("0xb")](2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},_.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||W(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},_[a("0x16")][a("0x65")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,1,255,0),_.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},_[a("0x16")][a("0x66")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,2,65535,0),_[a("0x14")]?(this[e]=255&t,this[e+1]=t>>>8):$(this,t,e,!0),e+2},_.prototype[a("0x67")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,2,65535,0),_[a("0x14")]?(this[e]=t>>>8,this[e+1]=255&t):$(this,t,e,!1),e+2},_[a("0x16")][a("0x68")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,4,4294967295,0),_.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):q(this,t,e,!0),e+4},_[a("0x16")][a("0x69")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,4,4294967295,0),_[a("0x14")]?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):q(this,t,e,!1),e+4},_[a("0x16")][a("0x6a")]=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);W(this,t,e,r,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<r&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},_[a("0x16")][a("0x6b")]=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math[a("0xb")](2,8*r-1);W(this,t,e,r,i-1,-i)}var o=r-1,s=1,u=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===u&&0!==this[e+o+1]&&(u=1),this[e+o]=(t/s>>0)-u&255;return e+r},_.prototype[a("0x6c")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,1,127,-128),_.TYPED_ARRAY_SUPPORT||(t=Math[a("0xd")](t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},_[a("0x16")][a("0x6d")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,2,32767,-32768),_[a("0x14")]?(this[e]=255&t,this[e+1]=t>>>8):$(this,t,e,!0),e+2},_[a("0x16")][a("0x6e")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,2,32767,-32768),_[a("0x14")]?(this[e]=t>>>8,this[e+1]=255&t):$(this,t,e,!1),e+2},_[a("0x16")][a("0x6f")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,4,2147483647,-2147483648),_[a("0x14")]?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):q(this,t,e,!0),e+4},_[a("0x16")][a("0x70")]=function(t,e,r){return t=+t,e|=0,r||W(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),_[a("0x14")]?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):q(this,t,e,!1),e+4},_[a("0x16")].writeFloatLE=function(t,e,r){return K(this,t,e,!0,r)},_[a("0x16")][a("0x71")]=function(t,e,r){return K(this,t,e,!1,r)},_[a("0x16")].writeDoubleLE=function(t,e,r){return Z(this,t,e,!0,r)},_[a("0x16")][a("0x72")]=function(t,e,r){return Z(this,t,e,!1,r)},_[a("0x16")][a("0x43")]=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t[a("0x7")]||0===this[a("0x7")])return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this[a("0x7")]&&(n=this[a("0x7")]),t[a("0x7")]-e<n-r&&(n=t[a("0x7")]-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!_[a("0x14")])for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array[a("0x16")].set[a("0x13")](t,this.subarray(r,r+o),e);return o},_[a("0x16")][a("0x3e")]=function(t,e,r,n){if(a("0x1b")==typeof t){if(a("0x1b")==typeof e?(n=e,e=0,r=this[a("0x7")]):a("0x1b")==typeof r&&(n=r,r=this[a("0x7")]),1===t[a("0x7")]){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&a("0x1b")!=typeof n)throw new TypeError("encoding must be a string");if(a("0x1b")==typeof n&&!_.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else a("0x17")==typeof t&&(t&=255);if(e<0||this[a("0x7")]<e||this[a("0x7")]<r)throw new RangeError(a("0x73"));if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this[a("0x7")]:r>>>0,t||(t=0),a("0x17")==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=E(t)?t:Q(new _(t,n)[a("0x10")]()),u=s[a("0x7")];for(o=0;o<r-e;++o)this[o+e]=s[o%u]}return this};var Y=/[^+\/0-9A-Za-z-_]/g;function J(t){return t<16?"0"+t[a("0x10")](16):t.toString(16)}function Q(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if((r=t[a("0x8")](s))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o[a("0x9")](239,191,189);continue}if(s+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o[a("0x9")](239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o[a("0x9")](239,191,189);if(i=null,r<128){if((e-=1)<0)break;o[a("0x9")](r)}else if(r<2048){if((e-=2)<0)break;o[a("0x9")](r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error(a("0x74"));if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function tt(t){return function(t){var e,r,n,i,c,h;u||l();var f=t[a("0x7")];if(f%4>0)throw new Error("Invalid string. Length must be a multiple of 4");h=new s(3*f/4-(c="="===t[f-2]?2:"="===t[f-1]?1:0)),n=c>0?f-4:f;var d=0;for(e=0,r=0;e<n;e+=4,r+=3)i=o[t.charCodeAt(e)]<<18|o[t[a("0x8")](e+1)]<<12|o[t[a("0x8")](e+2)]<<6|o[t.charCodeAt(e+3)],h[d++]=i>>16&255,h[d++]=i>>8&255,h[d++]=255&i;return 2===c?(i=o[t.charCodeAt(e)]<<2|o[t[a("0x8")](e+1)]>>4,h[d++]=255&i):1===c&&(i=o[t[a("0x8")](e)]<<10|o[t.charCodeAt(e+1)]<<4|o[t.charCodeAt(e+2)]>>2,h[d++]=i>>8&255,h[d++]=255&i),h}(function(t){if((t=function(t){return t[a("0x75")]?t[a("0x75")]():t[a("0x76")](/^\s+|\s+$/g,"")}(t).replace(Y,""))[a("0x7")]<2)return"";for(;t[a("0x7")]%4!=0;)t+="=";return t}(t))}function et(t,e,r,n){for(var i=0;i<n&&!(i+r>=e[a("0x7")]||i>=t.length);++i)e[i+r]=t[i];return i}function rt(t){return null!=t&&(!!t._isBuffer||nt(t)||function(t){return a("0x0")==typeof t[a("0x62")]&&a("0x0")==typeof t[a("0x1f")]&&nt(t[a("0x1f")](0,0))}(t))}function nt(t){return!!t[a("0x77")]&&a("0x0")==typeof t[a("0x77")][a("0x78")]&&t[a("0x77")][a("0x78")](t)}var it=Object[a("0x79")]({__proto__:null,Buffer:_,INSPECT_MAX_BYTES:50,SlowBuffer:function(t){return+t!=t&&(t=0),_[a("0x3d")](+t)},isBuffer:rt,kMaxLength:v}),at=function(t,e){return function(r,n){var i=2*n,a=2*e;r[i]=t[a],r[i+1]=t[a+1]}},ot=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0;var r,n=(r=at)&&r[a("0x3")]?r:{default:r};e.default=function(t){for(var e=t.A,r=t.C,i=0;i<25;i+=5){for(var o=0;o<5;o++)(0,n[a("0x5")])(e,i+o)(r,o);for(var s=0;s<5;s++){var u=2*(i+s),l=(s+1)%5*2,c=(s+2)%5*2;e[u]^=~r[l]&r[c],e[u+1]^=~r[l+1]&r[c+1]}}}}));e(ot);var st=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e.default=void 0;var r=new Uint32Array([0,1,0,32898,2147483648,32906,2147483648,2147516416,0,32907,0,2147483649,2147483648,2147516545,2147483648,32777,0,138,0,136,0,2147516425,0,2147483658,0,2147516555,2147483648,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,0,32778,2147483648,2147483658,2147483648,2147516545,2147483648,32896,0,2147483649,2147483648,2147516424]);e[a("0x5")]=r}));e(st);var ut=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0;var r,n=(r=st)&&r[a("0x3")]?r:{default:r};e[a("0x5")]=function(t){var e=t.A,r=2*t[a("0x7b")];e[0]^=n[a("0x5")][r],e[1]^=n[a("0x5")][r+1]}}));e(ut);var lt=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e.default=void 0,e[a("0x5")]=[10,7,11,17,18,3,5,16,8,21,24,4,15,23,19,13,12,2,20,14,22,9,6,1]}));e(lt);var ct=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0,e.default=[1,3,6,10,15,21,28,36,45,55,2,14,27,41,56,8,25,43,62,18,39,61,20,44]}));e(ct);var ht=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0;var r=o(lt),n=o(ct),i=o(at);function o(t){return t&&t.__esModule?t:{default:t}}e[a("0x5")]=function(t){var e=t.A,o=t.C,s=t.W;(0,i[a("0x5")])(e,1)(s,0);for(var u=0,l=0,c=0,h=32,f=0;f<24;f++){var d=r.default[f],p=n[a("0x5")][f];(0,i.default)(e,d)(o,0),s[c=p<32?0:1]=(u=s[0])<<p|(l=s[1])>>>(h=32-p),s[(c+1)%2]=l<<p|u>>>h,(0,i[a("0x5")])(s,0)(e,d),(0,i[a("0x5")])(o,0)(s,0)}}}));e(ht);var ft=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0;var r,n=(r=at)&&r[a("0x3")]?r:{default:r};e[a("0x5")]=function(t){for(var e=t.A,r=t.C,i=t.D,o=t.W,s=0,u=0,l=0;l<5;l++){var c=2*l,h=2*(l+5),f=2*(l+10),d=2*(l+15),p=2*(l+20);r[c]=e[c]^e[h]^e[f]^e[d]^e[p],r[c+1]=e[c+1]^e[h+1]^e[f+1]^e[d+1]^e[p+1]}for(var m=0;m<5;m++){(0,n[a("0x5")])(r,(m+1)%5)(o,0),o[0]=(s=o[0])<<1|(u=o[1])>>>31,o[1]=u<<1|s>>>31,i[2*m]=r[(m+4)%5*2]^o[0],i[2*m+1]=r[(m+4)%5*2+1]^o[1];for(var v=0;v<25;v+=5)e[2*(v+m)]^=i[2*m],e[2*(v+m)+1]^=i[2*m+1]}}}));e(ft);var dt=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=void 0;var r=s(ot),n=s(ut),i=s(ht),o=s(ft);function s(t){return t&&t[a("0x3")]?t:{default:t}}e[a("0x5")]=function(){var t=new Uint32Array(10),e=new Uint32Array(10),s=new Uint32Array(2);return function(u){for(var l=0;l<24;l++)(0,o.default)({A:u,C:t,D:e,W:s}),(0,i.default)({A:u,C:t,W:s}),(0,r[a("0x5")])({A:u,C:t}),(0,n[a("0x5")])({A:u,roundIndex:l});t.fill(0),e[a("0x3e")](0),s[a("0x3e")](0)}}}));e(dt);var pt=r((function(t,e){Object[a("0x7a")](e,"__esModule",{value:!0}),e[a("0x5")]=void 0;var r,n=(r=dt)&&r[a("0x3")]?r:{default:r},i=function(t,e){for(var r=0;r<t[a("0x7")];r+=8){var n=r/4;e[n]^=t[r+7]<<24|t[r+6]<<16|t[r+5]<<8|t[r+4],e[n+1]^=t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]}return e},o=function(t,e){for(var r=0;r<e[a("0x7")];r+=8){var n=r/4;e[r]=t[n+1],e[r+1]=t[n+1]>>>8,e[r+2]=t[n+1]>>>16,e[r+3]=t[n+1]>>>24,e[r+4]=t[n],e[r+5]=t[n]>>>8,e[r+6]=t[n]>>>16,e[r+7]=t[n]>>>24}return e};e[a("0x5")]=function(t){var e=this,r=t[a("0x7c")],s=t[a("0x7d")],u=(0,n.default)(),l=r/8,c=200-r/4,h=0,f=new Uint32Array(50),d=it[a("0x20")][a("0x7e")](c);return this[a("0x7f")]=function(t){for(var r=0;r<t.length;r++)d[h]=t[r],(h+=1)>=c&&(i(d,f),u(f),h=0);return e},this[a("0x80")]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={buffer:t[a("0x81")]||it[a("0x20")][a("0x7e")](l),padding:t.padding||s,queue:it[a("0x20")][a("0x7e")](d[a("0x7")]),state:new Uint32Array(f[a("0x7")])};d[a("0x43")](e.queue);for(var r=0;r<f[a("0x7")];r++)e[a("0x82")][r]=f[r];e[a("0x83")].fill(0,h),e[a("0x83")][h]|=e.padding,e.queue[c-1]|=128,i(e[a("0x83")],e.state);for(var n=0;n<e[a("0x81")][a("0x7")];n+=c)u(e.state),o(e[a("0x82")],e[a("0x81")][a("0x1f")](n,n+c));return e.buffer},this[a("0x84")]=function(){return d[a("0x3e")](0),f[a("0x3e")](0),h=0,e},this}}));e(pt);var mt=r((function(t,e){Object[a("0x7a")](e,a("0x3"),{value:!0}),e[a("0x5")]=e[a("0x85")]=e.SHA3Hash=e[a("0x86")]=e[a("0x87")]=void 0;var r,n=(r=pt)&&r.__esModule?r:{default:r},i=function(t){var e=t.allowedSizes,r=t[a("0x88")],i=t.padding;return function t(){var o=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;if(!this||this.constructor!==t)return new t(s);if(e&&!e.includes(s))throw new Error("Unsupported hash length");var u=new(n[a("0x5")])({capacity:s});return this[a("0x89")]=function(t){var e=arguments[a("0x7")]>1&&void 0!==arguments[1]?arguments[1]:a("0x1c");if(it[a("0x20")].isBuffer(t))return u[a("0x7f")](t),o;if(a("0x1b")==typeof t)return o[a("0x89")](it[a("0x20")].from(t,e));throw new TypeError(a("0x8a"))},this.digest=function(){var t=arguments[a("0x7")]>0&&void 0!==arguments[0]?arguments[0]:"binary",e="string"==typeof t?{format:t}:t,r=u[a("0x80")]({buffer:e[a("0x81")],padding:e[a("0x7d")]||i});return e[a("0x8b")]&&a("0x29")!==e.format?r[a("0x10")](e[a("0x8b")]):r},this[a("0x84")]=function(){return u[a("0x84")](),o},this}},o=i({allowedSizes:[224,256,384,512],defaultSize:512,padding:1});e[a("0x87")]=o;var s=i({allowedSizes:[224,256,384,512],defaultSize:512,padding:6});e[a("0x86")]=s;var u=i({allowedSizes:[128,256],defaultSize:256,padding:31});e[a("0x85")]=u;var l=o;e.SHA3Hash=l,s[a("0x8c")]=l;var c=s;e[a("0x5")]=c})),vt=e(mt);a("0x85"),a("0x86"),a("0x87");var gt,yt,_t=[a("0x8d"),a("0x1f"),"join",a("0x4b"),a("0x8e"),a("0x39"),a("0x8f"),a("0x89"),"toString",a("0x2d"),a("0x90")];gt=_t,yt=380,function(t){for(;--t;)gt[a("0x9")](gt.shift())}(++yt);var bt=function(t,e){return _t[t-=0]};function xt(t){return btoa(t.match(/\w{2}/g)[bt(a("0x91"))]((function(t){return String[bt(a("0x92"))](parseInt(t,16))}))[bt("0x7")](""))}t.f1=function(t){if(a("0x93")===t)return bt(a("0x94"));var e=new vt(512);e[bt(a("0x95"))](t[bt(a("0x96"))](bt("0x3")));var r=e[bt(a("0x97"))](bt("0x3")).match(/[\s\S]{1,2}/g)||[];return r[bt(a("0x98"))](),xt(r[bt(a("0x99"))](0,16)[bt("0x7")](""))},t.f2=function(t){var e=new vt(512);e[bt(a("0x95"))](t[bt(a("0x96"))]("hex"));var r=e[bt("0x4")](bt(a("0x9a")))[bt(a("0x9b"))](/[\s\S]{1,2}/g)||[];return r[bt("0x5")](),xt(r[bt(a("0x99"))](0,32)[bt(a("0x9c"))](""))},t.f3=function(t){var e=new vt(256);e[bt(a("0x95"))](t[bt("0x2")](bt(a("0x9a"))));var r=e[bt(a("0x97"))](a("0x2d"))[bt(a("0x9b"))](/[\s\S]{1,2}/g)||[];return r[a("0x8d")](),xt(r[bt(a("0x99"))](8,24)[bt(a("0x9c"))](""))},Object[a("0x7a")](t,a("0x3"),{value:!0})}(e)}));!function(t){t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")}(At);var Et=At.f1,St=484813681109536e-20,Tt=Math.PI/2,Ct=.017453292519943295,Ot=57.29577951308232,Pt=Math.PI/4,Lt=2*Math.PI,It=3.14159265359,kt={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Rt={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Dt=/[\s_\-\/\(\)]/g;function Bt(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(Dt,""),a=-1;++a<n.length;)if((r=n[a]).toLowerCase().replace(Dt,"")===i)return t[r]}function Ft(t){var e,r,n,i={},a=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t}),{}),o={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t)},lat_0:function(t){i.lat0=t*Ct},lat_1:function(t){i.lat1=t*Ct},lat_2:function(t){i.lat2=t*Ct},lat_ts:function(t){i.lat_ts=t*Ct},lon_0:function(t){i.long0=t*Ct},lon_1:function(t){i.long1=t*Ct},lon_2:function(t){i.long2=t*Ct},alpha:function(t){i.alpha=parseFloat(t)*Ct},gamma:function(t){i.rectified_grid_angle=parseFloat(t)},lonc:function(t){i.longc=t*Ct},x_0:function(t){i.x0=parseFloat(t)},y_0:function(t){i.y0=parseFloat(t)},k_0:function(t){i.k0=parseFloat(t)},k:function(t){i.k0=parseFloat(t)},a:function(t){i.a=parseFloat(t)},b:function(t){i.b=parseFloat(t)},r_a:function(){i.R_A=!0},zone:function(t){i.zone=parseInt(t,10)},south:function(){i.utmSouth=!0},towgs84:function(t){i.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){i.to_meter=parseFloat(t)},units:function(t){i.units=t;var e=Bt(Rt,t);e&&(i.to_meter=e.to_meter)},from_greenwich:function(t){i.from_greenwich=t*Ct},pm:function(t){var e=Bt(kt,t);i.from_greenwich=(e||parseFloat(t))*Ct},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(i.axis=t)},approx:function(){i.approx=!0}};for(e in a)r=a[e],e in o?"function"==typeof(n=o[e])?n(r):i[n]=r:i[e]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var jt=/\s/,Nt=/[A-Za-z]/,Ut=/[A-Za-z84_]/,zt=/[,\]]/,Gt=/[\d\.E\-\+]/;function Vt(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function Ht(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=r.reduce((function(t,e){return Wt(e,t),t}),e?{}:t);e&&(t[e]=n)}function Wt(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void Wt(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var n;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&Wt(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&Wt(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void Ht(e,r,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return Wt(t,e[r]);return Ht(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}function $t(t){return.017453292519943295*t}function qt(t){var e=new Vt(t).output(),r=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",r]);var i={};return Wt(e,i),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):t.projName="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION,t.AXIS){for(var e="",r=0,n=t.AXIS.length;r<n;++r){var i=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?e+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?e+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?e+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(t.datumCode=a.DATUM?a.DATUM.name.toLowerCase():a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",$t],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",$t],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",$t],["lat0","latitude_of_origin",$t],["lat0","standard_parallel_1",$t],["lat1","standard_parallel_1",$t],["lat2","standard_parallel_2",$t],["azimuth","Azimuth"],["alpha","azimuth",$t],["srsCode","name"]].forEach((function(e){return function(t,e){var r=e[0],n=e[1];!(r in t)&&n in t&&(t[r]=t[n],3===e.length&&(t[r]=e[2](t[r])))}(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=$t(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(i),i}function Xt(t){var e=this;if(2===arguments.length){var r=arguments[1];Xt[t]="string"==typeof r?"+"===r.charAt(0)?Ft(arguments[1]):qt(arguments[1]):r}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?Xt.apply(e,t):Xt(t)}));if("string"==typeof t){if(t in Xt)return Xt[t]}else"EPSG"in t?Xt["EPSG:"+t.EPSG]=t:"ESRI"in t?Xt["ESRI:"+t.ESRI]=t:"IAU2000"in t?Xt["IAU2000:"+t.IAU2000]=t:console.log(t);return}}Vt.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;jt.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},Vt.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(zt.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Vt.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Vt.prototype.number=function(t){if(!Gt.test(t)){if(zt.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},Vt.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},Vt.prototype.keyword=function(t){if(Ut.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=1)}if(!zt.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},Vt.prototype.neutral=function(t){if(Nt.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(Gt.test(t))return this.word=t,void(this.state=3);if(!zt.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},Vt.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)},function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(Xt);var Kt=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Zt=["3857","900913","3785","102113"];function Yt(t,e){var r,n;if(t=t||{},!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t}function Jt(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)}function Qt(t){return t<0?-1:1}function te(t){return Math.abs(t)<=It?t:t-Qt(t)*Lt}function ee(t,e,r){var n=t*r;return n=Math.pow((1-n)/(1+n),.5*t),Math.tan(.5*(Tt-e))/n}function re(t,e){for(var r,n,i=.5*t,a=Tt-2*Math.atan(e),o=0;o<=15;o++)if(r=t*Math.sin(a),a+=n=Tt-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-a,Math.abs(n)<=1e-10)return a;return-9999}function ne(t){return t}var ie=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):Jt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1)},forward:function(t){var e,r,n=t.x,i=t.y;if(i*Ot>90&&i*Ot<-90&&n*Ot>180&&n*Ot<-180)return null;if(Math.abs(Math.abs(i)-Tt)<=1e-10)return null;if(this.sphere)e=this.x0+this.a*this.k0*te(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Pt+.5*i));else{var a=Math.sin(i),o=ee(this.e,i,a);e=this.x0+this.a*this.k0*te(n-this.long0),r=this.y0-this.a*this.k0*Math.log(o)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=Tt-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var a=Math.exp(-i/(this.a*this.k0));if(-9999===(r=re(this.e,a)))return null}return e=te(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:ne,inverse:ne,names:["longlat","identity"]}],ae={},oe=[];function se(t,e){var r=oe.length;return t.names?(oe[r]=t,t.names.forEach((function(t){ae[t.toLowerCase()]=r})),this):(console.log(e),!0)}var ue={start:function(){ie.forEach(se)},add:se,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==ae[e]&&oe[ae[e]]?oe[ae[e]]:void 0}},le={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ce=le.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};le.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var he={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},fe={};function de(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:fe[t]||null,isNull:!1}}function pe(t){return t/3600*Math.PI/180}function me(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function ve(t){return t.map((function(t){return[pe(t.longitudeShift),pe(t.latitudeShift)]}))}function ge(t,e,r){return{name:me(t,e+8,e+16).trim(),parent:me(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function ye(t,e,r,n){for(var i=e+176,a=[],o=0;o<r.gridNodeCount;o++){var s={latitudeShift:t.getFloat32(i+16*o,n),longitudeShift:t.getFloat32(i+16*o+4,n),latitudeAccuracy:t.getFloat32(i+16*o+8,n),longitudeAccuracy:t.getFloat32(i+16*o+12,n)};a.push(s)}return a}function _e(t,e){if(!(this instanceof _e))return new _e(t);e=e||function(t){if(t)throw t};var r=function(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in Xt}(t))return Xt[t];if(function(t){return Kt.some((function(e){return t.indexOf(e)>-1}))}(t)){var e=qt(t);if(function(t){var e=Bt(t,"authority");if(e){var r=Bt(e,"epsg");return r&&Zt.indexOf(r)>-1}}(e))return Xt["EPSG:3857"];var r=function(t){var e=Bt(t,"extension");if(e)return Bt(e,"proj4")}(e);return r?Ft(r):e}return function(t){return"+"===t[0]}(t)?Ft(t):void 0}(t);if("object"==typeof r){var n=_e.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=Bt(he,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var a,o,s,u,l,c,h=function(t,e,r,n,i){if(!t){var a=Bt(le,n);a||(a=ce),t=a.a,e=a.b,r=a.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<1e-10)&&(i=!0,e=t),{a:t,b:e,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),f=(l=((s=(a=h.a)*a)-(u=(o=h.b)*o))/s,c=0,r.R_A?(s=(a*=1-l*(.16666666666666666+l*(.04722222222222222+.022156084656084655*l)))*a,l=0):c=Math.sqrt(l),{es:l,e:c,ep2:(s-u)/u}),d=function(t){return void 0===t?null:t.split(",").map(de)}(r.nadgrids),p=r.datum||function(t,e,r,n,i,a,o){var s={};return s.datum_type=void 0===t||"none"===t?5:4,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=1),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=2,s.datum_params[3]*=St,s.datum_params[4]*=St,s.datum_params[5]*=St,s.datum_params[6]=s.datum_params[6]/1e6+1))),o&&(s.datum_type=3,s.grids=o),s.a=r,s.b=n,s.es=i,s.ep2=a,s}(r.datumCode,r.datum_params,h.a,h.b,f.es,f.ep2,d);Yt(this,r),Yt(this,n),this.a=h.a,this.b=h.b,this.rf=h.rf,this.sphere=h.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=p,this.init(),e(null,this)}else e(t)}else e(t)}function be(t,e,r){var n,i,a,o=t.x,s=t.y,u=t.z?t.z:0;if(s<-Tt&&s>-1.001*Tt)s=-Tt;else if(s>Tt&&s<1.001*Tt)s=Tt;else{if(s<-Tt)return{x:-1/0,y:-1/0,z:t.z};if(s>Tt)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),i=Math.sin(s),a=Math.cos(s),{x:((n=r/Math.sqrt(1-e*(i*i)))+u)*a*Math.cos(o),y:(n+u)*a*Math.sin(o),z:(n*(1-e)+u)*i}}function xe(t,e,r,n){var i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_=t.x,b=t.y,x=t.z?t.z:0;if(i=Math.sqrt(_*_+b*b),a=Math.sqrt(_*_+b*b+x*x),i/r<1e-12){if(g=0,a/r<1e-12)return y=-n,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(b,_);o=x/a,h=(s=i/a)*(1-e)*(u=1/Math.sqrt(1-e*(2-e)*s*s)),f=o*u,v=0;do{v++,l=e*(c=r/Math.sqrt(1-e*f*f))/(c+(y=i*h+x*f-c*(1-e*f*f))),m=(p=o*(u=1/Math.sqrt(1-l*(2-l)*s*s)))*h-(d=s*(1-l)*u)*f,h=d,f=p}while(m*m>1e-24&&v<30);return{x:g,y:Math.atan(p/Math.abs(d)),z:y}}function we(t){return 1===t||2===t}function Me(t,e,r){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},a=[],o=0;o<t.grids.length;o++){var s=t.grids[o];if(a.push(s.name),s.isNull){i=n;break}if(null!==s.grid){var u=s.grid.subgrids[0],l=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4;if(!(u.ll[1]-l>n.y||u.ll[0]-l>n.x||u.ll[1]+(u.lim[1]-1)*u.del[1]+l<n.y||u.ll[0]+(u.lim[0]-1)*u.del[0]+l<n.x||(i=Ae(n,e,u),isNaN(i.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*Ot+" "+n.y*Ot+" tried: '"+a+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function Ae(t,e,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return n;var i={x:t.x,y:t.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=te(i.x-Math.PI)+Math.PI;var a=Ee(i,r);if(e){if(isNaN(a.x))return n;a.x=i.x-a.x,a.y=i.y-a.y;var o,s,u=9;do{if(s=Ee(a,r),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a.x+=(o={x:i.x-(s.x+a.x),y:i.y-(s.y+a.y)}).x,a.y+=o.y}while(u--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(u<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=te(a.x+r.ll[0]),n.y=a.y+r.ll[1]}else isNaN(a.x)||(n.x=t.x+a.x,n.y=t.y+a.y);return n}function Ee(t,e){var r,n={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(n.x),a=Math.floor(n.y),o=n.x-1*i,s=n.y-1*a,u={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return u;if(a<0||a>=e.lim[1])return u;var l=e.cvs[r=a*e.lim[0]+i][0],c=e.cvs[r][1];r++;var h=e.cvs[r][0],f=e.cvs[r][1],d=e.cvs[r+=e.lim[0]][0],p=e.cvs[r][1];r--;var m=e.cvs[r][1],v=o*s,g=o*(1-s),y=(1-o)*(1-s),_=(1-o)*s;return u.x=y*l+g*h+_*e.cvs[r][0]+v*d,u.y=y*c+g*f+_*m+v*p,u}function Se(t,e,r){var n,i,a,o=r.x,s=r.y,u=r.z||0,l={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==r.z)switch(0===a?(n=o,i=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(n=s,i=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(n=u,i="z"),t.axis[a]){case"e":case"n":l[i]=n;break;case"w":case"s":l[i]=-n;break;case"u":void 0!==r[i]&&(l.z=n);break;case"d":void 0!==r[i]&&(l.z=-n);break;default:return null}return l}function Te(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function Ce(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Oe(t,e,r,n){var i;if(Array.isArray(r)&&(r=Te(r)),function(t){Ce(t.x),Ce(t.y)}(r),t.datum&&e.datum&&function(t,e){return(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==e.datumCode||(1===e.datum.datum_type||2===e.datum.datum_type)&&"WGS84"!==t.datumCode}(t,e)&&(r=Oe(t,i=new _e("WGS84"),r,n),t=i),n&&"enu"!==t.axis&&(r=Se(t,!1,r)),"longlat"===t.projName)r={x:r.x*Ct,y:r.y*Ct,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=function(t,e,r){if(function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:2!==t.datum_type||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e))return r;if(5===t.datum_type||5===e.datum_type)return r;var n=t.a,i=t.es;if(3===t.datum_type){if(0!==Me(t,!1,r))return;n=6378137,i=.0066943799901413165}var a=e.a,o=e.b,s=e.es;return 3===e.datum_type&&(a=6378137,o=6356752.314,s=.0066943799901413165),i!==s||n!==a||we(t.datum_type)||we(e.datum_type)?(r=be(r,i,n),we(t.datum_type)&&(r=function(t,e,r){if(1===e)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(2===e){var n=r[3],i=r[4],a=r[5],o=r[6];return{x:o*(t.x-a*t.y+i*t.z)+r[0],y:o*(a*t.x+t.y-n*t.z)+r[1],z:o*(-i*t.x+n*t.y+t.z)+r[2]}}}(r,t.datum_type,t.datum_params)),we(e.datum_type)&&(r=function(t,e,r){if(1===e)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(2===e){var n=r[3],i=r[4],a=r[5],o=r[6],s=(t.x-r[0])/o,u=(t.y-r[1])/o,l=(t.z-r[2])/o;return{x:s+a*u-i*l,y:-a*s+u+n*l,z:i*s-n*u+l}}}(r,e.datum_type,e.datum_params)),r=xe(r,s,a,o),3!==e.datum_type||0===Me(e,!0,r)?r:void 0):r}(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*Ot,y:r.y*Ot,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),n&&"enu"!==e.axis?Se(e,!0,r):r}(_e.projections=ue).start();var Pe=_e("WGS84");function Le(t,e,r,n){var i,a,o;return Array.isArray(r)?(i=Oe(t,e,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(a=Oe(t,e,r,n),2===(o=Object.keys(r)).length||o.forEach((function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;a[n]=r[n]})),a)}function Ie(t){return t instanceof _e?t:t.oProj?t.oProj:_e(t)}function ke(t,e,r){t=Ie(t);var n,i=!1;return void 0===e?(e=t,t=Pe,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=Pe,i=!0),e=Ie(e),r?Le(t,e,r):(n={forward:function(r,n){return Le(t,e,r,n)},inverse:function(r,n){return Le(e,t,r,n)}},i&&(n.oProj=e),n)}var Re=65,De=73,Be=79,Fe={forward:je,inverse:function(t){var e=Ge(He(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:Ne};function je(t,e){return e=e||5,function(t,e){var r,n,i,a,o,s,u,l,c,h,f,d="00000"+t.easting,p="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(c=t.easting,h=t.northing,f=Ve(t.zoneNumber),r=Math.floor(c/1e5),n=Math.floor(h/1e5)%20,a="AJSAJS".charCodeAt(i=f-1),o="AFAFAF".charCodeAt(i),l=!1,(s=a+r-1)>90&&(s=s-90+Re-1,l=!0),(s===De||a<De&&s>De||(s>De||a<De)&&l)&&s++,(s===Be||a<Be&&s>Be||(s>Be||a<Be)&&l)&&++s===De&&s++,s>90&&(s=s-90+Re-1),(u=o+n)>86?(u=u-86+Re-1,l=!0):l=!1,(u===De||o<De&&u>De||(u>De||o<De)&&l)&&u++,(u===Be||o<Be&&u>Be||(u>Be||o<Be)&&l)&&++u===De&&u++,u>86&&(u=u-86+Re-1),String.fromCharCode(s)+String.fromCharCode(u))+d.substr(d.length-5,e)+p.substr(p.length-5,e)}(function(t){var e,r,n,i,a,o,s=t.lat,u=t.lon,l=6378137,c=Ue(s),h=Ue(u);o=Math.floor((u+180)/6)+1,180===u&&(o=60),s>=56&&s<64&&u>=3&&u<12&&(o=32),s>=72&&s<84&&(u>=0&&u<9?o=31:u>=9&&u<21?o=33:u>=21&&u<33?o=35:u>=33&&u<42&&(o=37)),a=Ue(6*(o-1)-180+3),e=l/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),r=Math.tan(c)*Math.tan(c),n=.006739496752268451*Math.cos(c)*Math.cos(c);var f,d,p=.9996*e*((i=Math.cos(c)*(h-a))+(1-r+n)*i*i*i/6+(5-18*r+r*r+72*n-.39089081163157013)*i*i*i*i*i/120)+5e5,m=.9996*(l*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c))+e*Math.tan(c)*(i*i/2+(5-r+9*n+4*n*n)*i*i*i*i/24+(61-58*r+r*r+600*n-2.2240339282485886)*i*i*i*i*i*i/720));return s<0&&(m+=1e7),{northing:Math.round(m),easting:Math.round(p),zoneNumber:o,zoneLetter:(f=s,d="Z",84>=f&&f>=72?d="X":72>f&&f>=64?d="W":64>f&&f>=56?d="V":56>f&&f>=48?d="U":48>f&&f>=40?d="T":40>f&&f>=32?d="S":32>f&&f>=24?d="R":24>f&&f>=16?d="Q":16>f&&f>=8?d="P":8>f&&f>=0?d="N":0>f&&f>=-8?d="M":-8>f&&f>=-16?d="L":-16>f&&f>=-24?d="K":-24>f&&f>=-32?d="J":-32>f&&f>=-40?d="H":-40>f&&f>=-48?d="G":-48>f&&f>=-56?d="F":-56>f&&f>=-64?d="E":-64>f&&f>=-72?d="D":-72>f&&f>=-80&&(d="C"),d)}}({lat:t[1],lon:t[0]}),e)}function Ne(t){var e=Ge(He(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Ue(t){return t*(Math.PI/180)}function ze(t){return t/Math.PI*180}function Ge(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var a,o,s,u,l,c,h,f,d=6378137,p=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),m=r-5e5,v=e;n<"N"&&(v-=1e7),c=6*(i-1)-180+3,f=(h=v/.9996/6367449.145945056)+(3*p/2-27*p*p*p/32)*Math.sin(2*h)+(21*p*p/16-55*p*p*p*p/32)*Math.sin(4*h)+151*p*p*p/96*Math.sin(6*h),a=d/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),o=Math.tan(f)*Math.tan(f),s=.006739496752268451*Math.cos(f)*Math.cos(f),u=.99330562*d/Math.pow(1-.00669438*Math.sin(f)*Math.sin(f),1.5),l=m/(.9996*a);var g=f-a*Math.tan(f)/u*(l*l/2-(5+3*o+10*s-4*s*s-.06065547077041606)*l*l*l*l/24+(61+90*o+298*s+45*o*o-1.6983531815716497-3*s*s)*l*l*l*l*l*l/720);g=ze(g);var y,_=(l-(1+2*o+s)*l*l*l/6+(5-2*s+28*o-3*s*s+.05391597401814761+24*o*o)*l*l*l*l*l/120)/Math.cos(f);if(_=c+ze(_),t.accuracy){var b=Ge({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});y={top:b.lat,right:b.lon,bottom:g,left:_}}else y={lat:g,lon:_};return y}function Ve(t){var e=t%6;return 0===e&&(e=6),e}function He(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,a++}var o=parseInt(i,10);if(0===a||a+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(a,a+=2);for(var u=Ve(o),l=function(t,e){for(var r="AJSAJS".charCodeAt(e-1),n=1e5,i=!1;r!==t.charCodeAt(0);){if(++r===De&&r++,r===Be&&r++,r>90){if(i)throw"Bad character: "+t;r=Re,i=!0}n+=1e5}return n}(n.charAt(0),u),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r="AFAFAF".charCodeAt(e-1),n=0,i=!1;r!==t.charCodeAt(0);){if(++r===De&&r++,r===Be&&r++,r>86){if(i)throw"Bad character: "+t;r=Re,i=!0}n+=1e5}return n}(n.charAt(1),u);c<We(s);)c+=2e6;var h=r-a;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var f,d,p,m=h/2,v=0,g=0;return m>0&&(f=1e5/Math.pow(10,m),d=t.substring(a,a+m),v=parseFloat(d)*f,p=t.substring(a+m),g=parseFloat(p)*f),{easting:v+l,northing:g+c,zoneLetter:s,zoneNumber:o,accuracy:f}}function We(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function $e(t,e,r){if(!(this instanceof $e))return new $e(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}$e.fromMGRS=function(t){return new $e(Ne(t))},$e.prototype.toMGRS=function(t){return je([this.x,this.y],t)};var qe=.01068115234375;function Xe(t){var e=[];e[0]=1-t*(.25+t*(.046875+t*(.01953125+t*qe))),e[1]=t*(.75-t*(.046875+t*(.01953125+t*qe)));var r=t*t;return e[2]=r*(.46875-t*(.013020833333333334+.007120768229166667*t)),e[3]=(r*=t)*(.3645833333333333-.005696614583333333*t),e[4]=r*t*.3076171875,e}function Ke(t,e,r,n){return n[0]*t-(r*=e)*(n[1]+(e*=e)*(n[2]+e*(n[3]+e*n[4])))}function Ze(t,e,r){for(var n=1/(1-e),i=t,a=20;a;--a){var o=Math.sin(i),s=1-e*o*o;if(i-=s=(Ke(i,o,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<1e-10)return i}return i}var Ye={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Xe(this.es),this.ml0=Ke(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,r,n,i=t.y,a=te(t.x-this.long0),o=Math.sin(i),s=Math.cos(i);if(this.es){var u=s*a,l=Math.pow(u,2),c=this.ep2*Math.pow(s,2),h=Math.pow(c,2),f=Math.abs(s)>1e-10?Math.tan(i):0,d=Math.pow(f,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2),u/=Math.sqrt(e);var m=Ke(i,o,s,this.en);r=this.a*(this.k0*u*(1+l/6*(1-d+c+l/20*(5-18*d+p+14*c-58*d*c+l/42*(61+179*p-p*d-479*d)))))+this.x0,n=this.a*(this.k0*(m-this.ml0+o*a*u/2*(1+l/12*(5-d+9*c+4*h+l/30*(61+p-58*d+270*c-330*d*c+l/56*(1385+543*p-p*d-3111*d))))))+this.y0}else{var v=s*Math.sin(a);if(Math.abs(Math.abs(v)-1)<1e-10)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=s*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>1e-10)return 93;n=0}else n=Math.acos(n);i<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t},inverse:function(t){var e,r,n,i,a=1/this.a*(t.x-this.x0),o=1/this.a*(t.y-this.y0);if(this.es)if(r=Ze(e=this.ml0+o/this.k0,this.es,this.en),Math.abs(r)<Tt){var s=Math.sin(r),u=Math.cos(r),l=Math.abs(u)>1e-10?Math.tan(r):0,c=this.ep2*Math.pow(u,2),h=Math.pow(c,2),f=Math.pow(l,2),d=Math.pow(f,2);e=1-this.es*Math.pow(s,2);var p=a*Math.sqrt(e)/this.k0,m=Math.pow(p,2);n=r-(e*=l)*m/(1-this.es)*.5*(1-m/12*(5+3*f-9*c*f+c-4*h-m/30*(61+90*f-252*c*f+45*d+46*c-m/56*(1385+3633*f+4095*d+1574*d*f)))),i=te(this.long0+p*(1-m/6*(1+2*f+c-m/20*(5+28*f+24*d+8*c*f+6*c-m/42*(61+662*f+1320*d+720*d*f))))/u)}else n=Tt*Qt(o),i=0;else{var v=Math.exp(a/this.k0),g=.5*(v-1/v),y=Math.cos(this.lat0+o/this.k0);e=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(g,2))),n=Math.asin(e),o<0&&(n=-n),i=0===g&&0===y?0:te(Math.atan2(g,y)+this.long0)}return t.x=i,t.y=n,t},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function Je(t){var e=Math.exp(t);return(e-1/e)/2}function Qe(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function tr(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return e+r*Math.sin(2*e)}function er(t,e,r){for(var n,i,a=Math.sin(e),o=Math.cos(e),s=Je(r),u=function(t){var e=Math.exp(t);return(e+1/e)/2}(r),l=2*o*u,c=-2*a*s,h=t.length-1,f=t[h],d=0,p=0,m=0;--h>=0;)n=p,i=d,f=l*(p=f)-n-c*(d=m)+t[h],m=c*p-i+l*d;return[(l=a*u)*f-(c=o*s)*m,l*m+c*f]}var rr={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ye.init.apply(this),this.forward=Ye.forward,this.inverse=Ye.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),this.cgb[1]=(r*=e)*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),this.cgb[2]=(r*=e)*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),this.cgb[3]=(r*=e)*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),this.cgb[4]=(r*=e)*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),this.cgb[5]=(r*=e)*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),this.utg[2]=(r*=e)*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),this.utg[3]=(r*=e)*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),this.utg[4]=(r*=e)*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),this.utg[5]=(r*=e)*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=tr(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return Math.sin(e)*r}(this.gtu,2*n))},forward:function(t){var e=te(t.x-this.long0),r=t.y;r=tr(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),a=Math.sin(e),o=Math.cos(e);r=Math.atan2(n,o*i),e=Math.atan2(a*i,Qe(n,i*o)),e=function(t){var e=Math.abs(t);return e=function(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}(e*(1+e/(Qe(1,e)+1))),t<0?-e:e}(Math.tan(e));var s,u,l=er(this.gtu,2*r,2*e);return r+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,u=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,u=1/0),t.x=s,t.y=u,t},inverse:function(t){var e,r,n=1/this.a*(t.x-this.x0),i=1/this.a*(t.y-this.y0);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=er(this.utg,2*i,2*n);i+=a[0],n+=a[1],n=Math.atan(Je(n));var o=Math.sin(i),s=Math.cos(i),u=Math.sin(n),l=Math.cos(n);i=Math.atan2(o*l,Qe(u,l*s)),e=te((n=Math.atan2(u,l*s))+this.long0),r=tr(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"]},nr={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(te(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Ct,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,rr.init.apply(this),this.forward=rr.forward,this.inverse=rr.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function ir(t,e){return Math.pow((1-t)/(1+t),e)}var ar={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Pt)/(Math.pow(Math.tan(.5*this.lat0+Pt),this.C)*ir(this.e*t,this.ratexp))},forward:function(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+Pt),this.C)*ir(this.e*Math.sin(r),this.ratexp))-Tt,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+Pt)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*ir(this.e*Math.sin(t.y),-.5*this.e))-Tt,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null},names:["gauss"]},or={init:function(){ar.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,r,n,i;return t.x=te(t.x-this.long0),ar.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),t.x=(i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n))*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,r,n,i,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(a,this.R2);e=Math.sin(o),r=Math.cos(o),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,ar.inverse.apply(this,[t]),t.x=te(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},sr={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*(1+Qt(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=1e-10&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*this.cons*Jt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/ee(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Jt(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Tt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,r,n,i,a,o,s=t.x,u=t.y,l=Math.sin(u),c=Math.cos(u),h=te(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=1e-10&&Math.abs(u+this.lat0)<=1e-10?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(h)),t.x=this.a*e*c*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*l-this.sinlat0*c*Math.cos(h))+this.y0,t):(r=2*Math.atan(this.ssfn_(u,l,this.e))-Tt,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=1e-10?(a=ee(this.e,u*this.con,this.con*l),t.x=this.x0+(o=2*this.a*this.k0*a/this.cons)*Math.sin(s-this.long0),t.y=this.y0-this.con*o*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<1e-10?(e=2*this.a*this.k0/(1+i*Math.cos(h)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),t.x=e*i*Math.sin(h)+this.x0,t))},inverse:function(t){var e,r,n,i;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=1e-10?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),e=Math.abs(this.coslat0)<1e-10?te(this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y)):te(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=1e-10){if(a<=1e-10)return r=this.lat0,t.x=e=this.long0,t.y=r,t;t.x*=this.con,t.y*=this.con,r=this.con*re(this.e,a*this.cons/(2*this.a*this.k0)),e=this.con*te(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=1e-10?i=this.X0:(i=Math.asin(Math.cos(n)*this.sinX0+t.y*Math.sin(n)*this.cosX0/a),e=te(this.long0+Math.atan2(t.x*Math.sin(n),a*this.cosX0*Math.cos(n)-t.y*this.sinX0*Math.sin(n)))),r=-1*re(this.e,Math.tan(.5*(Tt+i)));return t.x=e,t.y=r,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,r){return e*=r,Math.tan(.5*(Tt+t))*Math.pow((1-e)/(1+e),.5*r)}},ur={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),a=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),u=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*s+this.alpha*a/2*u},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=2*(Math.atan(Math.exp(-this.alpha*(e+r)+this.K))-Math.PI/4),i=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(i))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(i));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t},inverse:function(t){for(var e=(t.x-this.x0)/this.R,r=2*(Math.atan(Math.exp((t.y-this.y0)/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(e)),i=Math.atan(Math.sin(e)/(Math.cos(this.b0)*Math.cos(e)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+i/this.alpha,o=0,s=n,u=-1e3,l=0;Math.abs(s-u)>1e-7;){if(++l>20)return;o=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(s))/2)),u=s,s=2*Math.atan(Math.exp(o))-Math.PI/2}return t.x=a,t.y=s,t},names:["somerc"]},lr={init:function(){var t,e,r,n,i,a,o,s,u,l,c,h,f,d=0,p=0,m=0,v=0,g=0,y=0,_=0;this.no_off=(f="object"==typeof(h=this).PROJECTION?Object.keys(h.PROJECTION)[0]:h.PROJECTION,"no_uoff"in h||"no_off"in h||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(f)),this.no_rot="no_rot"in this;var b=!1;"alpha"in this&&(b=!0);var x=!1;if("rectified_grid_angle"in this&&(x=!0),b&&(_=this.alpha),x&&(d=this.rectified_grid_angle*Ct),b||x)p=this.longc;else if(m=this.long1,g=this.lat1,v=this.long2,y=this.lat2,Math.abs(g-y)<=1e-7||(t=Math.abs(g))<=1e-7||Math.abs(t-Tt)<=1e-7||Math.abs(Math.abs(this.lat0)-Tt)<=1e-7||Math.abs(Math.abs(y)-Tt)<=1e-7)throw new Error;var w=1-this.es;e=Math.sqrt(w),Math.abs(this.lat0)>1e-10?(s=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*s*s,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/w),this.A=this.B*this.k0*e/t,(i=(n=this.B*e/(r*Math.sqrt(t)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(ee(this.e,this.lat0,s),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=i=1),b||x?(b?(c=Math.asin(Math.sin(_)/n),x||(d=_)):(c=d,_=Math.asin(n*Math.sin(c))),this.lam0=p-Math.asin(.5*(i-1/i)*Math.tan(c))/this.B):(a=Math.pow(ee(this.e,g,Math.sin(g)),this.B),o=Math.pow(ee(this.e,y,Math.sin(y)),this.B),i=this.E/a,u=(o-a)/(o+a),l=((l=this.E*this.E)-o*a)/(l+o*a),(t=m-v)<-Math.pi?v-=Lt:t>Math.pi&&(v+=Lt),this.lam0=te(.5*(m+v)-Math.atan(l*Math.tan(.5*this.B*(m-v))/u)/this.B),c=Math.atan(2*Math.sin(this.B*te(m-this.lam0))/(i-1/i)),d=_=Math.asin(n*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(d),this.cosrot=Math.cos(d),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(_))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(Pt-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(Pt+i))},forward:function(t){var e,r,n,i,a,o,s,u,l={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-Tt)>1e-10){if(e=.5*((a=this.E/Math.pow(ee(this.e,t.y,Math.sin(t.y)),this.B))-(o=1/a)),r=.5*(a+o),i=Math.sin(this.B*t.x),n=(e*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<1e-10)throw new Error;u=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*t.x),s=Math.abs(o)<1e-7?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,o)}else u=t.y>0?this.v_pole_n:this.v_pole_s,s=this.ArB*t.y;return this.no_rot?(l.x=s,l.y=u):(l.x=u*this.cosrot+(s-=this.u_0)*this.sinrot,l.y=s*this.cosrot-u*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l},inverse:function(t){var e,r,n,i,a,o,s,u={};if(t.x=1/this.a*(t.x-this.x0),t.y=1/this.a*(t.y-this.y0),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),a=.5*(n+1/n),s=((o=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/a,Math.abs(Math.abs(s)-1)<1e-10)u.x=0,u.y=s<0?-Tt:Tt;else{if(u.y=this.E/Math.sqrt((1+s)/(1-s)),u.y=re(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(i*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},cr={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<1e-10)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=Jt(this.e,e,r),i=ee(this.e,this.lat1,e),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=Jt(this.e,a,o),u=ee(this.e,this.lat2,a),l=ee(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>1e-10?Math.log(n/s)/Math.log(i/u):e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=1e-10&&(r=Qt(r)*(Tt-2e-10));var n,i,a=Math.abs(Math.abs(r)-Tt);if(a>1e-10)n=ee(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((a=r*this.ns)<=0)return null;i=0}var o=this.ns*te(e-this.long0);return t.x=this.k0*(i*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(o))+this.y0,t},inverse:function(t){var e,r,n,i,a,o=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+s*s),r=1):(e=-Math.sqrt(o*o+s*s),r=-1);var u=0;if(0!==e&&(u=Math.atan2(r*o,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=re(this.e,n)))return null}else i=-Tt;return a=te(u/this.ns+this.long0),t.x=a,t.y=i,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},hr={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,r,n,i,a,o,s,u=t.y,l=te(t.x-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-l*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),a=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(o)/1,t.x=s*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,r,n,i,a,o,s,u=t.x;t.x=t.y,t.y=u,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,o=e,s=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(s=1),o=t.y,l+=1}while(0===s&&l<15);return l>=15?null:t},names:["Krovak","krovak"]};function fr(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function dr(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function pr(t){return.375*t*(1+.25*t*(1+.46875*t))}function mr(t){return.05859375*t*t*(1+.75*t)}function vr(t){return t*t*t*(35/3072)}function gr(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)}function yr(t){return Math.abs(t)<Tt?t:t-Qt(t)*Math.PI}function _r(t,e,r,n,i){var a,o;a=t/e;for(var s=0;s<15;s++)if(a+=o=(t-(e*a-r*Math.sin(2*a)+n*Math.sin(4*a)-i*Math.sin(6*a)))/(e-2*r*Math.cos(2*a)+4*n*Math.cos(4*a)-6*i*Math.cos(6*a)),Math.abs(o)<=1e-10)return a;return NaN}var br={init:function(){this.sphere||(this.e0=dr(this.es),this.e1=pr(this.es),this.e2=mr(this.es),this.e3=vr(this.es),this.ml0=this.a*fr(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,r,n=t.x,i=t.y;if(n=te(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var a=Math.sin(i),o=Math.cos(i),s=gr(this.a,this.e,a),u=Math.tan(i)*Math.tan(i),l=n*Math.cos(i),c=l*l,h=this.es*o*o/(1-this.es);e=s*l*(1-c*u*(1/6-(8-u+8*h)*c/120)),r=this.a*fr(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*a/o*c*(.5+(5-u+6*h)*c/24)}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var a=i+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(a))}else{var o=_r(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Tt)<=1e-10)return t.x=this.long0,t.y=Tt,i<0&&(t.y*=-1),t;var s=gr(this.a,this.e,Math.sin(o)),u=s*s*s/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(o),2),c=n*this.a/s,h=c*c;e=o-s*Math.tan(o)/u*c*c*(.5-(1+3*l)*c*c/24),r=c*(1-h*(l/3+(1+3*l)*l*h/15))/Math.cos(o)}return t.x=te(r+this.long0),t.y=yr(e),t},names:["Cassini","Cassini_Soldner","cass"]};function xr(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var wr={init:function(){var t,e=Math.abs(this.lat0);if(this.mode=Math.abs(e-Tt)<1e-10?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<1e-10?this.EQUIT:this.OBLIQ,this.es>0)switch(this.qp=xr(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,r=[];return r[0]=.3333333333333333*t,r[0]+=.17222222222222222*(e=t*t),r[1]=.06388888888888888*e,r[0]+=.10257936507936508*(e*=t),r[1]+=.0664021164021164*e,r[2]=.016415012942191543*e,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=xr(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,r,n,i,a,o,s,u,l,c,h=t.x,f=t.y;if(h=te(h-this.long0),this.sphere){if(a=Math.sin(f),c=Math.cos(f),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+c*n:1+this.sinph0*a+this.cosph0*c*n)<=1e-10)return null;e=(r=Math.sqrt(2/r))*c*Math.sin(h),r*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<1e-10)return null;r=Pt-.5*f,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(s=0,u=0,l=0,n=Math.cos(h),i=Math.sin(h),a=Math.sin(f),o=xr(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=o/this.qp,u=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:l=1+this.sinb1*s+this.cosb1*u*n;break;case this.EQUIT:l=1+u*n;break;case this.N_POLE:l=Tt+f,o=this.qp-o;break;case this.S_POLE:l=f-Tt,o=this.qp+o}if(Math.abs(l)<1e-10)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),r=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*s-this.sinb1*u*n):(l=Math.sqrt(2/(1+u*n)))*s*this.ymf,e=this.xmf*l*u*i;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(l=Math.sqrt(o))*i,r=n*(this.mode===this.S_POLE?l:-l)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,a,o,s,u,l,c,h=t.x/this.a,f=t.y/this.a;if(this.sphere){var d,p=0,m=0;if((r=.5*(d=Math.sqrt(h*h+f*f)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),p=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(d)<=1e-10?0:Math.asin(f*m/d),h*=m,f=p*d;break;case this.OBLIQ:r=Math.abs(d)<=1e-10?this.lat0:Math.asin(p*this.sinph0+f*m*this.cosph0/d),h*=m*this.cosph0,f=(p-Math.sin(r)*this.sinph0)*d;break;case this.N_POLE:f=-f,r=Tt-r;break;case this.S_POLE:r-=Tt}e=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(h,f):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(h/=this.dd,f*=this.dd,(o=Math.sqrt(h*h+f*f))<1e-10)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*o/this.rq),n=Math.cos(i),h*=i=Math.sin(i),this.mode===this.OBLIQ?(a=this.qp*(s=n*this.sinb1+f*i*this.cosb1/o),f=o*this.cosb1*n-f*this.sinb1*i):(a=this.qp*(s=f*i/o),f=o*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(a=h*h+f*f))return t.x=this.long0,t.y=this.lat0,t;s=1-a/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(h,f),c=(u=Math.asin(s))+u,r=u+(l=this.apa)[0]*Math.sin(c)+l[1]*Math.sin(c+c)+l[2]*Math.sin(c+c+c)}return t.x=te(this.long0+e),t.y=r,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Mr(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var Ar={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Jt(this.e3,this.sin_po,this.cos_po),this.qs1=xr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Jt(this.e3,this.sin_po,this.cos_po),this.qs2=xr(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=xr(this.e3,this.sin_po),this.ns0=Math.abs(this.lat1-this.lat2)>1e-10?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=xr(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*te(e-this.long0),o=i*Math.sin(a)+this.x0,s=this.rh-i*Math.cos(a)+this.y0;return t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),n=0,0!==e&&(n=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,a=this.sphere?Math.asin((this.c-r*r)/(2*this.ns0)):this.phi1z(this.e3,(this.c-r*r)/this.ns0),i=te(n/this.ns0+this.long0),t.x=i,t.y=a,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var r,n,i,a,o=Mr(.5*e);if(t<1e-10)return o;for(var s=t*t,u=1;u<=25;u++)if(o+=a=.5*(i=1-(n=t*(r=Math.sin(o)))*n)*i/Math.cos(o)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return o;return null}},Er={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,r,n,i,a,o,s,u=t.y;return n=te(t.x-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),(a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=1e-10?(o=this.x0+1*this.a*r*Math.sin(n)/a,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/a):(o=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),o=Mr((n=Math.cos(i))*this.sin_p14+t.y*r*this.cos_p14/e),a=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),a=te(this.long0+a)):(o=this.phic0,a=0),t.x=a,t.y=o,t},names:["gnom"]},Sr={init:function(){this.sphere||(this.k0=Jt(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,r,n=t.y,i=te(t.x-this.long0);if(this.sphere)e=this.x0+this.a*i*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var a=xr(this.e,Math.sin(n));e=this.x0+this.a*this.k0*i,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t},inverse:function(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=te(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=function(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*Tt:Tt;for(var n,i,a,o,s=Math.asin(.5*e),u=0;u<30;u++)if(i=Math.sin(s),a=Math.cos(s),o=t*i,s+=n=Math.pow(1-o*o,2)/(2*a)*(e/(1-t*t)-i/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),Math.abs(n)<=1e-10)return s;return NaN}(this.e,2*t.y*this.k0/this.a),e=te(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t},names:["cea"]},Tr={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.y,r=te(t.x-this.long0),n=yr(e-this.lat0);return t.x=this.x0+this.a*r*this.rc,t.y=this.y0+this.a*n,t},inverse:function(t){var e=t.y;return t.x=te(this.long0+(t.x-this.x0)/(this.a*this.rc)),t.y=yr(this.lat0+(e-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Cr={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=dr(this.es),this.e1=pr(this.es),this.e2=mr(this.es),this.e3=vr(this.es),this.ml0=this.a*fr(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,r,n,i=t.y,a=te(t.x-this.long0);if(n=a*Math.sin(i),this.sphere)Math.abs(i)<=1e-10?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(i),r=this.a*(yr(i-this.lat0)+(1-Math.cos(n))/Math.tan(i)));else if(Math.abs(i)<=1e-10)e=this.a*a,r=-1*this.ml0;else{var o=gr(this.a,this.e,Math.sin(i))/Math.tan(i);e=o*Math.sin(n),r=this.a*fr(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+o*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t},inverse:function(t){var e,r,n,i,a,o,s,u,l;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=1e-10)e=te(n/this.a+this.long0),r=0;else{var c;for(s=n*n/this.a/this.a+(o=this.lat0+i/this.a)*o,u=o,a=20;a;--a)if(u+=l=-1*(o*(u*(c=Math.tan(u))+1)-u-.5*(u*u+s)*c)/((u-o)/c-1),Math.abs(l)<=1e-10){r=u;break}e=te(this.long0+Math.asin(n*Math.tan(u)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=1e-10)r=0,e=te(this.long0+n/this.a);else{var h,f,d,p,m;for(s=n*n/this.a/this.a+(o=(this.ml0+i)/this.a)*o,u=o,a=20;a;--a)if(m=this.e*Math.sin(u),h=Math.sqrt(1-m*m)*Math.tan(u),f=this.a*fr(this.e0,this.e1,this.e2,this.e3,u),d=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),u-=l=(o*(h*(p=f/this.a)+1)-p-.5*h*(p*p+s))/(this.es*Math.sin(2*u)*(p*p+s-2*o*p)/(4*h)+(o-p)*(h*d-2/Math.sin(2*u))-d),Math.abs(l)<=1e-10){r=u;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=te(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return t.x=e,t.y=r,t},names:["Polyconic","poly"]},Or={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,r=(t.y-this.lat0)/St*1e-5,n=t.x-this.long0,i=1,a=0;for(e=1;e<=10;e++)a+=this.A[e]*(i*=r);var o,s=a,u=n,l=1,c=0,h=0,f=0;for(e=1;e<=6;e++)o=c*s+l*u,h=h+this.B_re[e]*(l=l*s-c*u)-this.B_im[e]*(c=o),f=f+this.B_im[e]*l+this.B_re[e]*c;return t.x=f*this.a+this.x0,t.y=h*this.a+this.y0,t},inverse:function(t){var e,r,n=(t.y-this.y0)/this.a,i=(t.x-this.x0)/this.a,a=1,o=0,s=0,u=0;for(e=1;e<=6;e++)r=o*n+a*i,s=s+this.C_re[e]*(a=a*n-o*i)-this.C_im[e]*(o=r),u=u+this.C_im[e]*a+this.C_re[e]*o;for(var l=0;l<this.iterations;l++){var c,h=s,f=u,d=n,p=i;for(e=2;e<=6;e++)c=f*s+h*u,d+=(e-1)*(this.B_re[e]*(h=h*s-f*u)-this.B_im[e]*(f=c)),p+=(e-1)*(this.B_im[e]*h+this.B_re[e]*f);h=1,f=0;var m=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)c=f*s+h*u,m+=e*(this.B_re[e]*(h=h*s-f*u)-this.B_im[e]*(f=c)),v+=e*(this.B_im[e]*h+this.B_re[e]*f);var g=m*m+v*v;s=(d*m+p*v)/g,u=(p*m-d*v)/g}var y=s,_=u,b=1,x=0;for(e=1;e<=9;e++)x+=this.D[e]*(b*=y);var w=this.lat0+x*St*1e5;return t.x=this.long0+_,t.y=w,t},names:["New_Zealand_Map_Grid","nzmg"]},Pr={init:function(){},forward:function(t){var e=t.y,r=te(t.x-this.long0),n=this.x0+this.a*r,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return t.x=n,t.y=i,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=te(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t},names:["Miller_Cylindrical","mill"]},Lr={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Xe(this.es)},forward:function(t){var e,r,n=t.x,i=t.y;if(n=te(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(i),o=20;o;--o){var s=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<1e-10)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var u=Math.sin(i),l=Math.cos(i);r=this.a*Ke(i,u,l,this.en),e=this.a*n*l/Math.sqrt(1-this.es*u*u)}return t.x=e,t.y=r,t},inverse:function(t){var e,r,n;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=Mr((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=Mr(Math.sin(e)/this.n)),r=te(r+this.long0),e=yr(e)):(e=Ze(t.y/this.a,this.es,this.en),(n=Math.abs(e))<Tt?(n=Math.sin(e),r=te(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-1e-10<Tt&&(r=this.long0)),t.x=r,t.y=e,t},names:["Sinusoidal","sinu"]},Ir={init:function(){},forward:function(t){for(var e=t.y,r=te(t.x-this.long0),n=e,i=Math.PI*Math.sin(e);;){var a=-(n+Math.sin(n)-i)/(1+Math.cos(n));if(n+=a,Math.abs(a)<1e-10)break}n/=2,Math.PI/2-Math.abs(e)<1e-10&&(r=0);var o=.900316316158*this.a*r*Math.cos(n)+this.x0,s=1.4142135623731*this.a*Math.sin(n)+this.y0;return t.x=o,t.y=s,t},inverse:function(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=te(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t},names:["Mollweide","moll"]},kr={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=dr(this.es),this.e1=pr(this.es),this.e2=mr(this.es),this.e3=vr(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Jt(this.e,this.sinphi,this.cosphi),this.ml1=fr(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<1e-10?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Jt(this.e,this.sinphi,this.cosphi),this.ml2=fr(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=fr(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=fr(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var a=this.ns*te(r-this.long0),o=this.x0+e*Math.sin(a),s=this.y0+this.rh-e*Math.cos(a);return t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;return 0!==r&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=te(this.long0+a/this.ns),n=yr(this.g-r/this.a),t.x=i,t.y=n,t):(n=_r(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=te(this.long0+a/this.ns),t.x=i,t.y=n,t)},names:["Equidistant_Conic","eqdc"]},Rr={init:function(){this.R=this.a},forward:function(t){var e,r,n=t.y,i=te(t.x-this.long0);Math.abs(n)<=1e-10&&(e=this.x0+this.R*i,r=this.y0);var a=Mr(2*Math.abs(n/Math.PI));(Math.abs(i)<=1e-10||Math.abs(Math.abs(n)-Tt)<=1e-10)&&(e=this.x0,r=n>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),s=o*o,u=Math.sin(a),l=Math.cos(a),c=l/(u+l-1),h=c*(2/u-1),f=h*h,d=Math.PI*this.R*(o*(c-f)+Math.sqrt(s*(c-f)*(c-f)-(f+s)*(c*c-f)))/(f+s);i<0&&(d=-d),e=this.x0+d;var p=s+c;return d=Math.PI*this.R*(h*p-o*Math.sqrt((f+s)*(s+1)-p*p))/(f+s),r=n>=0?this.y0+d:this.y0-d,t.x=e,t.y=r,t},inverse:function(t){var e,r,n,i,a,o,s,u,l,c,h,f;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,a=(n=t.x/h)*n+(i=t.y/h)*i,h=3*(i*i/(u=-2*(o=-Math.abs(i)*(1+a))+1+2*i*i+a*a)+(2*(s=o-2*i*i+n*n)*s*s/u/u/u-9*o*s/u/u)/27)/(l=(o-s*s/3/u)/u)/(c=2*Math.sqrt(-l/3)),Math.abs(h)>1&&(h=h>=0?1:-1),f=Math.acos(h)/3,r=t.y>=0?(-c*Math.cos(f+Math.PI/3)-s/3/u)*Math.PI:-(-c*Math.cos(f+Math.PI/3)-s/3/u)*Math.PI,e=Math.abs(n)<1e-10?this.long0:te(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-i*i)+a*a))/2/n),t.x=e,t.y=r,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Dr={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M=t.x,A=t.y,E=Math.sin(t.y),S=Math.cos(t.y),T=te(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=1e-10?(t.x=this.x0+this.a*(Tt-A)*Math.sin(T),t.y=this.y0-this.a*(Tt-A)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=1e-10?(t.x=this.x0+this.a*(Tt+A)*Math.sin(T),t.y=this.y0+this.a*(Tt+A)*Math.cos(T),t):(y=this.sin_p12*E+this.cos_p12*S*Math.cos(T),g=(v=Math.acos(y))?v/Math.sin(v):1,t.x=this.x0+this.a*g*S*Math.sin(T),t.y=this.y0+this.a*g*(this.cos_p12*E-this.sin_p12*S*Math.cos(T)),t):(e=dr(this.es),r=pr(this.es),n=mr(this.es),i=vr(this.es),Math.abs(this.sin_p12-1)<=1e-10?(a=this.a*fr(e,r,n,i,Tt),o=this.a*fr(e,r,n,i,A),t.x=this.x0+(a-o)*Math.sin(T),t.y=this.y0-(a-o)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=1e-10?(a=this.a*fr(e,r,n,i,Tt),o=this.a*fr(e,r,n,i,A),t.x=this.x0+(a+o)*Math.sin(T),t.y=this.y0+(a+o)*Math.cos(T),t):(s=E/S,u=gr(this.a,this.e,this.sin_p12),l=gr(this.a,this.e,E),c=Math.atan((1-this.es)*s+this.es*u*this.sin_p12/(l*S)),_=0===(h=Math.atan2(Math.sin(T),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(T)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(h)-Math.PI)<=1e-10?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(T)*Math.cos(c)/Math.sin(h)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),d=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es),t.x=this.x0+(v=u*_*(1-(b=_*_)*(m=d*d)*(1-m)/6+(x=b*_)/8*(p=f*d)*(1-2*m)+(w=x*_)/120*(m*(4-7*m)-3*f*f*(1-7*m))-w*_/48*p))*Math.sin(h),t.y=this.y0+v*Math.cos(h),t))},inverse:function(t){var e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Tt*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=1e-10?o=this.lat0:(o=Mr(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-Tt,a=Math.abs(s)<=1e-10?te(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)):te(this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=a,t.y=o,t}return u=dr(this.es),l=pr(this.es),c=mr(this.es),h=vr(this.es),Math.abs(this.sin_p12-1)<=1e-10?(o=_r(((f=this.a*fr(u,l,c,h,Tt))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,u,l,c,h),a=te(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=o,t):Math.abs(this.sin_p12+1)<=1e-10?(f=this.a*fr(u,l,c,h,Tt),o=_r(((e=Math.sqrt(t.x*t.x+t.y*t.y))-f)/this.a,u,l,c,h),a=te(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),d=gr(this.a,this.e,this.sin_p12),v=Math.cos(m),_=3*this.es*(1-(y=-(g=this.e*this.cos_p12*v)*g/(1-this.es)))*this.sin_p12*this.cos_p12*v/(1-this.es),w=1-y*(x=(b=e/d)-y*(1+y)*Math.pow(b,3)/6-_*(1+3*y)*Math.pow(b,4)/24)*x/2-b*x*x*x/6,p=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*v),a=te(this.long0+Math.asin(Math.sin(m)*Math.sin(x)/Math.cos(p))),M=Math.sin(p),o=Math.atan2((M-this.es*w*this.sin_p12)*Math.tan(p),M*(1-this.es)),t.x=a,t.y=o,t)},names:["Azimuthal_Equidistant","aeqd"]},Br={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,r,n,i,a,o,s,u=t.y;return n=te(t.x-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),((a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=1e-10)&&(o=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t},inverse:function(t){var e,r,n,i,a,o,s;return t.x-=this.x0,t.y-=this.y0,r=Mr((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=1e-10?(s=this.lat0,t.x=o,t.y=s,t):(s=Mr(i*this.sin_p14+t.y*n*this.cos_p14/e),a=Math.abs(this.lat0)-Tt,Math.abs(a)<=1e-10?(o=te(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=s,t):(o=te(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=o,t.y=s,t))},names:["ortho"]};function Fr(t,e,r,n){var i;return t<1e-10?(n.value=1,i=0):(i=Math.atan2(e,r),Math.abs(i)<=Pt?n.value=1:i>Pt&&i<=Tt+Pt?(n.value=2,i-=Tt):i>Tt+Pt||i<=-(Tt+Pt)?(n.value=3,i=i>=0?i-It:i+It):(n.value=4,i+=Tt)),i}function jr(t,e){var r=t+e;return r<-It?r+=Lt:r>+It&&(r-=Lt),r}var Nr={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.face=this.lat0>=Tt-Pt/2?5:this.lat0<=-(Tt-Pt/2)?6:Math.abs(this.long0)<=Pt?1:Math.abs(this.long0)<=Tt+Pt?this.long0>0?2:4:3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,r,n,i,a,o,s={x:0,y:0},u={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,5===this.face)i=Tt-e,r>=Pt&&r<=Tt+Pt?(u.value=1,n=r-Tt):r>Tt+Pt||r<=-(Tt+Pt)?(u.value=2,n=r>0?r-It:r+It):r>-(Tt+Pt)&&r<=-Pt?(u.value=3,n=r+Tt):(u.value=4,n=r);else if(6===this.face)i=Tt+e,r>=Pt&&r<=Tt+Pt?(u.value=1,n=-r+Tt):r<Pt&&r>=-Pt?(u.value=2,n=-r):r<-Pt&&r>=-(Tt+Pt)?(u.value=3,n=-r-Tt):(u.value=4,n=r>0?-r+It:-r-It);else{var l,c,h,f,d,p;2===this.face?r=jr(r,+Tt):3===this.face?r=jr(r,+It):4===this.face&&(r=jr(r,-Tt)),f=Math.sin(e),d=Math.cos(e),p=Math.sin(r),l=d*Math.cos(r),c=d*p,h=f,1===this.face?n=Fr(i=Math.acos(l),h,c,u):2===this.face?n=Fr(i=Math.acos(c),h,-l,u):3===this.face?n=Fr(i=Math.acos(-l),h,-c,u):4===this.face?n=Fr(i=Math.acos(-c),h,l,u):(i=n=0,u.value=1)}return o=Math.atan(12/It*(n+Math.acos(Math.sin(n)*Math.cos(Pt))-Tt)),a=Math.sqrt((1-Math.cos(i))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),2===u.value?o+=Tt:3===u.value?o+=It:4===u.value&&(o+=1.5*It),s.x=a*Math.cos(o),s.y=a*Math.sin(o),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,t.x=s.x,t.y=s.y,t},inverse:function(t){var e,r,n,i,a,o,s,u,l,c,h,f,d={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=1:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=2,e-=Tt):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=3,e=e<0?e+It:e-It):(p.value=4,e+=Tt),l=It/12*Math.tan(e),a=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),o=Math.atan(a),(s=1-(n=Math.cos(e))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?s=-1:s>1&&(s=1),5===this.face)u=Math.acos(s),d.phi=Tt-u,d.lam=1===p.value?o+Tt:2===p.value?o<0?o+It:o-It:3===p.value?o-Tt:o;else if(6===this.face)u=Math.acos(s),d.phi=u-Tt,d.lam=1===p.value?-o+Tt:2===p.value?-o:3===p.value?-o-Tt:o<0?-o-It:-o+It;else{var m,v,g;l=(m=s)*m,v=(l+=(g=l>=1?0:Math.sqrt(1-l)*Math.sin(o))*g)>=1?0:Math.sqrt(1-l),2===p.value?(l=v,v=-g,g=l):3===p.value?(v=-v,g=-g):4===p.value&&(l=v,v=g,g=-l),2===this.face?(l=m,m=-v,v=l):3===this.face?(m=-m,v=-v):4===this.face&&(l=m,m=v,v=-l),d.phi=Math.acos(-g)-Tt,d.lam=Math.atan2(v,m),2===this.face?d.lam=jr(d.lam,-Tt):3===this.face?d.lam=jr(d.lam,-It):4===this.face&&(d.lam=jr(d.lam,+Tt))}return 0!==this.es&&(c=d.phi<0?1:0,h=Math.tan(d.phi),f=this.b/Math.sqrt(h*h+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),c&&(d.phi=-d.phi)),d.lam+=this.long0,t.x=d.lam,t.y=d.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},Ur=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],zr=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Gr=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Vr={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=te(t.x-this.long0),r=Math.abs(t.y),n=Math.floor(11.459155902616464*r);n<0?n=0:n>=18&&(n=17);var i={x:Gr(Ur[n],r=Ot*(r-.08726646259971647*n))*e,y:Gr(zr[n],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*.8487+this.x0,i.y=i.y*this.a*1.3523+this.y0,i},inverse:function(t){var e={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(e.y>=1)e.x/=Ur[18][0],e.y=t.y<0?-Tt:Tt;else{var r=Math.floor(18*e.y);for(r<0?r=0:r>=18&&(r=17);;)if(zr[r][0]>e.y)--r;else{if(!(zr[r+1][0]<=e.y))break;++r}var n=zr[r],i=5*(e.y-n[0])/(zr[r+1][0]-n[0]);i=function(t,e,r,n){for(var i=e;n;--n){var a=t(i);if(i-=a,Math.abs(a)<1e-10)break}return i}((function(t){return(Gr(n,t)-e.y)/function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])}(n,t)}),i,0,100),e.x/=Gr(Ur[r],i),e.y=(5*r+i)*Ct,t.y<0&&(e.y=-e.y)}return e.x=te(e.x+this.long0),e},names:["Robinson","robin"]},Hr={init:function(){this.name="geocent"},forward:function(t){return be(t,this.es,this.a)},inverse:function(t){return xe(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]},Wr={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}},$r={init:function(){if(Object.keys(Wr).forEach(function(t){if(void 0===this[t])this[t]=Wr[t].def;else{if(Wr[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Wr[t].num&&(this[t]=parseFloat(this[t]))}Wr[t].degrees&&(this[t]=this[t]*Ct)}.bind(this)),Math.abs(Math.abs(this.lat0)-Tt)<1e-10?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<1e-10?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)},forward:function(t){t.x-=this.long0;var e,r,n,i,a=Math.sin(t.y),o=Math.cos(t.y),s=Math.cos(t.x);switch(this.mode){case 3:r=this.sinph0*a+this.cosph0*o*s;break;case 2:r=o*s;break;case 1:r=-a;break;case 0:r=a}switch(e=(r=this.pn1/(this.p-r))*o*Math.sin(t.x),this.mode){case 3:r*=this.cosph0*a-this.sinph0*o*s;break;case 2:r*=a;break;case 0:r*=-o*s;break;case 1:r*=o*s}return e=(e*this.cg-r*this.sg)*this.cw*(i=1/((n=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw)),r=n*i,t.x=e*this.a,t.y=r*this.a,t},inverse:function(t){t.x/=this.a,t.y/=this.a;var e,r,n,i={x:t.x,y:t.y};t.x=(e=this.pn1*t.x*(n=1/(this.pn1-t.y*this.sw)))*this.cg+(r=this.pn1*t.y*this.cw*n)*this.sg,t.y=r*this.cg-e*this.sg;var a=Qe(t.x,t.y);if(Math.abs(a)<1e-10)i.x=0,i.y=t.y;else{var o,s;switch(s=1-a*a*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/a+a/this.pn1),o=Math.sqrt(1-s*s),this.mode){case 3:i.y=Math.asin(o*this.sinph0+t.y*s*this.cosph0/a),t.y=(o-this.sinph0*Math.sin(i.y))*a,t.x*=s*this.cosph0;break;case 2:i.y=Math.asin(t.y*s/a),t.y=o*a,t.x*=s;break;case 0:i.y=Math.asin(o),t.y=-t.y;break;case 1:i.y=-Math.asin(o)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t},names:["Tilted_Perspective","tpers"]},qr={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(t){var e,r,n,i,a=t.x,o=t.y;if(a-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var s=this.radius_p/Qe(this.radius_p*Math.cos(o),Math.sin(o));if(r=s*Math.cos(a)*Math.cos(o),n=s*Math.sin(a)*Math.cos(o),i=s*Math.sin(o),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Qe(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/Qe(n,e)))}else"sphere"===this.shape&&(e=Math.cos(o),r=Math.cos(a)*e,n=Math.sin(a)*e,i=Math.sin(o),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/Qe(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/Qe(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t},inverse:function(t){var e,r,n,i,a=-1,o=0,s=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Qe(1,s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Qe(1,o));var u=s/this.radius_p;if((n=(r=2*this.radius_g*a)*r-4*(e=o*o+u*u+a*a)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+s*s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+o*o)),(n=(r=2*this.radius_g*a)*r-4*(e=o*o+s*s+a*a)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a)}return t.x=t.x+this.long0,t},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};function Xr(t){var e=ke("EPSG:3857","EPSG:4326",[t[0],t[1]]);return t[2]&&e.push(t[2]),e}function Kr(t){var e=ke("EPSG:4326","EPSG:3857",[t[0],t[1]]);return t[2]&&e.push(t[2]),e}function Zr(t,e){if(e){if("SZ2000"===e)return Array.isArray(t)&&t[0]>180&&t[1]>90?Xr(t):t;console.error("暂不支持此类型`projection`！")}else console.error("地图初始化需要`projection`参数！")}function Yr(t,e){if(e){if("SZ2000"===e)return Array.isArray(t)&&t[0]<180&&t[1]<90?Kr(t):t;console.error("暂不支持此类型`projection`！")}else console.error("地图初始化需要`projection`参数！")}function Jr(t,e){return e?function(t,e){for(var r=JSON.parse(JSON.stringify(t)),n=[],i=t.features,a=0;a<i.length;a++){var o=JSON.parse(JSON.stringify(i[a]));o.geometry.coordinates=Qr(i[a].geometry,e),n.push(o)}return r.features=n,r}(t,e):t}function Qr(t,e){var r=t.coordinates;switch(t.type){case"Point":return function(t,e){return Zr(t,e)}(r,e);case"MultiPoint":case"LineString":return function(t,e){for(var r=[],n=0;n<t.length;n++){var i=Zr(t[n],e);r.push(i)}return r}(r,e);case"MultiLineString":case"Polygon":return function(t,e){for(var r=[],n=0;n<t.length;n++){for(var i=[],a=t[n],o=0;o<a.length;o++){var s=Zr(a[o],e);i.push(s)}r.push(i)}return r}(r,e);case"MultiPolygon":return function(t,e){for(var r=[],n=0;n<t.length;n++){for(var i=[],a=t[n],o=0;o<a.length;o++){for(var s=[],u=a[o],l=0;l<u.length;l++){var c=Zr(u[l],e);s.push(c)}i.push(s)}r.push(i)}return r}(r,e)}}ke.defaultDatum="WGS84",ke.Proj=_e,ke.WGS84=new ke.Proj("WGS84"),ke.Point=$e,ke.toPoint=Te,ke.defs=Xt,ke.nadgrid=function(t,e){var r=new DataView(e),n=function(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),i=function(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:me(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}(r,n);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a={header:i,subgrids:function(t,e,r){for(var n=[],i=0;i<e.nSubgrids;i++){var a=ge(t,176,r),o=ye(t,176,a,r),s=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),u=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[pe(a.lowerLongitude),pe(a.lowerLatitude)],del:[pe(a.longitudeInterval),pe(a.latitudeInterval)],lim:[s,u],count:a.gridNodeCount,cvs:ve(o)})}return n}(r,i,n)};return fe[t]=a,a},ke.transform=Oe,ke.mgrs=Fe,ke.version="__VERSION__",function(t){t.Proj.projections.add(Ye),t.Proj.projections.add(rr),t.Proj.projections.add(nr),t.Proj.projections.add(or),t.Proj.projections.add(sr),t.Proj.projections.add(ur),t.Proj.projections.add(lr),t.Proj.projections.add(cr),t.Proj.projections.add(hr),t.Proj.projections.add(br),t.Proj.projections.add(wr),t.Proj.projections.add(Ar),t.Proj.projections.add(Er),t.Proj.projections.add(Sr),t.Proj.projections.add(Tr),t.Proj.projections.add(Cr),t.Proj.projections.add(Or),t.Proj.projections.add(Pr),t.Proj.projections.add(Lr),t.Proj.projections.add(Ir),t.Proj.projections.add(kr),t.Proj.projections.add(Rr),t.Proj.projections.add(Dr),t.Proj.projections.add(Br),t.Proj.projections.add(Nr),t.Proj.projections.add(Vr),t.Proj.projections.add(Hr),t.Proj.projections.add($r),t.Proj.projections.add(qr)}(ke);var tn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(tn);var en=function(t){function e(e,r,n){401===r&&J(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),rn=O()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===o.location.protocol?o.parent:o).location.href},nn=function(t){return/^file:/.test(t)||/^file:/.test(rn())&&!/^\w+:/.test(t)};function an(t,e){var r=new o.XMLHttpRequest;for(var n in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new en(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}var on,sn,un=function(t,e){if(!nn(t.url)){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r=new o.AbortController,n=t.url.indexOf("?k=");n>-1&&(JSON.parse(t.url.substr(n+"?k=".length)||"{}"),t.url=t.url.substring(0,n));var i=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:rn(),signal:r.signal}),a=!1,s=!1,u=Q(i.url);"json"===t.type&&i.headers.set("Accept","application/json");var l=function(r,n,a){if(!s){if(r&&"SecurityError"!==r.message&&S(r),n&&a)return c(n);var l=Date.now();o.fetch(i).then((function(r){if(r.ok){var n=u?r.clone():null;return t.projection?h(r,n,l,t):c(r,n,l)}return e(new en(r.statusText,r.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},c=function(r,n,o){("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then((function(t){s||(n&&o&&mt(i,n,o),a=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))},h=function(t,r,n,o){("arrayBuffer"===o.type?t.arrayBuffer():"json"===o.type?t.json():t.text()).then((function(u){var l=u;"geojson.loadData"===o.customType&&(l=Jr(u,o.projection)),s||(r&&n&&mt(i,r,n),a=!0,e(null,l,t.headers.get("Cache-Control"),t.headers.get("Expires")))})).catch((function(t){s||e(new Error(t.message))}))};return u?gt(i,l):l(null,null),{cancel:function(){s=!0,a||r.abort()}}}(t,e);if(O()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}return an(t,e)},ln=function(t,e){return un(m(t,{type:"arrayBuffer"}),e)},cn=function(t,e){return un(m(t,{method:"POST"}),e)},hn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";on=[],sn=0;var fn=function(t,e){if(V.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),sn>=G.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return on.push(r),r}sn++;var n=!1,i=function(){if(!n)for(n=!0,sn--;on.length&&sn<G.MAX_PARALLEL_IMAGE_REQUESTS;){var t=on.shift();t.cancelled||(t.cancel=fn(t.requestParameters,t.callback).cancel)}},a=ln(t,(function(t,r,n,a){i(),t?e(t):r&&(bt()?function(t,e){var r=new o.Blob([new Uint8Array(t)],{type:"image/png"});r.size>0&&o.createImageBitmap(r).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(r,e):function(t,e,r,n){var i=new o.Image,a=o.URL;i.onload=function(){e(null,i),a.revokeObjectURL(i.src),i.onload=null,i.src=hn},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var s=new o.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=r,i.expires=n,i.src=t.byteLength?a.createObjectURL(s):hn}(r,e,n,a))}));return{cancel:function(){a.cancel(),i()}}};function dn(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function pn(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}var mn=function(t,e){void 0===e&&(e={}),m(this,e),this.type=t},vn=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",m({error:e},r))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(mn),gn=function(){};gn.prototype.on=function(t,e){return this._listeners=this._listeners||{},dn(t,e,this._listeners),this},gn.prototype.off=function(t,e){return pn(t,e,this._listeners),pn(t,e,this._oneTimeListeners),this},gn.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},dn(t,e,this._oneTimeListeners),this},gn.prototype.fire=function(t,e){"string"==typeof t&&(t=new mn(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var a=0,o=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];a<o.length;a+=1){var s=o[a];pn(r,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(m(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof vn&&console.error(t.error);return this},gn.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},gn.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var yn={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Noto Sans Hans Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"gradient",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},_n=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function bn(t){var e=t.value;return e?[new _n(t.key,e,"constants have been deprecated as of v8")]:[]}function xn(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var a=i[n];for(var o in a)t[o]=a[o]}return t}function wn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Mn(t){if(Array.isArray(t))return t.map(Mn);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Mn(t[r]);return e}return wn(t)}var An=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),En=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Sn={kind:"null"},Tn={kind:"number"},Cn={kind:"string"},On={kind:"boolean"},Pn={kind:"color"},Ln={kind:"object"},In={kind:"value"},kn={kind:"collator"},Rn={kind:"formatted"},Dn={kind:"resolvedImage"};function Bn(t,e){return{kind:"array",itemType:t,N:e}}function Fn(t){if("array"===t.kind){var e=Fn(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var jn=[Sn,Tn,Cn,On,Pn,Rn,Ln,Bn(In),Dn];function Nn(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Nn(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=jn;r<n.length;r+=1)if(!Nn(n[r],e))return null}return"Expected "+Fn(t)+" but found "+Fn(e)+" instead."}function Un(t,e){return e.some((function(e){return e.kind===t.kind}))}function zn(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t}))}var Gn=e((function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function a(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function o(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in r)return r[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),l=s.indexOf(")");if(-1!==u&&l+1===s.length){var c=s.substr(0,u),h=s.substr(u+1,l-(u+1)).split(","),f=1;switch(c){case"rgba":if(4!==h.length)return null;f=a(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),f];case"hsla":if(4!==h.length)return null;f=a(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,p=a(h[1]),m=a(h[2]),v=m<=.5?m*(p+1):m+p-m*p,g=2*m-v;return[n(255*o(g,v,d+1/3)),n(255*o(g,v,d)),n(255*o(g,v,d-1/3)),f];default:return null}}return null}}catch(t){}})).parseCSSColor,Vn=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};Vn.parse=function(t){if(t){if(t instanceof Vn)return t;if("string"==typeof t){var e=Gn(t);if(e)return new Vn(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Vn.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},Vn.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Vn.black=new Vn(0,0,0,1),Vn.white=new Vn(1,1,1,1),Vn.transparent=new Vn(0,0,0,0),Vn.red=new Vn(1,0,0,1);var Hn=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Hn.prototype.compare=function(t,e){return this.collator.compare(t,e)},Hn.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Wn=function(t,e,r,n,i){this.text=t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i},$n=function(t){this.sections=t};$n.fromString=function(t){return new $n([new Wn(t,null,null,null,null)])},$n.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},$n.factory=function(t){return t instanceof $n?t:$n.fromString(t)},$n.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},$n.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var qn=function(t){this.name=t.name,this.available=t.available};function Xn(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Kn(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Vn)return!0;if(t instanceof Hn)return!0;if(t instanceof $n)return!0;if(t instanceof qn)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1)if(!Kn(r[e]))return!1;return!0}if("object"==typeof t){for(var n in t)if(!Kn(t[n]))return!1;return!0}return!1}function Zn(t){if(null===t)return Sn;if("string"==typeof t)return Cn;if("boolean"==typeof t)return On;if("number"==typeof t)return Tn;if(t instanceof Vn)return Pn;if(t instanceof Hn)return kn;if(t instanceof $n)return Rn;if(t instanceof qn)return Dn;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var a=Zn(i[n]);if(e){if(e===a)continue;e=In;break}e=a}return Bn(e||In,r)}return Ln}function Yn(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Vn||t instanceof $n||t instanceof qn?t.toString():JSON.stringify(t)}qn.prototype.toString=function(){return this.name},qn.fromString=function(t){return t?new qn({name:t,available:!1}):null},qn.prototype.serialize=function(){return["image",this.name]};var Jn=function(t,e){this.type=t,this.value=e};Jn.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Kn(t[1]))return e.error("invalid value");var r=t[1],n=Zn(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Jn(n,r)},Jn.prototype.evaluate=function(){return this.value},Jn.prototype.eachChild=function(){},Jn.prototype.outputDefined=function(){return!0},Jn.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toArray()):this.value instanceof $n?this.value.serialize():this.value};var Qn=function(t){this.name="ExpressionEvaluationError",this.message=t};Qn.prototype.toJSON=function(){return this.message};var ti={string:Cn,number:Tn,boolean:On,object:Ln},ei=function(t,e){this.type=t,this.args=e};ei.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var a,o;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ti)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);a=ti[s],n++}else a=In;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],n++}r=Bn(a,o)}else r=ti[i];for(var u=[];n<t.length;n++){var l=e.parse(t[n],n,In);if(!l)return null;u.push(l)}return new ei(r,u)},ei.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Nn(this.type,Zn(r)))return r;if(e===this.args.length-1)throw new Qn("Expected value to be of type "+Fn(this.type)+", but found "+Fn(Zn(r))+" instead.")}return null},ei.prototype.eachChild=function(t){this.args.forEach(t)},ei.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ei.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var ri=function(t){this.type=Rn,this.sections=t};ri.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return e.error("First argument must be an image or text section.");for(var n=[],i=!1,a=1;a<=t.length-1;++a){var o=t[a];if(i&&"object"==typeof o&&!Array.isArray(o)){i=!1;var s=null;if(o["font-scale"]&&!(s=e.parse(o["font-scale"],1,Tn)))return null;var u=null;if(o["text-font"]&&!(u=e.parse(o["text-font"],1,Bn(Cn))))return null;var l=null;if(o["text-color"]&&!(l=e.parse(o["text-color"],1,Pn)))return null;var c=n[n.length-1];c.scale=s,c.font=u,c.textColor=l}else{var h=e.parse(t[a],1,In);if(!h)return null;var f=h.type.kind;if("string"!==f&&"value"!==f&&"null"!==f&&"resolvedImage"!==f)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:h,scale:null,font:null,textColor:null})}}return new ri(n)},ri.prototype.evaluate=function(t){return new $n(this.sections.map((function(e){var r=e.content.evaluate(t);return Zn(r)===Dn?new Wn("",r,null,null,null):new Wn(Yn(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},ri.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},ri.prototype.outputDefined=function(){return!1},ri.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var ni=function(t){this.type=Dn,this.input=t};ni.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Cn);return r?new ni(r):e.error("No image name provided.")},ni.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=qn.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},ni.prototype.eachChild=function(t){t(this.input)},ni.prototype.outputDefined=function(){return!1},ni.prototype.serialize=function(){return["image",this.input.serialize()]};var ii={"to-boolean":On,"to-color":Pn,"to-number":Tn,"to-string":Cn},ai=function(t,e){this.type=t,this.args=e};ai.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=ii[r],i=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,In);if(!o)return null;i.push(o)}return new ai(n,i)},ai.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof Vn)return e;if("string"==typeof e){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":Xn(e[0],e[1],e[2],e[3])))return new Vn(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Qn(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null===(o=u[s].evaluate(t)))return 0;var l=Number(o);if(!isNaN(l))return l}throw new Qn("Could not convert "+JSON.stringify(o)+" to number.")}return"formatted"===this.type.kind?$n.fromString(Yn(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?qn.fromString(Yn(this.args[0].evaluate(t))):Yn(this.args[0].evaluate(t))},ai.prototype.eachChild=function(t){this.args.forEach(t)},ai.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ai.prototype.serialize=function(){if("formatted"===this.type.kind)return new ri([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ni(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var oi=["Unknown","Point","LineString","Polygon"],si=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};si.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},si.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?oi[this.feature.type]:this.feature.type:null},si.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},si.prototype.canonicalID=function(){return this.canonical},si.prototype.properties=function(){return this.feature&&this.feature.properties||{}},si.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Vn.parse(t)),e};var ui=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};ui.prototype.evaluate=function(t){return this._evaluate(t,this.args)},ui.prototype.eachChild=function(t){this.args.forEach(t)},ui.prototype.outputDefined=function(){return!1},ui.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},ui.parse=function(t,e){var r,n=t[0],i=ui.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var a=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],f=h[0],d=h[1];u=new Pi(e.registry,e.path,null,e.scope);for(var p=[],m=!1,v=1;v<t.length;v++){var g=t[v],y=Array.isArray(f)?f[v-1]:f.type,_=u.parse(g,1+p.length,y);if(!_){m=!0;break}p.push(_)}if(!m)if(Array.isArray(f)&&f.length!==p.length)u.error("Expected "+f.length+" arguments, but found "+p.length+" instead.");else{for(var b=0;b<p.length;b++){var x=Array.isArray(f)?f[b]:f.type,w=p[b];u.concat(b+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new ui(n,a,d,p)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var M=(s.length?s:o).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Fn).join(", ")+")":"("+Fn(e.type)+"...)"})).join(" | "),A=[],E=1;E<t.length;E++){var S=e.parse(t[E],1+A.length);if(!S)return null;A.push(Fn(S.type))}e.error("Expected arguments of type "+M+", but found ("+A.join(", ")+") instead.")}return null},ui.register=function(t,e){for(var r in ui.definitions=e,e)t[r]=ui};var li=function(t,e,r){this.type=kn,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function ci(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function hi(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function fi(t,e){var r=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(r*i*8192),Math.round(n*i*8192)]}function di(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function pi(t,e){for(var r,n,i,a,o,s,u,l=!1,c=0,h=e.length;c<h;c++)for(var f=e[c],d=0,p=f.length;d<p-1;d++){if((a=(r=t)[0]-(n=f[d])[0])*(u=r[1]-(i=f[d+1])[1])-(s=r[0]-i[0])*(o=r[1]-n[1])==0&&a*s<=0&&o*u<=0)return!1;di(t,f[d],f[d+1])&&(l=!l)}return l}function mi(t,e){for(var r=0;r<e.length;r++)if(pi(t,e[r]))return!0;return!1}function vi(t,e,r,n){var i=n[0]-r[0],a=n[1]-r[1],o=(t[0]-r[0])*a-i*(t[1]-r[1]),s=(e[0]-r[0])*a-i*(e[1]-r[1]);return o>0&&s<0||o<0&&s>0}function gi(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var a=i[n],o=0;o<a.length-1;++o)if(0!=(h=[(c=a[o+1])[0]-(l=a[o])[0],c[1]-l[1]])[0]*(f=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*f[0]&&vi(s,u,l,c)&&vi(l,c,s,u))return!0;var s,u,l,c,h,f;return!1}function yi(t,e){for(var r=0;r<t.length;++r)if(!pi(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(gi(t[n],t[n+1],e))return!1;return!0}function _i(t,e){for(var r=0;r<e.length;r++)if(yi(t,e[r]))return!0;return!1}function bi(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var a=[],o=0;o<t[i].length;o++){var s=fi(t[i][o],r);ci(e,s),a.push(s)}n.push(a)}return n}function xi(t,e,r){for(var n=[],i=0;i<t.length;i++){var a=bi(t[i],e,r);n.push(a)}return n}function wi(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){var i=.5*n,a=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===a&&(a=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=a}ci(e,t)}function Mi(t,e,r,n){for(var i=8192*Math.pow(2,n.z),a=[8192*n.x,8192*n.y],o=[],s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var h=c[l],f=[h.x+a[0],h.y+a[1]];wi(f,e,r,i),o.push(f)}return o}function Ai(t,e,r,n){for(var i,a=8192*Math.pow(2,n.z),o=[8192*n.x,8192*n.y],s=[],u=0,l=t;u<l.length;u+=1){for(var c=[],h=0,f=l[u];h<f.length;h+=1){var d=f[h],p=[d.x+o[0],d.y+o[1]];ci(e,p),c.push(p)}s.push(c)}if(e[2]-e[0]<=a/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var m=0,v=s;m<v.length;m+=1)for(var g=0,y=v[m];g<y.length;g+=1)wi(y[g],e,r,a)}return s}li.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,On);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,On);if(!i)return null;var a=null;return r.locale&&!(a=e.parse(r.locale,1,Cn))?null:new li(n,i,a)},li.prototype.evaluate=function(t){return new Hn(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},li.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},li.prototype.outputDefined=function(){return!1},li.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ei=function(t,e){this.type=On,this.geojson=t,this.geometries=e};function Si(t){if(t instanceof ui){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Ei)return!1;var e=!0;return t.eachChild((function(t){e&&!Si(t)&&(e=!1)})),e}function Ti(t){if(t instanceof ui&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Ti(t)&&(e=!1)})),e}function Ci(t,e){if(t instanceof ui&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild((function(t){r&&!Ci(t,e)&&(r=!1)})),r}Ei.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Kn(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Ei(r,r.features[n].geometry)}else if("Feature"===r.type){var a=r.geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new Ei(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Ei(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ei.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var a=bi(e.coordinates,n,i),o=Mi(t.geometry(),r,n,i);if(!hi(r,n))return!1;for(var s=0,u=o;s<u.length;s+=1)if(!pi(u[s],a))return!1}if("MultiPolygon"===e.type){var l=xi(e.coordinates,n,i),c=Mi(t.geometry(),r,n,i);if(!hi(r,n))return!1;for(var h=0,f=c;h<f.length;h+=1)if(!mi(f[h],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var a=bi(e.coordinates,n,i),o=Ai(t.geometry(),r,n,i);if(!hi(r,n))return!1;for(var s=0,u=o;s<u.length;s+=1)if(!yi(u[s],a))return!1}if("MultiPolygon"===e.type){var l=xi(e.coordinates,n,i),c=Ai(t.geometry(),r,n,i);if(!hi(r,n))return!1;for(var h=0,f=c;h<f.length;h+=1)if(!_i(f[h],l))return!1}return!0}(t,this.geometries)}return!1},Ei.prototype.eachChild=function(){},Ei.prototype.outputDefined=function(){return!0},Ei.prototype.serialize=function(){return["within",this.geojson]};var Oi=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Oi.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Oi(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Oi.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Oi.prototype.eachChild=function(){},Oi.prototype.outputDefined=function(){return!1},Oi.prototype.serialize=function(){return["var",this.name]};var Pi=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new En),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=n,this.errors=i,this.expectedType=r};function Li(t,e){for(var r,n=t.length-1,i=0,a=n,o=0;i<=a;)if((r=t[o=Math.floor((i+a)/2)])<=e){if(o===n||e<t[o+1])return o;i=o+1}else{if(!(r>e))throw new Qn("Input is not a number.");a=o-1}return 0}Pi.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},Pi.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new ei(e,[t]):"coerce"===r?new ai(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var a=i.parse(t,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=r(a,o,e.typeAnnotation||"coerce");else a=r(a,o,e.typeAnnotation||"assert")}if(!(a instanceof Jn)&&"resolvedImage"!==a.type.kind&&function t(e){if(e instanceof Oi)return t(e.boundExpression);if(e instanceof ui&&"error"===e.name)return!1;if(e instanceof li)return!1;if(e instanceof Ei)return!1;var r=e instanceof ai||e instanceof ei,n=!0;return e.eachChild((function(e){n=r?n&&t(e):n&&e instanceof Jn})),!!n&&Si(e)&&Ci(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(a)){var u=new si;try{a=new Jn(a.type,a.evaluate(u))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Pi.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new Pi(this.registry,n,e||null,i,this.errors)},Pi.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new An(n,t))},Pi.prototype.checkSubtype=function(t,e){var r=Nn(t,e);return r&&this.error(r),r};var Ii=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var a=i[n],o=a[1];this.labels.push(a[0]),this.outputs.push(o)}};function ki(t,e,r){return t*(1-r)+e*r}Ii.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Tn);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var a=1;a<t.length;a+=2){var o=1===a?-1/0:t[a],s=t[a+1],u=a,l=a+1;if("number"!=typeof o)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=o)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,n.push([o,c])}return new Ii(i,r,n)},Ii.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[Li(e,n)].evaluate(t)},Ii.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Ii.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ii.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Ri=Object.freeze({__proto__:null,number:ki,color:function(t,e,r){return new Vn(ki(t.r,e.r,r),ki(t.g,e.g,r),ki(t.b,e.b,r),ki(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,n){return ki(t,e[n],r)}))}}),Di=6/29*3*(6/29),Bi=Math.PI/180,Fi=180/Math.PI;function ji(t){return t>.008856451679035631?Math.pow(t,1/3):t/Di+4/29}function Ni(t){return t>6/29?t*t*t:Di*(t-4/29)}function Ui(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function zi(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Gi(t){var e=zi(t.r),r=zi(t.g),n=zi(t.b),i=ji((.4124564*e+.3575761*r+.1804375*n)/.95047),a=ji((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*a-16,a:500*(i-a),b:200*(a-ji((.0193339*e+.119192*r+.9503041*n)/1.08883)),alpha:t.a}}function Vi(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*Ni(e),r=.95047*Ni(r),n=1.08883*Ni(n),new Vn(Ui(3.2404542*r-1.5371385*e-.4985314*n),Ui(-.969266*r+1.8760108*e+.041556*n),Ui(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Hi(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var Wi={forward:Gi,reverse:Vi,interpolate:function(t,e,r){return{l:ki(t.l,e.l,r),a:ki(t.a,e.a,r),b:ki(t.b,e.b,r),alpha:ki(t.alpha,e.alpha,r)}}},$i={forward:function(t){var e=Gi(t),r=e.l,n=e.a,i=e.b,a=Math.atan2(i,n)*Fi;return{h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Bi,r=t.c;return Vi({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Hi(t.h,e.h,r),c:ki(t.c,e.c,r),l:ki(t.l,e.l,r),alpha:ki(t.alpha,e.alpha,r)}}},qi=Object.freeze({__proto__:null,lab:Wi,hcl:$i}),Xi=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var a=0,o=i;a<o.length;a+=1){var s=o[a],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function Ki(t,e,r,n){var i=n-r,a=t-r;return 0===i?0:1===e?a/i:(Math.pow(e,a)-1)/(Math.pow(e,i)-1)}Xi.interpolationFactor=function(t,e,n,i){var a=0;if("exponential"===t.name)a=Ki(e,t.base,n,i);else if("linear"===t.name)a=Ki(e,1,n,i);else if("cubic-bezier"===t.name){var o=t.controlPoints;a=new r(o[0],o[1],o[2],o[3]).solve(Ki(e,1,n,i))}return a},Xi.parse=function(t,e){var r=t[0],n=t[1],i=t[2],a=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var o=n[1];if("number"!=typeof o)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:o}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Tn)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=Pn:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<a.length;c+=2){var h=a[c],f=a[c+1],d=c+3,p=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);var m=e.parse(f,p,l);if(!m)return null;l=l||m.type,u.push([h,m])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new Xi(l,r,n,i,u):e.error("Type "+Fn(l)+" is not interpolatable.")},Xi.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var a=Li(e,n),o=Xi.interpolationFactor(this.interpolation,n,e[a],e[a+1]),s=r[a].evaluate(t),u=r[a+1].evaluate(t);return"interpolate"===this.operator?Ri[this.type.kind.toLowerCase()](s,u,o):"interpolate-hcl"===this.operator?$i.reverse($i.interpolate($i.forward(s),$i.forward(u),o)):Wi.reverse(Wi.interpolate(Wi.forward(s),Wi.forward(u),o))},Xi.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},Xi.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Xi.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var Zi=function(t,e){this.type=t,this.args=e};Zi.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=e.parse(o[a],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s)}var u=n&&i.some((function(t){return Nn(n,t.type)}));return new Zi(u?In:r,i)},Zi.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,a=this.args;i<a.length&&(n++,(r=a[i].evaluate(t))&&r instanceof qn&&!r.available&&(e||(e=r.name),r=null,n===this.args.length&&(r=e)),null===r);i+=1);return r},Zi.prototype.eachChild=function(t){this.args.forEach(t)},Zi.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},Zi.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Yi=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Yi.prototype.evaluate=function(t){return this.result.evaluate(t)},Yi.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},Yi.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var a=e.parse(t[n+1],n+1);if(!a)return null;r.push([i,a])}var o=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return o?new Yi(r,o):null},Yi.prototype.outputDefined=function(){return this.result.outputDefined()},Yi.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};var Ji=function(t,e,r){this.type=t,this.index=e,this.input=r};Ji.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Tn),n=e.parse(t[2],2,Bn(e.expectedType||In));return r&&n?new Ji(n.type.itemType,r,n):null},Ji.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new Qn("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new Qn("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new Qn("Array index must be an integer, but found "+e+" instead.");return r[e]},Ji.prototype.eachChild=function(t){t(this.index),t(this.input)},Ji.prototype.outputDefined=function(){return!1},Ji.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Qi=function(t,e){this.type=On,this.needle=t,this.haystack=e};Qi.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,In),n=e.parse(t[2],2,In);return r&&n?Un(r.type,[On,Cn,Tn,Sn,In])?new Qi(r,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Fn(r.type)+" instead"):null},Qi.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!r)return!1;if(!zn(e,["boolean","string","number","null"]))throw new Qn("Expected first argument to be of type boolean, string, number or null, but found "+Fn(Zn(e))+" instead.");if(!zn(r,["string","array"]))throw new Qn("Expected second argument to be of type array or string, but found "+Fn(Zn(r))+" instead.");return r.indexOf(e)>=0},Qi.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Qi.prototype.outputDefined=function(){return!0},Qi.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ta=function(t,e,r){this.type=Tn,this.needle=t,this.haystack=e,this.fromIndex=r};ta.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,In),n=e.parse(t[2],2,In);if(!r||!n)return null;if(!Un(r.type,[On,Cn,Tn,Sn,In]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Fn(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Tn);return i?new ta(r,n,i):null}return new ta(r,n)},ta.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!zn(e,["boolean","string","number","null"]))throw new Qn("Expected first argument to be of type boolean, string, number or null, but found "+Fn(Zn(e))+" instead.");if(!zn(r,["string","array"]))throw new Qn("Expected second argument to be of type array or string, but found "+Fn(Zn(r))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)},ta.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},ta.prototype.outputDefined=function(){return!1},ta.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ea=function(t,e,r,n,i,a){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=a};ea.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var l=e.concat(o);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var f=h[c];if("number"!=typeof f&&"string"!=typeof f)return l.error("Branch labels must be numbers or strings.");if("number"==typeof f&&Math.abs(f)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof f&&Math.floor(f)!==f)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,Zn(f)))return null}else r=Zn(f);if(void 0!==i[String(f)])return l.error("Branch labels must be unique.");i[String(f)]=a.length}var d=e.parse(u,o,n);if(!d)return null;n=n||d.type,a.push(d)}var p=e.parse(t[1],1,In);if(!p)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==p.type.kind&&e.concat(1).checkSubtype(r,p.type)?null:new ea(r,n,p,i,a,m):null},ea.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(Zn(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},ea.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ea.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},ea.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,a=Object.keys(this.cases).sort();i<a.length;i+=1){var o=a[i];void 0===(h=n[this.cases[o]])?(n[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[h][1].push(o)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var c=l[u],h=c[0],f=c[1];e.push(1===f.length?s(f[0]):f.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var ra=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};ra.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var a=e.parse(t[i],i,On);if(!a)return null;var o=e.parse(t[i+1],i+1,r);if(!o)return null;n.push([a,o]),r=r||o.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new ra(r,n,s):null},ra.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},ra.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i)}t(this.otherwise)},ra.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},ra.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var na=function(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n};function ia(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function aa(t,e,r,n){return 0===n.compare(e,r)}function oa(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=On,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],a=e.parse(t[1],1,In);if(!a)return null;if(!ia(r,a.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+Fn(a.type)+"'.");var o=e.parse(t[2],2,In);if(!o)return null;if(!ia(r,o.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+Fn(o.type)+"'.");if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot compare types '"+Fn(a.type)+"' and '"+Fn(o.type)+"'.");n&&("value"===a.type.kind&&"value"!==o.type.kind?a=new ei(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new ei(a.type,[o])));var s=null;if(4===t.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,kn)))return null}return new i(a,o,s)},i.prototype.evaluate=function(i){var a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=Zn(a),u=Zn(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new Qn('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var l=Zn(a),c=Zn(o);if("string"!==l.kind||"string"!==c.kind)return e(i,a,o)}return this.collator?r(i,a,o,this.collator.evaluate(i)):e(i,a,o)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}na.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,In),n=e.parse(t[2],2,Tn);if(!r||!n)return null;if(!Un(r.type,[Bn(In),Cn,In]))return e.error("Expected first argument to be of type array or string, but found "+Fn(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Tn);return i?new na(r.type,r,n,i):null}return new na(r.type,r,n)},na.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!zn(e,["string","array"]))throw new Qn("Expected first argument to be of type array or string, but found "+Fn(Zn(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)},na.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},na.prototype.outputDefined=function(){return!1},na.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var sa=oa("==",(function(t,e,r){return e===r}),aa),ua=oa("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return!aa(0,e,r,n)})),la=oa("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),ca=oa(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),ha=oa("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),fa=oa(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0})),da=function(t,e,r,n,i){this.type=Cn,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};da.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Tn);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Cn)))return null;var a=null;if(n.currency&&!(a=e.parse(n.currency,1,Cn)))return null;var o=null;if(n["min-fraction-digits"]&&!(o=e.parse(n["min-fraction-digits"],1,Tn)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Tn))?null:new da(r,i,a,o,s)},da.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},da.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},da.prototype.outputDefined=function(){return!1},da.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var pa=function(t){this.type=Tn,this.input=t};pa.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+Fn(r.type)+" instead."):new pa(r):null},pa.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Qn("Expected value to be of type string or array, but found "+Fn(Zn(e))+" instead.")},pa.prototype.eachChild=function(t){t(this.input)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ma={"==":sa,"!=":ua,">":ca,"<":la,">=":fa,"<=":ha,array:ei,at:Ji,boolean:ei,case:ra,coalesce:Zi,collator:li,format:ri,image:ni,in:Qi,"index-of":ta,interpolate:Xi,"interpolate-hcl":Xi,"interpolate-lab":Xi,length:pa,let:Yi,literal:Jn,match:ea,number:ei,"number-format":da,object:ei,slice:na,step:Ii,string:ei,"to-boolean":ai,"to-color":ai,"to-number":ai,"to-string":ai,var:Oi,within:Ei};function va(t,e){var r=e[0],n=e[1],i=e[2],a=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var o=a?a.evaluate(t):1,s=Xn(r,n,i,o);if(s)throw new Qn(s);return new Vn(r/255*o,n/255*o,i/255*o,o)}function ga(t,e){return t in e}function ya(t,e){var r=e[t];return void 0===r?null:r}function _a(t){return{type:t}}function ba(t){return{result:"success",value:t}}function xa(t){return{result:"error",value:t}}function wa(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Ma(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Aa(t){return!!t.expression&&t.expression.interpolated}function Ea(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Sa(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ta(t){return t}function Ca(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Oa(t,e,r,n,i){return Ca(typeof r===i?n[r]:void 0,t.default,e.default)}function Pa(t,e,r){if("number"!==Ea(r))return Ca(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=Li(t.stops.map((function(t){return t[0]})),r);return t.stops[i][1]}function La(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==Ea(r))return Ca(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var a=Li(t.stops.map((function(t){return t[0]})),r),o=function(t,e,r,n){var i=n-r,a=t-r;return 0===i?0:1===e?a/i:(Math.pow(e,a)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],l=Ri[e.type]||Ta;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=qi[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return l(r,n,o)}}:l(s,u,o)}function Ia(t,e,r){return"color"===e.type?r=Vn.parse(r):"formatted"===e.type?r=$n.fromString(r.toString()):"resolvedImage"===e.type?r=qn.fromString(r.toString()):Ea(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Ca(r,t.default,e.default)}ui.register(ma,{error:[{kind:"error"},[Cn],function(t,e){throw new Qn(e[0].evaluate(t))}],typeof:[Cn,[In],function(t,e){return Fn(Zn(e[0].evaluate(t)))}],"to-rgba":[Bn(Tn,4),[Pn],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Pn,[Tn,Tn,Tn],va],rgba:[Pn,[Tn,Tn,Tn,Tn],va],has:{type:On,overloads:[[[Cn],function(t,e){return ga(e[0].evaluate(t),t.properties())}],[[Cn,Ln],function(t,e){var r=e[1];return ga(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:In,overloads:[[[Cn],function(t,e){return ya(e[0].evaluate(t),t.properties())}],[[Cn,Ln],function(t,e){var r=e[1];return ya(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[In,[Cn],function(t,e){return ya(e[0].evaluate(t),t.featureState||{})}],properties:[Ln,[],function(t){return t.properties()}],"geometry-type":[Cn,[],function(t){return t.geometryType()}],id:[In,[],function(t){return t.id()}],zoom:[Tn,[],function(t){return t.globals.zoom}],"heatmap-density":[Tn,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tn,[],function(t){return t.globals.lineProgress||0}],"sky-radial-progress":[Tn,[],function(t){return t.globals.skyRadialProgress||0}],accumulated:[In,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Tn,_a(Tn),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[Tn,_a(Tn),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:Tn,overloads:[[[Tn,Tn],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[Tn],function(t,e){return-e[0].evaluate(t)}]]},"/":[Tn,[Tn,Tn],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[Tn,[Tn,Tn],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[Tn,[],function(){return Math.LN2}],pi:[Tn,[],function(){return Math.PI}],e:[Tn,[],function(){return Math.E}],"^":[Tn,[Tn,Tn],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[Tn,[Tn],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Tn,[Tn],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Tn,[Tn],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Tn,[Tn],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Tn,[Tn],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Tn,[Tn],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Tn,[Tn],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Tn,[Tn],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Tn,[Tn],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Tn,[Tn],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Tn,_a(Tn),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Tn,_a(Tn),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Tn,[Tn],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Tn,[Tn],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Tn,[Tn],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Tn,[Tn],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[On,[Cn,In],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[On,[In],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[On,[Cn],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[On,[Cn,In],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i<a}],"filter-id-<":[On,[In],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[On,[Cn,In],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i>a}],"filter-id->":[On,[In],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[On,[Cn,In],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i<=a}],"filter-id-<=":[On,[In],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[On,[Cn,In],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],a=n.value;return typeof i==typeof a&&i>=a}],"filter-id->=":[On,[In],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[On,[In],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[On,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[On,[Bn(Cn)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[On,[Bn(In)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[On,[Cn,Bn(In)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[On,[Cn,Bn(In)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:On,overloads:[[[On,On],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[_a(On),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:On,overloads:[[[On,On],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[_a(On),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[On,[On],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[On,[Cn],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[Cn,[Cn],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Cn,[Cn],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Cn,_a(In),function(t,e){return e.map((function(e){return Yn(e.evaluate(t))})).join("")}],"resolved-locale":[Cn,[kn],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var ka=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new si,this._defaultValue=e?function(t){return"color"===t.type&&Sa(t.default)?new Vn(0,0,0,0):"color"===t.type?Vn.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Ra(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ma}function Da(t,e){var r=new Pi(ma,[],e?function(t){var e={color:Pn,string:Cn,number:Tn,enum:Cn,boolean:On,formatted:Rn,resolvedImage:Dn};return"array"===t.type?Bn(e[t.value]||In,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?ba(new ka(n,e)):xa(r.errors)}ka.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)},ka.prototype.evaluate=function(t,e,r,n,i,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new Qn("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Ba=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Ti(e.expression)};Ba.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,a)},Ba.prototype.evaluate=function(t,e,r,n,i,a){return this._styleExpression.evaluate(t,e,r,n,i,a)};var Fa=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Ti(e.expression),this.interpolationType=n};function ja(t,e){if("error"===(t=Da(t,e)).result)return t;var r=t.value.expression,n=Si(r);if(!n&&!wa(e))return xa([new An("","data expressions not supported")]);var i=Ci(r,["zoom"]);if(!i&&!Ma(e))return xa([new An("","zoom expressions not supported")]);var a=function t(e){var r=null;if(e instanceof Yi)r=t(e.result);else if(e instanceof Zi)for(var n=0,i=e.args;n<i.length&&!(r=t(i[n]));n+=1);else(e instanceof Ii||e instanceof Xi)&&e.input instanceof ui&&"zoom"===e.input.name&&(r=e);return r instanceof An||e.eachChild((function(e){var n=t(e);n instanceof An?r=n:!r&&n?r=new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new An("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),r}(r);return a||i?a instanceof An?xa([a]):a instanceof Xi&&!Aa(e)?xa([new An("",'"interpolate" expressions cannot be used with this property')]):ba(a?new Fa(n?"camera":"composite",t.value,a.labels,a instanceof Xi?a.interpolation:void 0):new Ba(n?"constant":"source",t.value)):xa([new An("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Fa.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,a)},Fa.prototype.evaluate=function(t,e,r,n,i,a){return this._styleExpression.evaluate(t,e,r,n,i,a)},Fa.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?Xi.interpolationFactor(this.interpolationType,t,e,r):0};var Na=function(t,e){this._parameters=t,this._specification=e,xn(this,function t(e,r){var n,i,a,o="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(Aa(r)?"exponential":"interval");if(o&&((e=xn({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],Vn.parse(t[1])]}))),e.default=Vn.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!qi[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)n=La;else if("interval"===l)n=Pa;else if("categorical"===l){n=Oa,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var f=h[c];i[f[0]]=f[1]}a=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');n=Ia}if(s){for(var d={},p=[],m=0;m<e.stops.length;m++){var v=e.stops[m],g=v[0].zoom;void 0===d[g]&&(d[g]={zoom:g,type:e.type,property:e.property,default:e.default,stops:[]},p.push(g)),d[g].stops.push([v[0].value,v[1]])}for(var y=[],_=0,b=p;_<b.length;_+=1){var x=b[_];y.push([d[x].zoom,t(d[x],r)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:Xi.interpolationFactor.bind(void 0,w),zoomStops:y.map((function(t){return t[0]})),evaluate:function(t,n){var i=t.zoom;return La({stops:y,base:e.base},r,i).evaluate(i,n)}}}if(u){var M="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Xi.interpolationFactor.bind(void 0,M),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return n(e,r,t.zoom,i,a)}}}return{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Ca(e.default,r.default):n(e,r,s,i,a)}}}(this._parameters,this._specification))};function Ua(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=Ea(r);if("object"!==u)return[new _n(e,r,"object expected, "+u+" found")];for(var l in r){var c=l.split(".")[0],h=n[c]||n["*"],f=void 0;if(i[c])f=i[c];else if(n[c])f=ho;else if(i["*"])f=i["*"];else{if(!n["*"]){s.push(new _n(e,r[l],'unknown property "'+l+'"'));continue}f=ho}s=s.concat(f({key:(e?e+".":e)+l,value:r[l],valueSpec:h,style:a,styleSpec:o,object:r,objectKey:l},r))}for(var d in n)i[d]||n[d].required&&void 0===n[d].default&&void 0===r[d]&&s.push(new _n(e,r,'missing required property "'+d+'"'));return s}function za(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,a=t.key,o=t.arrayElementValidator||ho;if("array"!==Ea(e))return[new _n(a,e,"array expected, "+Ea(e)+" found")];if(r.length&&e.length!==r.length)return[new _n(a,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new _n(a,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===Ea(r.value)&&(s=r.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(o({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:n,styleSpec:i,key:a+"["+l+"]"}));return u}function Ga(t){var e=t.key,r=t.value,n=t.valueSpec,i=Ea(r);return"number"===i&&r!=r&&(i="NaN"),"number"!==i?[new _n(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new _n(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new _n(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function Va(t){var e,r,n,i=t.valueSpec,a=wn(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,l="array"===Ea(t.value.stops)&&"array"===Ea(t.value.stops[0])&&"object"===Ea(t.value.stops[0][0]),c=Ua({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new _n(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(za({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Ea(r)&&0===r.length&&e.push(new _n(t.key,r,"array must have at least one stop")),e},default:function(t){return ho({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&c.push(new _n(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||c.push(new _n(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!Aa(t.valueSpec)&&c.push(new _n(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!wa(t.valueSpec)?c.push(new _n(t.key,t.value,"property functions not supported")):s&&!Ma(t.valueSpec)&&c.push(new _n(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==t.value.property||c.push(new _n(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],a=t.value,s=t.key;if("array"!==Ea(a))return[new _n(s,a,"array expected, "+Ea(a)+" found")];if(2!==a.length)return[new _n(s,a,"array length 2 expected, length "+a.length+" found")];if(l){if("object"!==Ea(a[0]))return[new _n(s,a,"object expected, "+Ea(a[0])+" found")];if(void 0===a[0].zoom)return[new _n(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new _n(s,a,"object stop key must have value")];if(n&&n>wn(a[0].zoom))return[new _n(s,a[0].zoom,"stop zoom values must appear in ascending order")];wn(a[0].zoom)!==n&&(n=wn(a[0].zoom),r=void 0,o={}),e=e.concat(Ua({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Ga,value:f}}))}else e=e.concat(f({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return Ra(Mn(a[1]))?e.concat([new _n(s+"[1]",a[1],"expressions are not allowed in function stops.")]):e.concat(ho({key:s+"[1]",value:a[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function f(t,n){var s=Ea(t.value),u=wn(t.value),l=null!==t.value?t.value:n;if(e){if(s!==e)return[new _n(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new _n(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, "+s+" found";return wa(i)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _n(t.key,l,c)]}return"categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==r&&u<r?[new _n(t.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===a&&u in o?[new _n(t.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new _n(t.key,l,"integer expected, found "+u)]}}function Ha(t){var e=("property"===t.expressionContext?ja:Da)(Mn(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new _n(""+t.key+e.key,t.value,e.message)}));var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new _n(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Ti(r))return[new _n(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Ti(r))return[new _n(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ci(r,["zoom","feature-state"]))return[new _n(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Si(r))return[new _n(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Wa(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(wn(r))&&i.push(new _n(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(wn(r))&&i.push(new _n(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function $a(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!$a(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Na.deserialize=function(t){return new Na(t._parameters,t._specification)},Na.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var qa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xa(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};$a(t)||(t=Za(t));var e=Da(t,qa);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,r,n){return e.value.evaluate(t,r,{},n)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var r=1;r<e.length;r++)if(t(e[r]))return!0;return!1}(t)}}function Ka(t,e){return t<e?-1:t>e?1:0}function Za(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?Ya(t[1],t[2],"=="):"!="===r?to(Ya(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Ya(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Za))):"all"===r?["all"].concat(t.slice(1).map(Za)):"none"===r?["all"].concat(t.slice(1).map(Za).map(to)):"in"===r?Ja(t[1],t.slice(2)):"!in"===r?to(Ja(t[1],t.slice(2))):"has"===r?Qa(t[1]):"!has"===r?to(Qa(t[1])):"within"!==r||t}function Ya(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Ja(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return typeof t!=typeof e[0]}))?["filter-in-large",t,["literal",e.sort(Ka)]]:["filter-in-small",t,["literal",e]]}}function Qa(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function to(t){return["!",t]}function eo(t){return $a(Mn(t.value))?Ha(xn({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==Ea(r))return[new _n(n,r,"array expected, "+Ea(r)+" found")];var i,a=e.styleSpec,o=[];if(r.length<1)return[new _n(n,r,"filter array must have at least 1 element")];switch(o=o.concat(Wa({key:n+"[0]",value:r[0],valueSpec:a.filter_operator,style:e.style,styleSpec:e.styleSpec})),wn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===wn(r[1])&&o.push(new _n(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&o.push(new _n(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(i=Ea(r[1]))&&o.push(new _n(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=Ea(r[s]),"$type"===wn(r[1])?o=o.concat(Wa({key:n+"["+s+"]",value:r[s],valueSpec:a.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new _n(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)o=o.concat(t({key:n+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Ea(r[1]),2!==r.length?o.push(new _n(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&o.push(new _n(n+"[1]",r[1],"string expected, "+i+" found"));break;case"within":i=Ea(r[1]),2!==r.length?o.push(new _n(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"object"!==i&&o.push(new _n(n+"[1]",r[1],"object expected, "+i+" found"))}return o}(t)}function ro(t,e){var r=t.key,n=t.style,i=t.styleSpec,a=t.value,o=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return ho({key:r,value:a,valueSpec:i.transition,style:n,styleSpec:i});var l,c=t.valueSpec||s[o];if(!c)return[new _n(r,a,'unknown property "'+o+'"')];if("string"===Ea(a)&&wa(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new _n(r,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&n&&!n.glyphs&&h.push(new _n(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Sa(Mn(a))&&"identity"===wn(a.type)&&h.push(new _n(r,a,'"text-font" does not support identity functions'))),h.concat(ho({key:t.key,value:a,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:o}))}function no(t){return ro(t,"paint")}function io(t){return ro(t,"layout")}function ao(t){var e=[],r=t.value,n=t.key,i=t.style,a=t.styleSpec;r.type||r.ref||e.push(new _n(n,r,'either "type" or "ref" is required'));var o,s=wn(r.type),u=wn(r.ref);if(r.id)for(var l=wn(r.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];wn(h.id)===l&&e.push(new _n(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach((function(t){t in r&&e.push(new _n(n,r[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){wn(t.id)===u&&(o=t)})),o?o.ref?e.push(new _n(n,r.ref,"ref cannot reference another ref layer")):s=wn(o.type):e.push(new _n(n,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s&&"sky"!==s)if(r.source){var f=i.sources&&i.sources[r.source],d=f&&wn(f.type);f?"vector"===d&&"raster"===s?e.push(new _n(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===d&&"raster"!==s?e.push(new _n(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==d||r["source-layer"]?"raster-dem"===d&&"hillshade"!==s?e.push(new _n(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===d&&f.lineMetrics||e.push(new _n(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new _n(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new _n(n,r.source,'source "'+r.source+'" not found'))}else e.push(new _n(n,r,'missing required property "source"'));return e=e.concat(Ua({key:n,value:r,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ho({key:n+".type",value:r.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:eo,layout:function(t){return Ua({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return io(xn({layerType:s},t))}}})},paint:function(t){return Ua({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return no(xn({layerType:s},t))}}})}}}))}function oo(t){var e=t.value,r=t.key,n=Ea(e);return"string"!==n?[new _n(r,e,"string expected, "+n+" found")]:[]}var so={promoteId:function(t){var e=t.key,r=t.value;if("string"===Ea(r))return oo({key:e,value:r});var n=[];for(var i in r)n.push.apply(n,oo({key:e+"."+i,value:r[i]}));return n}};function uo(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new _n(r,e,'"type" is required')];var a,o=wn(e.type);switch(o){case"vector":case"raster":case"raster-dem":return Ua({key:r,value:e,valueSpec:n["source_"+o.replace("-","_")],style:t.style,styleSpec:n,objectElementValidators:so});case"geojson":if(a=Ua({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:so}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;a.push.apply(a,Ha({key:r+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),a.push.apply(a,Ha({key:r+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return a;case"video":return Ua({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Ua({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new _n(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wa({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function lo(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,a=[],o=Ea(e);if(void 0===e)return a;if("object"!==o)return a.concat([new _n("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=a.concat(u&&n[u[1]]&&n[u[1]].transition?ho({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?ho({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new _n(s,e[s],'unknown property "'+s+'"')])}return a}var co={"*":function(){return[]},array:za,boolean:function(t){var e=t.value,r=t.key,n=Ea(e);return"boolean"!==n?[new _n(r,e,"boolean expected, "+n+" found")]:[]},number:Ga,color:function(t){var e=t.key,r=t.value,n=Ea(r);return"string"!==n?[new _n(e,r,"color expected, "+n+" found")]:null===Gn(r)?[new _n(e,r,'color expected, "'+r+'" found')]:[]},constants:bn,enum:Wa,filter:eo,function:Va,layer:ao,object:Ua,source:uo,light:lo,string:oo,formatted:function(t){return 0===oo(t).length?[]:Ha(t)},resolvedImage:function(t){return 0===oo(t).length?[]:Ha(t)}};function ho(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&Sa(wn(e))?Va(t):r.expression&&Ra(Mn(e))?Ha(t):r.type&&co[r.type]?co[r.type](t):Ua(xn({},t,{valueSpec:r.type?n[r.type]:r}))}function fo(t){var e=t.value,r=t.key,n=oo(t);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new _n(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new _n(r,e,'"glyphs" url must include a "{range}" token'))),n}function po(t,e){void 0===e&&(e=yn);var r=[];return r=r.concat(ho({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:fo,"*":function(){return[]}}})),t.constants&&(r=r.concat(bn({key:"constants",value:t.constants,style:t,styleSpec:e}))),mo(r)}function mo(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function vo(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return mo(t.apply(this,e))}}po.source=vo(uo),po.light=vo(lo),po.layer=vo(ao),po.filter=vo(eo),po.paintProperty=vo(no),po.layoutProperty=vo(io);var go=po,yo=go.light,_o=go.paintProperty,bo=go.layoutProperty;function xo(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1)t.fire(new vn(new Error(i[n].message))),r=!0;return r}var wo=Mo;function Mo(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[3+a],s=i[3+a+1];n.push(o===s?null:i.subarray(o,s))}var u=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var l=0;l<this.d*this.d;l++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}Mo.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Mo.prototype._insertCell=function(t,e,r,n,i,a){this.cells[i].push(a)},Mo.prototype.query=function(t,e,r,n,i){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},Mo.prototype._queryCell=function(t,e,r,n,i,a,o,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var f=u[h];if(void 0===o[f]){var d=4*f;(s?s(c[d+0],c[d+1],c[d+2],c[d+3]):t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&n>=c[d+1])?(o[f]=!0,a.push(l[f])):o[f]=!1}}},Mo.prototype._forEachCell=function(t,e,r,n,i,a,o,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),f=u;f<=c;f++)for(var d=l;d<=h;d++){var p=this.d*d+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(d),this._convertFromCellCoord(f+1),this._convertFromCellCoord(d+1)))&&i.call(this,t,e,r,n,p,a,o,s))return}},Mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];i[3+o]=a,i.set(s,a),a+=s.length}return i[3+t.length]=a,i.set(this.keys,a),i[3+t.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var Ao=o.ImageData,Eo=o.ImageBitmap,So={};function To(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),So[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var Co in To("Object",Object),wo.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},wo.deserialize=function(t){return new wo(t.buffer)},To("Grid",wo),To("Color",Vn),To("Error",Error),To("ResolvedImage",qn),To("StylePropertyFunction",Na),To("StyleExpression",ka,{omit:["_evaluator"]}),To("ZoomDependentExpression",Fa),To("ZoomConstantExpression",Ba),To("CompoundExpression",ui,{omit:["_evaluate"]}),ma)ma[Co]._classRegistryKey||To("Expression_"+Co,ma[Co]);function Oo(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Po(t){return Eo&&t instanceof Eo}function Lo(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Oo(t)||Po(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Ao)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,a=t;i<a.length;i+=1)n.push(Lo(a[i],e));return n}if("object"==typeof t){var o=t.constructor,s=o._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=o.serialize?o.serialize(t,e):{};if(!o.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(So[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=So[s].shallow.indexOf(l)>=0?c:Lo(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Io(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Oo(t)||Po(t)||ArrayBuffer.isView(t)||t instanceof Ao)return t;if(Array.isArray(t))return t.map(Io);if("object"==typeof t){var e=t.$name||"Object",r=So[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,a=Object.keys(t);i<a.length;i+=1){var o=a[i];if("$name"!==o){var s=t[o];n[o]=So[e].shallow.indexOf(o)>=0?s:Io(s)}}return n}throw new Error("can't deserialize object of type "+typeof t)}var ko=function(){this.first=!0};ko.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var Ro={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function Do(t){for(var e=0,r=t;e<r.length;e+=1)if(Bo(r[e].charCodeAt(0)))return!0;return!1}function Bo(t){return!(746!==t&&747!==t&&(t<4352||!(Ro["Bopomofo Extended"](t)||Ro.Bopomofo(t)||Ro["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ro["CJK Compatibility Ideographs"](t)||Ro["CJK Compatibility"](t)||Ro["CJK Radicals Supplement"](t)||Ro["CJK Strokes"](t)||!(!Ro["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ro["CJK Unified Ideographs Extension A"](t)||Ro["CJK Unified Ideographs"](t)||Ro["Enclosed CJK Letters and Months"](t)||Ro["Hangul Compatibility Jamo"](t)||Ro["Hangul Jamo Extended-A"](t)||Ro["Hangul Jamo Extended-B"](t)||Ro["Hangul Jamo"](t)||Ro["Hangul Syllables"](t)||Ro.Hiragana(t)||Ro["Ideographic Description Characters"](t)||Ro.Kanbun(t)||Ro["Kangxi Radicals"](t)||Ro["Katakana Phonetic Extensions"](t)||Ro.Katakana(t)&&12540!==t||!(!Ro["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ro["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ro["Unified Canadian Aboriginal Syllabics"](t)||Ro["Unified Canadian Aboriginal Syllabics Extended"](t)||Ro["Vertical Forms"](t)||Ro["Yijing Hexagram Symbols"](t)||Ro["Yi Syllables"](t)||Ro["Yi Radicals"](t))))}function Fo(t){return!(Bo(t)||function(t){return!!(Ro["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ro["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ro["Letterlike Symbols"](t)||Ro["Number Forms"](t)||Ro["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ro["Control Pictures"](t)&&9251!==t||Ro["Optical Character Recognition"](t)||Ro["Enclosed Alphanumerics"](t)||Ro["Geometric Shapes"](t)||Ro["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ro["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ro["CJK Symbols and Punctuation"](t)||Ro.Katakana(t)||Ro["Private Use Area"](t)||Ro["CJK Compatibility Forms"](t)||Ro["Small Form Variants"](t)||Ro["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function jo(t){return t>=1424&&t<=2303||Ro["Arabic Presentation Forms-A"](t)||Ro["Arabic Presentation Forms-B"](t)}function No(t,e){return!(!e&&jo(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ro.Khmer(t))}function Uo(t){for(var e=0,r=t;e<r.length;e+=1)if(jo(r[e].charCodeAt(0)))return!0;return!1}var zo=null,Go="unavailable",Vo=null,Ho=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Go="error"),zo&&zo(t)};function Wo(){$o.fire(new mn("pluginStateChange",{pluginStatus:Go,pluginURL:Vo}))}var $o=new gn,qo=function(){return Go},Xo=function(){if("deferred"!==Go||!Vo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Go="loading",Wo(),Vo&&ln({url:Vo},(function(t){t?Ho(t):(Go="loaded",Wo())}))},Ko={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===Go||null!=Ko.applyArabicShaping},isLoading:function(){return"loading"===Go},setState:function(t){Go=t.pluginStatus,Vo=t.pluginURL},isParsed:function(){return null!=Ko.applyArabicShaping&&null!=Ko.processBidirectionalText&&null!=Ko.processStyledBidirectionalText},getPluginURL:function(){return Vo}},Zo=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ko,this.transition={})};Zo.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!No(n[r].charCodeAt(0),e))return!1;return!0}(t,Ko.isLoaded())},Zo.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Zo.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var Yo=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Sa(t))return new Na(t,e);if(Ra(t)){var r=ja(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=Vn.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification)};Yo.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},Yo.prototype.possiblyEvaluate=function(t,e,r){return this.property.possiblyEvaluate(this,t,e,r)};var Jo=function(t){this.property=t,this.value=new Yo(t,void 0)};Jo.prototype.transitioned=function(t,e){return new ts(this.property,this.value,e,m({},t.transition,this.transition),t.now)},Jo.prototype.untransitioned=function(){return new ts(this.property,this.value,null,{},0)};var Qo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Qo.prototype.getValue=function(t){return A(this._values[t].value.value)},Qo.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Jo(this._values[t].property)),this._values[t].value=new Yo(this._values[t].property,null===e?void 0:A(e))},Qo.prototype.getTransition=function(t){return A(this._values[t].transition)},Qo.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Jo(this._values[t].property)),this._values[t].transition=A(e)||void 0},Qo.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var a=this.getTransition(n);void 0!==a&&(t[n+"-transition"]=a)}return t},Qo.prototype.transitioned=function(t,e){for(var r=new es(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var a=i[n];r._values[a]=this._values[a].transitioned(t,e._values[a])}return r},Qo.prototype.untransitioned=function(){for(var t=new es(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var ts=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};ts.prototype.possiblyEvaluate=function(t,e,r){var n=t.now||0,i=this.value.possiblyEvaluate(t,e,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return a.possiblyEvaluate(t,e,r);var o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t,e,r),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(o))}return i};var es=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};es.prototype.possiblyEvaluate=function(t,e,r){for(var n=new is(this._properties),i=0,a=Object.keys(this._values);i<a.length;i+=1){var o=a[i];n._values[o]=this._values[o].possiblyEvaluate(t,e,r)}return n},es.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var rs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};rs.prototype.getValue=function(t){return A(this._values[t].value)},rs.prototype.setValue=function(t,e){this._values[t]=new Yo(this._values[t].property,null===e?void 0:A(e))},rs.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},rs.prototype.possiblyEvaluate=function(t,e,r){for(var n=new is(this._properties),i=0,a=Object.keys(this._values);i<a.length;i+=1){var o=a[i];n._values[o]=this._values[o].possiblyEvaluate(t,e,r)}return n};var ns=function(t,e,r){this.property=t,this.value=e,this.parameters=r};ns.prototype.isConstant=function(){return"constant"===this.value.kind},ns.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},ns.prototype.evaluate=function(t,e,r,n){return this.property.evaluate(this.value,this.parameters,t,e,r,n)};var is=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};is.prototype.get=function(t){return this._values[t]};var as=function(t){this.specification=t};as.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},as.prototype.interpolate=function(t,e,r){var n=Ri[this.specification.type];return n?n(t,e,r):t};var os=function(t,e){this.specification=t,this.overrides=e};os.prototype.possiblyEvaluate=function(t,e,r,n){return new ns(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r,n)}:t.expression,e)},os.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new ns(this,{kind:"constant",value:void 0},t.parameters);var n=Ri[this.specification.type];return n?new ns(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},os.prototype.evaluate=function(t,e,r,n,i,a){return"constant"===t.kind?t.value:t.evaluate(e,r,n,i,a)};var ss=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0===t.value)return new ns(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n),a="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,o=this._calculate(a,a,a,e);return new ns(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new ns(this,{kind:"constant",value:s},e)}return new ns(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,n,i,a){if("source"===t.kind){var o=t.evaluate(e,r,n,i,a);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value},e.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(os),us=function(t){this.specification=t};us.prototype.possiblyEvaluate=function(t,e,r,n){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},r,n);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new Zo(Math.floor(e.zoom-1),e)),t.expression.evaluate(new Zo(Math.floor(e.zoom),e)),t.expression.evaluate(new Zo(Math.floor(e.zoom+1),e)),e)}},us.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},us.prototype.interpolate=function(t){return t};var ls=function(t){this.specification=t};ls.prototype.possiblyEvaluate=function(t,e,r,n){return!!t.expression.evaluate(e,null,{},r,n)},ls.prototype.interpolate=function(){return!1};var cs=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new Yo(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new Jo(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};To("DataDrivenProperty",os),To("DataConstantProperty",as),To("CrossFadedDataDrivenProperty",ss),To("CrossFadedProperty",us),To("ColorRampProperty",ls);var hs=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new rs(r.layout)),r.paint)){for(var n in this._transitionablePaint=new Qo(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new is(r.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){void 0===r&&(r={}),null!=e&&this._validate(bo,"layers."+this.id+".layout."+t,t,e,r)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return x(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(void 0===r&&(r={}),null!=e&&this._validate(_o,"layers."+this.id+".paint."+t,t,e,r))return!1;if(x(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],a=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||a||i||this._handleOverridablePaintPropertyUpdate(t,o,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),M(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&xo(this,t.call(go,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:yn,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isSky=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof ns&&wa(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(gn),fs={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ds=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ps=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ms(t,e){void 0===e&&(e=1);var r=0,n=0;return{members:t.map((function(t){var i=fs[t.type].BYTES_PER_ELEMENT,a=r=vs(r,Math.max(e,i)),o=t.components||1;return n=Math.max(n,i),r+=i*o,{name:t.name,type:t.type,components:o,offset:a}})),size:vs(r,Math.max(n,e)),alignment:e}}function vs(t,e){return Math.ceil(t/e)*e}ps.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ps.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},ps.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ps.prototype.clear=function(){this.length=0},ps.prototype.resize=function(t){this.reserve(t),this.length=t},ps.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},ps.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var gs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t},e}(ps);gs.prototype.bytesPerElement=4,To("StructArrayLayout2i4",gs);var ys=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,t},e}(ps);ys.prototype.bytesPerElement=8,To("StructArrayLayout4i8",ys);var _s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(ps);_s.prototype.bytesPerElement=12,To("StructArrayLayout2i4i12",_s);var bs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=a,this.uint8[u+7]=o,t},e}(ps);bs.prototype.bytesPerElement=8,To("StructArrayLayout2i4ub8",bs);var xs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t},e}(ps);xs.prototype.bytesPerElement=8,To("StructArrayLayout2f8",xs);var ws=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,r,n,i,a,o,s,u,l)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,c){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=r,this.uint16[h+2]=n,this.uint16[h+3]=i,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=l,this.uint16[h+9]=c,t},e}(ps);ws.prototype.bytesPerElement=20,To("StructArrayLayout10ui20",ws);var Ms=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,c,h){var f=this.length;return this.resize(f+1),this.emplace(f,t,e,r,n,i,a,o,s,u,l,c,h)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,c,h,f){var d=12*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.int16[d+2]=n,this.int16[d+3]=i,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=u,this.int16[d+8]=l,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=f,t},e}(ps);Ms.prototype.bytesPerElement=24,To("StructArrayLayout4i4ui4i24",Ms);var As=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t},e}(ps);As.prototype.bytesPerElement=12,To("StructArrayLayout3f12",As);var Es=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(ps);Es.prototype.bytesPerElement=4,To("StructArrayLayout1ul4",Es);var Ss=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,r,n,i,a,o,s,u)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l){var c=10*t,h=5*t;return this.int16[c+0]=e,this.int16[c+1]=r,this.int16[c+2]=n,this.int16[c+3]=i,this.int16[c+4]=a,this.int16[c+5]=o,this.uint32[h+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=l,t},e}(ps);Ss.prototype.bytesPerElement=20,To("StructArrayLayout6i1ul2ui20",Ss);var Ts=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,r,n,i,a)},e.prototype.emplace=function(t,e,r,n,i,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(ps);Ts.prototype.bytesPerElement=12,To("StructArrayLayout2i2i2i12",Ts);var Cs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i)},e.prototype.emplace=function(t,e,r,n,i,a){var o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[s+6]=i,this.int16[s+7]=a,t},e}(ps);Cs.prototype.bytesPerElement=16,To("StructArrayLayout2f1f2i16",Cs);var Os=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=12*t,o=3*t;return this.uint8[a+0]=e,this.uint8[a+1]=r,this.float32[o+1]=n,this.float32[o+2]=i,t},e}(ps);Os.prototype.bytesPerElement=12,To("StructArrayLayout2ub2f12",Os);var Ps=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t},e}(ps);Ps.prototype.bytesPerElement=6,To("StructArrayLayout3ui6",Ps);var Ls=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v){var g=this.length;return this.resize(g+1),this.emplace(g,t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g){var y=24*t,_=12*t,b=48*t;return this.int16[y+0]=e,this.int16[y+1]=r,this.uint16[y+2]=n,this.uint16[y+3]=i,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=l,this.uint16[y+12]=c,this.float32[_+7]=h,this.float32[_+8]=f,this.uint8[b+36]=d,this.uint8[b+37]=p,this.uint8[b+38]=m,this.uint32[_+10]=v,this.int16[y+22]=g,t},e}(ps);Ls.prototype.bytesPerElement=48,To("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ls);var Is=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,E,S,T){var C=this.length;return this.resize(C+1),this.emplace(C,t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,E,S,T)},e.prototype.emplace=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,E,S,T,C){var O=34*t,P=17*t;return this.int16[O+0]=e,this.int16[O+1]=r,this.int16[O+2]=n,this.int16[O+3]=i,this.int16[O+4]=a,this.int16[O+5]=o,this.int16[O+6]=s,this.int16[O+7]=u,this.uint16[O+8]=l,this.uint16[O+9]=c,this.uint16[O+10]=h,this.uint16[O+11]=f,this.uint16[O+12]=d,this.uint16[O+13]=p,this.uint16[O+14]=m,this.uint16[O+15]=v,this.uint16[O+16]=g,this.uint16[O+17]=y,this.uint16[O+18]=_,this.uint16[O+19]=b,this.uint16[O+20]=x,this.uint16[O+21]=w,this.uint16[O+22]=M,this.uint32[P+12]=A,this.float32[P+13]=E,this.float32[P+14]=S,this.float32[P+15]=T,this.float32[P+16]=C,t},e}(ps);Is.prototype.bytesPerElement=68,To("StructArrayLayout8i15ui1ul4f68",Is);var ks=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(ps);ks.prototype.bytesPerElement=4,To("StructArrayLayout1f4",ks);var Rs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t},e}(ps);Rs.prototype.bytesPerElement=6,To("StructArrayLayout3i6",Rs);var Ds=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=r,this.uint16[i+3]=n,t},e}(ps);Ds.prototype.bytesPerElement=8,To("StructArrayLayout1ul2ui8",Ds);var Bs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t},e}(ps);Bs.prototype.bytesPerElement=4,To("StructArrayLayout2ui4",Bs);var Fs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(ps);Fs.prototype.bytesPerElement=2,To("StructArrayLayout1ui2",Fs);var js=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,t},e}(ps);js.prototype.bytesPerElement=16,To("StructArrayLayout4f16",js);var Ns=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(ds);Ns.prototype.size=20;var Us=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ns(this,t)},e}(Ss);To("CollisionBoxArray",Us);var zs=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,r),e}(ds);zs.prototype.size=48;var Gs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new zs(this,t)},e}(Ls);To("PlacedSymbolArray",Gs);var Vs=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,r),e}(ds);Vs.prototype.size=68;var Hs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Vs(this,t)},e}(Is);To("SymbolInstanceArray",Hs);var Ws=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(ks);To("GlyphOffsetArray",Ws);var $s=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Rs);To("SymbolLineVertexArray",$s);var qs=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,r),e}(ds);qs.prototype.size=8;var Xs=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new qs(this,t)},e}(Ds);To("FeatureIndexArray",Xs);var Ks=ms([{name:"a_pos",components:2,type:"Int16"}],4).members,Zs=function(t){void 0===t&&(t=[]),this.segments=t};function Ys(t,e){return 256*(t=d(Math.floor(t),0,255))+d(Math.floor(e),0,255)}Zs.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return t>Zs.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+Zs.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>Zs.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},Zs.prototype.get=function(){return this.segments},Zs.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},Zs.simpleSegment=function(t,e,r,n){return new Zs([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},Zs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,To("SegmentVector",Zs);var Js=ms([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Qs=e((function(t){t.exports=function(t,e){var r,n,i,a,o,s,u,l;for(n=t.length-(r=3&t.length),i=e,o=3432918353,s=461845907,l=0;l<n;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),tu=e((function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,a=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(a)|(255&t.charCodeAt(++a))<<8|(255&t.charCodeAt(++a))<<16|(255&t.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:i^=(255&t.charCodeAt(a+2))<<16;case 2:i^=(255&t.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),eu=Qs,ru=tu;eu.murmur3=Qs,eu.murmur2=ru;var nu=function(){this.ids=[],this.positions=[],this.indexed=!1};function iu(t){var e=+t;return!isNaN(e)&&e<=s?e:eu(String(t))}function au(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}nu.prototype.add=function(t,e,r,n){this.ids.push(iu(t)),this.positions.push(e,r,n)},nu.prototype.getPositions=function(t){for(var e=iu(t),r=0,n=this.ids.length-1;r<n;){var i=r+n>>1;this.ids[i]>=e?n=i:r=i+1}for(var a=[];this.ids[r]===e;)a.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return a},nu.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){for(;n<i;){for(var a=e[n+i>>1],o=n-1,s=i+1;;){do{o++}while(e[o]<a);do{s--}while(e[s]>a);if(o>=s)break;au(e,o,s),au(r,3*o,3*s),au(r,3*o+1,3*s+1),au(r,3*o+2,3*s+2)}s-n<i-s?(t(e,r,n,s),n=s+1):(t(e,r,s+1,i),i=s)}}(r,n,0,r.length-1),e&&e.push(r.buffer,n.buffer),{ids:r,positions:n}},nu.deserialize=function(t){var e=new nu;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},To("FeaturePositionMap",nu);var ou=function(t,e){this.gl=t.gl,this.location=e},su=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(ou),uu=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(ou),lu=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(ou),cu=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(ou),hu=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(ou),fu=function(t){function e(e,r){t.call(this,e,r),this.current=Vn.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(ou),du=new Float32Array(16),pu=function(t){function e(e,r){t.call(this,e,r),this.current=du}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(ou),mu=new Float32Array(9);function vu(t){return[Ys(255*t.r,255*t.g),Ys(255*t.b,255*t.a)]}!function(t){function e(e,r){t.call(this,e,r),this.current=mu}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){for(var e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}}(ou);var gu=function(t,e,r){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=r};gu.prototype.setUniform=function(t,e,r){t.set(r.constantOr(this.value))},gu.prototype.getBinding=function(t,e,r){return"color"===this.type?new fu(t,e):new uu(t,e)};var yu=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};yu.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},yu.prototype.setUniform=function(t,e,r,n){var i="u_pattern_to"===n?this.patternTo:"u_pattern_from"===n?this.patternFrom:"u_pixel_ratio_to"===n?this.pixelRatioTo:"u_pixel_ratio_from"===n?this.pixelRatioFrom:null;i&&t.set(i)},yu.prototype.getBinding=function(t,e,r){return"u_pattern"===r.substr(0,9)?new hu(t,e):new uu(t,e)};var _u=function(t,e,r,n){this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}})),this.paintVertexArray=new n};_u.prototype.populatePaintArray=function(t,e,r,n,i){var a=this.paintVertexArray.length,o=this.expression.evaluate(new Zo(0),e,{},n,[],i);this.paintVertexArray.resize(t),this._setPaintValue(a,t,o)},_u.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:0},r,n);this._setPaintValue(t,e,i)},_u.prototype._setPaintValue=function(t,e,r){if("color"===this.type)for(var n=vu(r),i=t;i<e;i++)this.paintVertexArray.emplace(i,n[0],n[1]);else{for(var a=t;a<e;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},_u.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},_u.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var bu=function(t,e,r,n,i,a){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}})),this.paintVertexArray=new a};bu.prototype.populatePaintArray=function(t,e,r,n,i){var a=this.expression.evaluate(new Zo(this.zoom),e,{},n,[],i),o=this.expression.evaluate(new Zo(this.zoom+1),e,{},n,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,a,o)},bu.prototype.updatePaintArray=function(t,e,r,n){var i=this.expression.evaluate({zoom:this.zoom},r,n),a=this.expression.evaluate({zoom:this.zoom+1},r,n);this._setPaintValue(t,e,i,a)},bu.prototype._setPaintValue=function(t,e,r,n){if("color"===this.type)for(var i=vu(r),a=vu(n),o=t;o<e;o++)this.paintVertexArray.emplace(o,i[0],i[1],a[0],a[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}},bu.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},bu.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},bu.prototype.setUniform=function(t,e){var r=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,n=d(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);t.set(n)},bu.prototype.getBinding=function(t,e,r){return new uu(t,e)};var xu=function(t,e,r,n,i,a){this.expression=t,this.type=e,this.useIntegerZoom=r,this.zoom=n,this.layerId=a,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};xu.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(n,t,e.patterns&&e.patterns[this.layerId],r)},xu.prototype.updatePaintArray=function(t,e,r,n,i){this._setPaintValues(t,e,r.patterns&&r.patterns[this.layerId],i)},xu.prototype._setPaintValues=function(t,e,r,n){if(n&&r){var i=n[r.min],a=n[r.mid],o=n[r.max];if(i&&a&&o)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],a.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,a.tl[0],a.tl[1],a.br[0],a.br[1],o.tl[0],o.tl[1],o.br[0],o.br[1],a.pixelRatio,o.pixelRatio)}},xu.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Js.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Js.members,this.expression.isStateDependent))},xu.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var wu=function(t,e,r){this.binders={},this._buffers=[];var n=[];for(var i in t.paint._values)if(r(i)){var a=t.paint.get(i);if(a instanceof ns&&wa(a.property.specification)){var o=Au(i,t.type),s=a.value,u=a.property.specification.type,l=a.property.useIntegerZoom,c=a.property.specification["property-type"],h="cross-faded"===c||"cross-faded-data-driven"===c;if("constant"===s.kind)this.binders[i]=h?new yu(s.value,o):new gu(s.value,o,u),n.push("/u_"+i);else if("source"===s.kind||h){var f=Eu(i,u,"source");this.binders[i]=h?new xu(s,u,l,e,f,t.id):new _u(s,o,u,f),n.push("/a_"+i)}else{var d=Eu(i,u,"composite");this.binders[i]=new bu(s,o,u,l,e,d),n.push("/z_"+i)}}}this.cacheKey=n.sort().join("")};wu.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof _u||e instanceof bu?e.maxValue:0},wu.prototype.populatePaintArrays=function(t,e,r,n,i){for(var a in this.binders){var o=this.binders[a];(o instanceof _u||o instanceof bu||o instanceof xu)&&o.populatePaintArray(t,e,r,n,i)}},wu.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders){var n=this.binders[r];n instanceof yu&&n.setConstantPatternPositions(t,e)}},wu.prototype.updatePaintArrays=function(t,e,r,n,i){var a=!1;for(var o in t)for(var s=0,u=e.getPositions(o);s<u.length;s+=1){var l=u[s],c=r.feature(l.index);for(var h in this.binders){var f=this.binders[h];if((f instanceof _u||f instanceof bu||f instanceof xu)&&!0===f.expression.isStateDependent){var d=n.paint.get(h);f.expression=d.value,f.updatePaintArray(l.start,l.end,c,t[o],i),a=!0}}}return a},wu.prototype.defines=function(){var t=[];for(var e in this.binders){var r=this.binders[e];(r instanceof gu||r instanceof yu)&&t.push.apply(t,r.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},wu.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof _u||r instanceof bu)for(var n=0;n<r.paintVertexAttributes.length;n++)t.push(r.paintVertexAttributes[n].name);else if(r instanceof xu)for(var i=0;i<Js.members.length;i++)t.push(Js.members[i].name)}return t},wu.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var r=this.binders[e];if(r instanceof gu||r instanceof yu||r instanceof bu)for(var n=0,i=r.uniformNames;n<i.length;n+=1)t.push(i[n])}return t},wu.prototype.getPaintVertexBuffers=function(){return this._buffers},wu.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders){var i=this.binders[n];if(i instanceof gu||i instanceof yu||i instanceof bu)for(var a=0,o=i.uniformNames;a<o.length;a+=1){var s=o[a];if(e[s]){var u=i.getBinding(t,e[s],s);r.push({name:s,property:n,binding:u})}}}return r},wu.prototype.setUniforms=function(t,e,r,n){for(var i=0,a=e;i<a.length;i+=1){var o=a[i],s=o.name,u=o.property;this.binders[u].setUniform(o.binding,n,r.get(u),s)}},wu.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var r=this.binders[e];if(t&&r instanceof xu){var n=2===t.fromScale?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;n&&this._buffers.push(n)}else(r instanceof _u||r instanceof bu)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},wu.prototype.upload=function(t){for(var e in this.binders){var r=this.binders[e];(r instanceof _u||r instanceof bu||r instanceof xu)&&r.upload(t)}this.updatePaintBuffers()},wu.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof _u||e instanceof bu||e instanceof xu)&&e.destroy()}};var Mu=function(t,e,r){void 0===r&&(r=function(){return!0}),this.programConfigurations={};for(var n=0,i=t;n<i.length;n+=1){var a=i[n];this.programConfigurations[a.id]=new wu(a,e,r)}this.needsUpload=!1,this._featureMap=new nu,this._bufferOffset=0};function Au(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Eu(t,e,r){var n={color:{source:xs,composite:js},number:{source:ks,composite:xs}},i=function(t){return{"line-pattern":{source:ws,composite:ws},"fill-pattern":{source:ws,composite:ws},"fill-extrusion-pattern":{source:ws,composite:ws}}[t]}(t);return i&&i[r]||n[e][r]}Mu.prototype.populatePaintArrays=function(t,e,r,n,i,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,n,i,a);void 0!==e.id&&this._featureMap.add(e.id,r,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Mu.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,a=r;i<a.length;i+=1){var o=a[i];this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,n)||this.needsUpload}},Mu.prototype.get=function(t){return this.programConfigurations[t]},Mu.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},Mu.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},To("ConstantBinder",gu),To("CrossFadedConstantBinder",yu),To("SourceExpressionBinder",_u),To("CrossFadedCompositeBinder",xu),To("CompositeExpressionBinder",bu),To("ProgramConfiguration",wu,{omit:["_buffers"]}),To("ProgramConfigurationSet",Mu);var Su=Math.pow(2,14)-1,Tu=-Su-1;function Cu(t){for(var e=8192/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],a=0;a<i.length;a++){var o=i[a],s=Math.round(o.x*e),u=Math.round(o.y*e);o.x=d(s,Tu,Su),o.y=d(u,Tu,Su),(s<o.x||s>o.x+1||u<o.y||u>o.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function Ou(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Cu(t):[]}}function Pu(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}var Lu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new gs,this.indexArray=new Ps,this.segments=new Zs,this.programConfigurations=new Mu(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Iu(t,e){for(var r=0;r<t.length;r++)if(zu(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(zu(t,e[n]))return!0;return!!Bu(t,e)}function ku(t,e,r){return!!zu(t,e)||!!ju(e,t,r)}function Ru(t,e){if(1===t.length)return Uu(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(zu(t,n[i]))return!0;for(var a=0;a<t.length;a++)if(Uu(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(Bu(t,e[o]))return!0;return!1}function Du(t,e,r){if(t.length>1){if(Bu(t,e))return!0;for(var n=0;n<e.length;n++)if(ju(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(ju(t[i],e,r))return!0;return!1}function Bu(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],a=0;a<e.length-1;a++)if(Fu(n,i,e[a],e[a+1]))return!0;return!1}function Fu(t,e,r,n){return T(t,r,n)!==T(e,r,n)&&T(t,e,r)!==T(t,e,n)}function ju(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if(Nu(t,e[i-1],e[i])<n)return!0;return!1}function Nu(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function Uu(t,e){for(var r,n,i,a=!1,o=0;o<t.length;o++)for(var s=0,u=(r=t[o]).length-1;s<r.length;u=s++)(n=r[s]).y>e.y!=(i=r[u]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(a=!a);return a}function zu(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var a=t[n],o=t[i];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(r=!r)}return r}function Gu(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;var a=T(t,e,r[0]);return a!==T(t,e,r[1])||a!==T(t,e,r[2])||a!==T(t,e,r[3])}function Vu(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Hu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wu(t,e,r,n,a){if(!e[0]&&!e[1])return t;var o=i.convert(e)._mult(a);"viewport"===r&&o._rotate(-n);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(o));return s}Lu.prototype.populate=function(t,e,r){var n=this.layers[0],i=[],a=null;"circle"===n.type&&(a=n.layout.get("circle-sort-key"));for(var o=0,s=t;o<s.length;o+=1){var u=s[o],l=u.feature,c=u.id,h=u.index,f=u.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,p=Ou(l,d);if(this.layers[0]._featureFilter.filter(new Zo(this.zoom),p,r)){var m=a?a.evaluate(p,{},r):void 0,v={id:c,properties:l.properties,type:l.type,sourceLayerIndex:f,index:h,geometry:d?p.geometry:Cu(l),patterns:{},sortKey:m};i.push(v)}}a&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=i;g<y.length;g+=1){var _=y[g],b=_.geometry,x=_.index,w=_.sourceLayerIndex,M=t[x].feature;this.addFeature(_,b,x,r),e.featureIndex.insert(M,b,x,w,this.index)}},Lu.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Lu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Lu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Lu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ks),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Lu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Lu.prototype.addFeature=function(t,e,r,n){for(var i=0,a=e;i<a.length;i+=1)for(var o=0,s=a[i];o<s.length;o+=1){var u=s[o],l=u.x,c=u.y;if(!(l<0||l>=8192||c<0||c>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),f=h.vertexLength;Pu(this.layoutVertexArray,l,c,-1,-1),Pu(this.layoutVertexArray,l,c,1,-1),Pu(this.layoutVertexArray,l,c,1,1),Pu(this.layoutVertexArray,l,c,-1,1),this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f,f+3,f+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{},n)},To("CircleBucket",Lu,{omit:["layers"]});var $u=new cs({"circle-sort-key":new os(yn.layout_circle["circle-sort-key"])}),qu={paint:new cs({"circle-radius":new os(yn.paint_circle["circle-radius"]),"circle-color":new os(yn.paint_circle["circle-color"]),"circle-blur":new os(yn.paint_circle["circle-blur"]),"circle-opacity":new os(yn.paint_circle["circle-opacity"]),"circle-translate":new as(yn.paint_circle["circle-translate"]),"circle-translate-anchor":new as(yn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new as(yn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new as(yn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new os(yn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new os(yn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new os(yn.paint_circle["circle-stroke-opacity"])}),layout:$u},Xu="undefined"!=typeof Float32Array?Float32Array:Array;function Ku(){var t=new Xu(9);return Xu!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Zu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Yu(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*i+b*u+x*f+w*v,t[2]=_*a+b*l+x*d+w*g,t[3]=_*o+b*c+x*p+w*y,t[4]=(_=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=_*i+b*u+x*f+w*v,t[6]=_*a+b*l+x*d+w*g,t[7]=_*o+b*c+x*p+w*y,t[8]=(_=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=_*i+b*u+x*f+w*v,t[10]=_*a+b*l+x*d+w*g,t[11]=_*o+b*c+x*p+w*y,t[12]=(_=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=_*i+b*u+x*f+w*v,t[14]=_*a+b*l+x*d+w*g,t[15]=_*o+b*c+x*p+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)});var Ju=Yu;function Qu(){var t=new Xu(3);return Xu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tl(t){return Math.hypot(t[0],t[1],t[2])}function el(t,e,r){var n=new Xu(3);return n[0]=t,n[1]=e,n[2]=r,n}function rl(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function nl(t,e,r){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],l=i*u-a*s,c=a*o-n*u,h=n*s-i*o,f=i*h-a*c,d=a*l-n*h,p=n*c-i*l,m=2*r[3];return c*=m,h*=m,d*=2,p*=2,t[0]=o+(l*=m)+(f*=2),t[1]=s+c+d,t[2]=u+h+p,t}var il,al=tl;function ol(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}function sl(){var t=new Xu(4);return Xu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ul(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ll(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t}Qu(),il=new Xu(4),Xu!=Float32Array&&(il[0]=0,il[1]=0,il[2]=0,il[3]=0);var cl=(Qu(),el(1,0,0),el(0,1,0),sl(),sl(),Ku(),function(t){function e(e){t.call(this,e,qu)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Lu(t)},e.prototype.queryRadius=function(t){var e=t;return Vu("circle-radius",this,e)+Vu("circle-stroke-width",this,e)+Hu(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,a,o,s){for(var u=Wu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),l=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return t.map((function(t){return hl(t,e)}))}(u,s),f=c?l*o:l,d=0,p=n;d<p.length;d+=1)for(var m=0,v=p[d];m<v.length;m+=1){var g=v[m],y=c?g:hl(g,s),_=f,b=ol([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=a.cameraToCenterDistance/b[3]),ku(h,y,_))return!0}return!1},e}(hs));function hl(t,e){var r=ol([],[t.x,t.y,0,1],e);return new i(r[0]/r[3],r[1]/r[3])}var fl=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Lu);function dl(t,e,r,n){var i=e.width,a=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*a*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*a*r);return t.width=i,t.height=a,t.data=n,t}function pl(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var a=dl({},{width:n,height:i},r);ml(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=a.data}}function ml(t,e,r,n,i,a){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((r.y+u)*t.width+r.x)*a,c=((n.y+u)*e.width+n.x)*a,h=0;h<i.width*a;h++)s[c+h]=o[l+h];return e}To("HeatmapBucket",fl,{omit:["layers"]});var vl=function(t,e){dl(this,t,1,e)};vl.prototype.resize=function(t){pl(this,t,1)},vl.prototype.clone=function(){return new vl({width:this.width,height:this.height},new Uint8Array(this.data))},vl.copy=function(t,e,r,n,i){ml(t,e,r,n,i,1)};var gl=function(t,e){dl(this,t,4,e)};gl.prototype.resize=function(t){pl(this,t,4)},gl.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},gl.prototype.clone=function(){return new gl({width:this.width,height:this.height},new Uint8Array(this.data))},gl.copy=function(t,e,r,n,i){ml(t,e,r,n,i,4)},To("AlphaImage",vl),To("RGBAImage",gl);var yl={paint:new cs({"heatmap-radius":new os(yn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new os(yn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new as(yn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ls(yn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new as(yn.paint_heatmap["heatmap-opacity"])})};function _l(t){var e={},r=t.resolution||256,n=t.clips?t.clips.length:1,i=t.image||new gl({width:r,height:n}),a=function(r,n,a){e[t.evaluationKey]=a;var o=t.expression.evaluate(e);i.data[r+n+0]=Math.floor(255*o.r/o.a),i.data[r+n+1]=Math.floor(255*o.g/o.a),i.data[r+n+2]=Math.floor(255*o.b/o.a),i.data[r+n+3]=Math.floor(255*o.a)};if(t.clips)for(var o=0,s=0;o<n;++o,s+=4*r)for(var u=0,l=0;u<r;u++,l+=4){var c=u/(r-1),h=t.clips[o];a(s,l,h.start*(1-c)+h.end*c)}else for(var f=0,d=0;f<r;f++,d+=4)a(0,d,f/(r-1));return i}var bl=function(t){function e(e){t.call(this,e,yl),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new fl(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=_l({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(hs),xl={paint:new cs({"hillshade-illumination-direction":new as(yn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new as(yn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new as(yn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new as(yn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new as(yn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new as(yn.paint_hillshade["hillshade-accent-color"])})},wl=function(t){function e(e){t.call(this,e,xl)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(hs),Ml=ms([{name:"a_pos",components:2,type:"Int16"}],4).members,Al=Sl,El=Sl;function Sl(t,e,r){r=r||2;var n,i,a,o,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,f=Tl(t,0,h,r,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(t,e,r,n){var i,a,o,s=[];for(i=0,a=e.length;i<a;i++)(o=Tl(t,e[i]*n,i<a-1?e[i+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(jl(o));for(s.sort(Rl),i=0;i<s.length;i++)Dl(s[i],r),r=Cl(r,r.next);return r}(t,e,f,r)),t.length>80*r){n=a=t[0],i=o=t[1];for(var p=r;p<h;p+=r)(s=t[p])<n&&(n=s),(u=t[p+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-n,o-i))?1/l:0}return Ol(f,d,r,n,i,l),d}function Tl(t,e,r,n,i){var a,o;if(i===Yl(t,e,r,n)>0)for(a=e;a<r;a+=n)o=Xl(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=Xl(a,t[a],t[a+1],o);return o&&Gl(o,o.next)&&(Kl(o),o=o.next),o}function Cl(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Gl(n,n.next)&&0!==zl(n.prev,n,n.next))n=n.next;else{if(Kl(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Ol(t,e,r,n,i,a,o){if(t){!o&&a&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=Fl(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,a,o,s,u,l=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,l*=2}while(o>1)}(i)}(t,n,i,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?Ll(t,n,i,a):Pl(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),Kl(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Ol(t=Il(Cl(t),e,r),e,r,n,i,a,2):2===o&&kl(t,e,r,n,i,a):Ol(Cl(t),e,r,n,i,a,1);break}}}function Pl(t){var e=t.prev,r=t,n=t.next;if(zl(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Nl(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&zl(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ll(t,e,r,n){var i=t.prev,a=t,o=t.next;if(zl(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,l=Fl(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,e,r,n),c=Fl(s,u,e,r,n),h=t.prevZ,f=t.nextZ;h&&h.z>=l&&f&&f.z<=c;){if(h!==t.prev&&h!==t.next&&Nl(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&zl(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==t.prev&&f!==t.next&&Nl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&zl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&Nl(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&zl(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&Nl(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&zl(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Il(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!Gl(i,a)&&Vl(i,n,n.next,a)&&$l(i,a)&&$l(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),Kl(n),Kl(n.next),n=t=a),n=n.next}while(n!==t);return Cl(n)}function kl(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Ul(o,s)){var u=ql(o,s);return o=Cl(o,o.next),u=Cl(u,u.next),Ol(o,e,r,n,i,a),void Ol(u,e,r,n,i,a)}s=s.next}o=o.next}while(o!==t)}function Rl(t,e){return t.x-e.x}function Dl(t,e){if(e=function(t,e){var r,n=e,i=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===o)return r;var u,l=r,c=r.x,h=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&Nl(a<h?i:o,a,c,h,a<h?o:i,a,n.x,n.y)&&(u=Math.abs(a-n.y)/(i-n.x),$l(n,t)&&(u<f||u===f&&(n.x>r.x||n.x===r.x&&Bl(r,n)))&&(r=n,f=u)),n=n.next}while(n!==l);return r}(t,e)){var r=ql(e,t);Cl(e,e.next),Cl(r,r.next)}}function Bl(t,e){return zl(t.prev,t,e.prev)<0&&zl(e.next,t,t.next)<0}function Fl(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jl(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Nl(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function Ul(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Vl(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&($l(t,e)&&$l(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(zl(t.prev,t,e.prev)||zl(t,e.prev,e))||Gl(t,e)&&zl(t.prev,t,t.next)>0&&zl(e.prev,e,e.next)>0)}function zl(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Gl(t,e){return t.x===e.x&&t.y===e.y}function Vl(t,e,r,n){var i=Wl(zl(t,e,r)),a=Wl(zl(t,e,n)),o=Wl(zl(r,n,t)),s=Wl(zl(r,n,e));return i!==a&&o!==s||!(0!==i||!Hl(t,r,e))||!(0!==a||!Hl(t,n,e))||!(0!==o||!Hl(r,t,n))||!(0!==s||!Hl(r,e,n))}function Hl(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Wl(t){return t>0?1:t<0?-1:0}function $l(t,e){return zl(t.prev,t,t.next)<0?zl(t,e,t.next)>=0&&zl(t,t.prev,e)>=0:zl(t,e,t.prev)<0||zl(t,t.next,e)<0}function ql(t,e){var r=new Zl(t.i,t.x,t.y),n=new Zl(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function Xl(t,e,r,n){var i=new Zl(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Kl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zl(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yl(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}function Jl(t,e,r,n,i){!function t(e,r,n,i,a){for(;i>n;){if(i-n>600){var o=i-n+1,s=r-n+1,u=Math.log(o),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*l/o+c)),Math.min(i,Math.floor(r+(o-s)*l/o+c)),a)}var h=e[r],f=n,d=i;for(Ql(e,n,r),a(e[i],h)>0&&Ql(e,n,i);f<d;){for(Ql(e,f,d),f++,d--;a(e[f],h)<0;)f++;for(;a(e[d],h)>0;)d--}0===a(e[n],h)?Ql(e,n,d):Ql(e,++d,i),d<=r&&(n=d+1),r<=d&&(i=d-1)}}(t,e,r||0,n||t.length-1,i||tc)}function Ql(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function tc(t,e){return t<e?-1:t>e?1:0}function ec(t,e){var r=t.length;if(r<=1)return[t];for(var n,i,a=[],o=0;o<r;o++){var s=C(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&a.push(n),n=[t[o]]):n.push(t[o]))}if(n&&a.push(n),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(Jl(a[u],e,1,a[u].length-1,rc),a[u]=a[u].slice(0,e));return a}function rc(t,e){return e.area-t.area}function nc(t,e,r){for(var n=r.patternDependencies,i=!1,a=0,o=e;a<o.length;a+=1){var s=o[a].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,n[u.to]=!0,n[u.from]=!0)}return i}function ic(t,e,r,n,i){for(var a=i.patternDependencies,o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:n-1},r,{},i.availableImages),h=l.evaluate({zoom:n},r,{},i.availableImages),f=l.evaluate({zoom:n+1},r,{},i.availableImages);h=h&&h.name?h.name:h,f=f&&f.name?f.name:f,a[c=c&&c.name?c.name:c]=!0,a[h]=!0,a[f]=!0,r.patterns[u.id]={min:c,mid:h,max:f}}}return r}Sl.deviation=function(t,e,r,n){var i=e&&e.length,a=Math.abs(Yl(t,0,i?e[0]*r:t.length,r));if(i)for(var o=0,s=e.length;o<s;o++)a-=Math.abs(Yl(t,e[o]*r,o<s-1?e[o+1]*r:t.length,r));var u=0;for(o=0;o<n.length;o+=3){var l=n[o]*r,c=n[o+1]*r,h=n[o+2]*r;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},Sl.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var a=0;a<t[i].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[i][a][o]);i>0&&r.holes.push(n+=t[i-1].length)}return r},Al.default=El;var ac=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gs,this.indexArray=new Ps,this.indexArray2=new Bs,this.programConfigurations=new Mu(t.layers,t.zoom),this.segments=new Zs,this.segments2=new Zs,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};ac.prototype.populate=function(t,e,r){this.hasPattern=nc("fill",this.layers,e);for(var n=this.layers[0].layout.get("fill-sort-key"),i=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Ou(u,f);if(this.layers[0]._featureFilter.filter(new Zo(this.zoom),d,r)){var p=n?n.evaluate(d,{},r,e.availableImages):void 0,m={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:f?d.geometry:Cu(u),patterns:{},sortKey:p};i.push(m)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var v=0,g=i;v<g.length;v+=1){var y=g[v],_=y.geometry,b=y.index,x=y.sourceLayerIndex;if(this.hasPattern){var w=ic("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,b,r,{});e.featureIndex.insert(t[b].feature,_,b,x,this.index)}},ac.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},ac.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r)}},ac.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ac.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ac.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ml),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},ac.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ac.prototype.addFeature=function(t,e,r,n,i){for(var a=0,o=ec(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),f=h.vertexLength,d=[],p=[],m=0,v=s;m<v.length;m+=1){var g=v[m];if(0!==g.length){g!==s[0]&&p.push(d.length/2);var y=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),_=y.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(_+g.length-1,_),d.push(g[0].x),d.push(g[0].y);for(var b=1;b<g.length;b++)this.layoutVertexArray.emplaceBack(g[b].x,g[b].y),this.indexArray2.emplaceBack(_+b-1,_+b),d.push(g[b].x),d.push(g[b].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var x=Al(d,p),w=0;w<x.length;w+=3)this.indexArray.emplaceBack(f+x[w],f+x[w+1],f+x[w+2]);h.vertexLength+=u,h.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},To("FillBucket",ac,{omit:["layers","patternFeatures"]});var oc=new cs({"fill-sort-key":new os(yn.layout_fill["fill-sort-key"])}),sc={paint:new cs({"fill-antialias":new as(yn.paint_fill["fill-antialias"]),"fill-opacity":new os(yn.paint_fill["fill-opacity"]),"fill-color":new os(yn.paint_fill["fill-color"]),"fill-outline-color":new os(yn.paint_fill["fill-outline-color"]),"fill-translate":new as(yn.paint_fill["fill-translate"]),"fill-translate-anchor":new as(yn.paint_fill["fill-translate-anchor"]),"fill-pattern":new ss(yn.paint_fill["fill-pattern"])}),layout:oc},uc=function(t){function e(e){t.call(this,e,sc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new ac(t)},e.prototype.queryRadius=function(){return Hu(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,a,o){return Ru(Wu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),n)},e.prototype.isTileClipped=function(){return!0},e}(hs),lc=ms([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,cc=hc;function hc(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(fc,this,e)}function fc(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function dc(t){for(var e,r,n=0,i=0,a=t.length,o=a-1;i<a;o=i++)n+=((r=t[o]).x-(e=t[i]).x)*(e.y+r.y);return n}hc.types=["Unknown","Point","LineString","Polygon"],hc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,a=0,o=0,s=0,u=[];t.pos<r;){if(a<=0){var l=t.readVarint();n=7&l,a=l>>3}if(a--,1===n||2===n)o+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&u.push(e),e=[]),e.push(new i(o,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&u.push(e),u},hc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=t.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,l]},hc.prototype.toGeoJSON=function(t,e,r){var n,i,a=this.extent*Math.pow(2,r),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=hc.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<u.length;n++)h[n]=u[n][0];c(u=h);break;case 2:for(n=0;n<u.length;n++)c(u[n]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],a=0;a<e;a++){var o=dc(t[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[t[a]]):r.push(t[a]))}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)c(u[n][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var pc=mc;function mc(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(vc,this,e),this.length=this._features.length}function vc(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function gc(t,e,r){if(3===t){var n=new pc(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}mc.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cc(this._pbf,e,this.extent,this._keys,this._values)};var yc={VectorTile:function(t,e){this.layers=t.readFields(gc,{},e)},VectorTileFeature:cc,VectorTileLayer:pc},_c=yc.VectorTileFeature.types,bc=Math.pow(2,13);function xc(t,e,r,n,i,a,o,s){t.emplaceBack(e,r,2*Math.floor(n*bc)+o,i*bc*2,a*bc*2,Math.round(s))}var wc=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _s,this.indexArray=new Ps,this.programConfigurations=new Mu(t.layers,t.zoom),this.segments=new Zs,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Mc(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}wc.prototype.populate=function(t,e,r){this.features=[],this.hasPattern=nc("fill-extrusion",this.layers,e);for(var n=0,i=t;n<i.length;n+=1){var a=i[n],o=a.feature,s=a.id,u=a.index,l=a.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=Ou(o,c);if(this.layers[0]._featureFilter.filter(new Zo(this.zoom),h,r)){var f={id:s,sourceLayerIndex:l,index:u,geometry:c?h.geometry:Cu(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(ic("fill-extrusion",this.layers,f,this.zoom,e)):this.addFeature(f,f.geometry,u,r,{}),e.featureIndex.insert(o,f.geometry,u,l,this.index,!0)}}},wc.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.features;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r)}},wc.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},wc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},wc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},wc.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,lc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},wc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},wc.prototype.addFeature=function(t,e,r,n,i){for(var a=0,o=ec(e,500);a<o.length;a+=1){for(var s=o[a],u=0,l=0,c=s;l<c.length;l+=1)u+=c[l].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),f=0,d=s;f<d.length;f+=1){var p=d[f];if(0!==p.length&&!((I=p).every((function(t){return t.x<0}))||I.every((function(t){return t.x>8192}))||I.every((function(t){return t.y<0}))||I.every((function(t){return t.y>8192}))))for(var m=0,v=0;v<p.length;v++){var g=p[v];if(v>=1){var y=p[v-1];if(!Mc(g,y)){h.vertexLength+4>Zs.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=g.sub(y)._perp()._unit(),b=y.dist(g);m+b>32768&&(m=0),xc(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,m),xc(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,m),xc(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,m+=b),xc(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,m);var x=h.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>Zs.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===_c[t.type]){for(var w=[],M=[],A=h.vertexLength,E=0,S=s;E<S.length;E+=1){var T=S[E];if(0!==T.length){T!==s[0]&&M.push(w.length/2);for(var C=0;C<T.length;C++){var O=T[C];xc(this.layoutVertexArray,O.x,O.y,0,0,1,1,0),w.push(O.x),w.push(O.y)}}}for(var P=Al(w,M),L=0;L<P.length;L+=3)this.indexArray.emplaceBack(A+P[L],A+P[L+2],A+P[L+1]);h.primitiveLength+=P.length/3,h.vertexLength+=u}}var I;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},To("FillExtrusionBucket",wc,{omit:["layers","features"]});var Ac={paint:new cs({"fill-extrusion-opacity":new as(yn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new os(yn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new as(yn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new as(yn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ss(yn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new os(yn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new os(yn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new as(yn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ec=function(t){function e(e){t.call(this,e,Ac)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new wc(t)},e.prototype.queryRadius=function(){return Hu(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,n,a,o,s,u){var l=Wu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),f=function(t,e,r,n){for(var a=[],o=0,s=t;o<s.length;o+=1){var u=s[o],l=[u.x,u.y,0,1];ol(l,l,e),a.push(new i(l[0]/l[3],l[1]/l[3]))}return a}(l,u),d=function(t,e,r,n){for(var a=[],o=[],s=n[8]*e,u=n[9]*e,l=n[10]*e,c=n[11]*e,h=n[8]*r,f=n[9]*r,d=n[10]*r,p=n[11]*r,m=0,v=t;m<v.length;m+=1){for(var g=[],y=[],_=0,b=v[m];_<b.length;_+=1){var x=b[_],w=x.x,M=x.y,A=n[0]*w+n[4]*M+n[12],E=n[1]*w+n[5]*M+n[13],S=n[2]*w+n[6]*M+n[14],T=n[3]*w+n[7]*M+n[15],C=S+l,O=T+c,P=A+h,L=E+f,I=S+d,k=T+p,R=new i((A+s)/O,(E+u)/O);R.z=C/O,g.push(R);var D=new i(P/k,L/k);D.z=I/k,y.push(D)}a.push(g),o.push(y)}return[a,o]}(n,h,c,u);return function(t,e,r){var n=1/0;Ru(r,e)&&(n=Tc(r,e[0]));for(var i=0;i<e.length;i++)for(var a=e[i],o=t[i],s=0;s<a.length-1;s++){var u=a[s],l=[u,a[s+1],o[s+1],o[s],u];Iu(r,l)&&(n=Math.min(n,Tc(r,l)))}return n!==1/0&&n}(d[0],d[1],f)},e}(hs);function Sc(t,e){return t.x*e.x+t.y*e.y}function Tc(t,e){if(1===t.length){for(var r,n=0,i=e[n++];!r||i.equals(r);)if(!(r=e[n++]))return 1/0;for(;n<e.length;n++){var a=e[n],o=t[0],s=r.sub(i),u=a.sub(i),l=o.sub(i),c=Sc(s,s),h=Sc(s,u),f=Sc(u,u),d=Sc(l,s),p=Sc(l,u),m=c*f-h*h,v=(f*d-h*p)/m,g=(c*p-h*d)/m,y=i.z*(1-v-g)+r.z*v+a.z*g;if(isFinite(y))return y}return 1/0}for(var _=1/0,b=0,x=e;b<x.length;b+=1)_=Math.min(_,x[b].z);return _}var Cc=ms([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Oc=ms([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Pc=yc.VectorTileFeature.types,Lc=Math.cos(Math.PI/180*37.5),Ic=Math.pow(2,14)/.5,kc=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new bs,this.layoutVertexArray2=new xs,this.indexArray=new Ps,this.programConfigurations=new Mu(t.layers,t.zoom),this.segments=new Zs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};kc.prototype.populate=function(t,e,r){this.hasPattern=nc("line",this.layers,e);for(var n=this.layers[0].layout.get("line-sort-key"),i=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=s.feature,l=s.id,c=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,d=Ou(u,f);if(this.layers[0]._featureFilter.filter(new Zo(this.zoom),d,r)){var p=n?n.evaluate(d,{},r):void 0,m={id:l,properties:u.properties,type:u.type,sourceLayerIndex:h,index:c,geometry:f?d.geometry:Cu(u),patterns:{},sortKey:p};i.push(m)}}n&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var v=0,g=i;v<g.length;v+=1){var y=g[v],_=y.geometry,b=y.index,x=y.sourceLayerIndex;if(this.hasPattern){var w=ic("line",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,b,r,{});e.featureIndex.insert(t[b].feature,_,b,x,this.index)}},kc.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},kc.prototype.addFeatures=function(t,e,r){for(var n=0,i=this.patternFeatures;n<i.length;n+=1){var a=i[n];this.addFeature(a,a.geometry,a.index,e,r)}},kc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},kc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},kc.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Oc)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},kc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},kc.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},kc.prototype.addFeature=function(t,e,r,n,i){var a=this.layers[0].layout,o=a.get("line-join").evaluate(t,{}),s=a.get("line-cap"),u=a.get("line-miter-limit"),l=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var c=0,h=e;c<h.length;c+=1)this.addLine(h[c],t,o,s,u,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,i,n)},kc.prototype.addLine=function(t,e,r,n,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<t.length-1;o++)this.totalDistance+=t[o].dist(t[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Pc[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var l=0;l<u-1&&t[l].equals(t[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===r&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),d=void 0,p=void 0,m=void 0,v=void 0;this.e1=this.e2=-1,s&&(v=t[l].sub(c=t[u-2])._unit()._perp());for(var g=l;g<u;g++)if(!(p=g===u-1?s?t[l+1]:void 0:t[g+1])||!t[g].equals(p)){v&&(m=v),c&&(d=c),c=t[g],v=p?p.sub(c)._unit()._perp():m;var y=(m=m||v).add(v);0===y.x&&0===y.y||y._unit();var _=m.x*v.x+m.y*v.y,b=y.x*v.x+y.y*v.y,x=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),M=b<Lc&&d&&p,A=m.x*v.y-m.y*v.x>0;if(M&&g>l){var E=c.dist(d);if(E>2*h){var S=c.sub(c.sub(d)._mult(h/E)._round());this.updateDistance(d,S),this.addCurrentVertex(S,m,0,0,f),d=S}}var T=d&&p,C=T?r:s?"butt":n;if(T&&"round"===C&&(x<a?C="miter":x<=2&&(C="fakeround")),"miter"===C&&x>i&&(C="bevel"),"bevel"===C&&(x>2&&(C="flipbevel"),x<i&&(C="miter")),d&&this.updateDistance(d,c),"miter"===C)y._mult(x),this.addCurrentVertex(c,y,0,0,f);else if("flipbevel"===C){if(x>100)y=v.mult(-1);else{var O=x*m.add(v).mag()/m.sub(v).mag();y._perp()._mult(O*(A?-1:1))}this.addCurrentVertex(c,y,0,0,f),this.addCurrentVertex(c,y.mult(-1),0,0,f)}else if("bevel"===C||"fakeround"===C){var P=-Math.sqrt(x*x-1),L=A?P:0,I=A?0:P;if(d&&this.addCurrentVertex(c,m,L,I,f),"fakeround"===C)for(var k=Math.round(180*w/Math.PI/20),R=1;R<k;R++){var D=R/k;if(.5!==D){var B=D-.5;D+=D*B*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*B*B+(.848013+_*(.215638*_-1.06021)))}var F=v.sub(m)._mult(D)._add(m)._unit()._mult(A?-1:1);this.addHalfVertex(c,F.x,F.y,!1,A,0,f)}p&&this.addCurrentVertex(c,v,-L,-I,f)}else if("butt"===C)this.addCurrentVertex(c,y,0,0,f);else if("square"===C){var j=d?1:-1;this.addCurrentVertex(c,y,j,j,f)}else"round"===C&&(d&&(this.addCurrentVertex(c,m,0,0,f),this.addCurrentVertex(c,m,1,1,f,!0)),p&&(this.addCurrentVertex(c,v,-1,-1,f,!0),this.addCurrentVertex(c,v,0,0,f)));if(M&&g<u-1){var N=c.dist(p);if(N>2*h){var U=c.add(p.sub(c)._mult(h/N)._round());this.updateDistance(c,U),this.addCurrentVertex(U,v,0,0,f),c=U}}}}},kc.prototype.addCurrentVertex=function(t,e,r,n,i,a){void 0===a&&(a=!1);var o=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,a,!1,r,i),this.addHalfVertex(t,o,s,a,!0,-n,i),this.distance>Ic/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,n,i,a))},kc.prototype.addHalfVertex=function(t,e,r,n,i,a,o){var s=.5*(this.lineClips?this.scaledDistance*(Ic-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===a?0:a<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),i?this.e2=u:this.e1=u},kc.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},kc.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},To("LineBucket",kc,{omit:["layers","patternFeatures"]});var Rc=new cs({"line-cap":new as(yn.layout_line["line-cap"]),"line-join":new os(yn.layout_line["line-join"]),"line-miter-limit":new as(yn.layout_line["line-miter-limit"]),"line-round-limit":new as(yn.layout_line["line-round-limit"]),"line-sort-key":new os(yn.layout_line["line-sort-key"])}),Dc={paint:new cs({"line-opacity":new os(yn.paint_line["line-opacity"]),"line-color":new os(yn.paint_line["line-color"]),"line-translate":new as(yn.paint_line["line-translate"]),"line-translate-anchor":new as(yn.paint_line["line-translate-anchor"]),"line-width":new os(yn.paint_line["line-width"]),"line-gap-width":new os(yn.paint_line["line-gap-width"]),"line-offset":new os(yn.paint_line["line-offset"]),"line-blur":new os(yn.paint_line["line-blur"]),"line-dasharray":new us(yn.paint_line["line-dasharray"]),"line-pattern":new ss(yn.paint_line["line-pattern"]),"line-gradient":new ls(yn.paint_line["line-gradient"])}),layout:Rc},Bc=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new Zo(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n,i){return r=m({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n,i)},e}(os))(Dc.paint.properties["line-width"].specification);Bc.useIntegerZoom=!0;var Fc=function(t){function e(e){t.call(this,e,Dc),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ii,this.gradientVersion=(this.gradientVersion+1)%s)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r),this.paint._values["line-floorwidth"]=Bc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new kc(t)},e.prototype.queryRadius=function(t){var e=t,r=jc(Vu("line-width",this,e),Vu("line-gap-width",this,e)),n=Vu("line-offset",this,e);return r/2+Math.abs(n)+Hu(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,a,o,s){var u=Wu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,s),l=s/2*jc(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(n=function(t,e){for(var r=[],n=new i(0,0),a=0;a<t.length;a++){for(var o=t[a],s=[],u=0;u<o.length;u++){var l=o[u],c=o[u+1],h=0===u?n:l.sub(o[u-1])._unit()._perp(),f=u===o.length-1?n:c.sub(l)._unit()._perp(),d=h._add(f)._unit();d._mult(1/(d.x*f.x+d.y*f.y)),s.push(d._mult(e)._add(l))}r.push(s)}return r}(n,c*s)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.length>=3)for(var a=0;a<i.length;a++)if(zu(t,i[a]))return!0;if(Du(t,i,r))return!0}return!1}(u,n,l)},e.prototype.isTileClipped=function(){return!0},e}(hs);function jc(t,e){return e>0?e+2*t:t}var Nc=ms([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Uc=ms([{name:"a_projected_pos",components:3,type:"Float32"}],4),zc=(ms([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ms([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Gc=(ms([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ms([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Vc=ms([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Hc(t,e,r){return t.sections.forEach((function(t){t.text=function(t,e,r){var n=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Ko.applyArabicShaping&&(t=Ko.applyArabicShaping(t)),t}(t.text,e,r)})),t}ms([{name:"triangle",components:3,type:"Uint16"}]),ms([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ms([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ms([{type:"Float32",name:"offsetX"}]),ms([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Wc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},$c=function(t,e,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,h=r?i-1:0,f=r?-1:1,d=t[e+h];for(h+=f,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+t[e+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+t[e+h],h+=f,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=l}return(d?-1:1)*o*Math.pow(2,a-n)},qc=function(t,e,r,n,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(e*u-1)*Math.pow(2,i),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;t[r+d]=255&o,d+=p,o/=256,l-=8);t[r+d-p]|=128*m},Xc=Kc;function Kc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Kc.Varint=0,Kc.Fixed64=1,Kc.Bytes=2,Kc.Fixed32=5;var Zc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Yc(t){return t.type===Kc.Bytes?t.readVarint()+t.pos:t.pos+1}function Jc(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Qc(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function th(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function eh(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function rh(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function nh(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function ih(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function ah(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function oh(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function sh(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function uh(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function lh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ch(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function hh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function fh(t,e,r){1===t&&r.readMessage(dh,e)}function dh(t,e,r){if(3===t){var n=r.readMessage(ph,{}),i=n.width,a=n.height,o=n.left,s=n.top,u=n.advance;e.push({id:n.id,bitmap:new vl({width:i+6,height:a+6},n.bitmap),metrics:{width:i,height:a,left:o,top:s,advance:u}})}}function ph(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}function mh(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var a=i[n];e+=a.w*a.h,r=Math.max(r,a.w)}t.sort((function(t,e){return e.h-t.h}));for(var o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],f=o.length-1;f>=0;f--){var d=o[f];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===d.w&&h.h===d.h){var p=o.pop();f<o.length&&(o[f]=p)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(o.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Kc.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,t(i,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=lh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=hh(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=lh(this.buf,this.pos)+4294967296*lh(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=lh(this.buf,this.pos)+4294967296*hh(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=$c(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=$c(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,a=r.buf;if(n=(112&(i=a[r.pos++]))>>4,i<128)return Jc(t,n,e);if(n|=(127&(i=a[r.pos++]))<<3,i<128)return Jc(t,n,e);if(n|=(127&(i=a[r.pos++]))<<10,i<128)return Jc(t,n,e);if(n|=(127&(i=a[r.pos++]))<<17,i<128)return Jc(t,n,e);if(n|=(127&(i=a[r.pos++]))<<24,i<128)return Jc(t,n,e);if(n|=(1&(i=a[r.pos++]))<<31,i<128)return Jc(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Zc?function(t,e,r){return Zc.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var n="",i=e;i<r;){var a,o,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(a=t[i+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(o=t[i+2],128==(192&(a=t[i+1]))&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+2],s=t[i+3],128==(192&(a=t[i+1]))&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Kc.Bytes)return t.push(this.readVarint(e));var r=Yc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Kc.Bytes)return t.push(this.readSVarint());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Kc.Bytes)return t.push(this.readBoolean());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Kc.Bytes)return t.push(this.readFloat());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Kc.Bytes)return t.push(this.readDouble());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Kc.Bytes)return t.push(this.readFixed32());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Kc.Bytes)return t.push(this.readSFixed32());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Kc.Bytes)return t.push(this.readFixed64());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Kc.Bytes)return t.push(this.readSFixed64());var e=Yc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Kc.Varint)for(;this.buf[this.pos++]>127;);else if(e===Kc.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Kc.Fixed32)this.pos+=4;else{if(e!==Kc.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ch(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ch(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ch(this.buf,-1&t,this.pos),ch(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ch(this.buf,-1&t,this.pos),ch(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,a=0;a<e.length;a++){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Qc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),qc(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qc(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&Qc(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,Kc.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,th,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,eh,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ih,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,rh,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,nh,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,ah,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,oh,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,sh,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,uh,e)},writeBytesField:function(t,e){this.writeTag(t,Kc.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Kc.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Kc.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Kc.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Kc.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Kc.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Kc.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Kc.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Kc.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Kc.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var vh=function(t,e){var r=e.pixelRatio,n=e.version,i=e.stretchX,a=e.stretchY,o=e.content;this.paddedRect=t,this.pixelRatio=r,this.stretchX=i,this.stretchY=a,this.content=o,this.version=n},gh={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};gh.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},gh.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},gh.tlbr.get=function(){return this.tl.concat(this.br)},gh.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(vh.prototype,gh);var yh=function(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var a=mh(i),o=new gl({width:a.w||1,height:a.h||1});for(var s in t){var u=t[s],l=r[s].paddedRect;gl.copy(u.data,o,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],f=n[c].paddedRect,d=f.x+1,p=f.y+1,m=h.data.width,v=h.data.height;gl.copy(h.data,o,{x:0,y:0},{x:d,y:p},h.data),gl.copy(h.data,o,{x:0,y:v-1},{x:d,y:p-1},{width:m,height:1}),gl.copy(h.data,o,{x:0,y:0},{x:d,y:p+v},{width:m,height:1}),gl.copy(h.data,o,{x:m-1,y:0},{x:d-1,y:p},{width:1,height:v}),gl.copy(h.data,o,{x:0,y:0},{x:d+m,y:p},{width:1,height:v})}this.image=o,this.iconPositions=r,this.patternPositions=n};yh.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(a),e[n]=new vh(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},yh.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},yh.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]})}},To("ImagePosition",vh),To("ImageAtlas",yh);var _h={horizontal:1,vertical:2,horizontalOnly:3},bh=function(){this.scale=1,this.fontStack="",this.imageName=null};bh.forText=function(t,e){var r=new bh;return r.scale=t||1,r.fontStack=e,r},bh.forImage=function(t){var e=new bh;return e.imageName=t,e};var xh=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function wh(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){var v,g=xh.fromFeature(t,i);h===_h.vertical&&g.verticalizePunctuation();var y=Ko.processBidirectionalText,_=Ko.processStyledBidirectionalText;if(y&&1===g.sections.length){v=[];for(var b=0,x=y(g.toString(),Oh(g,l,a,e,n,d,p));b<x.length;b+=1){var w=x[b],M=new xh;M.text=w,M.sections=g.sections;for(var A=0;A<w.length;A++)M.sectionIndex.push(0);v.push(M)}}else if(_){v=[];for(var E=0,S=_(g.text,g.sectionIndex,Oh(g,l,a,e,n,d,p));E<S.length;E+=1){var T=S[E],C=new xh;C.text=T[0],C.sectionIndex=T[1],C.sections=g.sections,v.push(C)}}else v=function(t,e){for(var r=[],n=t.text,i=0,a=0,o=e;a<o.length;a+=1){var s=o[a];r.push(t.substring(i,s)),i=s}return i<n.length&&r.push(t.substring(i,n.length)),r}(g,Oh(g,l,a,e,n,d,p));var O=[],P={positionedLines:O,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,r,n,i,a,o,s,u,l,c,h){for(var f=0,d=-17,p=0,m=0,v="right"===s?1:"left"===s?0:.5,g=0,y=0,_=i;y<_.length;y+=1){var b=_[y];b.trim();var x=b.getMaxScale(),w=24*(x-1),M={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=M;var A=M.positionedGlyphs,E=0;if(b.length()){for(var S=0;S<b.length();S++){var T=b.getSection(S),C=b.getSectionIndex(S),O=b.getCharCode(S),P=0,L=null,I=null,k=null,R=24,D=!(u===_h.horizontal||!c&&!Bo(O)||c&&(Mh[O]||(H=O,Ro.Arabic(H)||Ro["Arabic Supplement"](H)||Ro["Arabic Extended-A"](H)||Ro["Arabic Presentation Forms-A"](H)||Ro["Arabic Presentation Forms-B"](H))));if(T.imageName){var B=n[T.imageName];if(!B)continue;k=T.imageName,t.iconsInText=t.iconsInText||!0,I=B.paddedRect;var F=B.displaySize;T.scale=24*T.scale/h,P=w+(24-F[1]*T.scale),R=(L={width:F[0],height:F[1],left:1,top:-3,advance:D?F[1]:F[0]}).advance;var j=D?F[0]*T.scale-24*x:F[1]*T.scale-24*x;j>0&&j>E&&(E=j)}else{var N=r[T.fontStack],U=N&&N[O];if(U&&U.rect)I=U.rect,L=U.metrics;else{var z=e[T.fontStack],G=z&&z[O];if(!G)continue;L=G.metrics}P=24*(x-T.scale)}D?(t.verticalizable=!0,A.push({glyph:O,imageName:k,x:f,y:d+P,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:C,metrics:L,rect:I}),f+=R*T.scale+l):(A.push({glyph:O,imageName:k,x:f,y:d+P,vertical:D,scale:T.scale,fontStack:T.fontStack,sectionIndex:C,metrics:L,rect:I}),f+=L.advance*T.scale+l)}0!==A.length&&(p=Math.max(f-l,p),Lh(A,0,A.length-1,v,E)),f=0;var V=a*x+E;M.lineOffset=Math.max(E,w),d+=V,m=Math.max(V,m),++g}else d+=a,++g}var H,W=d- -17,$=Ph(o),q=$.horizontalAlign,X=$.verticalAlign;(function(t,e,r,n,i,a,o,s,u){var l,c=(e-r)*i;l=a!==o?-s*n- -17:(-n*u+.5)*o;for(var h=0,f=t;h<f.length;h+=1)for(var d=0,p=f[h].positionedGlyphs;d<p.length;d+=1){var m=p[d];m.x+=c,m.y+=l}})(t.positionedLines,v,q,X,p,m,a,W,i.length),t.top+=-X*W,t.bottom=t.top+W,t.left+=-q*p,t.right=t.left+p}(P,e,r,n,v,o,s,u,h,l,f,m),!function(t){for(var e=0,r=t;e<r.length;e+=1)if(0!==r[e].positionedGlyphs.length)return!1;return!0}(O)&&P}xh.fromFeature=function(t,e){for(var r=new xh,n=0;n<t.sections.length;n++){var i=t.sections[n];i.image?r.addImageSection(i):r.addTextSection(i,e)}return r},xh.prototype.length=function(){return this.text.length},xh.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},xh.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},xh.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},xh.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;e+=n&&Fo(n)&&!Wc[t[r+1]]||i&&Fo(i)&&!Wc[t[r-1]]||!Wc[t[r]]?t[r]:Wc[t[r]]}return e}(this.text)},xh.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Mh[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=t&&Mh[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},xh.prototype.substring=function(t,e){var r=new xh;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},xh.prototype.toString=function(){return this.text},xh.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,r){return Math.max(e,t.sections[r].scale)}),0)},xh.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(bh.forText(t.scale,t.fontStack||e));for(var r=this.sections.length-1,n=0;n<t.text.length;++n)this.sectionIndex.push(r)},xh.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(bh.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},xh.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Mh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ah={};function Eh(t,e,r,n,i,a){if(e.imageName){var o=n[e.imageName];return o?o.displaySize[0]*e.scale*24/a+i:0}var s=r[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function Sh(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function Th(t,e,r){var n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function Ch(t,e,r,n,i,a){for(var o=null,s=Sh(e,r,i,a),u=0,l=n;u<l.length;u+=1){var c=l[u],h=Sh(e-c.x,r,i,a)+c.badness;h<=s&&(o=c,s=h)}return{index:t,x:e,priorBreak:o,badness:s}}function Oh(t,e,r,n,i,a,o){if("point"!==a)return[];if(!t)return[];for(var s,u=[],l=function(t,e,r,n,i,a){for(var o=0,s=0;s<t.length();s++){var u=t.getSection(s);o+=Eh(t.getCharCode(s),u,n,i,e,a)}return o/Math.max(1,Math.ceil(o/r))}(t,e,r,n,i,o),c=t.text.indexOf("​")>=0,h=0,f=0;f<t.length();f++){var d=t.getSection(f),p=t.getCharCode(f);if(Mh[p]||(h+=Eh(p,d,n,i,e,o)),f<t.length()-1){var m=!((s=p)<11904||!(Ro["Bopomofo Extended"](s)||Ro.Bopomofo(s)||Ro["CJK Compatibility Forms"](s)||Ro["CJK Compatibility Ideographs"](s)||Ro["CJK Compatibility"](s)||Ro["CJK Radicals Supplement"](s)||Ro["CJK Strokes"](s)||Ro["CJK Symbols and Punctuation"](s)||Ro["CJK Unified Ideographs Extension A"](s)||Ro["CJK Unified Ideographs"](s)||Ro["Enclosed CJK Letters and Months"](s)||Ro["Halfwidth and Fullwidth Forms"](s)||Ro.Hiragana(s)||Ro["Ideographic Description Characters"](s)||Ro["Kangxi Radicals"](s)||Ro["Katakana Phonetic Extensions"](s)||Ro.Katakana(s)||Ro["Vertical Forms"](s)||Ro["Yi Radicals"](s)||Ro["Yi Syllables"](s)));(Ah[p]||m||d.imageName)&&u.push(Ch(f+1,h,l,u,Th(p,t.getCharCode(f+1),m&&c),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Ch(t.length(),h,l,u,0,!0))}function Ph(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Lh(t,e,r,n,i){if(n||i)for(var a=t[r],o=(t[r].x+a.metrics.advance*a.scale)*n,s=e;s<=r;s++)t[s].x-=o,t[s].y+=i}function Ih(t,e,r,n,i,a){var o,s=t.image;if(s.content){var u=s.content,l=s.pixelRatio||1;o=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,f,d,p=e.left*a,m=e.right*a;"width"===r||"both"===r?(d=i[0]+p-n[3],h=i[0]+m+n[1]):h=(d=i[0]+(p+m-s.displaySize[0])/2)+s.displaySize[0];var v=e.top*a,g=e.bottom*a;return"height"===r||"both"===r?(c=i[1]+v-n[0],f=i[1]+g+n[2]):f=(c=i[1]+(v+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:f,left:d,collisionPadding:o}}Ah[10]=!0,Ah[32]=!0,Ah[38]=!0,Ah[40]=!0,Ah[41]=!0,Ah[43]=!0,Ah[45]=!0,Ah[47]=!0,Ah[173]=!0,Ah[183]=!0,Ah[8203]=!0,Ah[8208]=!0,Ah[8211]=!0,Ah[8231]=!0;var kh=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function Rh(t,e){var r=e.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new Zo(t+1))};if("source"===r.kind)return{kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,a=0;a<n.length&&n[a]<=t;)a++;for(var o=a=Math.max(0,a-1);o<n.length&&n[o]<t+1;)o++;o=Math.min(n.length-1,o);var s=n[a],u=n[o];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:r.evaluate(new Zo(s)),maxSize:r.evaluate(new Zo(u)),interpolationType:i}}function Dh(t,e,r){var n=e.uSize,i=r.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?ki(i/128,r.upperSize/128,e.uSizeT):n}function Bh(t,e){var r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,a=i?d(Xi.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=ki(t.minSize,t.maxSize,a):r=a}return{uSizeT:r,uSize:n}}To("Anchor",kh);var Fh=Object.freeze({__proto__:null,getSizeData:Rh,evaluateSizeForFeature:Dh,evaluateSizeForZoom:Bh,SIZE_PACK_FACTOR:128});function jh(t,e,r,n,i){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-r/2;){if(--o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var u=[],l=0;s<r/2;){var c=t[o],h=t[o+1];if(!h)return!1;var f=t[o-1].angleTo(c)-c.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>n;)l-=u.shift().angleDelta;if(l>i)return!1;o++,s+=c.dist(h)}return!0}function Nh(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function Uh(t,e,r){return t?.6*e*r:0}function zh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Gh(t,e,r,n,i,a){for(var o=Uh(r,i,a),s=zh(r,n)*a,u=0,l=Nh(t)/2,c=0;c<t.length-1;c++){var h=t[c],f=t[c+1],d=h.dist(f);if(u+d>l){var p=(l-u)/d,m=ki(h.x,f.x,p),v=ki(h.y,f.y,p),g=new kh(m,v,f.angleTo(h),c);return g._round(),!o||jh(t,g,s,o,e)?g:void 0}u+=d}}function Vh(t,e,r,n,i,a,o,s,u){var l=Uh(n,a,o),c=zh(n,i),h=c*o,f=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,r,n,i,a,o,s,u,l){for(var c=o/2,h=Nh(e),f=0,d=r-n,p=[],m=0;m<e.length-1;m++){for(var v=e[m],g=e[m+1],y=v.dist(g),_=g.angleTo(v);d+n<f+y;){var b=((d+=n)-f)/y,x=ki(v.x,g.x,b),w=ki(v.y,g.y,b);if(x>=0&&x<l&&w>=0&&w<l&&d-c>=0&&d+c<=h){var M=new kh(x,w,_,m);M._round(),i&&!jh(e,M,o,i,a)||p.push(M)}}f+=y}return u||p.length||s||(p=t(e,f/2,n,i,a,o,s,!0,l)),p}(t,f?e/2*s%e:(c/2+2*a)*o*s%e,e,l,r,h,f,!1,u)}function Hh(t,e,r,n,a){for(var o=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],f=u[c+1];h.x<e&&f.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x<e&&(f=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y<r&&f.y<r||(h.y<r?h=new i(h.x+(r-h.y)/(f.y-h.y)*(f.x-h.x),r)._round():f.y<r&&(f=new i(h.x+(r-h.y)/(f.y-h.y)*(f.x-h.x),r)._round()),h.x>=n&&f.x>=n||(h.x>=n?h=new i(n,h.y+(n-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x>=n&&(f=new i(n,h.y+(n-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y>=a&&f.y>=a||(h.y>=a?h=new i(h.x+(a-h.y)/(f.y-h.y)*(f.x-h.x),a)._round():f.y>=a&&(f=new i(h.x+(a-h.y)/(f.y-h.y)*(f.x-h.x),a)._round()),l&&h.equals(l[l.length-1])||o.push(l=[h]),l.push(f)))))}return o}function Wh(t,e,r,n){var a=[],o=t.image,s=o.pixelRatio,u=o.paddedRect.w-2,l=o.paddedRect.h-2,c=t.right-t.left,h=t.bottom-t.top,f=o.stretchX||[[0,u]],d=o.stretchY||[[0,l]],p=function(t,e){return t+e[1]-e[0]},m=f.reduce(p,0),v=d.reduce(p,0),g=u-m,y=l-v,_=0,b=m,x=0,w=v,M=0,A=g,E=0,S=y;if(o.content&&n){var T=o.content;_=$h(f,0,T[0]),x=$h(d,0,T[1]),b=$h(f,T[0],T[2]),w=$h(d,T[1],T[3]),M=T[0]-_,E=T[1]-x,A=T[2]-T[0]-b,S=T[3]-T[1]-w}var C=function(n,a,u,l){var f=Xh(n.stretch-_,b,c,t.left),d=Kh(n.fixed-M,A,n.stretch,m),p=Xh(a.stretch-x,w,h,t.top),g=Kh(a.fixed-E,S,a.stretch,v),y=Xh(u.stretch-_,b,c,t.left),T=Kh(u.fixed-M,A,u.stretch,m),C=Xh(l.stretch-x,w,h,t.top),O=Kh(l.fixed-E,S,l.stretch,v),P=new i(f,p),L=new i(y,p),I=new i(y,C),k=new i(f,C),R=new i(d/s,g/s),D=new i(T/s,O/s),B=e*Math.PI/180;if(B){var F=Math.sin(B),j=Math.cos(B),N=[j,-F,F,j];P._matMult(N),L._matMult(N),k._matMult(N),I._matMult(N)}var U=n.stretch+n.fixed,z=a.stretch+a.fixed;return{tl:P,tr:L,bl:k,br:I,tex:{x:o.paddedRect.x+1+U,y:o.paddedRect.y+1+z,w:u.stretch+u.fixed-U,h:l.stretch+l.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:D,minFontScaleX:A/s/c,minFontScaleY:S/s/h,isSDF:r}};if(n&&(o.stretchX||o.stretchY))for(var O=qh(f,g,m),P=qh(d,y,v),L=0;L<O.length-1;L++)for(var I=O[L],k=O[L+1],R=0;R<P.length-1;R++)a.push(C(I,P[R],k,P[R+1]));else a.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:l+1}));return a}function $h(t,e,r){for(var n=0,i=0,a=t;i<a.length;i+=1){var o=a[i];n+=Math.max(e,Math.min(r,o[1]))-Math.max(e,Math.min(r,o[0]))}return n}function qh(t,e,r){for(var n=[{fixed:-1,stretch:0}],i=0,a=t;i<a.length;i+=1){var o=a[i],s=o[0],u=o[1],l=n[n.length-1];n.push({fixed:s-l.stretch,stretch:l.stretch}),n.push({fixed:s-l.stretch,stretch:l.stretch+(u-s)})}return n.push({fixed:e+1,stretch:r}),n}function Xh(t,e,r,n){return t/e*r+n}function Kh(t,e,r,n){return t-e*r/n}var Zh=function(t,e,r,n,a,o,s,u,l,c){if(this.boxStartIndex=t.length,l){var h=o.top,f=o.bottom,d=o.collisionPadding;d&&(h-=d[1],f+=d[3]);var p=f-h;p>0&&(p=Math.max(10,p),this.circleDiameter=p)}else{var m=o.top*s-u,v=o.bottom*s+u,g=o.left*s-u,y=o.right*s+u,_=o.collisionPadding;if(_&&(g-=_[0]*s,m-=_[1]*s,y+=_[2]*s,v+=_[3]*s),c){var b=new i(g,m),x=new i(y,m),w=new i(g,v),M=new i(y,v),A=c*Math.PI/180;b._rotate(A),x._rotate(A),w._rotate(A),M._rotate(A),g=Math.min(b.x,x.x,w.x,M.x),y=Math.max(b.x,x.x,w.x,M.x),m=Math.min(b.y,x.y,w.y,M.y),v=Math.max(b.y,x.y,w.y,M.y)}t.emplaceBack(e.x,e.y,g,m,y,v,r,n,a)}this.boxEndIndex=t.length},Yh=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=Jh),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Jh(t,e){return t<e?-1:t>e?1:0}function Qh(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,a=1/0,o=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<n)&&(n=c.x),(!l||c.y<a)&&(a=c.y),(!l||c.x>o)&&(o=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(o-n,s-a),f=h/2,d=new Yh([],tf);if(0===h)return new i(n,a);for(var p=n;p<o;p+=h)for(var m=a;m<s;m+=h)d.push(new ef(p+f,m+f,f,t));for(var v=function(t){for(var e=0,r=0,n=0,i=t[0],a=0,o=i.length,s=o-1;a<o;s=a++){var u=i[a],l=i[s],c=u.x*l.y-l.x*u.y;r+=(u.x+l.x)*c,n+=(u.y+l.y)*c,e+=3*c}return new ef(r/e,n/e,0,t)}(t),g=d.length;d.length;){var y=d.pop();(y.d>v.d||!v.d)&&(v=y,r&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,g)),y.max-v.d<=e||(d.push(new ef(y.p.x-(f=y.h/2),y.p.y-f,f,t)),d.push(new ef(y.p.x+f,y.p.y-f,f,t)),d.push(new ef(y.p.x-f,y.p.y+f,f,t)),d.push(new ef(y.p.x+f,y.p.y+f,f,t)),g+=4)}return r&&(console.log("num probes: "+g),console.log("best distance: "+v.d)),v.p}function tf(t,e){return e.max-t.max}function ef(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var a=e[i],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],c=a[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(r=!r),n=Math.min(n,Nu(t,l,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}Yh.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},Yh.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},Yh.prototype.peek=function(){return this.data[0]},Yh.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,a=e[i];if(r(n,a)>=0)break;e[t]=a,t=i}e[t]=n},Yh.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var a=1+(t<<1),o=e[a],s=a+1;if(s<this.length&&r(e[s],o)<0&&(a=s,o=e[s]),r(o,i)>=0)break;e[t]=o,t=a}e[t]=i};var rf=Number.POSITIVE_INFINITY;function nf(t,e){return e[1]!==rf?function(t,e,r){var n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-r}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,i]}(t,e[0],e[1]):function(t,e){var r=0,n=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-7;break;case"bottom-right":case"bottom-left":n=7-i;break;case"bottom":n=7-e;break;case"top":n=e-7}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}(t,e[0])}function af(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function of(t,e,r,n,a,o,s,u,l,c,h,f,d,p,m){var v=function(t,e,r,n,a,o,s,u){for(var l=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,c=[],h=0,f=e.positionedLines;h<f.length;h+=1)for(var d=f[h],p=0,m=d.positionedGlyphs;p<m.length;p+=1){var v=m[p];if(v.rect){var g=v.rect||{},y=4,_=!0,b=1,x=0,w=(a||u)&&v.vertical,M=v.metrics.advance*v.scale/2;if(u&&e.verticalizable&&(x=d.lineOffset/2-(v.imageName?-(24-v.metrics.width*v.scale)/2:24*(v.scale-1))),v.imageName){var A=s[v.imageName];_=A.sdf,y=1/(b=A.pixelRatio)}var E=a?[v.x+M,v.y]:[0,0],S=a?[0,0]:[v.x+M+r[0],v.y+r[1]-x],T=[0,0];w&&(T=S,S=[0,0]);var C=(v.metrics.left-y)*v.scale-M+S[0],O=(-v.metrics.top-y)*v.scale+S[1],P=C+g.w*v.scale/b,L=O+g.h*v.scale/b,I=new i(C,O),k=new i(P,O),R=new i(C,L),D=new i(P,L);if(w){var B=new i(-M,M- -17),F=-Math.PI/2,j=12-M,N=new i(22-j,-(v.imageName?j:0)),U=new(Function.prototype.bind.apply(i,[null].concat(T)));I._rotateAround(F,B)._add(N)._add(U),k._rotateAround(F,B)._add(N)._add(U),R._rotateAround(F,B)._add(N)._add(U),D._rotateAround(F,B)._add(N)._add(U)}if(l){var z=Math.sin(l),G=Math.cos(l),V=[G,-z,z,G];I._matMult(V),k._matMult(V),R._matMult(V),D._matMult(V)}var H=new i(0,0),W=new i(0,0);c.push({tl:I,tr:k,bl:R,br:D,tex:g,writingMode:e.writingMode,glyphOffset:E,sectionIndex:v.sectionIndex,isSDF:_,pixelOffsetTL:H,pixelOffsetBR:W,minFontScaleX:0,minFontScaleY:0})}}return c}(0,r,u,a,o,s,n,t.allowVerticalPlacement),g=t.textSizeData,y=null;"source"===g.kind?(y=[128*a.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((y=[128*p.compositeTextSizes[0].evaluate(s,{},m),128*p.compositeTextSizes[1].evaluate(s,{},m)])[0]>32640||y[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,v,y,u,o,s,c,e,l.lineStartIndex,l.lineLength,d,m);for(var _=0,b=h;_<b.length;_+=1)f[b[_]]=t.text.placedSymbolArray.length-1;return 4*v.length}function sf(t){for(var e in t)return t[e];return null}function uf(t,e,r,n){var i=t.compareText;if(e in i){for(var a=i[e],o=a.length-1;o>=0;o--)if(n.dist(a[o])<r)return!0}else i[e]=[];return i[e].push(n),!1}var lf=yc.VectorTileFeature.types,cf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hf(t,e,r,n,i,a,o,s,u,l,c,h,f){var d=s?Math.min(32640,Math.round(s[0])):0,p=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),a,o,(d<<1)+(u?1:0),p,16*l,16*c,256*h,256*f)}function ff(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function df(t){for(var e=0,r=t.sections;e<r.length;e+=1)if(Uo(r[e].text))return!0;return!1}var pf=function(t){this.layoutVertexArray=new Ms,this.indexArray=new Ps,this.programConfigurations=t,this.segments=new Zs,this.dynamicLayoutVertexArray=new As,this.opacityVertexArray=new Es,this.placedSymbolArray=new Gs};pf.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},pf.prototype.upload=function(t,e,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nc.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Uc.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,cf,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t))},pf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},To("SymbolBuffers",pf);var mf=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new Zs,this.collisionVertexArray=new Os};mf.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,zc.members,!0)},mf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},To("CollisionBuffers",mf);var vf=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zu([]),this.placementViewportMatrix=Zu([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rh(this.zoom,e["text-size"]),this.iconSizeData=Rh(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((function(t){return _h[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};vf.prototype.createArrays=function(){this.text=new pf(new Mu(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new pf(new Mu(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new Ws,this.lineVertexArray=new $s,this.symbolInstances=new Hs},vf.prototype.calculateGlyphDependencies=function(t,e,r,n,i){for(var a=0;a<t.length;a++)if(e[t.charCodeAt(a)]=!0,(r||n)&&i){var o=Wc[t.charAt(a)];o&&(e[o.charCodeAt(0)]=!0)}},vf.prototype.populate=function(t,e,r){var n=this.layers[0],i=n.layout,a=i.get("text-font"),o=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==o.value.kind||o.value.value instanceof $n&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),l="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],u||l){for(var h=e.iconDependencies,f=e.glyphDependencies,d=e.availableImages,p=new Zo(this.zoom),m=0,v=t;m<v.length;m+=1){var g=v[m],y=g.feature,_=g.id,b=g.index,x=g.sourceLayerIndex,w=n._featureFilter.needGeometry,M=Ou(y,w);if(n._featureFilter.filter(p,M,r)){w||(M.geometry=Cu(y));var A=void 0;if(u){var E=n.getValueAndResolveTokens("text-field",M,r,d),S=$n.factory(E);df(S)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===qo()||this.hasRTLText&&Ko.isParsed())&&(A=Hc(S,n,M))}var T=void 0;if(l){var C=n.getValueAndResolveTokens("icon-image",M,r,d);T=C instanceof qn?C:qn.fromString(C)}if(A||T){var O=this.sortFeaturesByKey?c.evaluate(M,{},r):void 0;if(this.features.push({id:_,text:A,icon:T,index:b,sourceLayerIndex:x,geometry:M.geometry,properties:y.properties,type:lf[y.type],sortKey:O}),T&&(h[T.name]=!0),A){var P=a.evaluate(M,{},r).join(","),L="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(_h.vertical)>=0;for(var I=0,k=A.sections;I<k.length;I+=1){var R=k[I];if(R.image)h[R.image.name]=!0;else{var D=Do(A.toString()),B=R.fontStack||P,F=f[B]=f[B]||{};this.calculateGlyphDependencies(R.text,F,L,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function a(e){n.push(t[e]),i++}function o(t,e,i){var a=r[t];return delete r[t],r[e]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(i[0]),a}function s(t,r,i){var a=e[r];return delete e[r],e[t]=a,n[a].geometry[0].shift(),n[a].geometry[0]=i[0].concat(n[a].geometry[0]),a}function u(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.text?c.text.toString():null;if(f){var d=u(f,h),p=u(f,h,!0);if(d in r&&p in e&&r[d]!==e[p]){var m=s(d,p,h),v=o(d,p,n[m].geometry);delete e[d],delete r[p],r[u(f,n[v].geometry,!0)]=v,n[m].geometry=null}else d in r?o(d,p,h):p in e?s(d,p,h):(a(l),e[d]=i-1,r[p]=i-1)}else a(l)}return n.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},vf.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},vf.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},vf.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},vf.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},vf.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},vf.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},vf.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:n},o<e.length-1&&(n+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=a[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},vf.prototype.addSymbols=function(t,e,r,n,i,a,o,s,u,l,c,h){for(var f=t.indexArray,d=t.layoutVertexArray,p=t.segments.prepareSegment(4*e.length,d,f,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,v=p.vertexLength,g=this.allowVerticalPlacement&&o===_h.vertical?Math.PI/2:0,y=a.text&&a.text.sections,_=0;_<e.length;_++){var b=e[_],x=b.tl,w=b.tr,M=b.bl,A=b.br,E=b.tex,S=b.pixelOffsetTL,T=b.pixelOffsetBR,C=b.minFontScaleX,O=b.minFontScaleY,P=b.glyphOffset,L=b.isSDF,I=b.sectionIndex,k=p.vertexLength,R=P[1];hf(d,s.x,s.y,x.x,R+x.y,E.x,E.y,r,L,S.x,S.y,C,O),hf(d,s.x,s.y,w.x,R+w.y,E.x+E.w,E.y,r,L,T.x,S.y,C,O),hf(d,s.x,s.y,M.x,R+M.y,E.x,E.y+E.h,r,L,S.x,T.y,C,O),hf(d,s.x,s.y,A.x,R+A.y,E.x+E.w,E.y+E.h,r,L,T.x,T.y,C,O),ff(t.dynamicLayoutVertexArray,s,g),f.emplaceBack(k,k+1,k+2),f.emplaceBack(k+1,k+2,k+3),p.vertexLength+=4,p.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),_!==e.length-1&&I===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(d.length,a,a.index,{},h,y&&y[I])}t.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,v,u,l,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,!1,0,c)},vf.prototype._addCollisionDebugVertex=function(t,e,r,n,i,a){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(a.x),Math.round(a.y))},vf.prototype.addCollisionDebugVertices=function(t,e,r,n,a,o,s){var u=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),l=u.vertexLength,c=a.layoutVertexArray,h=a.collisionVertexArray,f=s.anchorX,d=s.anchorY;this._addCollisionDebugVertex(c,h,o,f,d,new i(t,e)),this._addCollisionDebugVertex(c,h,o,f,d,new i(r,e)),this._addCollisionDebugVertex(c,h,o,f,d,new i(r,n)),this._addCollisionDebugVertex(c,h,o,f,d,new i(t,n)),u.vertexLength+=4;var p=a.indexArray;p.emplaceBack(l,l+1),p.emplaceBack(l+1,l+2),p.emplaceBack(l+2,l+3),p.emplaceBack(l+3,l),u.primitiveLength+=4},vf.prototype.addDebugCollisionBoxes=function(t,e,r,n){for(var i=t;i<e;i++){var a=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(a.x1,a.y1,a.x2,a.y2,n?this.textCollisionBox:this.iconCollisionBox,a.anchorPoint,r)}},vf.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(Ts,Gc.members,Bs),this.iconCollisionBox=new mf(Ts,Gc.members,Bs);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},vf.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i,a,o,s,u){for(var l={},c=e;c<r;c++){var h=t.get(c);l.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},l.textFeatureIndex=h.featureIndex;break}for(var f=n;f<i;f++){var d=t.get(f);l.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},l.verticalTextFeatureIndex=d.featureIndex;break}for(var p=a;p<o;p++){var m=t.get(p);l.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},l.iconFeatureIndex=m.featureIndex;break}for(var v=s;v<u;v++){var g=t.get(v);l.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},l.verticalIconFeatureIndex=g.featureIndex;break}return l},vf.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},vf.prototype.hasTextData=function(){return this.text.segments.get().length>0},vf.prototype.hasIconData=function(){return this.icon.segments.get().length>0},vf.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},vf.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},vf.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},vf.prototype.addIndicesForPlacedSymbol=function(t,e){for(var r=t.placedSymbolArray.get(e),n=r.vertexStartIndex+4*r.numGlyphs,i=r.vertexStartIndex;i<n;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},vf.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),n=[],i=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);n.push(0|Math.round(e*s.anchorX+r*s.anchorY)),i.push(s.featureIndex)}return a.sort((function(t,e){return n[t]-n[e]||i[e]-i[t]})),a},vf.prototype.addToSortKeyRanges=function(t,e){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===e?r.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},vf.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,n=this.symbolInstanceIndexes;r<n.length;r+=1){var i=this.symbolInstances.get(n[r]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,r,n){t>=0&&n.indexOf(t)===r&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},To("SymbolBucket",vf,{omit:["layers","collisionBoxArray","features","compareText"]}),vf.MAX_GLYPHS=65535,vf.addDynamicAttributes=ff;var gf=new cs({"symbol-placement":new as(yn.layout_symbol["symbol-placement"]),"symbol-spacing":new as(yn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new as(yn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new os(yn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new as(yn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new as(yn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new as(yn.layout_symbol["icon-ignore-placement"]),"icon-optional":new as(yn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new as(yn.layout_symbol["icon-rotation-alignment"]),"icon-size":new os(yn.layout_symbol["icon-size"]),"icon-text-fit":new as(yn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new as(yn.layout_symbol["icon-text-fit-padding"]),"icon-image":new os(yn.layout_symbol["icon-image"]),"icon-rotate":new os(yn.layout_symbol["icon-rotate"]),"icon-padding":new as(yn.layout_symbol["icon-padding"]),"icon-keep-upright":new as(yn.layout_symbol["icon-keep-upright"]),"icon-offset":new os(yn.layout_symbol["icon-offset"]),"icon-anchor":new os(yn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new as(yn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new as(yn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new as(yn.layout_symbol["text-rotation-alignment"]),"text-field":new os(yn.layout_symbol["text-field"]),"text-font":new os(yn.layout_symbol["text-font"]),"text-size":new os(yn.layout_symbol["text-size"]),"text-max-width":new os(yn.layout_symbol["text-max-width"]),"text-line-height":new as(yn.layout_symbol["text-line-height"]),"text-letter-spacing":new os(yn.layout_symbol["text-letter-spacing"]),"text-justify":new os(yn.layout_symbol["text-justify"]),"text-radial-offset":new os(yn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new as(yn.layout_symbol["text-variable-anchor"]),"text-anchor":new os(yn.layout_symbol["text-anchor"]),"text-max-angle":new as(yn.layout_symbol["text-max-angle"]),"text-writing-mode":new as(yn.layout_symbol["text-writing-mode"]),"text-rotate":new os(yn.layout_symbol["text-rotate"]),"text-padding":new as(yn.layout_symbol["text-padding"]),"text-keep-upright":new as(yn.layout_symbol["text-keep-upright"]),"text-transform":new os(yn.layout_symbol["text-transform"]),"text-offset":new os(yn.layout_symbol["text-offset"]),"text-allow-overlap":new as(yn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new as(yn.layout_symbol["text-ignore-placement"]),"text-optional":new as(yn.layout_symbol["text-optional"])}),yf={paint:new cs({"icon-opacity":new os(yn.paint_symbol["icon-opacity"]),"icon-color":new os(yn.paint_symbol["icon-color"]),"icon-halo-color":new os(yn.paint_symbol["icon-halo-color"]),"icon-halo-width":new os(yn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new os(yn.paint_symbol["icon-halo-blur"]),"icon-translate":new as(yn.paint_symbol["icon-translate"]),"icon-translate-anchor":new as(yn.paint_symbol["icon-translate-anchor"]),"text-opacity":new os(yn.paint_symbol["text-opacity"]),"text-color":new os(yn.paint_symbol["text-color"],{runtimeType:Pn,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new os(yn.paint_symbol["text-halo-color"]),"text-halo-width":new os(yn.paint_symbol["text-halo-width"]),"text-halo-blur":new os(yn.paint_symbol["text-halo-blur"]),"text-translate":new as(yn.paint_symbol["text-translate"]),"text-translate-anchor":new as(yn.paint_symbol["text-translate-anchor"])}),layout:gf},_f=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Sn,this.defaultValue=t};_f.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},_f.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},_f.prototype.outputDefined=function(){return!1},_f.prototype.serialize=function(){return null},To("FormatSectionOverride",_f,{omit:["defaultValue"]});var bf=function(t){function e(e){t.call(this,e,yf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){if(t.prototype.recalculate.call(this,e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var n=this.layout.get("text-writing-mode");if(n){for(var i=[],a=0,o=n;a<o.length;a+=1){var s=o[a];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,r,n){var i=this.layout.get(t).evaluate(e,{},r,n),a=this._unevaluatedLayout._values[t];return a.isDataDriven()||Ra(a.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,r){return r in t?String(t[r]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new vf(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,r=yf.paint.overridableProperties;t<r.length;t+=1){var n=r[t];if(e.hasPaintOverride(this.layout,n)){var i,a=this.paint.get(n),o=new _f(a),s=new ka(o,a.property.specification);i="constant"===a.value.kind||"source"===a.value.kind?new Ba("source",s):new Fa("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new ns(a.property,i,a.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var r=t.get("text-field"),n=yf.paint.properties[e],i=!1,a=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n.overrides&&n.overrides.hasOverride(r[e]))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof $n)a(r.value.value.sections);else if("source"===r.value.kind){var o=function(t){i||(t instanceof Jn&&Zn(t.value)===Rn?a(t.value.sections):t instanceof ri?a(t.sections):t.eachChild(o))},s=r.value;s._styleExpression&&o(s._styleExpression.expression)}return i},e}(hs),xf={paint:new cs({"background-color":new as(yn.paint_background["background-color"]),"background-pattern":new us(yn.paint_background["background-pattern"]),"background-opacity":new as(yn.paint_background["background-opacity"])})},wf=function(t){function e(e){t.call(this,e,xf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(hs),Mf={paint:new cs({"raster-opacity":new as(yn.paint_raster["raster-opacity"]),"raster-hue-rotate":new as(yn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new as(yn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new as(yn.paint_raster["raster-brightness-max"]),"raster-saturation":new as(yn.paint_raster["raster-saturation"]),"raster-contrast":new as(yn.paint_raster["raster-contrast"]),"raster-resampling":new as(yn.paint_raster["raster-resampling"]),"raster-fade-duration":new as(yn.paint_raster["raster-fade-duration"])})},Af=function(t){function e(e){t.call(this,e,Mf)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(hs),Ef=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(hs),Sf={paint:new cs({"sky-type":new as(yn.paint_sky["sky-type"]),"sky-atmosphere-sun":new as(yn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new as(yn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new as(yn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new as(yn.paint_sky["sky-gradient-radius"]),"sky-gradient":new ls(yn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new as(yn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new as(yn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new as(yn.paint_sky["sky-opacity"])})},Tf={circle:cl,heatmap:bl,hillshade:wl,fill:uc,"fill-extrusion":Ec,line:Fc,symbol:bf,background:wf,raster:Af,sky:function(t){function e(e){t.call(this,e,Sf),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)},e.prototype._updateColorRamp=function(){this.colorRamp=_l({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)},e.prototype.needsSkyboxCapture=function(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){var e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}},e.prototype.getCenter=function(t,e){var r=[0,0];return function(t,e,r){var n=el(0,0,1),i=ul(sl());return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s}(i,i,r?-c(t)+Math.PI:c(t)),ll(i,i,-c(e)),nl(n,n,i),rl(n,n)}(r[0],90-r[1],e)},e.prototype.is3D=function(){return!1},e.prototype.isSky=function(){return!0},e.prototype.markSkyboxValid=function(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")},e.prototype.hasOffscreenPass=function(){return!0},e.prototype.getProgramIds=function(){var t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null},e}(hs)},Cf=o.HTMLImageElement,Of=o.HTMLCanvasElement,Pf=o.HTMLVideoElement,Lf=o.ImageData,If=o.ImageBitmap,kf=function(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)};kf.prototype.update=function(t,e,r){var n=t.width,i=t.height,a=!(this.size&&this.size[0]===n&&this.size[1]===i||r),o=this.context,s=o.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),a)this.size=[n,i],t instanceof Cf||t instanceof Of||t instanceof Pf||t instanceof Lf||If&&t instanceof If?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=r||{x:0,y:0},l=u.x,c=u.y;t instanceof Cf||t instanceof Of||t instanceof Pf||t instanceof Lf||If&&t instanceof If?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},kf.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},kf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},kf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Rf=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Rf.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Rf.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Df=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},b(["receive","process"],this),this.invoker=new Rf(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=O()?t:o};function Bf(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Df.prototype.send=function(t,e,r,n,i){var a=this;void 0===i&&(i=!1);var o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[o]=r);var s=I(this.globalScope)?void 0:[],u=Lo(e,s);return this.target.postMessage({id:o,type:t,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:u},s),{cancel:function(){r&&delete a.callbacks[o],a.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:a.mapId})}}},Df.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n()}else O()||e.mustQueue?(this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,e)},Df.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Df.prototype.processTask=function(t,e){var r=this;if("<response>"===e.type){var n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Io(e.error)):n(null,Io(e.data)))}else{var i=!1,a=I(this.globalScope)?void 0:[],o=e.hasCallback?function(e,n){i=!0,delete r.cancelCallbacks[t];var o=Lo(n,a);r.target.postMessage({id:t,type:"<response>",sourceMapId:r.mapId,error:e?Lo(e):null,data:o},a)}:function(t){i=!0},s=null,u=Io(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,o);else if(this.parent.getWorkerSource){var l=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,l[0],u.source)[l[1]](u,o)}else o(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Df.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ff=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ff.prototype.setNorthEast=function(t){return this._ne=t instanceof jf?new jf(t.lng,t.lat):jf.convert(t),this},Ff.prototype.setSouthWest=function(t){return this._sw=t instanceof jf?new jf(t.lng,t.lat):jf.convert(t),this},Ff.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof jf)e=t,r=t;else{if(!(t instanceof Ff))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ff.convert(t)):this.extend(jf.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new jf(e.lng,e.lat),this._ne=new jf(r.lng,r.lat)),this},Ff.prototype.getCenter=function(){return new jf((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ff.prototype.getSouthWest=function(){return this._sw},Ff.prototype.getNorthEast=function(){return this._ne},Ff.prototype.getNorthWest=function(){return new jf(this.getWest(),this.getNorth())},Ff.prototype.getSouthEast=function(){return new jf(this.getEast(),this.getSouth())},Ff.prototype.getWest=function(){return this._sw.lng},Ff.prototype.getSouth=function(){return this._sw.lat},Ff.prototype.getEast=function(){return this._ne.lng},Ff.prototype.getNorth=function(){return this._ne.lat},Ff.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ff.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ff.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ff.prototype.contains=function(t){var e=jf.convert(t),r=e.lng,n=e.lat,i=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i},Ff.convert=function(t){return!t||t instanceof Ff?t:new Ff(t)};var jf=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};jf.prototype.wrap=function(){return new jf(p(this.lng,-180,180),this.lat)},jf.prototype.toArray=function(){return[this.lng,this.lat]},jf.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},jf.prototype.distanceTo=function(t){var e=Math.PI/180,r=this.lat*e,n=t.lat*e,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},jf.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Ff(new jf(this.lng-r,this.lat-e),new jf(this.lng+r,this.lat+e))},jf.convert=function(t){if(t instanceof jf)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new jf(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new jf(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Nf=2*Math.PI*6371008.8;function Uf(t){return Nf*Math.cos(t*Math.PI/180)}function zf(t){return(180+t)/360}function Gf(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Vf(t,e){return t/Uf(e)}function Hf(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Wf(t,e){return t*Uf(Hf(e))}var $f=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};$f.fromLngLat=function(t,e){void 0===e&&(e=0);var r=jf.convert(t);return new $f(zf(r.lng),Gf(r.lat),Vf(e,r.lat))},$f.prototype.toLngLat=function(){return new jf(function(t){return 360*t-180}(this.x),Hf(this.y))},$f.prototype.toAltitude=function(){return Wf(this.z,this.y)},$f.prototype.meterInMercatorCoordinateUnits=function(){return 1/Nf*(t=Hf(this.y),1/Math.cos(t*Math.PI/180));var t};var qf=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Zf(0,t,t,e,r)};qf.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},qf.prototype.url=function(t,e){var r=function(t,e,r){var n=Bf(256*t,256*(e=Math.pow(2,r)-e-1),r),i=Bf(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(t,e,r){for(var n,i="",a=t;a>0;a--)i+=(e&(n=1<<a-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)},qf.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},qf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xf=function(t,e){this.wrap=t,this.canonical=e,this.key=Zf(t,e.z,e.z,e.x,e.y)},Kf=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new qf(r,+n,+i),this.key=Zf(e,t,r,n,i)};function Zf(t,e,r,n,i){(t*=2)<0&&(t=-1*t-1);var a=1<<r;return(a*a*t+a*i+n).toString(36)+r.toString(36)+e.toString(36)}Kf.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Kf.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Kf(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Kf(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Kf.prototype.calculateScaledKey=function(t,e){var r=this.canonical.z-t;return t>this.canonical.z?Zf(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Zf(this.wrap*+e,t,t,this.canonical.x>>r,this.canonical.y>>r)},Kf.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Kf.prototype.children=function(t){if(this.overscaledZ>=t)return[new Kf(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Kf(e,this.wrap,e,r,n),new Kf(e,this.wrap,e,r+1,n),new Kf(e,this.wrap,e,r,n+1),new Kf(e,this.wrap,e,r+1,n+1)]},Kf.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Kf.prototype.wrapped=function(){return new Kf(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Kf.prototype.unwrapTo=function(t){return new Kf(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Kf.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Kf.prototype.toUnwrapped=function(){return new Xf(this.wrap,this.canonical)},Kf.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Kf.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new $f(t.x-this.wrap,t.y))},To("CanonicalTileID",qf),To("OverscaledTileID",Kf,{omit:["posMatrix"]});var Yf=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return S('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var i=0;i<n;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(n,i)]=this.data[this._idx(n-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,n)]=this.data[this._idx(i,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)]};Yf.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[n],r[n+1],r[n+2])},Yf.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Yf.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Yf.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Yf.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Yf.prototype.getPixels=function(){return new gl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Yf.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,a=r*this.dim,o=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:a=o-1;break;case 1:o=a+1}for(var s=-e*this.dim,u=-r*this.dim,l=a;l<o;l++)for(var c=n;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},To("DEMData",Yf);var Jf=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Jf.prototype.encode=function(t){return this._stringToNumber[t]},Jf.prototype.decode=function(t){return this._numberToString[t]};var Qf=function(t,e,r,n,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,this.id=i},td={geometry:{configurable:!0}};td.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},td.geometry.set=function(t){this._geometry=t},Qf.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(Qf.prototype,td);var ed=function(){this.state={},this.stateChanges={},this.deletedStates={}};ed.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},m(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var a in this.deletedStates[t][n]={},this.state[t][n])r[a]||(this.deletedStates[t][n][a]=null);else for(var o in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][o]&&delete this.deletedStates[t][n][o]},ed.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},ed.prototype.getState=function(t,e){var r=String(e),n=m({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var a in i)delete n[a]}return n},ed.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},ed.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),m(this.state[n][a],this.stateChanges[n][a]),i[a]=this.state[n][a];r[n]=i}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else for(var c=0,h=Object.keys(this.deletedStates[o][l]);c<h.length;c+=1)delete this.state[o][l][h[c]];s[l]=this.state[o][l]}r[o]=r[o]||{},m(r[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var f in t)t[f].setFeatureState(r,e)};var rd=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new wo(8192,16,0),this.grid3D=new wo(8192,16,0),this.featureIndexArray=new Xs,this.promoteId=e};function nd(t,e,r,n,i){return w(t,(function(t,a){var o=e instanceof is?e.get(a):null;return o&&o.evaluate?o.evaluate(r,n,i):o}))}function id(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y)}return{minX:e,minY:r,maxX:n,maxY:i}}function ad(t,e){return e-t}rd.prototype.insert=function(t,e,r,n,i,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var f=l[h];c[0]=Math.min(c[0],f.x),c[1]=Math.min(c[1],f.y),c[2]=Math.max(c[2],f.x),c[3]=Math.max(c[3],f.y)}c[0]<8192&&c[1]<8192&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}},rd.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new yc.VectorTile(new Xc(this.rawTileData)).layers,this.sourceLayerCoder=new Jf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},rd.prototype.query=function(t,e,r,n){var a=this;this.loadVTLayers();for(var o=t.params||{},s=8192/t.tileSize/t.scale,u=Xa(o.filter),l=t.queryGeometry,c=t.queryPadding*s,h=id(l),f=this.grid.query(h.minX-c,h.minY-c,h.maxX+c,h.maxY+c),d=id(t.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,(function(e,r,n,a){return function(t,e,r,n,a){for(var o=0,s=t;o<s.length;o+=1){var u=s[o];if(e<=u.x&&r<=u.y&&n>=u.x&&a>=u.y)return!0}var l=[new i(e,r),new i(e,a),new i(n,a),new i(n,r)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(zu(t,h[c]))return!0;for(var f=0;f<t.length-1;f++)if(Gu(t[f],t[f+1],l))return!0;return!1}(t.cameraQueryGeometry,e-c,r-c,n+c,a+c)})),m=0,v=p;m<v.length;m+=1)f.push(v[m]);f.sort(ad);for(var g,y={},_=function(i){var c=f[i];if(c!==g){g=c;var h=a.featureIndexArray.get(c),d=null;a.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,o.layers,o.availableImages,e,r,n,(function(e,r,n){return d||(d=Cu(e)),r.queryIntersectsFeature(l,e,n,d,a.z,t.transform,s,t.pixelPosMatrix)}))}},b=0;b<f.length;b++)_(b);return y},rd.prototype.loadMatchingFeature=function(t,e,r,n,i,a,o,s,u,l,c){var h=this.bucketLayerIDs[e];if(!a||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(a,h)){var f=this.sourceLayerCoder.decode(r),d=this.vtLayers[f].feature(n);if(i.needGeometry){var p=Ou(d,!0);if(!i.filter(new Zo(this.tileID.overscaledZ),p,this.tileID.canonical))return}else if(!i.filter(new Zo(this.tileID.overscaledZ),d))return;for(var v=this.getId(d,f),g=0;g<h.length;g++){var y=h[g];if(!(a&&a.indexOf(y)<0)){var _=s[y];if(_){var b={};void 0!==v&&l&&(b=l.getState(_.sourceLayer||"_geojsonTileLayer",v));var x=m({},u[y]);x.paint=nd(x.paint,_.paint,d,b,o),x.layout=nd(x.layout,_.layout,d,b,o);var w=!c||c(d,_,b);if(w){var M=new Qf(d,this.z,this.x,this.y,v);M.layer=x;var A=t[y];void 0===A&&(A=t[y]=[]),A.push({featureIndex:n,feature:M,intersectionZ:w})}}}}}},rd.prototype.lookupSymbolFeatures=function(t,e,r,n,i,a,o,s){var u={};this.loadVTLayers();for(var l=Xa(i),c=0,h=t;c<h.length;c+=1)this.loadMatchingFeature(u,r,n,h[c],l,a,o,s,e);return u},rd.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},rd.prototype.getId=function(t,e){var r=t.id;return this.promoteId&&"boolean"==typeof(r=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(r=Number(r)),r},To("FeatureIndex",rd,{omit:["rawTileData","sourceLayerCoder"]});var od=function(t,e){this.tileID=t,this.uid=g(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};od.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<z.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},od.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},od.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var n=function(){var t=a[i],n=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return n.filter((function(e){return e.id===t}))[0]})));for(var o=0,s=n;o<s.length;o+=1)r[s[o].id]=t}},i=0,a=t;i<a.length;i+=1)n();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof vf){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof vf&&o.hasRTLText){this.hasRTLText=!0,Ko.isLoading()||Ko.isLoaded()||"deferred"!==qo()||Xo();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Us},od.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},od.prototype.getBucket=function(t){return this.buckets[t.id]},od.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kf(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kf(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},od.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},od.prototype.queryRenderedFeatures=function(t,e,r,n,i,a,o,s,u,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:n,cameraQueryGeometry:i,scale:a,tileSize:this.tileSize,pixelPosMatrix:l,transform:s,params:o,queryPadding:this.queryPadding*u},t,e,r):{}},od.prototype.querySourceFeatures=function(t,e){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var n=r.loadVTLayers(),i=e?e.sourceLayer:"",a=n._geojsonTileLayer||n[i];if(a)for(var o=Xa(e&&e.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},f=0;f<a.length;f++){var d=a.feature(f);if(o.needGeometry){var p=Ou(d,!0);if(!o.filter(new Zo(this.tileID.overscaledZ),p,this.tileID.canonical))continue}else if(!o.filter(new Zo(this.tileID.overscaledZ),d))continue;var m=r.getId(d,i),v=new Qf(d,u,l,c,m);v.tile=h,t.push(v)}}},od.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},od.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},od.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=P(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var a=this.expirationTime-e;a?this.expirationTime=n+Math.max(a,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},od.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},od.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets)if(e.style.hasLayer(n)){var i=this.buckets[n],a=i.layers[0].sourceLayer||"_geojsonTileLayer",o=r[a],s=t[a];if(o&&s&&0!==Object.keys(s).length){i.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(n);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},od.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},od.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<z.now()},od.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},od.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=z.now()+t},od.prototype.setDependencies=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1)r[i[n]]=!0;this.dependencies[t]=r},od.prototype.hasDependency=function(t,e){for(var r=0,n=t;r<n.length;r+=1){var i=this.dependencies[n[r]];if(i)for(var a=0,o=e;a<o.length;a+=1)if(i[o[a]])return!0}return!1};var sd=o.performance,ud=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},sd.mark(this._marks.start)};ud.prototype.finish=function(){sd.mark(this._marks.end);var t=sd.getEntriesByName(this._marks.measure);return 0===t.length&&(sd.measure(this._marks.measure,this._marks.start,this._marks.end),t=sd.getEntriesByName(this._marks.measure),sd.clearMarks(this._marks.start),sd.clearMarks(this._marks.end),sd.clearMeasures(this._marks.measure)),t},t.Actor=Df,t.AlphaImage=vl,t.CanonicalTileID=qf,t.CollisionBoxArray=Us,t.Color=Vn,t.DEMData=Yf,t.DataConstantProperty=as,t.DictionaryCoder=Jf,t.EXTENT=8192,t.ErrorEvent=vn,t.EvaluationParameters=Zo,t.Event=mn,t.Evented=gn,t.FeatureIndex=rd,t.FillBucket=ac,t.FillExtrusionBucket=wc,t.ImageAtlas=yh,t.ImagePosition=vh,t.LineBucket=kc,t.LngLat=jf,t.LngLatBounds=Ff,t.MAX_SAFE_INTEGER=s,t.MercatorCoordinate=$f,t.ONE_EM=24,t.OverscaledTileID=Kf,t.Point=i,t.Point$1=i,t.Properties=cs,t.Protobuf=Xc,t.RGBAImage=gl,t.RequestManager=K,t.RequestPerformance=ud,t.ResourceType=tn,t.SegmentVector=Zs,t.SourceFeatureState=ed,t.StructArrayLayout1ui2=Fs,t.StructArrayLayout2f1f2i16=Cs,t.StructArrayLayout2i4=gs,t.StructArrayLayout3f12=As,t.StructArrayLayout3ui6=Ps,t.StructArrayLayout4i8=ys,t.SymbolBucket=vf,t.Texture=kf,t.Tile=od,t.Transitionable=Qo,t.Uniform1f=uu,t.Uniform1i=su,t.Uniform2f=lu,t.Uniform3f=cu,t.Uniform4f=hu,t.UniformColor=fu,t.UniformMatrix4f=pu,t.UnwrappedTileID=Xf,t.ValidationError=_n,t.WritingMode=_h,t.ZoomHistory=ko,t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},t.addDynamicAttributes=ff,t.altitudeFromMercatorZ=Wf,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),a=null;t.forEach((function(t,o){e(t,(function(t,e){t&&(a=t),i[o]=e,0==--n&&r(a,i)}))}))},t.bezier=h,t.bindAll=b,t.browser=z,t.cacheEntryPossiblyAdded=function(t){++_t>dt&&(t.getActor().send("enforceCacheSizeLimit",ft),_t=0)},t.clamp=d,t.clearTileCache=function(t){var e=o.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=Hh,t.clone=function(t){var e=new Xu(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=A,t.clone$2=function(t){var e=new Xu(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Vc,t.config=G,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.convertCoor=Zr,t.convertCoor_=function(t,e){if(e){var r=Array.isArray(t)?t:t.toArray();if("SZ2000"===e)return Kr(r);console.error("暂不支持此类型`projection`！")}else console.error("地图初始化需要`projection`参数！")},t.convertFeatureCoor=function(t,e){var r=e;if(t){var n=[];e.map((function(e){var r=JSON.parse(JSON.stringify(e));r.geometry.coordinates=function(t,e){var r=t.coordinates;switch(t.type){case"Point":return function(t,e){return Yr(t,e)}(r,e);case"MultiPoint":case"LineString":return function(t,e){for(var r=[],n=0;n<t.length;n++){var i=Yr(t[n],e);r.push(i)}return r}(r,e);case"MultiLineString":case"Polygon":return function(t,e){for(var r=[],n=0;n<t.length;n++){for(var i=[],a=t[n],o=0;o<a.length;o++){var s=Yr(a[o],e);i.push(s)}r.push(i)}return r}(r,e);case"MultiPolygon":return function(t,e){for(var r=[],n=0;n<t.length;n++){for(var i=[],a=t[n],o=0;o<a.length;o++){for(var s=[],u=a[o],l=0;l<u.length;l++){var c=Yr(u[l],e);s.push(c)}i.push(s)}r.push(i)}return r}(r,e)}}(e.geometry,t),n.push(r)})),r=n}return r},t.convertGeoCoor=function(t,e){if(!e)return t;if("SZ2000"===e){var r=[];return t.map((function(t){var e=Xr(t);r.push(e)})),r}console.error("暂不支持此类型`projection`！")},t.convertGeojson=Jr,t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.create=function(){var t=new Xu(16);return Xu!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=Ku,t.create$2=Qu,t.create$3=function(){var t=new Xu(4);return Xu!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Da,t.createLayout=ms,t.createStyleLayer=function(t){return"custom"===t.type?new Ef(t):new Tf[t.type](t)},t.cross=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t},t.deepEqual=function t(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var i in e)if(!t(e[i],r[i]))return!1;return!0}return e===r},t.degToRad=c,t.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=f,t.emitValidationErrors=xo,t.endsWith=x,t.enforceCacheSizeLimit=function(t){pt(),at&&at.then((function(e){e.keys().then((function(r){for(var n=0;n<r.length-t;n++)e.delete(r[n])}))}))},t.evaluateSizeForFeature=Dh,t.evaluateSizeForZoom=Bh,t.evaluateVariableOffset=nf,t.evented=$o,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.extend=m,t.featureFilter=Xa,t.filterObject=M,t.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,h=n*s,f=i*o,d=i*s,p=i*u,m=a*o,v=a*s,g=a*u;return t[0]=1-h-p,t[1]=c+g,t[2]=f-v,t[3]=0,t[4]=c-g,t[5]=1-l-p,t[6]=d+m,t[7]=0,t[8]=f+v,t[9]=d-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Ph,t.getAnchorJustification=af,t.getArrayBuffer=ln,t.getArrayBufferVectorTile=function(t,e){return function(t,e){if(!nn(t.url)){if(o.fetch&&o.Request&&o.AbortController&&o.Request.prototype.hasOwnProperty("signal"))return function(t,e){var r=new o.AbortController,n={},i=t.url.indexOf("?k=");i>-1&&(n=JSON.parse(t.url.substr(i+"?k=".length)||"{}"),t.url=t.url.substring(0,i));var a=new o.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:rn(),signal:r.signal}),s=!1,u=!1,l=Q(a.url),c=function(r,n,i){if(!u){if(r&&"SecurityError"!==r.message&&S(r),n&&i)return h(n);var s=Date.now();o.fetch(a).then((function(r){if(r.ok){var n=l?r.clone():null;return h(r,n,s)}return e(new en(r.statusText,r.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},h=function(t,r,i){t.arrayBuffer().then((function(o){var l;if(t.headers.get("x-encrypted")||n.k1){l="CFB"===t.headers.get("x-encrypt-mode")||n.k1&&n.k2?function(t,e){var r=Mt.encode(t),n=e&&e.k2?e.k2:"2Wjugf8N1AxPoxGbFXykLA==",i=wt.enc.Base64.parse(e&&e.k1&&e.k2?e.k1:"hPemwD44tChyLIhKQlwKwJ1i8GLiYQnO0smNZInwiZs="),a=wt.enc.Base64.parse(n),o=wt.AES.decrypt(r,i,{iv:a,mode:wt.mode.CFB,padding:wt.pad.NoPadding}),s=wt.enc.Base64.stringify(o);return Mt.decode(s)}(o,n):function(t,e){var r=Mt.encode(t),n=e&&e.k1?Et(e.k1):"RI8Ylehf5ZllGgkzyIA70A==",i=wt.enc.Base64.parse(n),a=wt.AES.decrypt(r,i,{mode:wt.mode.ECB,padding:wt.pad.Pkcs7}),o=wt.enc.Base64.stringify(a);return Mt.decode(o)}(o,n);var c=new Uint8Array(l)[0];if(c&&26!==c)return void console.log("error, please contact sipsd")}else l=o;u||(r&&i&&mt(a,r,i),s=!0,e(null,l,t.headers.get("Cache-Control"),t.headers.get("Expires")))})).catch((function(t){u||e(new Error(t.message))}))};return l?gt(a,c):c(null,null),{cancel:function(){u=!0,s||r.abort()}}}(t,e);if(O()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}return an(t,e)}(m(t,{type:"arrayBuffer"}),e)},t.getImage=fn,t.getJSON=function(t,e){return un(m(t,{type:"json"}),e)},t.getRTLTextPluginStatus=qo,t.getReferrer=rn,t.getVideo=function(t,e){var r,n,i=o.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var a=0;a<t.length;a++){var s=o.document.createElement("source");r=t[a],n=void 0,(n=o.document.createElement("a")).href=r,(n.protocol!==o.document.location.protocol||n.host!==o.document.location.host)&&(i.crossOrigin="Anonymous"),s.src=t[a],i.appendChild(s)}return{cancel:function(){}}},t.identity=Zu,t.identity$1=ul,t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=r*s-n*o,_=r*u-i*o,b=r*l-a*o,x=n*u-i*s,w=n*l-a*s,M=i*l-a*u,A=c*m-h*p,E=c*v-f*p,S=c*g-d*p,T=h*v-f*m,C=h*g-d*m,O=f*g-d*v,P=y*O-_*C+b*T+x*S-w*E+M*A;return P?(t[0]=(s*O-u*C+l*T)*(P=1/P),t[1]=(i*C-n*O-a*T)*P,t[2]=(m*M-v*w+g*x)*P,t[3]=(f*w-h*M-d*x)*P,t[4]=(u*S-o*O-l*E)*P,t[5]=(r*O-i*S+a*E)*P,t[6]=(v*b-p*M-g*_)*P,t[7]=(c*M-f*b+d*_)*P,t[8]=(o*C-s*S+l*A)*P,t[9]=(n*S-r*C-a*A)*P,t[10]=(p*w-m*b+g*y)*P,t[11]=(h*b-c*w-d*y)*P,t[12]=(s*E-o*T-u*A)*P,t[13]=(r*T-n*E+i*A)*P,t[14]=(m*_-p*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null},t.isChar=Ro,t.isMapboxURL=Z,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.len=al,t.length=tl,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.makeRequest=un,t.mapObject=w,t.mercatorXfromLng=zf,t.mercatorYfromLat=Gf,t.mercatorZfromAltitude=Vf,t.mul=Ju,t.mul$1=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},t.multiply=Yu,t.mvt=yc,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=rl,t.normalize$1=function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t},t.number=ki,t.offscreenCanvasSupported=bt,t.ortho=function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new Xc(t).readFields(fh,[])},t.pbf=Xc,t.performSymbolLayout=function(t,e,r,n,i,a,o){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Zo(c.minZoom),o),u["text-size"].possiblyEvaluate(new Zo(h),o)]}if("composite"===t.iconSizeData.kind){var f=t.iconSizeData,d=f.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Zo(f.minZoom),o),u["icon-size"].possiblyEvaluate(new Zo(d),o)]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new Zo(t.zoom+1),o),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new Zo(t.zoom+1),o),l.textMaxSize=u["text-size"].possiblyEvaluate(new Zo(18));for(var p=24*s.get("text-line-height"),m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),v=s.get("text-keep-upright"),g=s.get("text-size"),y=function(){var a=b[_],u=s.get("text-font").evaluate(a,{},o).join(","),c=g.evaluate(a,{},o),h=l.layoutTextSize.evaluate(a,{},o),f=l.layoutIconSize.evaluate(a,{},o),d={horizontal:{},vertical:void 0},y=a.text,x=[0,0];if(y){var w=y.toString(),M=24*s.get("text-letter-spacing").evaluate(a,{},o),A=function(t){for(var e=0,r=t;e<r.length;e+=1)if(n=r[e].charCodeAt(0),Ro.Arabic(n)||Ro["Arabic Supplement"](n)||Ro["Arabic Extended-A"](n)||Ro["Arabic Presentation Forms-A"](n)||Ro["Arabic Presentation Forms-B"](n))return!1;var n;return!0}(w)?M:0,E=s.get("text-anchor").evaluate(a,{},o),T=s.get("text-variable-anchor");if(!T){var C=s.get("text-radial-offset").evaluate(a,{},o);x=C?nf(E,[24*C,rf]):s.get("text-offset").evaluate(a,{},o).map((function(t){return 24*t}))}var O=m?"center":s.get("text-justify").evaluate(a,{},o),P=s.get("symbol-placement"),L="point"===P?24*s.get("text-max-width").evaluate(a,{},o):0,I=function(){t.allowVerticalPlacement&&Do(w)&&(d.vertical=wh(y,e,r,i,u,L,p,E,"left",A,x,_h.vertical,!0,P,h,c))};if(!m&&T){for(var k="auto"===O?T.map((function(t){return af(t)})):[O],R=!1,D=0;D<k.length;D++){var B=k[D];if(!d.horizontal[B])if(R)d.horizontal[B]=d.horizontal[0];else{var F=wh(y,e,r,i,u,L,p,"center",B,A,x,_h.horizontal,!1,P,h,c);F&&(d.horizontal[B]=F,R=1===F.positionedLines.length)}}I()}else{"auto"===O&&(O=af(E));var j=wh(y,e,r,i,u,L,p,E,O,A,x,_h.horizontal,!1,P,h,c);j&&(d.horizontal[O]=j),I(),Do(w)&&m&&v&&(d.vertical=wh(y,e,r,i,u,L,p,E,O,A,x,_h.vertical,!1,P,h,c))}}var N=void 0,U=!1;if(a.icon&&a.icon.name){var z=n[a.icon.name];z&&(N=function(t,e,r){var n=Ph(r),i=e[0]-t.displaySize[0]*n.horizontalAlign,a=e[1]-t.displaySize[1]*n.verticalAlign;return{image:t,top:a,bottom:a+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[a.icon.name],s.get("icon-offset").evaluate(a,{},o),s.get("icon-anchor").evaluate(a,{},o)),U=z.sdf,void 0===t.sdfIcons?t.sdfIcons=z.sdf:t.sdfIcons!==z.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(z.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var G=sf(d.horizontal)||d.vertical;t.iconsInText=!!G&&G.iconsInText,(G||N)&&function(t,e,r,n,i,a,o,s,u,l,c){var h=a.textMaxSize.evaluate(e,{});void 0===h&&(h=o);var f,d=t.layers[0].layout,p=d.get("icon-offset").evaluate(e,{},c),m=sf(r.horizontal),v=o/24,g=t.tilePixelRatio*v,y=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,b=t.tilePixelRatio*d.get("symbol-spacing"),x=d.get("text-padding")*t.tilePixelRatio,w=d.get("icon-padding")*t.tilePixelRatio,M=d.get("text-max-angle")/180*Math.PI,A="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),E="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),T=d.get("symbol-placement"),C=b/2,O=d.get("icon-text-fit");n&&"none"!==O&&(t.allowVerticalPlacement&&r.vertical&&(f=Ih(n,r.vertical,O,d.get("icon-text-fit-padding"),p,v)),m&&(n=Ih(n,m,O,d.get("icon-text-fit-padding"),p,v)));var P=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A){var E,T,C,O,P,L=t.addToLineVertexArray(e,r),I=0,k=0,R=0,D=0,B=-1,F=-1,j={},N=eu(""),U=0,z=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(U=(E=s.layout.get("text-offset").evaluate(b,{},M).map((function(t){return 24*t})))[0],z=E[1]):(U=24*s.layout.get("text-radial-offset").evaluate(b,{},M),z=rf),t.allowVerticalPlacement&&n.vertical){var G=s.layout.get("text-rotate").evaluate(b,{},M)+90;O=new Zh(u,e,l,c,h,n.vertical,f,d,p,G),o&&(P=new Zh(u,e,l,c,h,o,v,g,p,G))}if(i){var V=s.layout.get("icon-rotate").evaluate(b,{}),H="none"!==s.layout.get("icon-text-fit"),W=Wh(i,V,w,H),$=o?Wh(o,V,w,H):void 0;C=new Zh(u,e,l,c,h,i,v,g,!1,V),I=4*W.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[128*s.layout.get("icon-size").evaluate(b,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[128*x.compositeIconSizes[0].evaluate(b,{},M),128*x.compositeIconSizes[1].evaluate(b,{},M)])[0]>32640||X[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,W,X,_,y,b,!1,e,L.lineStartIndex,L.lineLength,-1,M),B=t.icon.placedSymbolArray.length-1,$&&(k=4*$.length,t.addSymbols(t.icon,$,X,_,y,b,_h.vertical,e,L.lineStartIndex,L.lineLength,-1,M),F=t.icon.placedSymbolArray.length-1)}for(var K in n.horizontal){var Z=n.horizontal[K];if(!T){N=eu(Z.text);var Y=s.layout.get("text-rotate").evaluate(b,{},M);T=new Zh(u,e,l,c,h,Z,f,d,p,Y)}var J=1===Z.positionedLines.length;if(R+=of(t,e,Z,a,s,p,b,m,L,n.vertical?_h.horizontal:_h.horizontalOnly,J?Object.keys(n.horizontal):[K],j,B,x,M),J)break}n.vertical&&(D+=of(t,e,n.vertical,a,s,p,b,m,L,_h.vertical,["vertical"],j,F,x,M));var Q=T?T.boxStartIndex:t.collisionBoxArray.length,tt=T?T.boxEndIndex:t.collisionBoxArray.length,et=O?O.boxStartIndex:t.collisionBoxArray.length,rt=O?O.boxEndIndex:t.collisionBoxArray.length,nt=C?C.boxStartIndex:t.collisionBoxArray.length,it=C?C.boxEndIndex:t.collisionBoxArray.length,at=P?P.boxStartIndex:t.collisionBoxArray.length,ot=P?P.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(T,st),st=ut(O,st),st=ut(C,st);var lt=(st=ut(P,st))>-1?1:0;lt&&(st*=A/24),t.glyphOffsetArray.length>=vf.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical||-1,B,F,N,Q,tt,et,rt,nt,it,at,ot,l,R,D,I,k,lt,0,f,U,z,st)}(t,h,s,r,n,i,f,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,g,x,A,u,_,w,E,p,e,a,l,c,o)};if("line"===T)for(var L=0,I=Hh(e.geometry,0,0,8192,8192);L<I.length;L+=1)for(var k=I[L],R=0,D=Vh(k,b,M,r.vertical||m,n,24,y,t.overscaling,8192);R<D.length;R+=1){var B=D[R];m&&uf(t,m.text,C,B)||P(k,B)}else if("line-center"===T)for(var F=0,j=e.geometry;F<j.length;F+=1){var N=j[F];if(N.length>1){var U=Gh(N,M,r.vertical||m,n,24,y);U&&P(N,U)}}else if("Polygon"===e.type)for(var z=0,G=ec(e.geometry,0);z<G.length;z+=1){var V=G[z],H=Qh(V,16);P(V[0],new kh(H.x,H.y,0))}else if("LineString"===e.type)for(var W=0,$=e.geometry;W<$.length;W+=1){var q=$[W];P(q,new kh(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var X=0,K=e.geometry;X<K.length;X+=1)for(var Z=0,Y=K[X];Z<Y.length;Z+=1){var J=Y[Z];P([J],new kh(J.x,J.y,0))}}(t,a,d,N,n,l,h,f,x,U,o)},_=0,b=t.features;_<b.length;_+=1)y();a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=Ko,t.polygonIntersectsPolygon=Iu,t.postMapLoadEvent=ht,t.postTurnstileEvent=lt,t.potpack=mh,t.radToDeg=function(t){return t*l},t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=To,t.registerForPluginStateChange=function(t){return t({pluginStatus:Go,pluginURL:Vo}),$o.on("pluginStateChange",t),t},t.renderColorRamp=_l,t.rotate=function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=n*-s+a*u,t[3]=i*-s+o*u,t},t.rotateX=ll,t.rotateX$1=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+c*n,t[6]=s*i+h*n,t[7]=u*i+f*n,t[8]=l*i-a*n,t[9]=c*i-o*n,t[10]=h*i-s*n,t[11]=f*i-u*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+c*n,t[2]=s*i+h*n,t[3]=u*i+f*n,t[4]=l*i-a*n,t[5]=c*i-o*n,t[6]=h*i-s*n,t[7]=f*i-u*n,t},t.rotateZ$1=function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},t.scale=function(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},t.scale$2=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},t.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},t.setCacheLimits=function(t,e){ft=t,dt=e},t.setRTLTextPlugin=function(t,e,r){if(void 0===r&&(r=!1),"deferred"===Go||"loading"===Go||"loaded"===Go)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vo=z.resolveURL(t),Go="deferred",zo=e,Wo(),r||Xo()},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.styleSpec=yn,t.sub=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},t.symbolSize=Fh,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t},t.transformMat4=ol,t.transformQuat=nl,t.translate=function(t,e,r){var n,i,a,o,s,u,l,c,h,f,d,p,m=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=n=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+s*v+h*g+e[12],t[13]=i*m+u*v+f*g+e[13],t[14]=a*m+l*v+d*g+e[14],t[15]=o*m+c*v+p*g+e[15]),t},t.triggerPluginCompletionEvent=Ho,t.uniqueId=g,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=yo,t.validateStyle=go,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=yc,t.version="2.4.1",t.warnOnce=S,t.webpSupported=V,t.window=o,t.wrap=p})),n(0,(function(t){function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",i=0,a=t;i<a.length;i+=1)n+=e(a[i])+",";return n+"]"}for(var o=Object.keys(t).sort(),s="{",u=0;u<o.length;u++)s+=JSON.stringify(o[u])+":"+e(t[o[u]])+",";return s+"}"}function r(r){for(var n="",i=0,a=t.refProperties;i<a.length;i+=1)n+="/"+e(r[a[i]]);return n}var n=function(t){this.keyCache={},t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(e,n){for(var i=this,a=0,o=e;a<o.length;a+=1){var s=o[a];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=n;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var f=0,d=function(t,e){for(var n={},i=0;i<t.length;i++){var a=e&&e[t[i].id]||r(t[i]);e&&(e[t[i].id]=a);var o=n[a];o||(o=n[a]=[]),o.push(t[i])}var s=[];for(var u in n)s.push(n[u]);return s}(t.values(this._layerConfigs),this.keyCache);f<d.length;f+=1){var p=d[f].map((function(t){return i._layers[t.id]})),m=p[0];if("none"!==m.visibility){var v=m.source||"",g=this.familiesBySource[v];g||(g=this.familiesBySource[v]={});var y=m.sourceLayer||"_geojsonTileLayer",_=g[y];_||(_=g[y]=[]),_.push(p)}}};var i=function(e){var r={},n=[];for(var i in e){var a=e[i],o=r[i]={};for(var s in a){var u=a[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};n.push(l),o[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(n),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var f in e){var d=e[f];for(var p in d){var m=d[+p];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var v=r[f][p].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:v.x+1,y:v.y+1},m.bitmap)}}}this.image=h,this.positions=r};t.register("GlyphAtlas",i);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function o(e,r,n){for(var i=new t.EvaluationParameters(r),a=0,o=e;a<o.length;a+=1)o[a].recalculate(i,n)}function s(e,r){var n=t.getArrayBufferVectorTile(e.request,(function(e,n,i,a){e?r(e):n&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(n)),rawData:n,cacheControl:i,expires:a})}));return function(){n.cancel(),r()}}a.prototype.parse=function(e,r,n,a,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID,this.promoteId);c.bucketLayerIDs=[];var h,f,d,p,m={},v={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},g=r.familiesBySource[this.source];for(var y in g){var _=e.layers[y];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var b=l.encode(y),x=[],w=0;w<_.length;w++){var M=_.feature(w),A=c.getId(M,y);x.push({feature:M,id:A,index:w,sourceLayerIndex:b})}for(var E=0,S=g[y];E<S.length;E+=1){var T=S[E],C=T[0];C.minzoom&&this.zoom<Math.floor(C.minzoom)||C.maxzoom&&this.zoom>=C.maxzoom||"none"!==C.visibility&&(o(T,this.zoom,n),(m[C.id]=C.createBucket({index:c.bucketLayerIDs.length,layers:T,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:b,sourceID:this.source})).populate(x,v,this.tileID.canonical),c.bucketLayerIDs.push(T.map((function(t){return t.id}))))}}}var O=t.mapObject(v.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(O).length?a.send("getGlyphs",{uid:this.uid,stacks:O},(function(t,e){h||(h=t,f=e,I.call(u))})):f={};var P=Object.keys(v.iconDependencies);P.length?a.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,d=e,I.call(u))})):d={};var L=Object.keys(v.patternDependencies);function I(){if(h)return s(h);if(f&&d&&p){var e=new i(f),r=new t.ImageAtlas(d,p);for(var a in m){var u=m[a];u instanceof t.SymbolBucket?(o(u.layers,this.zoom,n),t.performSymbolLayout(u,f,e.positions,d,r.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(o(u.layers,this.zoom,n),u.addFeatures(v,this.tileID.canonical,r.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter((function(t){return!t.isEmpty()})),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?e.positions:null})}}L.length?a.send("getImages",{icons:L,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,p=e,I.call(u))})):p={},I.call(this)};var u=function(t,e,r,n){this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=n||s,this.loading={},this.loaded={}};u.prototype.loadTile=function(e,r){var n=this,i=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new a(e);s.abort=this.loadVectorData(e,(function(e,a){if(delete n.loading[i],e||!a)return s.status="done",n.loaded[i]=s,r(e);var u=a.rawData,l={};a.expires&&(l.expires=a.expires),a.cacheControl&&(l.cacheControl=a.cacheControl);var c={};if(o){var h=o.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,n.layerIndex,n.availableImages,n.actor,(function(e,n){if(e||!n)return r(e);r(null,t.extend({rawTileData:u.slice(0)},n,l,c))})),n.loaded=n.loaded||{},n.loaded[i]=s}))},u.prototype.reloadTile=function(t,e){var r=this,n=this.loaded,i=t.uid,a=this;if(n&&n[i]){var o=n[i];o.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,n){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,r.availableImages,a.actor,i)),e(t,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},u.prototype.abortTile=function(t,e){var r=this.loading,n=t.uid;r&&r[n]&&r[n].abort&&(r[n].abort(),delete r[n]),e()},u.prototype.removeTile=function(t,e){var r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()};var l=t.window.ImageBitmap,c=function(){this.loaded={}};function h(t,e){if(0!==t.length){f(t[0],e);for(var r=1;r<t.length;r++)f(t[r],!e)}}function f(t,e){for(var r=0,n=0,i=t.length,a=i-1;n<i;a=n++)r+=(t[n][0]-t[a][0])*(t[a][1]+t[n][1]);r>=0!=!!e&&t.reverse()}c.prototype.loadTile=function(e,r){var n=e.uid,i=e.encoding,a=e.rawImageData,o=l&&a instanceof l?this.getImageData(a):a,s=new t.DEMData(n,o,i);this.loaded=this.loaded||{},this.loaded[n]=s,r(null,s)},c.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var r=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:r.width,height:r.height},r.data)},c.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,p=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};p.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,n=this._feature.geometry;r<n.length;r+=1){var i=n[r];e.push([new t.Point$1(i[0],i[1])])}return e}for(var a=[],o=0,s=this._feature.geometry;o<s.length;o+=1){for(var u=[],l=0,c=s[o];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}a.push(u)}return a},p.prototype.toGeoJSON=function(t,e,r){return d.call(this,t,e,r)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new p(this._features[t])};var v=t.vectorTile.VectorTileFeature,g=y;function y(t,e){this.options=e||{},this.features=t,this.length=t.length}function _(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}y.prototype.feature=function(t){return new _(this.features[t],this.options.extent)},_.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],i=[],a=0;a<n.length;a++)i.push(new t.Point$1(n[a][0],n[a][1]));this.geometry.push(i)}return this.geometry},_.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var u=o[s];e=Math.min(e,u.x),r=Math.max(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.y)}return[e,n,r,i]},_.prototype.toGeoJSON=v.prototype.toGeoJSON;var b=w,x=g;function w(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,M,t.layers[r])}(e,r),r.finish()}function M(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,A,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var a=n.values;for(r=0;r<a.length;r++)e.writeMessage(4,O,a[r])}function A(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,E,t),e.writeVarintField(3,r.type),e.writeMessage(4,C,r)}function E(t,e){var r=t.feature,n=t.keys,i=t.values,a=t.keycache,o=t.valuecache;for(var s in r.properties){var u=a[s];void 0===u&&(n.push(s),a[s]=u=n.length-1),e.writeVarint(u);var l=r.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,f=o[h];void 0===f&&(i.push(l),o[h]=f=i.length-1),e.writeVarint(f)}}function S(t,e){return(e<<3)+(7&t)}function T(t){return t<<1^t>>31}function C(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,a=0,o=r.length,s=0;s<o;s++){var u=r[s],l=1;1===n&&(l=u.length),e.writeVarint(S(1,l));for(var c=3===n?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==n&&e.writeVarint(S(2,c-1));var f=u[h].x-i,d=u[h].y-a;e.writeVarint(T(f)),e.writeVarint(T(d)),i+=f,a+=d}3===n&&e.writeVarint(S(7,1))}}function O(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function P(t,e,r,n){L(t,r,n),L(e,2*r,2*n),L(e,2*r+1,2*n+1)}function L(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function I(t,e,r,n){var i=t-r,a=e-n;return i*i+a*a}b.fromVectorTileJs=w,b.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new g(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return w({layers:r})},b.GeoJSONWrapper=x;var k=function(t){return t[0]},R=function(t){return t[1]},D=function(t,e,r,n,i){void 0===e&&(e=k),void 0===r&&(r=R),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)o[u]=u,s[2*u]=e(t[u]),s[2*u+1]=r(t[u]);!function t(e,r,n,i,a,o){if(!(a-i<=n)){var s=i+a>>1;!function t(e,r,n,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,r,n,Math.max(i,Math.floor(n-u*c/s+h)),Math.min(a,Math.floor(n+(s-u)*c/s+h)),o)}var f=r[2*n+o],d=i,p=a;for(P(e,r,i,n),r[2*a+o]>f&&P(e,r,i,a);d<p;){for(P(e,r,d,p),d++,p--;r[2*d+o]<f;)d++;for(;r[2*p+o]>f;)p--}r[2*i+o]===f?P(e,r,i,p):P(e,r,++p,a),p<=n&&(i=p+1),n<=p&&(a=p-1)}}(e,r,s,i,a,o%2),t(e,r,n,i,s-1,o+1),t(e,r,n,s+1,a,o+1)}}(o,s,n,0,o.length-1,0)};D.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,a,o){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),d=l.pop();if(f-d<=o)for(var p=d;p<=f;p++)u=e[2*p+1],(s=e[2*p])>=r&&s<=i&&u>=n&&u<=a&&c.push(t[p]);else{var m=Math.floor((d+f)/2);u=e[2*m+1],(s=e[2*m])>=r&&s<=i&&u>=n&&u<=a&&c.push(t[m]);var v=(h+1)%2;(0===h?r<=s:n<=u)&&(l.push(d),l.push(m-1),l.push(v)),(0===h?i>=s:a>=u)&&(l.push(m+1),l.push(f),l.push(v))}}return c}(this.ids,this.coords,t,e,r,n,this.nodeSize)},D.prototype.within=function(t,e,r){return function(t,e,r,n,i,a){for(var o=[0,t.length-1,0],s=[],u=i*i;o.length;){var l=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var f=h;f<=c;f++)I(e[2*f],e[2*f+1],r,n)<=u&&s.push(t[f]);else{var d=Math.floor((h+c)/2),p=e[2*d],m=e[2*d+1];I(p,m,r,n)<=u&&s.push(t[d]);var v=(l+1)%2;(0===l?r-i<=p:n-i<=m)&&(o.push(h),o.push(d-1),o.push(v)),(0===l?r+i>=p:n+i>=m)&&(o.push(d+1),o.push(c),o.push(v))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=H(Object.create(B),t),this.trees=new Array(this.options.maxZoom+1)};function j(t,e,r,n,i){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function N(t,e){var r=t.geometry.coordinates,n=r[1];return{x:G(r[0]),y:V(n),zoom:1/0,index:e,parentId:-1}}function U(t){return{type:"Feature",id:t.id,properties:z(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,n}function z(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function G(t){return t/360+.5}function V(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function H(t,e){for(var r in e)t[r]=e[r];return t}function W(t){return t.x}function $(t){return t.y}function q(t,e,r,n,i,a){var o=i-r,s=a-n;if(0!==o||0!==s){var u=((t-r)*o+(e-n)*s)/(o*o+s*s);u>1?(r=i,n=a):u>0&&(r+=o*u,n+=s*u)}return(o=t-r)*o+(s=e-n)*s}function X(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)K(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)K(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)K(t,e[n][i])}(i),i}function K(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function Z(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,a=e.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=e.id;if(r.promoteId?u=e.properties[r.promoteId]:r.generateId&&(u=n||0),"Point"===a)Y(i,s);else if("MultiPoint"===a)for(var l=0;l<i.length;l++)Y(i[l],s);else if("LineString"===a)J(i,s,o,!1);else if("MultiLineString"===a){if(r.lineMetrics){for(l=0;l<i.length;l++)J(i[l],s=[],o,!1),t.push(X(u,"LineString",s,e.properties));return}Q(i,s,o,!1)}else if("Polygon"===a)Q(i,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<e.geometry.geometries.length;l++)Z(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];Q(i[l],c,o,!0),s.push(c)}}t.push(X(u,a,s,e.properties))}}function Y(t,e){e.push(tt(t[0])),e.push(et(t[1])),e.push(0)}function J(t,e,r,n){for(var i,a,o=0,s=0;s<t.length;s++){var u=tt(t[s][0]),l=et(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(o+=n?(i*l-u*a)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-a,2))),i=u,a=l}var c=e.length-3;e[2]=1,function t(e,r,n,i){for(var a,o=i,s=n-r>>1,u=n-r,l=e[r],c=e[r+1],h=e[n],f=e[n+1],d=r+3;d<n;d+=3){var p=q(e[d],e[d+1],l,c,h,f);if(p>o)a=d,o=p;else if(p===o){var m=Math.abs(d-s);m<u&&(a=d,u=m)}}o>i&&(a-r>3&&t(e,r,a,i),e[a+2]=o,n-a>3&&t(e,a,n,i))}(e,0,c,r),e[c+2]=1,e.size=Math.abs(o),e.start=0,e.end=e.size}function Q(t,e,r,n){for(var i=0;i<t.length;i++){var a=[];J(t[i],a,r,n),e.push(a)}}function tt(t){return t/360+.5}function et(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function rt(t,e,r,n,i,a,o,s){if(n/=e,a>=(r/=e)&&o<n)return t;if(o<r||a>=n)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,f=c.type,d=0===i?c.minX:c.minY,p=0===i?c.maxX:c.maxY;if(d>=r&&p<n)u.push(c);else if(!(p<r||d>=n)){var m=[];if("Point"===f||"MultiPoint"===f)nt(h,m,r,n,i);else if("LineString"===f)it(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===f)ot(h,m,r,n,i,!1);else if("Polygon"===f)ot(h,m,r,n,i,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var g=[];ot(h[v],g,r,n,i,!0),g.length&&m.push(g)}if(m.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<m.length;v++)u.push(X(c.id,f,m[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===m.length?(f="LineString",m=m[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===m.length?"Point":"MultiPoint"),u.push(X(c.id,f,m,c.tags))}}}return u.length?u:null}function nt(t,e,r,n,i){for(var a=0;a<t.length;a+=3){var o=t[a+i];o>=r&&o<=n&&(e.push(t[a]),e.push(t[a+1]),e.push(t[a+2]))}}function it(t,e,r,n,i,a,o){for(var s,u,l=at(t),c=0===i?ut:lt,h=t.start,f=0;f<t.length-3;f+=3){var d=t[f],p=t[f+1],m=t[f+2],v=t[f+3],g=t[f+4],y=0===i?d:p,_=0===i?v:g,b=!1;o&&(s=Math.sqrt(Math.pow(d-v,2)+Math.pow(p-g,2))),y<r?_>r&&(u=c(l,d,p,v,g,r),o&&(l.start=h+s*u)):y>n?_<n&&(u=c(l,d,p,v,g,n),o&&(l.start=h+s*u)):st(l,d,p,m),_<r&&y>=r&&(u=c(l,d,p,v,g,r),b=!0),_>n&&y<=n&&(u=c(l,d,p,v,g,n),b=!0),!a&&b&&(o&&(l.end=h+s*u),e.push(l),l=at(t)),o&&(h+=s)}var x=t.length-3;d=t[x],p=t[x+1],m=t[x+2],(y=0===i?d:p)>=r&&y<=n&&st(l,d,p,m),x=l.length-3,a&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&st(l,l[0],l[1],l[2]),l.length&&e.push(l)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function ot(t,e,r,n,i,a){for(var o=0;o<t.length;o++)it(t[o],e,r,n,i,a,!1)}function st(t,e,r,n){t.push(e),t.push(r),t.push(n)}function ut(t,e,r,n,i,a){var o=(a-e)/(n-e);return t.push(a),t.push(r+(i-r)*o),t.push(1),o}function lt(t,e,r,n,i,a){var o=(a-r)/(i-r);return t.push(e+(n-e)*o),t.push(a),t.push(1),o}function ct(t,e){for(var r=[],n=0;n<t.length;n++){var i,a=t[n],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)i=ht(a.geometry,e);else if("MultiLineString"===o||"Polygon"===o){i=[];for(var s=0;s<a.geometry.length;s++)i.push(ht(a.geometry[s],e))}else if("MultiPolygon"===o)for(i=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(ht(a.geometry[s][l],e));i.push(u)}r.push(X(a.id,o,i,a.tags))}return r}function ht(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function ft(t,e){if(t.transformed)return t;var r,n,i,a=1<<t.z,o=t.x,s=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(n=0;n<l.length;n+=2)u.geometry.push(dt(l[n],l[n+1],e,a,o,s));else for(n=0;n<l.length;n++){var h=[];for(i=0;i<l[n].length;i+=2)h.push(dt(l[n][i],l[n][i+1],e,a,o,s));u.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,r,n,i,a){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-a))]}function pt(t,e,r,n,i){for(var a=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){o.numFeatures++,mt(o,t[s],a,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function mt(t,e,r,n){var i=e.geometry,a=e.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===a)vt(o,i,t,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<i.length;s++)vt(o,i[s],t,r,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)vt(o,l[s],t,r,!0,0===s)}if(o.length){var c=e.tags||null;if("LineString"===a&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==e.id&&(f.id=e.id),t.features.push(f)}}function vt(t,e,r,n,i,a){var o=n*n;if(n>0&&e.size<(i?o:n))r.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===n||e[u+2]>o)&&(r.numSimplified++,s.push(e[u]),s.push(e[u+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,a=i-2;n<i;a=n,n+=2)r+=(t[n]-t[a])*(t[n+1]+t[a+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var o=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=o,t[i-1-n]=s}}(s,a),t.push(s)}}function gt(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Z(r,t.features[n],e,n);else Z(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=rt(t,1,-1-r,r,0,-1,2,e),a=rt(t,1,1-r,2+r,0,-1,2,e);return(i||a)&&(n=rt(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=ct(i,1).concat(n)),a&&(n=n.concat(ct(a,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yt(t,e,r){return 32*((1<<t)*r+e)+t}function _t(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);var i=new m(n.features),a=b(i);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:i,rawData:a.buffer})}F.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,a=e.nodeSize;r&&console.time("total time");var o="prepare "+t.length+" points";r&&console.time(o),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(N(t[u],u));this.trees[i+1]=new D(s,W,$,a,Float32Array),r&&console.timeEnd(o);for(var l=i;l>=n;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new D(s,W,$,a,Float32Array),r&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this},F.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var o=this.getClusters([r,n,180,a],e),s=this.getClusters([-180,n,i,a],e);return o.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(G(r),V(a),G(i),V(n));c<h.length;c+=1){var f=u.points[h[c]];l.push(f.numPoints?U(f):this.points[f.index])}return l},F.prototype.getChildren=function(t){var e=this._getOriginId(t),r=this._getOriginZoom(t),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var a=i.points[e];if(!a)throw new Error(n);for(var o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],u=0,l=i.within(a.x,a.y,o);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?U(c):this.points[c.index])}if(0===s.length)throw new Error(n);return s},F.prototype.getLeaves=function(t,e,r){var n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n},F.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),a=this.options,o=a.radius/a.extent,s=(r-o)/i,u=(r+1+o)/i,l={features:[]};return this._addTileFeatures(n.range((e-o)/i,s,(e+1+o)/i,u),n.points,e,r,i,l),0===e&&this._addTileFeatures(n.range(1-o/i,s,1,u),n.points,i,r,i,l),e===i-1&&this._addTileFeatures(n.range(0,s,o/i,u),n.points,-1,r,i,l),l.features.length?l:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,r,n,i){for(var a=0,o=this.getChildren(e);a<o.length;a+=1){var s=o[a],u=s.properties;if(u&&u.cluster?i+u.point_count<=n?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},F.prototype._addTileFeatures=function(t,e,r,n,i,a){for(var o=0,s=t;o<s.length;o+=1){var u=e[s[o]],l=u.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-r)),Math.round(this.options.extent*(u.y*i-n))]],tags:l?z(u):this.points[u.index].properties},h=void 0;l?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(c.id=h),a.features.push(c)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.reduce,a=n.minPoints,o=n.radius/(n.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var l=this.trees[e+1],c=l.within(u.x,u.y,o),h=u.numPoints||1,f=h,d=0,p=c;d<p.length;d+=1){var m=l.points[p[d]];m.zoom>e&&(f+=m.numPoints||1)}if(f>=a){for(var v=u.x*h,g=u.y*h,y=i&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,b=0,x=c;b<x.length;b+=1){var w=l.points[x[b]];if(!(w.zoom<=e)){w.zoom=e;var M=w.numPoints||1;v+=w.x*M,g+=w.y*M,w.parentId=_,i&&(y||(y=this._map(u,!0)),i(y,this._map(w)))}}u.parentId=_,r.push(j(v/f,g/f,_,f,y))}else if(r.push(u),f>1)for(var A=0,E=c;A<E.length;A+=1){var S=l.points[E[A]];S.zoom<=e||(S.zoom=e,r.push(S))}}}return r},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?H({},n):n},gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},gt.prototype.splitTile=function(t,e,r,n,i,a,o){for(var s=[t,e,r,n],u=this.options,l=u.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=yt(e,r,n),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=pt(t,e,r,n,u),this.tileCoords.push({z:e,x:r,y:n}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+e;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=t,i){if(e===u.maxZoom||e===i)continue;var p=1<<i-e;if(r!==Math.floor(a/p)||n!==Math.floor(o/p))continue}else if(e===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==t.length){l>1&&console.time("clipping");var m,v,g,y,_,b,x=.5*u.buffer/u.extent,w=.5-x,M=.5+x,A=1+x;m=v=g=y=null,_=rt(t,c,r-x,r+M,0,f.minX,f.maxX,u),b=rt(t,c,r+w,r+A,0,f.minX,f.maxX,u),t=null,_&&(m=rt(_,c,n-x,n+M,1,f.minY,f.maxY,u),v=rt(_,c,n+w,n+A,1,f.minY,f.maxY,u),_=null),b&&(g=rt(b,c,n-x,n+M,1,f.minY,f.maxY,u),y=rt(b,c,n+w,n+A,1,f.minY,f.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(v||[],e+1,2*r,2*n+1),s.push(g||[],e+1,2*r+1,2*n),s.push(y||[],e+1,2*r+1,2*n+1)}}},gt.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,a=n.debug;if(t<0||t>24)return null;var o=1<<t,s=yt(t,e=(e%o+o)%o,r);if(this.tiles[s])return ft(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var u,l=t,c=e,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[yt(l,c,h)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,h),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,r),a>1&&console.timeEnd("drilling down"),this.tiles[s]?ft(this.tiles[s],i):null):null};var bt=function(e){function r(t,r,n,i){e.call(this,t,r,n,_t),i&&(this.loadGeoJSON=i)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(n&&n.request&&n.request.collectResourceTiming)&&new t.RequestPerformance(n.request);this.loadGeoJSON(n,(function(a,o){if(a||!o)return r(a);if("object"!=typeof o)return r(new Error("Input data given to '"+n.source+"' is not a valid GeoJSON object."));!function t(e,r){var n,i=e&&e.type;if("FeatureCollection"===i)for(n=0;n<e.features.length;n++)t(e.features[n],r);else if("GeometryCollection"===i)for(n=0;n<e.geometries.length;n++)t(e.geometries[n],r);else if("Feature"===i)t(e.geometry,r);else if("Polygon"===i)h(e.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<e.coordinates.length;n++)h(e.coordinates[n],r);return e}(o,!0);try{if(n.filter){var s=t.createExpression(n.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(t){return t.key+": "+t.message})).join(", "));var u=o.features.filter((function(t){return s.value.evaluate({zoom:0},t)}));o={type:"FeatureCollection",features:u}}e._geoJSONIndex=n.cluster?new F(function(e){var r=e.superclusterOptions,n=e.clusterProperties;if(!n||!r)return r;for(var i={},a={},o={accumulated:null,zoom:0},s={properties:null},u=Object.keys(n),l=0,c=u;l<c.length;l+=1){var h=c[l],f=n[h],d=f[0],p=t.createExpression(f[1]),m=t.createExpression("string"==typeof d?[d,["accumulated"],["get",h]]:d);i[h]=p.value,a[h]=m.value}return r.map=function(t){s.properties=t;for(var e={},r=0,n=u;r<n.length;r+=1){var a=n[r];e[a]=i[a].evaluate(o,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,n=u;r<n.length;r+=1){var i=n[r];o.accumulated=t[i],t[i]=a[i].evaluate(o,s)}},r}(n)).load(o.features):function(t,e){return new gt(t,e)}(o,n.geojsonVtOptions)}catch(a){return r(a)}e.loaded={};var l={};if(i){var c=i.finish();c&&(l.resourceTiming={},l.resourceTiming[n.source]=JSON.parse(JSON.stringify(c)))}r(null,l)}))}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var n=this.loaded;return n&&n[t.uid]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},r.prototype.getClusterChildren=function(e,r){try{r(null,t.convertFeatureCoor(e.projection,this._geoJSONIndex.getChildren(e.clusterId)))}catch(t){r(t)}},r.prototype.getClusterLeaves=function(e,r){try{r(null,t.convertFeatureCoor(e.projection,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)))}catch(t){r(t)}},r}(u),xt=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:u,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return xt.prototype.setReferrer=function(t,e){this.referrer=e},xt.prototype.setImages=function(t,e,r){for(var n in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][n];for(var a in i)i[a].availableImages=e}r()},xt.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},xt.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},xt.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},xt.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},xt.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},xt.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},xt.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},xt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},xt.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}},xt.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},xt.prototype.syncRTLPluginState=function(e,r,n){try{t.plugin.setState(r);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var a=t.plugin.isParsed();n(a?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),a)}}catch(t){n(t.toString())}},xt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},xt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e},xt.prototype.getWorkerSource=function(t,e,r){var n=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r]||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:function(e,r,i){n.actor.send(e,r,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][r]},xt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new c),this.demWorkerSources[t][e]},xt.prototype.enforceCacheSizeLimit=function(e,r){t.enforceCacheSizeLimit(r)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new xt(self)),xt})),n(0,(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!r(t)}function r(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var r=e.getImageData(0,0,1,1);return r&&r.width===t.width}()?(void 0===n[r=t&&t.failIfMajorPerformanceCaveat]&&(n[r]=function(t){var r=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.probablySupportsContext?r.probablySupportsContext("webgl",n)||r.probablySupportsContext("experimental-webgl",n):r.supportsContext?r.supportsContext("webgl",n)||r.supportsContext("experimental-webgl",n):r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}(t);if(!r)return!1;var n=r.createShader(r.VERTEX_SHADER);return!(!n||r.isContextLost())&&(r.shaderSource(n,"void main() {}"),r.compileShader(n),!0===r.getShaderParameter(n,r.COMPILE_STATUS))}(r)),n[r]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var r}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=r);var n={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),r={create:function(e,r,n){var i=t.window.document.createElement(e);return void 0!==r&&(i.className=r),n&&n.appendChild(i),i},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},n=t.window.document&&t.window.document.documentElement.style;function i(t){if(!n)return t[0];for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var a,o=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){n&&o&&(a=n[o],n[o]="none")},r.enableDrag=function(){n&&o&&(n[o]=a)};var s=i(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}r.addEventListener=function(t,e,r,n){void 0===n&&(n={}),t.addEventListener(e,r,"passive"in n&&u?n:n.capture)},r.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),t.removeEventListener(e,r,"passive"in n&&u?n:n.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",c,!0)}),0)},r.mousePos=function(e,r){var n=e.getBoundingClientRect();return new t.Point(r.clientX-n.left-e.clientLeft,r.clientY-n.top-e.clientTop)},r.touchPos=function(e,r){for(var n=e.getBoundingClientRect(),i=[],a=0;a<r.length;a++)i.push(new t.Point(r[a].clientX-n.left-e.clientLeft,r[a].clientY-n.top-e.clientTop));return i},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var f=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var n=r[e];this._notify(n.ids,n.callback)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},r.prototype._validate=function(e,r){var n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),n=!1),this._validateContent(r.content,r)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),n=!1),n},r.prototype._validateStretch=function(t,e){if(!t)return!0;for(var r=0,n=0,i=t;n<i.length;n+=1){var a=i[n];if(a[0]<r||a[1]<a[0]||e<a[1])return!1;r=a[1]}return!0},r.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},r.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var n=0,i=t;n<i.length;n+=1)this.images[i[n]]||(r=!1);this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var n={},i=0,a=e;i<a.length;i+=1){var o=a[i];this.images[o]||this.fire(new t.Event("styleimagemissing",{id:o}));var s=this.images[o];s?n[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+o+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,n)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],n=this.getImage(e);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{var i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},a=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:a}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var n=t.potpack(e),i=n.w,a=n.h,o=this.atlasImage;for(var s in o.resize({width:i||1,height:a||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,f=h.width,d=h.height;t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c},{width:f,height:d}),t.RGBAImage.copy(h,o,{x:0,y:d-1},{x:l,y:c-1},{width:f,height:1}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l,y:c+d},{width:f,height:1}),t.RGBAImage.copy(h,o,{x:f-1,y:0},{x:l-1,y:c},{width:1,height:d}),t.RGBAImage.copy(h,o,{x:0,y:0},{x:l+f,y:c},{width:1,height:d})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var i=this.images[n];h(i)&&this.updateImage(n,i)}}},r}(t.Evented),d=v,p=v,m=1e20;function v(t,e,r,n,i,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=a||"normal",this.radius=r||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function g(t,e,r,n,i,a,o){for(var s=0;s<e;s++){for(var u=0;u<r;u++)n[u]=t[u*e+s];for(y(n,i,a,o,r),u=0;u<r;u++)t[u*e+s]=i[u]}for(u=0;u<r;u++){for(s=0;s<e;s++)n[s]=t[u*e+s];for(y(n,i,a,o,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function y(t,e,r,n,i){r[0]=0,n[0]=-m,n[1]=+m;for(var a=1,o=0;a<i;a++){for(var s=(t[a]+a*a-(t[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);s<=n[o];)o--,s=(t[a]+a*a-(t[r[o]]+r[o]*r[o]))/(2*a-2*r[o]);r[++o]=a,n[o]=s,n[o+1]=+m}for(a=0,o=0;a<i;a++){for(;n[o+1]<a;)o++;e[a]=(a-r[o])*(a-r[o])+t[r[o]]}}v.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var i=e.data[4*n+3]/255;this.gridOuter[n]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[n]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(g(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),g(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++)r[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))));return r},d.default=p;var _=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};_.prototype.setURL=function(t){this.url=t},_.prototype.getGlyphs=function(e,r){var n=this,i=[];for(var a in e)for(var o=0,s=e[a];o<s.length;o+=1)i.push({stack:a,id:s[o]});t.asyncAll(i,(function(t,e){var r=t.stack,i=t.id,a=n.entries[r];a||(a=n.entries[r]={glyphs:{},requests:{},ranges:{}});var o=a.glyphs[i];if(void 0===o){if(o=n._tinySDF(a,r,i))return a.glyphs[i]=o,void e(null,{stack:r,id:i,glyph:o});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(a.ranges[s])e(null,{stack:r,id:i,glyph:o});else{var u=a.requests[s];u||(u=a.requests[s]=[],_.loadGlyphRange(r,s,n.url,n.requestManager,(function(t,e){if(e){for(var r in e)n._doesCharSupportLocalGlyph(+r)||(a.glyphs[+r]=e[+r]);a.ranges[s]=!0}for(var i=0,o=u;i<o.length;i+=1)(0,o[i])(t,e);delete a.requests[s]}))),u.push((function(t,n){t?e(t):n&&e(null,{stack:r,id:i,glyph:n[i]||null})}))}}else e(null,{stack:r,id:i,glyph:o})}),(function(t,e){if(t)r(t);else if(e){for(var n={},i=0,a=e;i<a.length;i+=1){var o=a[i],s=o.stack,u=o.id,l=o.glyph;(n[s]||(n[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}r(null,n)}}))},_.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},_.prototype._tinySDF=function(e,r,n){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(n)){var a=e.tinySDF;if(!a){var o="400";/bold/i.test(r)?o="900":/medium/i.test(r)?o="500":/light/i.test(r)&&(o="200"),a=e.tinySDF=new _.TinySDF(24,3,8,.25,i,o)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},a.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_.loadGlyphRange=function(e,r,n,i,a){var o=256*r,s=o+255,u=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",o+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,r){if(e)a(e);else if(r){for(var n={},i=0,o=t.parseGlyphPBF(r);i<o.length;i+=1){var s=o[i];n[s.id]=s}a(null,n)}}))},_.TinySDF=d;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},b.prototype.interpolate=function(e,r,n){return{x:t.number(e.x,r.x,n),y:t.number(e.y,r.y,n),z:t.number(e.z,r.z,n)}};var x=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(x),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var n in e){var i=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),i):this._transitionable.setValue(n,i)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),M=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};M.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.dashEntry[r]||(this.dashEntry[r]=this.addDash(t,e)),this.dashEntry[r]},M.prototype.getDashRanges=function(t,e,r){var n=[],i=t.length%2==1?-t[t.length-1]*r:0,a=t[0]*r,o=!0;n.push({left:i,right:a,isDash:o,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var l=t[u];n.push({left:i=s*r,right:a=(s+=l)*r,isDash:o=!o,zeroLength:0===l})}return n},M.prototype.addRoundDash=function(t,e,r){for(var n=e/2,i=-r;i<=r;i++)for(var a=this.width*(this.nextRow+r+i),o=0,s=t[o],u=0;u<this.width;u++){u/s.right>1&&(s=t[++o]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),f=void 0,d=i/r*(n+1);if(s.isDash){var p=n-Math.abs(d);f=Math.sqrt(h*h+p*p)}else f=n-Math.sqrt(h*h+d*d);this.data[a+u]=Math.max(0,Math.min(255,f+128))}},M.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var r=t[e],n=t[e+1];r.zeroLength?t.splice(e,1):n&&n.isDash===r.isDash&&(n.left=r.left,t.splice(e,1))}var i=t[0],a=t[t.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);for(var o=this.width*this.nextRow,s=0,u=t[s],l=0;l<this.width;l++){l/u.right>1&&(u=t[++s]);var c=Math.abs(l-u.left),h=Math.abs(l-u.right),f=Math.min(c,h);this.data[o+l]=Math.max(0,Math.min(255,(u.isDash?f:-f)+128))}},M.prototype.addDash=function(e,r){var n=r?7:0,i=2*n+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var a=0,o=0;o<e.length;o++)a+=e[o];if(0!==a){var s=this.width/a,u=this.getDashRanges(e,this.width,s);r?this.addRoundDash(u,s,n):this.addRegularDash(u)}var l={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:a};return this.nextRow+=i,this.dirty=!0,l},M.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var A=function e(r,n){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),a=0;a<i.length;a++){var o=new e.Actor(i[a],n,this.id);o.name="Worker "+a,this.actors.push(o)}};function E(e,r,n){var i=function(i,a){if(i)return n(i);if(a){var o=t.pick(t.extend(a,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(t){return t.id}))),o.tiles=o.tiles.map((function(t){return t+"?k="+r._x()})),o.tiles=r.canonicalizeTileset(o,e.url),n(null,o)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}A.prototype.broadcast=function(e,r,n){t.asyncAll(this.actors,(function(t,n){t.send(e,r,n)}),n=n||function(){})},A.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},A.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},A.Actor=t.Actor;var S=function(e,r,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=n||24};S.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},S.prototype.contains=function(e){var r=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),a=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),o=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=n&&e.x<a&&e.y>=i&&e.y<o};var T=function(e){function r(r,n,i,a){if(e.call(this),this.id=r,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,(function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new S(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},r.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},r.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function a(n,i){return delete e.request,e.aborted?r(null):n&&404!==n.status?r(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",i,a.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,a.bind(this)))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),C=function(e){function r(r,n,i,a){e.call(this),this.id=r,this.dispatcher=i,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=E(this._options,this.map._requestManager,(function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new S(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var n=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,a){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(a){n.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=n.map.painter.context,s=o.gl;e.texture=n.map.painter.getTileTexture(a.width),e.texture?e.texture.update(a,{useMipmap:!0}):(e.texture=new t.Texture(o,a,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(n.dispatcher),r(null)}}))},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),O=function(e){function r(r,n,i,a){e.call(this,r,n,i,a),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,a){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(a){this.map._refreshExpiredTiles&&e.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=t.window.ImageBitmap&&a instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?a:t.browser.getImageData(a,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,a=0===r.x?e.wrap-1:e.wrap,o=(r.x+1+n)%n,s=r.x+1===n?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,a,r.z,i,r.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y).key]={backfilled:!1},r.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,a,r.z,i,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y-1).key]={backfilled:!1}),r.y+1<n&&(u[new t.OverscaledTileID(e.overscaledZ,a,r.z,i,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,o,r.y+1).key]={backfilled:!1}),u},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},r}(C),P={_projection:void 0,set projection(t){this._projection=t},get projection(){return this._projection}},L=function(e){function r(r,n,i,a){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(a),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;var o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(n.clusterRadius||50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(r){if(r)e.fire(new t.ErrorEvent(r));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}}))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)r.fire(new t.ErrorEvent(e));else{var n={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(n.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",n))}})),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},r.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,projection:P.projection},e),this},r.prototype.getClusterLeaves=function(t,e,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r,projection:P.projection},n),this},r.prototype._updateWorkerData=function(e){var r=this;this._loaded=!1;var n=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming,P.projection&&(n.request.projection=P.projection,n.request.customType="geojson.loadData")):n.data=JSON.stringify(t.convertGeojson(i,P.projection)),this.actor.send(this.type+".loadData",n,(function(t,i){r._removed||i&&i.abandoned||(r._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[r.id]&&(r._resourceTiming=i.resourceTiming[r.id].slice(0)),r.actor.send(r.type+".coalesce",{source:n.source},null),e(t))}))},r.prototype.loaded=function(){return this._loaded},r.prototype.loadTile=function(e,r){var n=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,a){return delete e.request,e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(a,n.map.painter,"reloadTile"===i),r(null))}))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},r.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),I=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),k=function(e){function r(t,r,n,i){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(e,r){var n=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,a){n._loaded=!0,i?n.fire(new t.ErrorEvent(i)):a&&(n.image=a,e&&(n.coordinates=e),r&&r(),n._finishLoading())}))},r.prototype.loaded=function(){return this._loaded},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=t.convertGeoCoor(e,P.projection);var n=this.coordinates.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,n=1/0,i=-1/0,a=-1/0,o=0,s=e;o<s.length;o+=1){var u=s[o];r=Math.min(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.x),a=Math.max(a,u.y)}var l=Math.max(i-r,a-n),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((r+i)/2*h),Math.floor((n+a)/2*h))}(n),this.minzoom=this.maxzoom=this.tileID.z;var i=n.map((function(t){return r.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),R=function(e){function r(t,r,n,i){e.call(this,t,r,n,i),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1;var r=this.options;this.urls=[];for(var n=0,i=r.urls;n<i.length;n+=1)this.urls.push(this.map._requestManager.transformRequest(i[n],t.ResourceType.Source).url);t.getVideo(this.urls,(function(r,n){e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(e.video=n,e.video.loop=!0,e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},r.prototype.pause=function(){this.video&&this.video.pause()},r.prototype.play=function(){this.video&&this.video.play()},r.prototype.seek=function(e){if(this.video){var r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+r.start(0)+" and "+r.end(0)+"-second mark."))):this.video.currentTime=e}},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(k),D=function(e){function r(r,n,i,a){e.call(this,r,n,i,a),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,n=r.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,I.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,n.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[i];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(k),B={vector:T,raster:C,"raster-dem":O,geojson:L,video:R,image:k,canvas:D};function F(e,r){var n=t.identity([]);return t.translate(n,n,[1,1,0]),t.scale(n,n,[.5*e.width,.5*e.height,1]),t.multiply(n,n,e.calculatePosMatrix(r.toUnwrapped()))}function j(t,e,r,n,i,a){var o=function(t,e,r){if(t)for(var n=0,i=t;n<i.length;n+=1){var a=e[i[n]];if(a&&a.source===r&&"fill-extrusion"===a.type)return!0}else for(var o in e){var s=e[o];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=a.maxPitchScaleFactor(),u=t.tilesIn(n,s,o);u.sort(N);for(var l=[],c=0,h=u;c<h.length;c+=1){var f=h[c];l.push({wrappedTileID:f.tileID.wrapped().key,queryResults:f.tile.queryRenderedFeatures(e,r,t._state,f.queryGeometry,f.cameraQueryGeometry,f.scale,i,a,s,F(t.transform,f.tileID))})}var d=function(t){for(var e={},r={},n=0,i=t;n<i.length;n+=1){var a=i[n],o=a.queryResults,s=a.wrappedTileID,u=r[s]=r[s]||{};for(var l in o)for(var c=o[l],h=u[l]=u[l]||{},f=e[l]=e[l]||[],d=0,p=c;d<p.length;d+=1){var m=p[d];h[m.featureIndex]||(h[m.featureIndex]=!0,f.push(m))}}return e}(l);for(var p in d)d[p].forEach((function(e){var r=e.feature,n=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=n}));return d}function N(t,e){var r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}var U=function(t,e){this.max=t,this.onRemove=e,this.reset()};U.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var n=r[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},U.prototype.add=function(t,e,r){var n=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var a={value:e,timeout:void 0};if(void 0!==r&&(a.timeout=setTimeout((function(){n.remove(t,a)}),r)),this.data[i].push(a),this.order.push(i),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this},U.prototype.has=function(t){return t.wrapped().key in this.data},U.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},U.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},U.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},U.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},U.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this},U.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},U.prototype.filter=function(t){var e=[];for(var r in this.data)for(var n=0,i=this.data[r];n<i.length;n+=1){var a=i[n];t(a.value)||e.push(a)}for(var o=0,s=e;o<s.length;o+=1){var u=s[o];this.remove(u.value.tileID,u)}};var z=function(t,e,r){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};z.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},z.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},z.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}},V.prototype.setVertexAttribPointers=function(t,e,r){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],a=e.attributes[i.name];void 0!==a&&t.vertexAttribPointer(a,i.components,t[G[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var H=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};H.prototype.get=function(){return this.current},H.prototype.set=function(t){},H.prototype.getDefault=function(){return this.default},H.prototype.setDefault=function(){this.set(this.default)};var W=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(H),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(H),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(H),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(H),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(H),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(H),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(H),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(H),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(H),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(H),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(H),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(H),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(H),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(H),at=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(H),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(H),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(H),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(H),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(H),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(H),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(H),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(H),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(H),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(H),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(H),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(H),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(H),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(H),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(H),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(H),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(H),wt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(H),Mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(wt),At=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(wt),Et=function(t,e,r,n){this.context=t,this.width=e,this.height=r;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Mt(t,i),n&&(this.depthAttachment=new At(t,i))};Et.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}t.deleteFramebuffer(this.framebuffer)};var St=function(t,e,r){this.func=t,this.mask=e,this.range=r};St.ReadOnly=!1,St.ReadWrite=!0,St.disabled=new St(519,St.ReadOnly,[0,1]);var Tt=function(t,e,r,n,i,a){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=a};Tt.disabled=new Tt({func:519,mask:0},0,0,7680,7680,7680);var Ct=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};Ct.disabled=new Ct(Ct.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),Ct.unblended=new Ct(Ct.Replace,t.Color.transparent,[!0,!0,!0,!0]),Ct.alphaBlended=new Ct([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Ot=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};Ot.disabled=new Ot(!1,1029,2305),Ot.backCCW=new Ot(!0,1029,2305),Ot.backCW=new Ot(!0,1029,2304),Ot.frontCW=new Ot(!0,1028,2304),Ot.frontCCW=new Ot(!0,1028,2305);var Pt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new W(this),this.clearDepth=new $(this),this.clearStencil=new q(this),this.colorMask=new X(this),this.depthMask=new K(this),this.stencilMask=new Z(this),this.stencilFunc=new Y(this),this.stencilOp=new J(this),this.stencilTest=new Q(this),this.depthRange=new tt(this),this.depthTest=new et(this),this.depthFunc=new rt(this),this.blend=new nt(this),this.blendFunc=new it(this),this.blendColor=new at(this),this.blendEquation=new ot(this),this.cullFace=new st(this),this.cullFaceSide=new ut(this),this.frontFace=new lt(this),this.program=new ct(this),this.activeTexture=new ht(this),this.viewport=new ft(this),this.bindFramebuffer=new dt(this),this.bindRenderbuffer=new pt(this),this.bindTexture=new mt(this),this.bindVertexBuffer=new vt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new bt(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Pt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Pt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Pt.prototype.createIndexBuffer=function(t,e){return new z(this,t,e)},Pt.prototype.createVertexBuffer=function(t,e,r){return new V(this,t,e,r)},Pt.prototype.createRenderbuffer=function(t,e,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i},Pt.prototype.createFramebuffer=function(t,e,r){return new Et(this,t,e,r)},Pt.prototype.clear=function(t){var e=t.color,r=t.depth,n=this.gl,i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),n.clear(i)},Pt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Pt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Pt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Pt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,Ct.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Pt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Lt=function(e){function r(r,n,i){var a=this;e.call(this),this.id=r,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(a._sourceLoaded=!0),a._sourceLoaded&&!a._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(a.reload(),a.transform&&a.update(a.transform))})),this.on("error",(function(){a._sourceErrored=!0})),this._source=function(e,r,n,i){var a=new B[r.type](e,r,n,i);if(a.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+a.id);return t.bindAll(["load","abort","unload","serialize","prepare"],a),a}(r,n,i,this),this._tiles={},this._cache=new U(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},r.prototype.getRenderableIds=function(e){var r=this,n=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&n.push(this._tiles[i]);return e?n.sort((function(e,n){var i=e.tileID,a=n.tileID,o=new t.Point(i.canonical.x,i.canonical.y)._rotate(r.transform.angle),s=new t.Point(a.canonical.x,a.canonical.y)._rotate(r.transform.angle);return i.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(t){return t.tileID.key})):n.map((function(t){return t.tileID})).sort(It).map((function(t){return t.key}))},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){var i=this.getTileByID(n);a(t,i),a(i,t)}}function a(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),a=e.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[a]&&(t.neighboringTiles[a].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype._retainLoadedChildren=function(t,e,r,n){for(var i in this._tiles){var a=this._tiles[i];if(!(n[i]||!a.hasData()||a.tileID.overscaledZ<=e||a.tileID.overscaledZ>r)){for(var o=a.tileID;a&&a.tileID.overscaledZ>e+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var u=o;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){n[o.key]=o;break}}}},r.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var r=this._loadedParentTiles[t.key];return r&&r.tileID.overscaledZ>=e?r:null}for(var n=t.overscaledZ-1;n>=e;n--){var i=t.scaledTo(n),a=this._getLoadedTile(i);if(a)return a}},r.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},r.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,r=Math.ceil(t.height/this._source.tileSize)+1,n=Math.floor(e*r*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,n):n;this._cache.setMaxSize(i)},r.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}for(var a in this._tiles=r,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}},r.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return n._source.hasTile(t)})))):i=[];var a=e.coveringZoomLevel(this._source),o=Math.max(a-r.maxOverzooming,this._source.minzoom),s=Math.max(a+r.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,a);if(kt(this._source.type)){for(var l={},c={},h=0,f=Object.keys(u);h<f.length;h+=1){var d=f[h],p=u[d],m=this._tiles[d];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var v=this.findLoadedParent(p,o);v&&(this._addTile(v.tileID),l[v.tileID.key]=v.tileID),c[d]=p}}for(var g in this._retainLoadedChildren(c,a,s,u),l)u[g]||(this._coveredTiles[g]=!0,u[g]=l[g])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,b=t.keysDifference(this._tiles,u);_<b.length;_+=1){var x=b[_],w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var n={},i={},a=Math.max(e-r.maxOverzooming,this._source.minzoom),o=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);n[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,o,n);for(var f=0,d=t;f<d.length;f+=1){var p=d[f],m=this._tiles[p.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var v=p.children(this._source.maxzoom)[0],g=this.getTile(v);if(g&&g.hasData()){n[v.key]=v;continue}}else{var y=p.children(this._source.maxzoom);if(n[y[0].key]&&n[y[1].key]&&n[y[2].key]&&n[y[3].key])continue}for(var _=m.wasRequested(),b=p.overscaledZ-1;b>=a;--b){var x=p.scaledTo(b);if(i[x.key])break;if(i[x.key]=!0,!(m=this.getTile(x))&&_&&(m=this._addTile(x)),m&&(n[x.key]=x,_=m.wasRequested(),m.hasData()))break}}}return n},r.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],r=void 0,n=this._tiles[t].tileID;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}e.push(n.key);var i=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(i))break;n=i}for(var a=0,o=e;a<o.length;a+=1)this._loadedParentTiles[o[a]]=r}},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var n=Boolean(r);return n||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout((function(){r._reloadTile(t,"expired"),delete r._timers[t]}),n))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,n){var i=this,a=[],o=this.transform;if(!o)return a;for(var s=n?o.getCameraQueryGeometry(e):e,u=e.map((function(t){return o.pointCoordinate(t)})),l=s.map((function(t){return o.pointCoordinate(t)})),c=this.getIds(),h=1/0,f=1/0,d=-1/0,p=-1/0,m=0,v=l;m<v.length;m+=1){var g=v[m];h=Math.min(h,g.x),f=Math.min(f,g.y),d=Math.max(d,g.x),p=Math.max(p,g.y)}for(var y=function(e){var n=i._tiles[c[e]];if(!n.holdingForFade()){var s=n.tileID,m=Math.pow(2,o.zoom-n.tileID.overscaledZ),v=r*n.queryPadding*t.EXTENT/n.tileSize/m,g=[s.getTilePoint(new t.MercatorCoordinate(h,f)),s.getTilePoint(new t.MercatorCoordinate(d,p))];if(g[0].x-v<t.EXTENT&&g[0].y-v<t.EXTENT&&g[1].x+v>=0&&g[1].y+v>=0){var y=u.map((function(t){return s.getTilePoint(t)})),_=l.map((function(t){return s.getTilePoint(t)}));a.push({tile:n,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:m})}}},_=0;_<c.length;_++)y(_);return a},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),n=0,i=r;n<i.length;n+=1){var a=i[n];a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(kt(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},r.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},r.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},r.prototype.setDependencies=function(t,e,r){var n=this._tiles[t];n&&n.setDependencies(e,r)},r.prototype.reloadTilesForDependencies=function(t,e){for(var r in this._tiles)this._tiles[r].hasDependency(t,e)&&this._reloadTile(r,"reloading");this._cache.filter((function(r){return!r.hasDependency(t,e)}))},r}(t.Evented);function It(t,e){var r=Math.abs(2*t.wrap)-+(t.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||n-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function kt(t){return"raster"===t||"image"===t||"video"===t}function Rt(){return new t.window.Worker(fa.workerUrl)}Lt.maxOverzooming=10,Lt.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Bt=function(){this.active={}};Bt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Bt.workerCount;)this.workers.push(new Rt);return this.active[t]=!0,this.workers.slice()},Bt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Bt.prototype.isPreloaded=function(){return!!this.active[Dt]},Bt.prototype.numActive=function(){return Object.keys(this.active).length};var Ft,jt=Math.floor(t.browser.hardwareConcurrency/2);function Nt(){return Ft||(Ft=new Bt),Ft}function Ut(e,r){var n={};for(var i in e)"ref"!==i&&(n[i]=e[i]);return t.refProperties.forEach((function(t){t in r&&(n[t]=r[t])})),n}function zt(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Ut(t[n],e[t[n].ref]));return t}Bt.workerCount=Math.max(Math.min(jt,6),1);var Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,r){r.push({command:Gt.addSource,args:[t,e[t]]})}function Ht(t,e,r){e.push({command:Gt.removeSource,args:[t]}),r[t]=!0}function Wt(t,e,r,n){Ht(t,r,n),Vt(t,e,r)}function $t(e,r,n){var i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;return!0}function qt(e,r,n,i,a,o){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:o,args:[i,s,r[s],a]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:o,args:[i,s,r[s],a]}))}function Xt(t){return t.id}function Kt(t,e){return t[e.id]=e,t}var Zt=function(t,e){this.reset(t,e)};Zt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Zt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var r=1,n=this._distances[r],i=e*this.paddedLength+this.padding;n<i&&r<this._distances.length;)n=this._distances[++r];var a=r-1,o=this._distances[a],s=n-o,u=s>0?(i-o)/s:0;return this.points[a].mult(1-u).add(this.points[r].mult(u))};var Yt=function(t,e,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Jt(e,r,n,i,a){var o=t.create();return r?(t.scale(o,o,[1/a,1/a,1]),n||t.rotateZ(o,o,i.angle)):t.multiply(o,i.labelPlaneMatrix,e),o}function Qt(e,r,n,i,a){if(r){var o=t.clone(e);return t.scale(o,o,[a,a,1]),n||t.rotateZ(o,o,-i.angle),o}return i.glCoordMatrix}function te(e,r){var n=[e.x,e.y,0,1];he(n,n,r);var i=n[3];return{point:new t.Point(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function ee(t,e){return Math.min(.5+t/e*.5,1.5)}function re(t,e){var r=t[0]/t[3],n=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&n>=-e[1]&&n<=e[1]}function ne(e,r,n,i,a,o,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,n.transform.zoom),h=[256/n.width*2+1,256/n.height*2+1],f=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();for(var d=e.lineVertexArray,p=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,v=!1,g=0;g<p.length;g++){var y=p.get(g);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!v)ce(y.numGlyphs,f);else{v=!1;var _=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(_,_,r),re(_,h)){var b=ee(n.transform.cameraToCenterDistance,_[3]),x=t.evaluateSizeForFeature(l,c,y),w=s?x/b:x*b,M=new t.Point(y.anchorX,y.anchorY),A=te(M,a).point;if(te(M,a).signedDistanceFromCamera<=0)ce(y.numGlyphs,f);else{var E={},S=oe(y,w,!1,u,r,a,o,e.glyphOffsetArray,d,f,A,M,E,m);v=S.useVertical,(S.notEnoughRoom||v||S.needsFlipping&&oe(y,w,!0,u,r,a,o,e.glyphOffsetArray,d,f,A,M,E,m).notEnoughRoom)&&ce(y.numGlyphs,f)}}else ce(y.numGlyphs,f)}}i?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function ie(t,e,r,n,i,a,o,s,u,l,c){var h=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,p=e.getoffsetX(s.glyphStartIndex),m=e.getoffsetX(h-1),v=ue(t*p,r,n,i,a,o,s.segment,f,d,u,l,c);if(!v)return null;var g=ue(t*m,r,n,i,a,o,s.segment,f,d,u,l,c);return g?{first:v,last:g}:null}function ae(e,r,n,i){return e===t.WritingMode.horizontal&&Math.abs(n.y-r.y)>Math.abs(n.x-r.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<n.y:r.x>n.x)?{needsFlipping:!0}:null}function oe(e,r,n,i,a,o,s,u,l,c,h,f,d,p){var m,v=r/24,g=e.lineOffsetX*v,y=e.lineOffsetY*v;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,b=e.lineStartIndex,x=e.lineStartIndex+e.lineLength,w=ie(v,u,g,y,n,h,f,e,l,o,d);if(!w)return{notEnoughRoom:!0};var M=te(w.first.point,s).point,A=te(w.last.point,s).point;if(i&&!n){var E=ae(e.writingMode,M,A,p);if(E)return E}m=[w.first];for(var S=e.glyphStartIndex+1;S<_-1;S++)m.push(ue(v*u.getoffsetX(S),g,y,n,h,f,e.segment,b,x,l,o,d));m.push(w.last)}else{if(i&&!n){var T=te(f,a).point,C=e.lineStartIndex+e.segment+1,O=new t.Point(l.getx(C),l.gety(C)),P=te(O,a),L=P.signedDistanceFromCamera>0?P.point:se(f,O,T,1,a),I=ae(e.writingMode,T,L,p);if(I)return I}var k=ue(v*u.getoffsetX(e.glyphStartIndex),g,y,n,h,f,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,o,d);if(!k)return{notEnoughRoom:!0};m=[k]}for(var R=0,D=m;R<D.length;R+=1){var B=D[R];t.addDynamicAttributes(c,B.point,B.angle)}return{}}function se(t,e,r,n,i){var a=te(t.add(t.sub(e)._unit()),i).point,o=r.sub(a);return r.add(o._mult(n/o.mag()))}function ue(e,r,n,i,a,o,s,u,l,c,h,f){var d=i?e-r:e+r,p=d>0?1:-1,m=0;i&&(p*=-1,m=Math.PI),p<0&&(m+=Math.PI);for(var v=p>0?u+s:u+s+1,g=a,y=a,_=0,b=0,x=Math.abs(d),w=[];_+b<=x;){if((v+=p)<u||v>=l)return null;if(y=g,w.push(g),void 0===(g=f[v])){var M=new t.Point(c.getx(v),c.gety(v)),A=te(M,h);if(A.signedDistanceFromCamera>0)g=f[v]=A.point;else{var E=v-p;g=se(0===_?o:new t.Point(c.getx(E),c.gety(E)),M,y,x-_+1,h)}}_+=b,b=y.dist(g)}var S=(x-_)/b,T=g.sub(y),C=T.mult(S)._add(y);C._add(T._unit()._perp()._mult(n*p));var O=m+Math.atan2(g.y-y.y,g.x-y.x);return w.push(C),{point:C,angle:O,path:w}}Yt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yt.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Yt.prototype.insertCircle=function(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)},Yt.prototype._insertBoxCell=function(t,e,r,n,i,a){this.boxCells[i].push(a)},Yt.prototype._insertCircleCell=function(t,e,r,n,i,a){this.circleCells[i].push(a)},Yt.prototype._query=function(t,e,r,n,i,a){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];var o=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];o.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return a?o.filter(a):o}return this._forEachCell(t,e,r,n,this._queryCell,o,{hitTest:i,seenUids:{box:{},circle:{}}},a),i?o.length>0:o},Yt.prototype._queryCircle=function(t,e,r,n,i){var a=t-r,o=t+r,s=e-r,u=e+r;if(o<0||a>this.width||u<0||s>this.height)return!n&&[];var l=[];return this._forEachCell(a,s,o,u,this._queryCellCircle,l,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?l.length>0:l},Yt.prototype.query=function(t,e,r,n,i){return this._query(t,e,r,n,!1,i)},Yt.prototype.hitTest=function(t,e,r,n,i){return this._query(t,e,r,n,!0,i)},Yt.prototype.hitTestCircle=function(t,e,r,n){return this._queryCircle(t,e,r,!0,n)},Yt.prototype._queryCell=function(t,e,r,n,i,a,o,s){var u=o.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,f=l;h<f.length;h+=1){var d=f[h];if(!u.box[d]){u.box[d]=!0;var p=4*d;if(t<=c[p+2]&&e<=c[p+3]&&r>=c[p+0]&&n>=c[p+1]&&(!s||s(this.boxKeys[d]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:c[p],y1:c[p+1],x2:c[p+2],y2:c[p+3]})}}}var m=this.circleCells[i];if(null!==m)for(var v=this.circles,g=0,y=m;g<y.length;g+=1){var _=y[g];if(!u.circle[_]){u.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],t,e,r,n)&&(!s||s(this.circleKeys[_]))){if(o.hitTest)return a.push(!0),!0;var x=v[b],w=v[b+1],M=v[b+2];a.push({key:this.circleKeys[_],x1:x-M,y1:w-M,x2:x+M,y2:w+M})}}}},Yt.prototype._queryCellCircle=function(t,e,r,n,i,a,o,s){var u=o.circle,l=o.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,f=0,d=c;f<d.length;f+=1){var p=d[f];if(!l.box[p]){l.box[p]=!0;var m=4*p;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[p])))return a.push(!0),!0}}var v=this.circleCells[i];if(null!==v)for(var g=this.circles,y=0,_=v;y<_.length;y+=1){var b=_[y];if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circlesCollide(g[x],g[x+1],g[x+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[b])))return a.push(!0),!0}}},Yt.prototype._forEachCell=function(t,e,r,n,i,a,o,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n),f=u;f<=c;f++)for(var d=l;d<=h;d++)if(i.call(this,t,e,r,n,this.xCellCount*d+f,a,o,s))return},Yt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Yt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Yt.prototype._circlesCollide=function(t,e,r,n,i,a){var o=n-t,s=i-e,u=r+a;return u*u>o*o+s*s},Yt.prototype._circleAndRectCollide=function(t,e,r,n,i,a,o){var s=(a-n)/2,u=Math.abs(t-(n+s));if(u>s+r)return!1;var l=(o-i)/2,c=Math.abs(e-(i+l));if(c>l+r)return!1;if(u<=s||c<=l)return!0;var h=u-s,f=c-l;return h*h+f*f<=r*r};var le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ce(t,e){for(var r=0;r<t;r++){var n=e.length;e.resize(n+4),e.float32.set(le,3*n)}}function he(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}var fe=function(t,e,r){void 0===e&&(e=new Yt(t.width+200,t.height+200,25)),void 0===r&&(r=new Yt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function de(e,r,n){return r*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}fe.prototype.placeCollisionBox=function(t,e,r,n,i){var a=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),o=r*a.perspectiveRatio,s=t.x1*o+a.point.x,u=t.y1*o+a.point.y,l=t.x2*o+a.point.x,c=t.y2*o+a.point.y,h=a.perspectiveRatio<=.55||a.aboveHorizon;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)||h?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},fe.prototype.placeCollisionCircles=function(e,r,n,i,a,o,s,u,l,c,h,f,d){var p=[],m=new t.Point(r.anchorX,r.anchorY),v=this.projectAndGetPerspectiveRatio(o,m.x,m.y),g=v.perspectiveRatio,y=(c?a/g:a*g)/t.ONE_EM,_=te(m,s).point,b=v.signedDistanceFromCamera>0?ie(y,i,r.lineOffsetX*y,r.lineOffsetY*y,!1,_,m,r,n,s,{}):null,x=!1,w=!1,M=!0;if(b&&!v.aboveHorizon){for(var A=.5*f*g+d,E=new t.Point(-100,-100),S=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),T=new Zt,C=b.first,O=b.last,P=[],L=C.path.length-1;L>=1;L--)P.push(C.path[L]);for(var I=1;I<O.path.length;I++)P.push(O.path[I]);var k=2.5*A;if(u){var R=P.map((function(t){return te(t,u)}));P=R.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:R.map((function(t){return t.point}))}var D=[];if(P.length>0){for(var B=P[0].clone(),F=P[0].clone(),j=1;j<P.length;j++)B.x=Math.min(B.x,P[j].x),B.y=Math.min(B.y,P[j].y),F.x=Math.max(F.x,P[j].x),F.y=Math.max(F.y,P[j].y);D=B.x>=E.x&&F.x<=S.x&&B.y>=E.y&&F.y<=S.y?[P]:F.x<E.x||B.x>S.x||F.y<E.y||B.y>S.y?[]:t.clipLine([P],E.x,E.y,S.x,S.y)}for(var N=0,U=D;N<U.length;N+=1){var z;T.reset(U[N],.25*A),z=T.length<=.5*A?1:Math.ceil(T.paddedLength/k)+1;for(var G=0;G<z;G++){var V=G/Math.max(z-1,1),H=T.lerp(V),W=H.x+100,$=H.y+100;p.push(W,$,A,0);var q=W-A,X=$-A,K=W+A,Z=$+A;if(M=M&&this.isOffscreen(q,X,K,Z),w=w||this.isInsideGrid(q,X,K,Z),!e&&this.grid.hitTestCircle(W,$,A,h)&&(x=!0,!l))return{circles:[],offscreen:!1,collisionDetected:x}}}}return{circles:!l&&x||!w?[]:p,offscreen:M,collisionDetected:x}},fe.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],n=1/0,i=1/0,a=-1/0,o=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);n=Math.min(n,c.x),i=Math.min(i,c.y),a=Math.max(a,c.x),o=Math.max(o,c.y),r.push(c)}for(var h={},f={},d=0,p=this.grid.query(n,i,a,o).concat(this.ignoredGrid.query(n,i,a,o));d<p.length;d+=1){var m=p[d],v=m.key;if(void 0===h[v.bucketInstanceId]&&(h[v.bucketInstanceId]={}),!h[v.bucketInstanceId][v.featureIndex]){var g=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(r,g)&&(h[v.bucketInstanceId][v.featureIndex]=!0,void 0===f[v.bucketInstanceId]&&(f[v.bucketInstanceId]=[]),f[v.bucketInstanceId].push(v.featureIndex))}}return f},fe.prototype.insertCollisionBox=function(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])},fe.prototype.insertCollisionCircles=function(t,e,r,n,i){for(var a=e?this.ignoredGrid:this.grid,o={bucketInstanceId:r,featureIndex:n,collisionGroupID:i},s=0;s<t.length;s+=4)a.insertCircle(o,t[s],t[s+1],t[s+2])},fe.prototype.projectAndGetPerspectiveRatio=function(e,r,n){var i=[r,n,0,1],a=!1;return this.transform.pitch>0?(t.transformMat4(i,i,e),a=i[2]>i[3]):he(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/i[3]*.5,1.5),signedDistanceFromCamera:i[3],aboveHorizon:a}},fe.prototype.isOffscreen=function(t,e,r,n){return r<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},fe.prototype.isInsideGrid=function(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary},fe.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var pe=function(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r};pe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var me=function(t,e,r,n,i){this.text=new pe(t?t.text:null,e,r,i),this.icon=new pe(t?t.icon:null,e,n,i)};me.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ve=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ye=function(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i},_e=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function be(e,r,n,i,a){var o=t.getAnchorAlignment(e),s=-(o.horizontalAlign-.5)*r,u=-(o.verticalAlign-.5)*n,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*a,u+l[1]*a)}function xe(e,r,n,i,a,o){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,f=e.anchorPointY,d=new t.Point(r,n);return i&&d._rotate(a?o:-o),{x1:s+d.x,y1:l+d.y,x2:u+d.x,y2:c+d.y,anchorPointX:h,anchorPointY:f}}_e.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var we=function(t,e,r,n){this.transform=t.clone(),this.collisionIndex=new fe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new _e(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}};function Me(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}we.prototype.getBucketParts=function(e,r,n,i){var a=n.getBucket(r),o=n.latestFeatureIndex;if(a&&o&&r.id===a.layerIds[0]){var s=n.collisionBoxArray,u=a.layers[0].layout,l=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),c=n.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(n.tileID.toUnwrapped()),f="map"===u.get("text-pitch-alignment"),d="map"===u.get("text-rotation-alignment"),p=de(n,1,this.transform.zoom),m=Jt(h,f,d,this.transform,p),v=null;if(f){var g=Qt(h,f,d,this.transform,p);v=t.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[a.bucketInstanceId]=new ye(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,n.tileID);var y={bucket:a,layout:u,posMatrix:h,textLabelPlaneMatrix:m,labelToScreenMatrix:v,scale:l,textPixelRatio:c,holdingForFade:n.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(i)for(var _=0,b=a.sortKeyRanges;_<b.length;_+=1){var x=b[_];e.push({sortKey:x.sortKey,symbolInstanceStart:x.symbolInstanceStart,symbolInstanceEnd:x.symbolInstanceEnd,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:y})}},we.prototype.attemptAnchorPlacement=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p){var m,v=[h.textOffset0,h.textOffset1],g=be(t,r,n,v,i),y=this.collisionIndex.placeCollisionBox(xe(e,g.x,g.y,a,o,this.transform.angle),c,s,u,l.predicate);if(!p||0!==this.collisionIndex.placeCollisionBox(xe(p,g.x,g.y,a,o,this.transform.angle),c,s,u,l.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(m=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:v,width:r,height:n,anchor:t,textBoxScale:i,prevAnchor:m},this.markUsedJustification(f,t,h,d),f.allowVerticalPlacement&&(this.markUsedOrientation(f,d,h),this.placedOrientations[h.crossTileID]=d),{shift:g,placedGlyphBoxes:y}):void 0},we.prototype.placeLayerBucketPart=function(e,r,n){var i=this,a=e.parameters,o=a.bucket,s=a.layout,u=a.posMatrix,l=a.textLabelPlaneMatrix,c=a.labelToScreenMatrix,h=a.textPixelRatio,f=a.holdingForFade,d=a.collisionBoxArray,p=a.partiallyEvaluatedTextSize,m=a.collisionGroup,v=s.get("text-optional"),g=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),b="map"===s.get("text-rotation-alignment"),x="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),M="viewport-y"===s.get("symbol-z-order"),A=y&&(_||!o.hasIconData()||g),E=_&&(y||!o.hasTextData()||v);!o.collisionArrays&&d&&o.deserializeCollisionBoxes(d);var S=function(e,a){if(!r[e.crossTileID])if(f)i.placements[e.crossTileID]=new ve(!1,!1,!1);else{var d,M=!1,S=!1,T=!0,C=null,O={box:null,offscreen:null},P={box:null,offscreen:null},L=null,I=null,k=0,R=0,D=0;a.textFeatureIndex?k=a.textFeatureIndex:e.useRuntimeCollisionCircles&&(k=e.featureIndex),a.verticalTextFeatureIndex&&(R=a.verticalTextFeatureIndex);var B=a.textBox;if(B){var F=function(r){var n=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!r&&i.prevPlacement){var a=i.prevPlacement.placedOrientations[e.crossTileID];a&&(i.placedOrientations[e.crossTileID]=a,i.markUsedOrientation(o,n=a,e))}return n},j=function(r,n){if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&a.verticalTextBox)for(var i=0,s=o.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(O=n(),P=O):O=r(),!(O&&O.box&&O.box.length));i+=1);else O=r()};if(s.get("text-variable-anchor")){var N=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var U=i.prevPlacement.variableOffsets[e.crossTileID];N.indexOf(U.anchor)>0&&(N=N.filter((function(t){return t!==U.anchor}))).unshift(U.anchor)}var z=function(t,r,n){for(var a=t.x2-t.x1,s=t.y2-t.y1,l=e.textBoxScale,c=w&&!_?r:null,f={box:[],offscreen:!1},d=y?2*N.length:N.length,p=0;p<d;++p){var v=i.attemptAnchorPlacement(N[p%N.length],t,a,s,l,b,x,h,u,m,p>=N.length,e,o,n,c);if(v&&(f=v.placedGlyphBoxes)&&f.box&&f.box.length){M=!0,C=v.shift;break}}return f};j((function(){return z(B,a.iconBox,t.WritingMode.horizontal)}),(function(){var r=a.verticalTextBox;return o.allowVerticalPlacement&&!(O&&O.box&&O.box.length)&&e.numVerticalGlyphVertices>0&&r?z(r,a.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),O&&(M=O.box,T=O.offscreen);var G=F(O&&O.box);if(!M&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[e.crossTileID];V&&(i.variableOffsets[e.crossTileID]=V,i.markUsedJustification(o,V.anchor,e,G))}}else{var H=function(t,r){var n=i.collisionIndex.placeCollisionBox(t,y,h,u,m.predicate);return n&&n.box&&n.box.length&&(i.markUsedOrientation(o,r,e),i.placedOrientations[e.crossTileID]=r),n};j((function(){return H(B,t.WritingMode.horizontal)}),(function(){var r=a.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&r?H(r,t.WritingMode.vertical):{box:null,offscreen:null}})),F(O&&O.box&&O.box.length)}}if(M=(d=O)&&d.box&&d.box.length>0,T=d&&d.offscreen,e.useRuntimeCollisionCircles){var W=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),$=t.evaluateSizeForFeature(o.textSizeData,p,W),q=s.get("text-padding");L=i.collisionIndex.placeCollisionCircles(y,W,o.lineVertexArray,o.glyphOffsetArray,$,u,l,c,n,x,m.predicate,e.collisionCircleDiameter,q),M=y||L.circles.length>0&&!L.collisionDetected,T=T&&L.offscreen}if(a.iconFeatureIndex&&(D=a.iconFeatureIndex),a.iconBox){var X=function(t){var e=w&&C?xe(t,C.x,C.y,b,x,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,h,u,m.predicate)};S=P&&P.box&&P.box.length&&a.verticalIconBox?(I=X(a.verticalIconBox)).box.length>0:(I=X(a.iconBox)).box.length>0,T=T&&I.offscreen}var K=v||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,Z=g||0===e.numIconVertices;if(K||Z?Z?K||(S=S&&M):M=S&&M:S=M=S&&M,M&&d&&d.box&&i.collisionIndex.insertCollisionBox(d.box,s.get("text-ignore-placement"),o.bucketInstanceId,P&&P.box&&R?R:k,m.ID),S&&I&&i.collisionIndex.insertCollisionBox(I.box,s.get("icon-ignore-placement"),o.bucketInstanceId,D,m.ID),L&&(M&&i.collisionIndex.insertCollisionCircles(L.circles,s.get("text-ignore-placement"),o.bucketInstanceId,k,m.ID),n)){var Y=o.bucketInstanceId,J=i.collisionCircleArrays[Y];void 0===J&&(J=i.collisionCircleArrays[Y]=new ge);for(var Q=0;Q<L.circles.length;Q+=4)J.circles.push(L.circles[Q+0]),J.circles.push(L.circles[Q+1]),J.circles.push(L.circles[Q+2]),J.circles.push(L.collisionDetected?1:0)}i.placements[e.crossTileID]=new ve(M||A,S||E,T||o.justReloaded),r[e.crossTileID]=!0}};if(M)for(var T=o.getSortedSymbolIndexes(this.transform.angle),C=T.length-1;C>=0;--C){var O=T[C];S(o.symbolInstances.get(O),o.collisionArrays[O])}else for(var P=e.symbolInstanceStart;P<e.symbolInstanceEnd;P++)S(o.symbolInstances.get(P),o.collisionArrays[P]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){var L=this.collisionCircleArrays[o.bucketInstanceId];t.invert(L.invProjMatrix,u),L.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1},we.prototype.markUsedJustification=function(e,r,n,i){var a;a=i===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(r)];for(var o=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];o<s.length;o+=1){var u=s[o];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=a>=0&&u!==a?0:n.crossTileID)}},we.prototype.markUsedOrientation=function(e,r,n){for(var i=r===t.WritingMode.horizontal||r===t.WritingMode.horizontalOnly?r:0,a=r===t.WritingMode.vertical?r:0,o=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];o<s.length;o+=1)e.text.placedSymbolArray.get(s[o]).placedOrientation=i;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=a)},we.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,r=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var n=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},a=e?e.variableOffsets:{},o=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new me(l,n,u.text,u.icon),r=r||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new me(null,n,u.text,u.icon,u.skipFade),r=r||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var f=new me(h,n,!1,!1);f.isHidden()||(this.opacities[c]=f,r=r||h.text.placed||h.icon.placed)}}for(var d in a)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=a[d]);for(var p in o)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=o[p]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},we.prototype.updateLayerOpacities=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1){var a=i[n],o=a.getBucket(t);o&&a.latestFeatureIndex&&t.id===o.layerIds[0]&&this.updateBucketOpacities(o,r,a.collisionBoxArray)}},we.prototype.updateBucketOpacities=function(e,r,n){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var a=e.layers[0].layout,o=new me(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),u=a.get("icon-allow-overlap"),l=a.get("text-variable-anchor"),c="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),f="none"!==a.get("icon-text-fit"),d=new me(null,0,s&&(u||!e.hasIconData()||a.get("icon-optional")),u&&(s||!e.hasTextData()||a.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(n);for(var p=function(t,e,r){for(var n=0;n<e/4;n++)t.opacityVertexArray.emplaceBack(r)},m=function(n){var a=e.symbolInstances.get(n),s=a.numHorizontalGlyphVertices,u=a.numVerticalGlyphVertices,m=a.crossTileID,v=i.opacities[m];r[m]?v=o:v||(i.opacities[m]=v=d),r[m]=!0;var g=a.numIconVertices>0,y=i.placedOrientations[a.crossTileID],_=y===t.WritingMode.vertical,b=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||u>0){var x=Le(v.text);p(e.text,s,_?Ie:x),p(e.text,u,b?Ie:x);var w=v.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=w||b?1:0);var M=i.variableOffsets[a.crossTileID];M&&i.markUsedJustification(e,M.anchor,a,y);var A=i.placedOrientations[a.crossTileID];A&&(i.markUsedJustification(e,"left",a,A),i.markUsedOrientation(e,A,a))}if(g){var E=Le(v.icon),S=!(f&&a.verticalPlacedIconSymbolIndex&&_);a.placedIconSymbolIndex>=0&&(p(e.icon,a.numIconVertices,S?E:Ie),e.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=v.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(p(e.icon,a.numVerticalIconVertices,S?Ie:E),e.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=v.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var T=e.collisionArrays[n];if(T){var C=new t.Point(0,0);if(T.textBox||T.verticalTextBox){var O=!0;if(l){var P=i.variableOffsets[m];P?(C=be(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),c&&C._rotate(h?i.transform.angle:-i.transform.angle)):O=!1}T.textBox&&Me(e.textCollisionBox.collisionVertexArray,v.text.placed,!O||_,C.x,C.y),T.verticalTextBox&&Me(e.textCollisionBox.collisionVertexArray,v.text.placed,!O||b,C.x,C.y)}var L=Boolean(!b&&T.verticalIconBox);T.iconBox&&Me(e.iconCollisionBox.collisionVertexArray,v.icon.placed,L,f?C.x:0,f?C.y:0),T.verticalIconBox&&Me(e.iconCollisionBox.collisionVertexArray,v.icon.placed,!L,f?C.x:0,f?C.y:0)}}},v=0;v<e.symbolInstances.length;v++)m(v);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var g=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=g.invProjMatrix,e.placementViewportMatrix=g.viewportMatrix,e.collisionCircleArray=g.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},we.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},we.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},we.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},we.prototype.stillRecent=function(t,e){var r=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*r>t},we.prototype.setStale=function(){this.stale=!0};var Ae=Math.pow(2,25),Ee=Math.pow(2,24),Se=Math.pow(2,17),Te=Math.pow(2,16),Ce=Math.pow(2,9),Oe=Math.pow(2,8),Pe=Math.pow(2,1);function Le(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*Ae+e*Ee+r*Se+e*Te+r*Ce+e*Oe+r*Pe+e}var Ie=0,ke=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};ke.prototype.continuePlacement=function(t,e,r,n,i){for(var a=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(a,n,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<a.length;)if(e.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,r),this._currentPartIndex++,i())return!0;return!1};var Re=function(t,e,r,n,i,a,o){this.placement=new we(t,i,a,o),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,r,n){for(var i=this,a=t.browser.now(),o=function(){var e=t.browser.now()-a;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new ke(s)),this._inProgressLayer.continuePlacement(n[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Be=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var n=0;n<e.length;n++){var i=e.get(n),a=i.key;this.indexedSymbolInstances[a]||(this.indexedSymbolInstances[a]=[]),this.indexedSymbolInstances[a].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Be.prototype.getScaledCoordinates=function(e,r){var n=De/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*n)}},Be.prototype.findMatches=function(t,e,r){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var a=t.get(i);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o)for(var s=this.getScaledCoordinates(a,e),u=0,l=o;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=n&&Math.abs(c.coord.y-s.y)<=n&&!r[c.crossTileID]){r[c.crossTileID]=!0,a.crossTileID=c.crossTileID;break}}}}};var Fe=function(){this.maxCrossTileID=0};Fe.prototype.generate=function(){return++this.maxCrossTileID};var je=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};je.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var n=this.indexes[r],i={};for(var a in n){var o=n[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+e),i[o.tileID.key]=o}this.indexes[r]=i}this.lng=t},je.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>t.overscaledZ)for(var s in o){var u=o[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=o[t.scaledTo(Number(a)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Be(t,e.symbolInstances,e.bucketInstanceId),!0},je.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var n=0,i=e.indexedSymbolInstances[r];n<i.length;n+=1)delete this.usedCrossTileIDs[t][i[n].crossTileID]},je.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var n=this.indexes[r];for(var i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e};var Ne=function(){this.layerIndexes={},this.crossTileIDs=new Fe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Ne.prototype.addLayer=function(t,e,r){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new je);var i=!1,a={};n.handleWrapJump(r);for(var o=0,s=e;o<s.length;o+=1){var u=s[o],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),a[l.bucketInstanceId]=!0)}return n.removeStaleBuckets(a)&&(i=!0),i},Ne.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var Ue=function(e,r){return t.emitValidationErrors(e,r&&r.filter((function(t){return"source.canvas"!==t.identifier})))},ze=t.pick(Gt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ge=t.pick(Gt,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},r=t.styleSpec.$version;for(var n in t.styleSpec.$root){var i,a=t.styleSpec.$root[n];a.required&&null!=(i="version"===n?r:"array"===a.type?[]:{})&&(e[n]=i)}return e}(),He=function(e){function r(n,i){var a=this;void 0===i&&(i={}),e.call(this),this.map=n,this.dispatcher=new A(Nt(),this),this.imageManager=new f,this.imageManager.setEventedParent(this),this.glyphManager=new _(n._requestManager,i.localIdeographFontFamily),this.lineAtlas=new M(256,512),this.crossTileSymbolIndex=new Ne,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var o=this;this._rtlTextPluginCallback=r.registerForPluginStateChange((function(e){o.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,r){if(t.triggerPluginCompletionEvent(e),r&&r.every((function(t){return t})))for(var n in o.sourceCaches)o.sourceCaches[n].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=a.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var n in a._layers){var i=a._layers[n];i.source===r.id&&a._validateLayer(i)}}}}))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadURL=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var a=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(a,(function(e,r){n._request=null,e?n.fire(new t.ErrorEvent(e)):r&&n._load(r,i)}))},r.prototype.loadJSON=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){n._request=null,n._load(e,!1!==r.validate)}))},r.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},r.prototype._load=function(e,r){if(!r||!Ue(this,t.validateStyle(e))){for(var n in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(n,e.sources[n],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=zt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var a=0,o=i;a<o.length;a+=1){var s=o[a];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._loadSprite=function(e){var r=this;this._spriteRequest=function(e,r,n){var i,a,o,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,o||(o=t,i=e,c())})),l=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){l=null,o||(o=t,a=e,c())}));function c(){if(o)n(o);else if(i&&a){var e=t.browser.getImageData(a),r={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,f=u.y,d=u.sdf,p=u.pixelRatio,m=u.stretchX,v=u.stretchY,g=u.content,y=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,y,{x:h,y:f},{x:0,y:0},{width:l,height:c}),r[s]={data:y,pixelRatio:p,sdf:d,stretchX:m,stretchY:v,content:g}}n(null,r)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(function(e,n){if(r._spriteRequest=null,e)r.fire(new t.ErrorEvent(e));else if(n)for(var i in n)r.imageManager.addImage(i,n[i]);r.imageManager.setLoaded(!0),r._availableImages=r.imageManager.listImages(),r.dispatcher.broadcast("setImages",r._availableImages),r.fire(new t.Event("data",{dataType:"style"}))}))},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var n=e.sourceLayer;if(n){var i=r.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=this._layers[n[r]];"custom"!==i.type&&e.push(i.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var n=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var a in(n.length||i.length)&&this._updateWorkerLayers(n,i),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var l in this.sourceCaches){var c=this.sourceCaches[l];u[l]=c.used,c.used=!1}for(var h=0,f=this._order;h<f.length;h+=1){var d=this._layers[f[h]];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(var p in u){var m=this.sourceCaches[p];u[p]!==m.used&&m.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),Ue(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=zt(e.layers);var n=function(e,r){if(!e)return[{command:Gt.setStyle,args:[r]}];var n=[];try{if(!t.deepEqual(e.version,r.version))return[{command:Gt.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||n.push({command:Gt.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||n.push({command:Gt.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||n.push({command:Gt.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||n.push({command:Gt.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||n.push({command:Gt.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||n.push({command:Gt.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||n.push({command:Gt.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||n.push({command:Gt.setLight,args:[r.light]});var i={},a=[];!function(e,r,n,i){var a;for(a in r=r||{},e=e||{})e.hasOwnProperty(a)&&(r.hasOwnProperty(a)||Ht(a,n,i));for(a in r)r.hasOwnProperty(a)&&(e.hasOwnProperty(a)?t.deepEqual(e[a],r[a])||("geojson"===e[a].type&&"geojson"===r[a].type&&$t(e,r,a)?n.push({command:Gt.setGeoJSONSourceData,args:[a,r[a].data]}):Wt(a,r,n,i)):Vt(a,r,n))}(e.sources,r.sources,a,i);var o=[];e.layers&&e.layers.forEach((function(t){i[t.source]?n.push({command:Gt.removeLayer,args:[t.id]}):o.push(t)})),n=n.concat(a),function(e,r,n){r=r||[];var i,a,o,s,u,l,c,h=(e=e||[]).map(Xt),f=r.map(Xt),d=e.reduce(Kt,{}),p=r.reduce(Kt,{}),m=h.slice(),v=Object.create(null);for(i=0,a=0;i<h.length;i++)p.hasOwnProperty(o=h[i])?a++:(n.push({command:Gt.removeLayer,args:[o]}),m.splice(m.indexOf(o,a),1));for(i=0,a=0;i<f.length;i++)m[m.length-1-i]!==(o=f[f.length-1-i])&&(d.hasOwnProperty(o)?(n.push({command:Gt.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-a),1)):a++,n.push({command:Gt.addLayer,args:[p[o],l=m[m.length-i]]}),m.splice(m.length-i,0,o),v[o]=!0);for(i=0;i<f.length;i++)if(s=d[o=f[i]],u=p[o],!v[o]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in qt(s.layout,u.layout,n,o,null,Gt.setLayoutProperty),qt(s.paint,u.paint,n,o,null,Gt.setPaintProperty),t.deepEqual(s.filter,u.filter)||n.push({command:Gt.setFilter,args:[o,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||n.push({command:Gt.setLayerZoomRange,args:[o,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],n,o,c.slice(6),Gt.setPaintProperty):t.deepEqual(s[c],u[c])||n.push({command:Gt.setLayerProperty,args:[o,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],n,o,c.slice(6),Gt.setPaintProperty):t.deepEqual(s[c],u[c])||n.push({command:Gt.setLayerProperty,args:[o,c,u[c]]}))}else n.push({command:Gt.removeLayer,args:[o]}),l=m[m.lastIndexOf(o)+1],n.push({command:Gt.addLayer,args:[u,l]})}(o,r.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Gt.setStyle,args:[r]}]}return n}(this.serialize(),e).filter((function(t){return!(t.command in Ge)}));if(0===n.length)return!1;var i=n.filter((function(t){return!(t.command in ze)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return n.forEach((function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)})),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this._afterImageUpdated(e)},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},r.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,n){var i=this;if(void 0===n&&(n={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,n))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var a=this.sourceCaches[e]=new Lt(e,r,this.dispatcher);a.style=this,a.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:a.serialize(),sourceId:e}})),a.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var a;if("custom"===e.type){if(Ue(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},n))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[a.id]=a.serialize()}var o=r?this._order.indexOf(r):this._order.length;if(r&&-1===o)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=a,this._removedLayers[i]&&a.source&&"custom"!==a.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var n=this._order.indexOf(e);this._order.splice(n,1);var i=r?this._order.indexOf(r):this._order.length;r&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.hasLayer=function(t){return t in this._layers},r.prototype.setLayerZoomRange=function(e,r,n){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===r&&i.maxzoom===n||(null!=r&&(i.minzoom=r),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",r,null,n)||(i.filter=t.clone$1(r),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getLayoutProperty(r),n)||(a.setLayoutProperty(r,n,i),this._updateLayer(a)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var n=this.getLayer(e);if(n)return n.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var a=this.getLayer(e);a?t.deepEqual(a.getPaintProperty(r),n)||(a.setPaintProperty(r,n,i)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=e.sourceLayer,a=this.sourceCaches[n];if(void 0!==a){var o=a.getSource().type;"geojson"===o&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==o||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),a.setFeatureState(i,e.id,r)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=this.sourceCaches[n];if(void 0!==i){var a=i.getSource().type,o="vector"===a?e.sourceLayer:void 0;"vector"!==a||o?r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(o,e.id,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,n=e.sourceLayer,i=this.sourceCaches[r];if(void 0!==i){if("vector"!==i.getSource().type||n)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(n,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},n={},i=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(r(o)){n[o]=a;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][o];if(l)for(var c=0,h=l;c<h.length;c+=1)i.push(h[c])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var f=[],d=this._order.length-1;d>=0;d--){var p=this._order[d];if(r(p))for(var m=i.length-1;m>=0;m--){var v=i[m].feature;if(n[v.layer.id]<d)break;f.push(v),i.pop()}else for(var g=0,y=t;g<y.length;g+=1){var _=y[g][p];if(_)for(var b=0,x=_;b<x.length;b+=1)f.push(x[b].feature)}}return f},r.prototype.queryRenderedFeatures=function(e,r,n){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);var i={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var a=0,o=r.layers;a<o.length;a+=1){var s=o[a],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in r.availableImages=this._availableImages,this.sourceCaches)r.layers&&!i[c]||l.push(j(this.sourceCaches[c],this._layers,this._serializedLayers,e,r,n));return this.placement&&l.push(function(t,e,r,n,i,a,o){for(var s={},u=a.queryRenderedSymbols(n),l=[],c=0,h=Object.keys(u).map(Number);c<h.length;c+=1)l.push(o[h[c]]);l.sort(N);for(var f=function(){var r=p[d],n=r.featureIndex.lookupSymbolFeatures(u[r.bucketInstanceId],e,r.bucketIndex,r.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var a in n){var o=s[a]=s[a]||[],l=n[a];l.sort((function(t,e){var n=r.featureSortOrder;if(n){var i=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var c=0,h=l;c<h.length;c+=1)o.push(h[c])}},d=0,p=l;d<p.length;d+=1)f();var m=function(e){s[e].forEach((function(n){var i=n.feature,a=r[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}))};for(var v in s)m(v);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);var n=this.sourceCaches[e];return n?function(t,e){for(var r=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),n=[],i={},a=0;a<r.length;a++){var o=r[a],s=o.tileID.canonical.key;i[s]||(i[s]=!0,o.querySourceFeatures(n,e))}return n}(n,r):[]},r.prototype.addSourceType=function(t,e,n){return r.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var n=this.light.getLight(),i=!1;for(var a in e)if(!t.deepEqual(e[a],n[a])){i=!0;break}if(i){var o={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(o)}},r.prototype._validate=function(e,r,n,i,a){return void 0===a&&(a={}),(!a||!1!==a.validate)&&Ue(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:n,styleSpec:t.styleSpec},i)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var r in this.sourceCaches)this.sourceCaches[r].clearTiles(),this.sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,n,i,a){void 0===a&&(a=!1);for(var o=!1,s=!1,u={},l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];if("symbol"===h.type){if(!u[h.source]){var f=this.sourceCaches[h.source];u[h.source]=f.getRenderableIds(!0).map((function(t){return f.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var d=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);o=o||d}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((a=a||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Re(e,this._order,a,r,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o)for(var p=0,m=this._order;p<m.length;p+=1){var v=this._layers[m[p]];"symbol"===v.type&&this.placement.updateLayerOpacities(v,u[v.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r),this._updateTilesForChangedImages();var n=this.sourceCaches[e.source];n&&n.setDependencies(e.tileID.key,e.type,e.icons)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,n){return t.makeRequest(r,n)},r}(t.Evented);He.getSourceType=function(t){return B[t]},He.setSourceType=function(t,e){B[t]=e},He.registerForPluginStateChange=t.registerForPluginStateChange;var We=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),$e=_r("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}","#ifdef GL_ES\r\nprecision highp float;\r\n#else\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n#endif\nvec2 unpack_float(const float packedValue) {\r\nint packedIntValue=int(packedValue);\r\nint v0=packedIntValue/256;\r\nreturn vec2(v0,packedIntValue-v0*256);\r\n}\r\nvec2 unpack_opacity(const float packedOpacity) {\r\nint intOpacity=int(packedOpacity)/2;\r\nreturn vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r\n}vec4 decode_color(const vec2 encodedColor) {\r\nreturn vec4(\r\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r\n);\r\n}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r\nreturn mix(packedValue[0],packedValue[1],t);\r\n}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r\nvec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r\nvec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r\nreturn mix(minColor,maxColor,t);\r\n}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r\nvec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r\nreturn (tile_units_to_pixels*pos+offset)/pattern_size;\r\n}\r\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);\r\nbool isOccluded(vec4 frag) { return false; }\r\nfloat occlusionFade(vec4 frag) { return 1.0; }"),qe=_r("uniform vec4 u_color;\r\nuniform float u_opacity;\r\nvoid main() {\r\ngl_FragColor=u_color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n}"),Xe=_r("uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvoid main() {\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\ngl_FragColor=mix(color1,color2,u_mix)*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\r\n}"),Ke=_r("varying vec3 v_data;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\r\nvec2 extrude=v_data.xy;\r\nfloat extrude_length=length(extrude);\r\nlowp float antialiasblur=v_data.z;\r\nfloat antialiased_blur=-max(blur,antialiasblur);\r\nfloat opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);\r\nfloat color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r\n);\r\ngl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform bool u_scale_with_map;\r\nuniform bool u_pitch_with_map;\r\nuniform vec2 u_extrude_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nattribute vec2 a_pos;\r\nvarying vec3 v_data;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define mediump float radius\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define highp vec4 stroke_color\r\n#pragma mapbox: define mediump float stroke_width\r\n#pragma mapbox: define lowp float stroke_opacity\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize mediump float radius\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize highp vec4 stroke_color\r\n#pragma mapbox: initialize mediump float stroke_width\r\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\r\nif (u_pitch_with_map) {\r\nvec2 corner_position=circle_center;\r\nif (u_scale_with_map) {\r\ncorner_position+=extrude*(radius+stroke_width)*u_extrude_scale;\r\n} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);\r\ncorner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);\r\n}\r\ngl_Position=u_matrix*vec4(corner_position,0,1);\r\n} else {\r\ngl_Position=u_matrix*vec4(circle_center,0,1);\r\nif (u_scale_with_map) {\r\ngl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;\r\n} else {\r\ngl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;\r\n}\r\n}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r\nv_data=vec3(extrude.x,extrude.y,antialiasblur);\r\n}"),Ze=_r("void main() {\r\ngl_FragColor=vec4(1.0);\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n}"),Ye=_r("uniform highp float u_intensity;\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main() {\r\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r\nfloat val=weight*u_intensity*GAUSS_COEF*exp(d);\r\ngl_FragColor=vec4(val,1.0,1.0,1.0);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform float u_extrude_scale;\r\nuniform float u_opacity;\r\nuniform float u_intensity;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_extrude;\r\n#pragma mapbox: define highp float weight\r\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\r\nvoid main(void) {\r\n#pragma mapbox: initialize highp float weight\r\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);\r\ngl_Position=u_matrix*pos;\r\n}"),Je=_r("uniform sampler2D u_image;\r\nuniform sampler2D u_color_ramp;\r\nuniform float u_opacity;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\nfloat t=texture2D(u_image,v_pos).r;\r\nvec4 color=texture2D(u_color_ramp,vec2(t,0.5));\r\ngl_FragColor=color*u_opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(0.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos*u_world,0,1);\r\nv_pos.x=a_pos.x;\r\nv_pos.y=1.0-a_pos.y;\r\n}"),Qe=_r("varying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nfloat alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {\r\ngl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;\r\n}\r\nif (v_notUsed > 0.5) {gl_FragColor*=.1;\r\n}\r\n}","attribute vec2 a_pos;\r\nattribute vec2 a_anchor_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_placed;\r\nattribute vec2 a_shift;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\nvoid main() {\r\nvec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r\ngl_Position=u_matrix*vec4(a_pos,0.0,1.0);\r\ngl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r\nv_placed=a_placed.x;\r\nv_notUsed=a_placed.y;\r\n}"),tr=_r("varying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvoid main() {\r\nfloat alpha=0.5*min(v_perspective_ratio,1.0);\r\nfloat stroke_radius=0.9*max(v_perspective_ratio,1.0);\r\nfloat distance_to_center=length(v_extrude);\r\nfloat distance_to_edge=abs(distance_to_center-v_radius);\r\nfloat opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r\nvec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r\ngl_FragColor=color*alpha*opacity_t;\r\n}","attribute vec2 a_pos;\r\nattribute float a_radius;\r\nattribute vec2 a_flags;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_inv_matrix;\r\nuniform vec2 u_viewport_size;\r\nuniform float u_camera_to_center_distance;\r\nvarying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying float v_perspective_ratio;\r\nvarying float v_collision;\r\nvec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r\nvec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r\nrayStart.xyz/=rayStart.w;\r\nrayEnd.xyz  /=rayEnd.w;\r\nhighp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r\nreturn mix(rayStart.xyz,rayEnd.xyz,t);\r\n}\r\nvoid main() {\r\nvec2 quadCenterPos=a_pos;\r\nfloat radius=a_radius;\r\nfloat collision=a_flags.x;\r\nfloat vertexIdx=a_flags.y;\r\nvec2 quadVertexOffset=vec2(\r\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r\nvec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r\nvec4 clipPos=u_matrix*vec4(tilePos,1.0);\r\nhighp float camera_to_anchor_distance=clipPos.w;\r\nhighp float collision_perspective_ratio=clamp(\r\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r\nv_radius=radius;\r\nv_extrude=quadVertexExtent*padding_factor;\r\nv_perspective_ratio=collision_perspective_ratio;\r\nv_collision=collision;\r\ngl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r\n}"),er=_r("uniform highp vec4 u_color;\r\nuniform sampler2D u_overlay;\r\nvarying vec2 v_uv;\r\nvoid main() {\r\nvec4 overlay_color=texture2D(u_overlay,v_uv);\r\ngl_FragColor=mix(u_color,overlay_color,overlay_color.a);\r\n}","attribute vec2 a_pos;\r\nvarying vec2 v_uv;\r\nuniform mat4 u_matrix;\r\nuniform float u_overlay_scale;\r\nvoid main() {v_uv=a_pos/8192.0;\r\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);\r\n}"),rr=_r("#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_FragColor=color*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\n}"),nr=_r("varying vec2 v_pos;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\nfloat dist=length(v_pos-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\ngl_FragColor=outline_color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute vec2 a_pos;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define highp vec4 outline_color\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 outline_color\r\n#pragma mapbox: initialize lowp float opacity\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n}"),ir=_r("uniform vec2 u_texsize;\r\nuniform sampler2D u_image;\r\nuniform float u_fade;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);\r\nfloat alpha=1.0-smoothstep(0.0,1.0,dist);\r\ngl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform vec3 u_scale;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);\r\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r\n}"),ar=_r("uniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\ngl_FragColor=mix(color1,color2,u_fade)*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform vec3 u_scale;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileZoomRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\r\n}"),or=_r("varying vec4 v_color;\r\nvoid main() {\r\ngl_FragColor=v_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\nvarying vec4 v_color;\r\n#pragma mapbox: define highp float base\r\n#pragma mapbox: define highp float height\r\n#pragma mapbox: define highp vec4 color\r\nvoid main() {\r\n#pragma mapbox: initialize highp float base\r\n#pragma mapbox: initialize highp float height\r\n#pragma mapbox: initialize highp vec4 color\r\nvec3 normal=a_normal_ed.xyz;\r\nbase=max(0.0,base);\r\nheight=max(0.0,height);\r\nfloat t=mod(normal.x,2.0);\r\ngl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;\r\nv_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r\ncolor+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));\r\n}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);\r\nv_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);\r\nv_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);\r\nv_color*=u_opacity;\r\n}"),sr=_r("uniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\n#pragma mapbox: define lowp float base\r\n#pragma mapbox: define lowp float height\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float base\r\n#pragma mapbox: initialize lowp float height\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nvec2 imagecoord=mod(v_pos_a,1.0);\r\nvec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);\r\nvec4 color1=texture2D(u_image,pos);\r\nvec2 imagecoord_b=mod(v_pos_b,1.0);\r\nvec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);\r\nvec4 color2=texture2D(u_image,pos2);\r\nvec4 mixedColor=mix(color1,color2,u_fade);\r\ngl_FragColor=mixedColor*v_lighting;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_height_factor;\r\nuniform vec3 u_scale;\r\nuniform float u_vertical_gradient;\r\nuniform lowp float u_opacity;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\n#pragma mapbox: define lowp float base\r\n#pragma mapbox: define lowp float height\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float base\r\n#pragma mapbox: initialize lowp float height\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec3 normal=a_normal_ed.xyz;\r\nfloat edgedistance=a_normal_ed.w;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nbase=max(0.0,base);\r\nheight=max(0.0,height);\r\nfloat t=mod(normal.x,2.0);\r\nfloat z=t > 0.0 ? height : base;\r\ngl_Position=u_matrix*vec4(a_pos,z,1);\r\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\r\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);\r\nv_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);\r\nv_lighting=vec4(0.0,0.0,0.0,1.0);\r\nfloat directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);\r\ndirectional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);\r\nif (normal.y !=0.0) {directional*=(\r\n(1.0-u_vertical_gradient)+\n(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));\r\n}\r\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r\nv_lighting*=u_opacity;\r\n}"),ur=_r("#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_dimension;\r\nuniform float u_zoom;\r\nuniform vec4 u_unpack;\r\nfloat getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;\r\ndata.a=-1.0;\r\nreturn dot(data,u_unpack)/4.0;\r\n}\r\nvoid main() {\r\nvec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);\r\nfloat b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);\r\nfloat c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);\r\nfloat d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);\r\nfloat e=getElevation(v_pos,0.0);\r\nfloat f=getElevation(v_pos+vec2(epsilon.x,0),0.0);\r\nfloat g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);\r\nfloat h=getElevation(v_pos+vec2(0,epsilon.y),0.0);\r\nfloat i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r\nfloat exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r\nvec2 deriv=vec2(\r\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\r\n)/pow(2.0,exaggeration+(19.2562-u_zoom));\r\ngl_FragColor=clamp(vec4(\r\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_dimension;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nhighp vec2 epsilon=1.0/u_dimension;\r\nfloat scale=(u_dimension.x-2.0)/u_dimension.x;\r\nv_pos=(a_texture_pos/8192.0)*scale+epsilon;\r\n}"),lr=_r("uniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_latrange;\r\nuniform vec2 u_light;\r\nuniform vec4 u_shadow;\r\nuniform vec4 u_highlight;\r\nuniform vec4 u_accent;\r\n#define PI 3.141592653589793\r\nvoid main() {\r\nvec4 pixel=texture2D(u_image,v_pos);\r\nvec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r\nfloat aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r\nfloat intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r\nfloat maxValue=0.5*PI;\r\nfloat scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r\nfloat shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r\nvec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r\ngl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);\r\nv_pos=a_texture_pos/8192.0;\r\n}"),cr=_r("uniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\ngl_FragColor=color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_units_to_pixels;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying highp float v_linesofar;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nv_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\nv_width2=vec2(outset,inset);\r\n}"),hr=_r("uniform lowp float u_device_pixel_ratio;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying highp vec2 v_uv;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);\r\ngl_FragColor=color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_uv_x;\r\nattribute float a_split_index;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_units_to_pixels;\r\nuniform float u_image_height;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying highp vec2 v_uv;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nhighp float texel_height=1.0/u_image_height;\r\nhighp float half_texel_height=0.5*texel_height;\r\nv_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\nv_width2=vec2(outset,inset);\r\n}"),fr=_r("uniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_texsize;\r\nuniform float u_fade;\r\nuniform mediump vec3 u_scale;\r\nuniform sampler2D u_image;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\nvec2 pattern_tl_a=pattern_from.xy;\r\nvec2 pattern_br_a=pattern_from.zw;\r\nvec2 pattern_tl_b=pattern_to.xy;\r\nvec2 pattern_br_b=pattern_to.zw;\r\nfloat tileZoomRatio=u_scale.x;\r\nfloat fromScale=u_scale.y;\r\nfloat toScale=u_scale.z;\r\nvec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;\r\nvec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\r\nvec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);\r\nvec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);\r\nfloat aspect_a=display_size_a.y/v_width;\r\nfloat aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nfloat x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);\r\nfloat x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);\r\nfloat y=0.5*v_normal.y+0.5;\r\nvec2 texel_size=1.0/u_texsize;\r\nvec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));\r\nvec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));\r\nvec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\r\ngl_FragColor=color*alpha*opacity;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_units_to_pixels;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\nvarying float v_width;\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\n#pragma mapbox: define lowp vec4 pattern_from\r\n#pragma mapbox: define lowp vec4 pattern_to\r\n#pragma mapbox: define lowp float pixel_ratio_from\r\n#pragma mapbox: define lowp float pixel_ratio_to\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\r\n#pragma mapbox: initialize mediump vec4 pattern_from\r\n#pragma mapbox: initialize mediump vec4 pattern_to\r\n#pragma mapbox: initialize lowp float pixel_ratio_from\r\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nfloat a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\nv_linesofar=a_linesofar;\r\nv_width2=vec2(outset,inset);\r\nv_width=floorwidth;\r\n}"),dr=_r("uniform lowp float u_device_pixel_ratio;\r\nuniform sampler2D u_image;\r\nuniform float u_sdfgamma;\r\nuniform float u_mix;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r\nfloat alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r\nfloat sdfdist_a=texture2D(u_image,v_tex_a).a;\r\nfloat sdfdist_b=texture2D(u_image,v_tex_b).a;\r\nfloat sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);\r\nalpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);\r\ngl_FragColor=color*(alpha*opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\r\nattribute vec2 a_pos_normal;\r\nattribute vec4 a_data;\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform vec2 u_patternscale_a;\r\nuniform float u_tex_y_a;\r\nuniform vec2 u_patternscale_b;\r\nuniform float u_tex_y_b;\r\nuniform vec2 u_units_to_pixels;\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n#pragma mapbox: define highp vec4 color\r\n#pragma mapbox: define lowp float blur\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define mediump float gapwidth\r\n#pragma mapbox: define lowp float offset\r\n#pragma mapbox: define mediump float width\r\n#pragma mapbox: define lowp float floorwidth\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 color\r\n#pragma mapbox: initialize lowp float blur\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize mediump float gapwidth\r\n#pragma mapbox: initialize lowp float offset\r\n#pragma mapbox: initialize mediump float width\r\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r\nvec2 a_extrude=a_data.xy-128.0;\r\nfloat a_direction=mod(a_data.z,4.0)-1.0;\r\nfloat a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;\r\nvec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r\nnormal.y=normal.y*2.0-1.0;\r\nv_normal=normal;gapwidth=gapwidth/2.0;\r\nfloat halfwidth=width/2.0;\r\noffset=-1.0*offset;\r\nfloat inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\nfloat outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;\r\nmediump float t=1.0-abs(u);\r\nmediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r\nvec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);\r\ngl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);\r\nfloat extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);\r\nv_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\r\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);\r\nv_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);\r\nv_width2=vec2(outset,inset);\r\n}"),pr=_r("uniform float u_fade_t;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image0;\r\nuniform sampler2D u_image1;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nuniform float u_brightness_low;\r\nuniform float u_brightness_high;\r\nuniform float u_saturation_factor;\r\nuniform float u_contrast_factor;\r\nuniform vec3 u_spin_weights;\r\nvoid main() {vec4 color0=texture2D(u_image0,v_pos0);\r\nvec4 color1=texture2D(u_image1,v_pos1);\r\nif (color0.a > 0.0) {\r\ncolor0.rgb=color0.rgb/color0.a;\r\n}\r\nif (color1.a > 0.0) {\r\ncolor1.rgb=color1.rgb/color1.a;\r\n}\r\nvec4 color=mix(color0,color1,u_fade_t);\r\ncolor.a*=u_opacity;\r\nvec3 rgb=color.rgb;rgb=vec3(\r\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r\nrgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r\nvec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r\ngl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","uniform mat4 u_matrix;\r\nuniform vec2 u_tl_parent;\r\nuniform float u_scale_parent;\r\nuniform float u_buffer_scale;\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\nvoid main() {\r\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;\r\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r\n}"),mr=_r("uniform sampler2D u_texture;\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\nlowp float alpha=opacity*v_fade_opacity;\r\ngl_FragColor=texture2D(u_texture,v_tex)*alpha;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","const float PI=3.141592653589793;\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform float u_fade_change;\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform vec2 u_texsize;\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n#pragma mapbox: define lowp float opacity\r\nvoid main() {\r\n#pragma mapbox: initialize lowp float opacity\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nvec2 a_minFontScale=a_pixeloffset.zw/256.0;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,0,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\r\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nv_tex=a_tex/u_texsize;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nv_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));\r\n}"),vr=_r("#define SDF_PX 8.0\r\nuniform bool u_is_halo;\r\nuniform sampler2D u_texture;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nuniform bool u_is_text;\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nvec2 tex=v_data0.xy;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fade_opacity=v_data1[2];\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nif (u_is_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\ngl_FragColor=color*(alpha*opacity*fade_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","const float PI=3.141592653589793;\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec4 a_pixeloffset;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nvec2 a_pxoffset=a_pixeloffset.xy;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,0,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=u_is_text ? size/24.0 : size;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\r\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nfloat gamma_scale=gl_Position.w;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));\r\nv_data0=a_tex/u_texsize;\r\nv_data1=vec3(gamma_scale,size,interpolated_fade_opacity);\r\n}"),gr=_r("#define SDF_PX 8.0\r\n#define SDF 1.0\r\n#define ICON 0.0\r\nuniform bool u_is_halo;\r\nuniform sampler2D u_texture;\r\nuniform sampler2D u_texture_icon;\r\nuniform highp float u_gamma_scale;\r\nuniform lowp float u_device_pixel_ratio;\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nfloat fade_opacity=v_data1[2];\r\nif (v_data1.w==ICON) {\r\nvec2 tex_icon=v_data0.zw;\r\nlowp float alpha=opacity*fade_opacity;\r\ngl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\nreturn;\r\n}\r\nvec2 tex=v_data0.xy;\r\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;\r\nfloat gamma_scale=v_data1.x;\r\nfloat size=v_data1.y;\r\nfloat fontScale=size/24.0;\r\nlowp vec4 color=fill_color;\r\nhighp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r\nlowp float buff=(256.0-64.0)/256.0;\r\nif (u_is_halo) {\r\ncolor=halo_color;\r\ngamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r\nbuff=(6.0-halo_width/fontScale)/SDF_PX;\r\n}\r\nlowp float dist=texture2D(u_texture,tex).a;\r\nhighp float gamma_scaled=gamma*gamma_scale;\r\nhighp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r\ngl_FragColor=color*(alpha*opacity*fade_opacity);\r\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","const float PI=3.141592653589793;\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_coord_matrix;\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform vec2 u_texsize;\r\nuniform vec2 u_texsize_icon;\r\nvarying vec4 v_data0;\r\nvarying vec4 v_data1;\r\n#pragma mapbox: define highp vec4 fill_color\r\n#pragma mapbox: define highp vec4 halo_color\r\n#pragma mapbox: define lowp float opacity\r\n#pragma mapbox: define lowp float halo_width\r\n#pragma mapbox: define lowp float halo_blur\r\nvoid main() {\r\n#pragma mapbox: initialize highp vec4 fill_color\r\n#pragma mapbox: initialize highp vec4 halo_color\r\n#pragma mapbox: initialize lowp float opacity\r\n#pragma mapbox: initialize lowp float halo_width\r\n#pragma mapbox: initialize lowp float halo_blur\r\nvec2 a_pos=a_pos_offset.xy;\r\nvec2 a_offset=a_pos_offset.zw;\r\nvec2 a_tex=a_data.xy;\r\nvec2 a_size=a_data.zw;\r\nfloat a_size_min=floor(a_size[0]*0.5);\r\nfloat is_sdf=a_size[0]-2.0*a_size_min;\r\nhighp float segment_angle=-a_projected_pos[2];\r\nfloat size;\r\nif (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=mix(a_size_min,a_size[1],u_size_t)/128.0;\r\n} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\nsize=a_size_min/128.0;\r\n} else {\r\nsize=u_size;\r\n}\r\nvec4 projectedPoint=u_matrix*vec4(a_pos,0,1);\r\nhighp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\r\ncamera_to_anchor_distance/u_camera_to_center_distance :\r\nu_camera_to_center_distance/camera_to_anchor_distance;\r\nhighp float perspective_ratio=clamp(\r\n0.5+0.5*distance_ratio,0.0,1.5);\r\nsize*=perspective_ratio;\r\nfloat fontScale=size/24.0;\r\nhighp float symbol_rotation=0.0;\r\nif (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);\r\nvec2 a=projectedPoint.xy/projectedPoint.w;\r\nvec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;\r\nsymbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r\n}\r\nhighp float angle_sin=sin(segment_angle+symbol_rotation);\r\nhighp float angle_cos=cos(segment_angle+symbol_rotation);\r\nmat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\r\nfloat occlusion_fade=occlusionFade(projectedPoint);\r\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));\r\nfloat gamma_scale=gl_Position.w;\r\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);\r\nfloat fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r\nfloat interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));\r\nv_data0.xy=a_tex/u_texsize;\r\nv_data0.zw=a_tex/u_texsize_icon;\r\nv_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);\r\n}"),yr=_r("varying highp vec3 v_uv;\r\nuniform lowp sampler2D u_color_ramp;\r\nuniform highp vec3 u_center_direction;\r\nuniform lowp float u_radius;\r\nuniform lowp float u_opacity;\r\nuniform highp float u_temporal_offset;\r\nvoid main() {\r\nfloat progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r\nvec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\r\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);\r\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\r\ngl_FragColor=vec4(1.0);\r\n#endif\r\n}","attribute highp vec3 a_pos_3f;\r\nuniform lowp mat4 u_matrix;\r\nvarying highp vec3 v_uv;\r\nvoid main() {\r\nconst mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;\r\nvec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r\n}");function _r(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,i=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),a=t.match(n),o=e.match(n),s=o?o.concat(a):a,u={};return{fragmentSource:t=t.replace(r,(function(t,e,r,n,i){return u[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(r,(function(t,e,r,n,i){var a="float"===n?"vec2":"vec4",o=i.match(/color/)?"color":a;return u[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+a+" a_"+i+";\nvarying "+r+" "+n+" "+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+o+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+r+" "+a+" a_"+i+";\n#else\nuniform "+r+" "+n+" u_"+i+";\n#endif\n":"vec4"===o?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = a_"+i+";\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+r+" "+n+" "+i+" = unpack_mix_"+o+"(a_"+i+", u_"+i+"_t);\n#else\n    "+r+" "+n+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:i,staticUniforms:s}}var br=Object.freeze({__proto__:null,prelude:$e,background:qe,backgroundPattern:Xe,circle:Ke,clippingMask:Ze,heatmap:Ye,heatmapTexture:Je,collisionBox:Qe,collisionCircle:tr,debug:er,fill:rr,fillOutline:nr,fillOutlinePattern:ir,fillPattern:ar,fillExtrusion:or,fillExtrusionPattern:sr,hillshadePrepare:ur,hillshade:lr,line:cr,lineGradient:hr,linePattern:fr,lineSDF:dr,raster:pr,symbolIcon:mr,symbolSDF:vr,symbolTextAndIcon:gr,skyboxGradient:yr}),xr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function wr(t){for(var e=[],r=0;r<t.length;r++)if(null!==t[r]){var n=t[r].split(" ");e.push(n.pop())}return e}xr.prototype.bind=function(t,e,r,n,i,a,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==n.length,l=0;!u&&l<n.length;l++)this.boundPaintVertexBuffers[l]!==n[l]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===r&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,r,n,i,a,o,s)},xr.prototype.freshBind=function(t,e,r,n,i,a,o){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var f=0,d=r;f<d.length;f+=1)d[f].enableAttributes(c,t);a&&a.enableAttributes(c,t),o&&o.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var p=0,m=r;p<m.length;p+=1){var v=m[p];v.bind(),v.setVertexAttribPointers(c,t,i)}a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),n&&n.bind(),o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},xr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Mr=function(t,e,r,n,i,a){var o=t.gl;this.program=o.createProgram();for(var s=wr(r.staticAttributes),u=n?n.getBinderAttributes():[],l=s.concat(u),c=r.staticUniforms?wr(r.staticUniforms):[],h=n?n.getBinderUniforms():[],f=[],d=0,p=c.concat(h);d<p.length;d+=1){var m=p[d];f.indexOf(m)<0&&f.push(m)}var v=n?n.defines():[];a&&v.push("#define OVERDRAW_INSPECTOR;");var g=v.concat($e.fragmentSource,r.fragmentSource).join("\n"),y=v.concat($e.vertexSource,r.vertexSource).join("\n"),_=o.createShader(o.FRAGMENT_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(_,g),o.compileShader(_),o.attachShader(this.program,_);var b=o.createShader(o.VERTEX_SHADER);if(o.isContextLost())this.failedToCreate=!0;else{o.shaderSource(b,y),o.compileShader(b),o.attachShader(this.program,b),this.attributes={};var x={};this.numAttributes=l.length;for(var w=0;w<this.numAttributes;w++)l[w]&&(o.bindAttribLocation(this.program,w,l[w]),this.attributes[l[w]]=w);o.linkProgram(this.program),o.deleteShader(b),o.deleteShader(_);for(var M=0;M<f.length;M++){var A=f[M];if(A&&!x[A]){var E=o.getUniformLocation(this.program,A);E&&(x[A]=E)}}this.fixedUniforms=i(t,x),this.binderUniforms=n?n.getUniforms(t,x):[]}}};function Ar(t,e,r){var n=1/de(r,1,e.transform.tileZoom),i=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,e.transform.tileZoom)/i,o=a*(r.tileID.canonical.x+r.tileID.wrap*i),s=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_scale:[n,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}Mr.prototype.draw=function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){var v,g=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(a),this.fixedUniforms)this.fixedUniforms[y].set(o[y]);d&&d.setUniforms(t,this.binderUniforms,h,{zoom:f});for(var _=(v={},v[g.LINES]=2,v[g.TRIANGLES]=3,v[g.LINE_STRIP]=1,v)[e],b=0,x=c.get();b<x.length;b+=1){var w=x[b],M=w.vaos||(w.vaos={});(M[s]||(M[s]=new xr)).bind(t,this,u,d?d.getPaintVertexBuffers():[],l,w.vertexOffset,p,m),g.drawElements(e,w.primitiveLength*_,g.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var Er=function(e,r,n,i){var a=r.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],u=t.create$1();"viewport"===a.properties.get("anchor")&&t.fromRotation(u,-r.transform.angle),t.transformMat3(s,s,u);var l=a.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+n,u_opacity:i}},Sr=function(e,r,n,i,a,o,s){return t.extend(Er(e,r,n,i),Ar(o,r,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},Tr=function(t){return{u_matrix:t}},Cr=function(e,r,n,i){return t.extend(Tr(e),Ar(n,r,i))},Or=function(t,e){return{u_matrix:t,u_world:e}},Pr=function(e,r,n,i,a){return t.extend(Cr(e,r,n,i),{u_world:a})},Lr=function(e,r,n,i){var a,o,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=de(n,1,s.zoom);a=!0,o=[u,u]}else a=!1,o=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(r.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+a,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:o}},Ir=function(t,e,r){var n=de(r,1,e.zoom),i=Math.pow(2,e.zoom-r.tileID.overscaledZ),a=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*i),e.pixelsToGLUnits[1]/(n*i)],u_overscale_factor:a}},kr=function(t,e,r){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:r.cameraToCenterDistance,u_viewport_size:[r.width,r.height]}},Rr=function(t,e,r){return void 0===r&&(r=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:r}},Dr=function(t){return{u_matrix:t}},Br=function(t,e,r,n){return{u_matrix:t,u_extrude_scale:de(e,1,r),u_intensity:n}},Fr=function(e,r,n){var i=e.transform;return{u_matrix:Gr(e,r,n),u_ratio:1/de(r,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},jr=function(e,r,n,i){return t.extend(Fr(e,r,n),{u_image:0,u_image_height:i})},Nr=function(e,r,n,i){var a=e.transform,o=zr(r,a);return{u_matrix:Gr(e,r,n),u_texsize:r.imageAtlasTexture.size,u_ratio:1/de(r,1,a.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[o,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},Ur=function(e,r,n,i,a){var o=e.lineAtlas,s=zr(r,e.transform),u="round"===n.layout.get("line-cap"),l=o.getDash(i.from,u),c=o.getDash(i.to,u),h=l.width*a.fromScale,f=c.width*a.toScale;return t.extend(Fr(e,r,n),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/f,-c.height/2],u_sdfgamma:o.width/(256*Math.min(h,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:a.t})};function zr(t,e){return 1/de(t,1,e.tileZoom)}function Gr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var Vr=function(t,e,r,n,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(o=i.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Hr(i.paint.get("raster-hue-rotate"))};var a,o};function Hr(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var Wr,$r=function(t,e,r,n,i,a,o,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+n,u_texsize:l,u_texture:0}},qr=function(e,r,n,i,a,o,s,u,l,c,h){var f=a.transform;return t.extend($r(e,r,n,i,a,o,s,u,l,c),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Xr=function(e,r,n,i,a,o,s,u,l,c){return t.extend(qr(e,r,n,i,a,o,s,u,!0,l,!0),{u_texsize_icon:c,u_texture_icon:1})},Kr=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},Zr=function(e,r,n,i,a,o){return t.extend(function(t,e,r,n){var i=r.imageManager.getPattern(t.from.toString()),a=r.imageManager.getPattern(t.to.toString()),o=r.imageManager.getPixelSize(),s=o.width,u=o.height,l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/l,h=c*(n.tileID.canonical.x+n.tileID.wrap*l),f=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/de(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,f>>16],u_pixel_coord_lower:[65535&h,65535&f]}}(i,o,n,a),{u_matrix:e,u_opacity:r})},Yr={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},collisionCircle:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,r.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,r.u_viewport_size)}},debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_overlay:new t.Uniform1i(e,r.u_overlay),u_overlay_scale:new t.Uniform1f(e,r.u_overlay_scale)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_unpack:new t.Uniform4f(e,r.u_unpack)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image),u_image_height:new t.Uniform1f(e,r.u_image_height)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_image:new t.Uniform1i(e,r.u_image),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_scale:new t.Uniform3f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},symbolTextAndIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1i(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texsize_icon:new t.Uniform2f(e,r.u_texsize_icon),u_texture:new t.Uniform1i(e,r.u_texture),u_texture_icon:new t.Uniform1i(e,r.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}},skyboxGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_center_direction:new t.Uniform3f(e,r.u_center_direction),u_radius:new t.Uniform1f(e,r.u_radius),u_opacity:new t.Uniform1f(e,r.u_opacity),u_temporal_offset:new t.Uniform1f(e,r.u_temporal_offset)}}};function Jr(e,r,n,i,a,o,s){for(var u=e.context,l=u.gl,c=e.useProgram("collisionBox"),h=[],f=0,d=0,p=0;p<i.length;p++){var m=i[p],v=r.getTile(m),g=v.getBucket(n);if(g){var y=m.posMatrix;0===a[0]&&0===a[1]||(y=e.translatePosMatrix(m.posMatrix,v,a,o));var _=s?g.textCollisionBox:g.iconCollisionBox,b=g.collisionCircleArray;if(b.length>0){var x=t.create(),w=y;t.mul(x,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(x,x,g.placementViewportMatrix),h.push({circleArray:b,circleOffset:d,transform:w,invTransform:x}),d=f+=b.length/4}_&&c.draw(u,l.LINES,St.disabled,Tt.disabled,e.colorModeForRenderPass(),Ot.disabled,Ir(y,e.transform,v),n.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var M=e.useProgram("collisionCircle"),A=new t.StructArrayLayout2f1f2i16;A.resize(4*f),A._trim();for(var E=0,S=0,T=h;S<T.length;S+=1)for(var C=T[S],O=0;O<C.circleArray.length/4;O++){var P=4*O,L=C.circleArray[P+0],I=C.circleArray[P+1],k=C.circleArray[P+2],R=C.circleArray[P+3];A.emplace(E++,L,I,k,R,0),A.emplace(E++,L,I,k,R,1),A.emplace(E++,L,I,k,R,2),A.emplace(E++,L,I,k,R,3)}(!Wr||Wr.length<2*f)&&(Wr=function(e){var r=2*e,n=new t.StructArrayLayout3ui6;n.resize(r),n._trim();for(var i=0;i<r;i++){var a=6*i;n.uint16[a+0]=4*i+0,n.uint16[a+1]=4*i+1,n.uint16[a+2]=4*i+2,n.uint16[a+3]=4*i+2,n.uint16[a+4]=4*i+3,n.uint16[a+5]=4*i+0}return n}(f));for(var D=u.createIndexBuffer(Wr,!0),B=u.createVertexBuffer(A,t.collisionCircleLayout.members,!0),F=0,j=h;F<j.length;F+=1){var N=j[F],U=kr(N.transform,N.invTransform,e.transform);M.draw(u,l.TRIANGLES,St.disabled,Tt.disabled,e.colorModeForRenderPass(),Ot.disabled,U,n.id,B,D,t.SegmentVector.simpleSegment(0,2*N.circleOffset,N.circleArray.length,N.circleArray.length/2),null,e.transform.zoom,null,null,null)}B.destroy(),D.destroy()}}var Qr=t.identity(new Float32Array(16));function tn(e,r,n,i,a,o){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*r,l=-(s.verticalAlign-.5)*n,c=t.evaluateVariableOffset(e,i);return new t.Point((u/a+c[0])*o,(l/a+c[1])*o)}function en(e,r,n,i,a,o,s,u,l,c,h){var f=e.text.placedSymbolArray,d=e.text.dynamicLayoutVertexArray,p=e.icon.dynamicLayoutVertexArray,m={};d.clear();for(var v=0;v<f.length;v++){var g=f.get(v),y=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:i[g.crossTileID];if(y){var _=new t.Point(g.anchorX,g.anchorY),b=te(_,n?u:s),x=ee(o.cameraToCenterDistance,b.signedDistanceFromCamera),w=a.evaluateSizeForFeature(e.textSizeData,c,g)*x/t.ONE_EM;n&&(w*=e.tilePixelRatio/l);for(var M=tn(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),A=n?te(_.add(M),s).point:b.point.add(r?M.rotate(-o.angle):M),E=e.allowVerticalPlacement&&g.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,S=0;S<g.numGlyphs;S++)t.addDynamicAttributes(d,A,E);h&&g.associatedIconIndex>=0&&(m[g.associatedIconIndex]={shiftedAnchor:A,angle:E})}else ce(g.numGlyphs,d)}if(h){p.clear();for(var T=e.icon.placedSymbolArray,C=0;C<T.length;C++){var O=T.get(C);if(O.hidden)ce(O.numGlyphs,p);else{var P=m[C];if(P)for(var L=0;L<O.numGlyphs;L++)t.addDynamicAttributes(p,P.shiftedAnchor,P.angle);else ce(O.numGlyphs,p)}}e.icon.dynamicLayoutVertexBuffer.updateData(p)}e.text.dynamicLayoutVertexBuffer.updateData(d)}function rn(t,e,r){return r.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function nn(e,r,n,i,a,o,s,u,l,c,h,f){for(var d=e.context,p=d.gl,m=e.transform,v="map"===u,g="map"===l,y=v&&"point"!==n.layout.get("symbol-placement"),_=v&&!g&&!y,b=void 0!==n.layout.get("symbol-sort-key").constantOr(1),x=!1,w=e.depthModeForSublayer(0,St.ReadOnly),M=n.layout.get("text-variable-anchor"),A=[],E=0,S=i;E<S.length;E+=1){var T=S[E],C=r.getTile(T),O=C.getBucket(n);if(O){var P=a?O.text:O.icon;if(P&&P.segments.get().length){var L=P.programConfigurations.get(n.id),I=a||O.sdfIcons,k=a?O.textSizeData:O.iconSizeData,R=g||0!==m.pitch,D=e.useProgram(rn(I,a,O),L),B=t.evaluateSizeForZoom(k,m.zoom),F=void 0,j=[0,0],N=void 0,U=void 0,z=null,G=void 0;if(a)N=C.glyphAtlasTexture,U=p.LINEAR,F=C.glyphAtlasTexture.size,O.iconsInText&&(j=C.imageAtlasTexture.size,z=C.imageAtlasTexture,G=R||e.options.rotating||e.options.zooming||"composite"===k.kind||"camera"===k.kind?p.LINEAR:p.NEAREST);else{var V=1!==n.layout.get("icon-size").constantOr(0)||O.iconsNeedLinear;N=C.imageAtlasTexture,U=I||e.options.rotating||e.options.zooming||V||R?p.LINEAR:p.NEAREST,F=C.imageAtlasTexture.size}var H=de(C,1,e.transform.zoom),W=Jt(T.posMatrix,g,v,e.transform,H),$=Qt(T.posMatrix,g,v,e.transform,H),q=M&&O.hasTextData(),X="none"!==n.layout.get("icon-text-fit")&&q&&O.hasIconData();y&&ne(O,T.posMatrix,e,a,W,$,g,c);var K=e.translatePosMatrix(T.posMatrix,C,o,s),Z=y||a&&M||X?Qr:W,Y=e.translatePosMatrix($,C,o,s,!0),J=I&&0!==n.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),Q={program:D,buffers:P,uniformValues:I?O.iconsInText?Xr(k.kind,B,_,g,e,K,Z,Y,F,j):qr(k.kind,B,_,g,e,K,Z,Y,a,F,!0):$r(k.kind,B,_,g,e,K,Z,Y,a,F),atlasTexture:N,atlasTextureIcon:z,atlasInterpolation:U,atlasInterpolationIcon:G,isSDF:I,hasHalo:J};if(b&&O.canOverlap){x=!0;for(var tt=0,et=P.segments.get();tt<et.length;tt+=1){var rt=et[tt];A.push({segments:new t.SegmentVector([rt]),sortKey:rt.sortKey,state:Q})}}else A.push({segments:P.segments,sortKey:0,state:Q})}}}x&&A.sort((function(t,e){return t.sortKey-e.sortKey}));for(var nt=0,it=A;nt<it.length;nt+=1){var at=it[nt],ot=at.state;if(d.activeTexture.set(p.TEXTURE0),ot.atlasTexture.bind(ot.atlasInterpolation,p.CLAMP_TO_EDGE),ot.atlasTextureIcon&&(d.activeTexture.set(p.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,p.CLAMP_TO_EDGE)),ot.isSDF){var st=ot.uniformValues;ot.hasHalo&&(st.u_is_halo=1,an(ot.buffers,at.segments,n,e,ot.program,w,h,f,st)),st.u_is_halo=0}an(ot.buffers,at.segments,n,e,ot.program,w,h,f,ot.uniformValues)}}function an(t,e,r,n,i,a,o,s,u){var l=n.context;i.draw(l,l.gl.TRIANGLES,a,o,s,Ot.disabled,u,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function on(t,e,r,n,i,a,o){var s,u,l,c,h,f=t.context.gl,d=r.paint.get("fill-pattern"),p=d&&d.constantOr(1),m=r.getCrossfadeParameters();o?(u=p&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=f.LINES):(u=p?"fillPattern":"fill",s=f.TRIANGLES);for(var v=0,g=n;v<g.length;v+=1){var y=g[v],_=e.getTile(y);if(!p||_.patternsLoaded()){var b=_.getBucket(r);if(b){var x=b.programConfigurations.get(r.id),w=t.useProgram(u,x);p&&(t.context.activeTexture.set(f.TEXTURE0),_.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),x.updatePaintBuffers(m));var M=d.constantOr(null);if(M&&_.imageAtlas){var A=_.imageAtlas,E=A.patternPositions[M.to.toString()],S=A.patternPositions[M.from.toString()];E&&S&&x.setConstantPatternPositions(E,S)}var T=t.translatePosMatrix(y.posMatrix,_,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(o){c=b.indexBuffer2,h=b.segments2;var C=[f.drawingBufferWidth,f.drawingBufferHeight];l="fillOutlinePattern"===u&&p?Pr(T,t,m,_,C):Or(T,C)}else c=b.indexBuffer,h=b.segments,l=p?Cr(T,t,m,_):Tr(T);w.draw(t.context,s,i,t.stencilModeForClipping(y),a,Ot.disabled,l,r.id,b.layoutVertexBuffer,c,h,r.paint,t.transform.zoom,x)}}}}function sn(t,e,r,n,i,a,o){for(var s=t.context,u=s.gl,l=r.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=r.getCrossfadeParameters(),f=r.paint.get("fill-extrusion-opacity"),d=0,p=n;d<p.length;d+=1){var m=p[d],v=e.getTile(m),g=v.getBucket(r);if(g){var y=g.programConfigurations.get(r.id),_=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",y);c&&(t.context.activeTexture.set(u.TEXTURE0),v.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var b=l.constantOr(null);if(b&&v.imageAtlas){var x=v.imageAtlas,w=x.patternPositions[b.to.toString()],M=x.patternPositions[b.from.toString()];w&&M&&y.setConstantPatternPositions(w,M)}var A=t.translatePosMatrix(m.posMatrix,v,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),E=r.paint.get("fill-extrusion-vertical-gradient"),S=c?Sr(A,t,E,f,m,h,v):Er(A,t,E,f);_.draw(s,s.gl.TRIANGLES,i,a,o,Ot.backCCW,S,r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,y)}}}function un(e,r,n,i,a,o){var s=e.context,u=s.gl,l=r.fbo;if(l){var c=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,l.colorAttachment.get());var h=function(e,r,n){var i=n.paint.get("hillshade-shadow-color"),a=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,l,c,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(r.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=r.tileID,l=Math.pow(2,u.canonical.z),c=u.canonical.y,[new t.MercatorCoordinate(0,c/l).toLngLat().lat,new t.MercatorCoordinate(0,(c+1)/l).toLngLat().lat]),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:a,u_accent:o}}(e,r,n);c.draw(s,u.TRIANGLES,i,a,o,Ot.disabled,h,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function ln(e,r,n,i,a,o){var s=e.context,u=s.gl,l=r.dem;if(l&&l.data){var c=l.dim,h=l.stride,f=l.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(h),r.demTexture){var d=r.demTexture;d.update(f,{premultiply:!1}),d.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(s,f,u.RGBA,{premultiply:!1}),r.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var p=r.fbo;if(!p){var m=new t.Texture(s,{width:c,height:c,data:null},u.RGBA);m.bind(u.LINEAR,u.CLAMP_TO_EDGE),(p=r.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(m.texture)}s.bindFramebuffer.set(p.framebuffer),s.viewport.set([0,0,c,c]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,a,o,Ot.disabled,function(e,r){var n=r.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:e.overscaledZ,u_unpack:r.getUnpackVector()}}(r.tileID,l),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function cn(e,r,n,i,a){var o=i.paint.get("raster-fade-duration");if(o>0){var s=t.browser.now(),u=(s-e.timeAdded)/o,l=r?(s-r.timeAdded)/o:-1,c=n.getSource(),h=a.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),f=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),d=f&&e.refreshedUponExpiration?1:t.clamp(f?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var hn=new t.Color(1,0,0,1),fn=new t.Color(0,1,0,1),dn=new t.Color(0,0,1,1),pn=new t.Color(1,0,1,1),mn=new t.Color(0,1,1,1);function vn(t,e,r,n){yn(t,0,e+r/2,t.transform.width,r,n)}function gn(t,e,r,n){yn(t,e-r/2,0,r,t.transform.height,n)}function yn(e,r,n,i,a,o){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(r*t.browser.devicePixelRatio,n*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,a*t.browser.devicePixelRatio),s.clear({color:o}),u.disable(u.SCISSOR_TEST)}function _n(e,r,n){var i=e.context,a=i.gl,o=n.posMatrix,s=e.useProgram("debug"),u=St.disabled,l=Tt.disabled,c=e.colorModeForRenderPass();i.activeTexture.set(a.TEXTURE0),e.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(i,a.LINE_STRIP,u,l,c,Ot.disabled,Rr(o,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=r.getTileByID(n.key).latestRawTileData,f=Math.floor((h&&h.byteLength||0)/1024),d=r.getTile(n).tileSize,p=512/Math.min(d,512)*(n.overscaledZ/e.transform.zoom)*.5,m=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(m+=" => "+n.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var r=t.debugOverlayCanvas,n=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(r),t.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(e,m+" "+f+"kb"),s.draw(i,a.TRIANGLES,u,l,Ct.alphaBlended,Ot.disabled,Rr(o,t.Color.transparent,p),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var bn=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]).members;function xn(t,e,r,n){t.emplaceBack(e,r,n)}var wn=function(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,xn(this.vertexArray,-1,-1,1),xn(this.vertexArray,1,-1,1),xn(this.vertexArray,-1,1,1),xn(this.vertexArray,1,1,1),xn(this.vertexArray,-1,-1,-1),xn(this.vertexArray,1,-1,-1),xn(this.vertexArray,-1,1,-1),xn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,bn),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)},Mn={symbol:function(e,r,n,i,a){if("translucent"===e.renderPass){var o=Tt.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,r,n,i,a,o,s){for(var u=r.transform,l="map"===a,c="map"===o,h=0,f=e;h<f.length;h+=1){var d=f[h],p=i.getTile(d),m=p.getBucket(n);if(m&&m.text&&m.text.segments.get().length){var v=t.evaluateSizeForZoom(m.textSizeData,u.zoom),g=de(p,1,r.transform.zoom),y=Jt(d.posMatrix,c,l,r.transform,g),_="none"!==n.layout.get("icon-text-fit")&&m.hasIconData();if(v){var b=Math.pow(2,u.zoom-p.tileID.overscaledZ);en(m,l,c,s,t.symbolSize,u,y,d.posMatrix,b,v,_)}}}}(i,e,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),a),0!==n.paint.get("icon-opacity").constantOr(1)&&nn(e,r,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),o,s),0!==n.paint.get("text-opacity").constantOr(1)&&nn(e,r,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),o,s),r.map.showCollisionBoxes&&(Jr(e,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Jr(e,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))}},circle:function(e,r,n,i){if("translucent"===e.renderPass){var a=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),u=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,St.ReadOnly),f=Tt.disabled,d=e.colorModeForRenderPass(),p=[],m=0;m<i.length;m++){var v=i[m],g=r.getTile(v),y=g.getBucket(n);if(y){var _=y.programConfigurations.get(n.id),b={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:Lr(e,v,g,n)};if(u)for(var x=0,w=y.segments.get();x<w.length;x+=1){var M=w[x];p.push({segments:new t.SegmentVector([M]),sortKey:M.sortKey,state:b})}else p.push({segments:y.segments,sortKey:0,state:b})}}u&&p.sort((function(t,e){return t.sortKey-e.sortKey}));for(var A=0,E=p;A<E.length;A+=1){var S=E[A],T=S.state;T.program.draw(l,c.TRIANGLES,h,f,d,Ot.disabled,T.uniformValues,n.id,T.layoutVertexBuffer,T.indexBuffer,S.segments,n.paint,e.transform.zoom,T.programConfiguration)}}}},heatmap:function(e,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var a=e.context,o=a.gl,s=Tt.disabled,u=new Ct([o.ONE,o.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,r,n){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),n.colorAttachment.set(r)}(t,e,a,i)}}(a,e,n),a.clear({color:t.Color.transparent});for(var l=0;l<i.length;l++){var c=i[l];if(!r.hasRenderableParent(c)){var h=r.getTile(c),f=h.getBucket(n);if(f){var d=f.programConfigurations.get(n.id);e.useProgram("heatmap",d).draw(a,o.TRIANGLES,St.disabled,s,u,Ot.disabled,Br(c.posMatrix,h,e.transform.zoom,n.paint.get("heatmap-intensity")),n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,n.paint,e.transform.zoom,d)}}}a.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var n=e.context,i=n.gl,a=r.heatmapFbo;if(a){n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);var o=r.colorRampTexture;o||(o=r.colorRampTexture=new t.Texture(n,r.colorRamp,i.RGBA)),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,i.TRIANGLES,St.disabled,Tt.disabled,e.colorModeForRenderPass(),Ot.disabled,function(e,r,n,i){var a=t.create();t.ortho(a,0,e.width,e.height,0,0,1);var o=e.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:r.paint.get("heatmap-opacity")}}(e,r),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,n))},line:function(e,r,n,i){if("translucent"===e.renderPass){var a=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1))for(var s=e.depthModeForSublayer(0,St.ReadOnly),u=e.colorModeForRenderPass(),l=n.paint.get("line-dasharray"),c=n.paint.get("line-pattern"),h=c.constantOr(1),f=n.paint.get("line-gradient"),d=n.getCrossfadeParameters(),p=h?"linePattern":l?"lineSDF":f?"lineGradient":"line",m=e.context,v=m.gl,g=!0,y=0,_=i;y<_.length;y+=1){var b=_[y],x=r.getTile(b);if(!h||x.patternsLoaded()){var w=x.getBucket(n);if(w){var M=w.programConfigurations.get(n.id),A=e.context.program.get(),E=e.useProgram(p,M),S=g||E.program!==A,T=c.constantOr(null);if(T&&x.imageAtlas){var C=x.imageAtlas,O=C.patternPositions[T.to.toString()],P=C.patternPositions[T.from.toString()];O&&P&&M.setConstantPatternPositions(O,P)}var L=h?Nr(e,x,n,d):l?Ur(e,x,n,l,d):f?jr(e,x,n,w.lineClipsArray.length):Fr(e,x,n);if(h)m.activeTexture.set(v.TEXTURE0),x.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),M.updatePaintBuffers(d);else if(l&&(S||e.lineAtlas.dirty))m.activeTexture.set(v.TEXTURE0),e.lineAtlas.bind(m);else if(f){var I=w.gradients[n.id],k=I.texture;if(n.gradientVersion!==I.version){var R=256;if(n.stepInterpolant){var D=r.getSource().maxzoom,B=b.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-b.canonical.z):1;R=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*B),256,m.maxTextureSize)}I.gradient=t.renderColorRamp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:R,image:I.gradient||void 0,clips:w.lineClipsArray}),I.texture?I.texture.update(I.gradient):I.texture=new t.Texture(m,I.gradient,v.RGBA),I.version=n.gradientVersion,k=I.texture}m.activeTexture.set(v.TEXTURE0),k.bind(n.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}E.draw(m,v.TRIANGLES,s,e.stencilModeForClipping(b),u,Ot.disabled,L,n.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,n.paint,e.transform.zoom,M,w.layoutVertexBuffer2),g=!1}}}}},fill:function(e,r,n,i){var a=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=e.colorModeForRenderPass(),u=n.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===a.constantOr(t.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?St.ReadWrite:St.ReadOnly);on(e,r,n,i,c,s,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){var h=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,St.ReadOnly);on(e,r,n,i,h,s,!0)}}},"fill-extrusion":function(t,e,r,n){var i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var a=new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))sn(t,e,r,n,a,Tt.disabled,Ct.disabled),sn(t,e,r,n,a,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var o=t.colorModeForRenderPass();sn(t,e,r,n,a,Tt.disabled,o)}}},hillshade:function(t,e,r,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,a=t.depthModeForSublayer(0,St.ReadOnly),o=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(n):[{},n],u=s[0],l=0,c=s[1];l<c.length;l+=1){var h=c[l],f=e.getTile(h);f.needsHillshadePrepare&&"offscreen"===t.renderPass?ln(t,f,r,a,Tt.disabled,o):"translucent"===t.renderPass&&un(t,f,r,a,u[h.overscaledZ],o)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,n){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity")&&n.length)for(var i=t.context,a=i.gl,o=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),l=o instanceof k?[{},n]:t.stencilConfigForOverlap(n),c=l[0],h=l[1],f=h[h.length-1].overscaledZ,d=!t.options.moving,p=0,m=h;p<m.length;p+=1){var v=m[p],g=t.depthModeForSublayer(v.overscaledZ-f,1===r.paint.get("raster-opacity")?St.ReadWrite:St.ReadOnly,a.LESS),y=e.getTile(v),_=t.transform.calculatePosMatrix(v.toUnwrapped(),d);y.registerFadeDuration(r.paint.get("raster-fade-duration"));var b=e.findLoadedParent(v,0),x=cn(y,b,e,r,t.transform),w=void 0,M=void 0,A="nearest"===r.paint.get("raster-resampling")?a.NEAREST:a.LINEAR;i.activeTexture.set(a.TEXTURE0),y.texture.bind(A,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(a.TEXTURE1),b?(b.texture.bind(A,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,b.tileID.overscaledZ-y.tileID.overscaledZ),M=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(A,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);var E=Vr(_,M||[0,0],w||1,x,r);o instanceof k?s.draw(i,a.TRIANGLES,g,Tt.disabled,u,Ot.disabled,E,r.id,o.boundsBuffer,t.quadTriangleIndexBuffer,o.boundsSegments):s.draw(i,a.TRIANGLES,g,c[v.overscaledZ],u,Ot.disabled,E,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var n=r.paint.get("background-color"),i=r.paint.get("background-opacity");if(0!==i){var a=t.context,o=a.gl,s=t.transform,u=s.tileSize,l=r.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===n.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=Tt.disabled,f=t.depthModeForSublayer(0,"opaque"===c?St.ReadWrite:St.ReadOnly),d=t.colorModeForRenderPass(),p=t.useProgram(l?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:u});l&&(a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context));for(var v=r.getCrossfadeParameters(),g=0,y=m;g<y.length;g+=1){var _=y[g],b=t.transform.calculatePosMatrix(_.toUnwrapped()),x=l?Zr(b,i,t,l,{tileID:_,tileSize:u},v):Kr(b,i,n);p.draw(a,o.TRIANGLES,f,h,d,Ot.disabled,x,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},sky:function(e,r,n){var i=n.paint.get("sky-opacity");0!==i&&function(e,r,n,i,a){var o=e.context,s=o.gl,u=e.transform,l=e.useProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new wn(o)),o.activeTexture.set(s.TEXTURE0);var c=r.colorRampTexture;c||(c=r.colorRampTexture=new t.Texture(o,r.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);var h=function(e,r,n,i,a){return{u_matrix:e,u_color_ramp:0,u_center_direction:r,u_radius:t.degToRad(90),u_opacity:i,u_temporal_offset:a}}(u.skyboxMatrix,r.getCenter(e,!1),0,i,a);l.draw(o,s.TRIANGLES,n,Tt.disabled,e.colorModeForRenderPass(),Ot.backCW,h,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(e,n,new St(e.context.gl.LEQUAL,St.ReadOnly,[0,1]),i,e.frameCounter/1e3%1)},debug:function(t,e,r){for(var n=0;n<r.length;n++)_n(t,e,r[n])},custom:function(t,e,r){var n=t.context,i=r.implementation;if("offscreen"===t.renderPass){var a=i.prerender;a&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),a.call(i,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Tt.disabled);var o="3d"===i.renderingMode?new St(t.context.gl.LEQUAL,St.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,St.ReadOnly);n.setDepthMode(o),i.render(n.gl,t.transform.customLayerMatrix(),t.transform),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}},An=function(t,e){this.context=new Pt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=Lt.maxUnderzooming+Lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ne,this.gpuTimers={},this.frameCounter=0};An.prototype.resize=function(e,r){if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var n=0,i=this.style._order;n<i.length;n+=1)this.style._layers[i[n]].resize()},An.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,We.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,We.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,I.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(a,We.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(o);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Tt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},An.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=t.create();t.ortho(n,0,this.width,this.height,0,0,1),t.scale(n,n,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,St.disabled,this.stencilClearMode,Ct.disabled,Ot.disabled,Dr(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},An.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,n=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(Ct.disabled),r.setDepthMode(St.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var s=o[a],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(r,n.TRIANGLES,St.disabled,new Tt({func:n.ALWAYS,mask:0},u,255,n.KEEP,n.KEEP,n.REPLACE),Ct.disabled,Ot.disabled,Dr(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},An.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Tt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},An.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Tt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},An.prototype.stencilConfigForOverlap=function(t){var e,r=this.context.gl,n=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=n[n.length-1].overscaledZ,a=n[0].overscaledZ-i+1;if(a>1){this.currentStencilSource=void 0,this.nextStencilID+a>256&&this.clearStencil();for(var o={},s=0;s<a;s++)o[s+i]=new Tt({func:r.GEQUAL,mask:255},s+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=a,[o,n]}return[(e={},e[i]=Tt.disabled,e),n]},An.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new Ct([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?Ct.unblended:Ct.alphaBlended},An.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return St.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new St(r||this.context.gl.LEQUAL,e,[n,n])},An.prototype.depthModeForSublayerRewrite=function(t,e,r){return this.opaquePassEnabledForLayer()?new St(r||this.context.gl.LEQUAL,e,[0,1]):St.disabled},An.prototype.getDepthOffset=function(t){return-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon*10},An.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},An.prototype.render=function(e,r){var n=this;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,a=this.style.sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var u,l,c={},h={},f={};for(var d in a){var p=a[d];c[d]=p.getVisibleCoordinates(),h[d]=c[d].slice().reverse(),f[d]=p.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var m=0;m<i.length;m++)if(this.style._layers[i[m]].is3D()){this.opaquePassCutoff=m;break}this.renderPass="offscreen";for(var v=0,g=i;v<g.length;v+=1){var y=this.style._layers[g[v]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var _=h[y.source];("custom"===y.type&&!y.isSky()||_&&_.length)&&this.renderLayer(this,a[y.source],y,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var b=this.style._layers[i[this.currentLayer]],x=a[b.source];if(!b.isSky()){var w=c[b.source];this._renderTileClippingMasks(b,w),this.renderLayer(this,x,b,w)}}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var M=this.style._layers[i[this.currentLayer]],A=a[M.source];M.isSky()&&this.renderLayer(this,A,M,A?h[A.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0,this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var E=this.style._layers[i[this.currentLayer]],S=a[E.source];if(!E.isSky()){var T=("symbol"===E.type?f:h)[E.source];this._renderTileClippingMasks(E,c[E.source]),"custom"===E.type&&this.clearStencil(),this.renderLayer(this,S,E,T)}}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(n.transform.zoom)&&(t.source!==(l&&l.id)&&(l=n.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<l.getSource().maxzoom)&&(u=l))})),u&&Mn.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;vn(t,t.transform.height-(e.top||0),3,hn),vn(t,e.bottom||0,3,fn),gn(t,e.left||0,3,dn),gn(t,t.transform.width-(e.right||0),3,pn);var r=t.transform.centerPoint;!function(t,e,r,n){yn(t,e-1,r-10,2,20,n),yn(t,e-10,r-1,20,2,n)}(t,r.x,t.transform.height-r.y,mn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%t.MAX_SAFE_INTEGER},An.prototype.renderLayer=function(t,e,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),Mn[r.type](t,e,r,n,this.style.placement.variableOffsets),this.gpuTimingEnd())},An.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,r=this.gpuTimers[t.id];r||(r=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),r.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,r.query)}},An.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},An.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},An.prototype.queryGpuTimers=function(t){var e={};for(var r in t){var n=t[r],i=this.context.extTimerQuery,a=i.getQueryObjectEXT(n.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(n.query),e[r]=a}return e},An.prototype.translatePosMatrix=function(e,r,n,i,a){if(!n[0]&&!n[1])return e;var o=a?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){var s=Math.sin(o),u=Math.cos(o);n=[n[0]*u-n[1]*s,n[0]*s+n[1]*u]}var l=[a?n[0]:de(r,n[0],this.transform.zoom),a?n[1]:de(r,n[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},An.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},An.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},An.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r},An.prototype.useProgram=function(t,e){this.cache=this.cache||{};var r=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new Mr(this.context,t,br[t],e,Yr[t],this._showOverdrawInspector)),this.cache[r]},An.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},An.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},An.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},An.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var En=function(t,e){this.pos=t,this.dir=e};En.prototype.intersectsPlane=function(e,r,n){var i=t.dot(r,this.dir);if(Math.abs(i)<1e-6)return!1;var a=t.dot(t.sub(t.create$2(),e,this.pos),r)/i,o=t.scaleAndAdd(t.create$2(),this.pos,this.dir,a);return t.copy(n,o),!0};var Sn=function(t,e){this.points=t,this.planes=e};Sn.fromInvProjectionMatrix=function(e,r,n){var i=Math.pow(2,n),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(r){return t.transformMat4([],r,e)})).map((function(e){return t.scale$1([],e,1/e[3]/r*i)})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var r=t.sub([],a[e[0]],a[e[1]]),n=t.sub([],a[e[2]],a[e[1]]),i=t.normalize([],t.cross([],r,n)),o=-t.dot(i,a[e[1]]);return i.concat(o)}));return new Sn(a,o)};var Tn=function(e,r){this.min=e,this.max=r,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};Tn.prototype.quadrant=function(e){for(var r=[e%2==0,e<2],n=t.clone$2(this.min),i=t.clone$2(this.max),a=0;a<r.length;a++)n[a]=r[a]?this.min[a]:this.center[a],i[a]=r[a]?this.center[a]:this.max[a];return i[2]=this.max[2],new Tn(n,i)},Tn.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},Tn.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},Tn.prototype.intersects=function(e){for(var r=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],n=!0,i=0;i<e.planes.length;i++){for(var a=e.planes[i],o=0,s=0;s<r.length;s++)o+=t.dot$1(a,r[s])>=0;if(0===o)return 0;o!==r.length&&(n=!1)}if(n)return 2;for(var u=0;u<3;u++){for(var l=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var f=e.points[h][u]-this.min[u];l=Math.min(l,f),c=Math.max(c,f)}if(c<0||l>this.max[u]-this.min[u])return 0}return 1};var Cn=function(t,e,r,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=r,this.right=n};function On(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Pn(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]}function Ln(e,r){var n=On(e,3);t.fromQuat(e,r),Pn(e,3,n)}function In(t,e){Pn(t,3,[e[0],e[1],e[2],1])}function kn(e,r){var n=t.identity$1([]);return t.rotateZ$1(n,n,-r),t.rotateX(n,n,-e),n}function Rn(e,r){var n=[e[0],e[1],0],i=[r[0],r[1],0];if(t.length(n)>=1e-15){var a=t.normalize([],n);t.scale$2(i,a,t.dot(i,a)),r[0]=i[0],r[1]=i[1]}var o=t.cross([],r,e);if(t.len(o)<1e-15)return null;var s=Math.atan2(-o[1],o[0]);return kn(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}Cn.prototype.interpolate=function(e,r,n){return null!=r.top&&null!=e.top&&(this.top=t.number(e.top,r.top,n)),null!=r.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,r.bottom,n)),null!=r.left&&null!=e.left&&(this.left=t.number(e.left,r.left,n)),null!=r.right&&null!=e.right&&(this.right=t.number(e.right,r.right,n)),this},Cn.prototype.getCenter=function(e,r){var n=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+r-this.bottom)/2,0,r);return new t.Point(n,i)},Cn.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},Cn.prototype.clone=function(){return new Cn(this.top,this.bottom,this.left,this.right)},Cn.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Dn=function(t,e){this.position=t,this.orientation=e};Dn.prototype.lookAtPoint=function(e,r){if(this.orientation=null,this.position){var n=this.position,i=t.MercatorCoordinate.fromLngLat(e),a=[i.x-n.x,i.y-n.y,i.z-n.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Rn(a,r)}},Dn.prototype.setPitchBearing=function(e,r){this.orientation=kn(t.degToRad(e),t.degToRad(-r))};var Bn=function(t,e,r){this.position=t,this.pitch=e,this.bearing=r},Fn=function(e,r){this._transform=t.identity([]),this._orientation=t.identity$1([]),r&&(this._orientation=r,Ln(this._transform,this._orientation)),e&&In(this._transform,e)},jn={position:{configurable:!0},orientation:{configurable:!0}};jn.position.get=function(){var t=On(this._transform,3);return[t[0],t[1],t[2]]},jn.position.set=function(t){In(this._transform,t)},jn.orientation.get=function(){return this._orientation},jn.orientation.set=function(t){this._orientation=t,Ln(this._transform,this._orientation)},Fn.prototype.getPitchBearing=function(){var t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}},Fn.prototype.setPitchBearing=function(t,e){this._orientation=kn(t,e),Ln(this._transform,this._orientation)},Fn.prototype.forward=function(){var t=On(this._transform,2);return[-t[0],-t[1],-t[2]]},Fn.prototype.up=function(){var t=On(this._transform,1);return[-t[0],-t[1],-t[2]]},Fn.prototype.right=function(){var t=On(this._transform,0);return[t[0],t[1],t[2]]},Fn.prototype.getCameraToWorld=function(e,r){var n=new Float64Array(16);return t.invert(n,this.getWorldToCamera(e,r)),n},Fn.prototype.getWorldToCamera=function(e,r){var n=new Float64Array(16),i=new Float64Array(4),a=this.position;return t.conjugate(i,this._orientation),t.scale$2(a,a,-e),t.fromQuat(n,i),t.translate(n,n,a),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r,n},Fn.prototype.getCameraToClipPerspective=function(e,r,n,i){var a=new Float64Array(16);return t.perspective(a,e,r,n,i),a},Fn.prototype.clone=function(){return new Fn([].concat(this.position),[].concat(this.orientation))},Object.defineProperties(Fn.prototype,jn);var Nn=function(e,r,n,i,a){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===a||a,this._minZoom=e||0,this._maxZoom=r||22,this._minPitch=null==n?0:n,this._maxPitch=null==i?85:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Cn,this._posMatrixCache={},this._alignedPosMatrixCache={},this._camera=new Fn,this._centerAltitude=0,this._horizonShift=.1},Un={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Nn.prototype.clone=function(){var t=new Nn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t},Un.minZoom.get=function(){return this._minZoom},Un.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Un.maxZoom.get=function(){return this._maxZoom},Un.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Un.minPitch.get=function(){return this._minPitch},Un.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Un.maxPitch.get=function(){return this._maxPitch},Un.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Un.renderWorldCopies.get=function(){return this._renderWorldCopies},Un.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Un.worldSize.get=function(){return this.tileSize*this.scale},Un.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Un.size.get=function(){return new t.Point(this.width,this.height)},Un.bearing.get=function(){return 180*-this.angle/Math.PI},Un.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$3(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Un.pitch.get=function(){return 180*this._pitch/Math.PI},Un.pitch.set=function(e){var r=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},Un.fov.get=function(){return this._fov/Math.PI*180},Un.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Un.zoom.get=function(){return this._zoom},Un.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Un.center.get=function(){return this._center},Un.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Un.padding.get=function(){return this._edgeInsets.toJSON()},Un.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Nn.prototype.setFreeCameraOptions=function(e){if(this.height&&(e.position||e.orientation)){this._updateCameraState();var r=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(e.orientation)),e.position){var n=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this._calcMatrices())}},Nn.prototype.setCameraParameter=function(e){if(this.height&&(e.position||e.pitch||e.bearing)){this._updateCameraState();var r=!1;if(void 0!==e.pitch&&(this._setCameraPitch(e.pitch),r=!0),void 0!==e.bearing&&(this._setCameraBearing(e.bearing),r=!0),e.position){var n=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this._calcMatrices())}},Nn.prototype.getFreeCameraOptions=function(){this._updateCameraState();var e=this._camera.position,r=new Dn;return r.position=new t.MercatorCoordinate(e[0],e[1],e[2]),r.orientation=this._camera.orientation,r},Nn.prototype.getCameraParameter=function(){this._updateCameraState();var e=this._camera.position,r=new Bn;return r.position=new t.MercatorCoordinate(e[0],e[1],e[2]),r.pitch=this.pitch,r.bearing=-0===this.bearing?0:this.bearing,r},Nn.prototype._setCameraOrientation=function(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);var r=t.transformQuat([],[0,0,-1],e),n=t.transformQuat([],[0,-1,0],e);if(n[2]<0)return!1;var i=Rn(r,n);return!!i&&(this._camera.orientation=i,!0)},Nn.prototype._setCameraPosition=function(e){var r=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance,a=this._camera.forward();e[2]=t.clamp(e[2],-a[2]*i/n,-a[2]*i/r),this._camera.position=e},Nn.prototype._setCameraPitch=function(e){var r=this._camera.getPitchBearing().bearing;this._camera.setPitchBearing(t.degToRad(e),r)},Nn.prototype._setCameraBearing=function(e){var r=this._camera.getPitchBearing();this._camera.setPitchBearing(r.pitch,t.degToRad(-e))},Un.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Nn.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Nn.prototype.interpolatePadding=function(t,e,r){this._unmodified=!1,this._edgeInsets.interpolate(t,e,r),this._constrain(),this._calcMatrices()},Nn.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Nn.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),a=this.pointCoordinate(new t.Point(this.width,this.height)),o=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(n.x,i.x,a.x,o.x)),u=Math.floor(Math.max(n.x,i.x,a.x,o.x)),l=s-1;l<=u+1;l++)0!==l&&r.push(new t.UnwrappedTileID(l,e));return r},Nn.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),n=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),a=Math.pow(2,r),o=[a*i.x,a*i.y,0],s=Sn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r),u=this.pointCoordinate(this.getCameraPoint()),l=a*t.mercatorZfromAltitude(1,this.center.lat),c=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),h=[a*u.x,a*u.y,c],f=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),d=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(d=r);var p=function(t){return{aabb:new Tn([t*a,0,0],[(t+1)*a,a,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},m=[],v=[],g=r,y=e.reparseOverscaled?n:r,_=function(t){return t*t},b=_((c-this._centerAltitude)*l),x=function(t){if(t.zoom<d)return!0;if(t.zoom===g)return!1;if(null!=t.shouldSplit)return t.shouldSplit;var e=t.aabb.distanceX(h),r=t.aabb.distanceY(h),n=e*e+r*r+b;return n<_((1<<g-t.zoom)*f*1*function(t,e){if(e*_(.707)<t)return 1;var r=Math.sqrt(e/t);return r/(1/.707+(Math.pow(1.1,r-1/.707+1)-1)/(1.1-1)-1)}(Math.max(b,b),n))};if(this._renderWorldCopies)for(var w=1;w<=3;w++)m.push(p(-w)),m.push(p(w));for(m.push(p(0));m.length>0;){var M=m.pop(),A=M.x,E=M.y,S=M.fullyVisible;if(!S){var T=M.aabb.intersects(s);if(0===T)continue;S=2===T}if(M.zoom!==g&&x(M))for(var C=0;C<4;C++){var O=(A<<1)+C%2,P=(E<<1)+(C>>1);m.push({aabb:M.aabb.quadrant(C),zoom:M.zoom+1,x:O,y:P,wrap:M.wrap,fullyVisible:S,tileID:void 0,shouldSplit:void 0})}else{var L=M.zoom===g?y:M.zoom;if(e.minzoom&&e.minzoom>L)continue;var I=o[0]-(.5+A+(M.wrap<<M.zoom))*(1<<r-M.zoom),k=o[1]-.5-E,R=M.tileID?M.tileID:new t.OverscaledTileID(L,M.wrap,M.zoom,A,E);v.push({tileID:R,distanceSq:I*I+k*k})}}return v.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Nn.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Un.unmodified.get=function(){return this._unmodified},Nn.prototype.zoomScale=function(t){return Math.pow(2,t)},Nn.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Nn.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},Nn.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Un.point.get=function(){return this.project(this.center)},Nn.prototype.setLocationAtPoint=function(e,r){var n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(e),o=new t.MercatorCoordinate(a.x-(n.x-i.x),a.y-(n.y-i.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())},Nn.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Nn.prototype.locationPoint3D=function(t){return this._coordinatePoint(this.locationCoordinate(t),!0)},Nn.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Nn.prototype.pointLocation3D=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Nn.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Nn.prototype.coordinateLocation=function(t){return t.toLngLat()},Nn.prototype.pointRayIntersection=function(e,r){var n=null!=r?r:this._centerAltitude,i=[e.x,e.y,0,1],a=[e.x,e.y,1,1];t.transformMat4(i,i,this.pixelMatrixInverse),t.transformMat4(a,a,this.pixelMatrixInverse);var o=a[3];t.scale$1(i,i,1/i[3]),t.scale$1(a,a,1/o);var s=i[2],u=a[2];return{p0:i,p1:a,t:s===u?0:(n-s)/(u-s)}},Nn.prototype.screenPointToMercatorRay=function(e){var r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];return t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse),t.scale$1(r,r,1/r[3]),t.scale$1(n,n,1/n[3]),r[2]=t.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,t.scale$1(r,r,1/this.worldSize),t.scale$1(n,n,1/this.worldSize),new En([r[0],r[1],r[2]],t.normalize([],t.sub([],n,r)))},Nn.prototype.rayIntersectionCoordinate=function(e){var r=e.p0,n=e.p1,i=e.t,a=t.mercatorZfromAltitude(r[2],this._center.lat),o=t.mercatorZfromAltitude(n[2],this._center.lat);return new t.MercatorCoordinate(t.number(r[0],n[0],i)/this.worldSize,t.number(r[1],n[1],i)/this.worldSize,t.number(a,o,i))},Nn.prototype.pointCoordinate=function(e,r){void 0===r&&(r=this._centerAltitude);var n=this.horizonLineFromTop(!1),i=new t.Point(e.x,Math.max(n,e.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(i,r))},Nn.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},Nn.prototype.getBounds=function(){return this._getBounds(0,0)},Nn.prototype._coordinatePoint=function(e,r){var n=[e.x*this.worldSize,e.y*this.worldSize,this._centerAltitude+e.toAltitude(),1];return t.transformMat4(n,n,this.pixelMatrix),n[3]>0?new t.Point(n[0]/n[3],n[1]/n[3]):new t.Point(Number.MAX_VALUE,Number.MAX_VALUE)},Nn.prototype._getBounds=function(e,r){var n=new t.Point(this._edgeInsets.left,this._edgeInsets.top),i=new t.Point(this.width-this._edgeInsets.right,this._edgeInsets.top),a=new t.Point(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),o=new t.Point(this._edgeInsets.left,this.height-this._edgeInsets.bottom),s=this.pointCoordinate(n,e),u=this.pointCoordinate(i,e),l=this.pointCoordinate(a,r),c=this.pointCoordinate(o,r),h=function(t,e){return(e.y-t.y)/(e.x-t.x)};return s.y>1&&u.y>=0?s=new t.MercatorCoordinate((1-c.y)/h(c,s)+c.x,1):s.y<0&&u.y<=1&&(s=new t.MercatorCoordinate(-c.y/h(c,s)+c.x,0)),u.y>1&&s.y>=0?u=new t.MercatorCoordinate((1-l.y)/h(l,u)+l.x,1):u.y<0&&s.y<=1&&(u=new t.MercatorCoordinate(-l.y/h(l,u)+l.x,0)),(new t.LngLatBounds).extend(this.coordinateLocation(s)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(c)).extend(this.coordinateLocation(l))},Nn.prototype.horizonLineFromTop=function(t){void 0===t&&(t=!0);var e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,r=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,r):r},Nn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Nn.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Nn.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var n=e.key,i=r?this._alignedPosMatrixCache:this._posMatrixCache;if(i[n])return i[n];var a=e.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*o,a.y*o,0]),t.scale(u,u,[o/t.EXTENT,o/t.EXTENT,1]),t.multiply(u,r?this.alignedProjMatrix:this.projMatrix,u),i[n]=new Float32Array(u),i[n]},Nn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Nn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,n,i,a=-90,o=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;a=t.mercatorYfromLat(h[1])*this.worldSize,e=(o=t.mercatorYfromLat(h[0])*this.worldSize)-a<l.y?l.y/(o-a):0}if(this.lngRange){var f=this.lngRange;s=t.mercatorXfromLng(f[0])*this.worldSize,r=(u=t.mercatorXfromLng(f[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var d=this.point,p=Math.max(r||0,e||0);if(p)return this.center=this.unproject(new t.Point(r?(u+s)/2:d.x,e?(o+a)/2:d.y)),this.zoom+=this.scaleZoom(p),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=d.y,v=l.y/2;m-v<a&&(i=a+v),m+v>o&&(i=o-v)}if(this.lngRange){var g=d.x,y=l.x/2;g-y<s&&(n=s+y),g+y>u&&(n=u-y)}void 0===n&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==n?n:d.x,void 0!==i?i:d.y))),this._unmodified=c,this._constraining=!1}},Nn.prototype._minZoomForBounds=function(){var e=this,r=function(t,r){return Math.log2(t/(e.tileSize*Math.abs(r[1]-r[0])))},n=0;if(this.latRange){var i=this.latRange;n=r(this.height,[t.mercatorYfromLat(i[0]),t.mercatorYfromLat(i[1])])}var a=0;if(this.lngRange){var o=this.lngRange;a=r(this.width,[t.mercatorXfromLng(o[0]),t.mercatorXfromLng(o[1])])}return Math.max(n,a)},Nn.prototype._maxCameraBoundsDistance=function(){return this._mercatorZfromZoom(this._minZoomForBounds())},Nn.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var r=t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;this._updateCameraState();var n=Math.PI/2+this._pitch,i=this._fov*(.5+e.y/this.height),a=this._camera.position[2]*this.worldSize/Math.cos(this._pitch),o=Math.sin(i)*a/Math.sin(t.clamp(Math.PI-n-i,.01,Math.PI-.01)),s=this.point,u=s.x,l=s.y,c=Math.cos(Math.PI/2-this._pitch)*o+a;this.farZ=Math.min(1.01*c,a*(1/this._horizonShift)),this.nearZ=this.height/50;var h=this._camera.getWorldToCamera(this.worldSize,r),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this.nearZ,this.farZ);f[8]=2*-e.x/this.width,f[9]=2*e.y/this.height;var d=t.mul([],f,h);this.mercatorMatrix=t.scale([],d,[this.worldSize,this.worldSize,this.worldSize/r]),this.projMatrix=d,this.invProjMatrix=t.invert([],this.projMatrix);var p=new Float32Array(16);t.identity(p),t.scale(p,p,[1,-1,1]),t.rotateX$1(p,p,this._pitch),t.rotateZ(p,p,this.angle);var m=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this.nearZ,this.farZ),v=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;m[8]=2*-e.x/this.width,m[9]=2*(e.y+v)/this.height,this.skyboxMatrix=t.multiply(p,m,p);var g=this.width%2/2,y=this.height%2/2,_=Math.cos(this.angle),b=Math.sin(this.angle),x=u-Math.round(u)+_*g+b*y,w=l-Math.round(l)+_*y+b*g,M=new Float64Array(d);if(t.translate(M,M,[x>.5?x-1:x,w>.5?w-1:w,0]),this.alignedProjMatrix=M,d=t.create(),t.scale(d,d,[this.width/2,-this.height/2,1]),t.translate(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=t.create(),t.scale(d,d,[1,-1,1]),t.translate(d,d,[-1,-1,0]),t.scale(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(d=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Nn.prototype._updateCameraState=function(){if(this.height){this._camera.setPitchBearing(this._pitch,this.angle);var t=this._camera.forward(),e=this.cameraToCenterDistance,r=this.point;this._camera.position=[(r.x-t[0]*e)/this.worldSize,(r.y-t[1]*e)/this.worldSize,-t[2]*e/this.worldSize]}},Nn.prototype._translateCameraConstrained=function(e){var r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=e[2],i=1;n>0&&(i=Math.min((r-this._camera.position[2])/n,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera()},Nn.prototype._updateStateFromCamera=function(){var e=this._camera.position,r=this._camera.forward(),n=this._camera.getPitchBearing(),i=n.pitch,a=n.bearing,o=Math.log2(this.cameraToCenterDistance/(e[2]/Math.cos(i)*this.tileSize));t.scaleAndAdd(e,e,r,-e[2]/r[2]),this.pitch=t.radToDeg(i),this.bearing=t.radToDeg(-a),this.zoom=o,this.center=new t.MercatorCoordinate(e[0],e[1],e[2]).toLngLat()},Nn.prototype._worldSizeFromZoom=function(t){return Math.pow(2,t)*this.tileSize},Nn.prototype._mercatorZfromZoom=function(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)},Nn.prototype._zoomFromMercatorZ=function(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))},Nn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},Nn.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Nn.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var n=r.x,i=r.y,a=r.x,o=r.y,s=0,u=e;s<u.length;s+=1){var l=u[s];n=Math.min(n,l.x),i=Math.min(i,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}return[new t.Point(n,i),new t.Point(a,i),new t.Point(a,o),new t.Point(n,o),new t.Point(n,i)]},Nn.prototype.anyCornerOffEdge=function(e,r){var n=Math.min(e.x,r.x),i=Math.max(e.x,r.x),a=Math.min(e.y,r.y),o=Math.max(e.y,r.y);if(a<this.horizonLineFromTop(!1))return!0;for(var s=[new t.Point(n,a),new t.Point(i,o),new t.Point(n,o),new t.Point(i,a)],u=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1,c=0,h=s;c<h.length;c+=1){var f=this.pointRayIntersection(h[c]);if(f.t<0)return!0;var d=this.rayIntersectionCoordinate(f);if(d.x<u||d.y<0||d.x>l||d.y>1)return!0}return!1},Nn.prototype.isHorizonVisible=function(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.Point(0,0),new t.Point(this.width,this.height))},Nn.prototype.zoomDeltaToMovement=function(e,r){var n=t.length(t.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(n)+r;return n-this._mercatorZfromZoom(i)},Object.defineProperties(Nn.prototype,Un);var zn=function(e){var r,n,i,a;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(r=this._updateHashUnthrottled.bind(this),n=!1,i=null,a=function(){i=null,n&&(r(),i=setTimeout(a,300),n=!1)},function(){return n=!0,i||a(),i})};zn.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},zn.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},zn.prototype.getHashString=function(e){var r=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,i),o=Math.round(r.lng*a)/a,s=Math.round(r.lat*a)/a,u=this._map.getBearing(),l=this._map.getPitch(),c="";if(c+=e?"/"+o+"/"+s+"/"+n:n+"/"+s+"/"+o,(u||l)&&(c+="/"+Math.round(10*u)/10),l&&(c+="/"+Math.round(l)),this._hashName){var h=this._hashName,f=!1,d=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(f=!0,e+"="+c):t})).filter((function(t){return t}));return f||d.push(h+"="+c),"#"+d.join("&")}return"#"+c},zn.prototype._getCurrentHash=function(){var e,r=this,n=t.window.location.hash.replace("#","");return this._hashName?(n.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===r._hashName&&(e=t)})),(e&&e[1]||"").split("/")):n.split("/")},zn.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},zn.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Gn={linearity:.3,easing:t.bezier(0,0,.3,1)},Vn=t.extend({deceleration:2500,maxSpeed:1400},Gn),Hn=t.extend({deceleration:20,maxSpeed:1400},Gn),Wn=t.extend({deceleration:1e3,maxSpeed:360},Gn),$n=t.extend({deceleration:1e3,maxSpeed:90},Gn),qn=function(t){this._map=t,this.clear()};function Xn(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Kn(e,r,n){var i=n.maxSpeed,a=n.linearity,o=n.deceleration,s=t.clamp(e*a/(r/1e3),-i,i),u=Math.abs(s)/(o*a);return{easing:n.easing,duration:1e3*u,amount:s*(u/2)}}qn.prototype.clear=function(){this._inertiaBuffer=[]},qn.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},qn.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,r=t.browser.now();e.length>0&&r-e[0].time>160;)e.shift()},qn.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var r={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},n=0,i=this._inertiaBuffer;n<i.length;n+=1){var a=i[n].settings;r.zoom+=a.zoomDelta||0,r.bearing+=a.bearingDelta||0,r.pitch+=a.pitchDelta||0,a.panDelta&&r.pan._add(a.panDelta),a.around&&(r.around=a.around),a.pinchAround&&(r.pinchAround=a.pinchAround)}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(r.pan.mag()){var u=Kn(r.pan.mag(),o,t.extend({},Vn,e||{}));s.offset=r.pan.mult(u.amount/r.pan.mag()),s.center=this._map.transform.center,Xn(s,u)}if(r.zoom){var l=Kn(r.zoom,o,Hn);s.zoom=this._map.transform.zoom+l.amount,Xn(s,l)}if(r.bearing){var c=Kn(r.bearing,o,Wn);s.bearing=this._map.transform.bearing+t.clamp(c.amount,-179,179),Xn(s,c)}if(r.pitch){var h=Kn(r.pitch,o,$n);s.pitch=this._map.transform.pitch+h.amount,Xn(s,h)}if(s.zoom||s.bearing){var f=void 0===r.pinchAround?r.around:r.pinchAround;s.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Zn=function(e){function n(n,i,a,o){void 0===o&&(o={});var s=r.mousePos(i.getCanvasContainer(),a),u=i.unproject(s);if(P.projection){var l=t.convertCoor_(u,P.projection);e.call(this,n,t.extend({point:s,lngLat:u,coordinate:l,originalEvent:a},o))}else e.call(this,n,t.extend({point:s,lngLat:u,originalEvent:a},o));this._defaultPrevented=!1,this.target=i}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),Yn=function(e){function n(n,i,a){var o="touchend"===n?a.changedTouches:a.touches,s=r.touchPos(i.getCanvasContainer(),o),u=s.map((function(t){return i.unproject(t)})),l=s.reduce((function(t,e,r,n){return t.add(e.div(n.length))}),new t.Point(0,0)),c=i.unproject(l);e.call(this,n,{points:s,point:l,lngLats:u,lngLat:c,originalEvent:a}),this._defaultPrevented=!1}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),Jn=function(t){function e(e,r,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),Qn=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Qn.prototype.reset=function(){delete this._mousedownPos},Qn.prototype.wheel=function(t){return this._firePreventable(new Jn(t.type,this._map,t))},Qn.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Zn(t.type,this._map,t))},Qn.prototype.mouseup=function(t){this._map.fire(new Zn(t.type,this._map,t))},Qn.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Zn(t.type,this._map,t))},Qn.prototype.dblclick=function(t){return this._firePreventable(new Zn(t.type,this._map,t))},Qn.prototype.mouseover=function(t){this._map.fire(new Zn(t.type,this._map,t))},Qn.prototype.mouseout=function(t){this._map.fire(new Zn(t.type,this._map,t))},Qn.prototype.touchstart=function(t){return this._firePreventable(new Yn(t.type,this._map,t))},Qn.prototype.touchmove=function(t){this._map.fire(new Yn(t.type,this._map,t))},Qn.prototype.touchend=function(t){this._map.fire(new Yn(t.type,this._map,t))},Qn.prototype.touchcancel=function(t){this._map.fire(new Yn(t.type,this._map,t))},Qn.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Qn.prototype.isEnabled=function(){return!0},Qn.prototype.isActive=function(){return!1},Qn.prototype.enable=function(){},Qn.prototype.disable=function(){};var ti=function(t){this._map=t};ti.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ti.prototype.mousemove=function(t){this._map.fire(new Zn(t.type,this._map,t))},ti.prototype.mousedown=function(){this._delayContextMenu=!0},ti.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ti.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Zn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},ti.prototype.isEnabled=function(){return!0},ti.prototype.isActive=function(){return!1},ti.prototype.enable=function(){},ti.prototype.disable=function(){};var ei=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function ri(t,e){for(var r={},n=0;n<t.length;n++)r[t[n].identifier]=e[n];return r}ei.prototype.isEnabled=function(){return!!this._enabled},ei.prototype.isActive=function(){return!!this._active},ei.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ei.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ei.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(r.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},ei.prototype.mousemoveWindow=function(t,e){if(this._active){var n=e;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=n,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var a=Math.min(i.x,n.x),o=Math.max(i.x,n.x),s=Math.min(i.y,n.y),u=Math.max(i.y,n.y);r.setTransform(this._box,"translate("+a+"px,"+s+"px)"),this._box.style.width=o-a+"px",this._box.style.height=u-s+"px"}}},ei.prototype.mouseupWindow=function(e,n){var i=this;if(this._active&&0===e.button){var a=this._startPos,o=n;if(this.reset(),r.suppressClick(),a.x!==o.x||a.y!==o.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(a,o,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},ei.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},ei.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},ei.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var ni=function(t){this.reset(),this.numTouches=t.numTouches};ni.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ni.prototype.touchstart=function(e,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){for(var r=new t.Point(0,0),n=0,i=e;n<i.length;n+=1)r._add(i[n]);return r.div(e.length)}(r),this.touches=ri(n,r)))},ni.prototype.touchmove=function(t,e,r){if(!this.aborted&&this.centroid){var n=ri(r,e);for(var i in this.touches){var a=n[i];(!a||a.dist(this.touches[i])>30)&&(this.aborted=!0)}}},ni.prototype.touchend=function(t,e,r){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){var n=!this.aborted&&this.centroid;if(this.reset(),n)return n}};var ii=function(t){this.singleTap=new ni(t),this.numTaps=t.numTaps,this.reset()};ii.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ii.prototype.touchstart=function(t,e,r){this.singleTap.touchstart(t,e,r)},ii.prototype.touchmove=function(t,e,r){this.singleTap.touchmove(t,e,r)},ii.prototype.touchend=function(t,e,r){var n=this.singleTap.touchend(t,e,r);if(n){var i=t.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(n)<30;if(i&&a||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}};var ai=function(){this._zoomIn=new ii({numTouches:1,numTaps:2}),this._zoomOut=new ii({numTouches:2,numTaps:1}),this.reset()};ai.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ai.prototype.touchstart=function(t,e,r){this._zoomIn.touchstart(t,e,r),this._zoomOut.touchstart(t,e,r)},ai.prototype.touchmove=function(t,e,r){this._zoomIn.touchmove(t,e,r),this._zoomOut.touchmove(t,e,r)},ai.prototype.touchend=function(t,e,r){var n=this,i=this._zoomIn.touchend(t,e,r),a=this._zoomOut.touchend(t,e,r);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):a?(this._active=!0,t.preventDefault(),setTimeout((function(){return n.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(a)},{originalEvent:t})}}):void 0},ai.prototype.touchcancel=function(){this.reset()},ai.prototype.enable=function(){this._enabled=!0},ai.prototype.disable=function(){this._enabled=!1,this.reset()},ai.prototype.isEnabled=function(){return this._enabled},ai.prototype.isActive=function(){return this._active};var oi={0:1,2:2},si=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};si.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},si.prototype._correctButton=function(t,e){return!1},si.prototype._move=function(t,e){return{}},si.prototype.mousedown=function(t,e){if(!this._lastPoint){var n=r.mouseButton(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}},si.prototype.mousemoveWindow=function(t,e){var r=this._lastPoint;if(r)if(t.preventDefault(),function(t,e){var r=oi[e];return void 0===t.buttons||(t.buttons&r)!==r}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(r,e)},si.prototype.mouseupWindow=function(t){this._lastPoint&&r.mouseButton(t)===this._eventButton&&(this._moved&&r.suppressClick(),this.reset())},si.prototype.enable=function(){this._enabled=!0},si.prototype.disable=function(){this._enabled=!1,this.reset()},si.prototype.isEnabled=function(){return this._enabled},si.prototype.isActive=function(){return this._active};var ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,r){t.prototype.mousedown.call(this,e,r),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(si),li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=.8*(e.x-t.x);if(r)return this._active=!0,{bearingDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(si),ci=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var r=-.5*(e.y-t.y);if(r)return this._active=!0,{pitchDelta:r}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(si),hi=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};hi.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},hi.prototype.touchstart=function(t,e,r){return this._calculateTransform(t,e,r)},hi.prototype.touchmove=function(t,e,r){if(this._active&&!(r.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,r)},hi.prototype.touchend=function(t,e,r){this._calculateTransform(t,e,r),this._active&&r.length<this._minTouches&&this.reset()},hi.prototype.touchcancel=function(){this.reset()},hi.prototype._calculateTransform=function(e,r,n){n.length>0&&(this._active=!0);var i=ri(n,r),a=new t.Point(0,0),o=new t.Point(0,0),s=0;for(var u in i){var l=i[u],c=this._touches[u];c&&(a._add(l),o._add(l.sub(c)),s++,i[u]=l)}if(this._touches=i,!(s<this._minTouches)&&o.mag()){var h=o.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:a.div(s),panDelta:h}}},hi.prototype.enable=function(){this._enabled=!0},hi.prototype.disable=function(){this._enabled=!1,this.reset()},hi.prototype.isEnabled=function(){return this._enabled},hi.prototype.isActive=function(){return this._active};var fi=function(){this.reset()};function di(t,e,r){for(var n=0;n<t.length;n++)if(t[n].identifier===r)return e[n]}function pi(t,e){return Math.log(t/e)/Math.LN2}fi.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},fi.prototype._start=function(t){},fi.prototype._move=function(t,e,r){return{}},fi.prototype.touchstart=function(t,e,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([e[0],e[1]]))},fi.prototype.touchmove=function(t,e,r){if(this._firstTwoTouches){t.preventDefault();var n=this._firstTwoTouches,i=n[1],a=di(r,e,n[0]),o=di(r,e,i);if(a&&o){var s=this._aroundCenter?null:a.add(o).div(2);return this._move([a,o],s,t)}}},fi.prototype.touchend=function(t,e,n){if(this._firstTwoTouches){var i=this._firstTwoTouches,a=i[1],o=di(n,e,i[0]),s=di(n,e,a);o&&s||(this._active&&r.suppressClick(),this.reset())}},fi.prototype.touchcancel=function(){this.reset()},fi.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},fi.prototype.disable=function(){this._enabled=!1,this.reset()},fi.prototype.isEnabled=function(){return this._enabled},fi.prototype.isActive=function(){return this._active};var mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(pi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pi(this._distance,r),pinchAround:e}},e}(fi);function vi(t,e){return 180*t.angleWith(e)/Math.PI}var gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var r=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:vi(this._vector,r),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,r=vi(t,this._startVector);return Math.abs(r)<e},e}(fi);function yi(t){return Math.abs(t.y)>Math.abs(t.x)}var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,yi(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,r){var n=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(n,i,r.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,r){if(void 0!==this._valid)return this._valid;var n=t.mag()>=2,i=e.mag()>=2;if(n||i){if(!n||!i)return void 0===this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;var a=t.y>0==e.y>0;return yi(t)&&yi(e)&&a}},e}(fi),bi={panStep:100,bearingStep:15,pitchStep:10},xi=function(){var t=bi;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function wi(t){return t*(2-t)}xi.prototype.reset=function(){this._active=!1},xi.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var r=0,n=0,i=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:wi,zoom:r?Math.round(u)+r*(t.shiftKey?2:1):u,bearing:s.getBearing()+n*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-a*e._panStep,-o*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},xi.prototype.enable=function(){this._enabled=!0},xi.prototype.disable=function(){this._enabled=!1,this.reset()},xi.prototype.isEnabled=function(){return this._enabled},xi.prototype.isActive=function(){return this._active},xi.prototype.disableRotation=function(){this._rotationDisabled=!0},xi.prototype.enableRotation=function(){this._rotationDisabled=!1};var Mi=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};Mi.prototype.setZoomRate=function(t){this._defaultZoomRate=t},Mi.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},Mi.prototype.isEnabled=function(){return!!this._enabled},Mi.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},Mi.prototype.isZooming=function(){return!!this._zooming},Mi.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},Mi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Mi.prototype.wheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=t.browser.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this._active||this._start(e)),e.preventDefault()}},Mi.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},Mi.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var n=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Mi.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var r=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);var a="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(a*i))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,s="number"==typeof this._targetZoom?this._targetZoom:r.zoom,u=this._startZoom,l=this._easing,c=!1;if("wheel"===this._type&&u&&l){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),f=l(h);o=t.number(u,s,f),h<1?this._frameId||(this._frameId=!0):c=!0}else o=s,c=!0;return this._active=!0,c&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Mi.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var n=this._prevEase,i=(t.browser.now()-n.start)/n.duration,a=n.easing(i+.01)-n.easing(i),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);r=t.bezier(o,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r},Mi.prototype.reset=function(){this._active=!1};var Ai=function(t,e){this._clickZoom=t,this._tapZoom=e};Ai.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Ai.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Ai.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Ai.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Ei=function(){this.reset()};Ei.prototype.reset=function(){this._active=!1},Ei.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(r){r.easeTo({duration:300,zoom:r.getZoom()+(t.shiftKey?-1:1),around:r.unproject(e)},{originalEvent:t})}}},Ei.prototype.enable=function(){this._enabled=!0},Ei.prototype.disable=function(){this._enabled=!1,this.reset()},Ei.prototype.isEnabled=function(){return this._enabled},Ei.prototype.isActive=function(){return this._active};var Si=function(){this._tap=new ii({numTouches:1,numTaps:1}),this.reset()};Si.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Si.prototype.touchstart=function(t,e,r){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=e[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(t,e,r))},Si.prototype.touchmove=function(t,e,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;var n=e[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,r)},Si.prototype.touchend=function(t,e,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(t,e,r)&&(this._tapTime=t.timeStamp)},Si.prototype.touchcancel=function(){this.reset()},Si.prototype.enable=function(){this._enabled=!0},Si.prototype.disable=function(){this._enabled=!1,this.reset()},Si.prototype.isEnabled=function(){return this._enabled},Si.prototype.isActive=function(){return this._active};var Ti=function(t,e,r){this._el=t,this._mousePan=e,this._touchPan=r};Ti.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ti.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ti.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ti.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Ci=function(t,e,r){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=r};Ci.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Ci.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Ci.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Ci.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Oi=function(t,e,r,n){this._el=t,this._touchZoom=e,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0};Oi.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Oi.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Oi.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Oi.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Oi.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Oi.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Pi=function(t){return t.zoom||t.drag||t.pitch||t.rotate},Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event),Ii=function(){this.constants=[1,1,.01],this.radius=0};function ki(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}Ii.prototype.setup=function(e,r){var n=t.sub([],r,e);this.radius=t.length(n[2]<0?t.div([],n,this.constants):[n[0],n[1],0])},Ii.prototype.projectRay=function(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);var r=t.scale$2([],e,this.radius);if(r[2]>0){var n=t.scale$2([],[0,0,1],t.dot(r,[0,0,1])),i=t.scale$2([],t.normalize([],[r[0],r[1],0]),this.radius),a=t.add([],r,t.scale$2([],t.sub([],t.add([],i,n),r),2));r[0]=a[0],r[1]=a[1]}return r};var Ri=function(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qn(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ii,this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var a=0,o=this._listeners;a<o.length;a+=1){var s=o[a],u=s[0];r.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};Ri.prototype.destroy=function(){for(var e=0,n=this._listeners;e<n.length;e+=1){var i=n[e],a=i[0];r.removeEventListener(a,i[1],a===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},Ri.prototype._addDefaultHandlers=function(t){var e=this._map,r=e.getCanvasContainer();this._add("mapEvent",new Qn(e,t));var n=e.boxZoom=new ei(e,t);this._add("boxZoom",n);var i=new ai,a=new Ei;e.doubleClickZoom=new Ai(a,i),this._add("tapZoom",i),this._add("clickZoom",a);var o=new Si;this._add("tapDragZoom",o);var s=e.touchPitch=new _i;this._add("touchPitch",s);var u=new li(t),l=new ci(t);e.dragRotate=new Ci(t,u,l),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);var c=new ui(t),h=new hi(t);e.dragPan=new Ti(r,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var f=new gi,d=new mi;e.touchZoomRotate=new Oi(r,d,f,o),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]);var p=e.scrollZoom=new Mi(e,this);this._add("scrollZoom",p,["mousePan"]);var m=e.keyboard=new xi;this._add("keyboard",m),this._add("blockableMapEvent",new ti(e));for(var v=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];v<g.length;v+=1){var y=g[v];t.interactive&&t[y]&&e[y].enable(t[y])}},Ri.prototype._add=function(t,e,r){this._handlers.push({handlerName:t,handler:e,allowed:r}),this._handlersById[t]=e},Ri.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,r=this._handlers;e<r.length;e+=1)r[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},Ri.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},Ri.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Ri.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Ri.prototype.isMoving=function(){return Boolean(Pi(this._eventsInProgress))||this.isZooming()},Ri.prototype._blockedByActive=function(t,e,r){for(var n in t)if(n!==r&&(!e||e.indexOf(n)<0))return!0;return!1},Ri.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},Ri.prototype._getMapTouches=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=n[r];this._el.contains(i.target)&&e.push(i)}return e},Ri.prototype.handleEvent=function(t,e){if("blur"!==t.type){this._updatingCamera=!0;for(var n="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},a={},o={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?r.touchPos(this._el,s):r.mousePos(this._el,t),l=0,c=this._handlers;l<c.length;l+=1){var h=c[l],f=h.handlerName,d=h.handler,p=h.allowed;if(d.isEnabled()){var m=void 0;this._blockedByActive(o,p,f)?d.reset():d[e||t.type]&&(m=d[e||t.type](t,u,s),this.mergeHandlerResult(i,a,m,f,n),m&&m.needsRenderFrame&&this._triggerRenderFrame()),(m||d.isActive())&&(o[f]=d)}}var v={};for(var g in this._previousActiveHandlers)o[g]||(v[g]=n);this._previousActiveHandlers=o,(Object.keys(v).length||ki(i))&&(this._changes.push([i,a,v]),this._triggerRenderFrame()),(Object.keys(o).length||ki(i))&&this._map._stop(!0),this._updatingCamera=!1;var y=i.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))}else this.stop(!0)},Ri.prototype.mergeHandlerResult=function(e,r,n,i,a){if(n){t.extend(e,n);var o={handlerName:i,originalEvent:n.originalEvent||a};void 0!==n.zoomDelta&&(r.zoom=o),void 0!==n.panDelta&&(r.drag=o),void 0!==n.pitchDelta&&(r.pitch=o),void 0!==n.bearingDelta&&(r.rotate=o)}},Ri.prototype._applyChanges=function(){for(var e={},r={},n={},i=0,a=this._changes;i<a.length;i+=1){var o=a[i],s=o[0],u=o[1],l=o[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.aroundCoord&&(e.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(r,u),t.extend(n,l)}this._updateMapTransform(e,r,n),this._changes=[]},Ri.prototype._updateMapTransform=function(e,r,n){var i=this._map,a=i.transform,o=function(t){return[t.x,t.y,t.z]};if(!ki(e))return this._fireEvents(r,n,!0);var s=e.panDelta,u=e.zoomDelta,l=e.bearingDelta,c=e.pitchDelta,h=e.around,f=e.aroundCoord,d=e.pinchAround;void 0!==d&&(h=d),r.drag&&!this._eventsInProgress.drag&&h&&(this._dragOrigin=o(a.pointCoordinate(h)),this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),i._stop(!0),h=h||i.transform.centerPoint,l&&(a.bearing+=l),c&&(a.pitch+=c),a._updateCameraState();var p=[0,0,0];if(s){var m=a.screenPointToMercatorRay(h),v=a.screenPointToMercatorRay(h.sub(s)),g=this._trackingEllipsoid.projectRay(m.dir),y=this._trackingEllipsoid.projectRay(v.dir);p[0]=y[0]-g[0],p[1]=y[1]-g[1]}var _=[0,0,0];if(u){var b=o(f||a.pointCoordinate(h)),x={dir:t.normalize([],t.sub([],b,a._camera.position))},w=a.screenPointToMercatorRay(a.centerPoint);if(x.dir[2]<0){var M=t.altitudeFromMercatorZ(b[2],b[1]),A=a.rayIntersectionCoordinate(a.pointRayIntersection(a.centerPoint,M)),E=a.zoomDeltaToMovement(o(A),u)*(w.dir[2]/x.dir[2]);t.scale$2(_,x.dir,E)}}var S=t.add(p,p,_);a._translateCameraConstrained(S),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(r,n,!0)},Ri.prototype._fireEvents=function(e,r,n){var i=this,a=Pi(this._eventsInProgress),o=Pi(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var l in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(l,s[l]);for(var c in o&&this._fireEvent("move",o.originalEvent),e)this._fireEvent(c,e[c].originalEvent);var h,f={};for(var d in this._eventsInProgress){var p=this._eventsInProgress[d],m=p.handlerName,v=p.originalEvent;this._handlersById[m].isActive()||(delete this._eventsInProgress[d],f[d+"end"]=h=r[m]||v)}for(var g in f)this._fireEvent(g,f[g]);var y=Pi(this._eventsInProgress);if(n&&(a||o)&&!y){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),b=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(b(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),b(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Ri.prototype._fireEvent=function(e,r){this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},Ri.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new Li("renderFrame",{timeStamp:e})),t._applyChanges()}))},Ri.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var Di=function(e){function r(r,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,n){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),n)},r.prototype.panTo=function(e,r,n){return this.easeTo(t.extend({center:e},r),n)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,n){return this.easeTo(t.extend({zoom:e},r),n)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.getPadding=function(){return this.transform.padding},r.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},r.prototype.rotateTo=function(e,r,n){return this.easeTo(t.extend({bearing:e},r),n)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.resetNorthPitch=function(e,r){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){e=t.LngLatBounds.convert(e);var n=r&&r.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,r)},r.prototype._cameraForBoxAndBearing=function(e,r,n,i){var a={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}i.padding=t.extend(a,i.padding);var s=this.transform,u=s.padding,l=s.project(t.LngLat.convert(e)),c=s.project(t.LngLat.convert(r)),h=l.rotate(-n*Math.PI/180),f=c.rotate(-n*Math.PI/180),d=new t.Point(Math.max(h.x,f.x),Math.max(h.y,f.y)),p=new t.Point(Math.min(h.x,f.x),Math.min(h.y,f.y)),m=d.sub(p),v=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/m.x,g=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/m.y;if(!(g<0||v<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(v,g)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),b=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(n*Math.PI/180),x=_.add(b).mult(s.scale/s.zoomScale(y));return{center:s.unproject(l.add(c).div(2).sub(x)),zoom:y,bearing:n}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,n,i,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),n,i),i,a)},r.prototype._fitInternal=function(e,r,n){return e?(delete(r=t.extend(e,r)).padding,r.linear?this.easeTo(r,n):this.flyTo(r,n)):this},r.prototype.jumpTo=function(e,r){this.stop();var n=this.transform,i=!1,a=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(a=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),i&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),a&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),o&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.getFreeCameraOptions=function(){return this.transform.getFreeCameraOptions()},r.prototype.getCameraParameter=function(){return this.transform.getCameraParameter()},r.prototype.setFreeCameraOptions=function(e,r){this.stop();var n=this.transform,i=n.zoom,a=n.pitch,o=n.bearing;n.setFreeCameraOptions(e);var s=i!==n.zoom,u=a!==n.pitch,l=o!==n.bearing;return this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),s&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),l&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),u&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r)),this},r.prototype.setCameraParameter=function(e,r){this.stop();var n=this.transform,i=n.zoom,a=n.pitch,o=n.bearing;n.setCameraParameter(e);var s=i!==n.zoom,u=a!==n.pitch,l=o!==n.bearing;return this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),s&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),l&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),u&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r)),this},r.prototype.easeTo=function(e,r){var n=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="zoom"in e?+e.zoom:a,c="bearing"in e?this._normalizeBearing(e.bearing,o):o,h="pitch"in e?+e.pitch:s,f="padding"in e?e.padding:i.padding,d=t.Point.convert(e.offset),p=i.centerPoint.add(d),m=i.pointLocation(p),v=t.LngLat.convert(e.center||m);this._normalizeCenter(v);var g,y,_=i.project(m),b=i.project(v).sub(_),x=i.zoomScale(l-a);e.around&&(g=t.LngLat.convert(e.around),y=i.locationPoint(g));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==a,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(f),this._easeId=e.easeId,this._prepareEase(r,e.noMoveStart,w),this._ease((function(e){if(n._zooming&&(i.zoom=t.number(a,l,e)),n._rotating&&(i.bearing=t.number(o,c,e)),n._pitching&&(i.pitch=t.number(s,h,e)),n._padding&&(i.interpolatePadding(u,f,e),p=i.centerPoint.add(d)),g)i.setLocationAtPoint(g,y);else{var m=i.zoomScale(i.zoom-a),v=l>a?Math.min(2,x):Math.max(.5,x),w=Math.pow(v,1-e),M=i.unproject(_.add(b.mult(e*w)).mult(m));i.setLocationAtPoint(i.renderWorldCopies?M.wrap():M,p)}n._fireMoveEvents(r)}),(function(t){n._afterEase(r,t)}),e),this},r.prototype._prepareEase=function(e,r,n){void 0===n&&(n={}),this._moving=!0,r||n.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!n.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e,r){if(!this._easeId||!r||this._easeId!==r){delete this._easeId;var n=this._zooming,i=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),a&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},r.prototype.flyTo=function(e,r){var n=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,r)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var a=this.transform,o=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,a.minZoom,a.maxZoom):o,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,f="pitch"in e?+e.pitch:u,d="padding"in e?e.padding:a.padding,p=a.zoomScale(c-o),m=t.Point.convert(e.offset),v=a.centerPoint.add(m),g=a.pointLocation(v),y=t.LngLat.convert(e.center||g);this._normalizeCenter(y);var _=a.project(g),b=a.project(y).sub(_),x=e.curve,w=Math.max(a.width,a.height),M=w/p,A=b.mag();if("minZoom"in e){var E=t.clamp(Math.min(e.minZoom,o,c),a.minZoom,a.maxZoom),S=w/a.zoomScale(E-o);x=Math.sqrt(S/A*2)}var T=x*x;function C(t){var e=(M*M-w*w+(t?-1:1)*T*T*A*A)/(2*(t?M:w)*T*A);return Math.log(Math.sqrt(e*e+1)-e)}function O(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var L=C(0),I=function(t){return P(L)/P(L+x*t)},k=function(t){return w*((P(L)*(O(e=L+x*t)/P(e))-O(L))/T)/A;var e},R=(C(1)-L)/x;if(Math.abs(A)<1e-6||!isFinite(R)){if(Math.abs(w-M)<1e-6)return this.easeTo(e,r);var D=M<w?-1:1;R=Math.abs(Math.log(M/w))/x,k=function(){return 0},I=function(t){return Math.exp(D*x*t)}}return e.duration="duration"in e?+e.duration:1e3*R/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=f!==u,this._padding=!a.isPaddingEqual(d),this._prepareEase(r,!1),this._ease((function(e){var i=e*R,p=1/I(i);a.zoom=1===e?c:o+a.scaleZoom(p),n._rotating&&(a.bearing=t.number(s,h,e)),n._pitching&&(a.pitch=t.number(u,f,e)),n._padding&&(a.interpolatePadding(l,d,e),v=a.centerPoint.add(m));var g=1===e?y:a.unproject(_.add(b.mult(k(i))).mult(p));a.setLocationAtPoint(a.renderWorldCopies?g.wrap():g,v),n._fireMoveEvents(r)}),(function(){return n._afterEase(r)}),e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){return this._stop()},r.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var r=this._onEaseEnd;delete this._onEaseEnd,r.call(this,e)}if(!t){var n=this.handlers;n&&n.stop(!1)}return this},r.prototype._ease=function(e,r,n){!1===n.animate||0===n.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var n=Math.abs(e-r);return Math.abs(e-360-r)<n&&(e-=360),Math.abs(e+360-r)<n&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),Bi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Bi.prototype.getDefaultPosition=function(){return"bottom-right"},Bi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=r.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Bi.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Bi.prototype._setElementTitle=function(t,e){var r=this._map._getUIString("AttributionControl."+e);t.title=r,t.setAttribute("aria-label",r)},Bi.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Bi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var n=r.reduce((function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<r.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},Bi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Bi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var n in r){var i=r[n];if(i.used){var a=i.getSource();a.attribution&&t.indexOf(a.attribution)<0&&t.push(a.attribution)}}t.sort((function(t,e){return t.length-e.length}));var o=(t=t.filter((function(e,r){for(var n=r+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}))).join(" | ");o!==this._attribHTML&&(this._attribHTML=o,t.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Bi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Fi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Fi.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Fi.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Fi.prototype.getDefaultPosition=function(){return"bottom-left"},Fi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Fi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Fi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var ji=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ji.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},ji.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r+=1){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},ji.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var r=0,n=e;r<n.length;r+=1){var i=n[r];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ji.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ni={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ui=t.window.HTMLImageElement,zi=t.window.HTMLElement,Gi=t.window.ImageBitmap,Vi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0,ak:null,token:{},projection:void 0},Hi=function(n){function i(e){var r=this;if(null!=(e=t.extend({},Vi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");var i=new Nn(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(n.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new ji,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Ni,e.locale),this._clickTolerance=e.clickTolerance,this._projection=P.projection=e.projection,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.token),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof zi))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return r._update(!1)})),this.on("moveend",(function(){return r._update(!1)})),this.on("zoom",(function(){return r._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Ri(this,e),this._hash=e.hash&&new zn("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Bi({customAttribution:e.customAttribution})),this.addControl(new Fi,e.logoPosition),this.on("style.load",(function(){r.transform.unmodified&&r.jumpTo(r.style.stylesheet)})),this.on("data",(function(e){r._update("style"===e.dataType),r.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){r.fire(new t.Event(e.dataType+"dataloading",e))}))}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,r){if(void 0===r&&(r=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var n=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var r=this._containerDimensions(),n=r[0],i=r[1];this._resizeCanvas(n,i),this.transform.resize(n,i),this.painter.resize(n,i);var a=!this._moving;return a&&(this.stop(),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e))),this.fire(new t.Event("resize",e)),a&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint3D(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation3D(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,r){var n,i=this;if("mouseenter"===t||"mouseover"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){var o=i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[];o.length?a||(a=!0,r.call(i,new Zn(t,i,n.originalEvent,{features:o}))):a=!1},mouseout:function(){a=!1}}}}if("mouseleave"===t||"mouseout"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){(i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?o=!0:o&&(o=!1,r.call(i,new Zn(t,i,n.originalEvent)))},mouseout:function(e){o&&(o=!1,r.call(i,new Zn(t,i,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(n={},n[t]=function(t){var n=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,r.call(i,t),delete t.features)},n)}},i.prototype.on=function(t,e,r){if(void 0===r)return n.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,r);for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(a,i.delegates[a]);return this},i.prototype.once=function(t,e,r){if(void 0===r)return n.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,r);for(var a in i.delegates)this.once(a,i.delegates[a]);return this},i.prototype.off=function(t,e,r){var i=this;return void 0===r?n.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(n){for(var a=n[t],o=0;o<a.length;o++){var s=a[o];if(s.layer===e&&s.listener===r){for(var u in s.delegates)i.off(u,s.delegates[u]);return a.splice(o,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var n;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])n=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),a=t.Point.convert(e[1]);n=[i,new t.Point(a.x,i.y),a,new t.Point(i.x,a.y),i]}var o=this.style.queryRenderedFeatures(n,r,this.transform);return this._projection&&(o=t.convertFeatureCoor(this._projection,o)),o},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new He(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new He(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,r){var n=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(a,(function(e,i){e?n.fire(new t.ErrorEvent(e)):i&&n._updateDiff(i,r)}))}else"object"==typeof e&&this._updateDiff(e,r)},i.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce("Unable to perform style diff: "+(n.message||n.error||n)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var n in r){var i=r[n];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,r){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,r)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,r,n){void 0===n&&(n={});var i=n.pixelRatio;void 0===i&&(i=1);var a=n.sdf;void 0===a&&(a=!1);var o=n.stretchX,s=n.stretchY,u=n.content;if(this._lazyInitEmptyStyle(),r instanceof Ui||Gi&&r instanceof Gi){var l=t.browser.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:l.width,height:l.height},l.data),pixelRatio:i,stretchX:o,stretchY:s,content:u,sdf:a,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=r;this.style.addImage(e,{data:new t.RGBAImage({width:r.width,height:r.height},new Uint8Array(r.data)),pixelRatio:i,stretchX:o,stretchY:s,content:u,sdf:a,version:0,userImage:c}),c.onAdd&&c.onAdd(this,e)}},i.prototype.updateImage=function(e,r){var n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=r instanceof Ui||Gi&&r instanceof Gi?t.browser.getImageData(r):r,a=i.width,o=i.height,s=i.data;return void 0===a||void 0===o?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==n.data.width||o!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(s,!(r instanceof Ui||Gi&&r instanceof Gi)),void this.style.updateImage(e,n))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},i.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,r,n),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,r,n),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=r.create("div","mapboxgl-control-container",t),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){a[t]=r.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,r){var n=t.browser.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},i.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(this.painter=new An(n,this.transform),t.webpSupported.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var r,n=this,i=0,a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(r=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,r),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var o=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var l=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),c=l.crossFadingFactor();1===c&&c===this._crossFadingFactor||(o=!0,this._crossFadingFactor=c),this.style.update(l)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;a.endQueryEXT(a.TIME_ELAPSED_EXT,r),setTimeout((function(){var e=a.getQueryObjectEXT(r,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(r),n.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var f=this.painter.collectGpuTimers();setTimeout((function(){var e=n.painter.queryGpuTimers(f);n.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),Wi(this._canvasContainer),Wi(this._controlContainer),Wi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,r){t.setCacheLimits(e,r)},a.version.get=function(){return t.version},Object.defineProperties(i.prototype,a),i}(Di);function Wi(t){t.parentNode&&t.parentNode.removeChild(t)}var $i={showCompass:!0,showZoom:!0,visualizePitch:!1},qi=function(e){var n=this;this.options=t.extend({},$i,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return n._map.zoomIn({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return n._map.zoomOut({},{originalEvent:t})})),r.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){n.options.visualizePitch?n._map.resetNorthPitch({},{originalEvent:t}):n._map.resetNorth({},{originalEvent:t})})),this._compassIcon=r.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};qi.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),r=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())},qi.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},qi.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xi(this._map,this._compass,this.options.visualizePitch)),this._container},qi.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},qi.prototype._createButton=function(t,e){var n=r.create("button",t,this._container);return n.type="button",n.addEventListener("click",e),n},qi.prototype._setButtonTitle=function(t,e){var r=this._map._getUIString("NavigationControl."+e);t.title=r,t.setAttribute("aria-label",r)};var Xi=function(e,n,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=n,this.mouseRotate=new li({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new ci({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener(n,"mousedown",this.mousedown),r.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),r.addEventListener(n,"touchmove",this.touchmove),r.addEventListener(n,"touchend",this.touchend),r.addEventListener(n,"touchcancel",this.reset)};function Ki(e,r,n){if(e=new t.LngLat(e.lng,e.lat),r){var i=new t.LngLat(e.lng-360,e.lat),a=new t.LngLat(e.lng+360,e.lat),o=n.locationPoint(e).distSqr(r);n.locationPoint(i).distSqr(r)<o?e=i:n.locationPoint(a).distSqr(r)<o&&(e=a)}for(;Math.abs(e.lng-n.center.lng)>180;){var s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}Xi.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),r.disableDrag()},Xi.prototype.move=function(t,e){var r=this.map,n=this.mouseRotate.mousemoveWindow(t,e);if(n&&n.bearingDelta&&r.setBearing(r.getBearing()+n.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&r.setPitch(r.getPitch()+i.pitchDelta)}},Xi.prototype.off=function(){var t=this.element;r.removeEventListener(t,"mousedown",this.mousedown),r.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),r.removeEventListener(t,"touchmove",this.touchmove),r.removeEventListener(t,"touchend",this.touchend),r.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Xi.prototype.offTemp=function(){r.enableDrag(),r.removeEventListener(t.window,"mousemove",this.mousemove),r.removeEventListener(t.window,"mouseup",this.mouseup)},Xi.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),r.mousePos(this.element,e)),r.addEventListener(t.window,"mousemove",this.mousemove),r.addEventListener(t.window,"mouseup",this.mouseup)},Xi.prototype.mousemove=function(t){this.move(t,r.mousePos(this.element,t))},Xi.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Xi.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Xi.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=r.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Xi.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Xi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Zi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yi(t,e,r){var n=t.classList;for(var i in Zi)n.remove("mapboxgl-"+r+"-anchor-"+i);n.add("mapboxgl-"+r+"-anchor-"+e)}var Ji,Qi=function(e){function n(n,i){if(e.call(this),(n instanceof t.window.HTMLElement||i)&&(n=t.extend({element:n},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=t.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div"),this._element.setAttribute("aria-label","Map marker");var a=r.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=r.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=r.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],f=r.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",h.rx),f.setAttributeNS(null,"ry",h.ry),u.appendChild(f)}var d=r.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"fill",this._color);var p=r.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),d.appendChild(p);var m=r.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var v=r.createNS("http://www.w3.org/2000/svg","path");v.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(v);var g=r.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var y=r.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=r.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var b=r.createNS("http://www.w3.org/2000/svg","circle");b.setAttributeNS(null,"fill","#FFFFFF"),b.setAttributeNS(null,"cx","5.5"),b.setAttributeNS(null,"cy","5.5"),b.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(b),s.appendChild(u),s.appendChild(d),s.appendChild(m),s.appendChild(g),s.appendChild(y),a.appendChild(s),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=t.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Yi(this._element,this._anchor,"marker"),this._popup=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},n.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.getCoordinate=function(){return t.convertCoor_([this._lngLat.lng,this._lngLat.lat],P.projection)},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.setCoordinate=function(e){var r=t.convertCoor(e,P.projection);return this._lngLat=t.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.getElement=function(){return this._element},n.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},n.prototype._onKeyPress=function(t){var e=t.code,r=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==r&&13!==r||this.togglePopup()},n.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},n.prototype.getPopup=function(){return this._popup},n.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},n.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ki(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,Zi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+n+" "+e)}},n.prototype.getOffset=function(){return this._offset},n.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},n.prototype._onMove=function(e){if(!this._isDragging){var r=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=r}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},n.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},n.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},n.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},n.prototype.isDraggable=function(){return this._draggable},n.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},n.prototype.getRotation=function(){return this._rotation},n.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},n.prototype.getRotationAlignment=function(){return this._rotationAlignment},n.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},n.prototype.getPitchAlignment=function(){return this._pitchAlignment},n}(t.Evented),ta={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ea=0,ra=!1,na=function(e){function n(r){e.call(this),this.options=t.extend({},ta,r),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(e){var n;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Ji?n(Ji):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){n(Ji="denied"!==t.state)})):n(Ji=!!t.window.navigator.geolocation),this._container},n.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),r.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ea=0,ra=!1},n.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),r=t.coords;return e&&(r.longitude<e.getWest()||r.longitude>e.getEast()||r.latitude<e.getSouth()||r.latitude>e.getNorth())},n.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},n.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},n.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=this._map.getBearing(),a=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),a,{geolocateSource:!0})},n.prototype._updateMarker=function(e){if(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},n.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),r=this._map.unproject([1,t]),n=e.distanceTo(r),i=Math.ceil(2*this._accuracy/n);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},n.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},n.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&ra)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},n.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},n.prototype._setupUI=function(e){var n=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=r.create("button","mapboxgl-ctrl-geolocate",this._container),r.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Qi(this._dotElement),this._circleElement=r.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==n._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new t.Event("trackuserlocationend")))}))},n.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ea--,ra=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ea>1?(e={maximumAge:6e5,timeout:0},ra=!0):(e=this.options.positionOptions,ra=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},n.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},n}(t.Evented),ia={maxWidth:100,unit:"metric"},aa=function(e){this.options=t.extend({},ia,e),t.bindAll(["_onMove","setUnit"],this)};function oa(t,e,r){var n=r&&r.maxWidth||100,i=t._container.clientHeight/2,a=t.unproject([0,i]),o=t.unproject([n,i]),s=a.distanceTo(o);if(r&&"imperial"===r.unit){var u=3.2808*s;u>5280?sa(e,n,u/5280,t._getUIString("ScaleControl.Miles")):sa(e,n,u,t._getUIString("ScaleControl.Feet"))}else r&&"nautical"===r.unit?sa(e,n,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?sa(e,n,s/1e3,t._getUIString("ScaleControl.Kilometers")):sa(e,n,s,t._getUIString("ScaleControl.Meters"))}function sa(t,e,r,n){var i,a,o,s=(i=r,(a=Math.pow(10,(""+Math.floor(i)).length-1))*(o=(o=i/a)>=10?10:o>=5?5:o>=3?3:o>=2?2:o>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(o)));t.style.width=e*(s/r)+"px",t.innerHTML=s+"&nbsp;"+n}aa.prototype.getDefaultPosition=function(){return"bottom-left"},aa.prototype._onMove=function(){oa(this._map,this._container,this.options)},aa.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},aa.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},aa.prototype.setUnit=function(t){this.options.unit=t,oa(this._map,this._container,this.options)};var ua=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};ua.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},ua.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},ua.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},ua.prototype._setupUI=function(){var e=this._fullscreenButton=r.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);r.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},ua.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},ua.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},ua.prototype._isFullscreen=function(){return this._fullscreen},ua.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},ua.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var la={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ca=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ha=function(e){function n(r){e.call(this),this.options=t.extend(Object.create(la),r),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},n.prototype.isOpen=function(){return!!this._map},n.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.getCoordinate=function(){return t.convertCoor_([this._lngLat.lng,this._lngLat.lat],P.projection)},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},n.prototype.setCoordinate=function(e){var r=t.convertCoor(e,P.projection);return this._lngLat=t.LngLat.convert(r),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},n.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},n.prototype.getElement=function(){return this._container},n.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},n.prototype.setHTML=function(e){var r,n=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;r=i.firstChild;)n.appendChild(r);return this.setDOMContent(n)},n.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},n.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},n.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=r.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},n.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},n.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},n.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},n.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},n.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},n.prototype._onMouseUp=function(t){this._update(t.point)},n.prototype._onMouseMove=function(t){this._update(t.point)},n.prototype._onDrag=function(t){this._update(t.point)},n.prototype._update=function(e){var n=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return n._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ki(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),a=this.options.anchor,o=function e(r){if(r){if("number"==typeof r){var n=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(n,n),"top-right":new t.Point(-n,n),bottom:new t.Point(0,-r),"bottom-left":new t.Point(n,-n),"bottom-right":new t.Point(-n,-n),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var i=t.Point.convert(r);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!a){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+o.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),a=0===s.length?"bottom":s.join("-")}var c=i.add(o[a]).round();r.setTransform(this._container,Zi[a]+" translate("+c.x+"px,"+c.y+"px)"),Yi(this._container,a,"popup")}},n.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(ca);t&&t.focus()}},n.prototype._onClose=function(){this.remove()},n}(t.Evented),fa={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:Hi,NavigationControl:qi,GeolocateControl:na,AttributionControl:Bi,ScaleControl:aa,FullscreenControl:ua,Popup:ha,Marker:Qi,Style:He,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:Dn,Evented:t.Evented,config:t.config,prewarm:function(){Nt().acquire(Dt)},clearPrewarmedResources:function(){var t=Ft;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Dt),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Bt.workerCount},set workerCount(t){Bt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return fa})),r}()})),sipsdmapgl=unwrapExports(sipsdmapGl);function styleInject(t,e){void 0===e&&(e={});var r=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===r&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}var css_248z=".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-moz-box-shadow:0 0 2px rgba(0,0,0,.1);-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;-moz-animation:mapboxgl-spin 2s infinite linear;-o-animation:mapboxgl-spin 2s infinite linear;-ms-animation:mapboxgl-spin 2s infinite linear;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@-moz-keyframes mapboxgl-spin{0%{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(1turn)}}@-o-keyframes mapboxgl-spin{0%{-o-transform:rotate(0deg)}to{-o-transform:rotate(1turn)}}@-ms-keyframes mapboxgl-spin{0%{-ms-transform:rotate(0deg)}to{-ms-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-flex;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;-moz-animation:mapboxgl-user-location-dot-pulse 2s infinite;-ms-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@-ms-keyframes mapboxgl-user-location-dot-pulse{0%{-ms-transform:scale(1);opacity:1}70%{-ms-transform:scale(3);opacity:0}to{-ms-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}";styleInject(css_248z),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e});var REVISION="112",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,FrontFaceDirectionCW=0,FrontFaceDirectionCCW=1,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide$c=2,FlatShading=1,SmoothShading=2,NoColors=0,FaceColors=1,VertexColors=2,NoBlending=0,NormalBlending=1,AdditiveBlending$4=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,ACESFilmicToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping$2=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,RGBEFormat=RGBAFormat,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,LogLuvEncoding=3003,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042;function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});for(var _lut=[],i=0;i<256;i++)_lut[i]=(i<16?"0":"")+i.toString(16);var _Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(_lut[255&t]+_lut[t>>8&255]+_lut[t>>16&255]+_lut[t>>24&255]+"-"+_lut[255&e]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[63&r|128]+_lut[r>>8&255]+"-"+_lut[r>>16&255]+_lut[r>>24&255]+_lut[255&n]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*_Math.DEG2RAD},radToDeg:function(t){return t*_Math.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}};function Vector2$3(t,e){this.x=t||0,this.y=e||0}function Quaternion(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}Object.defineProperties(Vector2$3.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Vector2$3.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*r-a*n+t.x,this.y=i*n+a*r+t.y,this}}),Object.assign(Quaternion,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,a,o){var s=r[n+0],u=r[n+1],l=r[n+2],c=r[n+3],h=i[a+0],f=i[a+1],d=i[a+2],p=i[a+3];if(c!==p||s!==h||u!==f||l!==d){var m=1-o,v=s*h+u*f+l*d+c*p,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,v*g);m=Math.sin(m*b)/_,o=Math.sin(o*b)/_}var x=o*g;if(s=s*m+h*x,u=u*m+f*x,l=l*m+d*x,c=c*m+p*x,m===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}}),Object.defineProperties(Quaternion.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Quaternion.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,a=t.order,o=Math.cos,s=Math.sin,u=o(r/2),l=o(n/2),c=o(i/2),h=s(r/2),f=s(n/2),d=s(i/2);return"XYZ"===a?(this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d):"YXZ"===a?(this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d):"ZXY"===a?(this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d):"ZYX"===a?(this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d):"YZX"===a?(this._x=h*l*c+u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c-h*f*d):"XZY"===a&&(this._x=h*l*c-u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c+h*f*d),!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],a=r[8],o=r[1],s=r[5],u=r[9],l=r[2],c=r[6],h=r[10],f=n+s+h;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(c-u)*e,this._y=(a-l)*e,this._z=(o-i)*e):n>s&&n>h?(e=2*Math.sqrt(1+n-s-h),this._w=(c-u)/e,this._x=.25*e,this._y=(i+o)/e,this._z=(a+l)/e):s>h?(e=2*Math.sqrt(1+s-n-h),this._w=(a-l)/e,this._x=(i+o)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+h-n-s),this._w=(o-i)/e,this._x=(a+l)/e,this._y=(u+c)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(_Math.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(this._x=this._x*(t=1/t),this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,a=t._w,o=e._x,s=e._y,u=e._z,l=e._w;return this._x=r*l+a*o+n*u-i*s,this._y=n*l+a*s+i*o-r*u,this._z=i*l+a*u+r*s-n*o,this._w=a*l-r*o-n*s-i*u,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,a=this._w,o=a*t._w+r*t._x+n*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=r,this._y=n,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-e;return this._w=u*a+e*this._w,this._x=u*r+e*this._x,this._y=u*n+e*this._y,this._z=u*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-e)*c)/l,f=Math.sin(e*c)/l;return this._w=a*h+this._w*f,this._x=r*h+this._x*f,this._y=n*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var _vector=new Vector3$1,_quaternion=new Quaternion;function Vector3$1(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(Vector3$1.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(_quaternion.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(_quaternion.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,a=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*a,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*a,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*a,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,a=t.y,o=t.z,s=t.w,u=s*e+a*n-o*r,l=s*r+o*e-i*n,c=s*n+i*r-a*e,h=-i*e-a*r-o*n;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=n*s-i*o,this.y=i*a-r*s,this.z=r*o-n*a,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(t){return _vector.copy(this).projectOnVector(t),this.sub(_vector)},reflect:function(t){return this.sub(_vector.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());0===e&&console.error("THREE.Vector3: angleTo() can't handle zero length vectors.");var r=this.dot(t)/e;return Math.acos(_Math.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var _vector$1=new Vector3$1,_canvas;function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,a,o,s,u){var l=this.elements;return l[0]=t,l[1]=n,l[2]=o,l[3]=e,l[4]=i,l[5]=s,l[6]=r,l[7]=a,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(t){for(var e=0,r=t.count;e<r;e++)_vector$1.x=t.getX(e),_vector$1.y=t.getY(e),_vector$1.z=t.getZ(e),_vector$1.applyMatrix3(this),t.setXYZ(e,_vector$1.x,_vector$1.y,_vector$1.z);return t},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[3],s=r[6],u=r[1],l=r[4],c=r[7],h=r[2],f=r[5],d=r[8],p=n[0],m=n[3],v=n[6],g=n[1],y=n[4],_=n[7],b=n[2],x=n[5],w=n[8];return i[0]=a*p+o*g+s*b,i[3]=a*m+o*y+s*x,i[6]=a*v+o*_+s*w,i[1]=u*p+l*g+c*b,i[4]=u*m+l*y+c*x,i[7]=u*v+l*_+c*w,i[2]=h*p+f*g+d*b,i[5]=h*m+f*y+d*x,i[8]=h*v+f*_+d*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*a*l-e*o*u-r*i*l+r*o*s+n*i*u-n*a*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=t.elements,n=this.elements,i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=r[6],h=r[7],f=r[8],d=f*u-l*h,p=l*c-f*s,m=h*s-u*c,v=i*d+a*p+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return n[0]=d*y,n[1]=(o*h-f*a)*y,n[2]=(l*a-o*u)*y,n[3]=p*y,n[4]=(f*i-o*c)*y,n[5]=(o*s-l*i)*y,n[6]=m*y,n[7]=(a*c-h*i)*y,n[8]=(u*i-a*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,a,o){var s=Math.cos(i),u=Math.sin(i);this.set(r*s,r*u,-r*(s*a+u*o)+a+t,-n*u,n*s,-n*(-u*a+s*o)+o+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],a=n[3],o=n[6],s=n[1],u=n[4],l=n[7];return n[0]=e*i+r*s,n[3]=e*a+r*u,n[6]=e*o+r*l,n[1]=-r*i+e*s,n[4]=-r*a+e*u,n[7]=-r*o+e*l,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var ImageUtils={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===_canvas&&(_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_canvas.width=t.width,_canvas.height=t.height;var r=_canvas.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=_canvas}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},textureId=0;function Texture(t,e,r,n,i,a,o,s,u,l){Object.defineProperty(this,"id",{value:textureId++}),this.uuid=_Math.generateUUID(),this.name="",this.image=void 0!==t?t:Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Texture.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:ClampToEdgeWrapping,this.wrapT=void 0!==n?n:ClampToEdgeWrapping,this.magFilter=void 0!==i?i:LinearFilter,this.minFilter=void 0!==a?a:LinearMipmapLinearFilter,this.anisotropy=void 0!==u?u:1,this.format=void 0!==o?o:RGBAFormat,this.internalFormat=null,this.type=void 0!==s?s:UnsignedByteType,this.offset=new Vector2$3(0,0),this.repeat=new Vector2$3(1,1),this.center=new Vector2$3(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==l?l:LinearEncoding,this.version=0,this.onUpdate=null}function Vector4(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function WebGLRenderTarget(t,e,r){this.width=t,this.height=e,this.scissor=new Vector4(0,0,t,e),this.scissorTest=!1,this.viewport=new Vector4(0,0,t,e),this.texture=new Texture(void 0,void 0,(r=r||{}).wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function WebGLMultisampleRenderTarget(t,e,r){WebGLRenderTarget.call(this,t,e,r),this.samples=4}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=UVMapping,Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=_Math.generateUUID()),!e&&void 0===t.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var a=0,o=n.length;a<o;a++)i.push(ImageUtils.getDataURL(n[a]))}else i=ImageUtils.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==UVMapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case RepeatWrapping$2:t.x=t.x-Math.floor(t.x);break;case ClampToEdgeWrapping:t.x=t.x<0?0:1;break;case MirroredRepeatWrapping:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case RepeatWrapping$2:t.y=t.y-Math.floor(t.y);break;case ClampToEdgeWrapping:t.y=t.y<0?0:1;break;case MirroredRepeatWrapping:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Texture.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(Vector4.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Vector4.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*r+a[8]*n+a[12]*i,this.y=a[1]*e+a[5]*r+a[9]*n+a[13]*i,this.z=a[2]*e+a[6]*r+a[10]*n+a[14]*i,this.w=a[3]*e+a[7]*r+a[11]*n+a[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,a=.01,o=.1,s=t.elements,u=s[0],l=s[4],c=s[8],h=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(l-h)<a&&Math.abs(c-p)<a&&Math.abs(d-m)<a){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(d+m)<o&&Math.abs(u+f+v-3)<o)return this.set(1,0,0,0),this;e=Math.PI;var g=(u+1)/2,y=(f+1)/2,_=(v+1)/2,b=(l+h)/4,x=(c+p)/4,w=(d+m)/4;return g>y&&g>_?g<a?(r=0,n=.707106781,i=.707106781):(n=b/(r=Math.sqrt(g)),i=x/r):y>_?y<a?(r=.707106781,n=0,i=.707106781):(r=b/(n=Math.sqrt(y)),i=w/n):_<a?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(_)),n=w/i),this.set(r,n,i,e),this}var M=Math.sqrt((m-d)*(m-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(M)<.001&&(M=1),this.x=(m-d)/M,this.y=(c-p)/M,this.z=(h-l)/M,this.w=Math.acos((u+f+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}}),WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),WebGLMultisampleRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultisampleRenderTarget,isWebGLMultisampleRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.samples=t.samples,this}});var _v1=new Vector3$1,_m1=new Matrix4$2,_zero=new Vector3$1(0,0,0),_one=new Vector3$1(1,1,1),_x=new Vector3$1,_y=new Vector3$1,_z=new Vector3$1;function Matrix4$2(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Matrix4$2.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=r,v[12]=n,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=u,v[6]=l,v[10]=c,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Matrix4$2).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/_v1.setFromMatrixColumn(t,0).length(),i=1/_v1.setFromMatrixColumn(t,1).length(),a=1/_v1.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,a=Math.cos(r),o=Math.sin(r),s=Math.cos(n),u=Math.sin(n),l=Math.cos(i),c=Math.sin(i);if("XYZ"===t.order){var h=a*l,f=a*c,d=o*l,p=o*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=f+d*u,e[5]=h-p*u,e[9]=-o*s,e[2]=p-h*u,e[6]=d+f*u,e[10]=a*s}else if("YXZ"===t.order){var m=s*c,v=u*l;e[0]=(g=s*l)+(y=u*c)*o,e[4]=v*o-m,e[8]=a*u,e[1]=a*c,e[5]=a*l,e[9]=-o,e[2]=m*o-v,e[6]=y+g*o,e[10]=a*s}else if("ZXY"===t.order){var g,y;m=s*c,v=u*l,e[0]=(g=s*l)-(y=u*c)*o,e[4]=-a*c,e[8]=v+m*o,e[1]=m+v*o,e[5]=a*l,e[9]=y-g*o,e[2]=-a*u,e[6]=o,e[10]=a*s}else if("ZYX"===t.order)h=a*l,f=a*c,d=o*l,p=o*c,e[0]=s*l,e[4]=d*u-f,e[8]=h*u+p,e[1]=s*c,e[5]=p*u+h,e[9]=f*u-d,e[2]=-u,e[6]=o*s,e[10]=a*s;else if("YZX"===t.order){var _=a*s,b=a*u,x=o*s,w=o*u;e[0]=s*l,e[4]=w-_*c,e[8]=x*c+b,e[1]=c,e[5]=a*l,e[9]=-o*l,e[2]=-u*l,e[6]=b*c+x,e[10]=_-w*c}else"XZY"===t.order&&(_=a*s,b=a*u,x=o*s,w=o*u,e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=_*c+w,e[5]=a*l,e[9]=b*c-x,e[2]=x*c-b,e[6]=o*l,e[10]=w*c+_);return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(_zero,t,_one)},lookAt:function(t,e,r){var n=this.elements;return _z.subVectors(t,e),0===_z.lengthSq()&&(_z.z=1),_z.normalize(),_x.crossVectors(r,_z),0===_x.lengthSq()&&(1===Math.abs(r.z)?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(r,_z)),_x.normalize(),_y.crossVectors(_z,_x),n[0]=_x.x,n[4]=_y.x,n[8]=_z.x,n[1]=_x.y,n[5]=_y.y,n[9]=_z.y,n[2]=_x.z,n[6]=_y.z,n[10]=_z.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,a=r[0],o=r[4],s=r[8],u=r[12],l=r[1],c=r[5],h=r[9],f=r[13],d=r[2],p=r[6],m=r[10],v=r[14],g=r[3],y=r[7],_=r[11],b=r[15],x=n[0],w=n[4],M=n[8],A=n[12],E=n[1],S=n[5],T=n[9],C=n[13],O=n[2],P=n[6],L=n[10],I=n[14],k=n[3],R=n[7],D=n[11],B=n[15];return i[0]=a*x+o*E+s*O+u*k,i[4]=a*w+o*S+s*P+u*R,i[8]=a*M+o*T+s*L+u*D,i[12]=a*A+o*C+s*I+u*B,i[1]=l*x+c*E+h*O+f*k,i[5]=l*w+c*S+h*P+f*R,i[9]=l*M+c*T+h*L+f*D,i[13]=l*A+c*C+h*I+f*B,i[2]=d*x+p*E+m*O+v*k,i[6]=d*w+p*S+m*P+v*R,i[10]=d*M+p*T+m*L+v*D,i[14]=d*A+p*C+m*I+v*B,i[3]=g*x+y*E+_*O+b*k,i[7]=g*w+y*S+_*P+b*R,i[11]=g*M+y*T+_*L+b*D,i[15]=g*A+y*C+_*I+b*B,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(t){for(var e=0,r=t.count;e<r;e++)_v1.x=t.getX(e),_v1.y=t.getY(e),_v1.z=t.getZ(e),_v1.applyMatrix4(this),t.setXYZ(e,_v1.x,_v1.y,_v1.z);return t},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],a=t[1],o=t[5],s=t[9],u=t[13],l=t[2],c=t[6],h=t[10],f=t[14];return t[3]*(+i*s*c-n*u*c-i*o*h+r*u*h+n*o*f-r*s*f)+t[7]*(+e*s*f-e*u*h+i*a*h-n*a*f+n*u*l-i*s*l)+t[11]*(+e*u*c-e*o*f-i*a*c+r*a*f+i*o*l-r*u*l)+t[15]*(-n*o*l-e*s*c+e*o*h+n*a*c-r*a*h+r*s*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){var r=this.elements,n=t.elements,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],f=n[8],d=n[9],p=n[10],m=n[11],v=n[12],g=n[13],y=n[14],_=n[15],b=d*y*h-g*p*h+g*c*m-l*y*m-d*c*_+l*p*_,x=v*p*h-f*y*h-v*c*m+u*y*m+f*c*_-u*p*_,w=f*g*h-v*d*h+v*l*m-u*g*m-f*l*_+u*d*_,M=v*d*c-f*g*c-v*l*p+u*g*p+f*l*y-u*d*y,A=i*b+a*x+o*w+s*M;if(0===A){var E="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===e)throw new Error(E);return console.warn(E),this.identity()}var S=1/A;return r[0]=b*S,r[1]=(g*p*s-d*y*s-g*o*m+a*y*m+d*o*_-a*p*_)*S,r[2]=(l*y*s-g*c*s+g*o*h-a*y*h-l*o*_+a*c*_)*S,r[3]=(d*c*s-l*p*s-d*o*h+a*p*h+l*o*m-a*c*m)*S,r[4]=x*S,r[5]=(f*y*s-v*p*s+v*o*m-i*y*m-f*o*_+i*p*_)*S,r[6]=(v*c*s-u*y*s-v*o*h+i*y*h+u*o*_-i*c*_)*S,r[7]=(u*p*s-f*c*s+f*o*h-i*p*h-u*o*m+i*c*m)*S,r[8]=w*S,r[9]=(v*d*s-f*g*s-v*a*m+i*g*m+f*a*_-i*d*_)*S,r[10]=(u*g*s-v*l*s+v*a*h-i*g*h-u*a*_+i*l*_)*S,r[11]=(f*l*s-u*d*s-f*a*h+i*d*h+u*a*m-i*l*m)*S,r[12]=M*S,r[13]=(f*g*o-v*d*o+v*a*p-i*g*p-f*a*y+i*d*y)*S,r[14]=(v*l*o-u*g*o-v*a*c+i*g*c+u*a*y-i*l*y)*S,r[15]=(u*d*o-f*l*o+f*a*c-i*d*c-u*a*p+i*l*p)*S,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements;return Math.sqrt(Math.max(t[0]*t[0]+t[1]*t[1]+t[2]*t[2],t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t[8]*t[8]+t[9]*t[9]+t[10]*t[10]))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,a=t.x,o=t.y,s=t.z,u=i*a,l=i*o;return this.set(u*a+r,u*o-n*s,u*s+n*o,0,u*o+n*s,l*o+r,l*s-n*a,0,u*s-n*o,l*s+n*a,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,a=e._y,o=e._z,s=e._w,u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,d=i*c,p=a*l,m=a*c,v=o*c,g=s*u,y=s*l,_=s*c,b=r.x,x=r.y,w=r.z;return n[0]=(1-(p+v))*b,n[1]=(f+_)*b,n[2]=(d-y)*b,n[3]=0,n[4]=(f-_)*x,n[5]=(1-(h+v))*x,n[6]=(m+g)*x,n[7]=0,n[8]=(d+y)*w,n[9]=(m-g)*w,n[10]=(1-(h+p))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,i=_v1.set(n[0],n[1],n[2]).length(),a=_v1.set(n[4],n[5],n[6]).length(),o=_v1.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],_m1.copy(this);var s=1/i,u=1/a,l=1/o;return _m1.elements[0]*=s,_m1.elements[1]*=s,_m1.elements[2]*=s,_m1.elements[4]*=u,_m1.elements[5]*=u,_m1.elements[6]*=u,_m1.elements[8]*=l,_m1.elements[9]*=l,_m1.elements[10]*=l,e.setFromRotationMatrix(_m1),r.x=i,r.y=a,r.z=o,this},makePerspective:function(t,e,r,n,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(r-n),u=(e+t)/(e-t),l=(r+n)/(r-n),c=-(a+i)/(a-i),h=-2*a*i/(a-i);return o[0]=2*i/(e-t),o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=s,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(t,e,r,n,i,a){var o=this.elements,s=1/(e-t),u=1/(r-n),l=1/(a-i),c=(e+t)*s,h=(r+n)*u,f=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var _matrix=new Matrix4$2,_quaternion$1=new Quaternion;function Euler(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||Euler.DefaultOrder}function Layers(){this.mask=1}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Euler.DefaultOrder="XYZ",Object.defineProperties(Euler.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(Euler.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=_Math.clamp,i=t.elements,a=i[0],o=i[4],s=i[8],u=i[1],l=i[5],c=i[9],h=i[2],f=i[6],d=i[10];return"XYZ"===(e=e||this._order)?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(f,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===e?(this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===e?(this._z=Math.asin(n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===e?(this._z=Math.asin(-n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return _matrix.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_matrix,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return _quaternion$1.setFromEuler(this),this.setFromQuaternion(_quaternion$1,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Vector3$1(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(Layers.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});var _object3DId=0,_v1$1=new Vector3$1,_q1=new Quaternion,_m1$1=new Matrix4$2,_target=new Vector3$1,_position=new Vector3$1,_scale=new Vector3$1,_quaternion$2=new Quaternion,_xAxis=new Vector3$1(1,0,0),_yAxis=new Vector3$1(0,1,0),_zAxis=new Vector3$1(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};function Object3D(){Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();var t=new Vector3$1,e=new Euler,r=new Quaternion,n=new Vector3$1(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4$2},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4$2,this.matrixWorld=new Matrix4$2,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Scene(){Object3D.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object3D.DefaultUp=new Vector3$1(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.multiply(_q1),this},rotateOnWorldAxis:function(t,e){return _q1.setFromAxisAngle(t,e),this.quaternion.premultiply(_q1),this},rotateX:function(t){return this.rotateOnAxis(_xAxis,t)},rotateY:function(t){return this.rotateOnAxis(_yAxis,t)},rotateZ:function(t){return this.rotateOnAxis(_zAxis,t)},translateOnAxis:function(t,e){return _v1$1.copy(t).applyQuaternion(this.quaternion),this.position.add(_v1$1.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(_xAxis,t)},translateY:function(t){return this.translateOnAxis(_yAxis,t)},translateZ:function(t){return this.translateOnAxis(_zAxis,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(_m1$1.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?_target.copy(t):_target.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),_position.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position,_target,this.up):_m1$1.lookAt(_target,_position,this.up),this.quaternion.setFromRotationMatrix(_m1$1),n&&(_m1$1.extractRotation(n.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(_removedEvent)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),_m1$1.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(t.parent.matrixWorld)),t.applyMatrix(_m1$1),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Vector3$1),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Quaternion),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,t,_scale),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Vector3$1),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_position,_quaternion$2,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Vector3$1),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var n=this.children,i=0,a=n.length;i<a;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++)i(t.shapes,o[s]);else i(t.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(s=0,u=this.material.length;s<u;s++)l.push(i(t.materials,this.material[s]));n.material=l}else n.material=i(t.materials,this.material);if(this.children.length>0)for(n.children=[],s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object);if(e){var c=p(t.geometries),h=p(t.materials),f=p(t.textures),d=p(t.images);o=p(t.shapes),c.length>0&&(r.geometries=c),h.length>0&&(r.materials=h),f.length>0&&(r.textures=f),d.length>0&&(r.images=d),o.length>0&&(r.shapes=o)}return r.object=n,r;function p(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}),Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,isScene:!0,copy:function(t,e){return Object3D.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Object3D.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _points=[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],_vector$2=new Vector3$1,_box=new Box3,_v0=new Vector3$1,_v1$2=new Vector3$1,_v2=new Vector3$1,_f0=new Vector3$1,_f1=new Vector3$1,_f2=new Vector3$1,_center=new Vector3$1,_extents=new Vector3$1,_triangleNormal=new Vector3$1,_testAxis=new Vector3$1;function Box3(t,e){this.min=void 0!==t?t:new Vector3$1(1/0,1/0,1/0),this.max=void 0!==e?e:new Vector3$1(-1/0,-1/0,-1/0)}function satForAxes(t,e,r,n,i){var a,o;for(a=0,o=t.length-3;a<=o;a+=3){_testAxis.fromArray(t,a);var s=i.x*Math.abs(_testAxis.x)+i.y*Math.abs(_testAxis.y)+i.z*Math.abs(_testAxis.z),u=e.dot(_testAxis),l=r.dot(_testAxis),c=n.dot(_testAxis);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}Object.assign(Box3.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=t.length;s<u;s+=3){var l=t[s],c=t[s+1],h=t[s+2];l<e&&(e=l),c<r&&(r=c),h<n&&(n=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,n),this.max.set(i,a,o),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=t.count;s<u;s++){var l=t.getX(s),c=t.getY(s),h=t.getZ(s);l<e&&(e=l),c<r&&(r=c),h<n&&(n=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(e,r,n),this.max.set(i,a,o),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=_vector$2.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Vector3$1),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Vector3$1),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),_box.copy(e.boundingBox),_box.applyMatrix4(t.matrixWorld),this.expandByPoint(_box.min),this.expandByPoint(_box.max));for(var r=t.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Vector3$1),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,_vector$2),_vector$2.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0.subVectors(t.a,_center),_v1$2.subVectors(t.b,_center),_v2.subVectors(t.c,_center),_f0.subVectors(_v1$2,_v0),_f1.subVectors(_v2,_v1$2),_f2.subVectors(_v0,_v2);var e=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!!satForAxes(e,_v0,_v1$2,_v2,_extents)&&!!satForAxes(e=[1,0,0,0,1,0,0,0,1],_v0,_v1$2,_v2,_extents)&&(_triangleNormal.crossVectors(_f0,_f1),satForAxes(e=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],_v0,_v1$2,_v2,_extents))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Vector3$1),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return _vector$2.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(_vector$2).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_points)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var _box$1=new Box3;function Sphere(t,e){this.center=void 0!==t?t:new Vector3$1,this.radius=void 0!==e?e:0}Object.assign(Sphere.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var r=this.center;void 0!==e?r.copy(e):_box$1.setFromPoints(t).getCenter(r);for(var n=0,i=0,a=t.length;i<a;i++)n=Math.max(n,r.distanceToSquared(t[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Vector3$1),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Box3),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var _vector$3=new Vector3$1,_segCenter=new Vector3$1,_segDir=new Vector3$1,_diff=new Vector3$1,_edge1=new Vector3$1,_edge2=new Vector3$1,_normal=new Vector3$1;function Ray(t,e){this.origin=void 0!==t?t:new Vector3$1,this.direction=void 0!==e?e:new Vector3$1(0,0,-1)}Object.assign(Ray.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Vector3$1),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,_vector$3)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Vector3$1),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=_vector$3.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(_vector$3.copy(this.direction).multiplyScalar(e).add(this.origin),_vector$3.distanceToSquared(t))},distanceSqToSegment:function(t,e,r,n){_segCenter.copy(t).add(e).multiplyScalar(.5),_segDir.copy(e).sub(t).normalize(),_diff.copy(this.origin).sub(_segCenter);var i,a,o,s,u=.5*t.distanceTo(e),l=-this.direction.dot(_segDir),c=_diff.dot(this.direction),h=-_diff.dot(_segDir),f=_diff.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(a=l*c-h,s=u*d,(i=l*h-c)>=0)if(a>=-s)if(a<=s){var p=1/d;o=(i*=p)*(i+l*(a*=p)+2*c)+a*(l*i+a+2*h)+f}else a=u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;else a=-u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;else a<=-s?o=-(i=Math.max(0,-(-l*u+c)))*i+(a=i>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+f:a<=s?(i=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+f):o=-(i=Math.max(0,-(l*u+c)))*i+(a=i>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+f;else a=l>0?-u:u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(_segDir).multiplyScalar(a).add(_segCenter),o},intersectSphere:function(t,e){_vector$3.subVectors(t.center,this.origin);var r=_vector$3.dot(this.direction),n=_vector$3.dot(_vector$3)-r*r,i=t.radius*t.radius;if(n>i)return null;var a=Math.sqrt(i-n),o=r-a,s=r+a;return o<0&&s<0?null:this.at(o<0?s:o,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(r=(t.min.x-h.x)*u,n=(t.max.x-h.x)*u):(r=(t.max.x-h.x)*u,n=(t.min.x-h.x)*u),l>=0?(i=(t.min.y-h.y)*l,a=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,a=(t.min.y-h.y)*l),r>a||i>n?null:((i>r||r!=r)&&(r=i),(a<n||n!=n)&&(n=a),c>=0?(o=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(o=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),r>s||o>n?null:((o>r||r!=r)&&(r=o),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,_vector$3)},intersectTriangle:function(t,e,r,n,i){_edge1.subVectors(e,t),_edge2.subVectors(r,t),_normal.crossVectors(_edge1,_edge2);var a,o=this.direction.dot(_normal);if(o>0){if(n)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}_diff.subVectors(this.origin,t);var s=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(s<0)return null;var u=a*this.direction.dot(_edge1.cross(_diff));if(u<0)return null;if(s+u>o)return null;var l=-a*_diff.dot(_normal);return l<0?null:this.at(l/o,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var _vector1=new Vector3$1,_vector2=new Vector3$1,_normalMatrix=new Matrix3;function Plane(t,e){this.normal=void 0!==t?t:new Vector3$1(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Plane.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,r){var n=_vector1.subVectors(r,e).cross(_vector2.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Vector3$1),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Vector3$1);var r=t.delta(_vector1),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:e.copy(r).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Vector3$1),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var r=e||_normalMatrix.getNormalMatrix(t),n=this.coplanarPoint(_vector1).applyMatrix4(t),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var _v0$1=new Vector3$1,_v1$3=new Vector3$1,_v2$1=new Vector3$1,_v3=new Vector3$1,_vab=new Vector3$1,_vac=new Vector3$1,_vbc=new Vector3$1,_vap=new Vector3$1,_vbp=new Vector3$1,_vcp=new Vector3$1;function Triangle(t,e,r){this.a=void 0!==t?t:new Vector3$1,this.b=void 0!==e?e:new Vector3$1,this.c=void 0!==r?r:new Vector3$1}Object.assign(Triangle,{getNormal:function(t,e,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Vector3$1),n.subVectors(r,e),_v0$1.subVectors(t,e),n.cross(_v0$1);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(t,e,r,n,i){_v0$1.subVectors(n,e),_v1$3.subVectors(r,e),_v2$1.subVectors(t,e);var a=_v0$1.dot(_v0$1),o=_v0$1.dot(_v1$3),s=_v0$1.dot(_v2$1),u=_v1$3.dot(_v1$3),l=_v1$3.dot(_v2$1),c=a*u-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Vector3$1),0===c)return i.set(-2,-1,-1);var h=1/c,f=(u*s-o*l)*h,d=(a*l-o*s)*h;return i.set(1-f-d,d,f)},containsPoint:function(t,e,r,n){return Triangle.getBarycoord(t,e,r,n,_v3),_v3.x>=0&&_v3.y>=0&&_v3.x+_v3.y<=1},getUV:function(t,e,r,n,i,a,o,s){return this.getBarycoord(t,e,r,n,_v3),s.set(0,0),s.addScaledVector(i,_v3.x),s.addScaledVector(a,_v3.y),s.addScaledVector(o,_v3.z),s},isFrontFacing:function(t,e,r,n){return _v0$1.subVectors(r,e),_v1$3.subVectors(t,e),_v0$1.cross(_v1$3).dot(n)<0}}),Object.assign(Triangle.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),.5*_v0$1.cross(_v1$3).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Vector3$1),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return Triangle.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Plane),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return Triangle.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,r,n,i){return Triangle.getUV(t,this.a,this.b,this.c,e,r,n,i)},containsPoint:function(t){return Triangle.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return Triangle.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Vector3$1);var r,n,i=this.a,a=this.b,o=this.c;_vab.subVectors(a,i),_vac.subVectors(o,i),_vap.subVectors(t,i);var s=_vab.dot(_vap),u=_vac.dot(_vap);if(s<=0&&u<=0)return e.copy(i);_vbp.subVectors(t,a);var l=_vab.dot(_vbp),c=_vac.dot(_vbp);if(l>=0&&c<=l)return e.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return r=s/(s-l),e.copy(i).addScaledVector(_vab,r);_vcp.subVectors(t,o);var f=_vab.dot(_vcp),d=_vac.dot(_vcp);if(d>=0&&f<=d)return e.copy(o);var p=f*u-s*d;if(p<=0&&u>=0&&d<=0)return n=u/(u-d),e.copy(i).addScaledVector(_vac,n);var m=l*d-f*c;if(m<=0&&c-l>=0&&f-d>=0)return _vbc.subVectors(o,a),n=(c-l)/(c-l+(f-d)),e.copy(a).addScaledVector(_vbc,n);var v=1/(m+p+h);return r=p*v,n=h*v,e.copy(i).addScaledVector(_vab,r).addScaledVector(_vac,n)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function Color$c(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}function SRGBToLinear(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function LinearToSRGB(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function Face3(t,e,r,n,i,a){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new Vector3$1,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new Color$c,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(Color$c.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(t,e,r){if(t=_Math.euclideanModulo(t,1),e=_Math.clamp(e,0,1),r=_Math.clamp(r,0,1),0===e)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=hue2rgb(i,n,t+1/3),this.g=hue2rgb(i,n,t),this.b=hue2rgb(i,n,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[2];switch(r[1]){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(i)){var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,o,s)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var u=r[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=_colorKeywords[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=SRGBToLinear(t.r),this.g=SRGBToLinear(t.g),this.b=SRGBToLinear(t.b),this},copyLinearToSRGB:function(t){return this.r=LinearToSRGB(t.r),this.g=LinearToSRGB(t.g),this.b=LinearToSRGB(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,a=this.b,o=Math.max(n,i,a),s=Math.min(n,i,a),u=(s+o)/2;if(s===o)e=0,r=0;else{var l=o-s;switch(r=u<=.5?l/(o+s):l/(2-o-s),o){case n:e=(i-a)/l+(i<a?6:0);break;case i:e=(a-n)/l+2;break;case a:e=(n-i)/l+4}e/=6}return t.h=e,t.s=r,t.l=u,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){return this.getHSL(_hslA),_hslA.h+=t,_hslA.s+=e,_hslA.l+=r,this.setHSL(_hslA.h,_hslA.s,_hslA.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(_hslA),t.getHSL(_hslB);var r=_Math.lerp(_hslA.h,_hslB.h,e),n=_Math.lerp(_hslA.s,_hslB.s,e),i=_Math.lerp(_hslA.l,_hslB.l,e);return this.setHSL(r,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),Color$c.NAMES=_colorKeywords,Object.assign(Face3.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++}),this.uuid=_Math.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=NormalBlending,this.side=FrontSide,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=NoColors,this.opacity=1,this.transparent=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function MeshBasicMaterial(t){Material.call(this),this.type="MeshBasicMaterial",this.color=new Color$c(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===FlatShading;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==FrontSide&&(r.side=this.side),this.vertexColors!==NoColors&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),a=n(t.images);i.length>0&&(r.textures=i),a.length>0&&(r.images=a)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Material.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),MeshBasicMaterial.prototype=Object.create(Material.prototype),MeshBasicMaterial.prototype.constructor=MeshBasicMaterial,MeshBasicMaterial.prototype.isMeshBasicMaterial=!0,MeshBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var _vector$4=new Vector3$1;function BufferAttribute$1(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}function Int8BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Int8Array(t),e,r)}function Uint8BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Uint8Array(t),e,r)}function Uint8ClampedBufferAttribute(t,e,r){BufferAttribute$1.call(this,new Uint8ClampedArray(t),e,r)}function Int16BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Int16Array(t),e,r)}function Uint16BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Uint16Array(t),e,r)}function Int32BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Int32Array(t),e,r)}function Uint32BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Uint32Array(t),e,r)}function Float32BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Float32Array(t),e,r)}function Float64BufferAttribute(t,e,r){BufferAttribute$1.call(this,new Float64Array(t),e,r)}function DirectGeometry(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function arrayMax(t){if(0===t.length)return-1/0;for(var e=t[0],r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}Object.defineProperty(BufferAttribute$1.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(BufferAttribute$1.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),a=new Color$c),e[r++]=a.r,e[r++]=a.g,e[r++]=a.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),a=new Vector2$3),e[r++]=a.x,e[r++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),a=new Vector3$1),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var a=t[n];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),a=new Vector4),e[r++]=a.x,e[r++]=a.y,e[r++]=a.z,e[r++]=a.w}return this},applyMatrix3:function(t){for(var e=0,r=this.count;e<r;e++)_vector$4.x=this.getX(e),_vector$4.y=this.getY(e),_vector$4.z=this.getZ(e),_vector$4.applyMatrix3(t),this.setXYZ(e,_vector$4.x,_vector$4.y,_vector$4.z);return this},applyMatrix4:function(t){for(var e=0,r=this.count;e<r;e++)_vector$4.x=this.getX(e),_vector$4.y=this.getY(e),_vector$4.z=this.getZ(e),_vector$4.applyMatrix4(t),this.setXYZ(e,_vector$4.x,_vector$4.y,_vector$4.z);return this},applyNormalMatrix:function(t){for(var e=0,r=this.count;e<r;e++)_vector$4.x=this.getX(e),_vector$4.y=this.getY(e),_vector$4.z=this.getZ(e),_vector$4.applyNormalMatrix(t),this.setXYZ(e,_vector$4.x,_vector$4.y,_vector$4.z);return this},transformDirection:function(t){for(var e=0,r=this.count;e<r;e++)_vector$4.x=this.getX(e),_vector$4.y=this.getY(e),_vector$4.z=this.getZ(e),_vector$4.transformDirection(t),this.setXYZ(e,_vector$4.x,_vector$4.y,_vector$4.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.array[0+(t*=this.itemSize)]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Int8BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Int8BufferAttribute.prototype.constructor=Int8BufferAttribute,Uint8BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute,Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute,Int16BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Int16BufferAttribute.prototype.constructor=Int16BufferAttribute,Uint16BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute,Int32BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Int32BufferAttribute.prototype.constructor=Int32BufferAttribute,Uint32BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute,Float32BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Float32BufferAttribute.prototype.constructor=Float32BufferAttribute,Float64BufferAttribute.prototype=Object.create(BufferAttribute$1.prototype),Float64BufferAttribute.prototype.constructor=Float64BufferAttribute,Object.assign(DirectGeometry.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==n&&(n=o.materialIndex,void 0!==e&&(e.count=3*a-e.start,r.push(e)),e={start:3*a,materialIndex:n})}void 0!==e&&(e.count=3*a-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphTargets,u=s.length;if(u>0){e=[];for(var l=0;l<u;l++)e[l]={name:s[l].name,data:[]};this.morphTargets.position=e}var c,h=t.morphNormals,f=h.length;if(f>0){for(c=[],l=0;l<f;l++)c[l]={name:h[l].name,data:[]};this.morphTargets.normal=c}var d=t.skinIndices,p=t.skinWeights,m=d.length===n.length,v=p.length===n.length;for(n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),l=0;l<r.length;l++){var g=r[l];this.vertices.push(n[g.a],n[g.b],n[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=g.normal;this.normals.push(_,_,_)}var b,x=g.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=g.color;this.colors.push(w,w,w)}!0===a&&(void 0!==(b=i[0][l])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",l),this.uvs.push(new Vector2$3,new Vector2$3,new Vector2$3))),!0===o&&(void 0!==(b=i[1][l])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",l),this.uvs2.push(new Vector2$3,new Vector2$3,new Vector2$3)));for(var M=0;M<u;M++){var A=s[M].vertices;e[M].data.push(A[g.a],A[g.b],A[g.c])}for(M=0;M<f;M++){var E=h[M].vertexNormals[l];c[M].data.push(E.a,E.b,E.c)}m&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(p[g.a],p[g.b],p[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var _bufferGeometryId=1,_m1$2=new Matrix4$2,_obj=new Object3D,_offset=new Vector3$1,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$5=new Vector3$1;function BufferGeometry$1(){Object.defineProperty(this,"id",{value:_bufferGeometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}BufferGeometry$1.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry$1,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){this.index=Array.isArray(t)?new(arrayMax(t)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(t,1):t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new Matrix3).getNormalMatrix(t);r.applyNormalMatrix(n),r.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return _m1$2.makeRotationX(t),this.applyMatrix(_m1$2),this},rotateY:function(t){return _m1$2.makeRotationY(t),this.applyMatrix(_m1$2),this},rotateZ:function(t){return _m1$2.makeRotationZ(t),this.applyMatrix(_m1$2),this},translate:function(t,e,r){return _m1$2.makeTranslation(t,e,r),this.applyMatrix(_m1$2),this},scale:function(t,e,r){return _m1$2.makeScale(t,e,r),this.applyMatrix(_m1$2),this},lookAt:function(t){return _obj.lookAt(t),_obj.updateMatrix(),this.applyMatrix(_obj.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new Float32BufferAttribute(3*e.vertices.length,3),n=new Float32BufferAttribute(3*e.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Float32BufferAttribute(e.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Float32BufferAttribute(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new DirectGeometry).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new BufferAttribute$1(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.setAttribute("normal",new BufferAttribute$1(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.setAttribute("color",new BufferAttribute$1(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new BufferAttribute$1(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var a=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new BufferAttribute$1(a,2).copyVector2sArray(t.uvs2))}for(var o in this.groups=t.groups,t.morphTargets){for(var s=[],u=t.morphTargets[o],l=0,c=u.length;l<c;l++){var h=u[l],f=new Float32BufferAttribute(3*h.data.length,3);f.name=h.name,s.push(f.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(t.skinIndices.length>0){var d=new Float32BufferAttribute(4*t.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var p=new Float32BufferAttribute(4*t.skinWeights.length,4);this.setAttribute("skinWeight",p.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++)_box$2.setFromBufferAttribute(e[r]),this.morphTargetsRelative?(_vector$5.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$5),_vector$5.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$5)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var r=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++)_boxMorphTargets.setFromBufferAttribute(o=e[n]),this.morphTargetsRelative?(_vector$5.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$5),_vector$5.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$5)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max));_box$2.getCenter(r);var a=0;for(n=0,i=t.count;n<i;n++)_vector$5.fromBufferAttribute(t,n),a=Math.max(a,r.distanceToSquared(_vector$5));if(e)for(n=0,i=e.length;n<i;n++)for(var o,s=this.morphTargetsRelative,u=0,l=(o=e[n]).count;u<l;u++)_vector$5.fromBufferAttribute(o,u),s&&(_offset.fromBufferAttribute(t,u),_vector$5.add(_offset)),a=Math.max(a,r.distanceToSquared(_vector$5));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new BufferAttribute$1(new Float32Array(r.length),3));else for(var n=e.normal.array,i=0,a=n.length;i<a;i++)n[i]=0;var o,s,u,l=e.normal.array,c=new Vector3$1,h=new Vector3$1,f=new Vector3$1,d=new Vector3$1,p=new Vector3$1;if(t){var m=t.array;for(i=0,a=t.count;i<a;i+=3)s=3*m[i+1],u=3*m[i+2],c.fromArray(r,o=3*m[i+0]),h.fromArray(r,s),f.fromArray(r,u),d.subVectors(f,h),p.subVectors(c,h),d.cross(p),l[o]+=d.x,l[o+1]+=d.y,l[o+2]+=d.z,l[s]+=d.x,l[s+1]+=d.y,l[s+2]+=d.z,l[u]+=d.x,l[u+1]+=d.y,l[u+2]+=d.z}else for(i=0,a=r.length;i<a;i+=9)c.fromArray(r,i),h.fromArray(r,i+3),f.fromArray(r,i+6),d.subVectors(f,h),p.subVectors(c,h),d.cross(p),l[i]=d.x,l[i+1]=d.y,l[i+2]=d.z,l[i+3]=d.x,l[i+4]=d.y,l[i+5]=d.z,l[i+6]=d.x,l[i+7]=d.y,l[i+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,a=t.attributes[n],o=a.array,s=a.itemSize*e,u=Math.min(o.length,i.length-s),l=0,c=s;l<u;l++,c++)i[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,r=t.count;e<r;e++)_vector$5.x=t.getX(e),_vector$5.y=t.getY(e),_vector$5.z=t.getZ(e),_vector$5.normalize(),t.setXYZ(e,_vector$5.x,_vector$5.y,_vector$5.z)},toNonIndexed:function(){function t(t,e){for(var r=t.array,n=t.itemSize,i=new r.constructor(e.length*n),a=0,o=0,s=0,u=e.length;s<u;s++){a=e[s]*n;for(var l=0;l<n;l++)i[o++]=r[a++]}return new BufferAttribute$1(i,n)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new BufferGeometry$1,r=this.index.array,n=this.attributes;for(var i in n){var a=t(n[i],r);e.setAttribute(i,a)}var o=this.morphAttributes;for(i in o){for(var s=[],u=o[i],l=0,c=u.length;l<c;l++)a=t(u[l],r),s.push(a);e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,f=(l=0,h.length);l<f;l++){var d=h[l];e.addGroup(d.start,d.count,d.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;null!==n&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var a=(f=i[r]).toJSON();""!==f.name&&(a.name=f.name),t.data.attributes[r]=a}var o={},s=!1;for(var r in this.morphAttributes){for(var u=this.morphAttributes[r],l=[],c=0,h=u.length;c<h;c++){var f;a=(f=u[c]).toJSON(),""!==f.name&&(a.name=f.name),l.push(a)}l.length>0&&(o[r]=l,s=!0)}s&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var p=this.boundingSphere;return null!==p&&(t.data.boundingSphere={center:p.center.toArray(),radius:p.radius}),t},clone:function(){return(new BufferGeometry$1).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var a=t.attributes;for(e in a)this.setAttribute(e,a[e].clone());var o=t.morphAttributes;for(e in o){var s=[],u=o[e];for(r=0,n=u.length;r<n;r++)s.push(u[r].clone());this.morphAttributes[e]=s}this.morphTargetsRelative=t.morphTargetsRelative;var l=t.groups;for(r=0,n=l.length;r<n;r++){var c=l[r];this.addGroup(c.start,c.count,c.materialIndex)}var h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());var f=t.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var _inverseMatrix=new Matrix4$2,_ray=new Ray,_sphere=new Sphere,_vA=new Vector3$1,_vB=new Vector3$1,_vC=new Vector3$1,_tempA=new Vector3$1,_tempB=new Vector3$1,_tempC=new Vector3$1,_morphA=new Vector3$1,_morphB=new Vector3$1,_morphC=new Vector3$1,_uvA=new Vector2$3,_uvB=new Vector2$3,_uvC=new Vector2$3,_intersectionPoint=new Vector3$1,_intersectionPointWorld=new Vector3$1;function Mesh(t,e){Object3D.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new BufferGeometry$1,this.material=void 0!==e?e:new MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()}function checkIntersection(t,e,r,n,i,a,o,s){if(null===(e.side===BackSide?n.intersectTriangle(o,a,i,!0,s):n.intersectTriangle(i,a,o,e.side!==DoubleSide$c,s)))return null;_intersectionPointWorld.copy(s),_intersectionPointWorld.applyMatrix4(t.matrixWorld);var u=r.ray.origin.distanceTo(_intersectionPointWorld);return u<r.near||u>r.far?null:{distance:u,point:_intersectionPointWorld.clone(),object:t}}function checkBufferGeometryIntersection(t,e,r,n,i,a,o,s,u,l,c,h){_vA.fromBufferAttribute(i,l),_vB.fromBufferAttribute(i,c),_vC.fromBufferAttribute(i,h);var f=t.morphTargetInfluences;if(e.morphTargets&&a&&f){_morphA.set(0,0,0),_morphB.set(0,0,0),_morphC.set(0,0,0);for(var d=0,p=a.length;d<p;d++){var m=f[d],v=a[d];0!==m&&(_tempA.fromBufferAttribute(v,l),_tempB.fromBufferAttribute(v,c),_tempC.fromBufferAttribute(v,h),o?(_morphA.addScaledVector(_tempA,m),_morphB.addScaledVector(_tempB,m),_morphC.addScaledVector(_tempC,m)):(_morphA.addScaledVector(_tempA.sub(_vA),m),_morphB.addScaledVector(_tempB.sub(_vB),m),_morphC.addScaledVector(_tempC.sub(_vC),m)))}_vA.add(_morphA),_vB.add(_morphB),_vC.add(_morphC)}var g=checkIntersection(t,e,r,n,_vA,_vB,_vC,_intersectionPoint);if(g){s&&(_uvA.fromBufferAttribute(s,l),_uvB.fromBufferAttribute(s,c),_uvC.fromBufferAttribute(s,h),g.uv=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2$3)),u&&(_uvA.fromBufferAttribute(u,l),_uvB.fromBufferAttribute(u,c),_uvC.fromBufferAttribute(u,h),g.uv2=Triangle.getUV(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2$3));var y=new Face3(l,c,h);Triangle.getNormal(_vA,_vB,_vC,y.normal),g.face=y}return g}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var r,n=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),_sphere.copy(n.boundingSphere),_sphere.applyMatrix4(a),!1!==t.ray.intersectsSphere(_sphere)&&(_inverseMatrix.getInverse(a),_ray.copy(t.ray).applyMatrix4(_inverseMatrix),null===n.boundingBox||!1!==_ray.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var o,s,u,l,c,h,f,d,p,m=n.index,v=n.attributes.position,g=n.morphAttributes.position,y=n.morphTargetsRelative,_=n.attributes.uv,b=n.attributes.uv2,x=n.groups,w=n.drawRange;if(null!==m)if(Array.isArray(i))for(l=0,h=x.length;l<h;l++)for(p=i[(d=x[l]).materialIndex],c=Math.max(d.start,w.start),f=Math.min(d.start+d.count,w.start+w.count);c<f;c+=3)o=m.getX(c),s=m.getX(c+1),u=m.getX(c+2),(r=checkBufferGeometryIntersection(this,p,t,_ray,v,g,y,_,b,o,s,u))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(l=Math.max(0,w.start),h=Math.min(m.count,w.start+w.count);l<h;l+=3)o=m.getX(l),s=m.getX(l+1),u=m.getX(l+2),(r=checkBufferGeometryIntersection(this,i,t,_ray,v,g,y,_,b,o,s,u))&&(r.faceIndex=Math.floor(l/3),e.push(r));else if(void 0!==v)if(Array.isArray(i))for(l=0,h=x.length;l<h;l++)for(p=i[(d=x[l]).materialIndex],c=Math.max(d.start,w.start),f=Math.min(d.start+d.count,w.start+w.count);c<f;c+=3)(r=checkBufferGeometryIntersection(this,p,t,_ray,v,g,y,_,b,o=c,s=c+1,u=c+2))&&(r.faceIndex=Math.floor(c/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(l=Math.max(0,w.start),h=Math.min(v.count,w.start+w.count);l<h;l+=3)(r=checkBufferGeometryIntersection(this,i,t,_ray,v,g,y,_,b,o=l,s=l+1,u=l+2))&&(r.faceIndex=Math.floor(l/3),e.push(r))}else if(n.isGeometry){var M,A,E,S,T=Array.isArray(i),C=n.vertices,O=n.faces,P=n.faceVertexUvs[0];P.length>0&&(S=P);for(var L=0,I=O.length;L<I;L++){var k=O[L],R=T?i[k.materialIndex]:i;if(void 0!==R&&(r=checkIntersection(this,R,t,_ray,M=C[k.a],A=C[k.b],E=C[k.c],_intersectionPoint))){if(S&&S[L]){var D=S[L];_uvA.copy(D[0]),_uvB.copy(D[1]),_uvC.copy(D[2]),r.uv=Triangle.getUV(_intersectionPoint,M,A,E,_uvA,_uvB,_uvC,new Vector2$3)}r.face=k,r.faceIndex=L,e.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _geometryId=0,_m1$3=new Matrix4$2,_obj$1=new Object3D,_offset$1=new Vector3$1;function Geometry$2(){Object.defineProperty(this,"id",{value:_geometryId+=2}),this.uuid=_Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Geometry$2.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry$2,isGeometry:!0,applyMatrix:function(t){for(var e=(new Matrix3).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++)this.vertices[r].applyMatrix4(t);for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return _m1$3.makeRotationX(t),this.applyMatrix(_m1$3),this},rotateY:function(t){return _m1$3.makeRotationY(t),this.applyMatrix(_m1$3),this},rotateZ:function(t){return _m1$3.makeRotationZ(t),this.applyMatrix(_m1$3),this},translate:function(t,e,r){return _m1$3.makeTranslation(t,e,r),this.applyMatrix(_m1$3),this},scale:function(t,e,r){return _m1$3.makeScale(t,e,r),this.applyMatrix(_m1$3),this},lookAt:function(t){return _obj$1.lookAt(t),_obj$1.updateMatrix(),this.applyMatrix(_obj$1.matrix),this},fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,a=void 0!==n.normal?n.normal.array:void 0,o=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,u=void 0!==n.uv2?n.uv2.array:void 0;void 0!==u&&(this.faceVertexUvs[1]=[]);for(var l=0;l<i.length;l+=3)e.vertices.push((new Vector3$1).fromArray(i,l)),void 0!==o&&e.colors.push((new Color$c).fromArray(o,l));function c(t,r,n,i){var l=void 0===o?[]:[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()],c=new Face3(t,r,n,void 0===a?[]:[(new Vector3$1).fromArray(a,3*t),(new Vector3$1).fromArray(a,3*r),(new Vector3$1).fromArray(a,3*n)],l,i);e.faces.push(c),void 0!==s&&e.faceVertexUvs[0].push([(new Vector2$3).fromArray(s,2*t),(new Vector2$3).fromArray(s,2*r),(new Vector2$3).fromArray(s,2*n)]),void 0!==u&&e.faceVertexUvs[1].push([(new Vector2$3).fromArray(u,2*t),(new Vector2$3).fromArray(u,2*r),(new Vector2$3).fromArray(u,2*n)])}var h=t.groups;if(h.length>0)for(l=0;l<h.length;l++)for(var f=h[l],d=f.start,p=d,m=d+f.count;p<m;p+=3)void 0!==r?c(r[p],r[p+1],r[p+2],f.materialIndex):c(p,p+1,p+2,f.materialIndex);else if(void 0!==r)for(l=0;l<r.length;l+=3)c(r[l],r[l+1],r[l+2]);else for(l=0;l<i.length/3;l+=3)c(l,l+1,l+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$1).negate(),this.translate(_offset$1.x,_offset$1.y,_offset$1.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new Matrix4$2;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix(n),this},computeFaceNormals:function(){for(var t=new Vector3$1,e=new Vector3$1,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],a=this.vertices[i.a],o=this.vertices[i.b];t.subVectors(this.vertices[i.c],o),e.subVectors(a,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,a,o;for(void 0===t&&(t=!0),o=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)o[e]=new Vector3$1;if(t){var s,u,l=new Vector3$1,c=new Vector3$1;for(n=0,i=this.faces.length;n<i;n++)s=this.vertices[(a=this.faces[n]).a],l.subVectors(this.vertices[a.c],u=this.vertices[a.b]),c.subVectors(s,u),l.cross(c),o[a.a].add(l),o[a.b].add(l),o[a.c].add(l)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)o[(a=this.faces[n]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(e=0,r=this.vertices.length;e<r;e++)o[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var h=(a=this.faces[n]).vertexNormals;3===h.length?(h[0].copy(o[a.a]),h[1].copy(o[a.b]),h[2].copy(o[a.c])):(h[0]=o[a.a].clone(),h[1]=o[a.b].clone(),h[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var a=new Geometry$2;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var o=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)u=new Vector3$1,l={a:new Vector3$1,b:new Vector3$1,c:new Vector3$1},o.push(u),s.push(l)}var u,l,c=this.morphNormals[t];for(a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)l=c.vertexNormals[r],(u=c.faceNormals[r]).copy((i=this.faces[r]).normal),l.a.copy(i.vertexNormals[0]),l.b.copy(i.vertexNormals[1]),l.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,u=t.faces,l=this.colors,c=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new Matrix3).getNormalMatrix(e));for(var h=0,f=o.length;h<f;h++){var d=o[h].clone();void 0!==e&&d.applyMatrix4(e),a.push(d)}for(h=0,f=c.length;h<f;h++)l.push(c[h].clone());for(h=0,f=u.length;h<f;h++){var p,m,v=u[h],g=v.vertexNormals,y=v.vertexColors;(p=new Face3(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==n&&p.normal.applyMatrix3(n).normalize();for(var _=0,b=g.length;_<b;_++)m=g[_].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),p.vertexNormals.push(m);for(p.color.copy(v.color),_=0,b=y.length;_<b;_++)p.vertexColors.push(y[_].clone());p.materialIndex=v.materialIndex+r,s.push(p)}for(h=0,f=t.faceVertexUvs.length;h<f;h++){var x=t.faceVertexUvs[h];for(void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]),_=0,b=x.length;_<b;_++){for(var w=x[_],M=[],A=0,E=w.length;A<E;A++)M.push(w[A].clone());this.faceVertexUvs[h].push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,a,o,s,u={},l=[],c=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===u[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(u[e]=r,l.push(this.vertices[r]),c[r]=l.length-1):c[r]=c[u[e]];var f=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=c[i.a],i.b=c[i.b],i.c=c[i.c],a=[i.a,i.b,i.c];for(var d=0;d<3;d++)if(a[d]===a[(d+1)%3]){f.push(r);break}}for(r=f.length-1;r>=0;r--){var p=f[r];for(this.faces.splice(p,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(p,1)}var m=this.vertices.length-l.length;return this.vertices=l,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new Vector3$1(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var n,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];for(a&&a.length===e&&(n=[]),o&&o.length===e&&(i=[]),r=0;r<e;r++){var s=t[r]._id;n&&n.push(a[s]),i&&i.push(o[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];n.push(a.x,a.y,a.z)}var o=[],s=[],u={},l=[],c={},h=[],f={};for(i=0;i<this.faces.length;i++){var d=this.faces[i],p=void 0!==this.faceVertexUvs[0][i],m=d.normal.length()>0,v=d.vertexNormals.length>0,g=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,_=0;if(_=M(_,0,0),_=M(_,1,!0),_=M(_,2,!1),_=M(_,3,p),_=M(_,4,m),_=M(_,5,v),_=M(_,6,g),_=M(_,7,y),o.push(_),o.push(d.a,d.b,d.c),o.push(d.materialIndex),p){var b=this.faceVertexUvs[0][i];o.push(S(b[0]),S(b[1]),S(b[2]))}if(m&&o.push(A(d.normal)),v){var x=d.vertexNormals;o.push(A(x[0]),A(x[1]),A(x[2]))}if(g&&o.push(E(d.color)),y){var w=d.vertexColors;o.push(E(w[0]),E(w[1]),E(w[2]))}}function M(t,e,r){return r?t|1<<e:t&~(1<<e)}function A(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==u[e]||(u[e]=s.length/3,s.push(t.x,t.y,t.z)),u[e]}function E(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]||(c[e]=l.length,l.push(t.getHex())),c[e]}function S(t){var e=t.x.toString()+t.y.toString();return void 0!==f[e]||(f[e]=h.length/2,h.push(t.x,t.y)),f[e]}return t.data={},t.data.vertices=n,t.data.normals=s,l.length>0&&(t.data.colors=l),h.length>0&&(t.data.uvs=[h]),t.data.faces=o,t},clone:function(){return(new Geometry$2).copy(this)},copy:function(t){var e,r,n,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var u=t.colors;for(e=0,r=u.length;e<r;e++)this.colors.push(u[e].clone());var l=t.faces;for(e=0,r=l.length;e<r;e++)this.faces.push(l[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=c.length;n<i;n++){var h=c[n],f=[];for(a=0,o=h.length;a<o;a++)f.push(h[a].clone());this.faceVertexUvs[e].push(f)}}var d=t.morphTargets;for(e=0,r=d.length;e<r;e++){var p={};if(p.name=d[e].name,void 0!==d[e].vertices)for(p.vertices=[],n=0,i=d[e].vertices.length;n<i;n++)p.vertices.push(d[e].vertices[n].clone());if(void 0!==d[e].normals)for(p.normals=[],n=0,i=d[e].normals.length;n<i;n++)p.normals.push(d[e].normals[n].clone());this.morphTargets.push(p)}var m=t.morphNormals;for(e=0,r=m.length;e<r;e++){var v={};if(void 0!==m[e].vertexNormals)for(v.vertexNormals=[],n=0,i=m[e].vertexNormals.length;n<i;n++){var g=m[e].vertexNormals[n],y={};y.a=g.a.clone(),y.b=g.b.clone(),y.c=g.c.clone(),v.vertexNormals.push(y)}if(void 0!==m[e].faceNormals)for(v.faceNormals=[],n=0,i=m[e].faceNormals.length;n<i;n++)v.faceNormals.push(m[e].faceNormals[n].clone());this.morphNormals.push(v)}var _=t.skinWeights;for(e=0,r=_.length;e<r;e++)this.skinWeights.push(_[e].clone());var b=t.skinIndices;for(e=0,r=b.length;e<r;e++)this.skinIndices.push(b[e].clone());var x=t.lineDistances;for(e=0,r=x.length;e<r;e++)this.lineDistances.push(x[e]);var w=t.boundingBox;null!==w&&(this.boundingBox=w.clone());var M=t.boundingSphere;return null!==M&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class BoxGeometry extends Geometry$2{constructor(t,e,r,n,i,a){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new BoxBufferGeometry(t,e,r,n,i,a)),this.mergeVertices()}}class BoxBufferGeometry extends BufferGeometry$1{constructor(t,e,r,n,i,a){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:a};var o=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;var s=[],u=[],l=[],c=[],h=0,f=0;function d(t,e,r,n,i,a,d,p,m,v,g){var y,_,b=a/m,x=d/v,w=a/2,M=d/2,A=p/2,E=m+1,S=v+1,T=0,C=0,O=new Vector3$1;for(_=0;_<S;_++){var P=_*x-M;for(y=0;y<E;y++)O[t]=(y*b-w)*n,O[e]=P*i,O[r]=A,u.push(O.x,O.y,O.z),O[t]=0,O[e]=0,O[r]=p>0?1:-1,l.push(O.x,O.y,O.z),c.push(y/m),c.push(1-_/v),T+=1}for(_=0;_<v;_++)for(y=0;y<m;y++){var L=h+y+E*(_+1),I=h+(y+1)+E*(_+1),k=h+(y+1)+E*_;s.push(h+y+E*_,L,k),s.push(L,I,k),C+=6}o.addGroup(f,C,g),f+=C,h+=T}d("z","y","x",-1,-1,r,e,t,a,i,0),d("z","y","x",1,-1,r,e,-t,a,i,1),d("x","z","y",1,1,t,r,e,n,a,2),d("x","z","y",1,-1,t,r,-e,n,a,3),d("x","y","z",1,-1,t,e,r,n,i,4),d("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}}function cloneUniforms(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];e[r][n]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?i.clone():Array.isArray(i)?i.slice():i}return e}function mergeUniforms(t){for(var e={},r=0;r<t.length;r++){var n=cloneUniforms(t[r]);for(var i in n)e[i]=n[i]}return e}var UniformsUtils={clone:cloneUniforms,merge:mergeUniforms},default_vertex="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",default_fragment="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function ShaderMaterial$c(t){Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Camera(){Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new Matrix4$2,this.projectionMatrix=new Matrix4$2,this.projectionMatrixInverse=new Matrix4$2}function PerspectiveCamera(t,e,r,n){Camera.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ShaderMaterial$c.prototype=Object.create(Material.prototype),ShaderMaterial$c.prototype.constructor=ShaderMaterial$c,ShaderMaterial$c.prototype.isShaderMaterial=!0,ShaderMaterial$c.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=cloneUniforms(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},ShaderMaterial$c.prototype.toJSON=function(t){var e=Material.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var n=this.uniforms[r].value;e.uniforms[r]=n&&n.isTexture?{type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?{type:"c",value:n.getHex()}:n&&n.isVector2?{type:"v2",value:n.toArray()}:n&&n.isVector3?{type:"v3",value:n.toArray()}:n&&n.isVector4?{type:"v4",value:n.toArray()}:n&&n.isMatrix3?{type:"m3",value:n.toArray()}:n&&n.isMatrix4?{type:"m4",value:n.toArray()}:{value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function(t,e){return Object3D.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Vector3$1),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function(t,e){return Camera.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*_Math.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*_Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*_Math.RAD2DEG*Math.atan(Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*_Math.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*n/o,e-=a.offsetY*r/s,n*=a.width/o,r*=a.height/s}var u=this.filmOffset;0!==u&&(i+=t*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Object3D.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var fov=90,aspect=1;function CubeCamera(t,e,r,n){Object3D.call(this),this.type="CubeCamera";var i=new PerspectiveCamera(fov,aspect,t,e);i.up.set(0,-1,0),i.lookAt(new Vector3$1(1,0,0)),this.add(i);var a=new PerspectiveCamera(fov,aspect,t,e);a.up.set(0,-1,0),a.lookAt(new Vector3$1(-1,0,0)),this.add(a);var o=new PerspectiveCamera(fov,aspect,t,e);o.up.set(0,0,1),o.lookAt(new Vector3$1(0,1,0)),this.add(o);var s=new PerspectiveCamera(fov,aspect,t,e);s.up.set(0,0,-1),s.lookAt(new Vector3$1(0,-1,0)),this.add(s);var u=new PerspectiveCamera(fov,aspect,t,e);u.up.set(0,-1,0),u.lookAt(new Vector3$1(0,0,1)),this.add(u);var l=new PerspectiveCamera(fov,aspect,t,e);l.up.set(0,-1,0),l.lookAt(new Vector3$1(0,0,-1)),this.add(l),this.renderTarget=new WebGLRenderTargetCube(r,r,n=n||{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter}),this.renderTarget.texture.name="CubeCamera",this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var r=t.getRenderTarget(),n=this.renderTarget,c=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,a),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,s),t.setRenderTarget(n,4),t.render(e,u),n.texture.generateMipmaps=c,t.setRenderTarget(n,5),t.render(e,l),t.setRenderTarget(r)},this.clear=function(t,e,r,n){for(var i=t.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)t.setRenderTarget(a,o),t.clear(e,r,n);t.setRenderTarget(i)}}function WebGLRenderTargetCube(t,e,r){WebGLRenderTarget.call(this,t,e,r)}function DataTexture(t,e,r,n,i,a,o,s,u,l,c,h){Texture.call(this,null,a,o,s,u,l,n,i,c,h),this.image={data:t||null,width:e||1,height:r||1},this.magFilter=void 0!==u?u:NearestFilter,this.minFilter=void 0!==l?l:NearestFilter,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}CubeCamera.prototype=Object.create(Object3D.prototype),CubeCamera.prototype.constructor=CubeCamera,WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype),WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube,WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0,WebGLRenderTargetCube.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var r=new Scene,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new ShaderMaterial$c({type:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});i.uniforms.tEquirect.value=e;var a=new Mesh(new BoxBufferGeometry(5,5,5),i);r.add(a);var o=new CubeCamera(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(t,r),a.geometry.dispose(),a.material.dispose(),this},DataTexture.prototype=Object.create(Texture.prototype),DataTexture.prototype.constructor=DataTexture,DataTexture.prototype.isDataTexture=!0;var _sphere$1=new Sphere,_vector$6=new Vector3$1;function Frustum(t,e,r,n,i,a){this.planes=[void 0!==t?t:new Plane,void 0!==e?e:new Plane,void 0!==r?r:new Plane,void 0!==n?n:new Plane,void 0!==i?i:new Plane,void 0!==a?a:new Plane]}Object.assign(Frustum.prototype,{set:function(t,e,r,n,i,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(r),o[3].copy(n),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],h=r[8],f=r[9],d=r[10],p=r[11],m=r[12],v=r[13],g=r[14],y=r[15];return e[0].setComponents(o-n,c-s,p-h,y-m).normalize(),e[1].setComponents(o+n,c+s,p+h,y+m).normalize(),e[2].setComponents(o+i,c+u,p+f,y+v).normalize(),e[3].setComponents(o-i,c-u,p-f,y-v).normalize(),e[4].setComponents(o-a,c-l,p-d,y-g).normalize(),e[5].setComponents(o+a,c+l,p+d,y+g).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),_sphere$1.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)},intersectsSprite:function(t){return _sphere$1.center.set(0,0,0),_sphere$1.radius=.7071067811865476,_sphere$1.applyMatrix4(t.matrixWorld),this.intersectsSphere(_sphere$1)},intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++)if(e[i].distanceToPoint(r)<n)return!1;return!0},intersectsBox:function(t){for(var e=this.planes,r=0;r<6;r++){var n=e[r];if(_vector$6.x=n.normal.x>0?t.max.x:t.min.x,_vector$6.y=n.normal.y>0?t.max.y:t.min.y,_vector$6.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(_vector$6)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex="vec3 transformed = vec3( position );",beginnormal_vertex="vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs="vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex="#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common$1="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex="vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ), 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment="#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_vertex="#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex="#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex="#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment="#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment="#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin="uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",envmap_physical_pars_fragment="#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",lights_toon_fragment="ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment="#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps="#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin="#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps="#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment="#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex="vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment="#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment="#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment="#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment="#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment="#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex="#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex="#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag="uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert="varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag="#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag="uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert="varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag="#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert="#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag="#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert="#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag="#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert="uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",ShaderChunk={alphamap_fragment:alphamap_fragment,alphamap_pars_fragment:alphamap_pars_fragment,alphatest_fragment:alphatest_fragment,aomap_fragment:aomap_fragment,aomap_pars_fragment:aomap_pars_fragment,begin_vertex:begin_vertex,beginnormal_vertex:beginnormal_vertex,bsdfs:bsdfs,bumpmap_pars_fragment:bumpmap_pars_fragment,clipping_planes_fragment:clipping_planes_fragment,clipping_planes_pars_fragment:clipping_planes_pars_fragment,clipping_planes_pars_vertex:clipping_planes_pars_vertex,clipping_planes_vertex:clipping_planes_vertex,color_fragment:color_fragment,color_pars_fragment:color_pars_fragment,color_pars_vertex:color_pars_vertex,color_vertex:color_vertex,common:common$1,cube_uv_reflection_fragment:cube_uv_reflection_fragment,defaultnormal_vertex:defaultnormal_vertex,displacementmap_pars_vertex:displacementmap_pars_vertex,displacementmap_vertex:displacementmap_vertex,emissivemap_fragment:emissivemap_fragment,emissivemap_pars_fragment:emissivemap_pars_fragment,encodings_fragment:encodings_fragment,encodings_pars_fragment:encodings_pars_fragment,envmap_fragment:envmap_fragment,envmap_common_pars_fragment:envmap_common_pars_fragment,envmap_pars_fragment:envmap_pars_fragment,envmap_pars_vertex:envmap_pars_vertex,envmap_physical_pars_fragment:envmap_physical_pars_fragment,envmap_vertex:envmap_vertex,fog_vertex:fog_vertex,fog_pars_vertex:fog_pars_vertex,fog_fragment:fog_fragment,fog_pars_fragment:fog_pars_fragment,gradientmap_pars_fragment:gradientmap_pars_fragment,lightmap_fragment:lightmap_fragment,lightmap_pars_fragment:lightmap_pars_fragment,lights_lambert_vertex:lights_lambert_vertex,lights_pars_begin:lights_pars_begin,lights_toon_fragment:lights_toon_fragment,lights_toon_pars_fragment:lights_toon_pars_fragment,lights_phong_fragment:lights_phong_fragment,lights_phong_pars_fragment:lights_phong_pars_fragment,lights_physical_fragment:lights_physical_fragment,lights_physical_pars_fragment:lights_physical_pars_fragment,lights_fragment_begin:lights_fragment_begin,lights_fragment_maps:lights_fragment_maps,lights_fragment_end:lights_fragment_end,logdepthbuf_fragment:logdepthbuf_fragment,logdepthbuf_pars_fragment:logdepthbuf_pars_fragment,logdepthbuf_pars_vertex:logdepthbuf_pars_vertex,logdepthbuf_vertex:logdepthbuf_vertex,map_fragment:map_fragment,map_pars_fragment:map_pars_fragment,map_particle_fragment:map_particle_fragment,map_particle_pars_fragment:map_particle_pars_fragment,metalnessmap_fragment:metalnessmap_fragment,metalnessmap_pars_fragment:metalnessmap_pars_fragment,morphnormal_vertex:morphnormal_vertex,morphtarget_pars_vertex:morphtarget_pars_vertex,morphtarget_vertex:morphtarget_vertex,normal_fragment_begin:normal_fragment_begin,normal_fragment_maps:normal_fragment_maps,normalmap_pars_fragment:normalmap_pars_fragment,clearcoat_normal_fragment_begin:clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps:clearcoat_normal_fragment_maps,clearcoat_normalmap_pars_fragment:clearcoat_normalmap_pars_fragment,packing:packing,premultiplied_alpha_fragment:premultiplied_alpha_fragment,project_vertex:project_vertex,dithering_fragment:dithering_fragment,dithering_pars_fragment:dithering_pars_fragment,roughnessmap_fragment:roughnessmap_fragment,roughnessmap_pars_fragment:roughnessmap_pars_fragment,shadowmap_pars_fragment:shadowmap_pars_fragment,shadowmap_pars_vertex:shadowmap_pars_vertex,shadowmap_vertex:shadowmap_vertex,shadowmask_pars_fragment:shadowmask_pars_fragment,skinbase_vertex:skinbase_vertex,skinning_pars_vertex:skinning_pars_vertex,skinning_vertex:skinning_vertex,skinnormal_vertex:skinnormal_vertex,specularmap_fragment:specularmap_fragment,specularmap_pars_fragment:specularmap_pars_fragment,tonemapping_fragment:tonemapping_fragment,tonemapping_pars_fragment:tonemapping_pars_fragment,uv_pars_fragment:uv_pars_fragment,uv_pars_vertex:uv_pars_vertex,uv_vertex:uv_vertex,uv2_pars_fragment:uv2_pars_fragment,uv2_pars_vertex:uv2_pars_vertex,uv2_vertex:uv2_vertex,worldpos_vertex:worldpos_vertex,background_frag:background_frag,background_vert:background_vert,cube_frag:cube_frag,cube_vert:cube_vert,depth_frag:depth_frag,depth_vert:depth_vert,distanceRGBA_frag:distanceRGBA_frag,distanceRGBA_vert:distanceRGBA_vert,equirect_frag:equirect_frag,equirect_vert:equirect_vert,linedashed_frag:linedashed_frag,linedashed_vert:linedashed_vert,meshbasic_frag:meshbasic_frag,meshbasic_vert:meshbasic_vert,meshlambert_frag:meshlambert_frag,meshlambert_vert:meshlambert_vert,meshmatcap_frag:meshmatcap_frag,meshmatcap_vert:meshmatcap_vert,meshtoon_frag:meshtoon_frag,meshtoon_vert:meshtoon_vert,meshphong_frag:meshphong_frag,meshphong_vert:meshphong_vert,meshphysical_frag:meshphysical_frag,meshphysical_vert:meshphysical_vert,normal_frag:normal_frag,normal_vert:normal_vert,points_frag:points_frag,points_vert:points_vert,shadow_frag:shadow_frag,shadow_vert:shadow_vert,sprite_frag:sprite_frag,sprite_vert:sprite_vert},UniformsLib={common:{diffuse:{value:new Color$c(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2$3(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color$c(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color$c(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color$c(15658734)},opacity:{value:1},center:{value:new Vector2$3(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Matrix3}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$c(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$c(0)},specular:{value:new Color$c(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$c(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color$c(0)},specular:{value:new Color$c(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},cube:{uniforms:mergeUniforms([UniformsLib.envmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3$1},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color$c(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};function WebGLAnimation(){var t=null,e=!1,r=null;function n(i,a){!1!==e&&(r(i,a),t.requestAnimationFrame(n))}return{start:function(){!0!==e&&null!==r&&(t.requestAnimationFrame(n),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function WebGLAttributes(t){var e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);var n=e.get(r);n&&(t.deleteBuffer(n.buffer),e.delete(r))},update:function(r,n){r.isInterleavedBufferAttribute&&(r=r.data);var i=e.get(r);void 0===i?e.set(r,function(e,r){var n=e.array,i=e.usage,a=t.createBuffer();t.bindBuffer(r,a),t.bufferData(r,n,i),e.onUploadCallback();var o=5126;return n instanceof Float32Array?o=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?o=5123:n instanceof Int16Array?o=5122:n instanceof Uint32Array?o=5125:n instanceof Int32Array?o=5124:n instanceof Int8Array?o=5120:n instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(r,n)):i.version<r.version&&(function(e,r,n){var i=r.array,a=r.updateRange;t.bindBuffer(n,e),-1===a.count?t.bufferSubData(n,0,i):(t.bufferSubData(n,a.offset*i.BYTES_PER_ELEMENT,i.subarray(a.offset,a.offset+a.count)),a.count=-1)}(i.buffer,r,n),i.version=r.version)}}}function PlaneGeometry(t,e,r,n){Geometry$2.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new PlaneBufferGeometry(t,e,r,n)),this.mergeVertices()}function PlaneBufferGeometry(t,e,r,n){BufferGeometry$1.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,a,o=(t=t||1)/2,s=(e=e||1)/2,u=Math.floor(r)||1,l=Math.floor(n)||1,c=u+1,h=l+1,f=t/u,d=e/l,p=[],m=[],v=[],g=[];for(a=0;a<h;a++){var y=a*d-s;for(i=0;i<c;i++)m.push(i*f-o,-y,0),v.push(0,0,1),g.push(i/u),g.push(1-a/l)}for(a=0;a<l;a++)for(i=0;i<u;i++){var _=i+c*(a+1),b=i+1+c*(a+1),x=i+1+c*a;p.push(i+c*a,_,x),p.push(_,b,x)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}function WebGLBackground(t,e,r,n){var i,a,o=new Color$c(0),s=0,u=null,l=0;function c(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,n)}return{getClearColor:function(){return o},setClearColor:function(t,e){o.set(t),c(o,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){c(o,s=t)},render:function(e,n,h,f){var d=n.background,p=t.xr,m=p.getSession&&p.getSession();if(m&&"additive"===m.environmentBlendMode&&(d=null),null===d?(c(o,s),u=null,l=0):d&&d.isColor&&(c(d,1),f=!0,u=null,l=0),(t.autoClear||f)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLRenderTargetCube||d.mapping===CubeUVReflectionMapping)){void 0===a&&((a=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial$c({type:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.cube.uniforms),vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(a));var v=d.isWebGLRenderTargetCube?d.texture:d;a.material.uniforms.envMap.value=v,a.material.uniforms.flipEnvMap.value=v.isCubeTexture?-1:1,u===d&&l===v.version||(a.material.needsUpdate=!0,u=d,l=v.version),e.unshift(a,a.geometry,a.material,0,0,null)}else d&&d.isTexture&&(void 0===i&&((i=new Mesh(new PlaneBufferGeometry(2,2),new ShaderMaterial$c({type:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),i.material.uniforms.uvTransform.value.copy(d.matrix),u===d&&l===d.version||(i.material.needsUpdate=!0,u=d,l=d.version),e.unshift(i,i.geometry,i.material,0,0,null))}}}function WebGLBufferRenderer(t,e,r,n){var i,a=n.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,n){t.drawArrays(i,e,n),r.update(n,i)},this.renderInstances=function(n,o,s,u){if(0!==u){var l,c;if(a)l=t,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](i,o,s,u),r.update(s,i,u)}}}function WebGLCapabilities(t,e,r){var n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,o=void 0!==r.precision?r.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=!0===r.logarithmicDepthBuffer,l=t.getParameter(34930),c=t.getParameter(35660),h=t.getParameter(3379),f=t.getParameter(34076),d=t.getParameter(34921),p=t.getParameter(36347),m=t.getParameter(36348),v=t.getParameter(36349),g=c>0,y=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=e.get("EXT_texture_filter_anisotropic");return n=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:a?t.getParameter(36183):0}}function WebGLClipping(){var t=this,e=null,r=0,n=!1,i=!1,a=new Plane,o=new Matrix3,s={value:null,needsUpdate:!1};function u(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,r,n,i){var u=null!==e?e.length:0,l=null;if(0!==u){if(l=s.value,!0!==i||null===l){var c=n+4*u,h=r.matrixWorldInverse;o.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var f=0,d=n;f!==u;++f,d+=4)a.copy(e[f]).applyMatrix4(h,o),a.normal.toArray(l,d),l[d+3]=a.constant}s.value=l,s.needsUpdate=!0}return t.numPlanes=u,l}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,a){var o=0!==t.length||i||0!==r||n;return n=i,e=l(t,a,0),r=t.length,o},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,u()},this.setState=function(t,a,o,c,h,f){if(!n||null===t||0===t.length||i&&!o)i?l(null):u();else{var d=i?0:r,p=4*d,m=h.clippingState||null;s.value=m,m=l(t,c,p,f);for(var v=0;v!==p;++v)m[v]=e[v];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=d}}}function WebGLExtensions(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}function WebGLGeometries(t,e,r){var n=new WeakMap,i=new WeakMap;function a(t){var o=t.target,s=n.get(o);for(var u in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[u]);o.removeEventListener("dispose",a),n.delete(o);var l=i.get(s);l&&(e.remove(l),i.delete(s)),r.memory.geometries--}function o(t){var r=[],n=t.index,a=t.attributes.position,o=0;if(null!==n){o=n.version;for(var s=0,u=(l=n.array).length;s<u;s+=3)r.push(c=l[s+0],h=l[s+1],h,f=l[s+2],f,c)}else{var l;for(o=a.version,s=0,u=(l=a.array).length/3-1;s<u;s+=3){var c,h,f;r.push(c=s+0,h=s+1,h,f=s+2,f,c)}}var d=new(arrayMax(r)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(r,1);d.version=o,e.update(d,34963);var p=i.get(t);p&&e.remove(p),i.set(t,d)}return{get:function(t,e){var i=n.get(e);return i||(e.addEventListener("dispose",a),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new BufferGeometry$1).setFromObject(t)),i=e._bufferGeometry),n.set(e,i),r.memory.geometries++,i)},update:function(t){var r=t.index,n=t.attributes;for(var i in null!==r&&e.update(r,34963),n)e.update(n[i],34962);var a=t.morphAttributes;for(var i in a)for(var o=a[i],s=0,u=o.length;s<u;s++)e.update(o[s],34962)},getWireframeAttribute:function(t){var e=i.get(t);if(e){var r=t.index;null!==r&&e.version<r.version&&o(t)}else o(t);return i.get(t)}}}function WebGLIndexedBufferRenderer(t,e,r,n){var i,a,o,s=n.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(i,n,a,e*o),r.update(n,i)},this.renderInstances=function(n,u,l,c){if(0!==c){var h,f;if(s)h=t,f="drawElementsInstanced";else if(f="drawElementsInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](i,l,a,u*o,c),r.update(l,i,c)}}}function WebGLInfo(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,n){switch(n=n||1,e.calls++,r){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function absNumericalSort(t,e){return Math.abs(e[1])-Math.abs(t[1])}function WebGLMorphtargets(t){var e={},r=new Float32Array(8);return{update:function(n,i,a,o){var s=n.morphTargetInfluences,u=void 0===s?0:s.length,l=e[i.id];if(void 0===l){l=[];for(var c=0;c<u;c++)l[c]=[c,0];e[i.id]=l}var h=a.morphTargets&&i.morphAttributes.position,f=a.morphNormals&&i.morphAttributes.normal;for(c=0;c<u;c++)0!==(p=l[c])[1]&&(h&&i.deleteAttribute("morphTarget"+c),f&&i.deleteAttribute("morphNormal"+c));for(c=0;c<u;c++)(p=l[c])[0]=c,p[1]=s[c];l.sort(absNumericalSort);var d=0;for(c=0;c<8;c++){var p;if(p=l[c]){var m=p[0],v=p[1];if(v){h&&i.setAttribute("morphTarget"+c,h[m]),f&&i.setAttribute("morphNormal"+c,f[m]),r[c]=v,d+=v;continue}}r[c]=0}var g=i.morphTargetsRelative?1:1-d;o.getUniforms().setValue(t,"morphTargetBaseInfluence",g),o.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function WebGLObjects(t,e,r,n){var i={};return{update:function(t){var a=n.render.frame,o=t.geometry,s=e.get(t,o);return i[s.id]!==a&&(o.isGeometry&&s.updateFromObject(t),e.update(s),i[s.id]=a),t.isInstancedMesh&&r.update(t.instanceMatrix,34962),s},dispose:function(){i={}}}}function CubeTexture(t,e,r,n,i,a,o,s,u,l){Texture.call(this,t=void 0!==t?t:[],e=void 0!==e?e:CubeReflectionMapping,r,n,i,a,o=void 0!==o?o:RGBFormat,s,u,l),this.flipY=!1}function DataTexture2DArray(t,e,r,n){Texture.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function DataTexture3D(t,e,r,n){Texture.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Color$c(0)},clearcoatNormalScale:{value:new Vector2$3(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},PlaneGeometry.prototype=Object.create(Geometry$2.prototype),PlaneGeometry.prototype.constructor=PlaneGeometry,PlaneBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry,CubeTexture.prototype=Object.create(Texture.prototype),CubeTexture.prototype.constructor=CubeTexture,CubeTexture.prototype.isCubeTexture=!0,Object.defineProperty(CubeTexture.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),DataTexture2DArray.prototype=Object.create(Texture.prototype),DataTexture2DArray.prototype.constructor=DataTexture2DArray,DataTexture2DArray.prototype.isDataTexture2DArray=!0,DataTexture3D.prototype=Object.create(Texture.prototype),DataTexture3D.prototype.constructor=DataTexture3D,DataTexture3D.prototype.isDataTexture3D=!0;var emptyTexture=new Texture,emptyTexture2dArray=new DataTexture2DArray,emptyTexture3d=new DataTexture3D,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,a=arrayCacheF32[i];if(void 0===a&&(a=new Float32Array(i),arrayCacheF32[i]=a),0!==e){n.toArray(a,0);for(var o=1,s=0;o!==e;++o)t[o].toArray(a,s+=r)}return a}function arraysEqual(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function copyArray(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function allocTexUnits(t,e){var r=arrayCacheI32[e];void 0===r&&(r=new Int32Array(e),arrayCacheI32[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocateTextureUnit();return r}function setValueV1f(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function setValueV2f(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(arraysEqual(r,e))return;t.uniform2fv(this.addr,e),copyArray(r,e)}}function setValueV3f(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(arraysEqual(r,e))return;t.uniform3fv(this.addr,e),copyArray(r,e)}}function setValueV4f(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(arraysEqual(r,e))return;t.uniform4fv(this.addr,e),copyArray(r,e)}}function setValueM2(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),copyArray(r,e)}else{if(arraysEqual(r,n))return;mat2array.set(n),t.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(r,n)}}function setValueM3(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),copyArray(r,e)}else{if(arraysEqual(r,n))return;mat3array.set(n),t.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(r,n)}}function setValueM4(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(arraysEqual(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),copyArray(r,e)}else{if(arraysEqual(r,n))return;mat4array.set(n),t.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(r,n)}}function setValueT1(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(e||emptyTexture,i)}function setValueT2DArray1(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(e||emptyTexture2dArray,i)}function setValueT3D1(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(e||emptyTexture3d,i)}function setValueT6(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(e||emptyCubeTexture,i)}function setValueV1i(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function setValueV2i(t,e){var r=this.cache;arraysEqual(r,e)||(t.uniform2iv(this.addr,e),copyArray(r,e))}function setValueV3i(t,e){var r=this.cache;arraysEqual(r,e)||(t.uniform3iv(this.addr,e),copyArray(r,e))}function setValueV4i(t,e){var r=this.cache;arraysEqual(r,e)||(t.uniform4iv(this.addr,e),copyArray(r,e))}function getSingularSetter(t){switch(t){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 35678:case 36198:return setValueT1;case 35679:return setValueT3D1;case 35680:return setValueT6;case 36289:return setValueT2DArray1;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i}}function setValueV1fArray(t,e){t.uniform1fv(this.addr,e)}function setValueV1iArray(t,e){t.uniform1iv(this.addr,e)}function setValueV2iArray(t,e){t.uniform2iv(this.addr,e)}function setValueV3iArray(t,e){t.uniform3iv(this.addr,e)}function setValueV4iArray(t,e){t.uniform4iv(this.addr,e)}function setValueV2fArray(t,e){var r=flatten(e,this.size,2);t.uniform2fv(this.addr,r)}function setValueV3fArray(t,e){var r=flatten(e,this.size,3);t.uniform3fv(this.addr,r)}function setValueV4fArray(t,e){var r=flatten(e,this.size,4);t.uniform4fv(this.addr,r)}function setValueM2Array(t,e){var r=flatten(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,r)}function setValueM3Array(t,e){var r=flatten(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,r)}function setValueM4Array(t,e){var r=flatten(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,r)}function setValueT1Array(t,e,r){var n=e.length,i=allocTexUnits(r,n);t.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTexture2D(e[a]||emptyTexture,i[a])}function setValueT6Array(t,e,r){var n=e.length,i=allocTexUnits(r,n);t.uniform1iv(this.addr,i);for(var a=0;a!==n;++a)r.safeSetTextureCube(e[a]||emptyCubeTexture,i[a])}function getPureArraySetter(t){switch(t){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 35678:case 36198:case 36298:case 36306:return setValueT1Array;case 35680:case 36300:case 36308:return setValueT6Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray}}function SingleUniform(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=getSingularSetter(e.type)}function PureArrayUniform(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=getPureArraySetter(e.type)}function StructuredUniform(t){this.id=t,this.seq=[],this.map={}}PureArrayUniform.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),copyArray(e,t)},StructuredUniform.prototype.setValue=function(t,e,r){for(var n=this.seq,i=0,a=n.length;i!==a;++i){var o=n[i];o.setValue(t,e[o.id],r)}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(t,e){t.seq.push(e),t.map[e.id]=e}function parseUniform(t,e,r){var n=t.name,i=n.length;for(RePathPart.lastIndex=0;;){var a=RePathPart.exec(n),o=a[1],s=a[3];if("]"===a[2]&&(o|=0),void 0===s||"["===s&&RePathPart.lastIndex+2===i){addUniform(r,void 0===s?new SingleUniform(o,t,e):new PureArrayUniform(o,t,e));break}var u=r.map[o];void 0===u&&addUniform(r,u=new StructuredUniform(o)),r=u}}function WebGLUniforms(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),n=0;n<r;++n){var i=t.getActiveUniform(e,n);parseUniform(i,t.getUniformLocation(e,i.name),this)}}function WebGLShader(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}WebGLUniforms.prototype.setValue=function(t,e,r,n){var i=this.map[e];void 0!==i&&i.setValue(t,r,n)},WebGLUniforms.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},WebGLUniforms.upload=function(t,e,r,n){for(var i=0,a=e.length;i!==a;++i){var o=e[i],s=r[o.id];!1!==s.needsUpdate&&o.setValue(t,s.value,n)}},WebGLUniforms.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var a=t[n];a.id in e&&r.push(a)}return r};var programIdCount=0;function addLineNumbers(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}function getEncodingComponents(t){switch(t){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case LogLuvEncoding:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function getShaderErrors(t,e,r){var n=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+addLineNumbers(t.getShaderSource(e))}function getTexelDecodingFunction(t,e){var r=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function getTexelEncodingFunction(t,e){var r=getEncodingComponents(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+r[0]+r[1]+"; }"}function getToneMappingFunction(t,e){var r;switch(e){case LinearToneMapping:r="Linear";break;case ReinhardToneMapping:r="Reinhard";break;case Uncharted2ToneMapping:r="Uncharted2";break;case CineonToneMapping:r="OptimizedCineon";break;case ACESFilmicToneMapping:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function generateExtensions(t,e,r){return[(t=t||{}).derivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&r.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&r.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&r.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join("\n")}function generateDefines(t){var e=[];for(var r in t){var n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}function fetchAttributeLocations(t,e){for(var r={},n=t.getProgramParameter(e,35721),i=0;i<n;i++){var a=t.getActiveAttrib(e,i).name;r[a]=t.getAttribLocation(e,a)}return r}function filterEmptyLine(t){return""!==t}function replaceLightNums(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(t){return t.replace(includePattern,includeReplacer)}function includeReplacer(t,e){var r=ShaderChunk[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return resolveIncludes(r)}var loopPattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function unrollLoops(t){return t.replace(loopPattern,loopReplacer)}function loopReplacer(t,e,r,n){for(var i="",a=parseInt(e);a<parseInt(r);a++)i+=n.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function generatePrecision(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function generateShadowMapTypeDefine(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:e="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:e="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:e="ENVMAP_TYPE_SPHERE"}return e}function generateEnvMapModeDefine(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case CubeRefractionMapping:case EquirectangularRefractionMapping:e="ENVMAP_MODE_REFRACTION"}return e}function generateEnvMapBlendingDefine(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD"}return e}function WebGLProgram(t,e,r,n,i,a){var o,s,u=t.getContext(),l=n.defines,c=i.vertexShader,h=i.fragmentShader,f=generateShadowMapTypeDefine(a),d=generateEnvMapTypeDefine(a),p=generateEnvMapModeDefine(a),m=generateEnvMapBlendingDefine(a),v=t.gammaFactor>0?t.gammaFactor:1,g=a.isWebGL2?"":generateExtensions(n.extensions,a,e),y=generateDefines(l),_=u.createProgram(),b=a.numMultiviewViews;if(n.isRawShaderMaterial?((o=[y].filter(filterEmptyLine).join("\n")).length>0&&(o+="\n"),(s=[g,y].filter(filterEmptyLine).join("\n")).length>0&&(s+="\n")):(o=[generatePrecision(a),"#define SHADER_NAME "+i.name,y,a.instancing?"#define USE_INSTANCING":"",a.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+a.maxBones,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+p:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.displacementMap&&a.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.flatShading?"#define FLAT_SHADED":"",a.skinning?"#define USE_SKINNING":"",a.useVertexTexture?"#define BONE_TEXTURE":"",a.morphTargets?"#define USE_MORPHTARGETS":"",a.morphNormals&&!1===a.flatShading?"#define USE_MORPHNORMALS":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.sizeAttenuation?"#define USE_SIZEATTENUATION":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n"),s=[g,generatePrecision(a),"#define SHADER_NAME "+i.name,y,a.alphaTest?"#define ALPHATEST "+a.alphaTest+(a.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,a.useFog&&a.fog?"#define USE_FOG":"",a.useFog&&a.fogExp2?"#define FOG_EXP2":"",a.map?"#define USE_MAP":"",a.matcap?"#define USE_MATCAP":"",a.envMap?"#define USE_ENVMAP":"",a.envMap?"#define "+d:"",a.envMap?"#define "+p:"",a.envMap?"#define "+m:"",a.lightMap?"#define USE_LIGHTMAP":"",a.aoMap?"#define USE_AOMAP":"",a.emissiveMap?"#define USE_EMISSIVEMAP":"",a.bumpMap?"#define USE_BUMPMAP":"",a.normalMap?"#define USE_NORMALMAP":"",a.normalMap&&a.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",a.normalMap&&a.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",a.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",a.specularMap?"#define USE_SPECULARMAP":"",a.roughnessMap?"#define USE_ROUGHNESSMAP":"",a.metalnessMap?"#define USE_METALNESSMAP":"",a.alphaMap?"#define USE_ALPHAMAP":"",a.sheen?"#define USE_SHEEN":"",a.vertexTangents?"#define USE_TANGENT":"",a.vertexColors?"#define USE_COLOR":"",a.vertexUvs?"#define USE_UV":"",a.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",a.gradientMap?"#define USE_GRADIENTMAP":"",a.flatShading?"#define FLAT_SHADED":"",a.doubleSided?"#define DOUBLE_SIDED":"",a.flipSided?"#define FLIP_SIDED":"",a.shadowMapEnabled?"#define USE_SHADOWMAP":"",a.shadowMapEnabled?"#define "+f:"",a.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",a.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",a.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",a.logarithmicDepthBuffer&&(a.isWebGL2||e.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensions&&n.extensions.shaderTextureLOD||a.envMap)&&(a.isWebGL2||e.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",a.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",a.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",a.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",a.toneMapping):"",a.dithering?"#define DITHERING":"",a.outputEncoding||a.mapEncoding||a.matcapEncoding||a.envMapEncoding||a.emissiveMapEncoding||a.lightMapEncoding?ShaderChunk.encodings_pars_fragment:"",a.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",a.mapEncoding):"",a.matcapEncoding?getTexelDecodingFunction("matcapTexelToLinear",a.matcapEncoding):"",a.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",a.envMapEncoding):"",a.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",a.emissiveMapEncoding):"",a.lightMapEncoding?getTexelDecodingFunction("lightMapTexelToLinear",a.lightMapEncoding):"",a.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",a.outputEncoding):"",a.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")),c=replaceClippingPlaneNums(c=replaceLightNums(c=resolveIncludes(c),a),a),h=replaceClippingPlaneNums(h=replaceLightNums(h=resolveIncludes(h),a),a),c=unrollLoops(c),h=unrollLoops(h),a.isWebGL2&&!n.isRawShaderMaterial){var x=!1,w=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==c.match(w)&&null!==h.match(w)&&(x=!0,c=c.replace(w,""),h=h.replace(w,"")),o=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+o,s=["#version 300 es\n","#define varying in",x?"":"out highp vec4 pc_fragColor;",x?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+s,b>0&&(o=(o=o.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+b+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+b+"];","uniform mat4 projectionMatrices["+b+"];","uniform mat4 viewMatrices["+b+"];","uniform mat3 normalMatrices["+b+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),s=(s=s.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+b+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var M,A,E=s+h,S=WebGLShader(u,35633,o+c),T=WebGLShader(u,35632,E);if(u.attachShader(_,S),u.attachShader(_,T),void 0!==n.index0AttributeName?u.bindAttribLocation(_,0,n.index0AttributeName):!0===a.morphTargets&&u.bindAttribLocation(_,0,"position"),u.linkProgram(_),t.debug.checkShaderErrors){var C=u.getProgramInfoLog(_).trim(),O=u.getShaderInfoLog(S).trim(),P=u.getShaderInfoLog(T).trim(),L=!0,I=!0;if(!1===u.getProgramParameter(_,35714)){L=!1;var k=getShaderErrors(u,S,"vertex"),R=getShaderErrors(u,T,"fragment");console.error("THREE.WebGLProgram: shader error: ",u.getError(),"35715",u.getProgramParameter(_,35715),"gl.getProgramInfoLog",C,k,R)}else""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==O&&""!==P||(I=!1);I&&(this.diagnostics={runnable:L,material:n,programLog:C,vertexShader:{log:O,prefix:o},fragmentShader:{log:P,prefix:s}})}return u.deleteShader(S),u.deleteShader(T),this.getUniforms=function(){return void 0===M&&(M=new WebGLUniforms(u,_)),M},this.getAttributes=function(){return void 0===A&&(A=fetchAttributeLocations(u,_)),A},this.destroy=function(){u.deleteProgram(_),this.program=void 0},this.name=i.name,this.id=programIdCount++,this.cacheKey=r,this.usedTimes=1,this.program=_,this.vertexShader=S,this.fragmentShader=T,this.numMultiviewViews=b,this}function WebGLPrograms(t,e,r){var n=[],i=r.isWebGL2,a=r.logarithmicDepthBuffer,o=r.floatVertexTextures,s=r.precision,u=r.maxVertexUniforms,l=r.vertexTextures,c={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=LinearEncoding,e}this.getParameters=function(e,n,h,d,p,m,v){var g=d.fog,y=e.envMap||(e.isMeshStandardMaterial?d.environment:null),_=c[e.type],b=v.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(o)return 1024;var r=Math.floor((u-20)/4),n=Math.min(r,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}(v):0;null!==e.precision&&(s=r.getMaxPrecision(e.precision))!==e.precision&&console.warn("THREE.WebGLProgram.getParameters:",e.precision,"not supported, using",s,"instead.");var x=t.getRenderTarget();return{isWebGL2:i,shaderID:_,precision:s,instancing:!0===v.isInstancedMesh,supportsVertexTextures:l,numMultiviewViews:x&&x.isWebGLMultiviewRenderTarget?x.numViews:0,outputEncoding:null!==x?f(x.texture):t.outputEncoding,map:!!e.map,mapEncoding:f(e.map),matcap:!!e.matcap,matcapEncoding:f(e.matcap),envMap:!!y,envMapMode:y&&y.mapping,envMapEncoding:f(y),envMapCubeUV:!!y&&(y.mapping===CubeUVReflectionMapping||y.mapping===CubeUVRefractionMapping),lightMap:!!e.lightMap,lightMapEncoding:f(e.lightMap),aoMap:!!e.aoMap,emissiveMap:!!e.emissiveMap,emissiveMapEncoding:f(e.emissiveMap),bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,objectSpaceNormalMap:e.normalMapType===ObjectSpaceNormalMap,tangentSpaceNormalMap:e.normalMapType===TangentSpaceNormalMap,clearcoatNormalMap:!!e.clearcoatNormalMap,displacementMap:!!e.displacementMap,roughnessMap:!!e.roughnessMap,metalnessMap:!!e.metalnessMap,specularMap:!!e.specularMap,alphaMap:!!e.alphaMap,gradientMap:!!e.gradientMap,sheen:!!e.sheen,combine:e.combine,vertexTangents:e.normalMap&&e.vertexTangents,vertexColors:e.vertexColors,vertexUvs:!!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||e.displacementMap),uvsVertexOnly:!(e.map||e.bumpMap||e.normalMap||e.specularMap||e.alphaMap||e.emissiveMap||e.roughnessMap||e.metalnessMap||e.clearcoatNormalMap||!e.displacementMap),fog:!!g,useFog:e.fog,fogExp2:g&&g.isFogExp2,flatShading:e.flatShading,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:a,skinning:e.skinning&&b>0,maxBones:b,useVertexTexture:o,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:n.directional.length,numPointLights:n.point.length,numSpotLights:n.spot.length,numRectAreaLights:n.rectArea.length,numHemiLights:n.hemi.length,numDirLightShadows:n.directionalShadowMap.length,numPointLightShadows:n.pointShadowMap.length,numSpotLightShadows:n.spotShadowMap.length,numClippingPlanes:p,numClipIntersection:m,dithering:e.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:e.toneMapped?t.toneMapping:NoToneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:e.premultipliedAlpha,alphaTest:e.alphaTest,doubleSided:e.side===DoubleSide$c,flipSided:e.side===BackSide,depthPacking:void 0!==e.depthPacking&&e.depthPacking}},this.getProgramCacheKey=function(e,r){var n=[];if(r.shaderID?n.push(r.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(var i in e.defines)n.push(i),n.push(e.defines[i]);if(void 0===e.isRawShaderMaterial){for(var a=0;a<h.length;a++)n.push(r[h[a]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(r,i,a,o){for(var s,u=0,l=n.length;u<l;u++){var c=n[u];if(c.cacheKey===o){++(s=c).usedTimes;break}}return void 0===s&&(s=new WebGLProgram(t,e,o,r,i,a),n.push(s)),s},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function WebGLProperties(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&t.set(e,r={}),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}}function painterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function reversePainterSortStable(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function WebGLRenderList(){var t=[],e=0,r=[],n=[],i={id:-1};function a(r,n,a,o,s,u){var l=t[e];return void 0===l?t[e]=l={id:r.id,object:r,geometry:n,material:a,program:a.program||i,groupOrder:o,renderOrder:r.renderOrder,z:s,group:u}:(l.id=r.id,l.object=r,l.geometry=n,l.material=a,l.program=a.program||i,l.groupOrder=o,l.renderOrder=r.renderOrder,l.z=s,l.group=u),e++,l}return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(t,e,i,o,s,u){var l=a(t,e,i,o,s,u);(!0===i.transparent?n:r).push(l)},unshift:function(t,e,i,o,s,u){var l=a(t,e,i,o,s,u);(!0===i.transparent?n:r).unshift(l)},sort:function(t,e){r.length>1&&r.sort(t||painterSortStable),n.length>1&&n.sort(e||reversePainterSortStable)}}}function WebGLRenderLists(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i,a=t.get(r);return void 0===a?(i=new WebGLRenderList,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):void 0===(i=a.get(n))&&(i=new WebGLRenderList,a.set(n,i)),i},dispose:function(){t=new WeakMap}}}function UniformsCache(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Vector3$1,color:new Color$c,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$3};break;case"SpotLight":r={position:new Vector3$1,direction:new Vector3$1,color:new Color$c,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$3};break;case"PointLight":r={position:new Vector3$1,color:new Color$c,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2$3,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":r={direction:new Vector3$1,skyColor:new Color$c,groundColor:new Color$c};break;case"RectAreaLight":r={color:new Color$c,position:new Vector3$1,halfWidth:new Vector3$1,halfHeight:new Vector3$1}}return t[e.id]=r,r}}}var nextVersion=0;function shadowCastingLightsFirst(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function WebGLLights(){for(var t=new UniformsCache,e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},r=0;r<9;r++)e.probe.push(new Vector3$1);var n=new Vector3$1,i=new Matrix4$2,a=new Matrix4$2;return{setup:function(r,o,s){for(var u=0,l=0,c=0,h=0;h<9;h++)e.probe[h].set(0,0,0);var f=0,d=0,p=0,m=0,v=0,g=0,y=0,_=0,b=s.matrixWorldInverse;r.sort(shadowCastingLightsFirst),h=0;for(var x=r.length;h<x;h++){var w=r[h],M=w.color,A=w.intensity,E=w.distance,S=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)u+=M.r*A,l+=M.g*A,c+=M.b*A;else if(w.isLightProbe)for(var T=0;T<9;T++)e.probe[T].addScaledVector(w.sh.coefficients[T],A);else if(w.isDirectionalLight)(O=t.get(w)).color.copy(w.color).multiplyScalar(w.intensity),O.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),O.direction.sub(n),O.direction.transformDirection(b),O.shadow=w.castShadow,w.castShadow&&(O.shadowBias=(C=w.shadow).bias,O.shadowRadius=C.radius,O.shadowMapSize=C.mapSize,e.directionalShadowMap[f]=S,e.directionalShadowMatrix[f]=w.shadow.matrix,g++),e.directional[f]=O,f++;else if(w.isSpotLight)(O=t.get(w)).position.setFromMatrixPosition(w.matrixWorld),O.position.applyMatrix4(b),O.color.copy(M).multiplyScalar(A),O.distance=E,O.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),O.direction.sub(n),O.direction.transformDirection(b),O.coneCos=Math.cos(w.angle),O.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),O.decay=w.decay,O.shadow=w.castShadow,w.castShadow&&(O.shadowBias=(C=w.shadow).bias,O.shadowRadius=C.radius,O.shadowMapSize=C.mapSize,e.spotShadowMap[p]=S,e.spotShadowMatrix[p]=w.shadow.matrix,_++),e.spot[p]=O,p++;else if(w.isRectAreaLight)(O=t.get(w)).color.copy(M).multiplyScalar(A),O.position.setFromMatrixPosition(w.matrixWorld),O.position.applyMatrix4(b),a.identity(),i.copy(w.matrixWorld),i.premultiply(b),a.extractRotation(i),O.halfWidth.set(.5*w.width,0,0),O.halfHeight.set(0,.5*w.height,0),O.halfWidth.applyMatrix4(a),O.halfHeight.applyMatrix4(a),e.rectArea[m]=O,m++;else if(w.isPointLight){var C;(O=t.get(w)).position.setFromMatrixPosition(w.matrixWorld),O.position.applyMatrix4(b),O.color.copy(w.color).multiplyScalar(w.intensity),O.distance=w.distance,O.decay=w.decay,O.shadow=w.castShadow,w.castShadow&&(O.shadowBias=(C=w.shadow).bias,O.shadowRadius=C.radius,O.shadowMapSize=C.mapSize,O.shadowCameraNear=C.camera.near,O.shadowCameraFar=C.camera.far,e.pointShadowMap[d]=S,e.pointShadowMatrix[d]=w.shadow.matrix,y++),e.point[d]=O,d++}else if(w.isHemisphereLight){var O;(O=t.get(w)).direction.setFromMatrixPosition(w.matrixWorld),O.direction.transformDirection(b),O.direction.normalize(),O.skyColor.copy(w.color).multiplyScalar(A),O.groundColor.copy(w.groundColor).multiplyScalar(A),e.hemi[v]=O,v++}}e.ambient[0]=u,e.ambient[1]=l,e.ambient[2]=c;var P=e.hash;P.directionalLength===f&&P.pointLength===d&&P.spotLength===p&&P.rectAreaLength===m&&P.hemiLength===v&&P.numDirectionalShadows===g&&P.numPointShadows===y&&P.numSpotShadows===_||(e.directional.length=f,e.spot.length=p,e.rectArea.length=m,e.point.length=d,e.hemi.length=v,e.directionalShadowMap.length=g,e.pointShadowMap.length=y,e.spotShadowMap.length=_,e.directionalShadowMatrix.length=g,e.pointShadowMatrix.length=y,e.spotShadowMatrix.length=_,P.directionalLength=f,P.pointLength=d,P.spotLength=p,P.rectAreaLength=m,P.hemiLength=v,P.numDirectionalShadows=g,P.numPointShadows=y,P.numSpotShadows=_,e.version=nextVersion++)},state:e}}function WebGLRenderState(){var t=new WebGLLights,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)}}}function WebGLRenderStates(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i;return!1===t.has(r)?(i=new WebGLRenderState,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):!1===t.get(r).has(n)?(i=new WebGLRenderState,t.get(r).set(n,i)):i=t.get(r).get(n),i},dispose:function(){t=new WeakMap}}}function MeshDepthMaterial(t){Material.call(this),this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function MeshDistanceMaterial(t){Material.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3$1,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}MeshDepthMaterial.prototype=Object.create(Material.prototype),MeshDepthMaterial.prototype.constructor=MeshDepthMaterial,MeshDepthMaterial.prototype.isMeshDepthMaterial=!0,MeshDepthMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},MeshDistanceMaterial.prototype=Object.create(Material.prototype),MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial,MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0,MeshDistanceMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var vsm_frag="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",vsm_vert="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function WebGLShadowMap(t,e,r){var n=new Frustum,i=new Vector2$3,a=new Vector2$3,o=new Vector4,s=[],u=[],l={},c={0:BackSide,1:FrontSide,2:DoubleSide$c},h=new ShaderMaterial$c({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2$3},radius:{value:4}},vertexShader:vsm_vert,fragmentShader:vsm_frag}),f=h.clone();f.defines.HORIZONAL_PASS=1;var d=new BufferGeometry$1;d.setAttribute("position",new BufferAttribute$1(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var p=new Mesh(d,h),m=this;function v(r,n){var i=e.update(p);h.uniforms.shadow_pass.value=r.map.texture,h.uniforms.resolution.value=r.mapSize,h.uniforms.radius.value=r.radius,t.setRenderTarget(r.mapPass),t.clear(),t.renderBufferDirect(n,null,i,h,p,null),f.uniforms.shadow_pass.value=r.mapPass.texture,f.uniforms.resolution.value=r.mapSize,f.uniforms.radius.value=r.radius,t.setRenderTarget(r.map),t.clear(),t.renderBufferDirect(n,null,i,f,p,null)}function g(t,e,r){var n=t<<0|e<<1|r<<2,i=s[n];return void 0===i&&(i=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:t,skinning:e}),s[n]=i),i}function y(t,e,r){var n=t<<0|e<<1|r<<2,i=u[n];return void 0===i&&(i=new MeshDistanceMaterial({morphTargets:t,skinning:e}),u[n]=i),i}function _(e,r,n,i,a,o){var s=e.geometry,u=null,h=g,f=e.customDepthMaterial;if(!0===n.isPointLight&&(h=y,f=e.customDistanceMaterial),void 0===f){var d=!1;!0===r.morphTargets&&(!0===s.isBufferGeometry?d=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(d=s.morphTargets&&s.morphTargets.length>0));var p=!1;!0===e.isSkinnedMesh&&(!0===r.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),u=h(d,p,!0===e.isInstancedMesh)}else u=f;if(t.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=u.uuid,v=r.uuid,_=l[m];void 0===_&&(l[m]=_={});var b=_[v];void 0===b&&(b=u.clone(),_[v]=b),u=b}return u.visible=r.visible,u.wireframe=r.wireframe,u.side=o===VSMShadowMap?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:c[r.side],u.clipShadows=r.clipShadows,u.clippingPlanes=r.clippingPlanes,u.clipIntersection=r.clipIntersection,u.wireframeLinewidth=r.wireframeLinewidth,u.linewidth=r.linewidth,!0===n.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(n.matrixWorld),u.nearDistance=i,u.farDistance=a),u}function b(r,i,a,o,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&s===VSMShadowMap)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,r.matrixWorld);var u=e.update(r),l=r.material;if(Array.isArray(l))for(var c=u.groups,h=0,f=c.length;h<f;h++){var d=c[h],p=l[d.materialIndex];if(p&&p.visible){var m=_(r,p,o,a.near,a.far,s);t.renderBufferDirect(a,null,u,m,r,d)}}else l.visible&&(m=_(r,l,o,a.near,a.far,s),t.renderBufferDirect(a,null,u,m,r,null))}for(var v=r.children,g=0,y=v.length;g<y;g++)b(v[g],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap,this.render=function(e,s,u){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==e.length){var l=t.getRenderTarget(),c=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),f=t.state;f.setBlending(NoBlending),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=0,p=e.length;d<p;d++){var g=e[d],y=g.shadow;if(void 0!==y){i.copy(y.mapSize);var _,x=y.getFrameExtents();i.multiply(x),a.copy(y.mapSize),(i.x>r||i.y>r)&&(console.warn("THREE.WebGLShadowMap:",g,"has shadow exceeding max texture size, reducing"),i.x>r&&(a.x=Math.floor(r/x.x),i.x=a.x*x.x,y.mapSize.x=a.x),i.y>r&&(a.y=Math.floor(r/x.y),i.y=a.y*x.y,y.mapSize.y=a.y)),null!==y.map||y.isPointLightShadow||this.type!==VSMShadowMap||(y.map=new WebGLRenderTarget(i.x,i.y,_={minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat}),y.map.texture.name=g.name+".shadowMap",y.mapPass=new WebGLRenderTarget(i.x,i.y,_),y.camera.updateProjectionMatrix()),null===y.map&&(y.map=new WebGLRenderTarget(i.x,i.y,_={minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat}),y.map.texture.name=g.name+".shadowMap",y.camera.updateProjectionMatrix()),t.setRenderTarget(y.map),t.clear();for(var w=y.getViewportCount(),M=0;M<w;M++){var A=y.getViewport(M);o.set(a.x*A.x,a.y*A.y,a.x*A.z,a.y*A.w),f.viewport(o),y.updateMatrices(g,M),n=y.getFrustum(),b(s,u,y.camera,g,this.type)}y.isPointLightShadow||this.type!==VSMShadowMap||v(y,u)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}m.needsUpdate=!1,t.setRenderTarget(l,c,h)}}}function WebGLState(t,e,r){var n=r.isWebGL2,i=new function(){var e=!1,r=new Vector4,n=null,i=new Vector4(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,a,o,s){!0===s&&(e*=o,n*=o,a*=o),r.set(e,n,a,o),!1===i.equals(r)&&(t.clearColor(e,n,a,o),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},a=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(t){t?j(2929):N(2929)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case NeverDepth:t.depthFunc(512);break;case AlwaysDepth:t.depthFunc(519);break;case LessDepth:t.depthFunc(513);break;case LessEqualDepth:t.depthFunc(515);break;case EqualDepth:t.depthFunc(514);break;case GreaterEqualDepth:t.depthFunc(518);break;case GreaterDepth:t.depthFunc(516);break;case NotEqualDepth:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},o=new function(){var e=!1,r=null,n=null,i=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(t){e||(t?j(2960):N(2960))},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,o){n===e&&i===r&&a===o||(t.stencilFunc(e,r,o),n=e,i=r,a=o)},setOp:function(e,r,n){o===e&&s===r&&u===n||(t.stencilOp(e,r,n),o=e,s=r,u=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,r=null,n=null,i=null,a=null,o=null,s=null,u=null,l=null}}},s=t.getParameter(34921),u=new Uint8Array(s),l=new Uint8Array(s),c=new Uint8Array(s),h={},f=null,d=null,p=null,m=null,v=null,g=null,y=null,_=null,b=null,x=!1,w=null,M=null,A=null,E=null,S=null,T=t.getParameter(35661),C=!1,O=0,P=t.getParameter(7938);-1!==P.indexOf("WebGL")?(O=parseFloat(/^WebGL\ ([0-9])/.exec(P)[1]),C=O>=1):-1!==P.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(P)[1]),C=O>=2);var L=null,I={},k=new Vector4,R=new Vector4;function D(e,r,n){var i=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var o=0;o<n;o++)t.texImage2D(r+o,0,6408,1,1,0,6408,5121,i);return a}var B={};function F(r,i){u[r]=1,0===l[r]&&(t.enableVertexAttribArray(r),l[r]=1),c[r]!==i&&((n?t:e.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),c[r]=i)}function j(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function N(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}B[3553]=D(3553,3553,1),B[34067]=D(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),o.setClear(0),j(2929),a.setFunc(LessEqualDepth),H(!1),W(CullFaceBack),j(2884),V(NoBlending);var U={[AddEquation]:32774,[SubtractEquation]:32778,[ReverseSubtractEquation]:32779};if(n)U[MinEquation]=32775,U[MaxEquation]=32776;else{var z=e.get("EXT_blend_minmax");null!==z&&(U[MinEquation]=z.MIN_EXT,U[MaxEquation]=z.MAX_EXT)}var G={[ZeroFactor]:0,[OneFactor]:1,[SrcColorFactor]:768,[SrcAlphaFactor]:770,[SrcAlphaSaturateFactor]:776,[DstColorFactor]:774,[DstAlphaFactor]:772,[OneMinusSrcColorFactor]:769,[OneMinusSrcAlphaFactor]:771,[OneMinusDstColorFactor]:775,[OneMinusDstAlphaFactor]:773};function V(e,r,n,i,a,o,s,u){if(e!==NoBlending){if(d||(j(3042),d=!0),e===CustomBlending)a=a||r,o=o||n,s=s||i,r===m&&a===y||(t.blendEquationSeparate(U[r],U[a]),m=r,y=a),n===v&&i===g&&o===_&&s===b||(t.blendFuncSeparate(G[n],G[i],G[o],G[s]),v=n,g=i,_=o,b=s),p=e,x=null;else if(e!==p||u!==x){if(m===AddEquation&&y===AddEquation||(t.blendEquation(32774),m=AddEquation,y=AddEquation),u)switch(e){case NormalBlending:t.blendFuncSeparate(1,771,1,771);break;case AdditiveBlending$4:t.blendFunc(1,1);break;case SubtractiveBlending:t.blendFuncSeparate(0,0,769,771);break;case MultiplyBlending:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case NormalBlending:t.blendFuncSeparate(770,771,1,771);break;case AdditiveBlending$4:t.blendFunc(770,1);break;case SubtractiveBlending:t.blendFunc(0,769);break;case MultiplyBlending:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}v=null,g=null,_=null,b=null,p=e,x=u}}else d&&(N(3042),d=!1)}function H(e){w!==e&&(t.frontFace(e?2304:2305),w=e)}function W(e){e!==CullFaceNone?(j(2884),e!==M&&t.cullFace(e===CullFaceBack?1029:e===CullFaceFront?1028:1032)):N(2884),M=e}function $(e,r,n){e?(j(32823),E===r&&S===n||(t.polygonOffset(r,n),E=r,S=n)):N(32823)}function q(e){void 0===e&&(e=33984+T-1),L!==e&&(t.activeTexture(e),L=e)}return{buffers:{color:i,depth:a,stencil:o},initAttributes:function(){for(var t=0,e=u.length;t<e;t++)u[t]=0},enableAttribute:function(t){F(t,0)},enableAttributeAndDivisor:F,disableUnusedAttributes:function(){for(var e=0,r=l.length;e!==r;++e)l[e]!==u[e]&&(t.disableVertexAttribArray(e),l[e]=0)},enable:j,disable:N,useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:V,setMaterial:function(t,e){t.side===DoubleSide$c?N(2884):j(2884);var r=t.side===BackSide;e&&(r=!r),H(r),t.blending===NormalBlending&&!1===t.transparent?V(NoBlending):V(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),i.setMask(t.colorWrite);var n=t.stencilWrite;o.setTest(n),n&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),$(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:H,setCullFace:W,setLineWidth:function(e){e!==A&&(C&&t.lineWidth(e),A=e)},setPolygonOffset:$,setScissorTest:function(t){t?j(3089):N(3089)},activeTexture:q,bindTexture:function(e,r){null===L&&q();var n=I[L];void 0===n&&(I[L]=n={type:void 0,texture:void 0}),n.type===e&&n.texture===r||(t.bindTexture(e,r||B[e]),n.type=e,n.texture=r)},unbindTexture:function(){var e=I[L];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===k.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),k.copy(e))},viewport:function(e){!1===R.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),R.copy(e))},reset:function(){for(var e=0;e<l.length;e++)1===l[e]&&(t.disableVertexAttribArray(e),l[e]=0);h={},L=null,I={},f=null,p=null,w=null,M=null,i.reset(),a.reset(),o.reset()}}}function WebGLTextures(t,e,r,n,i,a,o){var s,u=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,h=i.maxTextureSize,f=i.maxSamples,d=new WeakMap,p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return p?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(t,e,r,n){var i=1;if((t.width>n||t.height>n)&&(i=n/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var a=e?_Math.floorPowerOfTwo:Math.floor,o=a(i*t.width),u=a(i*t.height);void 0===s&&(s=m(o,u));var l=r?m(o,u):s;return l.width=o,l.height=u,l.getContext("2d").drawImage(t,0,0,o,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+u+")."),l}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function g(t){return _Math.isPowerOfTwo(t.width)&&_Math.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter}function _(e,r,i,a){t.generateMipmap(e),n.get(r).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function b(r,n,i){if(!1===u)return n;if(null!==r){if(void 0!==t[r])return t[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var a=n;return 6403===n&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===n&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===n&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325===a||33326===a||34842===a||34836===a?e.get("EXT_color_buffer_float"):34843!==a&&34837!==a||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),a}function x(t){return t===NearestFilter||t===NearestMipmapNearestFilter||t===NearestMipmapLinearFilter?9728:9729}function w(e){var r=e.target;r.removeEventListener("dispose",w),function(e){var r=n.get(e);void 0!==r.__webglInit&&(t.deleteTexture(r.__webglTexture),n.remove(e))}(r),r.isVideoTexture&&d.delete(r),o.memory.textures--}function M(e){var r=e.target;r.removeEventListener("dispose",M),function(e){var r=n.get(e),i=n.get(e.texture);if(e){if(void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var a=0;a<6;a++)t.deleteFramebuffer(r.__webglFramebuffer[a]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[a]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer);if(e.isWebGLMultiviewRenderTarget){t.deleteTexture(r.__webglColorTexture),t.deleteTexture(r.__webglDepthStencilTexture),o.memory.textures-=2,a=0;for(var s=r.__webglViewFramebuffers.length;a<s;a++)t.deleteFramebuffer(r.__webglViewFramebuffers[a])}n.remove(e.texture),n.remove(e)}}(r),o.memory.textures--}var A=0;function E(t,e){var i=n.get(t);if(t.isVideoTexture&&function(t){var e=o.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){var a=t.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void I(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,i.__webglTexture)}function S(e,i){if(6===e.image.length){var o=n.get(e);if(e.version>0&&o.__version!==e.version){L(o,e),r.activeTexture(33984+i),r.bindTexture(34067,o.__webglTexture),t.pixelStorei(37440,e.flipY);for(var s=e&&e.isCompressedTexture,l=e.image[0]&&e.image[0].isDataTexture,h=[],f=0;f<6;f++)h[f]=s||l?l?e.image[f].image:e.image[f]:v(e.image[f],!1,!0,c);var d,p=h[0],m=g(p)||u,x=a.convert(e.format),w=a.convert(e.type),M=b(e.internalFormat,x,w);if(P(34067,e,m),s){for(f=0;f<6;f++){d=h[f].mipmaps;for(var A=0;A<d.length;A++){var E=d[A];e.format!==RGBAFormat&&e.format!==RGBFormat?null!==x?r.compressedTexImage2D(34069+f,A,M,E.width,E.height,0,E.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+f,A,M,E.width,E.height,0,x,w,E.data)}}o.__maxMipLevel=d.length-1}else{for(d=e.mipmaps,f=0;f<6;f++)if(l)for(r.texImage2D(34069+f,0,M,h[f].width,h[f].height,0,x,w,h[f].data),A=0;A<d.length;A++){var S=(E=d[A]).image[f].image;r.texImage2D(34069+f,A+1,M,S.width,S.height,0,x,w,S.data)}else for(r.texImage2D(34069+f,0,M,x,w,h[f]),A=0;A<d.length;A++)r.texImage2D(34069+f,A+1,M,x,w,(E=d[A]).image[f]);o.__maxMipLevel=d.length}y(e,m)&&_(34067,e,p.width,p.height),o.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(33984+i),r.bindTexture(34067,o.__webglTexture)}}function T(t,e){r.activeTexture(33984+e),r.bindTexture(34067,n.get(t).__webglTexture)}var C={[RepeatWrapping$2]:10497,[ClampToEdgeWrapping]:33071,[MirroredRepeatWrapping]:33648},O={[NearestFilter]:9728,[NearestMipmapNearestFilter]:9984,[NearestMipmapLinearFilter]:9986,[LinearFilter]:9729,[LinearMipmapNearestFilter]:9985,[LinearMipmapLinearFilter]:9987};function P(r,a,o){o?(t.texParameteri(r,10242,C[a.wrapS]),t.texParameteri(r,10243,C[a.wrapT]),32879!==r&&35866!==r||t.texParameteri(r,32882,C[a.wrapR]),t.texParameteri(r,10240,O[a.magFilter]),t.texParameteri(r,10241,O[a.minFilter])):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),a.wrapS===ClampToEdgeWrapping&&a.wrapT===ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,x(a.magFilter)),t.texParameteri(r,10241,x(a.minFilter)),a.minFilter!==NearestFilter&&a.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=e.get("EXT_texture_filter_anisotropic");if(s){if(a.type===FloatType&&null===e.get("OES_texture_float_linear"))return;if(a.type===HalfFloatType&&null===(u||e.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function L(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),o.memory.textures++)}function I(e,n,i){var o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),L(e,n),r.activeTexture(33984+i),r.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment);var s=function(t){return!u&&(t.wrapS!==ClampToEdgeWrapping||t.wrapT!==ClampToEdgeWrapping||t.minFilter!==NearestFilter&&t.minFilter!==LinearFilter)}(n)&&!1===g(n.image),l=v(n.image,s,!1,h),c=g(l)||u,f=a.convert(n.format),d=a.convert(n.type),p=b(n.internalFormat,f,d);P(o,n,c);var m,x=n.mipmaps;if(n.isDepthTexture){if(p=6402,n.type===FloatType){if(!1===u)throw new Error("Float Depth Texture only supported in WebGL2.0");p=36012}else u&&(p=33189);n.format===DepthFormat&&6402===p&&n.type!==UnsignedShortType&&n.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=UnsignedShortType,d=a.convert(n.type)),n.format===DepthStencilFormat&&(p=34041,n.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=UnsignedInt248Type,d=a.convert(n.type))),r.texImage2D(3553,0,p,l.width,l.height,0,f,d,null)}else if(n.isDataTexture)if(x.length>0&&c){for(var w=0,M=x.length;w<M;w++)r.texImage2D(3553,w,p,(m=x[w]).width,m.height,0,f,d,m.data);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,p,l.width,l.height,0,f,d,l.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(w=0,M=x.length;w<M;w++)m=x[w],n.format!==RGBAFormat&&n.format!==RGBFormat?null!==f?r.compressedTexImage2D(3553,w,p,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,w,p,m.width,m.height,0,f,d,m.data);e.__maxMipLevel=x.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,p,l.width,l.height,l.depth,0,f,d,l.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,p,l.width,l.height,l.depth,0,f,d,l.data),e.__maxMipLevel=0;else if(x.length>0&&c){for(w=0,M=x.length;w<M;w++)r.texImage2D(3553,w,p,f,d,m=x[w]);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,p,f,d,l),e.__maxMipLevel=0;y(n,c)&&_(o,n,l.width,l.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function k(e,i,o,s){var u=a.convert(i.texture.format),l=a.convert(i.texture.type),c=b(i.texture.internalFormat,u,l);r.texImage2D(s,0,c,i.width,i.height,0,u,l,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,o,s,n.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function R(e,r,n){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){if(n){var i=D(r);t.renderbufferStorageMultisample(36161,i,33189,r.width,r.height)}else t.renderbufferStorage(36161,33189,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer)n?(i=D(r),t.renderbufferStorageMultisample(36161,i,35056,r.width,r.height)):t.renderbufferStorage(36161,34041,r.width,r.height),t.framebufferRenderbuffer(36160,33306,36161,e);else{var o=a.convert(r.texture.format),s=a.convert(r.texture.type),u=b(r.texture.internalFormat,o,s);n?(i=D(r),t.renderbufferStorageMultisample(36161,i,u,r.width,r.height)):t.renderbufferStorage(36161,u,r.width,r.height)}t.bindRenderbuffer(36161,null)}function D(t){return u&&t.isWebGLMultisampleRenderTarget?Math.min(f,t.samples):0}var B=!1,F=!1;this.allocateTextureUnit=function(){var t=A;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),A+=1,t},this.resetTextureUnits=function(){A=0},this.setTexture2D=E,this.setTexture2DArray=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?I(i,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=S,this.setTextureCubeDynamic=T,this.setupRenderTarget=function(i){var s=n.get(i),l=n.get(i.texture);i.addEventListener("dispose",M),l.__webglTexture=t.createTexture(),o.memory.textures++;var c=!0===i.isWebGLRenderTargetCube,h=!0===i.isWebGLMultisampleRenderTarget,f=!0===i.isWebGLMultiviewRenderTarget,d=g(i)||u;if(c){s.__webglFramebuffer=[];for(var p=0;p<6;p++)s.__webglFramebuffer[p]=t.createFramebuffer()}else if(s.__webglFramebuffer=t.createFramebuffer(),h)if(u){s.__webglMultisampledFramebuffer=t.createFramebuffer(),s.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=a.convert(i.texture.format),v=a.convert(i.texture.type),x=b(i.texture.internalFormat,m,v),w=D(i);t.renderbufferStorageMultisample(36161,w,x,i.width,i.height),t.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=t.createRenderbuffer(),R(s.__webglDepthRenderbuffer,i,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(f){var A=i.width,S=i.height,T=i.numViews;t.bindFramebuffer(36160,s.__webglFramebuffer);var C=e.get("OVR_multiview2");o.memory.textures+=2;var O=t.createTexture();t.bindTexture(35866,O),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,A,S,T,0,6408,5121,null),C.framebufferTextureMultiviewOVR(36160,36064,O,0,0,T);var L=t.createTexture();t.bindTexture(35866,L),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,A,S,T,0,34041,34042,null),C.framebufferTextureMultiviewOVR(36160,33306,L,0,0,T);var I=new Array(T);for(p=0;p<T;++p)I[p]=t.createFramebuffer(),t.bindFramebuffer(36160,I[p]),t.framebufferTextureLayer(36160,36064,O,0,p);s.__webglColorTexture=O,s.__webglDepthStencilTexture=L,s.__webglViewFramebuffers=I,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(c){for(r.bindTexture(34067,l.__webglTexture),P(34067,i.texture,d),p=0;p<6;p++)k(s.__webglFramebuffer[p],i,36064,34069+p);y(i.texture,d)&&_(34067,i.texture,i.width,i.height),r.bindTexture(34067,null)}else f||(r.bindTexture(3553,l.__webglTexture),P(3553,i.texture,d),k(s.__webglFramebuffer,i,36064,3553),y(i.texture,d)&&_(3553,i.texture,i.width,i.height),r.bindTexture(3553,null));i.depthBuffer&&function(e){var r=n.get(e),i=!0===e.isWebGLRenderTargetCube;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),E(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===DepthFormat)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==DepthStencilFormat)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,e)}else if(i){r.__webglDepthbuffer=[];for(var a=0;a<6;a++)t.bindFramebuffer(36160,r.__webglFramebuffer[a]),r.__webglDepthbuffer[a]=t.createRenderbuffer(),R(r.__webglDepthbuffer[a],e)}else t.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),R(r.__webglDepthbuffer,e);t.bindFramebuffer(36160,null)}(i)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(y(e,g(t)||u)){var i=t.isWebGLRenderTargetCube?34067:3553,a=n.get(e).__webglTexture;r.bindTexture(i,a),_(i,e,t.width,t.height),r.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(u){var r=n.get(e);t.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,r.__webglFramebuffer);var i=e.width,a=e.height,o=16384;e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024),t.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===B&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),B=!0),t=t.texture),E(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLRenderTargetCube&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?S(t,e):T(t,e)}}function WebGLUtils(t,e,r){var n=r.isWebGL2;return{convert:function(t){var r;if(t===UnsignedByteType)return 5121;if(t===UnsignedShort4444Type)return 32819;if(t===UnsignedShort5551Type)return 32820;if(t===UnsignedShort565Type)return 33635;if(t===ByteType)return 5120;if(t===ShortType)return 5122;if(t===UnsignedShortType)return 5123;if(t===IntType)return 5124;if(t===UnsignedIntType)return 5125;if(t===FloatType)return 5126;if(t===HalfFloatType)return n?5131:null!==(r=e.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(t===AlphaFormat)return 6406;if(t===RGBFormat)return 6407;if(t===RGBAFormat)return 6408;if(t===LuminanceFormat)return 6409;if(t===LuminanceAlphaFormat)return 6410;if(t===DepthFormat)return 6402;if(t===DepthStencilFormat)return 34041;if(t===RedFormat)return 6403;if(t===RedIntegerFormat)return 36244;if(t===RGFormat)return 33319;if(t===RGIntegerFormat)return 33320;if(t===RGBIntegerFormat)return 36248;if(t===RGBAIntegerFormat)return 36249;if(t===RGB_S3TC_DXT1_Format||t===RGBA_S3TC_DXT1_Format||t===RGBA_S3TC_DXT3_Format||t===RGBA_S3TC_DXT5_Format){if(null===(r=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===RGB_S3TC_DXT1_Format)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===RGBA_S3TC_DXT1_Format)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===RGBA_S3TC_DXT3_Format)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===RGBA_S3TC_DXT5_Format)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===RGB_PVRTC_4BPPV1_Format||t===RGB_PVRTC_2BPPV1_Format||t===RGBA_PVRTC_4BPPV1_Format||t===RGBA_PVRTC_2BPPV1_Format){if(null===(r=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===RGB_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===RGB_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===RGBA_PVRTC_4BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===RGBA_PVRTC_2BPPV1_Format)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return t===RGB_ETC1_Format?null!==(r=e.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null:t===RGBA_ASTC_4x4_Format||t===RGBA_ASTC_5x4_Format||t===RGBA_ASTC_5x5_Format||t===RGBA_ASTC_6x5_Format||t===RGBA_ASTC_6x6_Format||t===RGBA_ASTC_8x5_Format||t===RGBA_ASTC_8x6_Format||t===RGBA_ASTC_8x8_Format||t===RGBA_ASTC_10x5_Format||t===RGBA_ASTC_10x6_Format||t===RGBA_ASTC_10x8_Format||t===RGBA_ASTC_10x10_Format||t===RGBA_ASTC_12x10_Format||t===RGBA_ASTC_12x12_Format?null!==(r=e.get("WEBGL_compressed_texture_astc"))?t:null:t===UnsignedInt248Type?n?34042:null!==(r=e.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function WebGLMultiviewRenderTarget(t,e,r,n){WebGLRenderTarget.call(this,t,e,n),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=r}function WebGLMultiview(t,e){var r,n,i,a,o,s,u,l=t.extensions,c=t.properties,h=0;function f(t){return t.isArrayCamera?t.cameras:(o[0]=t,o)}this.isAvailable=function(){if(void 0===u){var t=l.get("OVR_multiview2");if(u=null!==t&&!1===e.getContextAttributes().antialias){h=e.getParameter(t.MAX_VIEWS_OVR),r=new WebGLMultiviewRenderTarget(0,0,2),s=new Vector2$3,a=[],i=[],o=[];for(var n=0;n<h;n++)a[n]=new Matrix4$2,i[n]=new Matrix3}}return u},this.attachCamera=function(e){!1!==function(t){if(void 0===t.isArrayCamera)return!0;var e=t.cameras;if(e.length>h)return!1;for(var r=1,n=e.length;r<n;r++)if(e[0].viewport.z!==e[r].viewport.z||e[0].viewport.w!==e[r].viewport.w)return!1;return!0}(e)&&(n=t.getRenderTarget(),function(e){if(n?s.set(n.width,n.height):t.getDrawingBufferSize(s),e.isArrayCamera){var i=e.cameras[0].viewport;r.setSize(i.z,i.w),r.setNumViews(e.cameras.length)}else r.setSize(s.x,s.y),r.setNumViews(2)}(e),t.setRenderTarget(r))},this.detachCamera=function(i){r===t.getRenderTarget()&&(t.setRenderTarget(n),function(t){var n=r,i=n.numViews,a=c.get(n).__webglViewFramebuffers,o=n.width,u=n.height;if(t.isArrayCamera)for(var l=0;l<i;l++){var h=t.cameras[l].viewport,f=h.x,d=h.y,p=f+h.z,m=d+h.w;e.bindFramebuffer(36008,a[l]),e.blitFramebuffer(0,0,o,u,f,d,p,m,16384,9728)}else e.bindFramebuffer(36008,a[0]),e.blitFramebuffer(0,0,o,u,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(t,r){for(var n=f(t),i=0;i<n.length;i++)a[i].copy(n[i].projectionMatrix);r.setValue(e,"projectionMatrices",a)},this.updateCameraViewMatricesUniform=function(t,r){for(var n=f(t),i=0;i<n.length;i++)a[i].copy(n[i].matrixWorldInverse);r.setValue(e,"viewMatrices",a)},this.updateObjectMatricesUniforms=function(t,r,n){for(var o=f(r),s=0;s<o.length;s++)a[s].multiplyMatrices(o[s].matrixWorldInverse,t.matrixWorld),i[s].getNormalMatrix(a[s]);n.setValue(e,"modelViewMatrices",a),n.setValue(e,"normalMatrices",i)}}function ArrayCamera(t){PerspectiveCamera.call(this),this.cameras=t||[]}function Group(){Object3D.call(this),this.type="Group"}function WebXRManager(t,e){var r=this,n=null,i=null,a="local-floor",o=null,s=[],u=new Map,l=new PerspectiveCamera;l.layers.enable(1),l.viewport=new Vector4;var c=new PerspectiveCamera;c.layers.enable(2),c.viewport=new Vector4;var h=new ArrayCamera([l,c]);function f(t){var e=u.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function d(){u.forEach((function(t,e){t.dispatchEvent({type:"disconnected",data:e}),t.visible=!1})),u.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),b.stop(),r.dispatchEvent({type:"sessionend"}),r.isPresenting=!1}function p(t){i=t,b.setContext(n),b.start(),r.dispatchEvent({type:"sessionstart"}),r.isPresenting=!0}function m(t){for(var e=n.inputSources,r=0;r<s.length;r++)u.set(e[r],s[r]);for(r=0;r<t.removed.length;r++)(a=u.get(i=t.removed[r]))&&(a.dispatchEvent({type:"disconnected",data:i}),u.delete(i));for(r=0;r<t.added.length;r++){var i,a;(a=u.get(i=t.added[r]))&&a.dispatchEvent({type:"connected",data:i})}}h.layers.enable(1),h.layers.enable(2),this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=s[t];return void 0===e&&((e=new Group).matrixAutoUpdate=!1,e.visible=!1,s[t]=e),e},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(t){a=t},this.getReferenceSpace=function(){return i},this.getSession=function(){return n},this.setSession=function(t){if(null!==(n=t)){n.addEventListener("select",f),n.addEventListener("selectstart",f),n.addEventListener("selectend",f),n.addEventListener("squeeze",f),n.addEventListener("squeezestart",f),n.addEventListener("squeezeend",f),n.addEventListener("end",d);var r=e.getContextAttributes(),i=new XRWebGLLayer(n,e,{antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil});n.updateRenderState({baseLayer:i}),n.requestReferenceSpace(a).then(p),n.addEventListener("inputsourceschange",m)}};var v=new Vector3$1,g=new Vector3$1;function y(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){var e=t.parent,r=h.cameras;y(h,e);for(var n=0;n<r.length;n++)y(r[n],e);t.matrixWorld.copy(h.matrixWorld);for(var i=t.children,a=(n=0,i.length);n<a;n++)i[n].updateMatrixWorld(!0);return function(t,e,r){v.setFromMatrixPosition(e.matrixWorld),g.setFromMatrixPosition(r.matrixWorld);var n=v.distanceTo(g),i=e.projectionMatrix.elements,a=r.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],f=o*c,d=o*h,p=n/(-c+h),m=p*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var y=o+p,_=s+p;t.projectionMatrix.makePerspective(f-m,d+(n-m),u*s/_*y,l*s/_*y,y,_)}(h,l,c),h};var _=null,b=new WebGLAnimation;b.setAnimationLoop((function(e,r){if(null!==(o=r.getViewerPose(i))){var a=o.views,u=n.renderState.baseLayer;t.setFramebuffer(u.framebuffer);for(var l=0;l<a.length;l++){var c=a[l],f=u.getViewport(c),d=h.cameras[l];d.matrix.fromArray(c.transform.inverse.matrix).getInverse(d.matrix),d.projectionMatrix.fromArray(c.projectionMatrix),d.viewport.set(f.x,f.y,f.width,f.height),0===l&&h.matrix.copy(d.matrix)}}var p=n.inputSources;for(l=0;l<s.length;l++){var m=s[l],v=p[l];if(v){var g=r.getPose(v.targetRaySpace,i);if(null!==g){m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.visible=!0;continue}}m.visible=!1}_&&_(e,r)})),this.setAnimationLoop=function(t){_=t},this.dispose=function(){}}function WebGLRenderer(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,o=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,u=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,h=null,f=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=LinearEncoding,this.physicallyCorrectLights=!1,this.toneMapping=LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,p,m,v,g,y,_,b,x,w,M,A,E,S,T,C,O,P,L=this,I=!1,k=null,R=0,D=0,B=null,F=null,j=-1,N={geometry:null,program:null,wireframe:!1},U=null,z=null,G=new Vector4,V=new Vector4,H=null,W=e.width,$=e.height,q=1,X=null,K=null,Z=new Vector4(0,0,W,$),Y=new Vector4(0,0,W,$),J=!1,Q=new Frustum,tt=new WebGLClipping,et=!1,rt=!1,nt=new Matrix4$2,it=new Vector3$1;function at(){return null===B?q:1}try{var ot={alpha:n,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c,xrCompatible:!0};if(e.addEventListener("webglcontextlost",ht,!1),e.addEventListener("webglcontextrestored",ft,!1),null===(d=r||e.getContext("webgl",ot)||e.getContext("experimental-webgl",ot)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function st(){p=new WebGLExtensions(d),!1===(m=new WebGLCapabilities(d,p,t)).isWebGL2&&(p.get("WEBGL_depth_texture"),p.get("OES_texture_float"),p.get("OES_texture_half_float"),p.get("OES_texture_half_float_linear"),p.get("OES_standard_derivatives"),p.get("OES_element_index_uint"),p.get("ANGLE_instanced_arrays")),p.get("OES_texture_float_linear"),P=new WebGLUtils(d,p,m),(v=new WebGLState(d,p,m)).scissor(V.copy(Y).multiplyScalar(q).floor()),v.viewport(G.copy(Z).multiplyScalar(q).floor()),g=new WebGLInfo(d),y=new WebGLProperties,_=new WebGLTextures(d,p,v,y,m,P,g),b=new WebGLAttributes(d),x=new WebGLGeometries(d,b,g),w=new WebGLObjects(d,x,b,g),T=new WebGLMorphtargets(d),M=new WebGLPrograms(L,p,m),A=new WebGLRenderLists,E=new WebGLRenderStates,S=new WebGLBackground(L,v,w,s),C=new WebGLBufferRenderer(d,p,g,m),O=new WebGLIndexedBufferRenderer(d,p,g,m),g.programs=M.programs,L.capabilities=m,L.extensions=p,L.properties=y,L.renderLists=A,L.state=v,L.info=g}st();var ut=new WebXRManager(L,d);this.xr=ut;var lt=new WebGLMultiview(L,d),ct=new WebGLShadowMap(L,w,m.maxTextureSize);function ht(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1,st()}function dt(t){var e=t.target;e.removeEventListener("dispose",dt),function(t){pt(t),y.remove(t)}(e)}function pt(t){var e=y.get(t).program;t.program=void 0,void 0!==e&&M.releaseProgram(e)}this.shadowMap=ct,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=p.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=p.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return q},this.setPixelRatio=function(t){void 0!==t&&(q=t,this.setSize(W,$,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Vector2$3),t.set(W,$)},this.setSize=function(t,r,n){ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(W=t,$=r,e.width=Math.floor(t*q),e.height=Math.floor(r*q),!1!==n&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Vector2$3),t.set(W*q,$*q).floor()},this.setDrawingBufferSize=function(t,r,n){W=t,$=r,q=n,e.width=Math.floor(t*n),e.height=Math.floor(r*n),this.setViewport(0,0,t,r)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new Vector4),t.copy(G)},this.getViewport=function(t){return t.copy(Z)},this.setViewport=function(t,e,r,n){t.isVector4?Z.set(t.x,t.y,t.z,t.w):Z.set(t,e,r,n),v.viewport(G.copy(Z).multiplyScalar(q).floor())},this.getScissor=function(t){return t.copy(Y)},this.setScissor=function(t,e,r,n){t.isVector4?Y.set(t.x,t.y,t.z,t.w):Y.set(t,e,r,n),v.scissor(V.copy(Y).multiplyScalar(q).floor())},this.getScissorTest=function(){return J},this.setScissorTest=function(t){v.setScissorTest(J=t)},this.setOpaqueSort=function(t){X=t},this.setTransparentSort=function(t){K=t},this.getClearColor=function(){return S.getClearColor()},this.setClearColor=function(){S.setClearColor.apply(S,arguments)},this.getClearAlpha=function(){return S.getClearAlpha()},this.setClearAlpha=function(){S.setClearAlpha.apply(S,arguments)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===r||r)&&(n|=1024),d.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ht,!1),e.removeEventListener("webglcontextrestored",ft,!1),A.dispose(),E.dispose(),y.dispose(),w.dispose(),ut.dispose(),gt.stop()},this.renderBufferImmediate=function(t,e){v.initAttributes();var r=y.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var n=e.getAttributes();t.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,t.positionArray,35048),v.enableAttribute(n.position),d.vertexAttribPointer(n.position,3,5126,!1,0,0)),t.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,t.normalArray,35048),v.enableAttribute(n.normal),d.vertexAttribPointer(n.normal,3,5126,!1,0,0)),t.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,t.uvArray,35048),v.enableAttribute(n.uv),d.vertexAttribPointer(n.uv,2,5126,!1,0,0)),t.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,t.colorArray,35048),v.enableAttribute(n.color),d.vertexAttribPointer(n.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),d.drawArrays(4,0,t.count),t.count=0};var mt=new Scene;this.renderBufferDirect=function(t,e,r,n,i,a){null===e&&(e=mt);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=wt(t,e,n,i);v.setMaterial(n,o);var u=!1;N.geometry===r.id&&N.program===s.id&&N.wireframe===(!0===n.wireframe)||(N.geometry=r.id,N.program=s.id,N.wireframe=!0===n.wireframe,u=!0),(n.morphTargets||n.morphNormals)&&(T.update(i,r,n,s),u=!0);var l=r.index,c=r.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;var h,f=1;!0===n.wireframe&&(l=x.getWireframeAttribute(r),f=2);var g=C;null!==l&&(h=b.get(l),(g=O).setIndex(h)),u&&(function(t,e,r,n){if(!1!==m.isWebGL2||!t.isInstancedMesh&&!e.isInstancedBufferGeometry||null!==p.get("ANGLE_instanced_arrays")){v.initAttributes();var i=e.attributes,a=n.getAttributes(),o=r.defaultAttributeValues;for(var s in a){var u=a[s];if(u>=0){var l=i[s];if(void 0!==l){var c=l.normalized,h=l.itemSize;if(void 0===(M=b.get(l)))continue;var f=M.buffer,g=M.type,y=M.bytesPerElement;if(l.isInterleavedBufferAttribute){var _=l.data,x=_.stride,w=l.offset;_&&_.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(u,_.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=_.meshPerAttribute*_.count)):v.enableAttribute(u),d.bindBuffer(34962,f),d.vertexAttribPointer(u,h,g,c,x*y,w*y)}else l.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(u,l.meshPerAttribute),void 0===e.maxInstancedCount&&(e.maxInstancedCount=l.meshPerAttribute*l.count)):v.enableAttribute(u),d.bindBuffer(34962,f),d.vertexAttribPointer(u,h,g,c,0,0)}else if("instanceMatrix"===s){var M;if(void 0===(M=b.get(t.instanceMatrix)))continue;f=M.buffer,g=M.type,v.enableAttributeAndDivisor(u+0,1),v.enableAttributeAndDivisor(u+1,1),v.enableAttributeAndDivisor(u+2,1),v.enableAttributeAndDivisor(u+3,1),d.bindBuffer(34962,f),d.vertexAttribPointer(u+0,4,g,!1,64,0),d.vertexAttribPointer(u+1,4,g,!1,64,16),d.vertexAttribPointer(u+2,4,g,!1,64,32),d.vertexAttribPointer(u+3,4,g,!1,64,48)}else if(void 0!==o){var A=o[s];if(void 0!==A)switch(A.length){case 2:d.vertexAttrib2fv(u,A);break;case 3:d.vertexAttrib3fv(u,A);break;case 4:d.vertexAttrib4fv(u,A);break;default:d.vertexAttrib1fv(u,A)}}}}v.disableUnusedAttributes()}}(i,r,n,s),null!==l&&d.bindBuffer(34963,h.buffer));var y=null!==l?l.count:c.count,_=r.drawRange.start*f,w=r.drawRange.count*f,M=null!==a?a.start*f:0,A=null!==a?a.count*f:1/0,E=Math.max(_,M),S=Math.min(y,_+w,M+A)-1,P=Math.max(0,S-E+1);if(0!==P){if(i.isMesh)!0===n.wireframe?(v.setLineWidth(n.wireframeLinewidth*at()),g.setMode(1)):g.setMode(4);else if(i.isLine){var L=n.linewidth;void 0===L&&(L=1),v.setLineWidth(L*at()),g.setMode(i.isLineSegments?1:i.isLineLoop?2:3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);i.isInstancedMesh?g.renderInstances(r,E,P,i.count):r.isInstancedBufferGeometry?g.renderInstances(r,E,P,r.maxInstancedCount):g.render(E,P)}},this.compile=function(t,e){(f=E.get(t,e)).init(),t.traverse((function(t){t.isLight&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(e),t.traverse((function(e){if(e.material)if(Array.isArray(e.material))for(var r=0;r<e.material.length;r++)xt(e.material[r],t,e);else xt(e.material,t,e)}))};var vt=null,gt=new WebGLAnimation;function yt(t,e,r,n){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Q.intersectsSprite(t)){n&&it.setFromMatrixPosition(t.matrixWorld).applyMatrix4(nt);var i=w.update(t);(a=t.material).visible&&h.push(t,i,a,r,it.z,null)}}else if(t.isImmediateRenderObject)n&&it.setFromMatrixPosition(t.matrixWorld).applyMatrix4(nt),h.push(t,null,t.material,r,it.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==g.render.frame&&(t.skeleton.update(),t.skeleton.frame=g.render.frame),!t.frustumCulled||Q.intersectsObject(t))){n&&it.setFromMatrixPosition(t.matrixWorld).applyMatrix4(nt),i=w.update(t);var a=t.material;if(Array.isArray(a))for(var o=i.groups,s=0,u=o.length;s<u;s++){var l=o[s],c=a[l.materialIndex];c&&c.visible&&h.push(t,i,c,r,it.z,l)}else a.visible&&h.push(t,i,a,r,it.z,null)}var d=t.children;for(s=0,u=d.length;s<u;s++)yt(d[s],e,r,n)}}function _t(t,e,r,n){for(var i=0,a=t.length;i<a;i++){var o=t[i],s=o.object,u=o.geometry,l=void 0===n?o.material:n,c=o.group;if(r.isArrayCamera)if(z=r,ut.enabled&&lt.isAvailable())bt(s,e,r,u,l,c);else for(var h=r.cameras,d=0,p=h.length;d<p;d++){var m=h[d];s.layers.test(m.layers)&&(v.viewport(G.copy(m.viewport)),f.setupLights(m),bt(s,e,m,u,l,c))}else z=null,bt(s,e,r,u,l,c)}}function bt(t,e,r,n,i,a){if(t.onBeforeRender(L,e,r,n,i,a),f=E.get(e,z||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var o=wt(r,e,i,t);v.setMaterial(i),N.geometry=null,N.program=null,N.wireframe=!1,function(t,e){t.render((function(t){L.renderBufferImmediate(t,e)}))}(t,o)}else L.renderBufferDirect(r,e,n,i,t,a);t.onAfterRender(L,e,r,n,i,a),f=E.get(e,z||r)}function xt(t,e,r){var n=y.get(t),i=f.state.lights,a=i.state.version,o=M.getParameters(t,i.state,f.state.shadowsArray,e,tt.numPlanes,tt.numIntersection,r),s=M.getProgramCacheKey(t,o),u=n.program,l=!0;if(void 0===u)t.addEventListener("dispose",dt);else if(u.cacheKey!==s)pt(t);else if(n.lightsStateVersion!==a)n.lightsStateVersion=a,l=!1;else{if(void 0!==o.shaderID)return;l=!1}if(l){if(o.shaderID){var c=ShaderLib[o.shaderID];n.shader={name:t.type,uniforms:cloneUniforms(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else n.shader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.onBeforeCompile(n.shader,L),s=M.getProgramCacheKey(t,o),u=M.acquireProgram(t,n.shader,o,s),n.program=u,n.environment=t.isMeshStandardMaterial?e.environment:null,n.outputEncoding=L.outputEncoding,t.program=u}var h=u.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<L.maxMorphTargets;d++)h["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals)for(t.numSupportedMorphNormals=0,d=0;d<L.maxMorphNormals;d++)h["morphNormal"+d]>=0&&t.numSupportedMorphNormals++;var p=n.shader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=tt.numPlanes,n.numIntersection=tt.numIntersection,p.clippingPlanes=tt.uniform),n.fog=e.fog,n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(p.ambientLightColor.value=i.state.ambient,p.lightProbe.value=i.state.probe,p.directionalLights.value=i.state.directional,p.spotLights.value=i.state.spot,p.rectAreaLights.value=i.state.rectArea,p.pointLights.value=i.state.point,p.hemisphereLights.value=i.state.hemi,p.directionalShadowMap.value=i.state.directionalShadowMap,p.directionalShadowMatrix.value=i.state.directionalShadowMatrix,p.spotShadowMap.value=i.state.spotShadowMap,p.spotShadowMatrix.value=i.state.spotShadowMatrix,p.pointShadowMap.value=i.state.pointShadowMap,p.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=n.program.getUniforms(),v=WebGLUniforms.seqWithValue(m.seq,p);n.uniformsList=v}function wt(t,e,r,n){_.resetTextureUnits();var i=e.fog,a=r.isMeshStandardMaterial?e.environment:null,o=y.get(r),s=f.state.lights;et&&(rt||t!==U)&&tt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,o,t===U&&r.id===j),r.version===o.__version&&(void 0===o.program||r.fog&&o.fog!==i||o.environment!==a||o.needsLights&&o.lightsStateVersion!==s.state.version?r.needsUpdate=!0:void 0===o.numClippingPlanes||o.numClippingPlanes===tt.numPlanes&&o.numIntersection===tt.numIntersection?o.outputEncoding!==L.outputEncoding&&(r.needsUpdate=!0):r.needsUpdate=!0),r.version!==o.__version&&(xt(r,e,n),o.__version=r.version);var u,l,c=!1,h=!1,p=!1,g=o.program,b=g.getUniforms(),x=o.shader.uniforms;if(v.useProgram(g.program)&&(c=!0,h=!0,p=!0),r.id!==j&&(j=r.id,h=!0),c||U!==t){if(g.numMultiviewViews>0?lt.updateCameraProjectionMatricesUniform(t,b):b.setValue(d,"projectionMatrix",t.projectionMatrix),m.logarithmicDepthBuffer&&b.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),U!==t&&(U=t,h=!0,p=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var w=b.map.cameraPosition;void 0!==w&&w.setValue(d,it.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&b.setValue(d,"isOrthographic",!0===t.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&(g.numMultiviewViews>0?lt.updateCameraViewMatricesUniform(t,b):b.setValue(d,"viewMatrix",t.matrixWorldInverse))}if(r.skinning){b.setOptional(d,n,"bindMatrix"),b.setOptional(d,n,"bindMatrixInverse");var M=n.skeleton;if(M)if(m.floatVertexTextures){if(void 0===M.boneTexture){var A=Math.sqrt(4*M.bones.length);A=_Math.ceilPowerOfTwo(A),A=Math.max(A,4);var E=new Float32Array(A*A*4);E.set(M.boneMatrices);var S=new DataTexture(E,A,A,RGBAFormat,FloatType);M.boneMatrices=E,M.boneTexture=S,M.boneTextureSize=A}b.setValue(d,"boneTexture",M.boneTexture,_),b.setValue(d,"boneTextureSize",M.boneTextureSize)}else b.setOptional(d,M,"boneMatrices")}return(h||o.receiveShadow!==n.receiveShadow)&&(o.receiveShadow=n.receiveShadow,b.setValue(d,"receiveShadow",n.receiveShadow)),h&&(b.setValue(d,"toneMappingExposure",L.toneMappingExposure),b.setValue(d,"toneMappingWhitePoint",L.toneMappingWhitePoint),o.needsLights&&((u=x).ambientLightColor.needsUpdate=l=p,u.lightProbe.needsUpdate=l,u.directionalLights.needsUpdate=l,u.pointLights.needsUpdate=l,u.spotLights.needsUpdate=l,u.rectAreaLights.needsUpdate=l,u.hemisphereLights.needsUpdate=l),i&&r.fog&&function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}(x,i),r.isMeshBasicMaterial?Mt(x,r):r.isMeshLambertMaterial?(Mt(x,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(x,r)):r.isMeshToonMaterial?(Mt(x,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,r)):r.isMeshPhongMaterial?(Mt(x,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,r)):r.isMeshStandardMaterial?(Mt(x,r,a),r.isMeshPhysicalMaterial?function(t,e,r){At(t,e,r),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===BackSide&&t.clearcoatNormalScale.value.negate()),t.transparency.value=e.transparency}(x,r,a):At(x,r,a)):r.isMeshMatcapMaterial?(Mt(x,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,r)):r.isMeshDepthMaterial?(Mt(x,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,r)):r.isMeshDistanceMaterial?(Mt(x,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(x,r)):r.isMeshNormalMaterial?(Mt(x,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(x,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(x,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(x,r)):r.isPointsMaterial?function(t,e){var r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*q,t.scale.value=.5*$,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(x,r):r.isSpriteMaterial?function(t,e){var r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(x,r):r.isShadowMaterial&&(x.color.value.copy(r.color),x.opacity.value=r.opacity),void 0!==x.ltc_1&&(x.ltc_1.value=UniformsLib.LTC_1),void 0!==x.ltc_2&&(x.ltc_2.value=UniformsLib.LTC_2),WebGLUniforms.upload(d,o.uniformsList,x,_),r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(WebGLUniforms.upload(d,o.uniformsList,x,_),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&b.setValue(d,"center",n.center),g.numMultiviewViews>0?lt.updateObjectMatricesUniforms(n,t,b):(b.setValue(d,"modelViewMatrix",n.modelViewMatrix),b.setValue(d,"normalMatrix",n.normalMatrix)),b.setValue(d,"modelMatrix",n.matrixWorld),g}function Mt(t,e,r){t.opacity.value=e.opacity,e.color&&t.diffuse.value.copy(e.color),e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.specularMap&&(t.specularMap.value=e.specularMap);var n,i,a=e.envMap||r;a&&(t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio,t.maxMipLevel.value=y.get(a).__maxMipLevel),e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity),e.map?n=e.map:e.specularMap?n=e.specularMap:e.displacementMap?n=e.displacementMap:e.normalMap?n=e.normalMap:e.bumpMap?n=e.bumpMap:e.roughnessMap?n=e.roughnessMap:e.metalnessMap?n=e.metalnessMap:e.alphaMap?n=e.alphaMap:e.emissiveMap&&(n=e.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix)),e.aoMap?i=e.aoMap:e.lightMap&&(i=e.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function At(t,e,r){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===BackSide&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===BackSide&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||r)&&(t.envMapIntensity.value=e.envMapIntensity)}gt.setAnimationLoop((function(t){ut.isPresenting||vt&&vt(t)})),"undefined"!=typeof window&&gt.setContext(window),this.setAnimationLoop=function(t){vt=t,ut.setAnimationLoop(t),gt.start()},this.render=function(t,e){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),e&&e.isCamera){if(!I){N.geometry=null,N.program=null,N.wireframe=!1,j=-1,U=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),ut.enabled&&ut.isPresenting&&(e=ut.getCamera(e)),(f=E.get(t,e)).init(),t.onBeforeRender(L,t,e,r||B),nt.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),Q.setFromMatrix(nt),et=tt.init(this.clippingPlanes,rt=this.localClippingEnabled,e),(h=A.get(t,e)).init(),yt(t,e,0,L.sortObjects),!0===L.sortObjects&&h.sort(X,K),et&&tt.beginShadows();var i=f.state.shadowsArray;ct.render(i,t,e),f.setupLights(e),et&&tt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),ut.enabled&&lt.isAvailable()&&lt.attachCamera(e),S.render(h,t,e,n);var a=h.opaque,o=h.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;a.length&&_t(a,t,e,s),o.length&&_t(o,t,e,s)}else a.length&&_t(a,t,e),o.length&&_t(o,t,e);t.onAfterRender(L,t,e),null!==B&&(_.updateRenderTargetMipmap(B),_.updateMultisampleRenderTarget(B)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),ut.enabled&&lt.isAvailable()&&lt.detachCamera(e),h=null,f=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){k!==t&&null===B&&d.bindFramebuffer(36160,t),k=t},this.getActiveCubeFace=function(){return R},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return B},this.setRenderTarget=function(t,e,r){B=t,R=e,D=r,t&&void 0===y.get(t).__webglFramebuffer&&_.setupRenderTarget(t);var n=k,i=!1;if(t){var a=y.get(t).__webglFramebuffer;t.isWebGLRenderTargetCube?(n=a[e||0],i=!0):n=t.isWebGLMultisampleRenderTarget?y.get(t).__webglMultisampledFramebuffer:a,G.copy(t.viewport),V.copy(t.scissor),H=t.scissorTest}else G.copy(Z).multiplyScalar(q).floor(),V.copy(Y).multiplyScalar(q).floor(),H=J;if(F!==n&&(d.bindFramebuffer(36160,n),F=n),v.viewport(G),v.scissor(V),v.setScissorTest(H),i){var o=y.get(t.texture);d.framebufferTexture2D(36160,36064,34069+(e||0),o.__webglTexture,r||0)}},this.readRenderTargetPixels=function(t,e,r,n,i,a,o){if(t&&t.isWebGLRenderTarget){var s=y.get(t).__webglFramebuffer;if(t.isWebGLRenderTargetCube&&void 0!==o&&(s=s[o]),s){var u=!1;s!==F&&(d.bindFramebuffer(36160,s),u=!0);try{var l=t.texture,c=l.format,h=l.type;if(c!==RGBAFormat&&P.convert(c)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===UnsignedByteType||P.convert(h)===d.getParameter(35738)||h===FloatType&&(m.isWebGL2||p.get("OES_texture_float")||p.get("WEBGL_color_buffer_float"))||h===HalfFloatType&&p.get(m.isWebGL2?"EXT_color_buffer_float":"EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&d.readPixels(e,r,n,i,P.convert(c),P.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{u&&d.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){void 0===r&&(r=0);var n=Math.pow(2,-r),i=Math.floor(e.image.width*n),a=Math.floor(e.image.height*n),o=P.convert(e.format);_.setTexture2D(e,0),d.copyTexImage2D(3553,r,o,t.x,t.y,i,a,0),v.unbindTexture()},this.copyTextureToTexture=function(t,e,r,n){var i=e.image.width,a=e.image.height,o=P.convert(r.format),s=P.convert(r.type);_.setTexture2D(r,0),e.isDataTexture?d.texSubImage2D(3553,n||0,t.x,t.y,i,a,o,s,e.image.data):d.texSubImage2D(3553,n||0,t.x,t.y,o,s,e.image),v.unbindTexture()},this.initTexture=function(t){_.setTexture2D(t,0),v.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function FogExp2(t,e){this.name="",this.color=new Color$c(t),this.density=void 0!==e?e:25e-5}function Fog(t,e,r){this.name="",this.color=new Color$c(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function InterleavedBuffer(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.version=0}WebGLMultiviewRenderTarget.prototype=Object.assign(Object.create(WebGLRenderTarget.prototype),{constructor:WebGLMultiviewRenderTarget,isWebGLMultiviewRenderTarget:!0,copy:function(t){return WebGLRenderTarget.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}}),ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0}),Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0}),Object.assign(WebXRManager.prototype,EventDispatcher.prototype),Object.assign(FogExp2.prototype,{isFogExp2:!0,clone:function(){return new FogExp2(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Fog.prototype,{isFog:!0,clone:function(){return new Fog(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var _vector$7=new Vector3$1,_geometry;function InterleavedBufferAttribute(t,e,r,n){this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function SpriteMaterial(t){Material.call(this),this.type="SpriteMaterial",this.color=new Color$c(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,r=this.data.count;e<r;e++)_vector$7.x=this.getX(e),_vector$7.y=this.getY(e),_vector$7.z=this.getZ(e),_vector$7.applyMatrix4(t),this.setXYZ(e,_vector$7.x,_vector$7.y,_vector$7.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return this.data.array[(t=t*this.data.stride+this.offset)+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this}}),SpriteMaterial.prototype=Object.create(Material.prototype),SpriteMaterial.prototype.constructor=SpriteMaterial,SpriteMaterial.prototype.isSpriteMaterial=!0,SpriteMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var _intersectPoint=new Vector3$1,_worldScale=new Vector3$1,_mvPosition=new Vector3$1,_alignedPosition=new Vector2$3,_rotatedPosition=new Vector2$3,_viewWorldMatrix=new Matrix4$2,_vA$1=new Vector3$1,_vB$1=new Vector3$1,_vC$1=new Vector3$1,_uvA$1=new Vector2$3,_uvB$1=new Vector2$3,_uvC$1=new Vector2$3;function Sprite(t){if(Object3D.call(this),this.type="Sprite",void 0===_geometry){_geometry=new BufferGeometry$1;var e=new InterleavedBuffer(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);_geometry.setIndex([0,1,2,0,2,3]),_geometry.setAttribute("position",new InterleavedBufferAttribute(e,3,0,!1)),_geometry.setAttribute("uv",new InterleavedBufferAttribute(e,2,3,!1))}this.geometry=_geometry,this.material=void 0!==t?t:new SpriteMaterial,this.center=new Vector2$3(.5,.5)}function transformVertex(t,e,r,n,i,a){_alignedPosition.subVectors(t,r).addScalar(.5).multiply(n),void 0!==i?(_rotatedPosition.x=a*_alignedPosition.x-i*_alignedPosition.y,_rotatedPosition.y=i*_alignedPosition.x+a*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),t.copy(e),t.x+=_rotatedPosition.x,t.y+=_rotatedPosition.y,t.applyMatrix4(_viewWorldMatrix)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&_worldScale.multiplyScalar(-_mvPosition.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var a=this.center;transformVertex(_vA$1.set(-.5,-.5,0),_mvPosition,a,_worldScale,r,n),transformVertex(_vB$1.set(.5,-.5,0),_mvPosition,a,_worldScale,r,n),transformVertex(_vC$1.set(.5,.5,0),_mvPosition,a,_worldScale,r,n),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);var o=t.ray.intersectTriangle(_vA$1,_vB$1,_vC$1,!1,_intersectPoint);if(null!==o||(transformVertex(_vB$1.set(-.5,.5,0),_mvPosition,a,_worldScale,r,n),_uvB$1.set(0,1),null!==(o=t.ray.intersectTriangle(_vA$1,_vC$1,_vB$1,!1,_intersectPoint)))){var s=t.ray.origin.distanceTo(_intersectPoint);s<t.near||s>t.far||e.push({distance:s,point:_intersectPoint.clone(),uv:Triangle.getUV(_intersectPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2$3),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Object3D.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var _v1$4=new Vector3$1,_v2$2=new Vector3$1;function LOD(){Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function SkinnedMesh(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Mesh.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4$2,this.bindMatrixInverse=new Matrix4$2}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,isLOD:!0,copy:function(t){Object3D.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object}return null},raycast:function(t,e){if(this.levels.length>0){_v1$4.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(_v1$4);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){_v1$4.setFromMatrixPosition(t.matrixWorld),_v2$2.setFromMatrixPosition(this.matrixWorld);var r=_v1$4.distanceTo(_v2$2);e[0].object.visible=!0;for(var n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(;n<i;n++)e[n].object.visible=!1}},toJSON:function(t){var e=Object3D.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var a=r[n];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}}),SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Vector4,e=this.geometry.attributes.skinWeight,r=0,n=e.count;r<n;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){Mesh.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _offsetMatrix=new Matrix4$2,_identityMatrix=new Matrix4$2;function Skeleton(t,e){if(this.bones=(t=t||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new Matrix4$2)}}function Bone(){Object3D.call(this),this.type="Bone"}Object.assign(Skeleton.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new Matrix4$2;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,a=t.length;i<a;i++)_offsetMatrix.multiplyMatrices(t[i]?t[i].matrixWorld:_identityMatrix,e[i]),_offsetMatrix.toArray(r,16*i);void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}}}),Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});var _instanceLocalMatrix=new Matrix4$2,_instanceWorldMatrix=new Matrix4$2,_instanceIntersects=[],_mesh=new Mesh;function InstancedMesh(t,e,r){Mesh.call(this,t,e),this.instanceMatrix=new BufferAttribute$1(new Float32Array(16*r),16),this.count=r}function LineBasicMaterial(t){Material.call(this),this.type="LineBasicMaterial",this.color=new Color$c(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}InstancedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:InstancedMesh,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var r=this.matrixWorld,n=this.count;if(_mesh.geometry=this.geometry,_mesh.material=this.material,void 0!==_mesh.material)for(var i=0;i<n;i++)this.getMatrixAt(i,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(r,_instanceLocalMatrix),_mesh.matrixWorld=_instanceWorldMatrix,_mesh.raycast(t,_instanceIntersects),_instanceIntersects.length>0&&(_instanceIntersects[0].instanceId=i,_instanceIntersects[0].object=this,e.push(_instanceIntersects[0]),_instanceIntersects.length=0)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),LineBasicMaterial.prototype=Object.create(Material.prototype),LineBasicMaterial.prototype.constructor=LineBasicMaterial,LineBasicMaterial.prototype.isLineBasicMaterial=!0,LineBasicMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var _start=new Vector3$1,_end=new Vector3$1,_inverseMatrix$1=new Matrix4$2,_ray$1=new Ray,_sphere$2=new Sphere;function Line(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Object3D.call(this),this.type="Line",this.geometry=void 0!==t?t:new BufferGeometry$1,this.material=void 0!==e?e:new LineBasicMaterial({color:16777215*Math.random()})}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],n=1,i=e.count;n<i;n++)_start.fromBufferAttribute(e,n-1),_end.fromBufferAttribute(e,n),r[n]=r[n-1],r[n]+=_start.distanceTo(_end);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for((r=t.lineDistances)[0]=0,n=1,i=a.length;n<i;n++)r[n]=r[n-1],r[n]+=a[n-1].distanceTo(a[n])}return this},raycast:function(t,e){var r=t.linePrecision,n=this.geometry,i=this.matrixWorld;if(null===n.boundingSphere&&n.computeBoundingSphere(),_sphere$2.copy(n.boundingSphere),_sphere$2.applyMatrix4(i),_sphere$2.radius+=r,!1!==t.ray.intersectsSphere(_sphere$2)){_inverseMatrix$1.getInverse(i),_ray$1.copy(t.ray).applyMatrix4(_inverseMatrix$1);var a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new Vector3$1,u=new Vector3$1,l=new Vector3$1,c=new Vector3$1,h=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,d=n.attributes.position.array;if(null!==f)for(var p=f.array,m=0,v=p.length-1;m<v;m+=h){var g=p[m+1];s.fromArray(d,3*p[m]),u.fromArray(d,3*g),_ray$1.distanceSqToSegment(s,u,c,l)>o||(c.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(c))<t.near||b>t.far||e.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else for(m=0,v=d.length/3-1;m<v;m+=h)s.fromArray(d,3*m),u.fromArray(d,3*m+3),_ray$1.distanceSqToSegment(s,u,c,l)>o||(c.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(c))<t.near||b>t.far||e.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}else if(n.isGeometry){var y=n.vertices,_=y.length;for(m=0;m<_-1;m+=h){var b;_ray$1.distanceSqToSegment(y[m],y[m+1],c,l)>o||(c.applyMatrix4(this.matrixWorld),(b=t.ray.origin.distanceTo(c))<t.near||b>t.far||e.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var _start$1=new Vector3$1,_end$1=new Vector3$1;function LineSegments(t,e){Line.call(this,t,e),this.type="LineSegments"}function LineLoop(t,e){Line.call(this,t,e),this.type="LineLoop"}function PointsMaterial(t){Material.call(this),this.type="PointsMaterial",this.color=new Color$c(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[],n=0,i=e.count;n<i;n+=2)_start$1.fromBufferAttribute(e,n),_end$1.fromBufferAttribute(e,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+_start$1.distanceTo(_end$1);t.setAttribute("lineDistance",new Float32BufferAttribute(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var a=t.vertices;for(r=t.lineDistances,n=0,i=a.length;n<i;n+=2)_start$1.copy(a[n]),_end$1.copy(a[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+_start$1.distanceTo(_end$1)}return this}}),LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0}),PointsMaterial.prototype=Object.create(Material.prototype),PointsMaterial.prototype.constructor=PointsMaterial,PointsMaterial.prototype.isPointsMaterial=!0,PointsMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var _inverseMatrix$2=new Matrix4$2,_ray$2=new Ray,_sphere$3=new Sphere,_position$1=new Vector3$1;function Points(t,e){Object3D.call(this),this.type="Points",this.geometry=void 0!==t?t:new BufferGeometry$1,this.material=void 0!==e?e:new PointsMaterial({color:16777215*Math.random()}),this.updateMorphTargets()}function testPoint(t,e,r,n,i,a,o){var s=_ray$2.distanceSqToPoint(t);if(s<r){var u=new Vector3$1;_ray$2.closestPointToPoint(t,u),u.applyMatrix4(n);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:e,face:null,object:o})}}function VideoTexture(t,e,r,n,i,a,o,s,u){Texture.call(this,t,e,r,n,i,a,o,s,u),this.format=void 0!==o?o:RGBFormat,this.minFilter=void 0!==a?a:LinearFilter,this.magFilter=void 0!==i?i:LinearFilter,this.generateMipmaps=!1}function CompressedTexture(t,e,r,n,i,a,o,s,u,l,c,h){Texture.call(this,null,a,o,s,u,l,n,i,c,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function CanvasTexture(t,e,r,n,i,a,o,s,u){Texture.call(this,t,e,r,n,i,a,o,s,u),this.needsUpdate=!0}function DepthTexture(t,e,r,n,i,a,o,s,u,l){if((l=void 0!==l?l:DepthFormat)!==DepthFormat&&l!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&l===DepthFormat&&(r=UnsignedShortType),void 0===r&&l===DepthStencilFormat&&(r=UnsignedInt248Type),Texture.call(this,null,n,i,a,o,s,l,r,u),this.image={width:t,height:e},this.magFilter=void 0!==o?o:NearestFilter,this.minFilter=void 0!==s?s:NearestFilter,this.flipY=!1,this.generateMipmaps=!1}function WireframeGeometry(t){BufferGeometry$1.call(this),this.type="WireframeGeometry";var e,r,n,i,a,o,s,u,l,c,h=[],f=[0,0],d={},p=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var v=m[e];for(r=0;r<3;r++)s=v[p[r]],u=v[p[(r+1)%3]],f[0]=Math.min(s,u),f[1]=Math.max(s,u),void 0===d[l=f[0]+","+f[1]]&&(d[l]={index1:f[0],index2:f[1]})}for(l in d)h.push((c=t.vertices[(o=d[l]).index1]).x,c.y,c.z),h.push((c=t.vertices[o.index2]).x,c.y,c.z)}else if(t&&t.isBufferGeometry){var g,y,_,b,x;if(c=new Vector3$1,null!==t.index){for(g=t.attributes.position,y=t.index,0===(_=t.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,a=_.length;i<a;++i)for(e=x=(b=_[i]).start,n=x+b.count;e<n;e+=3)for(r=0;r<3;r++)s=y.getX(e+r),u=y.getX(e+(r+1)%3),f[0]=Math.min(s,u),f[1]=Math.max(s,u),void 0===d[l=f[0]+","+f[1]]&&(d[l]={index1:f[0],index2:f[1]});for(l in d)c.fromBufferAttribute(g,(o=d[l]).index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(g,o.index2),h.push(c.x,c.y,c.z)}else for(e=0,n=(g=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)c.fromBufferAttribute(g,3*e+r),h.push(c.x,c.y,c.z),c.fromBufferAttribute(g,3*e+(r+1)%3),h.push(c.x,c.y,c.z)}this.setAttribute("position",new Float32BufferAttribute(h,3))}function ParametricGeometry(t,e,r){Geometry$2.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new ParametricBufferGeometry(t,e,r)),this.mergeVertices()}function ParametricBufferGeometry(t,e,r){BufferGeometry$1.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,a=[],o=[],s=[],u=[],l=1e-5,c=new Vector3$1,h=new Vector3$1,f=new Vector3$1,d=new Vector3$1,p=new Vector3$1;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(n=0;n<=r;n++){var v=n/r;for(i=0;i<=e;i++){var g=i/e;t(g,v,h),o.push(h.x,h.y,h.z),g-l>=0?(t(g-l,v,f),d.subVectors(h,f)):(t(g+l,v,f),d.subVectors(f,h)),v-l>=0?(t(g,v-l,f),p.subVectors(h,f)):(t(g,v+l,f),p.subVectors(f,h)),c.crossVectors(d,p).normalize(),s.push(c.x,c.y,c.z),u.push(g,v)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var y=n*m+i+1,_=(n+1)*m+i+1,b=(n+1)*m+i;a.push(n*m+i,y,b),a.push(y,_,b)}this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}function PolyhedronGeometry(t,e,r,n){Geometry$2.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new PolyhedronBufferGeometry(t,e,r,n)),this.mergeVertices()}function PolyhedronBufferGeometry(t,e,r,n){BufferGeometry$1.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],a=[];function o(t,e,r,n){var i,a,o=Math.pow(2,n),u=[];for(i=0;i<=o;i++){u[i]=[];var l=t.clone().lerp(r,i/o),c=e.clone().lerp(r,i/o),h=o-i;for(a=0;a<=h;a++)u[i][a]=0===a&&i===o?l:l.clone().lerp(c,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var f=Math.floor(a/2);a%2==0?(s(u[i][f+1]),s(u[i+1][f]),s(u[i][f])):(s(u[i][f+1]),s(u[i+1][f+1]),s(u[i+1][f]))}}function s(t){i.push(t.x,t.y,t.z)}function u(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function l(t,e,r,n){n<0&&1===t.x&&(a[e]=t.x-1),0===r.x&&0===r.z&&(a[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){for(var r=new Vector3$1,n=new Vector3$1,i=new Vector3$1,a=0;a<e.length;a+=3)u(e[a+0],r),u(e[a+1],n),u(e[a+2],i),o(r,n,i,t)}(n=n||0),function(t){for(var e=new Vector3$1,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new Vector3$1,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=c(t)/2/Math.PI+.5,n=(o=t,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(r,1-n)}var o;(function(){for(var t=new Vector3$1,e=new Vector3$1,r=new Vector3$1,n=new Vector3$1,o=new Vector2$3,s=new Vector2$3,u=new Vector2$3,h=0,f=0;h<i.length;h+=9,f+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),o.set(a[f+0],a[f+1]),s.set(a[f+2],a[f+3]),u.set(a[f+4],a[f+5]),n.copy(t).add(e).add(r).divideScalar(3);var d=c(n);l(o,f+0,t,d),l(s,f+2,e,d),l(u,f+4,r,d)}})(),function(){for(var t=0;t<a.length;t+=6){var e=a[t+0],r=a[t+2],n=a[t+4],i=Math.max(e,r,n),o=Math.min(e,r,n);i>.9&&o<.1&&(e<.2&&(a[t+0]+=1),r<.2&&(a[t+2]+=1),n<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(i,3)),this.setAttribute("normal",new Float32BufferAttribute(i.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function TetrahedronGeometry(t,e){Geometry$2.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new TetrahedronBufferGeometry(t,e)),this.mergeVertices()}function TetrahedronBufferGeometry(t,e){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function OctahedronGeometry(t,e){Geometry$2.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new OctahedronBufferGeometry(t,e)),this.mergeVertices()}function OctahedronBufferGeometry(t,e){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function IcosahedronGeometry(t,e){Geometry$2.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new IcosahedronBufferGeometry(t,e)),this.mergeVertices()}function IcosahedronBufferGeometry(t,e){var r=(1+Math.sqrt(5))/2;PolyhedronBufferGeometry.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function DodecahedronGeometry(t,e){Geometry$2.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new DodecahedronBufferGeometry(t,e)),this.mergeVertices()}function DodecahedronBufferGeometry(t,e){var r=(1+Math.sqrt(5))/2,n=1/r;PolyhedronBufferGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function TubeGeometry(t,e,r,n,i,a){Geometry$2.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new TubeBufferGeometry(t,e,r,n,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function TubeBufferGeometry(t,e,r,n,i){BufferGeometry$1.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},r=r||1,n=n||8;var a=t.computeFrenetFrames(e=e||64,i=i||!1);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,u=new Vector3$1,l=new Vector3$1,c=new Vector2$3,h=new Vector3$1,f=[],d=[],p=[],m=[];function v(i){h=t.getPointAt(i/e,h);var o=a.normals[i],c=a.binormals[i];for(s=0;s<=n;s++){var p=s/n*Math.PI*2,m=Math.sin(p),v=-Math.cos(p);l.x=v*o.x+m*c.x,l.y=v*o.y+m*c.y,l.z=v*o.z+m*c.z,l.normalize(),d.push(l.x,l.y,l.z),u.x=h.x+r*l.x,u.y=h.y+r*l.y,u.z=h.z+r*l.z,f.push(u.x,u.y,u.z)}}!function(){for(o=0;o<e;o++)v(o);v(!1===i?e:0),function(){for(o=0;o<=e;o++)for(s=0;s<=n;s++)c.x=o/e,c.y=s/n,p.push(c.x,c.y)}(),function(){for(s=1;s<=e;s++)for(o=1;o<=n;o++){var t=(n+1)*s+(o-1),r=(n+1)*s+o,i=(n+1)*(s-1)+o;m.push((n+1)*(s-1)+(o-1),t,i),m.push(t,r,i)}}()}(),this.setIndex(m),this.setAttribute("position",new Float32BufferAttribute(f,3)),this.setAttribute("normal",new Float32BufferAttribute(d,3)),this.setAttribute("uv",new Float32BufferAttribute(p,2))}function TorusKnotGeometry(t,e,r,n,i,a,o){Geometry$2.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new TorusKnotBufferGeometry(t,e,r,n,i,a)),this.mergeVertices()}function TorusKnotBufferGeometry(t,e,r,n,i,a){BufferGeometry$1.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:a},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,a=a||3;var o,s,u=[],l=[],c=[],h=[],f=new Vector3$1,d=new Vector3$1,p=new Vector3$1,m=new Vector3$1,v=new Vector3$1,g=new Vector3$1,y=new Vector3$1;for(o=0;o<=r;++o){var _=o/r*i*Math.PI*2;for(S(_,i,a,t,p),S(_+.01,i,a,t,m),g.subVectors(m,p),y.addVectors(m,p),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,x=-e*Math.cos(b),w=e*Math.sin(b);f.x=p.x+(x*y.x+w*v.x),f.y=p.y+(x*y.y+w*v.y),f.z=p.z+(x*y.z+w*v.z),l.push(f.x,f.y,f.z),d.subVectors(f,p).normalize(),c.push(d.x,d.y,d.z),h.push(o/r),h.push(s/n)}}for(s=1;s<=r;s++)for(o=1;o<=n;o++){var M=(n+1)*s+(o-1),A=(n+1)*s+o,E=(n+1)*(s-1)+o;u.push((n+1)*(s-1)+(o-1),M,E),u.push(M,A,E)}function S(t,e,r,n,i){var a=Math.cos(t),o=Math.sin(t),s=r/e*t,u=Math.cos(s);i.x=n*(2+u)*.5*a,i.y=n*(2+u)*o*.5,i.z=n*Math.sin(s)*.5}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}function TorusGeometry(t,e,r,n,i){Geometry$2.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new TorusBufferGeometry(t,e,r,n,i)),this.mergeVertices()}function TorusBufferGeometry(t,e,r,n,i){BufferGeometry$1.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var a,o,s=[],u=[],l=[],c=[],h=new Vector3$1,f=new Vector3$1,d=new Vector3$1;for(a=0;a<=r;a++)for(o=0;o<=n;o++){var p=o/n*i,m=a/r*Math.PI*2;f.x=(t+e*Math.cos(m))*Math.cos(p),f.y=(t+e*Math.cos(m))*Math.sin(p),f.z=e*Math.sin(m),u.push(f.x,f.y,f.z),h.x=t*Math.cos(p),h.y=t*Math.sin(p),d.subVectors(f,h).normalize(),l.push(d.x,d.y,d.z),c.push(o/n),c.push(a/r)}for(a=1;a<=r;a++)for(o=1;o<=n;o++){var v=(n+1)*(a-1)+o-1,g=(n+1)*(a-1)+o,y=(n+1)*a+o;s.push((n+1)*a+o-1,v,y),s.push(v,g,y)}this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),_sphere$3.copy(r.boundingSphere),_sphere$3.applyMatrix4(n),_sphere$3.radius+=i,!1!==t.ray.intersectsSphere(_sphere$3)){_inverseMatrix$2.getInverse(n),_ray$2.copy(t.ray).applyMatrix4(_inverseMatrix$2);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(r.isBufferGeometry){var s=r.index,u=r.attributes.position.array;if(null!==s)for(var l=s.array,c=0,h=l.length;c<h;c++){var f=l[c];_position$1.fromArray(u,3*f),testPoint(_position$1,f,o,n,t,e,this)}else{c=0;for(var d=u.length/3;c<d;c++)_position$1.fromArray(u,3*c),testPoint(_position$1,c,o,n,t,e,this)}}else{var p=r.vertices;for(c=0,d=p.length;c<d;c++)testPoint(p[c],c,o,n,t,e,this)}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=o.length;t<e;t++)r=o[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),CompressedTexture.prototype=Object.create(Texture.prototype),CompressedTexture.prototype.constructor=CompressedTexture,CompressedTexture.prototype.isCompressedTexture=!0,CanvasTexture.prototype=Object.create(Texture.prototype),CanvasTexture.prototype.constructor=CanvasTexture,CanvasTexture.prototype.isCanvasTexture=!0,DepthTexture.prototype=Object.create(Texture.prototype),DepthTexture.prototype.constructor=DepthTexture,DepthTexture.prototype.isDepthTexture=!0,WireframeGeometry.prototype=Object.create(BufferGeometry$1.prototype),WireframeGeometry.prototype.constructor=WireframeGeometry,ParametricGeometry.prototype=Object.create(Geometry$2.prototype),ParametricGeometry.prototype.constructor=ParametricGeometry,ParametricBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry,PolyhedronGeometry.prototype=Object.create(Geometry$2.prototype),PolyhedronGeometry.prototype.constructor=PolyhedronGeometry,PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry,TetrahedronGeometry.prototype=Object.create(Geometry$2.prototype),TetrahedronGeometry.prototype.constructor=TetrahedronGeometry,TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry,OctahedronGeometry.prototype=Object.create(Geometry$2.prototype),OctahedronGeometry.prototype.constructor=OctahedronGeometry,OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry,IcosahedronGeometry.prototype=Object.create(Geometry$2.prototype),IcosahedronGeometry.prototype.constructor=IcosahedronGeometry,IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry,DodecahedronGeometry.prototype=Object.create(Geometry$2.prototype),DodecahedronGeometry.prototype.constructor=DodecahedronGeometry,DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype),DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry,TubeGeometry.prototype=Object.create(Geometry$2.prototype),TubeGeometry.prototype.constructor=TubeGeometry,TubeBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),TubeBufferGeometry.prototype.constructor=TubeBufferGeometry,TubeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry$1.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},TorusKnotGeometry.prototype=Object.create(Geometry$2.prototype),TorusKnotGeometry.prototype.constructor=TorusKnotGeometry,TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry,TorusGeometry.prototype=Object.create(Geometry$2.prototype),TorusGeometry.prototype.constructor=TorusGeometry,TorusBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Earcut={triangulate:function(t,e,r){r=r||2;var n,i,a,o,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,f=linkedList(t,0,h,r,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=eliminateHoles(t,e,f,r)),t.length>80*r){n=a=t[0],i=o=t[1];for(var p=r;p<h;p+=r)(s=t[p])<n&&(n=s),(u=t[p+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-n,o-i))?1/l:0}return earcutLinked(f,d,r,n,i,l),d}};function linkedList(t,e,r,n,i){var a,o;if(i===signedArea(t,e,r,n)>0)for(a=e;a<r;a+=n)o=insertNode$1(a,t[a],t[a+1],o);else for(a=r-n;a>=e;a-=n)o=insertNode$1(a,t[a],t[a+1],o);return o&&equals$2(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!equals$2(n,n.next)&&0!==area$2(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function earcutLinked(t,e,r,n,i,a,o){if(t){!o&&a&&indexCurve(t,n,i,a);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?isEarHashed(t,n,i,a):isEar(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),removeNode(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?earcutLinked(t=cureLocalIntersections(t,e,r),e,r,n,i,a,2):2===o&&splitEarcut(t,e,r,n,i,a):earcutLinked(filterPoints(t),e,r,n,i,a,1);break}}}function isEar(t){var e=t.prev,r=t,n=t.next;if(area$2(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(pointInTriangle(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&area$2(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(t,e,r,n){var i=t.prev,a=t,o=t.next;if(area$2(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,l=zOrder(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,e,r,n),c=zOrder(s,u,e,r,n),h=t.prevZ,f=t.nextZ;h&&h.z>=l&&f&&f.z<=c;){if(h!==t.prev&&h!==t.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&area$2(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==t.prev&&f!==t.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&area$2(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&area$2(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&pointInTriangle(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&area$2(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function cureLocalIntersections(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!equals$2(i,a)&&intersects$1(i,n,n.next,a)&&locallyInside(i,a)&&locallyInside(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),removeNode(n),removeNode(n.next),n=t=a),n=n.next}while(n!==t);return n}function splitEarcut(t,e,r,n,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&isValidDiagonal(o,s)){var u=splitPolygon(o,s);return o=filterPoints(o,o.next),u=filterPoints(u,u.next),earcutLinked(o,e,r,n,i,a),void earcutLinked(u,e,r,n,i,a)}s=s.next}o=o.next}while(o!==t)}function eliminateHoles(t,e,r,n){var i,a,o,s=[];for(i=0,a=e.length;i<a;i++)(o=linkedList(t,e[i]*n,i<a-1?e[i+1]*n:t.length,n,!1))===o.next&&(o.steiner=!0),s.push(getLeftmost(o));for(s.sort(compareX),i=0;i<s.length;i++)eliminateHole(s[i],r),r=filterPoints(r,r.next);return r}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){var r=splitPolygon(e,t);filterPoints(r,r.next)}}function findHoleBridge(t,e){var r,n=e,i=t.x,a=t.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===o)return r.prev;var u,l=r,c=r.x,h=r.y,f=1/0;for(n=r.next;n!==l;)i>=n.x&&n.x>=c&&i!==n.x&&pointInTriangle(a<h?i:o,a,c,h,a<h?o:i,a,n.x,n.y)&&((u=Math.abs(a-n.y)/(i-n.x))<f||u===f&&n.x>r.x)&&locallyInside(n,t)&&(r=n,f=u),n=n.next;return r}function indexCurve(t,e,r,n){var i=t;do{null===i.z&&(i.z=zOrder(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(t){var e,r,n,i,a,o,s,u,l=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:t=i,i.prevZ=a,a=i;r=n}a.nextZ=null,l*=2}while(o>1);return t}function zOrder(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function pointInTriangle(t,e,r,n,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)}function area$2(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function equals$2(t,e){return t.x===e.x&&t.y===e.y}function intersects$1(t,e,r,n){return!!(equals$2(t,r)&&equals$2(e,n)||equals$2(t,n)&&equals$2(r,e))||area$2(t,e,r)>0!=area$2(t,e,n)>0&&area$2(r,n,t)>0!=area$2(r,n,e)>0}function intersectsPolygon(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&intersects$1(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function locallyInside(t,e){return area$2(t.prev,t,t.next)<0?area$2(t,e,t.next)>=0&&area$2(t,t.prev,e)>=0:area$2(t,e,t.prev)<0||area$2(t,t.next,e)<0}function middleInside(t,e){var r=t,n=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}function splitPolygon(t,e){var r=new Node(t.i,t.x,t.y),n=new Node(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function insertNode$1(t,e,r,n){var i=new Node(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,r,n){for(var i=0,a=e,o=r-n;a<r;a+=n)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}var ShapeUtils={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return ShapeUtils.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];removeDupEndPts(t),addContour(r,t);var a=t.length;e.forEach(removeDupEndPts);for(var o=0;o<e.length;o++)n.push(a),a+=e[o].length,addContour(r,e[o]);var s=Earcut.triangulate(r,n);for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function removeDupEndPts(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function addContour(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function ExtrudeGeometry(t,e){Geometry$2.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ExtrudeBufferGeometry(t,e)),this.mergeVertices()}function ExtrudeBufferGeometry(t,e){BufferGeometry$1.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,n=[],i=[],a=0,o=t.length;a<o;a++)s(t[a]);function s(t){var a=[],o=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,u=void 0!==e.depth?e.depth:100,l=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:c-2,f=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3,p=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:WorldUVGenerator;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=e.amount);var v,g,y,_,b,x,w,M,A=!1;p&&(v=p.getSpacedPoints(s),A=!0,l=!1,g=p.computeFrenetFrames(s,!1),y=new Vector3$1,_=new Vector3$1,b=new Vector3$1),l||(d=0,c=0,h=0,f=0);var E=t.extractPoints(o),S=E.shape,T=E.holes;if(!ShapeUtils.isClockWise(S))for(S=S.reverse(),w=0,M=T.length;w<M;w++)ShapeUtils.isClockWise(x=T[w])&&(T[w]=x.reverse());var C=ShapeUtils.triangulateShape(S,T),O=S;for(w=0,M=T.length;w<M;w++)S=S.concat(x=T[w]);function P(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var L,I,k,R,D,B,F=S.length,j=C.length;function N(t,e,r){var n,i,a,o=t.x-e.x,s=t.y-e.y,u=r.x-t.x,l=r.y-t.y,c=o*o+s*s;if(Math.abs(o*l-s*u)>Number.EPSILON){var h=Math.sqrt(c),f=Math.sqrt(u*u+l*l),d=e.x-s/h,p=e.y+o/h,m=((r.x-l/f-d)*l-(r.y+u/f-p)*u)/(o*l-s*u),v=(n=d+o*m-t.x)*n+(i=p+s*m-t.y)*i;if(v<=2)return new Vector2$3(n,i);a=Math.sqrt(v/2)}else{var g=!1;o>Number.EPSILON?u>Number.EPSILON&&(g=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(l)&&(g=!0),g?(n=-s,i=o,a=Math.sqrt(c)):(n=o,i=s,a=Math.sqrt(c/2))}return new Vector2$3(n/a,i/a)}for(var U=[],z=0,G=O.length,V=G-1,H=z+1;z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),U[z]=N(O[z],O[V],O[H]);var W,$,q=[],X=U.concat();for(w=0,M=T.length;w<M;w++){for(W=[],V=(G=(x=T[w]).length)-1,H=1+(z=0);z<G;z++,V++,H++)V===G&&(V=0),H===G&&(H=0),W[z]=N(x[z],x[V],x[H]);q.push(W),X=X.concat(W)}for(L=0;L<d;L++){for(k=L/d,R=c*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+f,z=0,G=O.length;z<G;z++)Z((D=P(O[z],U[z],I)).x,D.y,-R);for(w=0,M=T.length;w<M;w++)for(W=q[w],z=0,G=(x=T[w]).length;z<G;z++)Z((D=P(x[z],W[z],I)).x,D.y,-R)}for(I=h+f,z=0;z<F;z++)D=l?P(S[z],X[z],I):S[z],A?(_.copy(g.normals[0]).multiplyScalar(D.x),y.copy(g.binormals[0]).multiplyScalar(D.y),b.copy(v[0]).add(_).add(y),Z(b.x,b.y,b.z)):Z(D.x,D.y,0);for($=1;$<=s;$++)for(z=0;z<F;z++)D=l?P(S[z],X[z],I):S[z],A?(_.copy(g.normals[$]).multiplyScalar(D.x),y.copy(g.binormals[$]).multiplyScalar(D.y),b.copy(v[$]).add(_).add(y),Z(b.x,b.y,b.z)):Z(D.x,D.y,u/s*$);for(L=d-1;L>=0;L--){for(k=L/d,R=c*Math.cos(k*Math.PI/2),I=h*Math.sin(k*Math.PI/2)+f,z=0,G=O.length;z<G;z++)Z((D=P(O[z],U[z],I)).x,D.y,u+R);for(w=0,M=T.length;w<M;w++)for(W=q[w],z=0,G=(x=T[w]).length;z<G;z++)D=P(x[z],W[z],I),A?Z(D.x,D.y+v[s-1].y,v[s-1].x+R):Z(D.x,D.y,u+R)}function K(t,e){var r,n;for(z=t.length;--z>=0;){r=z,(n=z-1)<0&&(n=t.length-1);var i=0,a=s+2*d;for(i=0;i<a;i++){var o=F*i,u=F*(i+1);J(e+r+o,e+n+o,e+n+u,e+r+u)}}}function Z(t,e,r){a.push(t),a.push(e),a.push(r)}function Y(t,e,i){Q(t),Q(e),Q(i);var a=n.length/3,o=m.generateTopUV(r,n,a-3,a-2,a-1);tt(o[0]),tt(o[1]),tt(o[2])}function J(t,e,i,a){Q(t),Q(e),Q(a),Q(e),Q(i),Q(a);var o=n.length/3,s=m.generateSideWallUV(r,n,o-6,o-3,o-2,o-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function Q(t){n.push(a[3*t+0]),n.push(a[3*t+1]),n.push(a[3*t+2])}function tt(t){i.push(t.x),i.push(t.y)}!function(){var t=n.length/3;if(l){var e=0,i=F*e;for(z=0;z<j;z++)Y((B=C[z])[2]+i,B[1]+i,B[0]+i);for(i=F*(e=s+2*d),z=0;z<j;z++)Y((B=C[z])[0]+i,B[1]+i,B[2]+i)}else{for(z=0;z<j;z++)Y((B=C[z])[2],B[1],B[0]);for(z=0;z<j;z++)Y((B=C[z])[0]+F*s,B[1]+F*s,B[2]+F*s)}r.addGroup(t,n.length/3-t,0)}(),function(){var t=n.length/3,e=0;for(K(O,e),e+=O.length,w=0,M=T.length;w<M;w++)K(x=T[w],e),e+=x.length;r.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(i,2)),this.computeVertexNormals()}ExtrudeGeometry.prototype=Object.create(Geometry$2.prototype),ExtrudeGeometry.prototype.constructor=ExtrudeGeometry,ExtrudeGeometry.prototype.toJSON=function(){var t=Geometry$2.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,t)},ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry,ExtrudeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry$1.prototype.toJSON.call(this);return toJSON(this.parameters.shapes,this.parameters.options,t)};var WorldUVGenerator={generateTopUV:function(t,e,r,n,i){var a=e[3*n],o=e[3*n+1],s=e[3*i],u=e[3*i+1];return[new Vector2$3(e[3*r],e[3*r+1]),new Vector2$3(a,o),new Vector2$3(s,u)]},generateSideWallUV:function(t,e,r,n,i,a){var o=e[3*r],s=e[3*r+1],u=e[3*r+2],l=e[3*n],c=e[3*n+1],h=e[3*n+2],f=e[3*i],d=e[3*i+1],p=e[3*i+2],m=e[3*a],v=e[3*a+1],g=e[3*a+2];return Math.abs(s-c)<.01?[new Vector2$3(o,1-u),new Vector2$3(l,1-h),new Vector2$3(f,1-p),new Vector2$3(m,1-g)]:[new Vector2$3(s,1-u),new Vector2$3(c,1-h),new Vector2$3(d,1-p),new Vector2$3(v,1-g)]}};function toJSON(t,e,r){if(r.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++)r.shapes.push(t[n].uuid);else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function TextGeometry(t,e){Geometry$2.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new TextBufferGeometry(t,e)),this.mergeVertices()}function TextBufferGeometry(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Geometry$2;var n=r.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),ExtrudeBufferGeometry.call(this,n,e),this.type="TextBufferGeometry"}function SphereGeometry(t,e,r,n,i,a,o){Geometry$2.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new SphereBufferGeometry(t,e,r,n,i,a,o)),this.mergeVertices()}function SphereBufferGeometry(t,e,r,n,i,a,o){BufferGeometry$1.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:a,thetaLength:o},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,u,l=Math.min(a+o,Math.PI),c=0,h=[],f=new Vector3$1,d=new Vector3$1,p=[],m=[],v=[],g=[];for(u=0;u<=r;u++){var y=[],_=u/r,b=0;for(0==u&&0==a?b=.5/e:u==r&&l==Math.PI&&(b=-.5/e),s=0;s<=e;s++){var x=s/e;f.x=-t*Math.cos(n+x*i)*Math.sin(a+_*o),f.y=t*Math.cos(a+_*o),f.z=t*Math.sin(n+x*i)*Math.sin(a+_*o),m.push(f.x,f.y,f.z),d.copy(f).normalize(),v.push(d.x,d.y,d.z),g.push(x+b,1-_),y.push(c++)}h.push(y)}for(u=0;u<r;u++)for(s=0;s<e;s++){var w=h[u][s],M=h[u+1][s],A=h[u+1][s+1];(0!==u||a>0)&&p.push(h[u][s+1],w,A),(u!==r-1||l<Math.PI)&&p.push(w,M,A)}this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(m,3)),this.setAttribute("normal",new Float32BufferAttribute(v,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2))}function RingGeometry(t,e,r,n,i,a){Geometry$2.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new RingBufferGeometry(t,e,r,n,i,a)),this.mergeVertices()}function RingBufferGeometry(t,e,r,n,i,a){BufferGeometry$1.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:a},t=t||.5,e=e||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var o,s,u,l=[],c=[],h=[],f=[],d=t,p=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Vector3$1,v=new Vector2$3;for(s=0;s<=n;s++){for(u=0;u<=r;u++)o=i+u/r*a,m.x=d*Math.cos(o),m.y=d*Math.sin(o),c.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/e+1)/2,v.y=(m.y/e+1)/2,f.push(v.x,v.y);d+=p}for(s=0;s<n;s++){var g=s*(r+1);for(u=0;u<r;u++){var y=(o=u+g)+r+1,_=o+r+2,b=o+1;l.push(o,y,b),l.push(y,_,b)}}this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}function LatheGeometry(t,e,r,n){Geometry$2.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new LatheBufferGeometry(t,e,r,n)),this.mergeVertices()}function LatheBufferGeometry(t,e,r,n){BufferGeometry$1.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=_Math.clamp(n,0,2*Math.PI);var i,a,o,s=[],u=[],l=[],c=1/e,h=new Vector3$1,f=new Vector2$3;for(a=0;a<=e;a++){var d=r+a*c*n,p=Math.sin(d),m=Math.cos(d);for(o=0;o<=t.length-1;o++)h.x=t[o].x*p,h.y=t[o].y,h.z=t[o].x*m,u.push(h.x,h.y,h.z),f.x=a/e,f.y=o/(t.length-1),l.push(f.x,f.y)}for(a=0;a<e;a++)for(o=0;o<t.length-1;o++){var v=(i=o+a*t.length)+t.length,g=i+t.length+1,y=i+1;s.push(i,v,y),s.push(v,g,y)}if(this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2)),this.computeVertexNormals(),n===2*Math.PI){var _=this.attributes.normal.array,b=new Vector3$1,x=new Vector3$1,w=new Vector3$1;for(i=e*t.length*3,a=0,o=0;a<t.length;a++,o+=3)b.x=_[o+0],b.y=_[o+1],b.z=_[o+2],x.x=_[i+o+0],x.y=_[i+o+1],x.z=_[i+o+2],w.addVectors(b,x).normalize(),_[o+0]=_[i+o+0]=w.x,_[o+1]=_[i+o+1]=w.y,_[o+2]=_[i+o+2]=w.z}}function ShapeGeometry(t,e){Geometry$2.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ShapeBufferGeometry(t,e)),this.mergeVertices()}function ShapeBufferGeometry(t,e){BufferGeometry$1.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(t))l(t);else for(var u=0;u<t.length;u++)l(t[u]),this.addGroup(o,s,u),o+=s,s=0;function l(t){var o,u,l,c=n.length/3,h=t.extractPoints(e),f=h.shape,d=h.holes;for(!1===ShapeUtils.isClockWise(f)&&(f=f.reverse()),o=0,u=d.length;o<u;o++)!0===ShapeUtils.isClockWise(l=d[o])&&(d[o]=l.reverse());var p=ShapeUtils.triangulateShape(f,d);for(o=0,u=d.length;o<u;o++)f=f.concat(l=d[o]);for(o=0,u=f.length;o<u;o++){var m=f[o];n.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,u=p.length;o<u;o++){var v=p[o];r.push(v[0]+c,v[1]+c,v[2]+c),s+=3}}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(i,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}function toJSON$1(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++)e.shapes.push(t[r].uuid);else e.shapes.push(t.uuid);return e}function EdgesGeometry(t,e){BufferGeometry$1.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,a,o=[],s=Math.cos(_Math.DEG2RAD*e),u=[0,0],l={},c=["a","b","c"];t.isBufferGeometry?(a=new Geometry$2).fromBufferGeometry(t):a=t.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,f=a.faces,d=0,p=f.length;d<p;d++)for(var m=f[d],v=0;v<3;v++)r=m[c[v]],n=m[c[(v+1)%3]],u[0]=Math.min(r,n),u[1]=Math.max(r,n),void 0===l[i=u[0]+","+u[1]]?l[i]={index1:u[0],index2:u[1],face1:d,face2:void 0}:l[i].face2=d;for(i in l){var g=l[i];if(void 0===g.face2||f[g.face1].normal.dot(f[g.face2].normal)<=s){var y=h[g.index1];o.push(y.x,y.y,y.z),o.push((y=h[g.index2]).x,y.y,y.z)}}this.setAttribute("position",new Float32BufferAttribute(o,3))}function CylinderGeometry$1(t,e,r,n,i,a,o,s){Geometry$2.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new CylinderBufferGeometry(t,e,r,n,i,a,o,s)),this.mergeVertices()}function CylinderBufferGeometry(t,e,r,n,i,a,o,s){BufferGeometry$1.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var u=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var l=[],c=[],h=[],f=[],d=0,p=[],m=r/2,v=0;function g(r){var i,a,p,g=new Vector2$3,y=new Vector3$1,_=0,b=!0===r?t:e,x=!0===r?1:-1;for(a=d,i=1;i<=n;i++)c.push(0,m*x,0),h.push(0,x,0),f.push(.5,.5),d++;for(p=d,i=0;i<=n;i++){var w=i/n*s+o,M=Math.cos(w),A=Math.sin(w);y.x=b*A,y.y=m*x,y.z=b*M,c.push(y.x,y.y,y.z),h.push(0,x,0),g.x=.5*M+.5,g.y=.5*A*x+.5,f.push(g.x,g.y),d++}for(i=0;i<n;i++){var E=a+i,S=p+i;!0===r?l.push(S,S+1,E):l.push(S+1,S,E),_+=3}u.addGroup(v,_,!0===r?1:2),v+=_}!function(){var a,g,y=new Vector3$1,_=new Vector3$1,b=0,x=(e-t)/r;for(g=0;g<=i;g++){var w=[],M=g/i,A=M*(e-t)+t;for(a=0;a<=n;a++){var E=a/n,S=E*s+o,T=Math.sin(S),C=Math.cos(S);_.x=A*T,_.y=-M*r+m,_.z=A*C,c.push(_.x,_.y,_.z),y.set(T,x,C).normalize(),h.push(y.x,y.y,y.z),f.push(E,1-M),w.push(d++)}p.push(w)}for(a=0;a<n;a++)for(g=0;g<i;g++){var O=p[g+1][a],P=p[g+1][a+1],L=p[g][a+1];l.push(p[g][a],O,L),l.push(O,P,L),b+=6}u.addGroup(v,b,0),v+=b}(),!1===a&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(c,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}function ConeGeometry(t,e,r,n,i,a,o){CylinderGeometry$1.call(this,0,t,e,r,n,i,a,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function ConeBufferGeometry(t,e,r,n,i,a,o){CylinderBufferGeometry.call(this,0,t,e,r,n,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:a,thetaLength:o}}function CircleGeometry(t,e,r,n){Geometry$2.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new CircleBufferGeometry(t,e,r,n)),this.mergeVertices()}function CircleBufferGeometry(t,e,r,n){BufferGeometry$1.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,a,o=[],s=[],u=[],l=[],c=new Vector3$1,h=new Vector2$3;for(s.push(0,0,0),u.push(0,0,1),l.push(.5,.5),a=0,i=3;a<=e;a++,i+=3){var f=r+a/e*n;c.x=t*Math.cos(f),c.y=t*Math.sin(f),s.push(c.x,c.y,c.z),u.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,l.push(h.x,h.y)}for(i=1;i<=e;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}TextGeometry.prototype=Object.create(Geometry$2.prototype),TextGeometry.prototype.constructor=TextGeometry,TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype),TextBufferGeometry.prototype.constructor=TextBufferGeometry,SphereGeometry.prototype=Object.create(Geometry$2.prototype),SphereGeometry.prototype.constructor=SphereGeometry,SphereBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),SphereBufferGeometry.prototype.constructor=SphereBufferGeometry,RingGeometry.prototype=Object.create(Geometry$2.prototype),RingGeometry.prototype.constructor=RingGeometry,RingBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),RingBufferGeometry.prototype.constructor=RingBufferGeometry,LatheGeometry.prototype=Object.create(Geometry$2.prototype),LatheGeometry.prototype.constructor=LatheGeometry,LatheBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),LatheBufferGeometry.prototype.constructor=LatheBufferGeometry,ShapeGeometry.prototype=Object.create(Geometry$2.prototype),ShapeGeometry.prototype.constructor=ShapeGeometry,ShapeGeometry.prototype.toJSON=function(){var t=Geometry$2.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,t)},ShapeBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry,ShapeBufferGeometry.prototype.toJSON=function(){var t=BufferGeometry$1.prototype.toJSON.call(this);return toJSON$1(this.parameters.shapes,t)},EdgesGeometry.prototype=Object.create(BufferGeometry$1.prototype),EdgesGeometry.prototype.constructor=EdgesGeometry,CylinderGeometry$1.prototype=Object.create(Geometry$2.prototype),CylinderGeometry$1.prototype.constructor=CylinderGeometry$1,CylinderBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry,ConeGeometry.prototype=Object.create(CylinderGeometry$1.prototype),ConeGeometry.prototype.constructor=ConeGeometry,ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype),ConeBufferGeometry.prototype.constructor=ConeBufferGeometry,CircleGeometry.prototype=Object.create(Geometry$2.prototype),CircleGeometry.prototype.constructor=CircleGeometry,CircleBufferGeometry.prototype=Object.create(BufferGeometry$1.prototype),CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Geometries=Object.freeze({__proto__:null,WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry$1,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(t){Material.call(this),this.type="ShadowMaterial",this.color=new Color$c(0),this.transparent=!0,this.setValues(t)}function RawShaderMaterial(t){ShaderMaterial$c.call(this,t),this.type="RawShaderMaterial"}function MeshStandardMaterial(t){Material.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color$c(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$c(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$3(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshPhysicalMaterial(t){MeshStandardMaterial.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Vector2$3(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}function MeshPhongMaterial(t){Material.call(this),this.type="MeshPhongMaterial",this.color=new Color$c(16777215),this.specular=new Color$c(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$c(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$3(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshToonMaterial(t){Material.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color$c(16777215),this.specular=new Color$c(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$c(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$3(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshNormalMaterial(t){Material.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$3(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshLambertMaterial(t){Material.call(this),this.type="MeshLambertMaterial",this.color=new Color$c(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color$c(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function MeshMatcapMaterial(t){Material.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color$c(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2$3(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function LineDashedMaterial(t){LineBasicMaterial.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}ShadowMaterial.prototype=Object.create(Material.prototype),ShadowMaterial.prototype.constructor=ShadowMaterial,ShadowMaterial.prototype.isShadowMaterial=!0,ShadowMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this},RawShaderMaterial.prototype=Object.create(ShaderMaterial$c.prototype),RawShaderMaterial.prototype.constructor=RawShaderMaterial,RawShaderMaterial.prototype.isRawShaderMaterial=!0,MeshStandardMaterial.prototype=Object.create(Material.prototype),MeshStandardMaterial.prototype.constructor=MeshStandardMaterial,MeshStandardMaterial.prototype.isMeshStandardMaterial=!0,MeshStandardMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype),MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial,MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0,MeshPhysicalMaterial.prototype.copy=function(t){return MeshStandardMaterial.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,this.sheen=t.sheen?(this.sheen||new Color$c).copy(t.sheen):null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this},MeshPhongMaterial.prototype=Object.create(Material.prototype),MeshPhongMaterial.prototype.constructor=MeshPhongMaterial,MeshPhongMaterial.prototype.isMeshPhongMaterial=!0,MeshPhongMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshToonMaterial.prototype=Object.create(Material.prototype),MeshToonMaterial.prototype.constructor=MeshToonMaterial,MeshToonMaterial.prototype.isMeshToonMaterial=!0,MeshToonMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshNormalMaterial.prototype=Object.create(Material.prototype),MeshNormalMaterial.prototype.constructor=MeshNormalMaterial,MeshNormalMaterial.prototype.isMeshNormalMaterial=!0,MeshNormalMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshLambertMaterial.prototype=Object.create(Material.prototype),MeshLambertMaterial.prototype.constructor=MeshLambertMaterial,MeshLambertMaterial.prototype.isMeshLambertMaterial=!0,MeshLambertMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},MeshMatcapMaterial.prototype=Object.create(Material.prototype),MeshMatcapMaterial.prototype.constructor=MeshMatcapMaterial,MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0,MeshMatcapMaterial.prototype.copy=function(t){return Material.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype),LineDashedMaterial.prototype.constructor=LineDashedMaterial,LineDashedMaterial.prototype.isLineDashedMaterial=!0,LineDashedMaterial.prototype.copy=function(t){return LineBasicMaterial.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Materials=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial$c,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),AnimationUtils={arraySlice:function(t,e,r){return AnimationUtils.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),a=0,o=0;o!==n;++a)for(var s=r[a]*e,u=0;u!==e;++u)i[o++]=t[s+u];return i},flattenJSON:function(t,e,r,n){for(var i=1,a=t[0];void 0!==a&&void 0===a[n];)a=t[i++];if(void 0!==a){var o=a[n];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[n])&&(e.push(a.time),r.push.apply(r,o)),a=t[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[n])&&(e.push(a.time),o.toArray(r,r.length)),a=t[i++]}while(void 0!==a);else do{void 0!==(o=a[n])&&(e.push(a.time),r.push(o)),a=t[i++]}while(void 0!==a)}},subclip:function(t,e,r,n,i){i=i||30;var a=t.clone();a.name=e;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],l=u.getValueSize(),c=[],h=[],f=0;f<u.times.length;++f){var d=u.times[f]*i;if(!(d<r||d>=n)){c.push(u.times[f]);for(var p=0;p<l;++p)h.push(u.values[f*l+p])}}0!==c.length&&(u.times=AnimationUtils.convertArray(c,u.times.constructor),u.values=AnimationUtils.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;var m=1/0;for(s=0;s<a.tracks.length;++s)m>a.tracks[s].times[0]&&(m=a.tracks[s].times[0]);for(s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*m);return a.resetDuration(),a}};function Interpolant(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function CubicInterpolant(t,e,r,n){Interpolant.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function LinearInterpolant(t,e,r,n){Interpolant.call(this,t,e,r,n)}function DiscreteInterpolant(t,e,r,n){Interpolant.call(this,t,e,r,n)}function KeyframeTrack(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=AnimationUtils.convertArray(e,this.TimeBufferType),this.values=AnimationUtils.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function BooleanKeyframeTrack(t,e,r){KeyframeTrack.call(this,t,e,r)}function ColorKeyframeTrack(t,e,r,n){KeyframeTrack.call(this,t,e,r,n)}function NumberKeyframeTrack(t,e,r,n){KeyframeTrack.call(this,t,e,r,n)}function QuaternionLinearInterpolant(t,e,r,n){Interpolant.call(this,t,e,r,n)}function QuaternionKeyframeTrack(t,e,r,n){KeyframeTrack.call(this,t,e,r,n)}function StringKeyframeTrack(t,e,r,n){KeyframeTrack.call(this,t,e,r,n)}function VectorKeyframeTrack(t,e,r,n){KeyframeTrack.call(this,t,e,r,n)}function AnimationClip(t,e,r){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.uuid=_Math.generateUUID(),this.duration<0&&this.resetDuration()}function getTrackTypeForValueTypeName(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function parseKeyframeTrack(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var r=[],n=[];AnimationUtils.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Interpolant.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var a;r:{n:if(!(t<n)){for(var o=r+2;;){if(void 0===n){if(t<i)break n;return this._cachedIndex=r=e.length,this.afterEnd_(r-1,t,i)}if(r===o)break;if(i=n,t<(n=e[++r]))break e}a=e.length;break r}if(t>=i)break t;var s=e[1];for(t<s&&(r=2,i=s),o=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===o)break;if(n=i,t>=(i=e[--r-1]))break e}a=r,r=0}for(;r<a;){var u=r+a>>>1;t<e[u]?a=u:r=u+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return this._cachedIndex=r=e.length,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,a=0;a!==n;++a)e[a]=r[i+a];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_}),CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,a=t+1,o=n[i],s=n[a];if(void 0===o)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:i=t,o=2*e-r;break;case WrapAroundEnding:o=e+n[i=n.length-2]-n[i+1];break;default:i=t,o=r}if(void 0===s)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:a=t,s=2*r-e;break;case WrapAroundEnding:a=1,s=r+n[1]-n[0];break;default:a=t-1,s=e}var u=.5*(r-e),l=this.valueSize;this._weightPrev=u/(e-o),this._weightNext=u/(s-r),this._offsetPrev=i*l,this._offsetNext=a*l},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(r-e)/(n-e),p=d*d,m=p*d,v=-h*m+2*h*p-h*d,g=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*m+(1.5+f)*p+.5*d,_=f*m-f*p,b=0;b!==o;++b)i[b]=v*a[l+b]+g*a[u+b]+y*a[s+b]+_*a[c+b];return i}}),LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,u=s-o,l=(r-e)/(n-e),c=1-l,h=0;h!==o;++h)i[h]=a[u+h]*c+a[s+h]*l;return i}}),DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(KeyframeTrack,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:AnimationUtils.convertArray(t.times,Array),values:AnimationUtils.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function(t){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new LinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new CubicInterpolant(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case InterpolateDiscrete:e=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:e=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,a=n-1;i!==n&&r[i]<t;)++i;for(;-1!==a&&r[a]>e;)--a;if(++a,0!==i||a!==n){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=AnimationUtils.arraySlice(r,i,a),this.values=AnimationUtils.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var a=null,o=0;o!==i;o++){var s=r[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),t=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),t=!1;break}a=s}if(void 0!==n&&AnimationUtils.isTypedArray(n)){o=0;for(var u=n.length;o!==u;++o){var l=n[o];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}}return t},optimize:function(){for(var t=this.times,e=this.values,r=this.getValueSize(),n=this.getInterpolation()===InterpolateSmooth,i=1,a=t.length-1,o=1;o<a;++o){var s=!1,u=t[o];if(u!==t[o+1]&&(1!==o||u!==u[0]))if(n)s=!0;else for(var l=o*r,c=l-r,h=l+r,f=0;f!==r;++f){var d=e[l+f];if(d!==e[c+f]||d!==e[h+f]){s=!0;break}}if(s){if(o!==i){t[i]=t[o];var p=o*r,m=i*r;for(f=0;f!==r;++f)e[m+f]=e[p+f]}++i}}if(a>0){for(t[i]=t[a],p=a*r,m=i*r,f=0;f!==r;++f)e[m+f]=e[p+f];++i}return i!==t.length&&(this.times=AnimationUtils.arraySlice(t,0,i),this.values=AnimationUtils.arraySlice(e,0,i*r)),this},clone:function(){var t=AnimationUtils.arraySlice(this.times,0),e=AnimationUtils.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"}),NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"}),QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=t*o,u=(r-e)/(n-e),l=s+o;s!==l;s+=4)Quaternion.slerpFlat(i,0,a,s-o,a,s,u);return i}}),QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function(t){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"}),Object.assign(AnimationClip,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,a=r.length;i!==a;++i)e.push(parseKeyframeTrack(r[i]).scale(n));return new AnimationClip(t.name,t.duration,e)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},i=0,a=r.length;i!==a;++i)e.push(KeyframeTrack.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,a=[],o=0;o<i;o++){var s=[],u=[];s.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);var l=AnimationUtils.getKeyframeOrder(s);s=AnimationUtils.sortedArray(s,1,l),u=AnimationUtils.sortedArray(u,1,l),n||0!==s[0]||(s.push(i),u.push(u[0])),a.push(new NumberKeyframeTrack(".morphTargetInfluences["+e[o].name+"]",s,u).scale(1/r))}return new AnimationClip(t,-1,a)},findByName:function(t,e){var r=t;Array.isArray(t)||(r=t.geometry&&t.geometry.animations||t.animations);for(var n=0;n<r.length;n++)if(r[n].name===e)return r[n];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],u=s.name.match(i);if(u&&u.length>1){var l=n[h=u[1]];l||(n[h]=l=[]),l.push(s)}}var c=[];for(var h in n)c.push(AnimationClip.CreateFromMorphTargetSequence(h,n[h],e,r));return c},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var a=[],o=[];AnimationUtils.flattenJSON(r,a,o,n),0!==a.length&&i.push(new t(e,a,o))}},n=[],i=t.name||"default",a=t.length||-1,o=t.fps||30,s=t.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var f=0;f<l[h].morphTargets.length;f++)c[l[h].morphTargets[f]]=-1;for(var d in c){var p=[],m=[];for(f=0;f!==l[h].morphTargets.length;++f){var v=l[h];p.push(v.time),m.push(v.morphTarget===d?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+d+"]",p,m))}a=c.length*(o||1)}else{var g=".bones["+e[u].name+"]";r(VectorKeyframeTrack,g+".position",l,"pos",n),r(QuaternionKeyframeTrack,g+".quaternion",l,"rot",n),r(VectorKeyframeTrack,g+".scale",l,"scl",n)}}return 0===n.length?null:new AnimationClip(i,a,n)}}),Object.assign(AnimationClip.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new AnimationClip(this.name,this.duration,t)}});var Cache={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function LoadingManager(t,e,r){var n=this,i=!1,a=0,o=0,s=void 0,u=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){o++,!1===i&&void 0!==n.onStart&&n.onStart(t,a,o),i=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return u.push(t,e),this},this.removeHandler=function(t){var e=u.indexOf(t);return-1!==e&&u.splice(e,2),this},this.getHandler=function(t){for(var e=0,r=u.length;e<r;e+=2){var n=u[e],i=u[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}var DefaultLoadingManager=new LoadingManager;function Loader(t){this.manager=void 0!==t?t:DefaultLoadingManager,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(Loader.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var loading={};function FileLoader(t){Loader.call(this,t)}function AnimationLoader(t){Loader.call(this,t)}function CompressedTextureLoader(t){Loader.call(this,t)}function DataTextureLoader(t){Loader.call(this,t)}function ImageLoader(t){Loader.call(this,t)}function CubeTextureLoader(t){Loader.call(this,t)}function TextureLoader$3(t){Loader.call(this,t)}function Curve(){this.type="Curve",this.arcLengthDivisions=200}function EllipseCurve(t,e,r,n,i,a,o,s){Curve.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function ArcCurve(t,e,r,n,i,a){EllipseCurve.call(this,t,e,r,r,n,i,a),this.type="ArcCurve"}function CubicPoly(){var t=0,e=0,r=0,n=0;function i(i,a,o,s){t=i,e=o,r=-3*i+3*a-2*o-s,n=2*i-2*a+o+s}return{initCatmullRom:function(t,e,r,n,a){i(e,r,a*(r-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,a,o,s){var u=(e-t)/a-(r-t)/(a+o)+(r-e)/o,l=(r-e)/o-(n-e)/(o+s)+(n-r)/s;i(e,r,u*=o,l*=o)},calc:function(i){var a=i*i;return t+e*i+r*a+n*(a*i)}}}FileLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FileLoader,load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=Cache.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout((function(){e&&e(a),i.manager.itemEnd(t)}),0),a;if(void 0===loading[t]){var o=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],u=!!o[2],l=o[3];l=decodeURIComponent(l),u&&(l=atob(l));try{var c,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var f=new Uint8Array(l.length),d=0;d<l.length;d++)f[d]=l.charCodeAt(d);c="blob"===h?new Blob([f.buffer],{type:s}):f.buffer;break;case"document":var p=new DOMParser;c=p.parseFromString(l,s);break;case"json":c=JSON.parse(l);break;default:c=l}setTimeout((function(){e&&e(c),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{loading[t]=[],loading[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var v in m.open("GET",t,!0),m.addEventListener("load",(function(e){var r=this.response,n=loading[t];if(delete loading[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Cache.add(t,r);for(var a=0,o=n.length;a<o;a++)(s=n[a]).onLoad&&s.onLoad(r);i.manager.itemEnd(t)}else{for(a=0,o=n.length;a<o;a++){var s;(s=n[a]).onError&&s.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),m.addEventListener("progress",(function(e){for(var r=loading[t],n=0,i=r.length;n<i;n++){var a=r[n];a.onProgress&&a.onProgress(e)}}),!1),m.addEventListener("error",(function(e){var r=loading[t];delete loading[t];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),m.addEventListener("abort",(function(e){var r=loading[t];delete loading[t];for(var n=0,a=r.length;n<a;n++){var o=r[n];o.onError&&o.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(t),m}loading[t].push({onLoad:e,onProgress:r,onError:n})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),AnimationLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AnimationLoader,load:function(t,e,r,n){var i=this,a=new FileLoader(i.manager);a.setPath(i.path),a.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var n=AnimationClip.parse(t[r]);e.push(n)}return e}}),CompressedTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CompressedTextureLoader,load:function(t,e,r,n){var i=this,a=[],o=new CompressedTexture;o.image=a;var s=new FileLoader(this.manager);function u(u){s.load(t[u],(function(t){var r=i.parse(t,!0);a[u]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(l+=1)&&(1===r.mipmapCount&&(o.minFilter=LinearFilter),o.format=r.format,o.needsUpdate=!0,e&&e(o))}),r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var l=0,c=0,h=t.length;c<h;++c)u(c);else s.load(t,(function(t){var r=i.parse(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){a[s]={mipmaps:[]};for(var u=0;u<r.mipmapCount;u++)a[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+u]),a[s].format=r.format,a[s].width=r.width,a[s].height=r.height}else o.image.width=r.width,o.image.height=r.height,o.mipmaps=r.mipmaps;1===r.mipmapCount&&(o.minFilter=LinearFilter),o.format=r.format,o.needsUpdate=!0,e&&e(o)}),r,n);return o}}),DataTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:DataTextureLoader,load:function(t,e,r,n){var i=this,a=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(t,(function(t){var r=i.parse(t);r&&(void 0!==r.image?a.image=r.image:void 0!==r.data&&(a.image.width=r.width,a.image.height=r.height,a.image.data=r.data),a.wrapS=void 0!==r.wrapS?r.wrapS:ClampToEdgeWrapping,a.wrapT=void 0!==r.wrapT?r.wrapT:ClampToEdgeWrapping,a.magFilter=void 0!==r.magFilter?r.magFilter:LinearFilter,a.minFilter=void 0!==r.minFilter?r.minFilter:LinearFilter,a.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.mipmaps&&(a.mipmaps=r.mipmaps,a.minFilter=LinearMipmapLinearFilter),1===r.mipmapCount&&(a.minFilter=LinearFilter),a.needsUpdate=!0,e&&e(a,r))}),r,n),a}}),ImageLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageLoader,load:function(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=Cache.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout((function(){e&&e(a),i.manager.itemEnd(t)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),Cache.add(t,this),e&&e(this),i.manager.itemEnd(t)}function u(e){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(t),o.src=t,o}}),CubeTextureLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:CubeTextureLoader,load:function(t,e,r,n){var i=new CubeTexture,a=new ImageLoader(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(r){a.load(t[r],(function(t){i.images[r]=t,6==++o&&(i.needsUpdate=!0,e&&e(i))}),void 0,n)}for(var u=0;u<t.length;++u)s(u);return i}}),TextureLoader$3.prototype=Object.assign(Object.create(Loader.prototype),{constructor:TextureLoader$3,load:function(t,e,r,n){var i=new Texture,a=new ImageLoader(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,(function(r){i.image=r;var n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?RGBFormat:RGBAFormat,i.needsUpdate=!0,void 0!==e&&e(i)}),r,n),i}}),Object.assign(Curve.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),a=0;for(n.push(0),r=1;r<=t;r++)a+=(e=this.getPoint(r/t)).distanceTo(i),n.push(a),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,a=n.length;r=e||t*n[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=n[i=Math.floor(s+(u-s)/2)]-r)<0)s=i+1;else{if(!(o>0)){u=i;break}u=i-1}if(n[i=u]===r)return i/(a-1);var l=n[i];return(i+(r-l)/(n[i+1]-l))/(a-1)},getTangent:function(t){var e=1e-4,r=t-e,n=t+e;r<0&&(r=0),n>1&&(n=1);var i=this.getPoint(r);return this.getPoint(n).clone().sub(i).normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,n,i=new Vector3$1,a=[],o=[],s=[],u=new Vector3$1,l=new Matrix4$2;for(r=0;r<=t;r++)a[r]=this.getTangentAt(r/t),a[r].normalize();o[0]=new Vector3$1,s[0]=new Vector3$1;var c=Number.MAX_VALUE,h=Math.abs(a[0].x),f=Math.abs(a[0].y),d=Math.abs(a[0].z);for(h<=c&&(c=h,i.set(1,0,0)),f<=c&&(c=f,i.set(0,1,0)),d<=c&&i.set(0,0,1),u.crossVectors(a[0],i).normalize(),o[0].crossVectors(a[0],u),s[0].crossVectors(a[0],o[0]),r=1;r<=t;r++)o[r]=o[r-1].clone(),s[r]=s[r-1].clone(),u.crossVectors(a[r-1],a[r]),u.length()>Number.EPSILON&&(u.normalize(),n=Math.acos(_Math.clamp(a[r-1].dot(a[r]),-1,1)),o[r].applyMatrix4(l.makeRotationAxis(u,n))),s[r].crossVectors(a[r],o[r]);if(!0===e)for(n=Math.acos(_Math.clamp(o[0].dot(o[t]),-1,1)),n/=t,a[0].dot(u.crossVectors(o[0],o[t]))>0&&(n=-n),r=1;r<=t;r++)o[r].applyMatrix4(l.makeRotationAxis(a[r],n*r)),s[r].crossVectors(a[r],o[r]);return{tangents:a,normals:o,binormals:s}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),EllipseCurve.prototype=Object.create(Curve.prototype),EllipseCurve.prototype.constructor=EllipseCurve,EllipseCurve.prototype.isEllipseCurve=!0,EllipseCurve.prototype.getPoint=function(t,e){for(var r=e||new Vector2$3,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=a?0:n),!0!==this.aClockwise||a||(i===n?i=-n:i-=n);var o=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,f=u-this.aY;s=h*l-f*c+this.aX,u=h*c+f*l+this.aY}return r.set(s,u)},EllipseCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},EllipseCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},EllipseCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},ArcCurve.prototype=Object.create(EllipseCurve.prototype),ArcCurve.prototype.constructor=ArcCurve,ArcCurve.prototype.isArcCurve=!0;var tmp=new Vector3$1,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(t,e,r,n){Curve.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function CatmullRom(t,e,r,n,i){var a=.5*(n-e),o=.5*(i-r),s=t*t;return(2*r-2*n+a+o)*(t*s)+(-3*r+3*n-2*a-o)*s+a*t+r}function QuadraticBezierP0(t,e){var r=1-t;return r*r*e}function QuadraticBezierP1(t,e){return 2*(1-t)*t*e}function QuadraticBezierP2(t,e){return t*t*e}function QuadraticBezier(t,e,r,n){return QuadraticBezierP0(t,e)+QuadraticBezierP1(t,r)+QuadraticBezierP2(t,n)}function CubicBezierP0(t,e){var r=1-t;return r*r*r*e}function CubicBezierP1(t,e){var r=1-t;return 3*r*r*t*e}function CubicBezierP2(t,e){return 3*(1-t)*t*t*e}function CubicBezierP3(t,e){return t*t*t*e}function CubicBezier(t,e,r,n,i){return CubicBezierP0(t,e)+CubicBezierP1(t,r)+CubicBezierP2(t,n)+CubicBezierP3(t,i)}function CubicBezierCurve(t,e,r,n){Curve.call(this),this.type="CubicBezierCurve",this.v0=t||new Vector2$3,this.v1=e||new Vector2$3,this.v2=r||new Vector2$3,this.v3=n||new Vector2$3}function CubicBezierCurve3(t,e,r,n){Curve.call(this),this.type="CubicBezierCurve3",this.v0=t||new Vector3$1,this.v1=e||new Vector3$1,this.v2=r||new Vector3$1,this.v3=n||new Vector3$1}function LineCurve(t,e){Curve.call(this),this.type="LineCurve",this.v1=t||new Vector2$3,this.v2=e||new Vector2$3}function LineCurve3(t,e){Curve.call(this),this.type="LineCurve3",this.v1=t||new Vector3$1,this.v2=e||new Vector3$1}function QuadraticBezierCurve(t,e,r){Curve.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Vector2$3,this.v1=e||new Vector2$3,this.v2=r||new Vector2$3}function QuadraticBezierCurve3(t,e,r){Curve.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Vector3$1,this.v1=e||new Vector3$1,this.v2=r||new Vector3$1}function SplineCurve(t){Curve.call(this),this.type="SplineCurve",this.points=t||[]}CatmullRomCurve3.prototype=Object.create(Curve.prototype),CatmullRomCurve3.prototype.constructor=CatmullRomCurve3,CatmullRomCurve3.prototype.isCatmullRomCurve3=!0,CatmullRomCurve3.prototype.getPoint=function(t,e){var r,n,i,a,o=e||new Vector3$1,s=this.points,u=s.length,l=(u-(this.closed?0:1))*t,c=Math.floor(l),h=l-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/u)+1)*u:0===h&&c===u-1&&(c=u-2,h=1),this.closed||c>0?r=s[(c-1)%u]:(tmp.subVectors(s[0],s[1]).add(s[0]),r=tmp),n=s[c%u],i=s[(c+1)%u],this.closed||c+2<u?a=s[(c+2)%u]:(tmp.subVectors(s[u-1],s[u-2]).add(s[u-1]),a=tmp),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,d=Math.pow(r.distanceToSquared(n),f),p=Math.pow(n.distanceToSquared(i),f),m=Math.pow(i.distanceToSquared(a),f);p<1e-4&&(p=1),d<1e-4&&(d=p),m<1e-4&&(m=p),px.initNonuniformCatmullRom(r.x,n.x,i.x,a.x,d,p,m),py.initNonuniformCatmullRom(r.y,n.y,i.y,a.y,d,p,m),pz.initNonuniformCatmullRom(r.z,n.z,i.z,a.z,d,p,m)}else"catmullrom"===this.curveType&&(px.initCatmullRom(r.x,n.x,i.x,a.x,this.tension),py.initCatmullRom(r.y,n.y,i.y,a.y,this.tension),pz.initCatmullRom(r.z,n.z,i.z,a.z,this.tension));return o.set(px.calc(h),py.calc(h),pz.calc(h)),o},CatmullRomCurve3.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CatmullRomCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},CatmullRomCurve3.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Vector3$1).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},CubicBezierCurve.prototype=Object.create(Curve.prototype),CubicBezierCurve.prototype.constructor=CubicBezierCurve,CubicBezierCurve.prototype.isCubicBezierCurve=!0,CubicBezierCurve.prototype.getPoint=function(t,e){var r=e||new Vector2$3,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(CubicBezier(t,n.x,i.x,a.x,o.x),CubicBezier(t,n.y,i.y,a.y,o.y)),r},CubicBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},CubicBezierCurve3.prototype=Object.create(Curve.prototype),CubicBezierCurve3.prototype.constructor=CubicBezierCurve3,CubicBezierCurve3.prototype.isCubicBezierCurve3=!0,CubicBezierCurve3.prototype.getPoint=function(t,e){var r=e||new Vector3$1,n=this.v0,i=this.v1,a=this.v2,o=this.v3;return r.set(CubicBezier(t,n.x,i.x,a.x,o.x),CubicBezier(t,n.y,i.y,a.y,o.y),CubicBezier(t,n.z,i.z,a.z,o.z)),r},CubicBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},CubicBezierCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},CubicBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},LineCurve.prototype=Object.create(Curve.prototype),LineCurve.prototype.constructor=LineCurve,LineCurve.prototype.isLineCurve=!0,LineCurve.prototype.getPoint=function(t,e){var r=e||new Vector2$3;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},LineCurve.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},LineCurve.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},LineCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},LineCurve3.prototype=Object.create(Curve.prototype),LineCurve3.prototype.constructor=LineCurve3,LineCurve3.prototype.isLineCurve3=!0,LineCurve3.prototype.getPoint=function(t,e){var r=e||new Vector3$1;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},LineCurve3.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},LineCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},LineCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},LineCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve.prototype=Object.create(Curve.prototype),QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve,QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0,QuadraticBezierCurve.prototype.getPoint=function(t,e){var r=e||new Vector2$3,n=this.v0,i=this.v1,a=this.v2;return r.set(QuadraticBezier(t,n.x,i.x,a.x),QuadraticBezier(t,n.y,i.y,a.y)),r},QuadraticBezierCurve.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},QuadraticBezierCurve3.prototype=Object.create(Curve.prototype),QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3,QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0,QuadraticBezierCurve3.prototype.getPoint=function(t,e){var r=e||new Vector3$1,n=this.v0,i=this.v1,a=this.v2;return r.set(QuadraticBezier(t,n.x,i.x,a.x),QuadraticBezier(t,n.y,i.y,a.y),QuadraticBezier(t,n.z,i.z,a.z)),r},QuadraticBezierCurve3.prototype.copy=function(t){return Curve.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},QuadraticBezierCurve3.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},QuadraticBezierCurve3.prototype.fromJSON=function(t){return Curve.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},SplineCurve.prototype=Object.create(Curve.prototype),SplineCurve.prototype.constructor=SplineCurve,SplineCurve.prototype.isSplineCurve=!0,SplineCurve.prototype.getPoint=function(t,e){var r=e||new Vector2$3,n=this.points,i=(n.length-1)*t,a=Math.floor(i),o=i-a,s=n[0===a?a:a-1],u=n[a],l=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return r.set(CatmullRom(o,s.x,u.x,l.x,c.x),CatmullRom(o,s.y,u.y,l.y,c.y)),r},SplineCurve.prototype.copy=function(t){Curve.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++)this.points.push(t.points[e].clone());return this},SplineCurve.prototype.toJSON=function(){var t=Curve.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++)t.points.push(this.points[e].toArray());return t},SplineCurve.prototype.fromJSON=function(t){Curve.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Vector2$3).fromArray(n))}return this};var Curves=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Path(t){CurvePath.call(this),this.type="Path",this.currentPoint=new Vector2$3,t&&this.setFromPoints(t)}function Shape(t){Path.call(this,t),this.uuid=_Math.generateUUID(),this.type="Shape",this.holes=[]}function Light(t,e){Object3D.call(this),this.type="Light",this.color=new Color$c(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function HemisphereLight(t,e,r){Light.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color$c(e)}function LightShadow(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Vector2$3(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4$2,this._frustum=new Frustum,this._frameExtents=new Vector2$3(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}function SpotLight(t,e,r,n,i,a){Light.call(this,t,e),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new SpotLightShadow}function PointLightShadow(){LightShadow.call(this,new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2$3(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)],this._cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)]}function PointLight(t,e,r,n){Light.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new PointLightShadow}function OrthographicCamera(t,e,r,n,i,a){Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}function DirectionalLight(t,e){Light.call(this,t,e),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}function AmbientLight(t,e){Light.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function RectAreaLight(t,e,r,n){Light.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function MaterialLoader(t){Loader.call(this,t),this.textures={}}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new LineCurve(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,a=this.curves[n],o=a.getLength();return a.getPointAt(0===o?0:1-i/o)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var a=i[n],o=a.getPoints(a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t),s=0;s<o.length;s++){var u=o[s];e&&e.equals(u)||(r.push(u),e=u)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Curve.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++)this.curves.push(t.curves[e].clone());return this.autoClose=t.autoClose,this},toJSON:function(){var t=Curve.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++)t.curves.push(this.curves[e].toJSON());return t},fromJSON:function(t){Curve.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new Curves[n.type]).fromJSON(n))}return this}}),Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new LineCurve(this.currentPoint.clone(),new Vector2$3(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,n){var i=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2$3(t,e),new Vector2$3(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(t,e,r,n,i,a){var o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2$3(t,e),new Vector2$3(r,n),new Vector2$3(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(t){var e=new SplineCurve([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,r,n,i,a){return this.absarc(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,a),this},absarc:function(t,e,r,n,i,a){return this.absellipse(t,e,r,r,n,i,a),this},ellipse:function(t,e,r,n,i,a,o,s){return this.absellipse(t+this.currentPoint.x,e+this.currentPoint.y,r,n,i,a,o,s),this},absellipse:function(t,e,r,n,i,a,o,s){var u=new EllipseCurve(t,e,r,n,i,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this},copy:function(t){return CurvePath.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=CurvePath.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return CurvePath.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Path.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++)this.holes.push(t.holes[e].clone());return this},toJSON:function(){var t=Path.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++)t.holes.push(this.holes[e].toJSON());return t},fromJSON:function(t){Path.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new Path).fromJSON(n))}return this}}),Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function(t){return Object3D.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Object3D.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(LightShadow.prototype,{_projScreenMatrix:new Matrix4$2,_lightPositionWorld:new Vector3$1,_lookTarget:new Vector3$1,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(t.matrixWorld),e.position.copy(a),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(e.projectionMatrix),r.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,r=2*_Math.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix()),LightShadow.prototype.updateMatrices.call(this,t)}}),SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),PointLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:PointLightShadow,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),r.position.copy(i),a.copy(r.position),a.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(a),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromMatrix(o)}}),PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function(t,e){return Camera.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,a=r+t,o=n+e,s=n-e;if(null!==this.view&&this.view.enabled){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;a=(i+=c*(this.view.offsetX/u))+c*(this.view.width/u),s=(o-=h*(this.view.offsetY/l))-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Object3D.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow,isDirectionalLightShadow:!0,updateMatrices:function(t){LightShadow.prototype.updateMatrices.call(this,t)}}),DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0}),RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Light.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),MaterialLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MaterialLoader,load:function(t,e,r,n){var i=this,a=new FileLoader(i.manager);a.setPath(i.path),a.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new Materials[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new Color$c).setHex(t.sheen)),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.uniforms)for(var i in t.uniforms){var a=t.uniforms[i];switch(n.uniforms[i]={},a.type){case"t":n.uniforms[i].value=r(a.value);break;case"c":n.uniforms[i].value=(new Color$c).setHex(a.value);break;case"v2":n.uniforms[i].value=(new Vector2$3).fromArray(a.value);break;case"v3":n.uniforms[i].value=(new Vector3$1).fromArray(a.value);break;case"v4":n.uniforms[i].value=(new Vector4).fromArray(a.value);break;case"m3":n.uniforms[i].value=(new Matrix3).fromArray(a.value);case"m4":n.uniforms[i].value=(new Matrix4$2).fromArray(a.value);break;default:n.uniforms[i].value=a.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var o in t.extensions)n.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.matcap&&(n.matcap=r(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap),n.transparent=!0),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new Vector2$3).fromArray(s)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2$3).fromArray(t.clearcoatNormalScale)),n},setTextures:function(t){return this.textures=t,this}});var LoaderUtils={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function InstancedBufferGeometry(){BufferGeometry$1.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function InstancedBufferAttribute(t,e,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),BufferAttribute$1.call(this,t,e,r),this.meshPerAttribute=n||1}function BufferGeometryLoader(t){Loader.call(this,t)}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry$1.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function(t){return BufferGeometry$1.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=BufferGeometry$1.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}}),InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute$1.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function(t){return BufferAttribute$1.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=BufferAttribute$1.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),BufferGeometryLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:BufferGeometryLoader,load:function(t,e,r,n){var i=this,a=new FileLoader(i.manager);a.setPath(i.path),a.load(t,(function(t){e(i.parse(JSON.parse(t)))}),r,n)},parse:function(t){var e=t.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry$1,r=t.data.index;if(void 0!==r){var n=new TYPED_ARRAYS[r.type](r.array);e.setIndex(new BufferAttribute$1(n,1))}var i=t.data.attributes;for(var a in i){n=new TYPED_ARRAYS[(f=i[a]).type](f.array);var o=new(f.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute$1)(n,f.itemSize,f.normalized);void 0!==f.name&&(o.name=f.name),e.setAttribute(a,o)}var s=t.data.morphAttributes;if(s)for(var a in s){for(var u=s[a],l=[],c=0,h=u.length;c<h;c++){var f;o=new BufferAttribute$1(n=new TYPED_ARRAYS[(f=u[c]).type](f.array),f.itemSize,f.normalized),void 0!==f.name&&(o.name=f.name),l.push(o)}e.morphAttributes[a]=l}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var d=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==d){c=0;for(var p=d.length;c!==p;++c){var m=d[c];e.addGroup(m.start,m.count,m.materialIndex)}}var v=t.data.boundingSphere;if(void 0!==v){var g=new Vector3$1;void 0!==v.center&&g.fromArray(v.center),e.boundingSphere=new Sphere(g,v.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ObjectLoader(t){Loader.call(this,t)}ObjectLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ObjectLoader,load:function(t,e,r,n){var i=this,a=""===this.path?LoaderUtils.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;var o=new FileLoader(i.manager);o.setPath(this.path),o.load(t,(function(r){var a=null;try{a=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t)}),r,n)},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),a=this.parseTextures(t.textures,i),o=this.parseMaterials(t.materials,a),s=this.parseObject(t.object,n,o);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new Shape).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new BufferGeometryLoader,i=0,a=t.length;i<a;i++){var o,s=t[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Geometries[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Geometries[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Geometries[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Geometries[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Geometries[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Geometries[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Geometries[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Geometries[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Geometries[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Geometries[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Geometries[s.type]((new Curves[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Geometries[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Geometries[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],l=0,c=s.shapes.length;l<c;l++)u.push(e[s.shapes[l]]);o=new Geometries[s.type](u,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(u=[],l=0,c=s.shapes.length;l<c;l++)u.push(e[s.shapes[l]]);var h=s.options.extrudePath;void 0!==h&&(s.options.extrudePath=(new Curves[h.type]).fromJSON(h)),o=new Geometries[s.type](u,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),r[s.uuid]=o}return r},parseMaterials:function(t,e){var r={},n={};if(void 0!==t){var i=new MaterialLoader;i.setTextures(e);for(var a=0,o=t.length;a<o;a++){var s=t[a];if("MultiMaterial"===s.type){for(var u=[],l=0;l<s.materials.length;l++){var c=s.materials[l];void 0===r[c.uuid]&&(r[c.uuid]=i.parse(c)),u.push(r[c.uuid])}n[s.uuid]=u}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=AnimationClip.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),e.push(i)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),a.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){var a=new ImageLoader(new LoadingManager(e));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=t.length;o<s;o++){var u=t[o],l=u.url;if(Array.isArray(l)){n[u.uuid]=[];for(var c=0,h=l.length;c<h;c++){var f=l[c],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:r.resourcePath+f;n[u.uuid].push(i(d))}}else d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:r.resourcePath+u.url,n[u.uuid]=i(d)}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,a=t.length;i<a;i++){var o,s=t[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(e[s.image])?new CubeTexture(e[s.image]):new Texture(e[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=r(s.mapping,TEXTURE_MAPPING)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=r(s.wrap[0],TEXTURE_WRAPPING),o.wrapT=r(s.wrap[1],TEXTURE_WRAPPING)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=r(s.minFilter,TEXTURE_FILTER)),void 0!==s.magFilter&&(o.magFilter=r(s.magFilter,TEXTURE_FILTER)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),n[s.uuid]=o}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function a(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var a=t[n];void 0===r[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),e.push(r[a])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new Scene,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Color$c(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Fog(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new FogExp2(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new PerspectiveCamera(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new AmbientLight(t.color,t.intensity);break;case"DirectionalLight":n=new DirectionalLight(t.color,t.intensity);break;case"PointLight":n=new PointLight(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new RectAreaLight(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new SpotLight(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new HemisphereLight(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(t.geometry),s=a(t.material);n=o.bones&&o.bones.length>0?new SkinnedMesh(o,s):new Mesh(o,s);break;case"InstancedMesh":o=i(t.geometry),s=a(t.material);var u=t.instanceMatrix;(n=new InstancedMesh(o,s,t.count)).instanceMatrix=new BufferAttribute$1(new Float32Array(u.array),16);break;case"LOD":n=new LOD;break;case"Line":n=new Line(i(t.geometry),a(t.material),t.mode);break;case"LineLoop":n=new LineLoop(i(t.geometry),a(t.material));break;case"LineSegments":n=new LineSegments(i(t.geometry),a(t.material));break;case"PointCloud":case"Points":n=new Points(i(t.geometry),a(t.material));break;case"Sprite":n=new Sprite(a(t.material));break;case"Group":n=new Group;break;default:n=new Object3D}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.layers&&(n.layers.mask=t.layers),void 0!==t.children)for(var l=t.children,c=0;c<l.length;c++)n.add(this.parseObject(l[c],e,r));if("LOD"===t.type){void 0!==t.autoUpdate&&(n.autoUpdate=t.autoUpdate);for(var h=t.levels,f=0;f<h.length;f++){var d=h[f],p=n.getObjectByProperty("uuid",d.object);void 0!==p&&n.addLevel(p,d.distance)}}return n}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping$2,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,LinearFilter:LinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter},_context;function ImageBitmapLoader(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Loader.call(this,t),this.options=void 0}function ShapePath(){this.type="ShapePath",this.color=new Color$c,this.subPaths=[],this.currentPath=null}function Font(t){this.type="Font",this.data=t}function createPaths(t,e,r){for(var n=Array.from?Array.from(t):String(t).split(""),i=e/r.resolution,a=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,o=[],s=0,u=0,l=0;l<n.length;l++){var c=n[l];if("\n"===c)s=0,u-=a;else{var h=createPath(c,i,s,u,r);s+=h.offsetX,o.push(h.path)}}return o}function createPath(t,e,r,n,i){var a=i.glyphs[t]||i.glyphs["?"];if(a){var o,s,u,l,c,h,f,d,p=new ShapePath;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;)switch(m[v++]){case"m":o=m[v++]*e+r,s=m[v++]*e+n,p.moveTo(o,s);break;case"l":o=m[v++]*e+r,s=m[v++]*e+n,p.lineTo(o,s);break;case"q":u=m[v++]*e+r,l=m[v++]*e+n,c=m[v++]*e+r,h=m[v++]*e+n,p.quadraticCurveTo(c,h,u,l);break;case"b":u=m[v++]*e+r,l=m[v++]*e+n,c=m[v++]*e+r,h=m[v++]*e+n,f=m[v++]*e+r,d=m[v++]*e+n,p.bezierCurveTo(c,h,f,d,u,l)}return{offsetX:a.ha*e,path:p}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".")}function FontLoader(t){Loader.call(this,t)}ImageBitmapLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:ImageBitmapLoader,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,a=Cache.get(t);if(void 0!==a)return i.manager.itemStart(t),setTimeout((function(){e&&e(a),i.manager.itemEnd(t)}),0),a;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===i.options?createImageBitmap(t):createImageBitmap(t,i.options)})).then((function(r){Cache.add(t,r),e&&e(r),i.manager.itemEnd(t)})).catch((function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(ShapePath.prototype,{moveTo:function(t,e){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,r,n){return this.currentPath.quadraticCurveTo(t,e,r,n),this},bezierCurveTo:function(t,e,r,n,i,a){return this.currentPath.bezierCurveTo(t,e,r,n,i,a),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],a=new Shape;a.curves=i.curves,e.push(a)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,a=0;a<r;i=a++){var o=e[i],s=e[a],u=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=e[a],u=-u,s=e[i],l=-l),t.y<o.y||t.y>s.y)continue;if(t.y===o.y){if(t.x===o.x)return!0}else{var c=l*(t.x-o.x)-u*(t.y-o.y);if(0===c)return!0;if(c<0)continue;n=!n}}else{if(t.y!==o.y)continue;if(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x)return!0}}return n}var i=ShapeUtils.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return r(a);var o,s,u,l=[];if(1===a.length)return s=a[0],(u=new Shape).curves=s.curves,l.push(u),l;var c=!i(a[0].getPoints());c=t?!c:c;var h,f,d=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)o=i(h=(s=a[g]).getPoints()),(o=t?!o:o)?(!c&&p[v]&&v++,p[v]={s:new Shape,p:h},p[v].s.curves=s.curves,c&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!p[0])return r(a);if(p.length>1){for(var _=!1,b=[],x=0,w=p.length;x<w;x++)d[x]=[];for(x=0,w=p.length;x<w;x++)for(var M=m[x],A=0;A<M.length;A++){for(var E=M[A],S=!0,T=0;T<p.length;T++)n(E.p,p[T].p)&&(x!==T&&b.push({froms:x,tos:T,hole:A}),S?(S=!1,d[T].push(E)):_=!0);S&&d[x].push(E)}b.length>0&&(_||(m=d))}g=0;for(var C=p.length;g<C;g++){l.push(u=p[g].s);for(var O=0,P=(f=m[g]).length;O<P;O++)u.holes.push(f[O].h)}return l}}),Object.assign(Font.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var r=[],n=createPaths(t,e,this.data),i=0,a=n.length;i<a;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),FontLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:FontLoader,load:function(t,e,r,n){var i=this,a=new FileLoader(this.manager);a.setPath(this.path),a.load(t,(function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)}),r,n)},parse:function(t){return new Font(t)}});var AudioContext={getContext:function(){return void 0===_context&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context},setContext:function(t){_context=t}};function AudioLoader(t){Loader.call(this,t)}function SphericalHarmonics3(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Vector3$1)}function LightProbe(t,e){Light.call(this,void 0,e),this.sh=void 0!==t?t:new SphericalHarmonics3}function HemisphereLightProbe(t,e,r){LightProbe.call(this,void 0,r);var n=(new Color$c).set(t),i=(new Color$c).set(e),a=new Vector3$1(n.r,n.g,n.b),o=new Vector3$1(i.r,i.g,i.b),s=Math.sqrt(Math.PI),u=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(u)}function AmbientLightProbe(t,e){LightProbe.call(this,void 0,e);var r=(new Color$c).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}AudioLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:AudioLoader,load:function(t,e,r,n){var i=new FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(t,(function(t){var r=t.slice(0);AudioContext.getContext().decodeAudioData(r,(function(t){e(t)}))}),r,n)}}),Object.assign(SphericalHarmonics3.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScale(a[1],.488603*n),e.addScale(a[2],.488603*i),e.addScale(a[3],.488603*r),e.addScale(a[4],r*n*1.092548),e.addScale(a[5],n*i*1.092548),e.addScale(a[6],.315392*(3*i*i-1)),e.addScale(a[7],r*i*1.092548),e.addScale(a[8],.546274*(r*r-n*n)),e},getIrradianceAt:function(t,e){var r=t.x,n=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScale(a[1],1.023328*n),e.addScale(a[2],1.023328*i),e.addScale(a[3],1.023328*r),e.addScale(a[4],.858086*r*n),e.addScale(a[5],.858086*n*i),e.addScale(a[6],.743125*i*i-.247708),e.addScale(a[7],.858086*r*i),e.addScale(a[8],.429043*(r*r-n*n)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(t,e+3*n);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(t,e+3*n);return t}}),Object.assign(SphericalHarmonics3,{getBasisAt:function(t,e){var r=t.x,n=t.y,i=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*i,e[3]=.488603*r,e[4]=1.092548*r*n,e[5]=1.092548*n*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*r*i,e[8]=.546274*(r*r-n*n)}}),LightProbe.prototype=Object.assign(Object.create(Light.prototype),{constructor:LightProbe,isLightProbe:!0,copy:function(t){return Light.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){return Light.prototype.toJSON.call(this,t)}}),HemisphereLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:HemisphereLightProbe,isHemisphereLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}}),AmbientLightProbe.prototype=Object.assign(Object.create(LightProbe.prototype),{constructor:AmbientLightProbe,isAmbientLightProbe:!0,copy:function(t){return LightProbe.prototype.copy.call(this,t),this},toJSON:function(t){return LightProbe.prototype.toJSON.call(this,t)}});var _eyeRight=new Matrix4$2,_eyeLeft=new Matrix4$2;function StereoCamera(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Clock(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(StereoCamera.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r,n,i=t.projectionMatrix.clone(),a=e.eyeSep/2,o=a*e.near/e.focus,s=e.near*Math.tan(_Math.DEG2RAD*e.fov*.5)/e.zoom;_eyeLeft.elements[12]=-a,_eyeRight.elements[12]=a,i.elements[0]=2*e.near/((n=s*e.aspect+o)-(r=-s*e.aspect+o)),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),i.elements[0]=2*e.near/((n=s*e.aspect-o)-(r=-s*e.aspect-o)),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(_eyeRight)}}),Object.assign(Clock.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var _position$2=new Vector3$1,_quaternion$3=new Quaternion,_scale$1=new Vector3$1,_orientation=new Vector3$1;function AudioListener(){Object3D.call(this),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}function Audio(t){Object3D.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){Object3D.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$2,_quaternion$3,_scale$1),_orientation.set(0,0,-1).applyQuaternion(_quaternion$3),e.positionX){var n=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(_position$2.x,n),e.positionY.linearRampToValueAtTime(_position$2.y,n),e.positionZ.linearRampToValueAtTime(_position$2.z,n),e.forwardX.linearRampToValueAtTime(_orientation.x,n),e.forwardY.linearRampToValueAtTime(_orientation.y,n),e.forwardZ.linearRampToValueAtTime(_orientation.z,n),e.upX.linearRampToValueAtTime(r.x,n),e.upY.linearRampToValueAtTime(r.y,n),e.upZ.linearRampToValueAtTime(r.z,n)}else e.setPosition(_position$2.x,_position$2.y,_position$2.z),e.setOrientation(_orientation.x,_orientation.y,_orientation.z,r.x,r.y,r.z)}}),Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var _position$3=new Vector3$1,_quaternion$4=new Quaternion,_scale$2=new Vector3$1,_orientation$1=new Vector3$1;function PositionalAudio(t){Audio.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function AudioAnalyser(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function PropertyMixer(t,e,r){this.binding=t,this.valueSize=r;var n,i=Float64Array;switch(e){case"quaternion":n=this._slerp;break;case"string":case"bool":i=Array,n=this._select;break;default:n=this._lerp}this.buffer=new i(4*r),this._mixBufferRegion=n,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(t){if(Object3D.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(_position$3,_quaternion$4,_scale$2),_orientation$1.set(0,0,1).applyQuaternion(_quaternion$4);var e=this.panner;if(e.positionX){var r=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_position$3.x,r),e.positionY.linearRampToValueAtTime(_position$3.y,r),e.positionZ.linearRampToValueAtTime(_position$3.z,r),e.orientationX.linearRampToValueAtTime(_orientation$1.x,r),e.orientationY.linearRampToValueAtTime(_orientation$1.y,r),e.orientationZ.linearRampToValueAtTime(_orientation$1.z,r)}else e.setPosition(_position$3.x,_position$3.y,_position$3.z),e.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z)}}}),Object.assign(AudioAnalyser.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(PropertyMixer.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==n;++o)r[i+o]=r[o];a=e}else this._mixBufferRegion(r,i,0,e/(a+=e),n);this.cumulativeWeight=a},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,a=this.binding;this.cumulativeWeight=0,i<1&&this._mixBufferRegion(r,n,3*e,1-i,e);for(var o=e,s=e+e;o!==s;++o)if(r[o]!==r[o+e]){a.setValue(r,n);break}},saveOriginalState:function(){var t=this.buffer,e=this.valueSize,r=3*e;this.binding.getValue(t,r);for(var n=e,i=r;n!==i;++n)t[n]=t[r+n%e];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(t,e,r,n,i){if(n>=.5)for(var a=0;a!==i;++a)t[e+a]=t[r+a]},_slerp:function(t,e,r,n){Quaternion.slerpFlat(t,e,t,e,t,r,n)},_lerp:function(t,e,r,n,i){for(var a=1-n,o=0;o!==i;++o){var s=e+o;t[s]=t[s]*a+t[r+o]*n}}});var _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones"];function Composite(t,e,r){var n=r||PropertyBinding.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function PropertyBinding(t,e,r){this.path=e,this.parsedPath=r||PropertyBinding.parseTrackName(e),this.node=PropertyBinding.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function AnimationObjectGroup(){this.uuid=_Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function AnimationAction(t,e,r){this._mixer=t,this._clip=e,this._localRoot=r||null;for(var n=e.tracks,i=n.length,a=new Array(i),o={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},s=0;s!==i;++s){var u=n[s].createInterpolant(null);a[s]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function AnimationMixer(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Uniform(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function InstancedInterleavedBuffer(t,e,r){InterleavedBuffer.call(this,t,e),this.meshPerAttribute=r||1}function Raycaster(t,e,r,n){this.ray=new Ray(t,e),this.near=r||0,this.far=n||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ascSort(t,e){return t.distance-e.distance}function intersectObject(t,e,r,n){if(!1!==t.visible&&(t.raycast(e,r),!0===n))for(var i=t.children,a=0,o=i.length;a<o;a++)intersectObject(i[a],e,r,!0)}function Spherical(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function Cylindrical(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}Object.assign(Composite.prototype,{getValue:function(t,e){this.bind();var r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(PropertyBinding,{Composite:Composite,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new PropertyBinding.Composite(t,e,r):new PropertyBinding(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(_reservedRe,"")},parseTrackName:function(t){var e=_trackRe.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==_supportedObjectNames.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||""===e||"root"===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var a=n(i.children);if(a)return a}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=PropertyBinding.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var a=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==a){if(void 0===t[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[a]}}var s=t[n];if(void 0!==s){var u=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?u=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(u=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(t.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!t.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(t.geometry.morphTargets[o].name===i){i=o;break}}}l=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(l=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][u]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+e.nodeName+"."+n+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue}),Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,u=void 0,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],f=h.uuid,d=n[f];if(void 0===d){d=e++,n[f]=d,t.push(h);for(var p=0,m=s;p!==m;++p)o[p].push(new PropertyBinding(h,i[p],a[p]))}else if(d<r){u=t[d];var v=--r,g=t[v];for(n[g.uuid]=d,t[d]=g,n[f]=v,t[v]=h,p=0,m=s;p!==m;++p){var y=o[p],_=y[v],b=y[d];y[d]=_,void 0===b&&(b=new PropertyBinding(h,i[p],a[p])),y[v]=b}}else t[d]!==u&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],u=s.uuid,l=r[u];if(void 0!==l&&l>=e){var c=e++,h=t[c];r[h.uuid]=l,t[l]=h,r[u]=c,t[c]=s;for(var f=0,d=i;f!==d;++f){var p=n[f],m=p[c],v=p[l];p[l]=m,p[c]=v}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var u=arguments[o],l=u.uuid,c=n[l];if(void 0!==c)if(delete n[l],c<r){var h=--r,f=t[h],d=t[y=--e];n[f.uuid]=c,t[c]=f,n[d.uuid]=h,t[h]=d,t.pop();for(var p=0,m=a;p!==m;++p){var v=(_=i[p])[h],g=_[y];_[c]=v,_[h]=g,_.pop()}}else{var y;for(n[(d=t[y=--e]).uuid]=c,t[c]=d,t.pop(),p=0,m=a;p!==m;++p){var _;(_=i[p])[c]=_[y],_.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var a=this._paths,o=this._parsedPaths,s=this._objects,u=this.nCachedObjects_,l=new Array(s.length);r[t]=n=i.length,a.push(t),o.push(e),i.push(l);for(var c=u,h=s.length;c!==h;++c)l[c]=new PropertyBinding(s[c],t,e);return l},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=r,a[r]=s,a.pop(),i[r]=i[o],i.pop(),n[r]=n[o],n.pop()}}}),Object.assign(AnimationAction.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,a=n/i;t.warp(1,i/n,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,u=a.sampleValues;return s[0]=i,s[1]=i+r,u[0]=t/o,u[1]=e/o,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var a=(t-i)*r;if(a<0||0===r)return;this._startTime=null,e=r*a}e*=this._updateTimeScale(t);var o=this._updateTime(e),s=this._updateWeight(t);if(s>0)for(var u=this._interpolants,l=this._propertyBindings,c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulate(n,s)}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;null!==r&&(e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,n=this.loop,i=this._loopCount,a=n===LoopPingPong;if(0===t)return-1===i?e:a&&1==(1&i)?r-e:e;if(n===LoopOnce){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),e>=r||e<0){var o=Math.floor(e/r);e-=r*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e=t>0?r:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var u=t<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=e;if(a&&1==(1&i))return r-e}return e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=ZeroSlopeEnding,n.endingEnd=ZeroSlopeEnding):(n.endingStart=t?this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding,n.endingEnd=e?this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:WrapAroundEnding)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=e,o[1]=i+t,s[1]=r,this}}),AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,a=t._propertyBindings,o=t._interpolants,s=r.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(u[s]=l={});for(var c=0;c!==i;++c){var h=n[c],f=h.name,d=l[f];if(void 0!==d)a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,f));continue}++(d=new PropertyMixer(PropertyBinding.create(r,f,e&&e._propertyBindings[c].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,f),a[c]=d}o[c].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,a=i[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=a;else{var o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,u=s[s.length-1],l=t._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],a=this._bindings;void 0===i&&(n[e]=i={}),i[r]=t,t._cacheIndex=a.length,a.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,a=this._bindingsByRootAndName,o=a[n],s=e[e.length-1],u=t._cacheIndex;s._cacheIndex=u,e[u]=s,e.pop(),delete o[i],0===Object.keys(o).length&&delete a[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?AnimationClip.findByName(r,t):t,a=null!==i?i.uuid:t,o=this._actionsByClip[a],s=null;if(void 0!==o){var u=o.actionByRoot[n];if(void 0!==u)return u;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var l=new AnimationAction(this,i,e);return this._bindAction(l,s),this._addInactiveAction(l,a,n),l},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?AnimationClip.findByName(r,t):t,a=this._actionsByClip[i?i.uuid:t];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,r=this._bindings,n=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==e;++i)t[i].reset();for(i=0;i!==n;++i)r[i].useCount=0;return this},update:function(t){for(var e=this._actions,r=this._nActiveActions,n=this.time+=t*=this.timeScale,i=Math.sign(t),a=this._accuIndex^=1,o=0;o!==r;++o)e[o]._update(n,t,i,a);var s=this._bindings,u=this._nActiveBindings;for(o=0;o!==u;++o)s[o].apply(a);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=e[e.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,e[l]=c,e.pop(),this._removeInactiveBindingsForAction(u)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[e];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Uniform.prototype.clone=function(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())},InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function(t){return InterleavedBuffer.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Raycaster.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return intersectObject(t,this,n,e),n.sort(ascSort),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,a=t.length;i<a;i++)intersectObject(t[i],this,n,e);return n.sort(ascSort),n}}),Object.assign(Spherical.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(_Math.clamp(e/this.radius,-1,1))),this}}),Object.assign(Cylindrical.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}});var _vector$8=new Vector2$3;function Box2(t,e){this.min=void 0!==t?t:new Vector2$3(1/0,1/0),this.max=void 0!==e?e:new Vector2$3(-1/0,-1/0)}Object.assign(Box2.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=_vector$8.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Vector2$3),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Vector2$3),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Vector2$3),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Vector2$3),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return _vector$8.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var _startP=new Vector3$1,_startEnd=new Vector3$1;function Line3(t,e){this.start=void 0!==t?t:new Vector3$1,this.end=void 0!==e?e:new Vector3$1}function ImmediateRenderObject(t){Object3D.call(this),this.material=t,this.render=function(){}}Object.assign(Line3.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Vector3$1),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Vector3$1),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Vector3$1),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){_startP.subVectors(t,this.start),_startEnd.subVectors(this.end,this.start);var r=_startEnd.dot(_startEnd),n=_startEnd.dot(_startP)/r;return e&&(n=_Math.clamp(n,0,1)),n},closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Vector3$1),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),ImmediateRenderObject.prototype=Object.create(Object3D.prototype),ImmediateRenderObject.prototype.constructor=ImmediateRenderObject,ImmediateRenderObject.prototype.isImmediateRenderObject=!0;var _vector$9=new Vector3$1;function SpotLightHelper(t,e){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new BufferGeometry$1,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new Float32BufferAttribute(n,3));var u=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(r,u),this.add(this.cone),this.update()}SpotLightHelper.prototype=Object.create(Object3D.prototype),SpotLightHelper.prototype.constructor=SpotLightHelper,SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},SpotLightHelper.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),_vector$9.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$9),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var _vector$a=new Vector3$1,_boneMatrix=new Matrix4$2,_matrixWorldInv=new Matrix4$2;function getBoneList(t){var e=[];t&&t.isBone&&e.push(t);for(var r=0;r<t.children.length;r++)e.push.apply(e,getBoneList(t.children[r]));return e}function SkeletonHelper(t){for(var e=getBoneList(t),r=new BufferGeometry$1,n=[],i=[],a=new Color$c(0,0,1),o=new Color$c(0,1,0),s=0;s<e.length;s++){var u=e[s];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}r.setAttribute("position",new Float32BufferAttribute(n,3)),r.setAttribute("color",new Float32BufferAttribute(i,3));var l=new LineBasicMaterial({vertexColors:VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,r,l),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function PointLightHelper(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new SphereBufferGeometry(e,4,2),i=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}SkeletonHelper.prototype=Object.create(LineSegments.prototype),SkeletonHelper.prototype.constructor=SkeletonHelper,SkeletonHelper.prototype.updateMatrixWorld=function(t){var e=this.bones,r=this.geometry,n=r.getAttribute("position");_matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<e.length;i++){var o=e[i];o.parent&&o.parent.isBone&&(_boneMatrix.multiplyMatrices(_matrixWorldInv,o.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),n.setXYZ(a,_vector$a.x,_vector$a.y,_vector$a.z),_boneMatrix.multiplyMatrices(_matrixWorldInv,o.parent.matrixWorld),_vector$a.setFromMatrixPosition(_boneMatrix),n.setXYZ(a+1,_vector$a.x,_vector$a.y,_vector$a.z),a+=2)}r.getAttribute("position").needsUpdate=!0,Object3D.prototype.updateMatrixWorld.call(this,t)},PointLightHelper.prototype=Object.create(Mesh.prototype),PointLightHelper.prototype.constructor=PointLightHelper,PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},PointLightHelper.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var _vector$b=new Vector3$1,_color1=new Color$c,_color2=new Color$c;function HemisphereLightHelper(t,e,r){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new OctahedronBufferGeometry(e);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=VertexColors);var i=n.getAttribute("position"),a=new Float32Array(3*i.count);n.setAttribute("color",new BufferAttribute$1(a,3)),this.add(new Mesh(n,this.material)),this.update()}function GridHelper(t,e,r,n){t=t||10,e=e||10,r=new Color$c(void 0!==r?r:4473924),n=new Color$c(void 0!==n?n:8947848);for(var i=e/2,a=t/e,o=t/2,s=[],u=[],l=0,c=0,h=-o;l<=e;l++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var f=l===i?r:n;f.toArray(u,c),f.toArray(u,c+=3),f.toArray(u,c+=3),f.toArray(u,c+=3),c+=3}var d=new BufferGeometry$1;d.setAttribute("position",new Float32BufferAttribute(s,3)),d.setAttribute("color",new Float32BufferAttribute(u,3));var p=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,d,p)}function PolarGridHelper(t,e,r,n,i,a){t=t||10,e=e||16,r=r||8,n=n||64,i=new Color$c(void 0!==i?i:4473924),a=new Color$c(void 0!==a?a:8947848);var o,s,u,l,c,h,f,d=[],p=[];for(l=0;l<=e;l++)u=l/e*(2*Math.PI),o=Math.sin(u)*t,s=Math.cos(u)*t,d.push(0,0,0),d.push(o,0,s),p.push((f=1&l?i:a).r,f.g,f.b),p.push(f.r,f.g,f.b);for(l=0;l<=r;l++)for(f=1&l?i:a,h=t-t/r*l,c=0;c<n;c++)u=c/n*(2*Math.PI),o=Math.sin(u)*h,s=Math.cos(u)*h,d.push(o,0,s),p.push(f.r,f.g,f.b),u=(c+1)/n*(2*Math.PI),o=Math.sin(u)*h,s=Math.cos(u)*h,d.push(o,0,s),p.push(f.r,f.g,f.b);var m=new BufferGeometry$1;m.setAttribute("position",new Float32BufferAttribute(d,3)),m.setAttribute("color",new Float32BufferAttribute(p,3));var v=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,m,v)}HemisphereLightHelper.prototype=Object.create(Object3D.prototype),HemisphereLightHelper.prototype.constructor=HemisphereLightHelper,HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},HemisphereLightHelper.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(var r=0,n=e.count;r<n;r++){var i=r<n/2?_color1:_color2;e.setXYZ(r,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(_vector$b.setFromMatrixPosition(this.light.matrixWorld).negate())},GridHelper.prototype=Object.assign(Object.create(LineSegments.prototype),{constructor:GridHelper,copy:function(t){return LineSegments.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),PolarGridHelper.prototype=Object.create(LineSegments.prototype),PolarGridHelper.prototype.constructor=PolarGridHelper;var _v1$5=new Vector3$1,_v2$3=new Vector3$1,_v3$1=new Vector3$1;function DirectionalLightHelper(t,e,r){Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new BufferGeometry$1;n.setAttribute("position",new Float32BufferAttribute([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(n,i),this.add(this.lightPlane),(n=new BufferGeometry$1).setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,i),this.add(this.targetLine),this.update()}DirectionalLightHelper.prototype=Object.create(Object3D.prototype),DirectionalLightHelper.prototype.constructor=DirectionalLightHelper,DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},DirectionalLightHelper.prototype.update=function(){_v1$5.setFromMatrixPosition(this.light.matrixWorld),_v2$3.setFromMatrixPosition(this.light.target.matrixWorld),_v3$1.subVectors(_v2$3,_v1$5),this.lightPlane.lookAt(_v2$3),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$3),this.targetLine.scale.z=_v3$1.length()};var _vector$c=new Vector3$1,_camera=new Camera;function CameraHelper(t){var e=new BufferGeometry$1,r=new LineBasicMaterial({color:16777215,vertexColors:FaceColors}),n=[],i=[],a={},o=new Color$c(16755200),s=new Color$c(16711680),u=new Color$c(43775),l=new Color$c(16777215),c=new Color$c(3355443);function h(t,e,r){f(t,r),f(e,r)}function f(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",u),h("u2","u3",u),h("u3","u1",u),h("c","t",l),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),e.setAttribute("position",new Float32BufferAttribute(n,3)),e.setAttribute("color",new Float32BufferAttribute(i,3)),LineSegments.call(this,e,r),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function setPoint(t,e,r,n,i,a,o){_vector$c.set(i,a,o).unproject(n);var s=e[t];if(void 0!==s)for(var u=r.getAttribute("position"),l=0,c=s.length;l<c;l++)u.setXYZ(s[l],_vector$c.x,_vector$c.y,_vector$c.z)}CameraHelper.prototype=Object.create(LineSegments.prototype),CameraHelper.prototype.constructor=CameraHelper,CameraHelper.prototype.update=function(){var t=this.geometry,e=this.pointMap;_camera.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",e,t,_camera,0,0,-1),setPoint("t",e,t,_camera,0,0,1),setPoint("n1",e,t,_camera,-1,-1,-1),setPoint("n2",e,t,_camera,1,-1,-1),setPoint("n3",e,t,_camera,-1,1,-1),setPoint("n4",e,t,_camera,1,1,-1),setPoint("f1",e,t,_camera,-1,-1,1),setPoint("f2",e,t,_camera,1,-1,1),setPoint("f3",e,t,_camera,-1,1,1),setPoint("f4",e,t,_camera,1,1,1),setPoint("u1",e,t,_camera,.7,1.1,-1),setPoint("u2",e,t,_camera,-.7,1.1,-1),setPoint("u3",e,t,_camera,0,2,-1),setPoint("cf1",e,t,_camera,-1,0,1),setPoint("cf2",e,t,_camera,1,0,1),setPoint("cf3",e,t,_camera,0,-1,1),setPoint("cf4",e,t,_camera,0,1,1),setPoint("cn1",e,t,_camera,-1,0,-1),setPoint("cn2",e,t,_camera,1,0,-1),setPoint("cn3",e,t,_camera,0,-1,-1),setPoint("cn4",e,t,_camera,0,1,-1),t.getAttribute("position").needsUpdate=!0};var _box$3=new Box3;function BoxHelper(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new BufferGeometry$1;i.setIndex(new BufferAttribute$1(r,1)),i.setAttribute("position",new BufferAttribute$1(n,3)),LineSegments.call(this,i,new LineBasicMaterial({color:e})),this.matrixAutoUpdate=!1,this.update()}function Box3Helper(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry$1;n.setIndex(new BufferAttribute$1(r,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),LineSegments.call(this,n,new LineBasicMaterial({color:e})),this.geometry.computeBoundingSphere()}function PlaneHelper(t,e,r){this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new BufferGeometry$1;i.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Line.call(this,i,new LineBasicMaterial({color:n}));var a=new BufferGeometry$1;a.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new Mesh(a,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1})))}BoxHelper.prototype=Object.create(LineSegments.prototype),BoxHelper.prototype.constructor=BoxHelper,BoxHelper.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&_box$3.setFromObject(this.object),!_box$3.isEmpty()){var e=_box$3.min,r=_box$3.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=e.x,i[4]=r.y,i[5]=r.z,i[6]=e.x,i[7]=e.y,i[8]=r.z,i[9]=r.x,i[10]=e.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=e.z,i[15]=e.x,i[16]=r.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=r.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},BoxHelper.prototype.setFromObject=function(t){return this.object=t,this.update(),this},BoxHelper.prototype.copy=function(t){return LineSegments.prototype.copy.call(this,t),this.object=t.object,this},BoxHelper.prototype.clone=function(){return(new this.constructor).copy(this)},Box3Helper.prototype=Object.create(LineSegments.prototype),Box3Helper.prototype.constructor=Box3Helper,Box3Helper.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Object3D.prototype.updateMatrixWorld.call(this,t))},PlaneHelper.prototype=Object.create(Line.prototype),PlaneHelper.prototype.constructor=PlaneHelper,PlaneHelper.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?BackSide:FrontSide,this.lookAt(this.plane.normal),Object3D.prototype.updateMatrixWorld.call(this,t)};var _axis=new Vector3$1,_lineGeometry,_coneGeometry;function ArrowHelper(t,e,r,n,i,a){Object3D.call(this),void 0===t&&(t=new Vector3$1(0,0,1)),void 0===e&&(e=new Vector3$1(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===a&&(a=.2*i),void 0===_lineGeometry&&((_lineGeometry=new BufferGeometry$1).setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),(_coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,a)}function AxesHelper(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new BufferGeometry$1;r.setAttribute("position",new Float32BufferAttribute(e,3)),r.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,r,n)}ArrowHelper.prototype=Object.create(Object3D.prototype),ArrowHelper.prototype.constructor=ArrowHelper,ArrowHelper.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(_axis,e)}},ArrowHelper.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},ArrowHelper.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},ArrowHelper.prototype.copy=function(t){return Object3D.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},ArrowHelper.prototype.clone=function(){return(new this.constructor).copy(this)},AxesHelper.prototype=Object.create(LineSegments.prototype),AxesHelper.prototype.constructor=AxesHelper;var LOD_MIN=4,LOD_MAX=8,SIZE_MAX=Math.pow(2,LOD_MAX),EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],TOTAL_LODS=LOD_MAX-LOD_MIN+1+EXTRA_LOD_SIGMA.length,MAX_SAMPLES=20,ENCODINGS={[LinearEncoding]:0,[sRGBEncoding]:1,[RGBEEncoding]:2,[RGBM7Encoding]:3,[RGBM16Encoding]:4,[RGBDEncoding]:5,[GammaEncoding]:6},_flatCamera=new OrthographicCamera,_blurMaterial=_getBlurShader(MAX_SAMPLES),_equirectShader=null,_cubemapShader=null,{_lodPlanes:_lodPlanes,_sizeLods:_sizeLods,_sigmas:_sigmas}=_createPlanes(),_pingPongRenderTarget=null,_renderer=null,PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3$1(1,1,1),new Vector3$1(-1,1,1),new Vector3$1(1,1,-1),new Vector3$1(-1,1,-1),new Vector3$1(0,PHI,INV_PHI),new Vector3$1(0,PHI,-INV_PHI),new Vector3$1(INV_PHI,0,PHI),new Vector3$1(-INV_PHI,0,PHI),new Vector3$1(PHI,INV_PHI,0),new Vector3$1(-PHI,INV_PHI,0)];function PMREMGenerator(t){_renderer=t,_compileMaterial(_blurMaterial)}function _createPlanes(){for(var t=[],e=[],r=[],n=LOD_MAX,i=0;i<TOTAL_LODS;i++){var a=Math.pow(2,n);e.push(a);var o=1/a;i>LOD_MAX-LOD_MIN?o=EXTRA_LOD_SIGMA[i-LOD_MAX+LOD_MIN-1]:0==i&&(o=0),r.push(o);for(var s=1/(a-1),u=-s/2,l=1+s/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],h=new Float32Array(108),f=new Float32Array(72),d=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,v=p>2?0:-1;h.set([m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0],18*p),f.set(c,12*p),d.set([p,p,p,p,p,p],6*p)}var g=new BufferGeometry$1;g.setAttribute("position",new BufferAttribute$1(h,3)),g.setAttribute("uv",new BufferAttribute$1(f,2)),g.setAttribute("faceIndex",new BufferAttribute$1(d,1)),t.push(g),n>LOD_MIN&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:r}}function _allocateTargets(t){var e={magFilter:NearestFilter,minFilter:NearestFilter,generateMipmaps:!1,type:t?t.type:UnsignedByteType,format:t?t.format:RGBEFormat,encoding:t?t.encoding:RGBEEncoding,depthBuffer:!1,stencilBuffer:!1},r=_createRenderTarget(e);return r.depthBuffer=!t,_pingPongRenderTarget=_createRenderTarget(e),r}function _cleanup(){_pingPongRenderTarget.dispose(),_renderer.setRenderTarget(null);var t=_renderer.getSize(new Vector2$3);_renderer.setViewport(0,0,t.x,t.y)}function _sceneToCubeUV(t,e,r,n){var i=new PerspectiveCamera(90,1,e,r),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=_renderer.outputEncoding,u=_renderer.toneMapping,l=_renderer.toneMappingExposure,c=_renderer.getClearColor(),h=_renderer.getClearAlpha();_renderer.toneMapping=LinearToneMapping,_renderer.toneMappingExposure=1,_renderer.outputEncoding=LinearEncoding,t.scale.z*=-1;var f=t.background;if(f&&f.isColor){f.convertSRGBToLinear();var d=Math.max(f.r,f.g,f.b),p=Math.min(Math.max(Math.ceil(Math.log2(d)),-128),127);f=f.multiplyScalar(Math.pow(2,-p)),_renderer.setClearColor(f,(p+128)/255),t.background=null}_renderer.setRenderTarget(n);for(var m=0;m<6;m++){var v=m%3;0==v?(i.up.set(0,a[m],0),i.lookAt(o[m],0,0)):1==v?(i.up.set(0,0,a[m]),i.lookAt(0,o[m],0)):(i.up.set(0,a[m],0),i.lookAt(0,0,o[m])),_setViewport(v*SIZE_MAX,m>2?SIZE_MAX:0,SIZE_MAX,SIZE_MAX),_renderer.render(t,i)}_renderer.toneMapping=u,_renderer.toneMappingExposure=l,_renderer.outputEncoding=s,_renderer.setClearColor(c,h),t.scale.z*=-1}function _textureToCubeUV(t,e){var r=new Scene;t.isCubeTexture?null==_cubemapShader&&(_cubemapShader=_getCubemapShader()):null==_equirectShader&&(_equirectShader=_getEquirectShader());var n=t.isCubeTexture?_cubemapShader:_equirectShader;r.add(new Mesh(_lodPlanes[0],n));var i=n.uniforms;i.envMap.value=t,t.isCubeTexture||i.texelSize.value.set(1/t.image.width,1/t.image.height),i.inputEncoding.value=ENCODINGS[t.encoding],i.outputEncoding.value=ENCODINGS[t.encoding],_renderer.setRenderTarget(e),_setViewport(0,0,3*SIZE_MAX,2*SIZE_MAX),_renderer.render(r,_flatCamera)}function _compileMaterial(t){var e=new Scene;e.add(new Mesh(_lodPlanes[0],t)),_renderer.compile(e,_flatCamera)}function _createRenderTarget(t){var e=new WebGLRenderTarget(3*SIZE_MAX,3*SIZE_MAX,t);return e.texture.mapping=CubeUVReflectionMapping,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function _setViewport(t,e,r,n){var i=1/_renderer.getPixelRatio();_renderer.setViewport(t*=i,e*=i,r*=i,n*=i),_renderer.setScissor(t,e,r,n)}function _applyPMREM(t){var e=_renderer.autoClear;_renderer.autoClear=!1;for(var r=1;r<TOTAL_LODS;r++)_blur(t,r-1,r,Math.sqrt(_sigmas[r]*_sigmas[r]-_sigmas[r-1]*_sigmas[r-1]),_axisDirections[(r-1)%_axisDirections.length]);_renderer.autoClear=e}function _blur(t,e,r,n,i){_halfBlur(t,_pingPongRenderTarget,e,r,n,"latitudinal",i),_halfBlur(_pingPongRenderTarget,t,r,r,n,"longitudinal",i)}function _halfBlur(t,e,r,n,i,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new Scene;s.add(new Mesh(_lodPlanes[n],_blurMaterial));var u=_blurMaterial.uniforms,l=_sizeLods[r]-1,c=isFinite(i)?Math.PI/(2*l):2*Math.PI/(2*MAX_SAMPLES-1),h=i/c,f=isFinite(i)?1+Math.floor(3*h):MAX_SAMPLES;f>MAX_SAMPLES&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to ${MAX_SAMPLES}`);for(var d=[],p=0,m=0;m<MAX_SAMPLES;++m){var v=m/h,g=Math.exp(-v*v/2);d.push(g),0==m?p+=g:m<f&&(p+=2*g)}for(m=0;m<d.length;m++)d[m]=d[m]/p;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=d,u.latitudinal.value="latitudinal"===a,o&&(u.poleAxis.value=o),u.dTheta.value=c,u.mipInt.value=LOD_MAX-r,u.inputEncoding.value=ENCODINGS[t.texture.encoding],u.outputEncoding.value=ENCODINGS[t.texture.encoding];var y=_sizeLods[n],_=(v=3*Math.max(0,SIZE_MAX-2*y),(0===n?0:2*SIZE_MAX)+2*y*(n>LOD_MAX-LOD_MIN?n-LOD_MAX+LOD_MIN:0));_renderer.setRenderTarget(e),_setViewport(v,_,3*y,2*y),_renderer.render(s,_flatCamera)}function _getBlurShader(t){var e=new RawShaderMaterial({defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(t)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Vector3$1(0,1,0)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${_getEncodings()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1});return e.type="SphericalGaussianBlur",e}function _getEquirectShader(){var t=new RawShaderMaterial({uniforms:{envMap:{value:null},texelSize:{value:new Vector2$3(1,1)},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${_getEncodings()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function _getCubemapShader(){var t=new RawShaderMaterial({uniforms:{envMap:{value:null},inputEncoding:{value:ENCODINGS[LinearEncoding]},outputEncoding:{value:ENCODINGS[LinearEncoding]}},vertexShader:_getCommonVertexShader(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${_getEncodings()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:NoBlending,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function _getCommonVertexShader(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function _getEncodings(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function Face4(t,e,r,n,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Face3(t,e,r,i,a,o)}PMREMGenerator.prototype={constructor:PMREMGenerator,fromScene:function(t,e=0,r=.1,n=100){var i=_allocateTargets();return _sceneToCubeUV(t,r,n,i),e>0&&_blur(i,0,0,e),_applyPMREM(i),_cleanup(),i.scissorTest=!1,i},fromEquirectangular:function(t){return t.magFilter=NearestFilter,t.minFilter=NearestFilter,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){var e=_allocateTargets(t);return _textureToCubeUV(t,e),_applyPMREM(e),_cleanup(),e.scissorTest=!1,e},compileCubemapShader:function(){null==_cubemapShader&&_compileMaterial(_cubemapShader=_getCubemapShader())},compileEquirectangularShader:function(){null==_equirectShader&&_compileMaterial(_equirectShader=_getEquirectShader())},dispose:function(){_blurMaterial.dispose(),null!=_cubemapShader&&_cubemapShader.dispose(),null!=_equirectShader&&_equirectShader.dispose();for(var t=0;t<_lodPlanes.length;t++)_lodPlanes[t].dispose()}};var LineStrip=0,LinePieces=1;function MeshFaceMaterial(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function MultiMaterial(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function PointCloud(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(t,e)}function Particle(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(t)}function ParticleSystem(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(t,e)}function PointCloudMaterial(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleBasicMaterial(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function ParticleSystemMaterial(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(t)}function Vertex(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3$1(t,e,r)}function DynamicBufferAttribute(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new BufferAttribute$1(t,e).setDynamic(!0)}function Int8Attribute(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(t,e)}function Uint8Attribute(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(t,e)}function Uint8ClampedAttribute(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(t,e)}function Int16Attribute(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(t,e)}function Uint16Attribute(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(t,e)}function Int32Attribute(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(t,e)}function Uint32Attribute(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(t,e)}function Float32Attribute(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(t,e)}function Float64Attribute(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(t,e)}function ClosedSplineCurve3(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom",this.closed=!0}function SplineCurve3(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function Spline(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),CatmullRomCurve3.call(this,t),this.type="catmullrom"}function AxisHelper(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(t)}function BoundingBoxHelper(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(t,e)}function EdgesHelper(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function WireframeHelper(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(t.geometry),new LineBasicMaterial({color:void 0!==e?e:16777215}))}function XHRLoader(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(t)}function BinaryTextureLoader(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(t)}Curve.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Curve.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(CurvePath.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Geometry$2,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new Vector3$1(i.x,i.y,i.z||0))}return e}}),Object.assign(Path.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype),Spline.prototype=Object.create(CatmullRomCurve3.prototype),Object.assign(Spline.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Loader.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(t)}}),Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ObjectLoader.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Box2.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Box3.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Line3.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(_Math,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),_Math.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),_Math.ceilPowerOfTwo(t)}}),Object.assign(Matrix3.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Matrix4$2.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3$1).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(t){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(t)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,a)}}),Plane.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Quaternion.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Ray.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Triangle.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Triangle,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(t,e,r,n)}}),Object.assign(Shape.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,t)}}),Object.assign(Vector2$3.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector3$1.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Vector4.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Geometry$2.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(Object3D.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Mesh.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),TrianglesDrawMode},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(LOD.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),PerspectiveCamera.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(BufferAttribute$1.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(DynamicDrawUsage)}}}),Object.assign(BufferAttribute$1.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?DynamicDrawUsage:StaticDrawUsage),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(BufferGeometry$1.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new BufferAttribute$1(arguments[1],arguments[2])))},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)}}),Object.defineProperties(BufferGeometry$1.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(InterleavedBuffer.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===DynamicDrawUsage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(InterleavedBuffer.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?DynamicDrawUsage:StaticDrawUsage),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ExtrudeBufferGeometry.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Uniform.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color$c}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===FlatShading}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(ShaderMaterial$c.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(WebGLRenderer.prototype,{clearTarget:function(t,e,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?sRGBEncoding:LinearEncoding}}}),Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTargetCube.prototype,{activeCubeFace:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeCubeFace has been removed. It is now the second parameter of WebGLRenderer.setRenderTarget().")}},activeMipMapLevel:{set:function(){console.warn("THREE.WebGLRenderTargetCube: .activeMipMapLevel has been removed. It is now the third parameter of WebGLRenderer.setRenderTarget().")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Audio.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new AudioLoader).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var GeometryUtils={merge:function(t,e,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function CanvasRenderer(){console.error("THREE.CanvasRenderer has been removed")}function JSONLoader(){console.error("THREE.JSONLoader has been removed.")}ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new TextureLoader$3;i.setCrossOrigin(this.crossOrigin);var a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},ImageUtils.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new CubeTextureLoader;i.setCrossOrigin(this.crossOrigin);var a=i.load(t,r,void 0,n);return e&&(a.mapping=e),a},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function LensFlare(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));var THREE$1=Object.freeze({__proto__:null,ACESFilmicToneMapping:ACESFilmicToneMapping,AddEquation:AddEquation,AddOperation:AddOperation,AdditiveBlending:AdditiveBlending$4,AlphaFormat:AlphaFormat,AlwaysDepth:AlwaysDepth,AlwaysStencilFunc:AlwaysStencilFunc,AmbientLight:AmbientLight,AmbientLightProbe:AmbientLightProbe,AnimationClip:AnimationClip,AnimationLoader:AnimationLoader,AnimationMixer:AnimationMixer,AnimationObjectGroup:AnimationObjectGroup,AnimationUtils:AnimationUtils,ArcCurve:ArcCurve,ArrayCamera:ArrayCamera,ArrowHelper:ArrowHelper,Audio:Audio,AudioAnalyser:AudioAnalyser,AudioContext:AudioContext,AudioListener:AudioListener,AudioLoader:AudioLoader,AxesHelper:AxesHelper,AxisHelper:AxisHelper,BackSide:BackSide,BasicDepthPacking:BasicDepthPacking,BasicShadowMap:BasicShadowMap,BinaryTextureLoader:BinaryTextureLoader,Bone:Bone,BooleanKeyframeTrack:BooleanKeyframeTrack,BoundingBoxHelper:BoundingBoxHelper,Box2:Box2,Box3:Box3,Box3Helper:Box3Helper,BoxBufferGeometry:BoxBufferGeometry,BoxGeometry:BoxGeometry,BoxHelper:BoxHelper,BufferAttribute:BufferAttribute$1,BufferGeometry:BufferGeometry$1,BufferGeometryLoader:BufferGeometryLoader,ByteType:ByteType,Cache:Cache,Camera:Camera,CameraHelper:CameraHelper,CanvasRenderer:CanvasRenderer,CanvasTexture:CanvasTexture,CatmullRomCurve3:CatmullRomCurve3,CineonToneMapping:CineonToneMapping,CircleBufferGeometry:CircleBufferGeometry,CircleGeometry:CircleGeometry,ClampToEdgeWrapping:ClampToEdgeWrapping,Clock:Clock,ClosedSplineCurve3:ClosedSplineCurve3,Color:Color$c,ColorKeyframeTrack:ColorKeyframeTrack,CompressedTexture:CompressedTexture,CompressedTextureLoader:CompressedTextureLoader,ConeBufferGeometry:ConeBufferGeometry,ConeGeometry:ConeGeometry,CubeCamera:CubeCamera,CubeGeometry:BoxGeometry,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,CubeTexture:CubeTexture,CubeTextureLoader:CubeTextureLoader,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,CubicInterpolant:CubicInterpolant,CullFaceBack:CullFaceBack,CullFaceFront:CullFaceFront,CullFaceFrontBack:CullFaceFrontBack,CullFaceNone:CullFaceNone,Curve:Curve,CurvePath:CurvePath,CustomBlending:CustomBlending,CylinderBufferGeometry:CylinderBufferGeometry,CylinderGeometry:CylinderGeometry$1,Cylindrical:Cylindrical,DataTexture:DataTexture,DataTexture2DArray:DataTexture2DArray,DataTexture3D:DataTexture3D,DataTextureLoader:DataTextureLoader,DecrementStencilOp:DecrementStencilOp,DecrementWrapStencilOp:DecrementWrapStencilOp,DefaultLoadingManager:DefaultLoadingManager,DepthFormat:DepthFormat,DepthStencilFormat:DepthStencilFormat,DepthTexture:DepthTexture,DirectionalLight:DirectionalLight,DirectionalLightHelper:DirectionalLightHelper,DirectionalLightShadow:DirectionalLightShadow,DiscreteInterpolant:DiscreteInterpolant,DodecahedronBufferGeometry:DodecahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DoubleSide:DoubleSide$c,DstAlphaFactor:DstAlphaFactor,DstColorFactor:DstColorFactor,DynamicBufferAttribute:DynamicBufferAttribute,DynamicCopyUsage:DynamicCopyUsage,DynamicDrawUsage:DynamicDrawUsage,DynamicReadUsage:DynamicReadUsage,EdgesGeometry:EdgesGeometry,EdgesHelper:EdgesHelper,EllipseCurve:EllipseCurve,EqualDepth:EqualDepth,EqualStencilFunc:EqualStencilFunc,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,Euler:Euler,EventDispatcher:EventDispatcher,ExtrudeBufferGeometry:ExtrudeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,Face3:Face3,Face4:Face4,FaceColors:FaceColors,FileLoader:FileLoader,FlatShading:FlatShading,Float32Attribute:Float32Attribute,Float32BufferAttribute:Float32BufferAttribute,Float64Attribute:Float64Attribute,Float64BufferAttribute:Float64BufferAttribute,FloatType:FloatType,Fog:Fog,FogExp2:FogExp2,Font:Font,FontLoader:FontLoader,FrontFaceDirectionCCW:FrontFaceDirectionCCW,FrontFaceDirectionCW:FrontFaceDirectionCW,FrontSide:FrontSide,Frustum:Frustum,GammaEncoding:GammaEncoding,Geometry:Geometry$2,GeometryUtils:GeometryUtils,GreaterDepth:GreaterDepth,GreaterEqualDepth:GreaterEqualDepth,GreaterEqualStencilFunc:GreaterEqualStencilFunc,GreaterStencilFunc:GreaterStencilFunc,GridHelper:GridHelper,Group:Group,HalfFloatType:HalfFloatType,HemisphereLight:HemisphereLight,HemisphereLightHelper:HemisphereLightHelper,HemisphereLightProbe:HemisphereLightProbe,IcosahedronBufferGeometry:IcosahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,ImageBitmapLoader:ImageBitmapLoader,ImageLoader:ImageLoader,ImageUtils:ImageUtils,ImmediateRenderObject:ImmediateRenderObject,IncrementStencilOp:IncrementStencilOp,IncrementWrapStencilOp:IncrementWrapStencilOp,InstancedBufferAttribute:InstancedBufferAttribute,InstancedBufferGeometry:InstancedBufferGeometry,InstancedInterleavedBuffer:InstancedInterleavedBuffer,InstancedMesh:InstancedMesh,Int16Attribute:Int16Attribute,Int16BufferAttribute:Int16BufferAttribute,Int32Attribute:Int32Attribute,Int32BufferAttribute:Int32BufferAttribute,Int8Attribute:Int8Attribute,Int8BufferAttribute:Int8BufferAttribute,IntType:IntType,InterleavedBuffer:InterleavedBuffer,InterleavedBufferAttribute:InterleavedBufferAttribute,Interpolant:Interpolant,InterpolateDiscrete:InterpolateDiscrete,InterpolateLinear:InterpolateLinear,InterpolateSmooth:InterpolateSmooth,InvertStencilOp:InvertStencilOp,JSONLoader:JSONLoader,KeepStencilOp:KeepStencilOp,KeyframeTrack:KeyframeTrack,LOD:LOD,LatheBufferGeometry:LatheBufferGeometry,LatheGeometry:LatheGeometry,Layers:Layers,LensFlare:LensFlare,LessDepth:LessDepth,LessEqualDepth:LessEqualDepth,LessEqualStencilFunc:LessEqualStencilFunc,LessStencilFunc:LessStencilFunc,Light:Light,LightProbe:LightProbe,LightShadow:LightShadow,Line:Line,Line3:Line3,LineBasicMaterial:LineBasicMaterial,LineCurve:LineCurve,LineCurve3:LineCurve3,LineDashedMaterial:LineDashedMaterial,LineLoop:LineLoop,LinePieces:LinePieces,LineSegments:LineSegments,LineStrip:LineStrip,LinearEncoding:LinearEncoding,LinearFilter:LinearFilter,LinearInterpolant:LinearInterpolant,LinearMipMapLinearFilter:LinearMipMapLinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipmapLinearFilter:LinearMipmapLinearFilter,LinearMipmapNearestFilter:LinearMipmapNearestFilter,LinearToneMapping:LinearToneMapping,Loader:Loader,LoaderUtils:LoaderUtils,LoadingManager:LoadingManager,LogLuvEncoding:LogLuvEncoding,LoopOnce:LoopOnce,LoopPingPong:LoopPingPong,LoopRepeat:LoopRepeat,LuminanceAlphaFormat:LuminanceAlphaFormat,LuminanceFormat:LuminanceFormat,MOUSE:MOUSE,Material:Material,MaterialLoader:MaterialLoader,Math:_Math,Matrix3:Matrix3,Matrix4:Matrix4$2,MaxEquation:MaxEquation,Mesh:Mesh,MeshBasicMaterial:MeshBasicMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshFaceMaterial:MeshFaceMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshMatcapMaterial:MeshMatcapMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshToonMaterial:MeshToonMaterial,MinEquation:MinEquation,MirroredRepeatWrapping:MirroredRepeatWrapping,MixOperation:MixOperation,MultiMaterial:MultiMaterial,MultiplyBlending:MultiplyBlending,MultiplyOperation:MultiplyOperation,NearestFilter:NearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipmapLinearFilter:NearestMipmapLinearFilter,NearestMipmapNearestFilter:NearestMipmapNearestFilter,NeverDepth:NeverDepth,NeverStencilFunc:NeverStencilFunc,NoBlending:NoBlending,NoColors:NoColors,NoToneMapping:NoToneMapping,NormalBlending:NormalBlending,NotEqualDepth:NotEqualDepth,NotEqualStencilFunc:NotEqualStencilFunc,NumberKeyframeTrack:NumberKeyframeTrack,Object3D:Object3D,ObjectLoader:ObjectLoader,ObjectSpaceNormalMap:ObjectSpaceNormalMap,OctahedronBufferGeometry:OctahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OneFactor:OneFactor,OneMinusDstAlphaFactor:OneMinusDstAlphaFactor,OneMinusDstColorFactor:OneMinusDstColorFactor,OneMinusSrcAlphaFactor:OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:OneMinusSrcColorFactor,OrthographicCamera:OrthographicCamera,PCFShadowMap:PCFShadowMap,PCFSoftShadowMap:PCFSoftShadowMap,PMREMGenerator:PMREMGenerator,ParametricBufferGeometry:ParametricBufferGeometry,ParametricGeometry:ParametricGeometry,Particle:Particle,ParticleBasicMaterial:ParticleBasicMaterial,ParticleSystem:ParticleSystem,ParticleSystemMaterial:ParticleSystemMaterial,Path:Path,PerspectiveCamera:PerspectiveCamera,Plane:Plane,PlaneBufferGeometry:PlaneBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneHelper:PlaneHelper,PointCloud:PointCloud,PointCloudMaterial:PointCloudMaterial,PointLight:PointLight,PointLightHelper:PointLightHelper,Points:Points,PointsMaterial:PointsMaterial,PolarGridHelper:PolarGridHelper,PolyhedronBufferGeometry:PolyhedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PositionalAudio:PositionalAudio,PropertyBinding:PropertyBinding,PropertyMixer:PropertyMixer,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,Quaternion:Quaternion,QuaternionKeyframeTrack:QuaternionKeyframeTrack,QuaternionLinearInterpolant:QuaternionLinearInterpolant,REVISION:REVISION,RGBADepthPacking:RGBADepthPacking,RGBAFormat:RGBAFormat,RGBAIntegerFormat:RGBAIntegerFormat,RGBA_ASTC_10x10_Format:RGBA_ASTC_10x10_Format,RGBA_ASTC_10x5_Format:RGBA_ASTC_10x5_Format,RGBA_ASTC_10x6_Format:RGBA_ASTC_10x6_Format,RGBA_ASTC_10x8_Format:RGBA_ASTC_10x8_Format,RGBA_ASTC_12x10_Format:RGBA_ASTC_12x10_Format,RGBA_ASTC_12x12_Format:RGBA_ASTC_12x12_Format,RGBA_ASTC_4x4_Format:RGBA_ASTC_4x4_Format,RGBA_ASTC_5x4_Format:RGBA_ASTC_5x4_Format,RGBA_ASTC_5x5_Format:RGBA_ASTC_5x5_Format,RGBA_ASTC_6x5_Format:RGBA_ASTC_6x5_Format,RGBA_ASTC_6x6_Format:RGBA_ASTC_6x6_Format,RGBA_ASTC_8x5_Format:RGBA_ASTC_8x5_Format,RGBA_ASTC_8x6_Format:RGBA_ASTC_8x6_Format,RGBA_ASTC_8x8_Format:RGBA_ASTC_8x8_Format,RGBA_PVRTC_2BPPV1_Format:RGBA_PVRTC_2BPPV1_Format,RGBA_PVRTC_4BPPV1_Format:RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT3_Format:RGBA_S3TC_DXT3_Format,RGBA_S3TC_DXT5_Format:RGBA_S3TC_DXT5_Format,RGBDEncoding:RGBDEncoding,RGBEEncoding:RGBEEncoding,RGBEFormat:RGBEFormat,RGBFormat:RGBFormat,RGBIntegerFormat:RGBIntegerFormat,RGBM16Encoding:RGBM16Encoding,RGBM7Encoding:RGBM7Encoding,RGB_ETC1_Format:RGB_ETC1_Format,RGB_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,RGB_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:RGB_S3TC_DXT1_Format,RGFormat:RGFormat,RGIntegerFormat:RGIntegerFormat,RawShaderMaterial:RawShaderMaterial,Ray:Ray,Raycaster:Raycaster,RectAreaLight:RectAreaLight,RedFormat:RedFormat,RedIntegerFormat:RedIntegerFormat,ReinhardToneMapping:ReinhardToneMapping,RepeatWrapping:RepeatWrapping$2,ReplaceStencilOp:ReplaceStencilOp,ReverseSubtractEquation:ReverseSubtractEquation,RingBufferGeometry:RingBufferGeometry,RingGeometry:RingGeometry,Scene:Scene,SceneUtils:SceneUtils,ShaderChunk:ShaderChunk,ShaderLib:ShaderLib,ShaderMaterial:ShaderMaterial$c,ShadowMaterial:ShadowMaterial,Shape:Shape,ShapeBufferGeometry:ShapeBufferGeometry,ShapeGeometry:ShapeGeometry,ShapePath:ShapePath,ShapeUtils:ShapeUtils,ShortType:ShortType,Skeleton:Skeleton,SkeletonHelper:SkeletonHelper,SkinnedMesh:SkinnedMesh,SmoothShading:SmoothShading,Sphere:Sphere,SphereBufferGeometry:SphereBufferGeometry,SphereGeometry:SphereGeometry,Spherical:Spherical,SphericalHarmonics3:SphericalHarmonics3,SphericalReflectionMapping:SphericalReflectionMapping,Spline:Spline,SplineCurve:SplineCurve,SplineCurve3:SplineCurve3,SpotLight:SpotLight,SpotLightHelper:SpotLightHelper,SpotLightShadow:SpotLightShadow,Sprite:Sprite,SpriteMaterial:SpriteMaterial,SrcAlphaFactor:SrcAlphaFactor,SrcAlphaSaturateFactor:SrcAlphaSaturateFactor,SrcColorFactor:SrcColorFactor,StaticCopyUsage:StaticCopyUsage,StaticDrawUsage:StaticDrawUsage,StaticReadUsage:StaticReadUsage,StereoCamera:StereoCamera,StreamCopyUsage:StreamCopyUsage,StreamDrawUsage:StreamDrawUsage,StreamReadUsage:StreamReadUsage,StringKeyframeTrack:StringKeyframeTrack,SubtractEquation:SubtractEquation,SubtractiveBlending:SubtractiveBlending,TOUCH:TOUCH,TangentSpaceNormalMap:TangentSpaceNormalMap,TetrahedronBufferGeometry:TetrahedronBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TextBufferGeometry:TextBufferGeometry,TextGeometry:TextGeometry,Texture:Texture,TextureLoader:TextureLoader$3,TorusBufferGeometry:TorusBufferGeometry,TorusGeometry:TorusGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,Triangle:Triangle,TriangleFanDrawMode:TriangleFanDrawMode,TriangleStripDrawMode:TriangleStripDrawMode,TrianglesDrawMode:TrianglesDrawMode,TubeBufferGeometry:TubeBufferGeometry,TubeGeometry:TubeGeometry,UVMapping:UVMapping,Uint16Attribute:Uint16Attribute,Uint16BufferAttribute:Uint16BufferAttribute,Uint32Attribute:Uint32Attribute,Uint32BufferAttribute:Uint32BufferAttribute,Uint8Attribute:Uint8Attribute,Uint8BufferAttribute:Uint8BufferAttribute,Uint8ClampedAttribute:Uint8ClampedAttribute,Uint8ClampedBufferAttribute:Uint8ClampedBufferAttribute,Uncharted2ToneMapping:Uncharted2ToneMapping,Uniform:Uniform,UniformsLib:UniformsLib,UniformsUtils:UniformsUtils,UnsignedByteType:UnsignedByteType,UnsignedInt248Type:UnsignedInt248Type,UnsignedIntType:UnsignedIntType,UnsignedShort4444Type:UnsignedShort4444Type,UnsignedShort5551Type:UnsignedShort5551Type,UnsignedShort565Type:UnsignedShort565Type,UnsignedShortType:UnsignedShortType,VSMShadowMap:VSMShadowMap,Vector2:Vector2$3,Vector3:Vector3$1,Vector4:Vector4,VectorKeyframeTrack:VectorKeyframeTrack,Vertex:Vertex,VertexColors:VertexColors,VideoTexture:VideoTexture,WebGLMultisampleRenderTarget:WebGLMultisampleRenderTarget,WebGLRenderTarget:WebGLRenderTarget,WebGLRenderTargetCube:WebGLRenderTargetCube,WebGLRenderer:WebGLRenderer,WebGLUtils:WebGLUtils,WireframeGeometry:WireframeGeometry,WireframeHelper:WireframeHelper,WrapAroundEnding:WrapAroundEnding,XHRLoader:XHRLoader,ZeroCurvatureEnding:ZeroCurvatureEnding,ZeroFactor:ZeroFactor,ZeroSlopeEnding:ZeroSlopeEnding,ZeroStencilOp:ZeroStencilOp,sRGBEncoding:sRGBEncoding}),sipsdThreeMin=createCommonjsModule((function(t,e){t.exports=function(t){const e=1024e3,r=e,n=e/(6378137*Math.PI*2),i=Math.PI/180,a=40075e3;let o={prettyPrintMatrix:function(t){for(let e=0;e<4;e++)console.log([t[e],t[e+4],t[e+8],t[e+12]].map((function(t){return t.toFixed(4)})))},makePerspectiveMatrix:function(e,r,n,i){let a=new t.Matrix4,o=1/Math.tan(e/2),s=1/(n-i);return a.elements=[o/r,0,0,0,0,o,0,0,0,0,(i+n)*s,-1,0,0,2*i*n*s,0],a},radify:function(t){function e(t){return t=t||0,2*Math.PI*t/360}return"object"==typeof t?t.length>0?t.map((function(t){return e(t)})):[e(t.x),e(t.y),e(t.z)]:e(t)},degreeify:function(t){function e(t){return 360*(t=t||0)/(2*Math.PI)}return"object"==typeof t?[e(t.x),e(t.y),e(t.z)]:e(t)},projectToWorld:function(e){let r=[-6378137*i*e[0]*n,-6378137*Math.log(Math.tan(.25*Math.PI+.5*i*e[1]))*n];if(e[2]){let t=this.projectedUnitsPerMeter(e[1]);r.push(e[2]*t)}else r.push(0);return new t.Vector3(r[0],r[1],r[2])},projectedUnitsPerMeter:function(t){return Math.abs(r/Math.cos(i*t)/a)},projectedUnitsPerMercator:function(){return Math.abs(r/a)},_scaleVerticesToMeters:function(t,e){var r=this.projectedUnitsPerMeter(t[1]);this.projectToWorld(t);for(let t=0;t<e.length;t++)e[t].multiplyScalar(r);return e},projectToScreen:function(t){console.log("WARNING: Projecting to screen coordinates is not yet implemented")},unprojectFromScreen:function(t){console.log("WARNING: unproject is not yet implemented")},unprojectFromWorld:function(t){let e=[-t.x/(6378137*i*n),2*(Math.atan(Math.exp(t.y/(-6378137*n)))-Math.PI/4)/i],r=this.projectedUnitsPerMeter(e[1]);return e.push((t.z||0)/r),e},_flipMaterialSides:function(t){},normalizeVertices(e){let r=new t.Geometry;for(let t of e)r.vertices.push(t);r.computeBoundingSphere();let n=r.boundingSphere.center;return{vertices:e.map((function(t){return t.sub(n)})),position:n}},flattenVectors(t){let e=[];for(let r of t)e.push(r.x,r.y,r.z);return e},lnglatsToWorld:function(e){return e.map((function(e){let r=o.projectToWorld(e);return new t.Vector3(r.x,r.y,r.z)}))},extend:function(t,e){for(let r in e)t[r]=e[r]},clone:function(t){let e={};for(let r in t)e[r]=t[r];return e},types:{rotation:function(t,e){t="number"==typeof t?{z:t}:Array.isArray(t)?{x:t[0],y:t[1],z:t[2]}:{};let r=this.applyDefault([t.x,t.y,t.z],e);return o.radify(r)},scale:function(t,e){return"number"==typeof t?[t,t,t]:this.applyDefault([t.x,t.y,t.z],e)},applyDefault:function(t,e){return t.map((function(t,r){return t||e[r]}))}},_validate:function(t,e){let r={};o.extend(r,t=t||{});for(let n of Object.keys(e))if(void 0===t[n]){if(null===e[n])return void console.error(n+" is required");r[n]=e[n]}else r[n]=t[n];return r},Validator:new class{constructor(){}Coords(t){if(t.constructor===Array)if(t.length<2)console.error("Coords length must be at least 2");else{for(let e of t)if(e.constructor!==Number)return void console.error("Coords values must be numbers");if(!(Math.abs(t[1])>90))return t;console.error("Latitude must be between -90 and 90")}else console.error("Coords must be an array")}Line(t){let e=this;if(t.constructor===Array){for(let r of t)if(!e.Coords(r))return void console.error("Each coordinate in a line must be a valid Coords type");return t}console.error("Line must be an array")}Rotation(t){if(t.constructor===Number)t={z:t};else{if(t.constructor!==Object)return void console.error("Rotation must be an object or a number");for(let e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Rotation parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual rotation values must be numbers")}}return t}Scale(t){if(t.constructor===Number)t={x:t,y:t,z:t};else{if(t.constructor!==Object)return void console.error("Scale must be an object or a number");for(let e of Object.keys(t)){if(!["x","y","z"].includes(e))return void console.error("Scale parameters must be x, y, or z");if(t[e].constructor!==Number)return void console.error("Individual scale values must be numbers")}}return t}}};class s{constructor(t){this.map=t,this.enrolledObjects=[],this.previousFrameTime=void 0}enroll(e){const r={path:null,duration:1e3,trackHeading:!0};this.enrolledObjects.push(e),e.animationQueue=[],e.set=function(r){if(r.duration>0){let n={start:Date.now(),expiration:Date.now()+r.duration,endState:{}};o.extend(r,n);let i=r.coords,a=r.scale||r.scaleX||r.scaleY||r.scaleZ;if(r.rotation){let t=e.rotation;r.startRotation=[t.x,t.y,t.z],r.endState.rotation=o.types.rotation(r.rotation,r.startRotation),r.rotationPerMs=r.endState.rotation.map((function(t,e){return(t-r.startRotation[e])/r.duration}))}if(a){let t=e.scale;r.startScale=[t.x,t.y,t.z],r.endState.scale=o.types.scale(r.scale,r.startScale),r.scalePerMs=r.endState.scale.map((function(t,e){return(t-r.startScale[e])/r.duration}))}i&&(r.pathCurve=new t.CatmullRomCurve3(o.lnglatsToWorld([e.coordinates,r.coords]))),this.animationQueue.push({type:"set",parameters:r}),map.repaint=!0}else this.stop(),r.rotation=o.radify(r.rotation),this._setObject(r);return this},e.stop=function(){return this.animationQueue=[],this},e.followPath=function(e,n){let i={type:"followPath",parameters:o._validate(e,r)};return o.extend(i.parameters,{pathCurve:new t.CatmullRomCurve3(o.lnglatsToWorld(e.path)),start:Date.now(),expiration:Date.now()+i.parameters.duration,cb:n}),this.animationQueue.push(i),map.repaint=!0,this},e._setObject=function(t){let e=t.position,r=t.rotation,n=t.scale,i=t.worldCoordinates,a=t.quaternion;if(e){this.coordinates=e;let t=o.projectToWorld(e);this.position.copy(t)}r&&this.rotation.set(r[0],r[1],r[2]),n&&this.scale.set(n[0],n[1],n[2]),a&&this.quaternion.setFromAxisAngle(a[0],a[1]),i&&this.position.copy(i),map.repaint=!0}}update(e){void 0===this.previousFrameTime&&(this.previousFrameTime=e);for(let r=this.enrolledObjects.length-1;r>=0;r--){let n=this.enrolledObjects[r];if(!n.animationQueue||0===n.animationQueue.length)continue;let i=n.animationQueue[0],a=i.parameters;if(!a.expiration)return n.animationQueue.splice(0,1),void(n.animationQueue[0]&&(n.animationQueue[0].parameters.start=e));if(e>=a.expiration)a.expiration=!1,a.endState&&n._setObject(a.endState),a.cb();else{let r=(e-a.start)/a.duration;if("set"===i.type){let t={};a.pathCurve&&(t.worldCoordinates=a.pathCurve.getPoint(r)),a.rotationPerMs&&(t.rotation=a.startRotation.map((function(t,e){return t+a.rotationPerMs[e]*r*a.duration}))),a.scalePerMs&&(t.scale=a.startScale.map((function(t,e){return t+a.scalePerMs[e]*r*a.duration}))),n._setObject(t)}if("followPath"===i.type){let e={worldCoordinates:a.pathCurve.getPointAt(r)};if(a.trackHeading){let n=a.pathCurve.getTangentAt(r).normalize(),i=new t.Vector3(0,0,0),o=new t.Vector3(0,1,0);i.crossVectors(o,n).normalize();let s=Math.acos(o.dot(n));e.quaternion=[i,s]}n._setObject(e)}}}this.previousFrameTime=e}}class u{constructor(e,r,n){this.map=e,this.camera=r,this.active=!0,this.camera.matrixAutoUpdate=!1,this.world=n||new t.Group,this.world.position.x=this.world.position.y=512e3,this.world.matrixAutoUpdate=!1,this.state={fov:.6435011087932844,translateCenter:new t.Matrix4,worldSizeRatio:5e-4},this.state.translateCenter.makeTranslation(512e3,-512e3,0);let i=this;this.map.on("move",(function(){i.updateCamera()})).on("resize",(function(){i.setupCamera()})),this.setupCamera()}setupCamera(){let t=this.map.transform;this.state.cameraToCenterDistance=.5/Math.tan(this.state.fov/2)*t.height,this.updateCamera()}updateCamera(e){if(!this.camera)return void console.log("nocamera");let r=this.map.transform;const n=Math.PI/2+r._pitch,i=r.centerOffset,a=this.state.fov*(.5+i.y/r.height),s=r._camera.position[2]*r.worldSize/Math.cos(r._pitch),u=Math.sin(a)*s/Math.sin((l=Math.PI-n-a,c=Math.PI-.01,Math.min(c,Math.max(.01,l))));var l,c;const h=Math.cos(Math.PI/2-r._pitch)*u+s;this._horizonShift=.1;const f=Math.min(1.01*h,s*(1/this._horizonShift));let d=o.makePerspectiveMatrix(this.state.fov,r.width/r.height,r.height/50,f);d.elements[8]=2*-i.x/r.width,d.elements[9]=2*i.y/r.height,this.camera.projectionMatrix=d;let p=new t.Matrix4,m=(new t.Matrix4).makeTranslation(0,0,this.state.cameraToCenterDistance),v=(new t.Matrix4).makeRotationX(r._pitch),g=(new t.Matrix4).makeRotationZ(r.angle);p.premultiply(m).premultiply(v).premultiply(g),this.camera.matrixWorld.copy(p);let y=r.scale*this.state.worldSizeRatio,_=new t.Matrix4,b=(new t.Matrix4,new t.Matrix4),x=new t.Matrix4;_.makeScale(y,y,y),b.makeTranslation(-this.map.transform.x||-this.map.transform.point.x,this.map.transform.y||this.map.transform.point.y,0),x.makeRotationZ(Math.PI),this.world.matrix=new t.Matrix4,this.world.matrix.premultiply(x).premultiply(this.state.translateCenter).premultiply(_).premultiply(b),this.camera.projectionMatrixInverse.getInverse(this.camera.projectionMatrix)}}return class{constructor(t,e,r){this.defaultOptions={defaultLights:!1,passiveRendering:!0},this.version="2.2.4",this._init(t,e,r)}_init(e,r,n){this.map=e,this.renderer=new t.WebGLRenderer({alpha:!0,antialias:!0,canvas:e.getCanvas(),context:r}),this.renderer.shadowMap.enabled=!0,this.renderer.autoClear=!1,this.scene=new t.Scene,this.camera=new t.PerspectiveCamera(28,window.innerWidth/window.innerHeight,1e-12,1/0),this.world=new t.Group,this.scene.add(this.world),this.cameraSync=new u(this.map,this.camera,this.world),this.raycaster=new t.Raycaster,this.options=o._validate(n||{},this.defaultOptions),this.options.defaultLights&&this.defaultLights(),this.animationManager=new s(this.map)}Object3D(e){return function(e,r){return function(e,r){let n=r.obj,i=new t.Group;return function(){if(i.userData=r||{},i.userData.isGeoGroup=!0,n.length)for(let t of n)i.add(t);else i.add(n)}(),function(r,n){{function i(t){return"number"==typeof t&&(t={x:t,y:t,z:t}),t}r.coordinates||(r.coordinates=[0,0,0]),e.enroll(r),r.setCoords=function(t){if("meters"===r.userData.units){let e=o.projectedUnitsPerMeter(t[1]);r.scale.set(e,e,e)}else if("3857"===r.userData.units){let e=o.projectedUnitsPerMeter(t[1]),n=o.projectedUnitsPerMercator(t[1]);r.scale.set(n,n,e)}return r.coordinates=t,r.set({position:t}),r},r.setRotation=function(t){r.updateMatrix(),r.userData.prematrix||(r.userData.prematrix=r.matrix.clone()),t=i(t);let e={x:o.radify(t.x)||0,y:o.radify(t.y)||0,z:o.radify(t.z)||0};r.rotateX(e.x),r.rotateY(e.y),r.rotateZ(e.z)},r.setScale=function(t){r.updateMatrix(),r.userData.prematrix||(r.userData.prematrix=r.matrix.clone());let e={x:((t=i(t)).x||1)*r.scale.x,y:(t.y||1)*r.scale.y,z:(t.z||1)*r.scale.z};r.scale.set(e.x,e.y,e.z)},r.setTranslate=function(e){e=i(e),r.traverse((r=>{r instanceof t.Mesh&&(r.translateX(-1*e.x||0),r.translateY(e.z||0),r.translateZ(e.y||0))}))},r.addFrame=function(e,n){let i=n||1;r.traverse((r=>{if(r instanceof t.Mesh){let n=new t.EdgesGeometry(r.geometry,i),a=new t.LineBasicMaterial({color:e,linewidth:1}),o=new t.LineSegments(n,a);o.renderOrder=1,o.name="EdgesLineFrame",r.add(o)}}))},r.removeFrame=function(){r.traverse((e=>{e instanceof t.LineSegments&&"EdgesLineFrame"===e.name&&e.parent.remove(e)}))},r.showFrame=function(){r.traverse((e=>{e instanceof t.LineSegments&&"EdgesLineFrame"===e.name&&(e.visible=!0)}))},r.hideFrame=function(){r.traverse((e=>{e instanceof t.LineSegments&&"EdgesLineFrame"===e.name&&(e.visible=!1)}))}}}(i),i}(e,r=o._validate(r,{obj:null,units:"scene"}))}(this.animationManager,e)}repaint(){this.map.repaint=!0}projectToWorld(t){return o.projectToWorld(t)}unprojectFromWorld(t){return o.unprojectFromWorld(t)}projectedUnitsPerMeter(t){return o.projectedUnitsPerMeter(t)}projectedUnitsPerMercator(t){return o.projectedUnitsPerMercator(t)}queryRenderedFeatures(e,r){let n=new t.Vector2;n.x=e.x/this.map.transform.width*2-1,n.y=1-e.y/this.map.transform.height*2,this.raycaster.setFromCamera(n,this.camera);let i=[];return i=r?r instanceof Array?this.raycaster.intersectObjects(r,!0):this.raycaster.intersectObject(r,!0):this.raycaster.intersectObjects(this.world.children,!0),i}update(){this.map.repaint&&(this.map.repaint=!1);let t=Date.now();this.animationManager.update(t),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),!1===this.options.passiveRendering&&setTimeout((()=>{this.map.triggerRepaint()}),0)}add(t){this.world.add(t)}remove(t){this.world.remove(t)}defaultLights(){this.scene.add(new t.AmbientLight(16777215));let e=new t.DirectionalLight(16777215,.25);e.position.set(0,8e7,1e8),e.matrixWorldNeedsUpdate=!0,this.world.add(e)}memory(){return this.renderer.info.memory}}}(THREE$1)})),RGBELoader=function(t){DataTextureLoader.call(this,t),this.type=UnsignedByteType};RGBELoader.prototype=Object.assign(Object.create(DataTextureLoader.prototype),{constructor:RGBELoader,parse:function(t){var e=function(t,e){switch(t){case 1:console.error("RGBELoader Read Error: "+(e||""));break;case 2:console.error("RGBELoader Write Error: "+(e||""));break;case 3:console.error("RGBELoader Bad File Format: "+(e||""));break;default:console.error("RGBELoader: Error: "+(e||""))}return-1},r=function(t,e,r){e=e||1024;for(var n=t.pos,i=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));0>(i=s.indexOf("\n"))&&a<e&&n<t.byteLength;)o+=s,a+=s.length,n+=128,s+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<i&&(!1!==r&&(t.pos+=a+i+1),o+s.slice(0,i))},n=function(t,e,r,n){var i=Math.pow(2,t[e+3]-128)/255;r[n+0]=t[e+0]*i,r[n+1]=t[e+1]*i,r[n+2]=t[e+2]*i},i=function(){var t=new Float32Array(1),e=new Int32Array(t.buffer);function r(r){t[0]=r;var n=e[0],i=n>>16&32768,a=n>>12&2047,o=n>>23&255;return o<103?i:o>142?(i|=31744,i|=(255==o?0:1)&&8388607&n):o<113?i|=((a|=2048)>>114-o)+(a>>113-o&1):(i|=o-112<<10|a>>1,i+=1&a)}return function(t,e,n,i){var a=Math.pow(2,t[e+3]-128)/255;n[i+0]=r(t[e+0]*a),n[i+1]=r(t[e+1]*a),n[i+2]=r(t[e+2]*a)}}(),a=new Uint8Array(t);a.pos=0;var o=function(t){var n,i,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(t.pos>=t.byteLength||!(n=r(t)))return e(1,"no header found");if(!(i=n.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(l.valid|=1,l.programtype=i[1],l.string+=n+"\n";!1!==(n=r(t));)if(l.string+=n+"\n","#"!==n.charAt(0)){if((i=n.match(a))&&(l.gamma=parseFloat(i[1],10)),(i=n.match(o))&&(l.exposure=parseFloat(i[1],10)),(i=n.match(s))&&(l.valid|=2,l.format=i[1]),(i=n.match(u))&&(l.valid|=4,l.height=parseInt(i[1],10),l.width=parseInt(i[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=n+"\n";return 2&l.valid?4&l.valid?l:e(3,"missing image size specifier"):e(3,"missing format specifier")}(a);if(-1!==o){var s=o.width,u=o.height,l=function(t,r,n){var i,a,o,s,u,l,c,h,f,d,p,m,v,g=r,y=n;if(g<8||g>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(g!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");if(!(i=new Uint8Array(4*r*n))||!i.length)return e(4,"unable to allocate buffer space");for(a=0,o=0,h=4*g,v=new Uint8Array(4),l=new Uint8Array(h);y>0&&o<t.byteLength;){if(o+4>t.byteLength)return e(1);if(v[0]=t[o++],v[1]=t[o++],v[2]=t[o++],v[3]=t[o++],2!=v[0]||2!=v[1]||(v[2]<<8|v[3])!=g)return e(3,"bad rgbe scanline format");for(c=0;c<h&&o<t.byteLength;){if((m=(s=t[o++])>128)&&(s-=128),0===s||c+s>h)return e(3,"bad scanline data");if(m)for(u=t[o++],f=0;f<s;f++)l[c++]=u;else l.set(t.subarray(o,o+s),c),c+=s,o+=s}for(d=g,f=0;f<d;f++)i[a]=l[f+(p=0)],i[a+1]=l[f+(p+=g)],i[a+2]=l[f+(p+=g)],i[a+3]=l[f+(p+=g)],a+=4;y--}return i}(a.subarray(a.pos),s,u);if(-1!==l){switch(this.type){case UnsignedByteType:var c=l,h=RGBEFormat,f=UnsignedByteType;break;case FloatType:for(var d=l.length/4*3,p=new Float32Array(d),m=0;m<d;m++)n(l,4*m,p,3*m);c=p,h=RGBFormat,f=FloatType;break;case HalfFloatType:d=l.length/4*3;var v=new Uint16Array(d);for(m=0;m<d;m++)i(l,4*m,v,3*m);c=v,h=RGBFormat,f=HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:u,data:c,header:o.string,gamma:o.gamma,exposure:o.exposure,format:h,type:f}}}return null},setDataType:function(t){return this.type=t,this},load:function(t,e,r,n){return DataTextureLoader.prototype.load.call(this,t,(function(t,r){switch(t.type){case UnsignedByteType:t.encoding=RGBEEncoding,t.minFilter=NearestFilter,t.magFilter=NearestFilter,t.generateMipmaps=!1,t.flipY=!0;break;case FloatType:case HalfFloatType:t.encoding=LinearEncoding,t.minFilter=LinearFilter,t.magFilter=LinearFilter,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,r)}),r,n)}});var GLTFLoader=function(){function t(t){Loader.call(this,t),this.dracoLoader=null,this.ddsLoader=null}function e(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(Loader.prototype),{constructor:t,load:function(t,e,r,n){var i,a=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:LoaderUtils.extractUrlBase(t),a.manager.itemStart(t);var o=function(e){n?n(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},s=new FileLoader(a.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),"use-credentials"===a.crossOrigin&&s.setWithCredentials(!0),s.load(t,(function(r){try{a.parse(r,i,(function(r){e(r),a.manager.itemEnd(t)}),o)}catch(t){o(t)}}),r,o)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},parse:function(t,e,f,d){var p,m={};if("string"==typeof t)p=t;else if(LoaderUtils.decodeText(new Uint8Array(t,0,4))===o){try{m[r.KHR_BINARY_GLTF]=new s(t)}catch(t){return void(d&&d(t))}p=m[r.KHR_BINARY_GLTF].content}else p=LoaderUtils.decodeText(new Uint8Array(t));var v=JSON.parse(p);if(void 0===v.asset||v.asset.version[0]<2)d&&d(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{if(v.extensionsUsed)for(var g=0;g<v.extensionsUsed.length;++g){var y=v.extensionsUsed[g],_=v.extensionsRequired||[];switch(y){case r.KHR_LIGHTS_PUNCTUAL:m[y]=new i(v);break;case r.KHR_MATERIALS_UNLIT:m[y]=new a;break;case r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:m[y]=new c;break;case r.KHR_DRACO_MESH_COMPRESSION:m[y]=new u(v,this.dracoLoader);break;case r.MSFT_TEXTURE_DDS:m[y]=new n(this.ddsLoader);break;case r.KHR_TEXTURE_TRANSFORM:m[y]=new l;break;case r.KHR_MESH_QUANTIZATION:m[y]=new h;break;default:_.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new S(v,m,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(f,d)}}});var r={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=r.MSFT_TEXTURE_DDS,this.ddsLoader=t}function i(t){this.name=r.KHR_LIGHTS_PUNCTUAL,this.lightDefs=(t.extensions&&t.extensions[r.KHR_LIGHTS_PUNCTUAL]||{}).lights||[]}function a(){this.name=r.KHR_MATERIALS_UNLIT}i.prototype.loadLight=function(t){var e,r=this.lightDefs[t],n=new Color$c(16777215);void 0!==r.color&&n.fromArray(r.color);var i=void 0!==r.range?r.range:0;switch(r.type){case"directional":(e=new DirectionalLight(n)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new PointLight(n)).distance=i;break;case"spot":(e=new SpotLight(n)).distance=i,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,e.angle=r.spot.outerConeAngle,e.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+r.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==r.intensity&&(e.intensity=r.intensity),e.name=r.name||"light_"+t,Promise.resolve(e)},a.prototype.getMaterialType=function(){return MeshBasicMaterial},a.prototype.extendParams=function(t,e,r){var n=[];t.color=new Color$c(1,1,1),t.opacity=1;var i=e.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){var a=i.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(t,"map",i.baseColorTexture))}return Promise.all(n)};var o="glTF";function s(t){this.name=r.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,12);if(this.header={magic:LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(t,12),i=0;i<n.byteLength;){var a=n.getUint32(i,!0),s=n.getUint32(i+=4,!0);if(i+=4,1313821514===s){var u=new Uint8Array(t,12+i,a);this.content=LoaderUtils.decodeText(u)}else if(5130562===s){var l=12+i;this.body=t.slice(l,l+a)}i+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function u(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=r.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function l(){this.name=r.KHR_TEXTURE_TRANSFORM}function c(){return{name:r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return ShaderMaterial$c},extendParams:function(t,e,r){var n=e.extensions[this.name],i=ShaderLib.standard,a=UniformsUtils.clone(i.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),s=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),u=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),l=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),c=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h=i.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",u).replace("#include <metalnessmap_fragment>",l).replace("#include <lights_physical_fragment>",c);delete a.roughness,delete a.metalness,delete a.roughnessMap,delete a.metalnessMap,a.specular={value:(new Color$c).setHex(1118481)},a.glossiness={value:.5},a.specularMap={value:null},a.glossinessMap={value:null},t.vertexShader=i.vertexShader,t.fragmentShader=h,t.uniforms=a,t.defines={STANDARD:""},t.color=new Color$c(1,1,1),t.opacity=1;var f=[];if(Array.isArray(n.diffuseFactor)){var d=n.diffuseFactor;t.color.fromArray(d),t.opacity=d[3]}if(void 0!==n.diffuseTexture&&f.push(r.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new Color$c(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new Color$c(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var p=n.specularGlossinessTexture;f.push(r.assignTexture(t,"glossinessMap",p)),f.push(r.assignTexture(t,"specularMap",p))}return Promise.all(f)},createMaterial:function(t){var e=new ShaderMaterial$c({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return e.isGLTFSpecularGlossinessMaterial=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e.extensions.derivatives=!0,e},cloneMaterial:function(t){var e=t.clone();e.isGLTFSpecularGlossinessMaterial=!0;for(var r=this.specularGlossinessParams,n=0,i=r.length;n<i;n++){var a=t[r[n]];e[r[n]]=a&&a.isColor?a.clone():a}return e},refreshUniforms:function(t,e,r,n,i){if(!0===i.isGLTFSpecularGlossinessMaterial){var a,o=i.uniforms,s=i.defines;o.opacity.value=i.opacity,o.diffuse.value.copy(i.color),o.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),o.map.value=i.map,o.specularMap.value=i.specularMap,o.alphaMap.value=i.alphaMap,o.lightMap.value=i.lightMap,o.lightMapIntensity.value=i.lightMapIntensity,o.aoMap.value=i.aoMap,o.aoMapIntensity.value=i.aoMapIntensity,i.map?a=i.map:i.specularMap?a=i.specularMap:i.displacementMap?a=i.displacementMap:i.normalMap?a=i.normalMap:i.bumpMap?a=i.bumpMap:i.glossinessMap?a=i.glossinessMap:i.alphaMap?a=i.alphaMap:i.emissiveMap&&(a=i.emissiveMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),o.uvTransform.value.copy(a.matrix)),i.envMap&&(o.envMap.value=i.envMap,o.envMapIntensity.value=i.envMapIntensity,o.flipEnvMap.value=i.envMap.isCubeTexture?-1:1,o.reflectivity.value=i.reflectivity,o.refractionRatio.value=i.refractionRatio,o.maxMipLevel.value=t.properties.get(i.envMap).__maxMipLevel),o.specular.value.copy(i.specular),o.glossiness.value=i.glossiness,o.glossinessMap.value=i.glossinessMap,o.emissiveMap.value=i.emissiveMap,o.bumpMap.value=i.bumpMap,o.normalMap.value=i.normalMap,o.displacementMap.value=i.displacementMap,o.displacementScale.value=i.displacementScale,o.displacementBias.value=i.displacementBias,null!==o.glossinessMap.value&&void 0===s.USE_GLOSSINESSMAP&&(s.USE_GLOSSINESSMAP="",s.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==s.USE_GLOSSINESSMAP&&(delete s.USE_GLOSSINESSMAP,delete s.USE_ROUGHNESSMAP)}}}}function h(){this.name=r.KHR_MESH_QUANTIZATION}function f(t,e,r,n){Interpolant.call(this,t,e,r,n)}u.prototype.decodePrimitive=function(t,e){var r=this.json,n=this.dracoLoader,i=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},s={},u={};for(var l in a){var c=g[l]||l.toLowerCase();o[c]=a[l]}for(l in t.attributes)if(c=g[l]||l.toLowerCase(),void 0!==a[l]){var h=r.accessors[t.attributes[l]];u[c]=d[h.componentType],s[c]=!0===h.normalized}return e.getDependency("bufferView",i).then((function(t){return new Promise((function(e){n.decodeDracoFile(t,(function(t){for(var r in t.attributes){var n=s[r];void 0!==n&&(t.attributes[r].normalized=n)}e(t)}),o,u)}))}))},l.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},(f.prototype=Object.create(Interpolant.prototype)).constructor=f,f.prototype.beforeStart_=f.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n*3+n,a=0;a!==n;a++)e[a]=r[i+a];return e},f.prototype.afterEnd_=f.prototype.copySampleValue_,f.prototype.interpolate_=function(t,e,r,n){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,u=3*o,l=n-e,c=(r-e)/l,h=c*c,f=h*c,d=t*u,p=d-u,m=-2*f+3*h,v=f-h,g=1-m,y=v-h+c,_=0;_!==o;_++)i[_]=g*a[p+_+o]+y*(a[p+_+s]*l)+m*a[d+_+o]+v*(a[d+_]*l);return i};var d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},p={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},m={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping$2},v={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},g={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},_={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},b={"image/png":RGBAFormat,"image/jpeg":RGBFormat};function x(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}function w(t,e,r){for(var n in r.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=r.extensions[n])}function M(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function A(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var r=0,n=e.weights.length;r<n;r++)t.morphTargetInfluences[r]=e.weights[r];if(e.extras&&Array.isArray(e.extras.targetNames)){var i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length)for(t.morphTargetDictionary={},r=0,n=i.length;r<n;r++)t.morphTargetDictionary[i[r]]=r;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function E(t){for(var e="",r=Object.keys(t).sort(),n=0,i=r.length;n<i;n++)e+=r[n]+":"+t[r[n]]+";";return e}function S(t,r,n){this.json=t||{},this.extensions=r||{},this.options=n||{},this.cache=new e,this.primitiveCache={},this.textureLoader=new TextureLoader$3(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function T(t,e,r){var n=e.attributes,i=[];function a(e,n){return r.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(var o in n){var s=g[o]||o.toLowerCase();s in t.attributes||i.push(a(n[o],s))}if(void 0!==e.indices&&!t.index){var u=r.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));i.push(u)}return M(t,e),function(t,e,r){var n=e.attributes,i=new Box3;if(void 0!==n.POSITION){var a=(c=r.json.accessors[n.POSITION]).max;if(void 0!==(h=c.min)&&void 0!==a){i.set(new Vector3$1(h[0],h[1],h[2]),new Vector3$1(a[0],a[1],a[2]));var o=e.targets;if(void 0!==o)for(var s=new Vector3$1,u=0,l=o.length;u<l;u++){var c,h,f=o[u];void 0!==f.POSITION&&(a=(c=r.json.accessors[f.POSITION]).max,void 0!==(h=c.min)&&void 0!==a?(s.setX(Math.max(Math.abs(h[0]),Math.abs(a[0]))),s.setY(Math.max(Math.abs(h[1]),Math.abs(a[1]))),s.setZ(Math.max(Math.abs(h[2]),Math.abs(a[2]))),i.expandByVector(s)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION."))}t.boundingBox=i;var d=new Sphere;i.getCenter(d.center),d.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=d}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,r),Promise.all(i).then((function(){return void 0!==e.targets?function(t,e,r){for(var n=!1,i=!1,a=0,o=e.length;a<o&&(void 0!==(l=e[a]).POSITION&&(n=!0),void 0!==l.NORMAL&&(i=!0),!n||!i);a++);if(!n&&!i)return Promise.resolve(t);var s=[],u=[];for(a=0,o=e.length;a<o;a++){var l=e[a];if(n){var c=void 0!==l.POSITION?r.getDependency("accessor",l.POSITION):t.attributes.position;s.push(c)}i&&(c=void 0!==l.NORMAL?r.getDependency("accessor",l.NORMAL):t.attributes.normal,u.push(c))}return Promise.all([Promise.all(s),Promise.all(u)]).then((function(e){var r=e[1];return n&&(t.morphAttributes.position=e[0]),i&&(t.morphAttributes.normal=r),t.morphTargetsRelative=!0,t}))}(t,e.targets,r):t}))}function C(t,e){var r=t.getIndex();if(null===r){var n=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<i.count;a++)n.push(a);t.setIndex(n),r=t.getIndex()}var o=r.count-2,s=[];if(e===TriangleFanDrawMode)for(a=1;a<=o;a++)s.push(r.getX(0)),s.push(r.getX(a)),s.push(r.getX(a+1));else for(a=0;a<o;a++)a%2==0?(s.push(r.getX(a)),s.push(r.getX(a+1)),s.push(r.getX(a+2))):(s.push(r.getX(a+2)),s.push(r.getX(a+1)),s.push(r.getX(a)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=t.clone();return u.setIndex(s),u}return S.prototype.parse=function(t,e){var r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var a={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:r,userData:{}};w(i,a,n),M(a,n),t(a)})).catch(e)},S.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],r=this.json.meshes||[],n={},i={},a=0,o=e.length;a<o;a++)for(var s=e[a].joints,u=0,l=s.length;u<l;u++)t[s[u]].isBone=!0;for(var c=0,h=t.length;c<h;c++){var f=t[c];void 0!==f.mesh&&(void 0===n[f.mesh]&&(n[f.mesh]=i[f.mesh]=0),n[f.mesh]++,void 0!==f.skin&&(r[f.mesh].isSkinnedMesh=!0))}this.json.meshReferences=n,this.json.meshUses=i},S.prototype.getDependency=function(t,e){var n=t+":"+e,i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this.loadMesh(e);break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this.loadBufferView(e);break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this.loadMaterial(e);break;case"texture":i=this.loadTexture(e);break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;case"light":i=this.extensions[r.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i},S.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var r=this;e=Promise.all((this.json[t+("mesh"===t?"es":"s")]||[]).map((function(e,n){return r.getDependency(t,n)}))),this.cache.add(t,e)}return e},S.prototype.loadBuffer=function(t){var e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[r.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(t,r){n.load(x(e.uri,i.path),t,void 0,(function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},S.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var r=e.byteOffset||0;return t.slice(r,r+(e.byteLength||0))}))},S.prototype.loadAccessor=function(t){var e=this,r=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var i=[];return i.push(void 0!==n.bufferView?this.getDependency("bufferView",n.bufferView):null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then((function(t){var i,a=t[0],o=v[n.type],s=d[n.componentType],u=s.BYTES_PER_ELEMENT,l=n.byteOffset||0,c=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,h=!0===n.normalized;if(c&&c!==u*o){var f=Math.floor(l/c),p="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+f+":"+n.count,m=e.cache.get(p);m||(m=new InterleavedBuffer(new s(a,f*c,n.count*c/u),c/u),e.cache.add(p,m)),i=new InterleavedBufferAttribute(m,o,l%c/u,h)}else i=new BufferAttribute$1(null===a?new s(n.count*o):new s(a,l,n.count*o),o,h);if(void 0!==n.sparse){var g=n.sparse.values.byteOffset||0,y=new(0,d[n.sparse.indices.componentType])(t[1],n.sparse.indices.byteOffset||0,n.sparse.count*v.SCALAR),_=new s(t[2],g,n.sparse.count*o);null!==a&&(i=new BufferAttribute$1(i.array.slice(),i.itemSize,i.normalized));for(var b=0,x=y.length;b<x;b++){var w=y[b];if(i.setX(w,_[b*o]),o>=2&&i.setY(w,_[b*o+1]),o>=3&&i.setZ(w,_[b*o+2]),o>=4&&i.setW(w,_[b*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return i}))},S.prototype.loadTexture=function(t){var e,n=this,i=this.json,a=this.options,o=this.textureLoader,s=window.URL||window.webkitURL,u=i.textures[t],l=u.extensions||{},c=(e=l[r.MSFT_TEXTURE_DDS]?i.images[l[r.MSFT_TEXTURE_DDS].source]:i.images[u.source]).uri,h=!1;return void 0!==e.bufferView&&(c=n.getDependency("bufferView",e.bufferView).then((function(t){h=!0;var r=new Blob([t],{type:e.mimeType});return c=s.createObjectURL(r)}))),Promise.resolve(c).then((function(t){var e=a.manager.getHandler(t);return e||(e=l[r.MSFT_TEXTURE_DDS]?n.extensions[r.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(r,n){e.load(x(t,a.path),r,void 0,n)}))})).then((function(t){!0===h&&s.revokeObjectURL(c),t.flipY=!1,void 0!==u.name&&(t.name=u.name),e.mimeType in b&&(t.format=b[e.mimeType]);var r=(i.samplers||{})[u.sampler]||{};return t.magFilter=p[r.magFilter]||LinearFilter,t.minFilter=p[r.minFilter]||LinearMipmapLinearFilter,t.wrapS=m[r.wrapS]||RepeatWrapping$2,t.wrapT=m[r.wrapT]||RepeatWrapping$2,t}))},S.prototype.assignTexture=function(t,e,n){var i=this;return this.getDependency("texture",n.index).then((function(a){if(!a.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":a.format=RGBFormat}if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[r.KHR_TEXTURE_TRANSFORM]){var o=void 0!==n.extensions?n.extensions[r.KHR_TEXTURE_TRANSFORM]:void 0;o&&(a=i.extensions[r.KHR_TEXTURE_TRANSFORM].extendTexture(a,o))}t[e]=a}))},S.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,i=this.extensions,a=void 0!==e.attributes.tangent,o=void 0!==e.attributes.color,s=void 0===e.attributes.normal,u=!0===t.isSkinnedMesh,l=Object.keys(e.morphAttributes).length>0,c=l&&void 0!==e.morphAttributes.normal;if(t.isPoints){var h=this.cache.get(d="PointsMaterial:"+n.uuid);h||(h=new PointsMaterial,Material.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(d,h)),n=h}else if(t.isLine){var f=this.cache.get(d="LineBasicMaterial:"+n.uuid);f||(f=new LineBasicMaterial,Material.prototype.copy.call(f,n),f.color.copy(n.color),this.cache.add(d,f)),n=f}if(a||o||s||u||l){var d="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(d+="specular-glossiness:"),u&&(d+="skinning:"),a&&(d+="vertex-tangents:"),o&&(d+="vertex-colors:"),s&&(d+="flat-shading:"),l&&(d+="morph-targets:"),c&&(d+="morph-normals:");var p=this.cache.get(d);p||(p=n.isGLTFSpecularGlossinessMaterial?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(n):n.clone(),u&&(p.skinning=!0),a&&(p.vertexTangents=!0),o&&(p.vertexColors=VertexColors),s&&(p.flatShading=!0),l&&(p.morphTargets=!0),c&&(p.morphNormals=!0),this.cache.add(d,p)),n=p}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",new BufferAttribute$1(e.attributes.uv.array,2)),n.isGLTFSpecularGlossinessMaterial&&(t.onBeforeRender=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),n.normalScale&&!a&&(n.normalScale.y=-n.normalScale.y),t.material=n},S.prototype.loadMaterial=function(t){var e,n=this,i=this.extensions,a=this.json.materials[t],o={},s=a.extensions||{},u=[];if(s[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var l=i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=l.getMaterialType(),u.push(l.extendParams(o,a,n))}else if(s[r.KHR_MATERIALS_UNLIT]){var c=i[r.KHR_MATERIALS_UNLIT];e=c.getMaterialType(),u.push(c.extendParams(o,a,n))}else{e=MeshStandardMaterial;var h=a.pbrMetallicRoughness||{};if(o.color=new Color$c(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){var f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}void 0!==h.baseColorTexture&&u.push(n.assignTexture(o,"map",h.baseColorTexture)),o.metalness=void 0!==h.metallicFactor?h.metallicFactor:1,o.roughness=void 0!==h.roughnessFactor?h.roughnessFactor:1,void 0!==h.metallicRoughnessTexture&&(u.push(n.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),u.push(n.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture)))}!0===a.doubleSided&&(o.side=DoubleSide$c);var d=a.alphaMode||"OPAQUE";return"BLEND"===d?o.transparent=!0:(o.transparent=!1,"MASK"===d&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&e!==MeshBasicMaterial&&(u.push(n.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new Vector2$3(1,1),void 0!==a.normalTexture.scale&&o.normalScale.set(a.normalTexture.scale,a.normalTexture.scale)),void 0!==a.occlusionTexture&&e!==MeshBasicMaterial&&(u.push(n.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&e!==MeshBasicMaterial&&(o.emissive=(new Color$c).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&e!==MeshBasicMaterial&&u.push(n.assignTexture(o,"emissiveMap",a.emissiveTexture)),Promise.all(u).then((function(){var t;return t=e===ShaderMaterial$c?i[r.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new e(o),void 0!==a.name&&(t.name=a.name),t.map&&(t.map.encoding=sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=sRGBEncoding),t.specularMap&&(t.specularMap.encoding=sRGBEncoding),M(t,a),a.extensions&&w(i,t,a),t}))},S.prototype.loadGeometries=function(t){var e=this,n=this.extensions,i=this.primitiveCache;function a(t){return n[r.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(r){return T(r,t,e)}))}for(var o,s,u=[],l=0,c=t.length;l<c;l++){var h,f=t[l],d=(s=(o=f).extensions&&o.extensions[r.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+E(s.attributes):o.indices+":"+E(o.attributes)+":"+o.mode,p=i[d];p?u.push(p.promise):(h=f.extensions&&f.extensions[r.KHR_DRACO_MESH_COMPRESSION]?a(f):T(new BufferGeometry$1,f,e),i[d]={primitive:f,promise:h},u.push(h))}return Promise.all(u)},S.prototype.loadMesh=function(t){for(var e,r=this,n=this.json.meshes[t],i=n.primitives,a=[],o=0,s=i.length;o<s;o++){var u=void 0===i[o].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),e.DefaultMaterial):this.getDependency("material",i[o].material);a.push(u)}return a.push(r.loadGeometries(i)),Promise.all(a).then((function(e){for(var a=e.slice(0,e.length-1),o=e[e.length-1],s=[],u=0,l=o.length;u<l;u++){var c,h=o[u],f=i[u],d=a[u];if(4===f.mode||5===f.mode||6===f.mode||void 0===f.mode)!0!==(c=!0===n.isSkinnedMesh?new SkinnedMesh(h,d):new Mesh(h,d)).isSkinnedMesh||c.geometry.attributes.skinWeight.normalized||c.normalizeSkinWeights(),5===f.mode?c.geometry=C(c.geometry,TriangleStripDrawMode):6===f.mode&&(c.geometry=C(c.geometry,TriangleFanDrawMode));else if(1===f.mode)c=new LineSegments(h,d);else if(3===f.mode)c=new Line(h,d);else if(2===f.mode)c=new LineLoop(h,d);else{if(0!==f.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+f.mode);c=new Points(h,d)}Object.keys(c.geometry.morphAttributes).length>0&&A(c,n),c.name=n.name||"mesh_"+t,o.length>1&&(c.name+="_"+u),M(c,n),r.assignFinalMaterial(c),s.push(c)}if(1===s.length)return s[0];var p=new Group;for(u=0,l=s.length;u<l;u++)p.add(s[u]);return p}))},S.prototype.loadCamera=function(t){var e,r=this.json.cameras[t],n=r[r.type];if(n)return"perspective"===r.type?e=new PerspectiveCamera(_Math.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(e=new OrthographicCamera(n.xmag/-2,n.xmag/2,n.ymag/2,n.ymag/-2,n.znear,n.zfar)),void 0!==r.name&&(e.name=r.name),M(e,r),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},S.prototype.loadSkin=function(t){var e=this.json.skins[t],r={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return r.inverseBindMatrices=t,r}))},S.prototype.loadAnimation=function(t){for(var e=this.json.animations[t],r=[],n=[],i=[],a=[],o=[],s=0,u=e.channels.length;s<u;s++){var l=e.channels[s],c=e.samplers[l.sampler],h=l.target,d=void 0!==e.parameters?e.parameters[c.input]:c.input,p=void 0!==e.parameters?e.parameters[c.output]:c.output;r.push(this.getDependency("node",void 0!==h.node?h.node:h.id)),n.push(this.getDependency("accessor",d)),i.push(this.getDependency("accessor",p)),a.push(c),o.push(h)}return Promise.all([Promise.all(r),Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o)]).then((function(r){for(var n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=[],l=0,c=n.length;l<c;l++){var h=n[l],d=i[l],p=a[l],m=o[l],v=s[l];if(void 0!==h){var g;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,y[v.path]){case y.weights:g=NumberKeyframeTrack;break;case y.rotation:g=QuaternionKeyframeTrack;break;default:g=VectorKeyframeTrack}var b=h.name?h.name:h.uuid,x=void 0!==m.interpolation?_[m.interpolation]:InterpolateLinear,w=[];y[v.path]===y.weights?h.traverse((function(t){!0===t.isMesh&&t.morphTargetInfluences&&w.push(t.name?t.name:t.uuid)})):w.push(b);var M=p.array;if(p.normalized){var A;if(M.constructor===Int8Array)A=1/127;else if(M.constructor===Uint8Array)A=1/255;else if(M.constructor==Int16Array)A=1/32767;else{if(M.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");A=1/65535}for(var E=new Float32Array(M.length),S=0,T=M.length;S<T;S++)E[S]=M[S]*A;M=E}for(S=0,T=w.length;S<T;S++){var C=new g(w[S]+"."+y[v.path],d.array,M,x);"CUBICSPLINE"===m.interpolation&&(C.createInterpolant=function(t){return new f(this.times,this.values,this.getValueSize()/3,t)},C.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(C)}}}return new AnimationClip(void 0!==e.name?e.name:"animation_"+t,void 0,u)}))},S.prototype.loadNode=function(t){var e,n=this.json,i=this.extensions,a=this,o=n.meshReferences,s=n.meshUses,u=n.nodes[t];return(e=[],void 0!==u.mesh&&e.push(a.getDependency("mesh",u.mesh).then((function(t){var e;if(o[u.mesh]>1){var r=s[u.mesh]++;(e=t.clone()).name+="_instance_"+r,e.onBeforeRender=t.onBeforeRender;for(var n=0,i=e.children.length;n<i;n++)e.children[n].name+="_instance_"+r,e.children[n].onBeforeRender=t.children[n].onBeforeRender}else e=t;return void 0!==u.weights&&e.traverse((function(t){if(t.isMesh)for(var e=0,r=u.weights.length;e<r;e++)t.morphTargetInfluences[e]=u.weights[e]})),e}))),void 0!==u.camera&&e.push(a.getDependency("camera",u.camera)),u.extensions&&u.extensions[r.KHR_LIGHTS_PUNCTUAL]&&void 0!==u.extensions[r.KHR_LIGHTS_PUNCTUAL].light&&e.push(a.getDependency("light",u.extensions[r.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e)).then((function(t){var e;if((e=!0===u.isBone?new Bone:t.length>1?new Group:1===t.length?t[0]:new Object3D)!==t[0])for(var r=0,n=t.length;r<n;r++)e.add(t[r]);if(void 0!==u.name&&(e.userData.name=u.name,e.name=PropertyBinding.sanitizeNodeName(u.name)),M(e,u),u.extensions&&w(i,e,u),void 0!==u.matrix){var a=new Matrix4$2;a.fromArray(u.matrix),e.applyMatrix(a)}else void 0!==u.translation&&e.position.fromArray(u.translation),void 0!==u.rotation&&e.quaternion.fromArray(u.rotation),void 0!==u.scale&&e.scale.fromArray(u.scale);return e}))},S.prototype.loadScene=function(){function t(e,r,n,i){var a=n.nodes[e];return i.getDependency("node",e).then((function(t){return void 0===a.skin?t:i.getDependency("skin",a.skin).then((function(t){for(var r=[],n=0,a=(e=t).joints.length;n<a;n++)r.push(i.getDependency("node",e.joints[n]));return Promise.all(r)})).then((function(r){return t.traverse((function(t){if(t.isMesh){for(var n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];if(s){n.push(s);var u=new Matrix4$2;void 0!==e.inverseBindMatrices&&u.fromArray(e.inverseBindMatrices.array,16*a),i.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[a])}t.bind(new Skeleton(n,i),t.matrixWorld)}})),t}));var e})).then((function(e){r.add(e);var o=[];if(a.children)for(var s=a.children,u=0,l=s.length;u<l;u++)o.push(t(s[u],e,n,i));return Promise.all(o)}))}return function(e){var r=this.json,n=this.extensions,i=this.json.scenes[e],a=new Scene;void 0!==i.name&&(a.name=i.name),M(a,i),i.extensions&&w(n,a,i);for(var o=i.nodes||[],s=[],u=0,l=o.length;u<l;u++)s.push(t(o[u],a,r,this));return Promise.all(s).then((function(){return a}))}}(),t}(),mod={},l=void 0,aa=mod;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */function r(t,e){var r,n=t.split("."),i=aa;!(n[0]in i)&&i.execScript&&i.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)n.length||e===l?i=i[r]?i[r]:i[r]={}:i[r]=e}var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function v(e){var r,n,i,a,o,s,u,l,c,h,f=e.length,d=0,p=Number.POSITIVE_INFINITY;for(l=0;l<f;++l)e[l]>d&&(d=e[l]),e[l]<p&&(p=e[l]);for(r=1<<d,n=new(t?Uint32Array:Array)(r),i=1,a=0,o=2;i<=d;){for(l=0;l<f;++l)if(e[l]===i){for(s=0,u=a,c=0;c<i;++c)s=s<<1|1&u,u>>=1;for(h=i<<16|l,c=s;c<r;c+=o)n[c]=h;++a}++i,a<<=1,o<<=1}return[n,d,p]}function w(e,r){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=t?new Uint8Array(e):e,this.m=!1,this.i=y,this.r=!1,!r&&(r={})||(r.index&&(this.a=r.index),r.bufferSize&&(this.h=r.bufferSize),r.bufferType&&(this.i=r.bufferType),r.resize&&(this.r=r.resize)),this.i){case A$1:this.b=32768,this.c=new(t?Uint8Array:Array)(32768+this.h+258);break;case y:this.b=0,this.c=new(t?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var A$1=0,y=1,B={t:A$1,s:y};w.prototype.k=function(){for(;!this.m;){var e=C(this,3);switch(1&e&&(this.m=!0),e>>>=1){case 0:var r=this.input,n=this.a,i=this.c,a=this.b,o=r.length,s=l,u=i.length,c=l;if(this.d=this.f=0,n+1>=o)throw Error("invalid uncompressed block header: LEN");if(s=r[n++]|r[n++]<<8,n+1>=o)throw Error("invalid uncompressed block header: NLEN");if(s===~(r[n++]|r[n++]<<8))throw Error("invalid uncompressed block header: length verify");if(n+s>r.length)throw Error("input buffer is broken");switch(this.i){case A$1:for(;a+s>i.length;){if(s-=c=u-a,t)i.set(r.subarray(n,n+c),a),a+=c,n+=c;else for(;c--;)i[a++]=r[n++];this.b=a,i=this.e(),a=this.b}break;case y:for(;a+s>i.length;)i=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(t)i.set(r.subarray(n,n+s),a),a+=s,n+=s;else for(;s--;)i[a++]=r[n++];this.a=n,this.b=a,this.c=i;break;case 1:this.j(ba,ca);break;case 2:var h,f,d,p,m=C(this,5)+257,g=C(this,5)+1,_=C(this,4)+4,b=new(t?Uint8Array:Array)(D.length),x=l,w=l,M=l,A=l,S=l;for(S=0;S<_;++S)b[D[S]]=C(this,3);if(!t)for(S=_,_=b.length;S<_;++S)b[D[S]]=0;for(h=v(b),x=new(t?Uint8Array:Array)(m+g),S=0,p=m+g;S<p;)switch(w=E(this,h),w){case 16:for(A=3+C(this,2);A--;)x[S++]=M;break;case 17:for(A=3+C(this,3);A--;)x[S++]=0;M=0;break;case 18:for(A=11+C(this,7);A--;)x[S++]=0;M=0;break;default:M=x[S++]=w}f=v(t?x.subarray(0,m):x.slice(0,m)),d=v(t?x.subarray(m):x.slice(m)),this.j(f,d);break;default:throw Error("unknown BTYPE: "+e)}}return this.n()};var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=t?new Uint16Array(G):G,H=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],I$1=t?new Uint16Array(H):H,J=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],K=t?new Uint8Array(J):J,L=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],da=t?new Uint16Array(L):L,ea=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=t?new Uint8Array(ea):ea,O$1=new(t?Uint8Array:Array)(288),P,fa;for(P=0,fa=O$1.length;P<fa;++P)O$1[P]=143>=P?8:255>=P?9:279>=P?7:8;var ba=v(O$1),Q=new(t?Uint8Array:Array)(30),R,ga;for(R=0,ga=Q.length;R<ga;++R)Q[R]=5;var ca=v(Q);function C(t,e){for(var r,n=t.f,i=t.d,a=t.input,o=t.a,s=a.length;i<e;){if(o>=s)throw Error("input buffer is broken");n|=a[o++]<<i,i+=8}return r=n&(1<<e)-1,t.f=n>>>e,t.d=i-e,t.a=o,r}function E(t,e){for(var r,n,i=t.f,a=t.d,o=t.input,s=t.a,u=o.length,l=e[0],c=e[1];a<c&&!(s>=u);)i|=o[s++]<<a,a+=8;if((n=(r=l[i&(1<<c)-1])>>>16)>a)throw Error("invalid code length: "+n);return t.f=i>>n,t.d=a-n,t.a=s,65535&r}function W(t,e){var r,n;if(this.input=t,this.a=0,!e&&(e={})||(e.index&&(this.a=e.index),e.verify&&(this.A=e.verify)),r=t[this.a++],n=t[this.a++],(15&r)!==ha)throw Error("unsupported compression method");if(this.method=ha,0!=((r<<8)+n)%31)throw Error("invalid fcheck flag:"+((r<<8)+n)%31);if(32&n)throw Error("fdict flag is not supported");this.q=new w(t,{index:this.a,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}w.prototype.j=function(t,e){var r=this.c,n=this.b;this.o=t;for(var i,a,o,s,u=r.length-258;256!==(i=E(this,t));)if(256>i)n>=u&&(this.b=n,r=this.e(),n=this.b),r[n++]=i;else for(s=I$1[a=i-257],0<K[a]&&(s+=C(this,K[a])),i=E(this,e),o=da[i],0<N[i]&&(o+=C(this,N[i])),n>=u&&(this.b=n,r=this.e(),n=this.b);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},w.prototype.w=function(t,e){var r=this.c,n=this.b;this.o=t;for(var i,a,o,s,u=r.length;256!==(i=E(this,t));)if(256>i)n>=u&&(u=(r=this.e()).length),r[n++]=i;else for(s=I$1[a=i-257],0<K[a]&&(s+=C(this,K[a])),i=E(this,e),o=da[i],0<N[i]&&(o+=C(this,N[i])),n+s>u&&(u=(r=this.e()).length);s--;)r[n]=r[n++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=n},w.prototype.e=function(){var e,r,n=new(t?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(t)n.set(a.subarray(32768,n.length));else for(e=0,r=n.length;e<r;++e)n[e]=a[e+32768];if(this.g.push(n),this.l+=n.length,t)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},w.prototype.z=function(e){var r,n,i,a=this.input.length/this.a+1|0,o=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),n=2>a?(i=(this.input.length-this.a)/this.o[2]/2*258|0)<o.length?o.length+i:o.length<<1:o.length*a,t?(r=new Uint8Array(n)).set(o):r=o,this.c=r},w.prototype.n=function(){var e,r,n,i,a,o=0,s=this.c,u=this.g,l=new(t?Uint8Array:Array)(this.l+(this.b-32768));if(0===u.length)return t?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(r=0,n=u.length;r<n;++r)for(i=0,a=(e=u[r]).length;i<a;++i)l[o++]=e[i];for(r=32768,n=this.b;r<n;++r)l[o++]=s[r];return this.g=[],this.buffer=l},w.prototype.v=function(){var e,r=this.b;return t?this.r?(e=new Uint8Array(r)).set(this.c.subarray(0,r)):e=this.c.subarray(0,r):(this.c.length>r&&(this.c.length=r),e=this.c),this.buffer=e},W.prototype.k=function(){var t,e,r=this.input;if(t=this.q.k(),this.a=this.q.a,this.A){e=(r[this.a++]<<24|r[this.a++]<<16|r[this.a++]<<8|r[this.a++])>>>0;var n=t;if("string"==typeof n){var i,a,o=n.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;n=o}for(var s,u=1,l=0,c=n.length,h=0;0<c;){c-=s=1024<c?1024:c;do{l+=u+=n[h++]}while(--s);u%=65521,l%=65521}if(e!==(l<<16|u)>>>0)throw Error("invalid adler-32 checksum")}return t};var ha=8;r("Zlib.Inflate",W),r("Zlib.Inflate.prototype.decompress",W.prototype.k);var X={ADAPTIVE:B.s,BLOCK:B.t},Y,Z$1,$,ia;if(Object.keys)Y=Object.keys(X);else for(Z$1 in Y=[],$=0,X)Y[$++]=Z$1;for($=0,ia=Y.length;$<ia;++$)Z$1=Y[$],r("Zlib.Inflate.BufferType."+Z$1,X[Z$1]);var Zlib=mod.Zlib,NURBSUtils={findSpan:function(t,e,r){var n=r.length-t-1;if(e>=r[n])return n-1;if(e<=r[t])return t;for(var i=t,a=n,o=Math.floor((i+a)/2);e<r[o]||e>=r[o+1];)e<r[o]?a=o:i=o,o=Math.floor((i+a)/2);return o},calcBasisFunctions:function(t,e,r,n){var i=[],a=[],o=[];i[0]=1;for(var s=1;s<=r;++s){a[s]=e-n[t+1-s],o[s]=n[t+s]-e;for(var u=0,l=0;l<s;++l){var c=o[l+1],h=a[s-l],f=i[l]/(c+h);i[l]=u+c*f,u=h*f}i[s]=u}return i},calcBSplinePoint:function(t,e,r,n){for(var i=this.findSpan(t,n,e),a=this.calcBasisFunctions(i,n,t,e),o=new Vector4(0,0,0,0),s=0;s<=t;++s){var u=r[i-t+s],l=a[s],c=u.w*l;o.x+=u.x*c,o.y+=u.y*c,o.z+=u.z*c,o.w+=u.w*l}return o},calcBasisFunctionDerivatives:function(t,e,r,n,i){for(var a=[],o=0;o<=r;++o)a[o]=0;var s=[];for(o=0;o<=n;++o)s[o]=a.slice(0);var u=[];for(o=0;o<=r;++o)u[o]=a.slice(0);u[0][0]=1;for(var l=a.slice(0),c=a.slice(0),h=1;h<=r;++h){l[h]=e-i[t+1-h],c[h]=i[t+h]-e;for(var f=0,d=0;d<h;++d){var p=c[d+1],m=l[h-d];u[h][d]=p+m;var v=u[d][h-1]/u[h][d];u[d][h]=f+p*v,f=m*v}u[h][h]=f}for(h=0;h<=r;++h)s[0][h]=u[h][r];for(d=0;d<=r;++d){var g=0,y=1,_=[];for(o=0;o<=r;++o)_[o]=a.slice(0);_[0][0]=1;for(var b=1;b<=n;++b){var x=0,w=d-b,M=r-b;d>=b&&(_[y][0]=_[g][0]/u[M+1][w],x=_[y][0]*u[w][M]);var A=d-1<=M?b-1:r-d;for(h=w>=-1?1:-w;h<=A;++h)_[y][h]=(_[g][h]-_[g][h-1])/u[M+1][w+h],x+=_[y][h]*u[w+h][M];d<=M&&(_[y][b]=-_[g][b-1]/u[M+1][d],x+=_[y][b]*u[d][M]),s[b][d]=x,h=g,g=y,y=h}}for(d=r,b=1;b<=n;++b){for(h=0;h<=r;++h)s[b][h]*=d;d*=r-b}return s},calcBSplineDerivatives:function(t,e,r,n,i){for(var a=i<t?i:t,o=[],s=this.findSpan(t,n,e),u=this.calcBasisFunctionDerivatives(s,n,t,a,e),l=[],c=0;c<r.length;++c){var h=(d=r[c].clone()).w;d.x*=h,d.y*=h,d.z*=h,l[c]=d}for(var f=0;f<=a;++f){for(var d=l[s-t].clone().multiplyScalar(u[f][0]),p=1;p<=t;++p)d.add(l[s-t+p].clone().multiplyScalar(u[f][p]));o[f]=d}for(f=a+1;f<=i+1;++f)o[f]=new Vector4(0,0,0);return o},calcKoverI:function(t,e){for(var r=1,n=2;n<=t;++n)r*=n;var i=1;for(n=2;n<=e;++n)i*=n;for(n=2;n<=t-e;++n)i*=n;return r/i},calcRationalCurveDerivatives:function(t){for(var e=t.length,r=[],n=[],i=0;i<e;++i){var a=t[i];r[i]=new Vector3$1(a.x,a.y,a.z),n[i]=a.w}for(var o=[],s=0;s<e;++s){var u=r[s].clone();for(i=1;i<=s;++i)u.sub(o[s-i].clone().multiplyScalar(this.calcKoverI(s,i)*n[i]));o[s]=u.divideScalar(n[0])}return o},calcNURBSDerivatives:function(t,e,r,n,i){var a=this.calcBSplineDerivatives(t,e,r,n,i);return this.calcRationalCurveDerivatives(a)},calcSurfacePoint:function(t,e,r,n,i,a,o,s){for(var u=this.findSpan(t,a,r),l=this.findSpan(e,o,n),c=this.calcBasisFunctions(u,a,t,r),h=this.calcBasisFunctions(l,o,e,n),f=[],d=0;d<=e;++d){f[d]=new Vector4(0,0,0,0);for(var p=0;p<=t;++p){var m=i[u-t+p][l-e+d].clone(),v=m.w;m.x*=v,m.y*=v,m.z*=v,f[d].add(m.multiplyScalar(c[p]))}}var g=new Vector4(0,0,0,0);for(d=0;d<=e;++d)g.add(f[d].multiplyScalar(h[d]));g.divideScalar(g.w),s.set(g.x,g.y,g.z)}},NURBSCurve=function(t,e,r,n,i){Curve.call(this),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=i||this.knots.length-1;for(var a=0;a<r.length;++a){var o=r[a];this.controlPoints[a]=new Vector4(o.x,o.y,o.z,o.w)}};NURBSCurve.prototype=Object.create(Curve.prototype),NURBSCurve.prototype.constructor=NURBSCurve,NURBSCurve.prototype.getPoint=function(t){var e=NURBSUtils.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!=e.w&&e.divideScalar(e.w),new Vector3$1(e.x,e.y,e.z)},NURBSCurve.prototype.getTangent=function(t){var e=NURBSUtils.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),1)[1].clone();return e.normalize(),e};var FBXLoader=function(){var t,e,r;function n(t){Loader.call(this,t)}function i(t,e){this.textureLoader=t,this.manager=e}function a(){}function o(){}function s(){}function u(){}function l(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e}function c(){}function h(t){var e=t.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function f(t){return t/46186158e3}n.prototype=Object.assign(Object.create(Loader.prototype),{constructor:n,load:function(t,e,r,n){var i=this,a=""===i.path?LoaderUtils.extractUrlBase(t):i.path,o=new FileLoader(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.load(t,(function(r){try{e(i.parse(r,a))}catch(e){setTimeout((function(){n&&n(e),i.manager.itemError(t)}),0)}}),r,n)},parse:function(e,r){if((a=e).byteLength>=(o="Kaydara FBX Binary  \0").length&&o===b(a,0,o.length))t=(new u).parse(e);else{var n=b(e);if(!function(t){for(var e,r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0,i=0;i<r.length;++i)if(void 0,e=t[1-1],t=t.slice(n+1),n++,e===r[i])return!1;return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(h(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+h(n));t=(new s).parse(n)}var a,o;return new i(new TextureLoader$3(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),this.manager).parse(t)}}),i.prototype={constructor:i,parse:function(){e=this.parseConnections();var t=this.parseImages(),n=this.parseTextures(t),i=this.parseMaterials(n),o=this.parseDeformers(),s=(new a).parse(o);return this.parseScene(o,s,i),r},parseConnections:function(){var e=new Map;return"Connections"in t&&t.Connections.connections.forEach((function(t){var r=t[0],n=t[1],i=t[2];e.has(r)||e.set(r,{parents:[],children:[]});var a={ID:n,relationship:i};e.get(r).parents.push(a),e.has(n)||e.set(n,{parents:[],children:[]});var o={ID:r,relationship:i};e.get(n).children.push(o)})),e},parseImages:function(){var e={},r={};if("Video"in t.Objects){var n=t.Objects.Video;for(var i in n){var a=n[i];if(e[s=parseInt(i)]=a.RelativeFilename||a.Filename,"Content"in a&&(a.Content instanceof ArrayBuffer&&a.Content.byteLength>0||"string"==typeof a.Content&&""!==a.Content)){var o=this.parseImage(n[i]);r[a.RelativeFilename||a.Filename]=o}}}for(var s in e){var u=e[s];e[s]=void 0!==r[u]?r[u]:e[s].split("\\").pop()}return e},parseImage:function(t){var e,r=t.Content,n=t.RelativeFilename||t.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":e="image/bmp";break;case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;case"tif":e="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),e="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof r)return"data:"+e+";base64,"+r;var a=new Uint8Array(r);return window.URL.createObjectURL(new Blob([a],{type:e}))},parseTextures:function(e){var r=new Map;if("Texture"in t.Objects){var n=t.Objects.Texture;for(var i in n){var a=this.parseTexture(n[i],e);r.set(parseInt(i),a)}}return r},parseTexture:function(t,e){var r=this.loadTexture(t,e);r.ID=t.id,r.name=t.attrName;var n=t.WrapModeU,i=t.WrapModeV,a=void 0!==i?i.value:0;if(r.wrapS=0===(void 0!==n?n.value:0)?RepeatWrapping$2:ClampToEdgeWrapping,r.wrapT=0===a?RepeatWrapping$2:ClampToEdgeWrapping,"Scaling"in t){var o=t.Scaling.value;r.repeat.x=o[0],r.repeat.y=o[1]}return r},loadTexture:function(t,r){var n,i,a=this.textureLoader.path,o=e.get(t.id).children;void 0!==o&&o.length>0&&void 0!==r[o[0].ID]&&(0!==(n=r[o[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var s=t.FileName.slice(-3).toLowerCase();if("tga"===s){var u=this.manager.getHandler(".tga");null===u?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),i=new Texture):i=u.load(n)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),i=new Texture):i=this.textureLoader.load(n);return this.textureLoader.setPath(a),i},parseMaterials:function(e){var r=new Map;if("Material"in t.Objects){var n=t.Objects.Material;for(var i in n){var a=this.parseMaterial(n[i],e);null!==a&&r.set(parseInt(i),a)}}return r},parseMaterial:function(t,r){var n=t.id,i=t.attrName,a=t.ShadingModel;if("object"==typeof a&&(a=a.value),!e.has(n))return null;var o,s=this.parseParameters(t,r,n);switch(a.toLowerCase()){case"phong":o=new MeshPhongMaterial;break;case"lambert":o=new MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new MeshPhongMaterial}return o.setValues(s),o.name=i,o},parseParameters:function(t,r,n){var i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=(new Color$c).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(i.color=(new Color$c).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=(new Color$c).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(i.emissive=(new Color$c).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=(new Color$c).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(i.specular=(new Color$c).fromArray(t.SpecularColor.value));var a=this;return e.get(n).children.forEach((function(t){var e=t.relationship;switch(e){case"Bump":i.bumpMap=a.getTexture(r,t.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(r,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(r,t.ID),i.map.encoding=sRGBEncoding;break;case"DisplacementColor":i.displacementMap=a.getTexture(r,t.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(r,t.ID),i.emissiveMap.encoding=sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(r,t.ID);break;case"ReflectionColor":i.envMap=a.getTexture(r,t.ID),i.envMap.mapping=EquirectangularReflectionMapping,i.envMap.encoding=sRGBEncoding;break;case"SpecularColor":i.specularMap=a.getTexture(r,t.ID),i.specularMap.encoding=sRGBEncoding;break;case"TransparentColor":i.alphaMap=a.getTexture(r,t.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",e)}})),i},getTexture:function(r,n){return"LayeredTexture"in t.Objects&&n in t.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=e.get(n).children[0].ID),r.get(n)},parseDeformers:function(){var r={},n={};if("Deformer"in t.Objects){var i=t.Objects.Deformer;for(var a in i){var o=i[a],s=e.get(parseInt(a));if("Skin"===o.attrType){var u=this.parseSkeleton(s,i);u.ID=a,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=s.parents[0].ID,r[a]=u}else if("BlendShape"===o.attrType){var l={id:a};l.rawTargets=this.parseMorphTargets(s,i),l.id=a,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),n[a]=l}}}return{skeletons:r,morphTargets:n}},parseSkeleton:function(t,e){var r=[];return t.children.forEach((function(t){var n=e[t.ID];if("Cluster"===n.attrType){var i={ID:t.ID,indices:[],weights:[],transformLink:(new Matrix4$2).fromArray(n.TransformLink.a)};"Indexes"in n&&(i.indices=n.Indexes.a,i.weights=n.Weights.a),r.push(i)}})),{rawBones:r,bones:[]}},parseMorphTargets:function(t,r){for(var n=[],i=0;i<t.children.length;i++){var a=t.children[i],o=r[a.ID],s={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if("BlendShapeChannel"!==o.attrType)return;s.geoID=e.get(parseInt(a.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,n.push(s)}return n},parseScene:function(n,i,a){r=new Group;var s=this.parseModels(n.skeletons,i,a),u=t.Objects.Model,l=this;s.forEach((function(t){l.setLookAtProperties(t,u[t.ID]),e.get(t.ID).parents.forEach((function(e){var r=s.get(e.ID);void 0!==r&&r.add(t)})),null===t.parent&&r.add(t)})),this.bindSkeleton(n.skeletons,i,s),this.createAmbientLight(),this.setupMorphMaterials(),r.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrixWorld=t.parent.matrix);var e=g(t.userData.transformData);t.applyMatrix(e)}}));var c=(new o).parse();1===r.children.length&&r.children[0].isGroup&&(r.children[0].animations=c,r=r.children[0]),r.animations=c},parseModels:function(r,n,i){var a=new Map,o=t.Objects.Model;for(var s in o){var u=parseInt(s),l=o[s],c=e.get(u),h=this.buildSkeleton(c,r,u,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,n,i);break;case"NurbsCurve":h=this.createCurve(c,n);break;case"LimbNode":case"Root":h=new Bone;break;default:h=new Group}h.name=l.attrName?PropertyBinding.sanitizeNodeName(l.attrName):"",h.ID=u}this.getTransformData(h,l),a.set(u,h)}return a},buildSkeleton:function(t,e,r,n){var i=null;return t.parents.forEach((function(t){for(var a in e){var o=e[a];o.rawBones.forEach((function(e,a){if(e.ID===t.ID){var s=i;(i=new Bone).matrixWorld.copy(e.transformLink),i.name=n?PropertyBinding.sanitizeNodeName(n):"",i.ID=r,o.bones[a]=i,null!==s&&i.add(s)}}))}})),i},createCamera:function(e){var r,n;if(e.children.forEach((function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)})),void 0===n)r=new Object3D;else{var i=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(i=1);var a=1;void 0!==n.NearPlane&&(a=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,u=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,u=n.AspectHeight.value);var l=s/u,c=45;void 0!==n.FieldOfView&&(c=n.FieldOfView.value);var h=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:r=new PerspectiveCamera(c,l,a,o),null!==h&&r.setFocalLength(h);break;case 1:r=new OrthographicCamera(-s/2,s/2,u/2,-u/2,a,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),r=new Object3D}}return r},createLight:function(e){var r,n;if(e.children.forEach((function(e){var r=t.Objects.NodeAttribute[e.ID];void 0!==r&&(n=r)})),void 0===n)r=new Object3D;else{var i;i=void 0===n.LightType?0:n.LightType.value;var a=16777215;void 0!==n.Color&&(a=(new Color$c).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;switch(void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value),i){case 0:r=new PointLight(a,o,s,1);break;case 1:r=new DirectionalLight(a,o);break;case 2:var u=Math.PI/3;void 0!==n.InnerAngle&&(u=_Math.degToRad(n.InnerAngle.value));var l=0;void 0!==n.OuterAngle&&(l=_Math.degToRad(n.OuterAngle.value),l=Math.max(l,1)),r=new SpotLight(a,o,s,u,l,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new PointLight(a,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r},createMesh:function(t,e,r){var n,i=null,a=null,o=[];return t.children.forEach((function(t){e.has(t.ID)&&(i=e.get(t.ID)),r.has(t.ID)&&o.push(r.get(t.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new MeshPhongMaterial({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(t){t.vertexColors=VertexColors})),i.FBX_Deformer?(o.forEach((function(t){t.skinning=!0})),(n=new SkinnedMesh(i,a)).normalizeSkinWeights()):n=new Mesh(i,a),n},createCurve:function(t,e){return new Line(t.children.reduce((function(t,r){return e.has(r.ID)&&(t=e.get(r.ID)),t}),null),new LineBasicMaterial({color:3342591,linewidth:1}))},getTransformData:function(t,e){var r={};"InheritType"in e&&(r.inheritType=parseInt(e.InheritType.value)),r.eulerOrder="RotationOrder"in e?y(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(r.translation=e.Lcl_Translation.value),"PreRotation"in e&&(r.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(r.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(r.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(r.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(r.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(r.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(r.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(r.rotationPivot=e.RotationPivot.value),t.userData.transformData=r},setLookAtProperties:function(n,i){"LookAtProperty"in i&&e.get(n.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){var i=t.Objects.Model[e.ID];if("Lcl_Translation"in i){var a=i.Lcl_Translation.value;void 0!==n.target?(n.target.position.fromArray(a),r.add(n.target)):n.lookAt((new Vector3$1).fromArray(a))}}}))},bindSkeleton:function(t,r,n){var i=this.parsePoseNodes();for(var a in t){var o=t[a];e.get(parseInt(o.ID)).parents.forEach((function(t){r.has(t.ID)&&e.get(t.ID).parents.forEach((function(t){n.has(t.ID)&&n.get(t.ID).bind(new Skeleton(o.bones),i[t.ID])}))}))}},parsePoseNodes:function(){var e={};if("Pose"in t.Objects){var r=t.Objects.Pose;for(var n in r)if("BindPose"===r[n].attrType){var i=r[n].PoseNode;Array.isArray(i)?i.forEach((function(t){e[t.Node]=(new Matrix4$2).fromArray(t.Matrix.a)})):e[i.Node]=(new Matrix4$2).fromArray(i.Matrix.a)}}return e},createAmbientLight:function(){if("GlobalSettings"in t&&"AmbientColor"in t.GlobalSettings){var e=t.GlobalSettings.AmbientColor.value,n=e[0],i=e[1],a=e[2];if(0!==n||0!==i||0!==a){var o=new Color$c(n,i,a);r.add(new AmbientLight(o,1))}}},setupMorphMaterials:function(){var t=this;r.traverse((function(e){e.isMesh&&e.geometry.morphAttributes.position&&e.geometry.morphAttributes.position.length&&(Array.isArray(e.material)?e.material.forEach((function(r,n){t.setupMorphMaterial(e,r,n)})):t.setupMorphMaterial(e,e.material))}))},setupMorphMaterial:function(t,e,n){var i=t.uuid,a=e.uuid,o=!1;if(r.traverse((function(t){t.isMesh&&(Array.isArray(t.material)?t.material.forEach((function(e){e.uuid===a&&t.uuid!==i&&(o=!0)})):t.material.uuid===a&&t.uuid!==i&&(o=!0))})),!0===o){var s=e.clone();s.morphTargets=!0,void 0===n?t.material=s:t.material[n]=s}else e.morphTargets=!0}},a.prototype={constructor:a,parse:function(r){var n=new Map;if("Geometry"in t.Objects){var i=t.Objects.Geometry;for(var a in i){var o=e.get(parseInt(a)),s=this.parseGeometry(o,i[a],r);n.set(parseInt(a),s)}}return n},parseGeometry:function(t,e,r){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,r);case"NurbsCurve":return this.parseNurbsGeometry(e)}},parseMeshGeometry:function(e,r,n){var i=n.skeletons,a=[],o=e.parents.map((function(e){return t.Objects.Model[e.ID]}));if(0!==o.length){var s=e.children.reduce((function(t,e){return void 0!==i[e.ID]&&(t=i[e.ID]),t}),null);e.children.forEach((function(t){void 0!==n.morphTargets[t.ID]&&a.push(n.morphTargets[t.ID])}));var u=o[0],l={};"RotationOrder"in u&&(l.eulerOrder=y(u.RotationOrder.value)),"InheritType"in u&&(l.inheritType=parseInt(u.InheritType.value)),"GeometricTranslation"in u&&(l.translation=u.GeometricTranslation.value),"GeometricRotation"in u&&(l.rotation=u.GeometricRotation.value),"GeometricScaling"in u&&(l.scale=u.GeometricScaling.value);var c=g(l);return this.genGeometry(r,s,a,c)}},genGeometry:function(t,e,r,n){var i=new BufferGeometry$1;t.attrName&&(i.name=t.attrName);var a=this.parseGeoNode(t,e),o=this.genBuffers(a),s=new Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(n),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new Float32BufferAttribute(o.colors,3)),e&&(i.setAttribute("skinIndex",new Uint16BufferAttribute(o.weightsIndices,4)),i.setAttribute("skinWeight",new Float32BufferAttribute(o.vertexWeights,4)),i.FBX_Deformer=e),o.normal.length>0){var u=(new Matrix3).getNormalMatrix(n),l=new Float32BufferAttribute(o.normal,3);l.applyNormalMatrix(u),i.setAttribute("normal",l)}if(o.uvs.forEach((function(t,e){var r="uv"+(e+1).toString();0===e&&(r="uv"),i.setAttribute(r,new Float32BufferAttribute(o.uvs[e],2))})),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],h=0;if(o.materialIndex.forEach((function(t,e){t!==c&&(i.addGroup(h,e-h,c),c=t,h=e)})),i.groups.length>0){var f=i.groups[i.groups.length-1],d=f.start+f.count;d!==o.materialIndex.length&&i.addGroup(d,o.materialIndex.length-d,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,t,r,n),i},parseGeoNode:function(t,e){var r={};if(r.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],r.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(r.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(r.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(r.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){r.uv=[];for(var n=0;t.LayerElementUV[n];)r.uv.push(this.parseUVs(t.LayerElementUV[n])),n++}return r.weightTable={},null!==e&&(r.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(n,i){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:e,weight:t.weights[i]})}))}))),r},genBuffers:function(t){var e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,n=0,i=!1,a=[],o=[],s=[],u=[],l=[],c=[],h=this;return t.vertexIndices.forEach((function(f,d){var m=!1;f<0&&(f^=-1,m=!0);var v=[],g=[];if(a.push(3*f,3*f+1,3*f+2),t.color){var y=p(d,r,f,t.color);s.push(y[0],y[1],y[2])}if(t.skeleton){if(void 0!==t.weightTable[f]&&t.weightTable[f].forEach((function(t){g.push(t.weight),v.push(t.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var _=[0,0,0,0],b=[0,0,0,0];g.forEach((function(t,e){var r=t,n=v[e];b.forEach((function(t,e,i){if(r>t){i[e]=r,r=t;var a=_[e];_[e]=n,n=a}}))})),v=_,g=b}for(;g.length<4;)g.push(0),v.push(0);for(var x=0;x<4;++x)l.push(g[x]),c.push(v[x])}if(t.normal&&(y=p(d,r,f,t.normal),o.push(y[0],y[1],y[2])),t.material&&"AllSame"!==t.material.mappingType)var w=p(d,r,f,t.material)[0];t.uv&&t.uv.forEach((function(t,e){var n=p(d,r,f,t);void 0===u[e]&&(u[e]=[]),u[e].push(n[0]),u[e].push(n[1])})),n++,m&&(h.genFace(e,t,a,w,o,s,u,l,c,n),r++,n=0,a=[],o=[],s=[],u=[],l=[],c=[])})),e},genFace:function(t,e,r,n,i,a,o,s,u,l){for(var c=2;c<l;c++)t.vertex.push(e.vertexPositions[r[0]]),t.vertex.push(e.vertexPositions[r[1]]),t.vertex.push(e.vertexPositions[r[2]]),t.vertex.push(e.vertexPositions[r[3*(c-1)]]),t.vertex.push(e.vertexPositions[r[3*(c-1)+1]]),t.vertex.push(e.vertexPositions[r[3*(c-1)+2]]),t.vertex.push(e.vertexPositions[r[3*c]]),t.vertex.push(e.vertexPositions[r[3*c+1]]),t.vertex.push(e.vertexPositions[r[3*c+2]]),e.skeleton&&(t.vertexWeights.push(s[0]),t.vertexWeights.push(s[1]),t.vertexWeights.push(s[2]),t.vertexWeights.push(s[3]),t.vertexWeights.push(s[4*(c-1)]),t.vertexWeights.push(s[4*(c-1)+1]),t.vertexWeights.push(s[4*(c-1)+2]),t.vertexWeights.push(s[4*(c-1)+3]),t.vertexWeights.push(s[4*c]),t.vertexWeights.push(s[4*c+1]),t.vertexWeights.push(s[4*c+2]),t.vertexWeights.push(s[4*c+3]),t.weightsIndices.push(u[0]),t.weightsIndices.push(u[1]),t.weightsIndices.push(u[2]),t.weightsIndices.push(u[3]),t.weightsIndices.push(u[4*(c-1)]),t.weightsIndices.push(u[4*(c-1)+1]),t.weightsIndices.push(u[4*(c-1)+2]),t.weightsIndices.push(u[4*(c-1)+3]),t.weightsIndices.push(u[4*c]),t.weightsIndices.push(u[4*c+1]),t.weightsIndices.push(u[4*c+2]),t.weightsIndices.push(u[4*c+3])),e.color&&(t.colors.push(a[0]),t.colors.push(a[1]),t.colors.push(a[2]),t.colors.push(a[3*(c-1)]),t.colors.push(a[3*(c-1)+1]),t.colors.push(a[3*(c-1)+2]),t.colors.push(a[3*c]),t.colors.push(a[3*c+1]),t.colors.push(a[3*c+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(n),t.materialIndex.push(n),t.materialIndex.push(n)),e.normal&&(t.normal.push(i[0]),t.normal.push(i[1]),t.normal.push(i[2]),t.normal.push(i[3*(c-1)]),t.normal.push(i[3*(c-1)+1]),t.normal.push(i[3*(c-1)+2]),t.normal.push(i[3*c]),t.normal.push(i[3*c+1]),t.normal.push(i[3*c+2])),e.uv&&e.uv.forEach((function(e,r){void 0===t.uvs[r]&&(t.uvs[r]=[]),t.uvs[r].push(o[r][0]),t.uvs[r].push(o[r][1]),t.uvs[r].push(o[r][2*(c-1)]),t.uvs[r].push(o[r][2*(c-1)+1]),t.uvs[r].push(o[r][2*c]),t.uvs[r].push(o[r][2*c+1])}))},addMorphTargets:function(e,r,n,i){if(0!==n.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var a=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var o=t.Objects.Geometry[n.geoID];void 0!==o&&a.genMorphGeometry(e,r,o,i,n.name)}))}))}},genMorphGeometry:function(t,e,r,n,i){for(var a=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],s=void 0!==r.Indexes?r.Indexes.a:[],u=new Float32Array(3*t.attributes.position.count),l=0;l<s.length;l++){var c=3*s[l];u[c]=o[3*l],u[c+1]=o[3*l+1],u[c+2]=o[3*l+2]}var h=new Float32BufferAttribute(this.genBuffers({vertexIndices:a,vertexPositions:u}).vertex,3);h.name=i||r.attrName,h.applyMatrix4(n),t.morphAttributes.position.push(h)},parseNormals:function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&("NormalIndex"in t?r=t.NormalIndex.a:"NormalsIndex"in t&&(r=t.NormalsIndex.a)),{dataSize:3,buffer:t.Normals.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}},parseUVs:function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.UVIndex.a),{dataSize:2,buffer:t.UV.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}},parseVertexColors:function(t){var e=t.ReferenceInformationType,r=[];return"IndexToDirect"===e&&(r=t.ColorIndex.a),{dataSize:4,buffer:t.Colors.a,indices:r,mappingType:t.MappingInformationType,referenceType:e}},parseMaterialIndices:function(t){var e=t.MappingInformationType,r=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};for(var n=t.Materials.a,i=[],a=0;a<n.length;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:e,referenceType:r}},parseNurbsGeometry:function(t){if(void 0===NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new BufferGeometry$1;var e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new BufferGeometry$1;for(var r,n,i=e-1,a=t.KnotVector.a,o=[],s=t.Points.a,u=0,l=s.length;u<l;u+=4)o.push((new Vector4).fromArray(s,u));if("Closed"===t.Form)o.push(o[0]);else if("Periodic"===t.Form)for(n=a.length-1-(r=i),u=0;u<i;++u)o.push(o[u]);var c=new NURBSCurve(i,a,o,r,n).getPoints(7*o.length),h=new Float32Array(3*c.length);c.forEach((function(t,e){t.toArray(h,3*e)}));var f=new BufferGeometry$1;return f.setAttribute("position",new BufferAttribute$1(h,3)),f}},o.prototype={constructor:o,parse:function(){var t=[],e=this.parseClips();if(void 0!==e)for(var r in e){var n=this.addClip(e[r]);t.push(n)}return t},parseClips:function(){if(void 0!==t.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var r=this.parseAnimationLayers(e);return this.parseAnimStacks(r)}},parseAnimationCurveNodes:function(){var e=t.Objects.AnimationCurveNode,r=new Map;for(var n in e){var i=e[n];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){var a={id:i.id,attr:i.attrName,curves:{}};r.set(a.id,a)}}return r},parseAnimationCurves:function(r){var n=t.Objects.AnimationCurve;for(var i in n){var a={id:n[i].id,times:n[i].KeyTime.a.map(f),values:n[i].KeyValueFloat.a},o=e.get(a.id);if(void 0!==o){var s=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?r.get(s).curves.x=a:u.match(/Y/)?r.get(s).curves.y=a:u.match(/Z/)?r.get(s).curves.z=a:u.match(/d|DeformPercent/)&&r.has(s)&&(r.get(s).curves.morph=a)}}},parseAnimationLayers:function(n){var i=t.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],u=e.get(parseInt(o));void 0!==u&&(u.children.forEach((function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a]&&void 0!==(d=e.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID)){var u={modelName:(l=t.Objects.Model[d.toString()]).attrName?PropertyBinding.sanitizeNodeName(l.attrName):"",ID:l.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};r.traverse((function(t){t.ID===l.id&&(u.transform=t.matrix,t.userData.transformData&&(u.eulerOrder=t.userData.transformData.eulerOrder))})),u.transform||(u.transform=new Matrix4$2),"PreRotation"in l&&(u.preRotation=l.PreRotation.value),"PostRotation"in l&&(u.postRotation=l.PostRotation.value),s[a]=u}s[a]&&(s[a][o.attr]=o)}else if(void 0!==o.curves.morph){if(void 0===s[a]){var l,c=e.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,h=e.get(c).parents[0].ID,f=e.get(h).parents[0].ID,d=e.get(f).parents[0].ID;u={modelName:(l=t.Objects.Model[d]).attrName?PropertyBinding.sanitizeNodeName(l.attrName):"",morphName:t.Objects.Deformer[c].attrName},s[a]=u}s[a][o.attr]=o}}})),a.set(parseInt(o),s))}return a},parseAnimStacks:function(r){var n=t.Objects.AnimationStack,i={};for(var a in n){var o=e.get(parseInt(a)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=r.get(o[0].ID);i[a]={name:n[a].attrName,layer:s}}return i},addClip:function(t){var e=[],r=this;return t.layer.forEach((function(t){e=e.concat(r.generateTracks(t))})),new AnimationClip(t.name,-1,e)},generateTracks:function(t){var e=[],r=new Vector3$1,n=new Quaternion,i=new Vector3$1;if(t.transform&&t.transform.decompose(r,n,i),r=r.toArray(),n=(new Euler).setFromQuaternion(n,t.eulerOrder).toArray(),i=i.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){var a=this.generateVectorTrack(t.modelName,t.T.curves,r,"position");void 0!==a&&e.push(a)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){var o=this.generateRotationTrack(t.modelName,t.R.curves,n,t.preRotation,t.postRotation,t.eulerOrder);void 0!==o&&e.push(o)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){var s=this.generateVectorTrack(t.modelName,t.S.curves,i,"scale");void 0!==s&&e.push(s)}if(void 0!==t.DeformPercent){var u=this.generateMorphTrack(t);void 0!==u&&e.push(u)}return e},generateVectorTrack:function(t,e,r,n){var i=this.getTimesForAllAxes(e);return new VectorKeyframeTrack(t+"."+n,i,this.getKeyframeTrackValues(i,e,r))},generateRotationTrack:function(t,e,r,n,i,a){void 0!==e.x&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(_Math.degToRad)),void 0!==e.y&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(_Math.degToRad)),void 0!==e.z&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(_Math.degToRad));var o=this.getTimesForAllAxes(e),s=this.getKeyframeTrackValues(o,e,r);void 0!==n&&((n=n.map(_Math.degToRad)).push(a),n=(new Euler).fromArray(n),n=(new Quaternion).setFromEuler(n)),void 0!==i&&((i=i.map(_Math.degToRad)).push(a),i=(new Euler).fromArray(i),i=(new Quaternion).setFromEuler(i).inverse());for(var u=new Quaternion,l=new Euler,c=[],h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],a),u.setFromEuler(l),void 0!==n&&u.premultiply(n),void 0!==i&&u.multiply(i),u.toArray(c,h/3*4);return new QuaternionKeyframeTrack(t+".quaternion",o,c)},generateMorphTrack:function(t){var e=t.DeformPercent.curves.morph,n=e.values.map((function(t){return t/100})),i=r.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+i+"]",e.times,n)},getTimesForAllAxes:function(t){var e=[];return void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})).filter((function(t,e,r){return r.indexOf(t)==e})),e},getKeyframeTrackValues:function(t,e,r){var n=r,i=[],a=-1,o=-1,s=-1;return t.forEach((function(t){if(e.x&&(a=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(s=e.z.times.indexOf(t)),-1!==a){var r=e.x.values[a];i.push(r),n[0]=r}else i.push(n[0]);if(-1!==o){var u=e.y.values[o];i.push(u),n[1]=u}else i.push(n[1]);if(-1!==s){var l=e.z.values[s];i.push(l),n[2]=l}else i.push(n[2])})),i},interpolateRotations:function(t){for(var e=1;e<t.values.length;e++){var r=t.values[e-1],n=t.values[e]-r,i=Math.abs(n);if(i>=180){for(var a=i/180,o=n/a,s=r+o,u=t.times[e-1],l=(t.times[e]-u)/a,c=u+l,h=[],f=[];c<t.times[e];)h.push(c),c+=l,f.push(s),s+=o;t.times=x(t.times,e,h),t.values=x(t.values,e,f)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new c,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=this,r=t.split(/[\r\n]+/);return r.forEach((function(t,n){var i=t.match(/^[\s\t]*;/),a=t.match(/^[\s\t]*$/);if(!i&&!a){var o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),s=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):s?e.parseNodeProperty(t,s,r[++n]):u?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)}})),this.allNodes},parseNodeBegin:function(t,e){var r=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,i):r in o?("PoseNode"===r?o.PoseNode.push(i):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=i)):"number"==typeof a.id?(o[r]={},o[r][a.id]=i):"Properties70"!==r&&(o[r]="PoseNode"===r?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var r="",n="";return t.length>1&&(r=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:r,type:n}},parseNodeProperty:function(t,e,r){var n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),i=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===i&&(i=r.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){var o=i.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),l=i.split(",").slice(3);n="connections",function(t,e){for(var r=0,n=t.length,i=e.length;r<i;r++,n++)t[n]=e[r]}(i=[s,u],l=l.map((function(t){return t.trim().replace(/^"/,"")}))),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=i),n in a&&Array.isArray(a[n])?a[n].push(i):"a"!==n?a[n]=i:a.a=i,this.setCurrentProp(a,n),"a"===n&&","!==i.slice(-1)&&(a.a=_(i))}else this.parseNodeSpecialProperty(t,n,i)},parseNodePropertyContinued:function(t){var e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=_(e.a))},parseNodeSpecialProperty:function(t,e,r){var n=r.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=_(u)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),i)}},u.prototype={constructor:u,parse:function(t){var e=new l(t);e.skip(23);var r=e.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+r);for(var n=new c;!this.endOfContent(e);){var i=this.parseNode(e,r);null!==i&&n.add(i.name,i)}return n},endOfContent:function(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()},parseNode:function(t,e){var r={},n=e>=7500?t.getUint64():t.getUint32(),i=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();var a=t.getUint8(),o=t.getString(a);if(0===n)return null;for(var s=[],u=0;u<i;u++)s.push(this.parseProperty(t));var l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===i&&t.getOffset()===n;n>t.getOffset();){var f=this.parseNode(t,e);null!==f&&this.parseSubNode(o,r,f)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r},parseSubNode:function(t,e,r){if(!0===r.singleProperty){var n=r.propertyList[0];Array.isArray(n)?(e[r.name]=r,r.a=n):e[r.name]=n}else if("Connections"===t&&"C"===r.name){var i=[];r.propertyList.forEach((function(t,e){0!==e&&i.push(t)})),void 0===e.connections&&(e.connections=[]),e.connections.push(i)}else if("Properties70"===r.name)Object.keys(r).forEach((function(t){e[t]=r[t]}));else if("Properties70"===t&&"P"===r.name){var a,o=r.propertyList[0],s=r.propertyList[1],u=r.propertyList[2],l=r.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],e[o]={type:s,type2:u,flag:l,value:a}}else void 0===e[r.name]?"number"==typeof r.id?(e[r.name]={},e[r.name][r.id]=r):e[r.name]=r:"PoseNode"===r.name?(Array.isArray(e[r.name])||(e[r.name]=[e[r.name]]),e[r.name].push(r)):void 0===e[r.name][r.id]&&(e[r.name][r.id]=r)},parseProperty:function(t){var e=t.getString(1);switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":var r=t.getUint32();return t.getArrayBuffer(r);case"S":return r=t.getUint32(),t.getString(r);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=t.getUint32(),i=t.getUint32(),a=t.getUint32();if(0===i)switch(e){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}void 0===Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new l(new Zlib.Inflate(new Uint8Array(t.getArrayBuffer(a))).decompress().buffer);switch(e){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}},l.prototype={constructor:l,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(t){this.offset+=t},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getBoolean());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getInt64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,4294967295==(t=4294967295&~t)&&(e=e+1&4294967295),-(4294967296*e+(t=t+1&4294967295))):4294967296*e+t},getInt64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt64());return e},getUint64:function(){var t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat64());return e},getArrayBuffer:function(t){var e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e},getString:function(t){for(var e=[],r=0;r<t;r++)e[r]=this.getUint8();var n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),LoaderUtils.decodeText(new Uint8Array(e))}},c.prototype={constructor:c,add:function(t,e){this[t]=e}};var d=[];function p(t,e,r,n){var i;switch(n.mappingType){case"ByPolygonVertex":i=t;break;case"ByPolygon":i=e;break;case"ByVertice":i=r;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(i=n.indices[i]);var a=i*n.dataSize;return function(t,e,r,n){for(var i=r,a=0;i<n;i++,a++)t[a]=e[i];return t}(d,n.buffer,a,a+n.dataSize)}var m=new Euler,v=new Vector3$1;function g(t){var e,r=new Matrix4$2,n=new Matrix4$2,i=new Matrix4$2,a=new Matrix4$2,o=new Matrix4$2,s=new Matrix4$2,u=new Matrix4$2,l=new Matrix4$2,c=new Matrix4$2,h=new Matrix4$2,f=new Matrix4$2,d=t.inheritType?t.inheritType:0;t.translation&&r.setPosition(v.fromArray(t.translation)),t.preRotation&&((e=t.preRotation.map(_Math.degToRad)).push(t.eulerOrder),n.makeRotationFromEuler(m.fromArray(e))),t.rotation&&((e=t.rotation.map(_Math.degToRad)).push(t.eulerOrder),i.makeRotationFromEuler(m.fromArray(e))),t.postRotation&&((e=t.postRotation.map(_Math.degToRad)).push(t.eulerOrder),a.makeRotationFromEuler(m.fromArray(e))),t.scale&&o.scale(v.fromArray(t.scale)),t.scalingOffset&&u.setPosition(v.fromArray(t.scalingOffset)),t.scalingPivot&&s.setPosition(v.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(v.fromArray(t.rotationOffset)),t.rotationPivot&&c.setPosition(v.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(h=t.parentMatrixWorld);var p=n.multiply(i).multiply(a),g=new Matrix4$2;h.extractRotation(g);var y,_,b,x,w=new Matrix4$2;if(w.copyPosition(h),b=w.getInverse(w).multiply(h),_=g.getInverse(g).multiply(b),y=o,0===d)x=g.multiply(p).multiply(_).multiply(y);else if(1===d)x=g.multiply(_).multiply(p).multiply(y);else{var M=(new Matrix4$2).copy(o),A=_.multiply(M.getInverse(M));x=g.multiply(p).multiply(A).multiply(y)}var E=r.multiply(l).multiply(c).multiply(n).multiply(i).multiply(a).multiply(c.getInverse(c)).multiply(u).multiply(s).multiply(o).multiply(s.getInverse(s)),S=(new Matrix4$2).copyPosition(E),T=h.multiply(S);return f.copyPosition(T),f.multiply(x)}function y(t){var e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[t]}function _(t){return t.split(",").map((function(t){return parseFloat(t)}))}function b(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.byteLength),LoaderUtils.decodeText(new Uint8Array(t,e,r))}function x(t,e,r){return t.slice(0,e).concat(r).concat(t.slice(e))}return n}(),OBJLoader=function(){var t=/^[og]\s*(.+)?/,e=/^mtllib /,r=/^usemtl /,n=/^usemap /;function i(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);var n={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},r&&r.name&&"function"==typeof r.clone){var n=r.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseNormalIndex:function(t,e){var r=parseInt(t,10);return 3*(r>=0?r-1:r+e/3)},parseUVIndex:function(t,e){var r=parseInt(t,10);return 2*(r>=0?r-1:r+e/2)},addVertex:function(t,e,r){var n=this.vertices,i=this.object.geometry.vertices;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,r){var n=this.normals,i=this.object.geometry.normals;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addColor:function(t,e,r){var n=this.colors,i=this.object.geometry.colors;i.push(n[t+0],n[t+1],n[t+2]),i.push(n[e+0],n[e+1],n[e+2]),i.push(n[r+0],n[r+1],n[r+2])},addUV:function(t,e,r){var n=this.uvs,i=this.object.geometry.uvs;i.push(n[t+0],n[t+1]),i.push(n[e+0],n[e+1]),i.push(n[r+0],n[r+1])},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,r,n,i,a,o,s,u){var l=this.vertices.length,c=this.parseVertexIndex(t,l),h=this.parseVertexIndex(e,l),f=this.parseVertexIndex(r,l);if(this.addVertex(c,h,f),this.colors.length>0&&this.addColor(c,h,f),void 0!==n&&""!==n){var d=this.uvs.length;c=this.parseUVIndex(n,d),h=this.parseUVIndex(i,d),f=this.parseUVIndex(a,d),this.addUV(c,h,f)}if(void 0!==o&&""!==o){var p=this.normals.length;c=this.parseNormalIndex(o,p),h=o===s?c:this.parseNormalIndex(s,p),f=o===u?c:this.parseNormalIndex(u,p),this.addNormal(c,h,f)}},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,r=0,n=t.length;r<n;r++)this.addVertexPoint(this.parseVertexIndex(t[r],e))},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var r=this.vertices.length,n=this.uvs.length,i=0,a=t.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(t[i],r));var o=0;for(a=e.length;o<a;o++)this.addUVLine(this.parseUVIndex(e[o],n))}};return t.startObject("",!1),t}function a(t){Loader.call(this,t),this.materials=null}return a.prototype=Object.assign(Object.create(Loader.prototype),{constructor:a,load:function(t,e,r,n){var i=this,a=new FileLoader(i.manager);a.setPath(this.path),a.load(t,(function(t){e(i.parse(t))}),r,n)},setMaterials:function(t){return this.materials=t,this},parse:function(a){console.time("OBJLoader");var o=new i;-1!==a.indexOf("\r\n")&&(a=a.replace(/\r\n/g,"\n")),-1!==a.indexOf("\\\n")&&(a=a.replace(/\\\n/g,""));for(var s=a.split("\n"),u="",l="",c=[],h="function"==typeof"".trimLeft,f=0,d=s.length;f<d;f++)if(u=s[f],0!==(u=h?u.trimLeft():u.trim()).length&&"#"!==(l=u.charAt(0)))if("v"===l){var p=u.split(/\s+/);switch(p[0]){case"v":o.vertices.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),p.length>=7&&o.colors.push(parseFloat(p[4]),parseFloat(p[5]),parseFloat(p[6]));break;case"vn":o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));break;case"vt":o.uvs.push(parseFloat(p[1]),parseFloat(p[2]))}}else if("f"===l){for(var m=u.substr(1).trim().split(/\s+/),v=[],g=0,y=m.length;g<y;g++){var _=m[g];if(_.length>0){var b=_.split("/");v.push(b)}}var x=v[0];for(g=1,y=v.length-1;g<y;g++){var w=v[g],M=v[g+1];o.addFace(x[0],w[0],M[0],x[1],w[1],M[1],x[2],w[2],M[2])}}else if("l"===l){var A=u.substring(1).trim().split(" "),E=[],S=[];if(-1===u.indexOf("/"))E=A;else for(var T=0,C=A.length;T<C;T++){var O=A[T].split("/");""!==O[0]&&E.push(O[0]),""!==O[1]&&S.push(O[1])}o.addLineGeometry(E,S)}else if("p"===l){var P=u.substr(1).trim().split(" ");o.addPointGeometry(P)}else if(null!==(c=t.exec(u))){var L=(" "+c[0].substr(1).trim()).substr(1);o.startObject(L)}else if(r.test(u))o.object.startMaterial(u.substring(7).trim(),o.materialLibraries);else if(e.test(u))o.materialLibraries.push(u.substring(7).trim());else if(n.test(u))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===l){if((c=u.split(" ")).length>1){var I=c[1].trim().toLowerCase();o.object.smooth="0"!==I&&"off"!==I}else o.object.smooth=!0;($=o.object.currentMaterial())&&($.smooth=o.object.smooth)}else{if("\0"===u)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+u+'"')}o.finalize();var k=new Group;for(k.materialLibraries=[].concat(o.materialLibraries),f=0,d=o.objects.length;f<d;f++){var R=o.objects[f],D=R.geometry,B=R.materials,F="Line"===D.type,j="Points"===D.type,N=!1;if(0!==D.vertices.length){var U=new BufferGeometry$1;U.setAttribute("position",new Float32BufferAttribute(D.vertices,3)),D.normals.length>0?U.setAttribute("normal",new Float32BufferAttribute(D.normals,3)):U.computeVertexNormals(),D.colors.length>0&&(N=!0,U.setAttribute("color",new Float32BufferAttribute(D.colors,3))),D.uvs.length>0&&U.setAttribute("uv",new Float32BufferAttribute(D.uvs,2));for(var z,G=[],V=0,H=B.length;V<H;V++){var W=B[V],$=void 0;if(null!==this.materials)if($=this.materials.create(W.name),!F||!$||$ instanceof LineBasicMaterial){if(j&&$&&!($ instanceof PointsMaterial)){var q=new PointsMaterial({size:10,sizeAttenuation:!1});Material.prototype.copy.call(q,$),q.color.copy($.color),q.map=$.map,$=q}}else{var X=new LineBasicMaterial;Material.prototype.copy.call(X,$),X.color.copy($.color),$=X}$||(($=F?new LineBasicMaterial:j?new PointsMaterial({size:1,sizeAttenuation:!1}):new MeshPhongMaterial).name=W.name),$.flatShading=!W.smooth,$.vertexColors=N?VertexColors:NoColors,G.push($)}if(G.length>1){for(V=0,H=B.length;V<H;V++)U.addGroup((W=B[V]).groupStart,W.groupCount,V);z=F?new LineSegments(U,G):j?new Points(U,G):new Mesh(U,G)}else z=F?new LineSegments(U,G[0]):j?new Points(U,G[0]):new Mesh(U,G[0]);z.name=R.name,k.add(z)}}return console.timeEnd("OBJLoader"),k}}),a}(),MTLLoader=function(t){Loader.call(this,t)};function LoadObj(t){let e,r=t.type;if(r)switch(r){case"obj":e=new Promise(t.mtl?(e,r)=>{(new MTLLoader).load(t.mtl,(function(n){n.preload(),(new OBJLoader).setMaterials(n).load(t.url,e,void 0,r)}),void 0,r)}:(e,r)=>{(new OBJLoader).load(t.url,e)});break;case"gltf":case"glb":e=new Promise((e=>{(new GLTFLoader).load(t.url,e)}));break;case"fbx":e=new Promise((e=>{(new FBXLoader).load(t.url,e)}))}else console.log("缺少模型类型");return e}MTLLoader.prototype=Object.assign(Object.create(Loader.prototype),{constructor:MTLLoader,load:function(t,e,r,n){var i=this,a=""===this.path?LoaderUtils.extractUrlBase(t):this.path,o=new FileLoader(this.manager);o.setPath(this.path),o.load(t,(function(t){e(i.parse(t,a))}),r,n)},setMaterialOptions:function(t){return this.materialOptions=t,this},parse:function(t,e){for(var r=t.split("\n"),n={},i=/\s+/,a={},o=0;o<r.length;o++){var s=r[o];if(0!==(s=s.trim()).length&&"#"!==s.charAt(0)){var u=s.indexOf(" "),l=u>=0?s.substring(0,u):s;l=l.toLowerCase();var c=u>=0?s.substring(u+1):"";if(c=c.trim(),"newmtl"===l)a[c]=n={name:c};else if("ka"===l||"kd"===l||"ks"===l||"ke"===l){var h=c.split(i,3);n[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[l]=c}}var f=new MTLLoader.MaterialCreator(this.resourcePath||e,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(a),f}}),MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:RepeatWrapping$2},MTLLoader.MaterialCreator.prototype={constructor:MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var r in t){var n=t[r],i={};for(var a in e[r]=i,n){var o=!0,s=n[a],u=a.toLowerCase();switch(u){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(o=!1)}o&&(i[u]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){var e=this,r=this.materialsInfo[t],n={name:t,side:this.side};function i(t,r){if(!n[t]){var i,a,o=e.getTextureParams(r,n),s=e.loadTexture((i=e.baseUrl,"string"!=typeof(a=o.url)||""===a?"":/^https?:\/\//i.test(a)?a:i+a));s.repeat.copy(o.scale),s.offset.copy(o.offset),s.wrapS=e.wrap,s.wrapT=e.wrap,n[t]=s}}for(var a in r){var o,s=r[a];if(""!==s)switch(a.toLowerCase()){case"kd":n.color=(new Color$c).fromArray(s);break;case"ks":n.specular=(new Color$c).fromArray(s);break;case"ke":n.emissive=(new Color$c).fromArray(s);break;case"map_kd":i("map",s);break;case"map_ks":i("specularMap",s);break;case"map_ke":i("emissiveMap",s);break;case"norm":i("normalMap",s);break;case"map_bump":case"bump":i("bumpMap",s);break;case"map_d":i("alphaMap",s),n.transparent=!0;break;case"ns":n.shininess=parseFloat(s);break;case"d":(o=parseFloat(s))<1&&(n.opacity=o,n.transparent=!0);break;case"tr":o=parseFloat(s),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(n.opacity=1-o,n.transparent=!0)}}return this.materials[t]=new MeshPhongMaterial(n),this.materials[t]},getTextureParams:function(t,e){var r,n={scale:new Vector2$3(1,1),offset:new Vector2$3(0,0)},i=t.split(/\s+/);return(r=i.indexOf("-bm"))>=0&&(e.bumpScale=parseFloat(i[r+1]),i.splice(r,2)),(r=i.indexOf("-s"))>=0&&(n.scale.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),(r=i.indexOf("-o"))>=0&&(n.offset.set(parseFloat(i[r+1]),parseFloat(i[r+2])),i.splice(r,4)),n.url=i.join(" ").trim(),n},loadTexture:function(t,e,r,n,i){var a,o=void 0!==this.manager?this.manager:DefaultLoadingManager,s=o.getHandler(t);return null===s&&(s=new TextureLoader$3(o)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),a=s.load(t,r,n,i),void 0!==e&&(a.mapping=e),a}};class ModelBaseLayer{constructor(t,e){this.tb=t,this.options=e,this.lightIDs=[],this.lightGroup=new Group,this._init()}_init(){let{tb:t,options:e,lightGroup:r}=this,n=this;e.lights&&(e.lights.forEach((t=>{n.addLight(t)})),t.scene.add(r)),e.exposure&&(t.renderer.toneMappingExposure=e.exposure)}getCamera(){return this.tb.camera}addLight(t){let{lightIDs:e,lightGroup:r}=this;if(!t.id)return void console.error("缺少光源ID");let n=t.id;if(e.indexOf(n)>-1)return void console.error("光源添加失败，光源ID不唯一");let i=this.getLightSetting(t);i&&(i.userData.id=n,r.add(i),e.push(n))}removeLight(t){let{lightIDs:e,lightGroup:r}=this,n=e.indexOf(t);-1!==n?r.traverse((function(i){i.userData.id===t&&(r.remove(i),e.splice(n,1))})):console.warn("光源删除失败，光源ID不存在")}getLightSetting(t){let e;switch(t.type.toLowerCase()){case"ambient":e=new AmbientLight(t.color,t.intensity);break;case"point":e=new PointLight(t.color,t.intensity),e.position.set(...t.position);break;case"spot":e=new SpotLight(t.color,t.intensity),e.position.set(...t.position);break;case"directional":e=new DirectionalLight(t.color,t.intensity),e.position.set(...t.position);break;case"hemisphere":e=new HemisphereLight(t.skyColor,t.groundColor,t.intensity),e.position.set(...t.position)}return e}setVisibility(t){this.tb.scene.visible=t}selectModel(t,e){return this.tb.queryRenderedFeatures(t,e)}setExposure(t){this.tb.renderer.toneMappingExposure=t}}function globals$1(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}var PJD_3PARAM=1,PJD_7PARAM=2,PJD_GRIDSHIFT=3,PJD_WGS84=4,PJD_NODATUM=5,SRS_WGS84_SEMIMAJOR=6378137,SRS_WGS84_SEMIMINOR=6356752.314,SRS_WGS84_ESQUARED=.0066943799901413165,SEC_TO_RAD=484813681109536e-20,HALF_PI=Math.PI/2,SIXTH=.16666666666666666,RA4=.04722222222222222,RA6=.022156084656084655,EPSLN=1e-10,D2R$1=.017453292519943295,R2D=57.29577951308232,FORTPI=Math.PI/4,TWO_PI=2*Math.PI,SPI=3.14159265359,exports$3={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},units={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},ignoredChar=/[\s_\-\/\(\)]/g;function match(t,e){if(t[e])return t[e];for(var r,n=Object.keys(t),i=e.toLowerCase().replace(ignoredChar,""),a=-1;++a<n.length;)if((r=n[a]).toLowerCase().replace(ignoredChar,"")===i)return t[r]}function projStr(t){var e,r,n,i={},a=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,e){var r=e.split("=");return r.push(!0),t[r[0].toLowerCase()]=r[1],t}),{}),o={proj:"projName",datum:"datumCode",rf:function(t){i.rf=parseFloat(t)},lat_0:function(t){i.lat0=t*D2R$1},lat_1:function(t){i.lat1=t*D2R$1},lat_2:function(t){i.lat2=t*D2R$1},lat_ts:function(t){i.lat_ts=t*D2R$1},lon_0:function(t){i.long0=t*D2R$1},lon_1:function(t){i.long1=t*D2R$1},lon_2:function(t){i.long2=t*D2R$1},alpha:function(t){i.alpha=parseFloat(t)*D2R$1},gamma:function(t){i.rectified_grid_angle=parseFloat(t)},lonc:function(t){i.longc=t*D2R$1},x_0:function(t){i.x0=parseFloat(t)},y_0:function(t){i.y0=parseFloat(t)},k_0:function(t){i.k0=parseFloat(t)},k:function(t){i.k0=parseFloat(t)},a:function(t){i.a=parseFloat(t)},b:function(t){i.b=parseFloat(t)},r_a:function(){i.R_A=!0},zone:function(t){i.zone=parseInt(t,10)},south:function(){i.utmSouth=!0},towgs84:function(t){i.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){i.to_meter=parseFloat(t)},units:function(t){i.units=t;var e=match(units,t);e&&(i.to_meter=e.to_meter)},from_greenwich:function(t){i.from_greenwich=t*D2R$1},pm:function(t){var e=match(exports$3,t);i.from_greenwich=(e||parseFloat(t))*D2R$1},nadgrids:function(t){"@null"===t?i.datumCode="none":i.nadgrids=t},axis:function(t){var e="ewnsud";3===t.length&&-1!==e.indexOf(t.substr(0,1))&&-1!==e.indexOf(t.substr(1,1))&&-1!==e.indexOf(t.substr(2,1))&&(i.axis=t)},approx:function(){i.approx=!0}};for(e in a)r=a[e],e in o?"function"==typeof(n=o[e])?n(r):i[n]=r:i[e]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var NEUTRAL=1,KEYWORD=2,NUMBER=3,QUOTED=4,AFTERQUOTE=5,ENDED=-1,whitespace=/\s/,latin=/[A-Za-z]/,keyword=/[A-Za-z84_]/,endThings=/[,\]]/,digets=/[\d\.E\-\+]/;function Parser(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=NEUTRAL}function parseString(t){return new Parser(t).output()}function mapit(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var n=r.reduce((function(t,e){return sExpr(e,t),t}),e?{}:t);e&&(t[e]=n)}function sExpr(t,e){if(Array.isArray(t)){var r=t.shift();if("PARAMETER"===r&&(r=t.shift()),1===t.length)return Array.isArray(t[0])?(e[r]={},void sExpr(t[0],e[r])):void(e[r]=t[0]);if(t.length)if("TOWGS84"!==r){if("AXIS"===r)return r in e||(e[r]=[]),void e[r].push(t);var n;switch(Array.isArray(r)||(e[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[r]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&sExpr(t[2],e[r]));case"SPHEROID":case"ELLIPSOID":return e[r]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&sExpr(t[3],e[r]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void mapit(e,r,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return sExpr(t,e[r]);return mapit(e,r,t)}}else e[r]=t;else e[r]=!0}else e[t]=!0}Parser.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==QUOTED)for(;whitespace.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case NEUTRAL:return this.neutral(t);case KEYWORD:return this.keyword(t);case QUOTED:return this.quoted(t);case AFTERQUOTE:return this.afterquote(t);case NUMBER:return this.number(t);case ENDED:return}},Parser.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=QUOTED);if(endThings.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},Parser.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=NEUTRAL)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=NEUTRAL,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=ENDED))):void 0},Parser.prototype.number=function(t){if(!digets.test(t)){if(endThings.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},Parser.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=AFTERQUOTE},Parser.prototype.keyword=function(t){if(keyword.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=NEUTRAL)}if(!endThings.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},Parser.prototype.neutral=function(t){if(latin.test(t))return this.word=t,void(this.state=KEYWORD);if('"'===t)return this.word="",void(this.state=QUOTED);if(digets.test(t))return this.word=t,void(this.state=NUMBER);if(!endThings.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},Parser.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===ENDED)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var D2R=.017453292519943295;function rename(t,e){var r=e[0],n=e[1];!(r in t)&&n in t&&(t[r]=t[n],3===e.length&&(t[r]=e[2](t[r])))}function d2r(t){return t*D2R}function cleanWKT(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):t.projName="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION,t.AXIS){for(var e="",r=0,n=t.AXIS.length;r<n;++r){var i=[t.AXIS[r][0].toLowerCase(),t.AXIS[r][1].toLowerCase()];-1!==i[0].indexOf("north")||("y"===i[0]||"lat"===i[0])&&"north"===i[1]?e+="n":-1!==i[0].indexOf("south")||("y"===i[0]||"lat"===i[0])&&"south"===i[1]?e+="s":-1!==i[0].indexOf("east")||("x"===i[0]||"lon"===i[0])&&"east"===i[1]?e+="e":-1===i[0].indexOf("west")&&("x"!==i[0]&&"lon"!==i[0]||"west"!==i[1])||(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function o(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(t.datumCode=a.DATUM?a.DATUM.name.toLowerCase():a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",d2r],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",d2r],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",d2r],["lat0","latitude_of_origin",d2r],["lat0","standard_parallel_1",d2r],["lat1","standard_parallel_1",d2r],["lat2","standard_parallel_2",d2r],["azimuth","Azimuth"],["alpha","azimuth",d2r],["srsCode","name"]].forEach((function(e){return rename(t,e)})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=d2r(t.lat1>0?90:-90),t.lat_ts=t.lat1)}function wkt(t){var e=parseString(t),r=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",r]);var i={};return sExpr(e,i),cleanWKT(i),i}function defs(t){var e=this;if(2===arguments.length){var r=arguments[1];defs[t]="string"==typeof r?"+"===r.charAt(0)?projStr(arguments[1]):wkt(arguments[1]):r}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?defs.apply(e,t):defs(t)}));if("string"==typeof t){if(t in defs)return defs[t]}else"EPSG"in t?defs["EPSG:"+t.EPSG]=t:"ESRI"in t?defs["ESRI:"+t.ESRI]=t:"IAU2000"in t?defs["IAU2000:"+t.IAU2000]=t:console.log(t);return}}function testObj(t){return"string"==typeof t}function testDef(t){return t in defs}globals$1(defs);var codeWords=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function testWKT(t){return codeWords.some((function(e){return t.indexOf(e)>-1}))}var codes=["3857","900913","3785","102113"];function checkMercator(t){var e=match(t,"authority");if(e){var r=match(e,"epsg");return r&&codes.indexOf(r)>-1}}function checkProjStr(t){var e=match(t,"extension");if(e)return match(e,"proj4")}function testProj(t){return"+"===t[0]}function parse$1(t){if(!testObj(t))return t;if(testDef(t))return defs[t];if(testWKT(t)){var e=wkt(t);if(checkMercator(e))return defs["EPSG:3857"];var r=checkProjStr(e);return r?projStr(r):e}return testProj(t)?projStr(t):void 0}function extend(t,e){var r,n;if(t=t||{},!e)return t;for(n in e)void 0!==(r=e[n])&&(t[n]=r);return t}function msfnz(t,e,r){var n=t*e;return r/Math.sqrt(1-n*n)}function sign(t){return t<0?-1:1}function adjust_lon(t){return Math.abs(t)<=SPI?t:t-sign(t)*TWO_PI}function tsfnz(t,e,r){var n=t*r;return n=Math.pow((1-n)/(1+n),.5*t),Math.tan(.5*(HALF_PI-e))/n}function phi2z(t,e){for(var r,n,i=.5*t,a=HALF_PI-2*Math.atan(e),o=0;o<=15;o++)if(r=t*Math.sin(a),a+=n=HALF_PI-2*Math.atan(e*Math.pow((1-r)/(1+r),i))-a,Math.abs(n)<=1e-10)return a;return-9999}function init$v(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1)}function forward$u(t){var e,r,n=t.x,i=t.y;if(i*R2D>90&&i*R2D<-90&&n*R2D>180&&n*R2D<-180)return null;if(Math.abs(Math.abs(i)-HALF_PI)<=EPSLN)return null;if(this.sphere)e=this.x0+this.a*this.k0*adjust_lon(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(FORTPI+.5*i));else{var a=Math.sin(i),o=tsfnz(this.e,i,a);e=this.x0+this.a*this.k0*adjust_lon(n-this.long0),r=this.y0-this.a*this.k0*Math.log(o)}return t.x=e,t.y=r,t}function inverse$u(t){var e,r,n=t.x-this.x0,i=t.y-this.y0;if(this.sphere)r=HALF_PI-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var a=Math.exp(-i/(this.a*this.k0));if(-9999===(r=phi2z(this.e,a)))return null}return e=adjust_lon(this.long0+n/(this.a*this.k0)),t.x=e,t.y=r,t}var names$w=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"],merc={init:init$v,forward:forward$u,inverse:inverse$u,names:names$w};function init$u(){}function identity$1(t){return t}var names$v=["longlat","identity"],longlat={init:init$u,forward:identity$1,inverse:identity$1,names:names$v},projs=[merc,longlat],names$u={},projStore=[];function add$1(t,e){var r=projStore.length;return t.names?(projStore[r]=t,t.names.forEach((function(t){names$u[t.toLowerCase()]=r})),this):(console.log(e),!0)}function get$1(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==names$u[e]&&projStore[names$u[e]]?projStore[names$u[e]]:void 0}function start(){projs.forEach(add$1)}var projections={start:start,add:add$1,get:get$1},exports$2={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},WGS84=exports$2.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};function eccentricity(t,e,r,n){var i=t*t,a=e*e,o=(i-a)/i,s=0;return n?(i=(t*=1-o*(SIXTH+o*(RA4+o*RA6)))*t,o=0):s=Math.sqrt(o),{es:o,e:s,ep2:(i-a)/a}}function sphere(t,e,r,n,i){if(!t){var a=match(exports$2,n);a||(a=WGS84),t=a.a,e=a.b,r=a.rf}return r&&!e&&(e=(1-1/r)*t),(0===r||Math.abs(t-e)<EPSLN)&&(i=!0,e=t),{a:t,b:e,rf:r,sphere:i}}exports$2.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var exports$1={};function datum(t,e,r,n,i,a,o){var s={};return s.datum_type=void 0===t||"none"===t?PJD_NODATUM:PJD_WGS84,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=PJD_3PARAM),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=PJD_7PARAM,s.datum_params[3]*=SEC_TO_RAD,s.datum_params[4]*=SEC_TO_RAD,s.datum_params[5]*=SEC_TO_RAD,s.datum_params[6]=s.datum_params[6]/1e6+1))),o&&(s.datum_type=PJD_GRIDSHIFT,s.grids=o),s.a=r,s.b=n,s.es=i,s.ep2=a,s}exports$1.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},exports$1.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},exports$1.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},exports$1.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},exports$1.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},exports$1.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},exports$1.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},exports$1.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},exports$1.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},exports$1.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},exports$1.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},exports$1.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},exports$1.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},exports$1.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},exports$1.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},exports$1.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},exports$1.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var loadedNadgrids={};function nadgrid(t,e){var r=new DataView(e),n=detectLittleEndian(r),i=readHeader(r,n);i.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var a={header:i,subgrids:readSubgrids(r,i,n)};return loadedNadgrids[t]=a,a}function getNadgrids(t){return void 0===t?null:t.split(",").map(parseNadgridString)}function parseNadgridString(t){if(0===t.length)return null;var e="@"===t[0];return e&&(t=t.slice(1)),"null"===t?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:t,mandatory:!e,grid:loadedNadgrids[t]||null,isNull:!1}}function secondsToRadians(t){return t/3600*Math.PI/180}function detectLittleEndian(t){var e=t.getInt32(8,!1);return 11!==e&&(11!==(e=t.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function readHeader(t,e){return{nFields:t.getInt32(8,e),nSubgridFields:t.getInt32(24,e),nSubgrids:t.getInt32(40,e),shiftType:decodeString(t,56,64).trim(),fromSemiMajorAxis:t.getFloat64(120,e),fromSemiMinorAxis:t.getFloat64(136,e),toSemiMajorAxis:t.getFloat64(152,e),toSemiMinorAxis:t.getFloat64(168,e)}}function decodeString(t,e,r){return String.fromCharCode.apply(null,new Uint8Array(t.buffer.slice(e,r)))}function readSubgrids(t,e,r){for(var n=[],i=0;i<e.nSubgrids;i++){var a=readGridHeader(t,176,r),o=readGridNodes(t,176,a,r),s=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),u=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);n.push({ll:[secondsToRadians(a.lowerLongitude),secondsToRadians(a.lowerLatitude)],del:[secondsToRadians(a.longitudeInterval),secondsToRadians(a.latitudeInterval)],lim:[s,u],count:a.gridNodeCount,cvs:mapNodes(o)})}return n}function mapNodes(t){return t.map((function(t){return[secondsToRadians(t.longitudeShift),secondsToRadians(t.latitudeShift)]}))}function readGridHeader(t,e,r){return{name:decodeString(t,e+8,e+16).trim(),parent:decodeString(t,e+24,e+24+8).trim(),lowerLatitude:t.getFloat64(e+72,r),upperLatitude:t.getFloat64(e+88,r),lowerLongitude:t.getFloat64(e+104,r),upperLongitude:t.getFloat64(e+120,r),latitudeInterval:t.getFloat64(e+136,r),longitudeInterval:t.getFloat64(e+152,r),gridNodeCount:t.getInt32(e+168,r)}}function readGridNodes(t,e,r,n){for(var i=e+176,a=[],o=0;o<r.gridNodeCount;o++){var s={latitudeShift:t.getFloat32(i+16*o,n),longitudeShift:t.getFloat32(i+16*o+4,n),latitudeAccuracy:t.getFloat32(i+16*o+8,n),longitudeAccuracy:t.getFloat32(i+16*o+12,n)};a.push(s)}return a}function Projection$1(t,e){if(!(this instanceof Projection$1))return new Projection$1(t);e=e||function(t){if(t)throw t};var r=parse$1(t);if("object"==typeof r){var n=Projection$1.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=match(exports$1,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var a=sphere(r.a,r.b,r.rf,r.ellps,r.sphere),o=eccentricity(a.a,a.b,a.rf,r.R_A),s=getNadgrids(r.nadgrids),u=r.datum||datum(r.datumCode,r.datum_params,a.a,a.b,o.es,o.ep2,s);extend(this,r),extend(this,n),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=o.es,this.e=o.e,this.ep2=o.ep2,this.datum=u,this.init(),e(null,this)}else e(t)}else e(t)}function compareDatums(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===PJD_3PARAM?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==PJD_7PARAM||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}function geodeticToGeocentric(t,e,r){var n,i,a,o=t.x,s=t.y,u=t.z?t.z:0;if(s<-HALF_PI&&s>-1.001*HALF_PI)s=-HALF_PI;else if(s>HALF_PI&&s<1.001*HALF_PI)s=HALF_PI;else{if(s<-HALF_PI)return{x:-1/0,y:-1/0,z:t.z};if(s>HALF_PI)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),i=Math.sin(s),a=Math.cos(s),{x:((n=r/Math.sqrt(1-e*(i*i)))+u)*a*Math.cos(o),y:(n+u)*a*Math.sin(o),z:(n*(1-e)+u)*i}}function geocentricToGeodetic(t,e,r,n){var i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_=t.x,b=t.y,x=t.z?t.z:0;if(i=Math.sqrt(_*_+b*b),a=Math.sqrt(_*_+b*b+x*x),i/r<1e-12){if(g=0,a/r<1e-12)return y=-n,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(b,_);o=x/a,h=(s=i/a)*(1-e)*(u=1/Math.sqrt(1-e*(2-e)*s*s)),f=o*u,v=0;do{v++,l=e*(c=r/Math.sqrt(1-e*f*f))/(c+(y=i*h+x*f-c*(1-e*f*f))),m=(p=o*(u=1/Math.sqrt(1-l*(2-l)*s*s)))*h-(d=s*(1-l)*u)*f,h=d,f=p}while(m*m>1e-24&&v<30);return{x:g,y:Math.atan(p/Math.abs(d)),z:y}}function geocentricToWgs84(t,e,r){if(e===PJD_3PARAM)return{x:t.x+r[0],y:t.y+r[1],z:t.z+r[2]};if(e===PJD_7PARAM){var n=r[3],i=r[4],a=r[5],o=r[6];return{x:o*(t.x-a*t.y+i*t.z)+r[0],y:o*(a*t.x+t.y-n*t.z)+r[1],z:o*(-i*t.x+n*t.y+t.z)+r[2]}}}function geocentricFromWgs84(t,e,r){if(e===PJD_3PARAM)return{x:t.x-r[0],y:t.y-r[1],z:t.z-r[2]};if(e===PJD_7PARAM){var n=r[3],i=r[4],a=r[5],o=r[6],s=(t.x-r[0])/o,u=(t.y-r[1])/o,l=(t.z-r[2])/o;return{x:s+a*u-i*l,y:-a*s+u+n*l,z:i*s-n*u+l}}}function checkParams(t){return t===PJD_3PARAM||t===PJD_7PARAM}function datum_transform(t,e,r){if(compareDatums(t,e))return r;if(t.datum_type===PJD_NODATUM||e.datum_type===PJD_NODATUM)return r;var n=t.a,i=t.es;if(t.datum_type===PJD_GRIDSHIFT){if(0!==applyGridShift(t,!1,r))return;n=SRS_WGS84_SEMIMAJOR,i=SRS_WGS84_ESQUARED}var a=e.a,o=e.b,s=e.es;return e.datum_type===PJD_GRIDSHIFT&&(a=SRS_WGS84_SEMIMAJOR,o=SRS_WGS84_SEMIMINOR,s=SRS_WGS84_ESQUARED),i!==s||n!==a||checkParams(t.datum_type)||checkParams(e.datum_type)?(r=geodeticToGeocentric(r,i,n),checkParams(t.datum_type)&&(r=geocentricToWgs84(r,t.datum_type,t.datum_params)),checkParams(e.datum_type)&&(r=geocentricFromWgs84(r,e.datum_type,e.datum_params)),r=geocentricToGeodetic(r,s,a,o),e.datum_type!==PJD_GRIDSHIFT||0===applyGridShift(e,!0,r)?r:void 0):r}function applyGridShift(t,e,r){if(null===t.grids||0===t.grids.length)return console.log("Grid shift grids not found"),-1;for(var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},a=[],o=0;o<t.grids.length;o++){var s=t.grids[o];if(a.push(s.name),s.isNull){i=n;break}if(null!==s.grid){var u=s.grid.subgrids[0],l=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4;if(!(u.ll[1]-l>n.y||u.ll[0]-l>n.x||u.ll[1]+(u.lim[1]-1)*u.del[1]+l<n.y||u.ll[0]+(u.lim[0]-1)*u.del[0]+l<n.x||(i=applySubgridShift(n,e,u),isNaN(i.x))))break}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*R2D+" "+n.y*R2D+" tried: '"+a+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function applySubgridShift(t,e,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(t.x))return n;var i={x:t.x,y:t.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=adjust_lon(i.x-Math.PI)+Math.PI;var a=nadInterpolate(i,r);if(e){if(isNaN(a.x))return n;a.x=i.x-a.x,a.y=i.y-a.y;var o,s,u=9;do{if(s=nadInterpolate(a,r),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a.x+=(o={x:i.x-(s.x+a.x),y:i.y-(s.y+a.y)}).x,a.y+=o.y}while(u--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(u<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=adjust_lon(a.x+r.ll[0]),n.y=a.y+r.ll[1]}else isNaN(a.x)||(n.x=t.x+a.x,n.y=t.y+a.y);return n}function nadInterpolate(t,e){var r,n={x:t.x/e.del[0],y:t.y/e.del[1]},i=Math.floor(n.x),a=Math.floor(n.y),o=n.x-1*i,s=n.y-1*a,u={x:Number.NaN,y:Number.NaN};if(i<0||i>=e.lim[0])return u;if(a<0||a>=e.lim[1])return u;var l=e.cvs[r=a*e.lim[0]+i][0],c=e.cvs[r][1];r++;var h=e.cvs[r][0],f=e.cvs[r][1],d=e.cvs[r+=e.lim[0]][0],p=e.cvs[r][1];r--;var m=e.cvs[r][1],v=o*s,g=o*(1-s),y=(1-o)*(1-s),_=(1-o)*s;return u.x=y*l+g*h+_*e.cvs[r][0]+v*d,u.y=y*c+g*f+_*m+v*p,u}function adjust_axis(t,e,r){var n,i,a,o=r.x,s=r.y,u=r.z||0,l={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==r.z)switch(0===a?(n=o,i=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(n=s,i=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(n=u,i="z"),t.axis[a]){case"e":case"n":l[i]=n;break;case"w":case"s":l[i]=-n;break;case"u":void 0!==r[i]&&(l.z=n);break;case"d":void 0!==r[i]&&(l.z=-n);break;default:return null}return l}function common(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function checkSanity(t){checkCoord(t.x),checkCoord(t.y)}function checkCoord(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function checkNotWGS(t,e){return(t.datum.datum_type===PJD_3PARAM||t.datum.datum_type===PJD_7PARAM)&&"WGS84"!==e.datumCode||(e.datum.datum_type===PJD_3PARAM||e.datum.datum_type===PJD_7PARAM)&&"WGS84"!==t.datumCode}function transform(t,e,r,n){var i;if(Array.isArray(r)&&(r=common(r)),checkSanity(r),t.datum&&e.datum&&checkNotWGS(t,e)&&(r=transform(t,i=new Projection$1("WGS84"),r,n),t=i),n&&"enu"!==t.axis&&(r=adjust_axis(t,!1,r)),"longlat"===t.projName)r={x:r.x*D2R$1,y:r.y*D2R$1,z:r.z||0};else if(t.to_meter&&(r={x:r.x*t.to_meter,y:r.y*t.to_meter,z:r.z||0}),!(r=t.inverse(r)))return;if(t.from_greenwich&&(r.x+=t.from_greenwich),r=datum_transform(t.datum,e.datum,r))return e.from_greenwich&&(r={x:r.x-e.from_greenwich,y:r.y,z:r.z||0}),"longlat"===e.projName?r={x:r.x*R2D,y:r.y*R2D,z:r.z||0}:(r=e.forward(r),e.to_meter&&(r={x:r.x/e.to_meter,y:r.y/e.to_meter,z:r.z||0})),n&&"enu"!==e.axis?adjust_axis(e,!0,r):r}Projection$1.projections=projections,Projection$1.projections.start();var wgs84=Projection$1("WGS84");function transformer(t,e,r,n){var i,a,o;return Array.isArray(r)?(i=transform(t,e,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.splice(3)):[i.x,i.y,r[2]].concat(r.splice(3)):[i.x,i.y].concat(r.splice(2)):[i.x,i.y]):(a=transform(t,e,r,n),2===(o=Object.keys(r)).length||o.forEach((function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;a[n]=r[n]})),a)}function checkProj(t){return t instanceof Projection$1?t:t.oProj?t.oProj:Projection$1(t)}function proj4(t,e,r){t=checkProj(t);var n,i=!1;return void 0===e?(e=t,t=wgs84,i=!0):(void 0!==e.x||Array.isArray(e))&&(r=e,e=t,t=wgs84,i=!0),e=checkProj(e),r?transformer(t,e,r):(n={forward:function(r,n){return transformer(t,e,r,n)},inverse:function(r,n){return transformer(e,t,r,n)}},i&&(n.oProj=e),n)}var NUM_100K_SETS=6,SET_ORIGIN_COLUMN_LETTERS="AJSAJS",SET_ORIGIN_ROW_LETTERS="AFAFAF",A=65,I=73,O=79,V=86,Z=90,mgrs={forward:forward$t,inverse:inverse$t,toPoint:toPoint};function forward$t(t,e){return e=e||5,encode(LLtoUTM({lat:t[1],lon:t[0]}),e)}function inverse$t(t){var e=UTMtoLL(decode(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function toPoint(t){var e=UTMtoLL(decode(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function degToRad(t){return t*(Math.PI/180)}function radToDeg(t){return t/Math.PI*180}function LLtoUTM(t){var e,r,n,i,a,o,s,u=t.lat,l=t.lon,c=6378137,h=.9996,f=degToRad(u),d=degToRad(l);s=Math.floor((l+180)/6)+1,180===l&&(s=60),u>=56&&u<64&&l>=3&&l<12&&(s=32),u>=72&&u<84&&(l>=0&&l<9?s=31:l>=9&&l<21?s=33:l>=21&&l<33?s=35:l>=33&&l<42&&(s=37)),o=degToRad(6*(s-1)-180+3),e=.006739496752268451,r=c/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),n=Math.tan(f)*Math.tan(f),i=e*Math.cos(f)*Math.cos(f);var p=h*r*((a=Math.cos(f)*(d-o))+(1-n+i)*a*a*a/6+(5-18*n+n*n+72*i-58*e)*a*a*a*a*a/120)+5e5,m=h*(c*(.9983242984503243*f-.002514607064228144*Math.sin(2*f)+2639046602129982e-21*Math.sin(4*f)-3.418046101696858e-9*Math.sin(6*f))+r*Math.tan(f)*(a*a/2+(5-n+9*i+4*i*i)*a*a*a*a/24+(61-58*n+n*n+600*i-2.2240339282485886)*a*a*a*a*a*a/720));return u<0&&(m+=1e7),{northing:Math.round(m),easting:Math.round(p),zoneNumber:s,zoneLetter:getLetterDesignator(u)}}function UTMtoLL(t){var e=t.northing,r=t.easting,n=t.zoneLetter,i=t.zoneNumber;if(i<0||i>60)return null;var a,o,s,u,l,c,h,f,d,p=.9996,m=6378137,v=.00669438,g=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=r-5e5,_=e;n<"N"&&(_-=1e7),h=6*(i-1)-180+3,a=.006739496752268451,d=(f=_/p/6367449.145945056)+(3*g/2-27*g*g*g/32)*Math.sin(2*f)+(21*g*g/16-55*g*g*g*g/32)*Math.sin(4*f)+151*g*g*g/96*Math.sin(6*f),o=m/Math.sqrt(1-v*Math.sin(d)*Math.sin(d)),s=Math.tan(d)*Math.tan(d),u=a*Math.cos(d)*Math.cos(d),l=.99330562*m/Math.pow(1-v*Math.sin(d)*Math.sin(d),1.5),c=y/(o*p);var b=d-o*Math.tan(d)/l*(c*c/2-(5+3*s+10*u-4*u*u-9*a)*c*c*c*c/24+(61+90*s+298*u+45*s*s-1.6983531815716497-3*u*u)*c*c*c*c*c*c/720);b=radToDeg(b);var x,w=(c-(1+2*s+u)*c*c*c/6+(5-2*u+28*s-3*u*u+8*a+24*s*s)*c*c*c*c*c/120)/Math.cos(d);if(w=h+radToDeg(w),t.accuracy){var M=UTMtoLL({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});x={top:M.lat,right:M.lon,bottom:b,left:w}}else x={lat:b,lon:w};return x}function getLetterDesignator(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function encode(t,e){var r="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+get100kID(t.easting,t.northing,t.zoneNumber)+r.substr(r.length-5,e)+n.substr(n.length-5,e)}function get100kID(t,e,r){var n=get100kSetForZone(r);return getLetter100kID(Math.floor(t/1e5),Math.floor(e/1e5)%20,n)}function get100kSetForZone(t){var e=t%NUM_100K_SETS;return 0===e&&(e=NUM_100K_SETS),e}function getLetter100kID(t,e,r){var n=r-1,i=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(n),a=SET_ORIGIN_ROW_LETTERS.charCodeAt(n),o=i+t-1,s=a+e,u=!1;return o>Z&&(o=o-Z+A-1,u=!0),(o===I||i<I&&o>I||(o>I||i<I)&&u)&&o++,(o===O||i<O&&o>O||(o>O||i<O)&&u)&&++o===I&&o++,o>Z&&(o=o-Z+A-1),s>V?(s=s-V+A-1,u=!0):u=!1,(s===I||a<I&&s>I||(s>I||a<I)&&u)&&s++,(s===O||a<O&&s>O||(s>O||a<O)&&u)&&++s===I&&s++,s>V&&(s=s-V+A-1),String.fromCharCode(o)+String.fromCharCode(s)}function decode(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,r=t.length,n=null,i="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;i+=e,a++}var o=parseInt(i,10);if(0===a||a+3>r)throw"MGRSPoint bad conversion from: "+t;var s=t.charAt(a++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+t;n=t.substring(a,a+=2);for(var u=get100kSetForZone(o),l=getEastingFromChar(n.charAt(0),u),c=getNorthingFromChar(n.charAt(1),u);c<getMinNorthing(s);)c+=2e6;var h=r-a;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var f,d,p,m=h/2,v=0,g=0;return m>0&&(f=1e5/Math.pow(10,m),d=t.substring(a,a+m),v=parseFloat(d)*f,p=t.substring(a+m),g=parseFloat(p)*f),{easting:v+l,northing:g+c,zoneLetter:s,zoneNumber:o,accuracy:f}}function getEastingFromChar(t,e){for(var r=SET_ORIGIN_COLUMN_LETTERS.charCodeAt(e-1),n=1e5,i=!1;r!==t.charCodeAt(0);){if(++r===I&&r++,r===O&&r++,r>Z){if(i)throw"Bad character: "+t;r=A,i=!0}n+=1e5}return n}function getNorthingFromChar(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var r=SET_ORIGIN_ROW_LETTERS.charCodeAt(e-1),n=0,i=!1;r!==t.charCodeAt(0);){if(++r===I&&r++,r===O&&r++,r>V){if(i)throw"Bad character: "+t;r=A,i=!0}n+=1e5}return n}function getMinNorthing(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function Point(t,e,r){if(!(this instanceof Point))return new Point(t,e,r);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Point.fromMGRS=function(t){return new Point(toPoint(t))},Point.prototype.toMGRS=function(t){return forward$t([this.x,this.y],t)};var C00=1,C02=.25,C04=.046875,C06=.01953125,C08=.01068115234375,C22=.75,C44=.46875,C46=.013020833333333334,C48=.007120768229166667,C66=.3645833333333333,C68=.005696614583333333,C88=.3076171875;function pj_enfn(t){var e=[];e[0]=C00-t*(C02+t*(C04+t*(C06+t*C08))),e[1]=t*(C22-t*(C04+t*(C06+t*C08)));var r=t*t;return e[2]=r*(C44-t*(C46+t*C48)),e[3]=(r*=t)*(C66-t*C68),e[4]=r*t*C88,e}function pj_mlfn(t,e,r,n){return n[0]*t-(r*=e)*(n[1]+(e*=e)*(n[2]+e*(n[3]+e*n[4])))}var MAX_ITER$3=20;function pj_inv_mlfn(t,e,r){for(var n=1/(1-e),i=t,a=MAX_ITER$3;a;--a){var o=Math.sin(i),s=1-e*o*o;if(i-=s=(pj_mlfn(i,o,Math.cos(i),r)-t)*(s*Math.sqrt(s))*n,Math.abs(s)<EPSLN)return i}return i}function init$t(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=pj_enfn(this.es),this.ml0=pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function forward$s(t){var e,r,n,i=t.y,a=adjust_lon(t.x-this.long0),o=Math.sin(i),s=Math.cos(i);if(this.es){var u=s*a,l=Math.pow(u,2),c=this.ep2*Math.pow(s,2),h=Math.pow(c,2),f=Math.abs(s)>EPSLN?Math.tan(i):0,d=Math.pow(f,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2),u/=Math.sqrt(e);var m=pj_mlfn(i,o,s,this.en);r=this.a*(this.k0*u*(1+l/6*(1-d+c+l/20*(5-18*d+p+14*c-58*d*c+l/42*(61+179*p-p*d-479*d)))))+this.x0,n=this.a*(this.k0*(m-this.ml0+o*a*u/2*(1+l/12*(5-d+9*c+4*h+l/30*(61+p-58*d+270*c-330*d*c+l/56*(1385+543*p-p*d-3111*d))))))+this.y0}else{var v=s*Math.sin(a);if(Math.abs(Math.abs(v)-1)<EPSLN)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=s*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>EPSLN)return 93;n=0}else n=Math.acos(n);i<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=r,t.y=n,t}function inverse$s(t){var e,r,n,i,a=1/this.a*(t.x-this.x0),o=1/this.a*(t.y-this.y0);if(this.es)if(r=pj_inv_mlfn(e=this.ml0+o/this.k0,this.es,this.en),Math.abs(r)<HALF_PI){var s=Math.sin(r),u=Math.cos(r),l=Math.abs(u)>EPSLN?Math.tan(r):0,c=this.ep2*Math.pow(u,2),h=Math.pow(c,2),f=Math.pow(l,2),d=Math.pow(f,2);e=1-this.es*Math.pow(s,2);var p=a*Math.sqrt(e)/this.k0,m=Math.pow(p,2);n=r-(e*=l)*m/(1-this.es)*.5*(1-m/12*(5+3*f-9*c*f+c-4*h-m/30*(61+90*f-252*c*f+45*d+46*c-m/56*(1385+3633*f+4095*d+1574*d*f)))),i=adjust_lon(this.long0+p*(1-m/6*(1+2*f+c-m/20*(5+28*f+24*d+8*c*f+6*c-m/42*(61+662*f+1320*d+720*d*f))))/u)}else n=HALF_PI*sign(o),i=0;else{var v=Math.exp(a/this.k0),g=.5*(v-1/v),y=Math.cos(this.lat0+o/this.k0);e=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(g,2))),n=Math.asin(e),o<0&&(n=-n),i=0===g&&0===y?0:adjust_lon(Math.atan2(g,y)+this.long0)}return t.x=i,t.y=n,t}var names$t=["Fast_Transverse_Mercator","Fast Transverse Mercator"],tmerc={init:init$t,forward:forward$s,inverse:inverse$s,names:names$t};function sinh(t){var e=Math.exp(t);return(e-1/e)/2}function hypot(t,e){t=Math.abs(t),e=Math.abs(e);var r=Math.max(t,e),n=Math.min(t,e)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function log1py(t){var e=1+t,r=e-1;return 0===r?t:t*Math.log(e)/r}function asinhy(t){var e=Math.abs(t);return e=log1py(e*(1+e/(hypot(1,e)+1))),t<0?-e:e}function gatg(t,e){for(var r,n=2*Math.cos(2*e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return e+r*Math.sin(2*e)}function clens(t,e){for(var r,n=2*Math.cos(e),i=t.length-1,a=t[i],o=0;--i>=0;)r=n*a-o+t[i],o=a,a=r;return Math.sin(e)*r}function cosh(t){var e=Math.exp(t);return(e+1/e)/2}function clens_cmplx(t,e,r){for(var n,i,a=Math.sin(e),o=Math.cos(e),s=sinh(r),u=cosh(r),l=2*o*u,c=-2*a*s,h=t.length-1,f=t[h],d=0,p=0,m=0;--h>=0;)n=p,i=d,f=l*(p=f)-n-c*(d=m)+t[h],m=c*p-i+l*d;return[(l=a*u)*f-(c=o*s)*m,l*m+c*f]}function init$s(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(tmerc.init.apply(this),this.forward=tmerc.forward,this.inverse=tmerc.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),r=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),this.cgb[1]=(r*=e)*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),this.cgb[2]=(r*=e)*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=r*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),this.cgb[3]=(r*=e)*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=r*(1237/630+e*(e*(-24832/14175)-2.4)),this.cgb[4]=(r*=e)*(4174/315+e*(-144838/6237)),this.cbg[4]=r*(-734/315+e*(109598/31185)),this.cgb[5]=(r*=e)*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=r*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=r*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),this.utg[2]=(r*=e)*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=r*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),this.utg[3]=(r*=e)*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=r*(49561/161280+e*(-179/168+e*(6601661/7257600))),this.utg[4]=(r*=e)*(-4583/161280+e*(108847/3991680)),this.gtu[4]=r*(34729/80640+e*(-3418889/1995840)),this.utg[5]=(r*=e)*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=gatg(this.cbg,this.lat0);this.Zb=-this.Qn*(n+clens(this.gtu,2*n))}function forward$r(t){var e=adjust_lon(t.x-this.long0),r=t.y;r=gatg(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),a=Math.sin(e),o=Math.cos(e);r=Math.atan2(n,o*i),e=Math.atan2(a*i,hypot(n,i*o)),e=asinhy(Math.tan(e));var s,u,l=clens_cmplx(this.gtu,2*r,2*e);return r+=l[0],e+=l[1],Math.abs(e)<=2.623395162778?(s=this.a*(this.Qn*e)+this.x0,u=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,u=1/0),t.x=s,t.y=u,t}function inverse$r(t){var e,r,n=1/this.a*(t.x-this.x0),i=1/this.a*(t.y-this.y0);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=clens_cmplx(this.utg,2*i,2*n);i+=a[0],n+=a[1],n=Math.atan(sinh(n));var o=Math.sin(i),s=Math.cos(i),u=Math.sin(n),l=Math.cos(n);i=Math.atan2(o*l,hypot(u,l*s)),e=adjust_lon((n=Math.atan2(u,l*s))+this.long0),r=gatg(this.cgb,i)}else e=1/0,r=1/0;return t.x=e,t.y=r,t}var names$s=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"],etmerc={init:init$s,forward:forward$r,inverse:inverse$r,names:names$s};function adjust_zone(t,e){if(void 0===t){if((t=Math.floor(30*(adjust_lon(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}var dependsOn="etmerc";function init$r(){var t=adjust_zone(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*D2R$1,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,etmerc.init.apply(this),this.forward=etmerc.forward,this.inverse=etmerc.inverse}var names$r=["Universal Transverse Mercator System","utm"],utm={init:init$r,names:names$r,dependsOn:dependsOn};function srat(t,e){return Math.pow((1-t)/(1+t),e)}var MAX_ITER$2=20;function init$q(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+FORTPI)/(Math.pow(Math.tan(.5*this.lat0+FORTPI),this.C)*srat(this.e*t,this.ratexp))}function forward$q(t){var e=t.x,r=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+FORTPI),this.C)*srat(this.e*Math.sin(r),this.ratexp))-HALF_PI,t.x=this.C*e,t}function inverse$q(t){for(var e=t.x/this.C,r=t.y,n=Math.pow(Math.tan(.5*r+FORTPI)/this.K,1/this.C),i=MAX_ITER$2;i>0&&(r=2*Math.atan(n*srat(this.e*Math.sin(t.y),-.5*this.e))-HALF_PI,!(Math.abs(r-t.y)<1e-14));--i)t.y=r;return i?(t.x=e,t.y=r,t):null}var names$q=["gauss"],gauss={init:init$q,forward:forward$q,inverse:inverse$q,names:names$q};function init$p(){gauss.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function forward$p(t){var e,r,n,i;return t.x=adjust_lon(t.x-this.long0),gauss.forward.apply(this,[t]),e=Math.sin(t.y),r=Math.cos(t.y),n=Math.cos(t.x),t.x=(i=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*r*n))*r*Math.sin(t.x),t.y=i*(this.cosc0*e-this.sinc0*r*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function inverse$p(t){var e,r,n,i,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var o=2*Math.atan2(a,this.R2);e=Math.sin(o),r=Math.cos(o),i=Math.asin(r*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*r-t.y*this.sinc0*e)}else i=this.phic0,n=0;return t.x=n,t.y=i,gauss.inverse.apply(this,[t]),t.x=adjust_lon(t.x+this.long0),t}var names$p=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],sterea={init:init$p,forward:forward$p,inverse:inverse$p,names:names$p};function ssfn_(t,e,r){return e*=r,Math.tan(.5*(HALF_PI+t))*Math.pow((1-e)/(1+e),.5*r)}function init$o(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&(this.k0=.5*(1+sign(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=EPSLN&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=EPSLN&&(this.k0=.5*this.cons*msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/tsfnz(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=msfnz(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-HALF_PI,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function forward$o(t){var e,r,n,i,a,o,s=t.x,u=t.y,l=Math.sin(u),c=Math.cos(u),h=adjust_lon(s-this.long0);return Math.abs(Math.abs(s-this.long0)-Math.PI)<=EPSLN&&Math.abs(u+this.lat0)<=EPSLN?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*l+this.coslat0*c*Math.cos(h)),t.x=this.a*e*c*Math.sin(h)+this.x0,t.y=this.a*e*(this.coslat0*l-this.sinlat0*c*Math.cos(h))+this.y0,t):(r=2*Math.atan(this.ssfn_(u,l,this.e))-HALF_PI,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=EPSLN?(a=tsfnz(this.e,u*this.con,this.con*l),t.x=this.x0+(o=2*this.a*this.k0*a/this.cons)*Math.sin(s-this.long0),t.y=this.y0-this.con*o*Math.cos(s-this.long0),t):(Math.abs(this.sinlat0)<EPSLN?(e=2*this.a*this.k0/(1+i*Math.cos(h)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(h))),t.y=e*(this.cosX0*n-this.sinX0*i*Math.cos(h))+this.y0),t.x=e*i*Math.sin(h)+this.x0,t))}function inverse$o(t){var e,r,n,i;t.x-=this.x0,t.y-=this.y0;var a=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,r=this.lat0,a<=EPSLN?(t.x=e,t.y=r,t):(r=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/a),e=Math.abs(this.coslat0)<EPSLN?adjust_lon(this.lat0>0?this.long0+Math.atan2(t.x,-1*t.y):this.long0+Math.atan2(t.x,t.y)):adjust_lon(this.long0+Math.atan2(t.x*Math.sin(o),a*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=r,t)}if(Math.abs(this.coslat0)<=EPSLN){if(a<=EPSLN)return r=this.lat0,t.x=e=this.long0,t.y=r,t;t.x*=this.con,t.y*=this.con,r=this.con*phi2z(this.e,a*this.cons/(2*this.a*this.k0)),e=this.con*adjust_lon(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else n=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=EPSLN?i=this.X0:(i=Math.asin(Math.cos(n)*this.sinX0+t.y*Math.sin(n)*this.cosX0/a),e=adjust_lon(this.long0+Math.atan2(t.x*Math.sin(n),a*this.cosX0*Math.cos(n)-t.y*this.sinX0*Math.sin(n)))),r=-1*phi2z(this.e,Math.tan(.5*(HALF_PI+i)));return t.x=e,t.y=r,t}var names$o=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],stere={init:init$o,forward:forward$o,inverse:inverse$o,names:names$o,ssfn_:ssfn_};function init$n(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),a=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(e,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+t/2)),u=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*s+this.alpha*a/2*u}function forward$n(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=2*(Math.atan(Math.exp(-this.alpha*(e+r)+this.K))-Math.PI/4),i=this.alpha*(t.x-this.lambda0),a=Math.atan(Math.sin(i)/(Math.sin(this.b0)*Math.tan(n)+Math.cos(this.b0)*Math.cos(i))),o=Math.asin(Math.cos(this.b0)*Math.sin(n)-Math.sin(this.b0)*Math.cos(n)*Math.cos(i));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*a+this.x0,t}function inverse$n(t){for(var e=(t.x-this.x0)/this.R,r=2*(Math.atan(Math.exp((t.y-this.y0)/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(e)),i=Math.atan(Math.sin(e)/(Math.cos(this.b0)*Math.cos(e)-Math.sin(this.b0)*Math.tan(r))),a=this.lambda0+i/this.alpha,o=0,s=n,u=-1e3,l=0;Math.abs(s-u)>1e-7;){if(++l>20)return;o=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(s))/2)),u=s,s=2*Math.atan(Math.exp(o))-Math.PI/2}return t.x=a,t.y=s,t}var names$n=["somerc"],somerc={init:init$n,forward:forward$n,inverse:inverse$n,names:names$n},TOL=1e-7;function isTypeA(t){var e="object"==typeof t.PROJECTION?Object.keys(t.PROJECTION)[0]:t.PROJECTION;return"no_uoff"in t||"no_off"in t||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(e)}function init$m(){var t,e,r,n,i,a,o,s,u,l,c,h=0,f=0,d=0,p=0,m=0,v=0,g=0;this.no_off=isTypeA(this),this.no_rot="no_rot"in this;var y=!1;"alpha"in this&&(y=!0);var _=!1;if("rectified_grid_angle"in this&&(_=!0),y&&(g=this.alpha),_&&(h=this.rectified_grid_angle*D2R$1),y||_)f=this.longc;else if(d=this.long1,m=this.lat1,p=this.long2,v=this.lat2,Math.abs(m-v)<=TOL||(t=Math.abs(m))<=TOL||Math.abs(t-HALF_PI)<=TOL||Math.abs(Math.abs(this.lat0)-HALF_PI)<=TOL||Math.abs(Math.abs(v)-HALF_PI)<=TOL)throw new Error;var b=1-this.es;e=Math.sqrt(b),Math.abs(this.lat0)>EPSLN?(s=Math.sin(this.lat0),r=Math.cos(this.lat0),t=1-this.es*s*s,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/b),this.A=this.B*this.k0*e/t,(i=(n=this.B*e/(r*Math.sqrt(t)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(tsfnz(this.e,this.lat0,s),this.B)):(this.B=1/e,this.A=this.k0,this.E=n=i=1),y||_?(y?(c=Math.asin(Math.sin(g)/n),_||(h=g)):(c=h,g=Math.asin(n*Math.sin(c))),this.lam0=f-Math.asin(.5*(i-1/i)*Math.tan(c))/this.B):(a=Math.pow(tsfnz(this.e,m,Math.sin(m)),this.B),o=Math.pow(tsfnz(this.e,v,Math.sin(v)),this.B),i=this.E/a,u=(o-a)/(o+a),l=((l=this.E*this.E)-o*a)/(l+o*a),(t=d-p)<-Math.pi?p-=TWO_PI:t>Math.pi&&(p+=TWO_PI),this.lam0=adjust_lon(.5*(d+p)-Math.atan(l*Math.tan(.5*this.B*(d-p))/u)/this.B),c=Math.atan(2*Math.sin(this.B*adjust_lon(d-this.lam0))/(i-1/i)),h=g=Math.asin(n*Math.sin(c))),this.singam=Math.sin(c),this.cosgam=Math.cos(c),this.sinrot=Math.sin(h),this.cosrot=Math.cos(h),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(g))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*c,this.v_pole_n=this.ArB*Math.log(Math.tan(FORTPI-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(FORTPI+i))}function forward$m(t){var e,r,n,i,a,o,s,u,l={};if(t.x=t.x-this.lam0,Math.abs(Math.abs(t.y)-HALF_PI)>EPSLN){if(e=.5*((a=this.E/Math.pow(tsfnz(this.e,t.y,Math.sin(t.y)),this.B))-(o=1/a)),r=.5*(a+o),i=Math.sin(this.B*t.x),n=(e*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<EPSLN)throw new Error;u=.5*this.ArB*Math.log((1-n)/(1+n)),o=Math.cos(this.B*t.x),s=Math.abs(o)<TOL?this.A*t.x:this.ArB*Math.atan2(e*this.cosgam+i*this.singam,o)}else u=t.y>0?this.v_pole_n:this.v_pole_s,s=this.ArB*t.y;return this.no_rot?(l.x=s,l.y=u):(l.x=u*this.cosrot+(s-=this.u_0)*this.sinrot,l.y=s*this.cosrot-u*this.sinrot),l.x=this.a*l.x+this.x0,l.y=this.a*l.y+this.y0,l}function inverse$m(t){var e,r,n,i,a,o,s,u={};if(t.x=1/this.a*(t.x-this.x0),t.y=1/this.a*(t.y-this.y0),this.no_rot?(r=t.y,e=t.x):(r=t.x*this.cosrot-t.y*this.sinrot,e=t.y*this.cosrot+t.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),a=.5*(n+1/n),s=((o=Math.sin(this.BrA*e))*this.cosgam+i*this.singam)/a,Math.abs(Math.abs(s)-1)<EPSLN)u.x=0,u.y=s<0?-HALF_PI:HALF_PI;else{if(u.y=this.E/Math.sqrt((1+s)/(1-s)),u.y=phi2z(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(i*this.cosgam-o*this.singam,Math.cos(this.BrA*e))}return u.x+=this.lam0,u}var names$m=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],omerc={init:init$m,forward:forward$m,inverse:inverse$m,names:names$m};function init$l(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<EPSLN)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),r=Math.cos(this.lat1),n=msfnz(this.e,e,r),i=tsfnz(this.e,this.lat1,e),a=Math.sin(this.lat2),o=Math.cos(this.lat2),s=msfnz(this.e,a,o),u=tsfnz(this.e,this.lat2,a),l=tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>EPSLN?Math.log(n/s)/Math.log(i/u):e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function forward$l(t){var e=t.x,r=t.y;Math.abs(2*Math.abs(r)-Math.PI)<=EPSLN&&(r=sign(r)*(HALF_PI-2*EPSLN));var n,i,a=Math.abs(Math.abs(r)-HALF_PI);if(a>EPSLN)n=tsfnz(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((a=r*this.ns)<=0)return null;i=0}var o=this.ns*adjust_lon(e-this.long0);return t.x=this.k0*(i*Math.sin(o))+this.x0,t.y=this.k0*(this.rh-i*Math.cos(o))+this.y0,t}function inverse$l(t){var e,r,n,i,a,o=(t.x-this.x0)/this.k0,s=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(o*o+s*s),r=1):(e=-Math.sqrt(o*o+s*s),r=-1);var u=0;if(0!==e&&(u=Math.atan2(r*o,r*s)),0!==e||this.ns>0){if(r=1/this.ns,n=Math.pow(e/(this.a*this.f0),r),-9999===(i=phi2z(this.e,n)))return null}else i=-HALF_PI;return a=adjust_lon(u/this.ns+this.long0),t.x=a,t.y=i,t}var names$l=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],lcc={init:init$l,forward:forward$l,inverse:inverse$l,names:names$l};function init$k(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function forward$k(t){var e,r,n,i,a,o,s,u=t.y,l=adjust_lon(t.x-this.long0);return e=Math.pow((1+this.e*Math.sin(u))/(1-this.e*Math.sin(u)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(u/2+this.s45),this.alfa)/e)-this.s45),n=-l*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),a=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),o=this.n*a,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),t.y=s*Math.cos(o)/1,t.x=s*Math.sin(o)/1,this.czech||(t.y*=-1,t.x*=-1),t}function inverse$k(t){var e,r,n,i,a,o,s,u=t.x;t.x=t.y,t.y=u,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),i=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(e)),t.x=this.long0-r/this.alfa,o=e,s=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-t.y)<1e-10&&(s=1),o=t.y,l+=1}while(0===s&&l<15);return l>=15?null:t}var names$k=["Krovak","krovak"],krovak={init:init$k,forward:forward$k,inverse:inverse$k,names:names$k};function mlfn(t,e,r,n,i){return t*i-e*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function e0fn(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function e1fn(t){return.375*t*(1+.25*t*(1+.46875*t))}function e2fn(t){return.05859375*t*t*(1+.75*t)}function e3fn(t){return t*t*t*(35/3072)}function gN(t,e,r){var n=e*r;return t/Math.sqrt(1-n*n)}function adjust_lat(t){return Math.abs(t)<HALF_PI?t:t-sign(t)*Math.PI}function imlfn(t,e,r,n,i){var a,o;a=t/e;for(var s=0;s<15;s++)if(a+=o=(t-(e*a-r*Math.sin(2*a)+n*Math.sin(4*a)-i*Math.sin(6*a)))/(e-2*r*Math.cos(2*a)+4*n*Math.cos(4*a)-6*i*Math.cos(6*a)),Math.abs(o)<=1e-10)return a;return NaN}function init$j(){this.sphere||(this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0))}function forward$j(t){var e,r,n=t.x,i=t.y;if(n=adjust_lon(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var a=Math.sin(i),o=Math.cos(i),s=gN(this.a,this.e,a),u=Math.tan(i)*Math.tan(i),l=n*Math.cos(i),c=l*l,h=this.es*o*o/(1-this.es);e=s*l*(1-c*u*(1/6-(8-u+8*h)*c/120)),r=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*a/o*c*(.5+(5-u+6*h)*c/24)}return t.x=e+this.x0,t.y=r+this.y0,t}function inverse$j(t){t.x-=this.x0,t.y-=this.y0;var e,r,n=t.x/this.a,i=t.y/this.a;if(this.sphere){var a=i+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(a))}else{var o=imlfn(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-HALF_PI)<=EPSLN)return t.x=this.long0,t.y=HALF_PI,i<0&&(t.y*=-1),t;var s=gN(this.a,this.e,Math.sin(o)),u=s*s*s/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(o),2),c=n*this.a/s,h=c*c;e=o-s*Math.tan(o)/u*c*c*(.5-(1+3*l)*c*c/24),r=c*(1-h*(l/3+(1+3*l)*l*h/15))/Math.cos(o)}return t.x=adjust_lon(r+this.long0),t.y=adjust_lat(e),t}var names$j=["Cassini","Cassini_Soldner","cass"],cass={init:init$j,forward:forward$j,inverse:inverse$j,names:names$j};function qsfnz(t,e){var r;return t>1e-7?(1-t*t)*(e/(1-(r=t*e)*r)-.5/t*Math.log((1-r)/(1+r))):2*e}var S_POLE=1,N_POLE=2,EQUIT=3,OBLIQ=4;function init$i(){var t,e=Math.abs(this.lat0);if(this.mode=Math.abs(e-HALF_PI)<EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<EPSLN?this.EQUIT:this.OBLIQ,this.es>0)switch(this.qp=qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=qsfnz(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function forward$i(t){var e,r,n,i,a,o,s,u,l,c,h=t.x,f=t.y;if(h=adjust_lon(h-this.long0),this.sphere){if(a=Math.sin(f),c=Math.cos(f),n=Math.cos(h),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+c*n:1+this.sinph0*a+this.cosph0*c*n)<=EPSLN)return null;e=(r=Math.sqrt(2/r))*c*Math.sin(h),r*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<EPSLN)return null;r=FORTPI-.5*f,e=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(h),r*=n}}else{switch(s=0,u=0,l=0,n=Math.cos(h),i=Math.sin(h),a=Math.sin(f),o=qsfnz(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(s=o/this.qp,u=Math.sqrt(1-s*s)),this.mode){case this.OBLIQ:l=1+this.sinb1*s+this.cosb1*u*n;break;case this.EQUIT:l=1+u*n;break;case this.N_POLE:l=HALF_PI+f,o=this.qp-o;break;case this.S_POLE:l=f-HALF_PI,o=this.qp+o}if(Math.abs(l)<EPSLN)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),r=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*s-this.sinb1*u*n):(l=Math.sqrt(2/(1+u*n)))*s*this.ymf,e=this.xmf*l*u*i;break;case this.N_POLE:case this.S_POLE:o>=0?(e=(l=Math.sqrt(o))*i,r=n*(this.mode===this.S_POLE?l:-l)):e=r=0}}return t.x=this.a*e+this.x0,t.y=this.a*r+this.y0,t}function inverse$i(t){t.x-=this.x0,t.y-=this.y0;var e,r,n,i,a,o,s,u=t.x/this.a,l=t.y/this.a;if(this.sphere){var c,h=0,f=0;if((r=.5*(c=Math.sqrt(u*u+l*l)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(f=Math.sin(r),h=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(c)<=EPSLN?0:Math.asin(l*f/c),u*=f,l=h*c;break;case this.OBLIQ:r=Math.abs(c)<=EPSLN?this.lat0:Math.asin(h*this.sinph0+l*f*this.cosph0/c),u*=f*this.cosph0,l=(h-Math.sin(r)*this.sinph0)*c;break;case this.N_POLE:l=-l,r=HALF_PI-r;break;case this.S_POLE:r-=HALF_PI}e=0!==l||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,l):0}else{if(s=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,l*=this.dd,(o=Math.sqrt(u*u+l*l))<EPSLN)return t.x=this.long0,t.y=this.lat0,t;i=2*Math.asin(.5*o/this.rq),n=Math.cos(i),u*=i=Math.sin(i),this.mode===this.OBLIQ?(a=this.qp*(s=n*this.sinb1+l*i*this.cosb1/o),l=o*this.cosb1*n-l*this.sinb1*i):(a=this.qp*(s=l*i/o),l=o*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(l=-l),!(a=u*u+l*l))return t.x=this.long0,t.y=this.lat0,t;s=1-a/this.qp,this.mode===this.S_POLE&&(s=-s)}e=Math.atan2(u,l),r=authlat(Math.asin(s),this.apa)}return t.x=adjust_lon(this.long0+e),t.y=r,t}var P00=.3333333333333333,P01=.17222222222222222,P02=.10257936507936508,P10=.06388888888888888,P11=.0664021164021164,P20=.016415012942191543;function authset(t){var e,r=[];return r[0]=t*P00,r[0]+=(e=t*t)*P01,r[1]=e*P10,r[0]+=(e*=t)*P02,r[1]+=e*P11,r[2]=e*P20,r}function authlat(t,e){var r=t+t;return t+e[0]*Math.sin(r)+e[1]*Math.sin(r+r)+e[2]*Math.sin(r+r+r)}var names$i=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],laea={init:init$i,forward:forward$i,inverse:inverse$i,names:names$i,S_POLE:S_POLE,N_POLE:N_POLE,EQUIT:EQUIT,OBLIQ:OBLIQ};function asinz(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}function init$h(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function forward$h(t){var e=t.x,r=t.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=qsfnz(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*adjust_lon(e-this.long0),o=i*Math.sin(a)+this.x0,s=this.rh-i*Math.cos(a)+this.y0;return t.x=o,t.y=s,t}function inverse$h(t){var e,r,n,i,a;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),r=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),r=-1),n=0,0!==e&&(n=Math.atan2(r*t.x,r*t.y)),r=e*this.ns0/this.a,a=this.sphere?Math.asin((this.c-r*r)/(2*this.ns0)):this.phi1z(this.e3,(this.c-r*r)/this.ns0),i=adjust_lon(n/this.ns0+this.long0),t.x=i,t.y=a,t}function phi1z(t,e){var r,n,i,a,o=asinz(.5*e);if(t<EPSLN)return o;for(var s=t*t,u=1;u<=25;u++)if(o+=a=.5*(i=1-(n=t*(r=Math.sin(o)))*n)*i/Math.cos(o)*(e/(1-s)-r/i+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return o;return null}var names$h=["Albers_Conic_Equal_Area","Albers","aea"],aea={init:init$h,forward:forward$h,inverse:inverse$h,names:names$h,phi1z:phi1z};function init$g(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function forward$g(t){var e,r,n,i,a,o,s,u=t.y;return n=adjust_lon(t.x-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),(a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=EPSLN?(o=this.x0+1*this.a*r*Math.sin(n)/a,s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)/a):(o=this.x0+this.infinity_dist*r*Math.sin(n),s=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t}function inverse$g(t){var e,r,n,i,a,o;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(i=Math.atan2(e,this.rc),r=Math.sin(i),o=asinz((n=Math.cos(i))*this.sin_p14+t.y*r*this.cos_p14/e),a=Math.atan2(t.x*r,e*this.cos_p14*n-t.y*this.sin_p14*r),a=adjust_lon(this.long0+a)):(o=this.phic0,a=0),t.x=a,t.y=o,t}var names$g=["gnom"],gnom={init:init$g,forward:forward$g,inverse:inverse$g,names:names$g};function iqsfnz(t,e){var r=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-r)<1e-6)return e<0?-1*HALF_PI:HALF_PI;for(var n,i,a,o,s=Math.asin(.5*e),u=0;u<30;u++)if(i=Math.sin(s),a=Math.cos(s),o=t*i,s+=n=Math.pow(1-o*o,2)/(2*a)*(e/(1-t*t)-i/(1-o*o)+.5/t*Math.log((1-o)/(1+o))),Math.abs(n)<=1e-10)return s;return NaN}function init$f(){this.sphere||(this.k0=msfnz(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function forward$f(t){var e,r,n=t.y,i=adjust_lon(t.x-this.long0);if(this.sphere)e=this.x0+this.a*i*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);else{var a=qsfnz(this.e,Math.sin(n));e=this.x0+this.a*this.k0*i,r=this.y0+this.a*a*.5/this.k0}return t.x=e,t.y=r,t}function inverse$f(t){var e,r;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=adjust_lon(this.long0+t.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(r=iqsfnz(this.e,2*t.y*this.k0/this.a),e=adjust_lon(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=r,t}var names$f=["cea"],cea={init:init$f,forward:forward$f,inverse:inverse$f,names:names$f};function init$e(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function forward$e(t){var e=t.y,r=adjust_lon(t.x-this.long0),n=adjust_lat(e-this.lat0);return t.x=this.x0+this.a*r*this.rc,t.y=this.y0+this.a*n,t}function inverse$e(t){var e=t.y;return t.x=adjust_lon(this.long0+(t.x-this.x0)/(this.a*this.rc)),t.y=adjust_lat(this.lat0+(e-this.y0)/this.a),t}var names$e=["Equirectangular","Equidistant_Cylindrical","eqc"],eqc={init:init$e,forward:forward$e,inverse:inverse$e,names:names$e},MAX_ITER$1=20;function init$d(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.ml0=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)}function forward$d(t){var e,r,n,i=t.y,a=adjust_lon(t.x-this.long0);if(n=a*Math.sin(i),this.sphere)Math.abs(i)<=EPSLN?(e=this.a*a,r=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(i),r=this.a*(adjust_lat(i-this.lat0)+(1-Math.cos(n))/Math.tan(i)));else if(Math.abs(i)<=EPSLN)e=this.a*a,r=-1*this.ml0;else{var o=gN(this.a,this.e,Math.sin(i))/Math.tan(i);e=o*Math.sin(n),r=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+o*(1-Math.cos(n))}return t.x=e+this.x0,t.y=r+this.y0,t}function inverse$d(t){var e,r,n,i,a,o,s,u,l;if(n=t.x-this.x0,i=t.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=EPSLN)e=adjust_lon(n/this.a+this.long0),r=0;else{var c;for(s=n*n/this.a/this.a+(o=this.lat0+i/this.a)*o,u=o,a=MAX_ITER$1;a;--a)if(u+=l=-1*(o*(u*(c=Math.tan(u))+1)-u-.5*(u*u+s)*c)/((u-o)/c-1),Math.abs(l)<=EPSLN){r=u;break}e=adjust_lon(this.long0+Math.asin(n*Math.tan(u)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=EPSLN)r=0,e=adjust_lon(this.long0+n/this.a);else{var h,f,d,p,m;for(s=n*n/this.a/this.a+(o=(this.ml0+i)/this.a)*o,u=o,a=MAX_ITER$1;a;--a)if(m=this.e*Math.sin(u),h=Math.sqrt(1-m*m)*Math.tan(u),f=this.a*mlfn(this.e0,this.e1,this.e2,this.e3,u),d=this.e0-2*this.e1*Math.cos(2*u)+4*this.e2*Math.cos(4*u)-6*this.e3*Math.cos(6*u),u-=l=(o*(h*(p=f/this.a)+1)-p-.5*h*(p*p+s))/(this.es*Math.sin(2*u)*(p*p+s-2*o*p)/(4*h)+(o-p)*(h*d-2/Math.sin(2*u))-d),Math.abs(l)<=EPSLN){r=u;break}h=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),e=adjust_lon(this.long0+Math.asin(n*h/this.a)/Math.sin(r))}return t.x=e,t.y=r,t}var names$d=["Polyconic","poly"],poly={init:init$d,forward:forward$d,inverse:inverse$d,names:names$d};function init$c(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function forward$c(t){var e,r=(t.y-this.lat0)/SEC_TO_RAD*1e-5,n=t.x-this.long0,i=1,a=0;for(e=1;e<=10;e++)a+=this.A[e]*(i*=r);var o,s=a,u=n,l=1,c=0,h=0,f=0;for(e=1;e<=6;e++)o=c*s+l*u,h=h+this.B_re[e]*(l=l*s-c*u)-this.B_im[e]*(c=o),f=f+this.B_im[e]*l+this.B_re[e]*c;return t.x=f*this.a+this.x0,t.y=h*this.a+this.y0,t}function inverse$c(t){var e,r,n=(t.y-this.y0)/this.a,i=(t.x-this.x0)/this.a,a=1,o=0,s=0,u=0;for(e=1;e<=6;e++)r=o*n+a*i,s=s+this.C_re[e]*(a=a*n-o*i)-this.C_im[e]*(o=r),u=u+this.C_im[e]*a+this.C_re[e]*o;for(var l=0;l<this.iterations;l++){var c,h=s,f=u,d=n,p=i;for(e=2;e<=6;e++)c=f*s+h*u,d+=(e-1)*(this.B_re[e]*(h=h*s-f*u)-this.B_im[e]*(f=c)),p+=(e-1)*(this.B_im[e]*h+this.B_re[e]*f);h=1,f=0;var m=this.B_re[1],v=this.B_im[1];for(e=2;e<=6;e++)c=f*s+h*u,m+=e*(this.B_re[e]*(h=h*s-f*u)-this.B_im[e]*(f=c)),v+=e*(this.B_im[e]*h+this.B_re[e]*f);var g=m*m+v*v;s=(d*m+p*v)/g,u=(p*m-d*v)/g}var y=s,_=u,b=1,x=0;for(e=1;e<=9;e++)x+=this.D[e]*(b*=y);var w=this.lat0+x*SEC_TO_RAD*1e5;return t.x=this.long0+_,t.y=w,t}var names$c=["New_Zealand_Map_Grid","nzmg"],nzmg={init:init$c,forward:forward$c,inverse:inverse$c,names:names$c};function init$b(){}function forward$b(t){var e=t.y,r=adjust_lon(t.x-this.long0),n=this.x0+this.a*r,i=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return t.x=n,t.y=i,t}function inverse$b(t){t.x-=this.x0,t.y-=this.y0;var e=adjust_lon(this.long0+t.x/this.a),r=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=r,t}var names$b=["Miller_Cylindrical","mill"],mill={init:init$b,forward:forward$b,inverse:inverse$b,names:names$b},MAX_ITER=20;function init$a(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=pj_enfn(this.es)}function forward$a(t){var e,r,n=t.x,i=t.y;if(n=adjust_lon(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(i),o=MAX_ITER;o;--o){var s=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));if(i-=s,Math.abs(s)<EPSLN)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;e=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var u=Math.sin(i),l=Math.cos(i);r=this.a*pj_mlfn(i,u,l,this.en),e=this.a*n*l/Math.sqrt(1-this.es*u*u)}return t.x=e,t.y=r,t}function inverse$a(t){var e,r,n;return t.x-=this.x0,r=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,r/=this.C_x*(this.m+Math.cos(e)),this.m?e=asinz((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=asinz(Math.sin(e)/this.n)),r=adjust_lon(r+this.long0),e=adjust_lat(e)):(e=pj_inv_mlfn(t.y/this.a,this.es,this.en),(n=Math.abs(e))<HALF_PI?(n=Math.sin(e),r=adjust_lon(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-EPSLN<HALF_PI&&(r=this.long0)),t.x=r,t.y=e,t}var names$a=["Sinusoidal","sinu"],sinu={init:init$a,forward:forward$a,inverse:inverse$a,names:names$a};function init$9(){}function forward$9(t){for(var e=t.y,r=adjust_lon(t.x-this.long0),n=e,i=Math.PI*Math.sin(e);;){var a=-(n+Math.sin(n)-i)/(1+Math.cos(n));if(n+=a,Math.abs(a)<EPSLN)break}n/=2,Math.PI/2-Math.abs(e)<EPSLN&&(r=0);var o=.900316316158*this.a*r*Math.cos(n)+this.x0,s=1.4142135623731*this.a*Math.sin(n)+this.y0;return t.x=o,t.y=s,t}function inverse$9(t){var e,r;t.x-=this.x0,t.y-=this.y0,r=t.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),e=Math.asin(r);var n=adjust_lon(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*e+Math.sin(2*e))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return t.x=n,t.y=i,t}var names$9=["Mollweide","moll"],moll={init:init$9,forward:forward$9,inverse:inverse$9,names:names$9};function init$8(){Math.abs(this.lat1+this.lat2)<EPSLN||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=e0fn(this.es),this.e1=e1fn(this.es),this.e2=e2fn(this.es),this.e3=e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=msfnz(this.e,this.sinphi,this.cosphi),this.ml1=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<EPSLN?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=msfnz(this.e,this.sinphi,this.cosphi),this.ml2=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function forward$8(t){var e,r=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var i=mlfn(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-i)}var a=this.ns*adjust_lon(r-this.long0),o=this.x0+e*Math.sin(a),s=this.y0+this.rh-e*Math.cos(a);return t.x=o,t.y=s,t}function inverse$8(t){var e,r,n,i;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(r=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(r=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;return 0!==r&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere?(i=adjust_lon(this.long0+a/this.ns),n=adjust_lat(this.g-r/this.a),t.x=i,t.y=n,t):(n=imlfn(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=adjust_lon(this.long0+a/this.ns),t.x=i,t.y=n,t)}var names$8=["Equidistant_Conic","eqdc"],eqdc={init:init$8,forward:forward$8,inverse:inverse$8,names:names$8};function init$7(){this.R=this.a}function forward$7(t){var e,r,n=t.y,i=adjust_lon(t.x-this.long0);Math.abs(n)<=EPSLN&&(e=this.x0+this.R*i,r=this.y0);var a=asinz(2*Math.abs(n/Math.PI));(Math.abs(i)<=EPSLN||Math.abs(Math.abs(n)-HALF_PI)<=EPSLN)&&(e=this.x0,r=n>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),s=o*o,u=Math.sin(a),l=Math.cos(a),c=l/(u+l-1),h=c*(2/u-1),f=h*h,d=Math.PI*this.R*(o*(c-f)+Math.sqrt(s*(c-f)*(c-f)-(f+s)*(c*c-f)))/(f+s);i<0&&(d=-d),e=this.x0+d;var p=s+c;return d=Math.PI*this.R*(h*p-o*Math.sqrt((f+s)*(s+1)-p*p))/(f+s),r=n>=0?this.y0+d:this.y0-d,t.x=e,t.y=r,t}function inverse$7(t){var e,r,n,i,a,o,s,u,l,c,h,f;return t.x-=this.x0,t.y-=this.y0,h=Math.PI*this.R,a=(n=t.x/h)*n+(i=t.y/h)*i,h=3*(i*i/(u=-2*(o=-Math.abs(i)*(1+a))+1+2*i*i+a*a)+(2*(s=o-2*i*i+n*n)*s*s/u/u/u-9*o*s/u/u)/27)/(l=(o-s*s/3/u)/u)/(c=2*Math.sqrt(-l/3)),Math.abs(h)>1&&(h=h>=0?1:-1),f=Math.acos(h)/3,r=t.y>=0?(-c*Math.cos(f+Math.PI/3)-s/3/u)*Math.PI:-(-c*Math.cos(f+Math.PI/3)-s/3/u)*Math.PI,e=Math.abs(n)<EPSLN?this.long0:adjust_lon(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-i*i)+a*a))/2/n),t.x=e,t.y=r,t}var names$7=["Van_der_Grinten_I","VanDerGrinten","vandg"],vandg={init:init$7,forward:forward$7,inverse:inverse$7,names:names$7};function init$6(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function forward$6(t){var e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M=t.x,A=t.y,E=Math.sin(t.y),S=Math.cos(t.y),T=adjust_lon(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=EPSLN?(t.x=this.x0+this.a*(HALF_PI-A)*Math.sin(T),t.y=this.y0-this.a*(HALF_PI-A)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=EPSLN?(t.x=this.x0+this.a*(HALF_PI+A)*Math.sin(T),t.y=this.y0+this.a*(HALF_PI+A)*Math.cos(T),t):(y=this.sin_p12*E+this.cos_p12*S*Math.cos(T),g=(v=Math.acos(y))?v/Math.sin(v):1,t.x=this.x0+this.a*g*S*Math.sin(T),t.y=this.y0+this.a*g*(this.cos_p12*E-this.sin_p12*S*Math.cos(T)),t):(e=e0fn(this.es),r=e1fn(this.es),n=e2fn(this.es),i=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(a=this.a*mlfn(e,r,n,i,HALF_PI),o=this.a*mlfn(e,r,n,i,A),t.x=this.x0+(a-o)*Math.sin(T),t.y=this.y0-(a-o)*Math.cos(T),t):Math.abs(this.sin_p12+1)<=EPSLN?(a=this.a*mlfn(e,r,n,i,HALF_PI),o=this.a*mlfn(e,r,n,i,A),t.x=this.x0+(a+o)*Math.sin(T),t.y=this.y0+(a+o)*Math.cos(T),t):(s=E/S,u=gN(this.a,this.e,this.sin_p12),l=gN(this.a,this.e,E),c=Math.atan((1-this.es)*s+this.es*u*this.sin_p12/(l*S)),_=0===(h=Math.atan2(Math.sin(T),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(T)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(h)-Math.PI)<=EPSLN?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(T)*Math.cos(c)/Math.sin(h)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),d=this.e*this.cos_p12*Math.cos(h)/Math.sqrt(1-this.es),t.x=this.x0+(v=u*_*(1-(b=_*_)*(m=d*d)*(1-m)/6+(x=b*_)/8*(p=f*d)*(1-2*m)+(w=x*_)/120*(m*(4-7*m)-3*f*f*(1-7*m))-w*_/48*p))*Math.sin(h),t.y=this.y0+v*Math.cos(h),t))}function inverse$6(t){var e,r,n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*HALF_PI*this.a)return;return r=e/this.a,n=Math.sin(r),i=Math.cos(r),a=this.long0,Math.abs(e)<=EPSLN?o=this.lat0:(o=asinz(i*this.sin_p12+t.y*n*this.cos_p12/e),s=Math.abs(this.lat0)-HALF_PI,a=Math.abs(s)<=EPSLN?adjust_lon(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)):adjust_lon(this.long0+Math.atan2(t.x*n,e*this.cos_p12*i-t.y*this.sin_p12*n))),t.x=a,t.y=o,t}return u=e0fn(this.es),l=e1fn(this.es),c=e2fn(this.es),h=e3fn(this.es),Math.abs(this.sin_p12-1)<=EPSLN?(o=imlfn(((f=this.a*mlfn(u,l,c,h,HALF_PI))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,u,l,c,h),a=adjust_lon(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=o,t):Math.abs(this.sin_p12+1)<=EPSLN?(f=this.a*mlfn(u,l,c,h,HALF_PI),o=imlfn(((e=Math.sqrt(t.x*t.x+t.y*t.y))-f)/this.a,u,l,c,h),a=adjust_lon(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=o,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),m=Math.atan2(t.x,t.y),d=gN(this.a,this.e,this.sin_p12),v=Math.cos(m),_=3*this.es*(1-(y=-(g=this.e*this.cos_p12*v)*g/(1-this.es)))*this.sin_p12*this.cos_p12*v/(1-this.es),w=1-y*(x=(b=e/d)-y*(1+y)*Math.pow(b,3)/6-_*(1+3*y)*Math.pow(b,4)/24)*x/2-b*x*x*x/6,p=Math.asin(this.sin_p12*Math.cos(x)+this.cos_p12*Math.sin(x)*v),a=adjust_lon(this.long0+Math.asin(Math.sin(m)*Math.sin(x)/Math.cos(p))),M=Math.sin(p),o=Math.atan2((M-this.es*w*this.sin_p12)*Math.tan(p),M*(1-this.es)),t.x=a,t.y=o,t)}var names$6=["Azimuthal_Equidistant","aeqd"],aeqd={init:init$6,forward:forward$6,inverse:inverse$6,names:names$6};function init$5(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function forward$5(t){var e,r,n,i,a,o,s,u=t.y;return n=adjust_lon(t.x-this.long0),e=Math.sin(u),r=Math.cos(u),i=Math.cos(n),((a=this.sin_p14*e+this.cos_p14*r*i)>0||Math.abs(a)<=EPSLN)&&(o=1*this.a*r*Math.sin(n),s=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*r*i)),t.x=o,t.y=s,t}function inverse$5(t){var e,r,n,i,a,o,s;return t.x-=this.x0,t.y-=this.y0,r=asinz((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(e)<=EPSLN?(s=this.lat0,t.x=o,t.y=s,t):(s=asinz(i*this.sin_p14+t.y*n*this.cos_p14/e),a=Math.abs(this.lat0)-HALF_PI,Math.abs(a)<=EPSLN?(o=adjust_lon(this.lat0>=0?this.long0+Math.atan2(t.x,-t.y):this.long0-Math.atan2(-t.x,t.y)),t.x=o,t.y=s,t):(o=adjust_lon(this.long0+Math.atan2(t.x*n,e*this.cos_p14*i-t.y*this.sin_p14*n)),t.x=o,t.y=s,t))}var names$5=["ortho"],ortho$1={init:init$5,forward:forward$5,inverse:inverse$5,names:names$5},FACE_ENUM={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},AREA_ENUM={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function init$4(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.face=this.lat0>=HALF_PI-FORTPI/2?FACE_ENUM.TOP:this.lat0<=-(HALF_PI-FORTPI/2)?FACE_ENUM.BOTTOM:Math.abs(this.long0)<=FORTPI?FACE_ENUM.FRONT:Math.abs(this.long0)<=HALF_PI+FORTPI?this.long0>0?FACE_ENUM.RIGHT:FACE_ENUM.LEFT:FACE_ENUM.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function forward$4(t){var e,r,n,i,a,o,s={x:0,y:0},u={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,r=t.x,this.face===FACE_ENUM.TOP)i=HALF_PI-e,r>=FORTPI&&r<=HALF_PI+FORTPI?(u.value=AREA_ENUM.AREA_0,n=r-HALF_PI):r>HALF_PI+FORTPI||r<=-(HALF_PI+FORTPI)?(u.value=AREA_ENUM.AREA_1,n=r>0?r-SPI:r+SPI):r>-(HALF_PI+FORTPI)&&r<=-FORTPI?(u.value=AREA_ENUM.AREA_2,n=r+HALF_PI):(u.value=AREA_ENUM.AREA_3,n=r);else if(this.face===FACE_ENUM.BOTTOM)i=HALF_PI+e,r>=FORTPI&&r<=HALF_PI+FORTPI?(u.value=AREA_ENUM.AREA_0,n=-r+HALF_PI):r<FORTPI&&r>=-FORTPI?(u.value=AREA_ENUM.AREA_1,n=-r):r<-FORTPI&&r>=-(HALF_PI+FORTPI)?(u.value=AREA_ENUM.AREA_2,n=-r-HALF_PI):(u.value=AREA_ENUM.AREA_3,n=r>0?-r+SPI:-r-SPI);else{var l,c,h,f,d,p;this.face===FACE_ENUM.RIGHT?r=qsc_shift_lon_origin(r,+HALF_PI):this.face===FACE_ENUM.BACK?r=qsc_shift_lon_origin(r,+SPI):this.face===FACE_ENUM.LEFT&&(r=qsc_shift_lon_origin(r,-HALF_PI)),f=Math.sin(e),d=Math.cos(e),p=Math.sin(r),l=d*Math.cos(r),c=d*p,h=f,this.face===FACE_ENUM.FRONT?n=qsc_fwd_equat_face_theta(i=Math.acos(l),h,c,u):this.face===FACE_ENUM.RIGHT?n=qsc_fwd_equat_face_theta(i=Math.acos(c),h,-l,u):this.face===FACE_ENUM.BACK?n=qsc_fwd_equat_face_theta(i=Math.acos(-l),h,-c,u):this.face===FACE_ENUM.LEFT?n=qsc_fwd_equat_face_theta(i=Math.acos(-c),h,l,u):(i=n=0,u.value=AREA_ENUM.AREA_0)}return o=Math.atan(12/SPI*(n+Math.acos(Math.sin(n)*Math.cos(FORTPI))-HALF_PI)),a=Math.sqrt((1-Math.cos(i))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(n))))),u.value===AREA_ENUM.AREA_1?o+=HALF_PI:u.value===AREA_ENUM.AREA_2?o+=SPI:u.value===AREA_ENUM.AREA_3&&(o+=1.5*SPI),s.x=a*Math.cos(o),s.y=a*Math.sin(o),s.x=s.x*this.a+this.x0,s.y=s.y*this.a+this.y0,t.x=s.x,t.y=s.y,t}function inverse$4(t){var e,r,n,i,a,o,s,u,l,c,h,f,d={lam:0,phi:0},p={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,r=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?p.value=AREA_ENUM.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(p.value=AREA_ENUM.AREA_1,e-=HALF_PI):t.x<0&&-t.x>=Math.abs(t.y)?(p.value=AREA_ENUM.AREA_2,e=e<0?e+SPI:e-SPI):(p.value=AREA_ENUM.AREA_3,e+=HALF_PI),l=SPI/12*Math.tan(e),a=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),o=Math.atan(a),(s=1-(n=Math.cos(e))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(o)))))<-1?s=-1:s>1&&(s=1),this.face===FACE_ENUM.TOP)u=Math.acos(s),d.phi=HALF_PI-u,d.lam=p.value===AREA_ENUM.AREA_0?o+HALF_PI:p.value===AREA_ENUM.AREA_1?o<0?o+SPI:o-SPI:p.value===AREA_ENUM.AREA_2?o-HALF_PI:o;else if(this.face===FACE_ENUM.BOTTOM)u=Math.acos(s),d.phi=u-HALF_PI,d.lam=p.value===AREA_ENUM.AREA_0?-o+HALF_PI:p.value===AREA_ENUM.AREA_1?-o:p.value===AREA_ENUM.AREA_2?-o-HALF_PI:o<0?-o-SPI:-o+SPI;else{var m,v,g;l=(m=s)*m,v=(l+=(g=l>=1?0:Math.sqrt(1-l)*Math.sin(o))*g)>=1?0:Math.sqrt(1-l),p.value===AREA_ENUM.AREA_1?(l=v,v=-g,g=l):p.value===AREA_ENUM.AREA_2?(v=-v,g=-g):p.value===AREA_ENUM.AREA_3&&(l=v,v=g,g=-l),this.face===FACE_ENUM.RIGHT?(l=m,m=-v,v=l):this.face===FACE_ENUM.BACK?(m=-m,v=-v):this.face===FACE_ENUM.LEFT&&(l=m,m=v,v=-l),d.phi=Math.acos(-g)-HALF_PI,d.lam=Math.atan2(v,m),this.face===FACE_ENUM.RIGHT?d.lam=qsc_shift_lon_origin(d.lam,-HALF_PI):this.face===FACE_ENUM.BACK?d.lam=qsc_shift_lon_origin(d.lam,-SPI):this.face===FACE_ENUM.LEFT&&(d.lam=qsc_shift_lon_origin(d.lam,+HALF_PI))}return 0!==this.es&&(c=d.phi<0?1:0,h=Math.tan(d.phi),f=this.b/Math.sqrt(h*h+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),c&&(d.phi=-d.phi)),d.lam+=this.long0,t.x=d.lam,t.y=d.phi,t}function qsc_fwd_equat_face_theta(t,e,r,n){var i;return t<EPSLN?(n.value=AREA_ENUM.AREA_0,i=0):(i=Math.atan2(e,r),Math.abs(i)<=FORTPI?n.value=AREA_ENUM.AREA_0:i>FORTPI&&i<=HALF_PI+FORTPI?(n.value=AREA_ENUM.AREA_1,i-=HALF_PI):i>HALF_PI+FORTPI||i<=-(HALF_PI+FORTPI)?(n.value=AREA_ENUM.AREA_2,i=i>=0?i-SPI:i+SPI):(n.value=AREA_ENUM.AREA_3,i+=HALF_PI)),i}function qsc_shift_lon_origin(t,e){var r=t+e;return r<-SPI?r+=TWO_PI:r>+SPI&&(r-=TWO_PI),r}var names$4=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],qsc={init:init$4,forward:forward$4,inverse:inverse$4,names:names$4},COEFS_X=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],COEFS_Y=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],FXC=.8487,FYC=1.3523,C1=R2D/5,RC1=1/C1,NODES=18,poly3_val=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},poly3_der=function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])};function newton_rapshon(t,e,r,n){for(var i=e;n;--n){var a=t(i);if(i-=a,Math.abs(a)<r)break}return i}function init$3(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function forward$3(t){var e=adjust_lon(t.x-this.long0),r=Math.abs(t.y),n=Math.floor(r*C1);n<0?n=0:n>=NODES&&(n=NODES-1);var i={x:poly3_val(COEFS_X[n],r=R2D*(r-RC1*n))*e,y:poly3_val(COEFS_Y[n],r)};return t.y<0&&(i.y=-i.y),i.x=i.x*this.a*FXC+this.x0,i.y=i.y*this.a*FYC+this.y0,i}function inverse$3(t){var e={x:(t.x-this.x0)/(this.a*FXC),y:Math.abs(t.y-this.y0)/(this.a*FYC)};if(e.y>=1)e.x/=COEFS_X[NODES][0],e.y=t.y<0?-HALF_PI:HALF_PI;else{var r=Math.floor(e.y*NODES);for(r<0?r=0:r>=NODES&&(r=NODES-1);;)if(COEFS_Y[r][0]>e.y)--r;else{if(!(COEFS_Y[r+1][0]<=e.y))break;++r}var n=COEFS_Y[r],i=5*(e.y-n[0])/(COEFS_Y[r+1][0]-n[0]);i=newton_rapshon((function(t){return(poly3_val(n,t)-e.y)/poly3_der(n,t)}),i,EPSLN,100),e.x/=poly3_val(COEFS_X[r],i),e.y=(5*r+i)*D2R$1,t.y<0&&(e.y=-e.y)}return e.x=adjust_lon(e.x+this.long0),e}var names$3=["Robinson","robin"],robin={init:init$3,forward:forward$3,inverse:inverse$3,names:names$3};function init$2(){this.name="geocent"}function forward$2(t){return geodeticToGeocentric(t,this.es,this.a)}function inverse$2(t){return geocentricToGeodetic(t,this.es,this.a,this.b)}var names$2=["Geocentric","geocentric","geocent","Geocent"],geocent={init:init$2,forward:forward$2,inverse:inverse$2,names:names$2},mode={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},params={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function init$1(){if(Object.keys(params).forEach(function(t){if(void 0===this[t])this[t]=params[t].def;else{if(params[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);params[t].num&&(this[t]=parseFloat(this[t]))}params[t].degrees&&(this[t]=this[t]*D2R$1)}.bind(this)),Math.abs(Math.abs(this.lat0)-HALF_PI)<EPSLN?this.mode=this.lat0<0?mode.S_POLE:mode.N_POLE:Math.abs(this.lat0)<EPSLN?this.mode=mode.EQUIT:(this.mode=mode.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var t=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(t),this.sw=Math.sin(t)}function forward$1(t){t.x-=this.long0;var e,r,n,i,a=Math.sin(t.y),o=Math.cos(t.y),s=Math.cos(t.x);switch(this.mode){case mode.OBLIQ:r=this.sinph0*a+this.cosph0*o*s;break;case mode.EQUIT:r=o*s;break;case mode.S_POLE:r=-a;break;case mode.N_POLE:r=a}switch(e=(r=this.pn1/(this.p-r))*o*Math.sin(t.x),this.mode){case mode.OBLIQ:r*=this.cosph0*a-this.sinph0*o*s;break;case mode.EQUIT:r*=a;break;case mode.N_POLE:r*=-o*s;break;case mode.S_POLE:r*=o*s}return e=(e*this.cg-r*this.sg)*this.cw*(i=1/((n=r*this.cg+e*this.sg)*this.sw*this.h1+this.cw)),r=n*i,t.x=e*this.a,t.y=r*this.a,t}function inverse$1(t){t.x/=this.a,t.y/=this.a;var e,r,n,i={x:t.x,y:t.y};t.x=(e=this.pn1*t.x*(n=1/(this.pn1-t.y*this.sw)))*this.cg+(r=this.pn1*t.y*this.cw*n)*this.sg,t.y=r*this.cg-e*this.sg;var a=hypot(t.x,t.y);if(Math.abs(a)<EPSLN)i.x=0,i.y=t.y;else{var o,s;switch(s=1-a*a*this.pfact,s=(this.p-Math.sqrt(s))/(this.pn1/a+a/this.pn1),o=Math.sqrt(1-s*s),this.mode){case mode.OBLIQ:i.y=Math.asin(o*this.sinph0+t.y*s*this.cosph0/a),t.y=(o-this.sinph0*Math.sin(i.y))*a,t.x*=s*this.cosph0;break;case mode.EQUIT:i.y=Math.asin(t.y*s/a),t.y=o*a,t.x*=s;break;case mode.N_POLE:i.y=Math.asin(o),t.y=-t.y;break;case mode.S_POLE:i.y=-Math.asin(o)}i.x=Math.atan2(t.x,t.y)}return t.x=i.x+this.long0,t.y=i.y,t}var names$1=["Tilted_Perspective","tpers"],tpers={init:init$1,forward:forward$1,inverse:inverse$1,names:names$1};function init(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var t=1-this.es,e=1/t;this.radius_p=Math.sqrt(t),this.radius_p2=t,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function forward(t){var e,r,n,i,a=t.x,o=t.y;if(a-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var s=this.radius_p/hypot(this.radius_p*Math.cos(o),Math.sin(o));if(r=s*Math.cos(a)*Math.cos(o),n=s*Math.sin(a)*Math.cos(o),i=s*Math.sin(o),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return t.x=Number.NaN,t.y=Number.NaN,t;e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/hypot(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/hypot(n,e)))}else"sphere"===this.shape&&(e=Math.cos(o),r=Math.cos(a)*e,n=Math.sin(a)*e,i=Math.sin(o),e=this.radius_g-r,this.flip_axis?(t.x=this.radius_g_1*Math.atan(n/hypot(i,e)),t.y=this.radius_g_1*Math.atan(i/e)):(t.x=this.radius_g_1*Math.atan(n/e),t.y=this.radius_g_1*Math.atan(i/hypot(n,e))));return t.x=t.x*this.a,t.y=t.y*this.a,t}function inverse(t){var e,r,n,i,a=-1,o=0,s=0;if(t.x=t.x/this.a,t.y=t.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*hypot(1,s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*hypot(1,o));var u=s/this.radius_p;if((n=(r=2*this.radius_g*a)*r-4*(e=o*o+u*u+a*a)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a),t.y=Math.atan(this.radius_p_inv2*Math.tan(t.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(t.y/this.radius_g_1),o=Math.tan(t.x/this.radius_g_1)*Math.sqrt(1+s*s)):(o=Math.tan(t.x/this.radius_g_1),s=Math.tan(t.y/this.radius_g_1)*Math.sqrt(1+o*o)),(n=(r=2*this.radius_g*a)*r-4*(e=o*o+s*s+a*a)*this.C)<0)return t.x=Number.NaN,t.y=Number.NaN,t;i=(-r-Math.sqrt(n))/(2*e),a=this.radius_g+i*a,o*=i,s*=i,t.x=Math.atan2(o,a),t.y=Math.atan(s*Math.cos(t.x)/a)}return t.x=t.x+this.long0,t}var names=["Geostationary Satellite View","Geostationary_Satellite","geos"],geos={init:init,forward:forward,inverse:inverse,names:names};function includedProjections(t){t.Proj.projections.add(tmerc),t.Proj.projections.add(etmerc),t.Proj.projections.add(utm),t.Proj.projections.add(sterea),t.Proj.projections.add(stere),t.Proj.projections.add(somerc),t.Proj.projections.add(omerc),t.Proj.projections.add(lcc),t.Proj.projections.add(krovak),t.Proj.projections.add(cass),t.Proj.projections.add(laea),t.Proj.projections.add(aea),t.Proj.projections.add(gnom),t.Proj.projections.add(cea),t.Proj.projections.add(eqc),t.Proj.projections.add(poly),t.Proj.projections.add(nzmg),t.Proj.projections.add(mill),t.Proj.projections.add(sinu),t.Proj.projections.add(moll),t.Proj.projections.add(eqdc),t.Proj.projections.add(vandg),t.Proj.projections.add(aeqd),t.Proj.projections.add(ortho$1),t.Proj.projections.add(qsc),t.Proj.projections.add(robin),t.Proj.projections.add(geocent),t.Proj.projections.add(tpers),t.Proj.projections.add(geos)}proj4.defaultDatum="WGS84",proj4.Proj=Projection$1,proj4.WGS84=new proj4.Proj("WGS84"),proj4.Point=Point,proj4.toPoint=common,proj4.defs=defs,proj4.nadgrid=nadgrid,proj4.transform=transform,proj4.mgrs=mgrs,proj4.version="__VERSION__",includedProjections(proj4);var tween_cjs=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var r,n={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*n.Bounce.In(2*t):.5*n.Bounce.Out(2*t-1)+.5}}},i="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},a=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=i()),void 0===e&&(e=!1);var r=Object.keys(this._tweens);if(0===r.length)return!1;for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var a=this._tweens[r[n]];a&&!1===a.update(t,!e)&&!e&&delete this._tweens[r[n]]}r=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),o={Linear:function(t,e){var r=t.length-1,n=r*e,i=Math.floor(n),a=o.Utils.Linear;return e<0?a(t[0],t[1],n):e>1?a(t[r],t[r-1],r-n):a(t[i],t[i+1>r?r:i+1],n-i)},Bezier:function(t,e){for(var r=0,n=t.length-1,i=Math.pow,a=o.Utils.Bernstein,s=0;s<=n;s++)r+=i(1-e,n-s)*i(e,s)*t[s]*a(n,s);return r},CatmullRom:function(t,e){var r=t.length-1,n=r*e,i=Math.floor(n),a=o.Utils.CatmullRom;return t[0]===t[r]?(e<0&&(i=Math.floor(n=r*(1+e))),a(t[(i-1+r)%r],t[i],t[(i+1)%r],t[(i+2)%r],n-i)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[r]-(a(t[r],t[r],t[r-1],t[r-1],n-r)-t[r]):a(t[i?i-1:0],t[i],t[r<i+1?r:i+1],t[r<i+2?r:i+2],n-i)},Utils:{Linear:function(t,e,r){return(e-t)*r+t},Bernstein:function(t,e){var r=o.Utils.Factorial;return r(t)/r(e)/r(t-e)},Factorial:(r=[1],function(t){var e=1;if(r[t])return r[t];for(var n=t;n>1;n--)e*=n;return r[t]=e,e}),CatmullRom:function(t,e,r,n,i){var a=.5*(r-t),o=.5*(n-e),s=i*i;return(2*e-2*r+a+o)*(i*s)+(-3*e+3*r-2*a-o)*s+a*i+e}}},s=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),u=new a,l=function(){function t(t,e){void 0===e&&(e=u),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=n.Linear.None,this._interpolationFunction=o.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=s.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?i()+parseFloat(t):t:i(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,r,n){for(var i in r){var a=t[i],o=Array.isArray(a),s=o?"array":typeof a,u=!o&&Array.isArray(r[i]);if("undefined"!==s&&"function"!==s){if(u){var l=r[i];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,a)),r[i]=[a].concat(l)}if("object"!==s&&!o||!a||u)void 0===e[i]&&(e[i]=a),o||(e[i]*=1),n[i]=u?r[i].slice().reverse():e[i]||0;else{for(var c in e[i]=o?[]:{},a)e[i][c]=a[c];n[i]=o?[]:{},this._setupProperties(a,e[i],r[i],n[i])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=i()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=i()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=i()),void 0===e&&(e=!0),this._isPaused)return!0;var r,n;if(!this._goToEnd&&!this._isPlaying){if(t>this._startTime+this._duration)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),n=(t-this._startTime)/this._duration;var a=this._easingFunction(n=0===this._duration||n>1?1:n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,a),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),1===n){if(this._repeat>0){for(r in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[r]||(this._valuesStartRepeat[r]=this._valuesStartRepeat[r]+parseFloat(this._valuesEnd[r])),this._yoyo&&this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];return this._yoyo&&(this._reversed=!this._reversed),this._startTime=void 0!==this._repeatDelayTime?t+this._repeatDelayTime:t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var o=0,s=this._chainedTweens.length;o<s;o++)this._chainedTweens[o].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,r,n){for(var i in r)if(void 0!==e[i]){var a=e[i]||0,o=r[i],s=Array.isArray(t[i]),u=Array.isArray(o);!s&&u?t[i]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(t[i],a,o,n):"number"==typeof(o=this._handleRelativeValue(a,o))&&(t[i]=a+(o-a)*n)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],r=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof r?this._valuesStartRepeat[t]+parseFloat(r):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),c="18.6.4",h=s.nextId,f=u,d=f.getAll.bind(f),p=f.removeAll.bind(f),m=f.add.bind(f),v=f.remove.bind(f),g=f.update.bind(f),y={Easing:n,Group:a,Interpolation:o,now:i,Sequence:s,nextId:h,Tween:l,VERSION:c,getAll:d,removeAll:p,add:m,remove:v,update:g};e.Easing=n,e.Group=a,e.Interpolation=o,e.Sequence=s,e.Tween=l,e.VERSION=c,e.add=m,e.default=y,e.getAll=d,e.nextId=h,e.now=i,e.remove=v,e.removeAll=p,e.update=g})),TWEEN=unwrapExports(tween_cjs);function transformProj4(t,e,r){return proj4("EPSG:"+t,"EPSG:"+e,[r[0],r[1]])}function deepClone(t){let e=null;return e="Mesh"===t.type||"Sprite"===t.type?new Mesh(t.geometry.clone(!1),t.material.clone(!1)):t.clone(!1),e.name=t.name,function(t,e){t.position.x=e.position.x,t.position.y=e.position.y,t.position.z=e.position.z,t.rotation.x=e.rotation.x,t.rotation.y=e.rotation.y,t.rotation.z=e.rotation.z,t.scale.x=e.scale.x,t.scale.y=e.scale.y,t.scale.z=e.scale.z}(e,t),t.children&&t.children.length>0&&t.children.forEach((t=>{e.add(deepClone(t))})),e}function fade(t,e,r,n){let i,a=JSON.parse(JSON.stringify(e));const o=r;let s=t;s.visible=!0,function(t){"Group"===t.type?t.children.forEach((t=>{t.position.z=e.height})):t.position.z=e.height}(s),new TWEEN.Tween(a).to(o,n).onComplete((function(){})).start();let u=a.height;!function t(){let e=a.height;const r=e-u;if("Group"===s.type?s.children.forEach((t=>{t.translateY(r)})):s.translateY(r),s.traverse((function(t){t instanceof Mesh&&(t.material.transparent=!0,t.material.opacity=a.opacity)})),u=e,a.opacity===o.opacity&&i)return cancelAnimationFrame(i),s.traverse((function(t){t instanceof Mesh&&(t.material.transparent=!0)})),void(0===a.opacity&&(s.visible=!1));TWEEN.update(),i=window.requestAnimationFrame(t)}()}function setModel(t,e,r,n,i,a){let o=[];e.forEach((e=>{let r=e.coordinate,s=a?deepClone(n):n.clone();for(let t in e)s.userData[t]=e[t];let u=t.projectToWorld(r);s.position.set(u.x-i.x,u.y-i.y,u.z-i.z),s.visible=!0,o.push(s)}));let s=t.Object3D({obj:o});return s.setCoords(r),t.add(s),s}function getFlyCenter(t,e,r){let n=e*Math.PI/180,i=r*Math.PI/180,a=transformProj4("4326","3857",t),o=t[2]*Math.tan(n)*1.17,s=o*Math.cos(i),u=o*Math.sin(i);return transformProj4("3857","4326",[a[0]+u,a[1]+s])}function tb_translate(t,e,r){let n=function(t,e){let r=e;if(t)switch(t){case"4326":r=e;break;case"3857":r=function(t){let e=[];for(let r=0;r<t.length;r++){let n=proj4("EPSG:3857","EPSG:4326",[t[r][0],t[r][1]]);e.push([n[0],n[1],t[r][2]])}return e}(e)}return r}(t,e),i=[];for(let t=0;t<n.length;t++){let e=r.projectToWorld([n[t][0],n[t][1]]);i.push([e.x,e.y,n[t][2]])}return i}function getDataBound(t,e){let r=[t[0][0],t[0][1]],n=[t[0][0],t[0][1]],i=t[0][2],a=t[0][2];for(let e=0;e<t.length;e++){let o=t[e],s=o[0],u=o[1];s<r[0]&&(r[0]=s),s>n[0]&&(n[0]=s),u<r[1]&&(r[1]=u),u>n[1]&&(n[1]=u);let l=o[2];l>i&&(i=l),l<a&&(a=l)}let o=n[0]-r[0],s=n[1]-r[1];return r[0]-=e*o,r[1]-=e*s,n[0]+=e*o,n[1]+=e*s,{minBound:r,maxBound:n,max:i,min:a}}function getDataBoundValue(t,e,r){let n=[];for(let r=0;r<t.length;r++){let i=e.projectToWorld(t[r]);n.push([i.x,i.y,i.z])}let i=[n[0][0],n[0][1]],a=[n[0][0],n[0][1]],o=0;for(let t=0;t<n.length;t++){let e=n[t],r=e[0],s=e[1];r<i[0]&&(i[0]=r),r>a[0]&&(a[0]=r),s<i[1]&&(i[1]=s),s>a[1]&&(a[1]=s),o+=e[2]}let s=a[0]-i[0],u=a[1]-i[1];return i[0]-=r*s,i[1]-=r*u,a[0]+=r*s,a[1]+=r*u,{minBound:i,maxBound:a,average:o/n.length}}function getDataBound_max(t){let e=t[0][2],r=t[0][2];for(let n=0;n<t.length;n++){let i=t[n][2];i>e&&(e=i),i<r&&(r=i)}return{max:e,min:r}}function getMaterialSide(t){let e=FrontSide;return t&&("DoubleSide"===t?e=DoubleSide$c:"BackSide"===t&&(e=BackSide)),e}function clearMeshCache(t,e){if(e){let r=e.indexOf(t.material);r>-1&&e.splice(r,1)}t.geometry.dispose(),t.geometry=null,t.material instanceof Array?t.material.map((t=>{t.texture&&(t.texture.dispose(),t.texture=null,delete t.texture),t.dispose()})):(t.material.texture&&(t.material.texture.dispose(),t.material.texture=null,delete t.material.texture),t.material.dispose()),t.material=null,t.parent=null;for(let e in t)delete t[e]}function clearGroup(t,e){const r=t=>{if(t.children&&t.children.length)for(let n=t.children.length-1;n>-1;n--){let i=t.children[n];i instanceof Mesh?(t.remove(i),clearMeshCache(i,e),i.parent=null,i=null):(t.remove(i),r(i),i.parent=null,i=null)}else t instanceof Mesh&&(clearMeshCache(t,e),t.parent=null,t=null)};t.parent.remove(t),r(t),t.parent=null;for(let e in t)delete t[e];t=null}UniformsLib.line={linewidth:{value:1},resolution:{value:new Vector2$3(1,1)},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:"\n\t\t#include <common>\n\t\t#include <color_pars_vertex>\n\t\t#include <fog_pars_vertex>\n\t\t#include <logdepthbuf_pars_vertex>\n\t\t#include <clipping_planes_pars_vertex>\n\n\t\tuniform float linewidth;\n\t\tuniform vec2 resolution;\n\n\t\tattribute vec3 instanceStart;\n\t\tattribute vec3 instanceEnd;\n\n\t\tattribute vec3 instanceColorStart;\n\t\tattribute vec3 instanceColorEnd;\n\n\t\tvarying vec2 vUv;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashScale;\n\t\t\tattribute float instanceDistanceStart;\n\t\t\tattribute float instanceDistanceEnd;\n\t\t\tvarying float vLineDistance;\n\n\t\t#endif\n\n\t\tvoid trimSegment( const in vec4 start, inout vec4 end ) {\n\n\t\t\t// trim end segment so it terminates between the camera plane and the near plane\n\n\t\t\t// conservative estimate of the near plane\n\t\t\tfloat a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column\n\t\t\tfloat b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column\n\t\t\tfloat nearEstimate = - 0.5 * b / a;\n\n\t\t\tfloat alpha = ( nearEstimate - start.z ) / ( end.z - start.z );\n\n\t\t\tend.xyz = mix( start.xyz, end.xyz, alpha );\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\t#ifdef USE_COLOR\n\n\t\t\t\tvColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;\n\n\t\t\t#endif\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tvLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;\n\n\t\t\t#endif\n\n\t\t\tfloat aspect = resolution.x / resolution.y;\n\n\t\t\tvUv = uv;\n\n\t\t\t// camera space\n\t\t\tvec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );\n\t\t\tvec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );\n\n\t\t\t// special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n\t\t\t// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n\t\t\t// but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n\t\t\t// perhaps there is a more elegant solution -- WestLangley\n\n\t\t\tbool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column\n\n\t\t\tif ( perspective ) {\n\n\t\t\t\tif ( start.z < 0.0 && end.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( start, end );\n\n\t\t\t\t} else if ( end.z < 0.0 && start.z >= 0.0 ) {\n\n\t\t\t\t\ttrimSegment( end, start );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// clip space\n\t\t\tvec4 clipStart = projectionMatrix * start;\n\t\t\tvec4 clipEnd = projectionMatrix * end;\n\n\t\t\t// ndc space\n\t\t\tvec2 ndcStart = clipStart.xy / clipStart.w;\n\t\t\tvec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n\t\t\t// direction\n\t\t\tvec2 dir = ndcEnd - ndcStart;\n\n\t\t\t// account for clip-space aspect ratio\n\t\t\tdir.x *= aspect;\n\t\t\tdir = normalize( dir );\n\n\t\t\t// perpendicular to dir\n\t\t\tvec2 offset = vec2( dir.y, - dir.x );\n\n\t\t\t// undo aspect ratio adjustment\n\t\t\tdir.x /= aspect;\n\t\t\toffset.x /= aspect;\n\n\t\t\t// sign flip\n\t\t\tif ( position.x < 0.0 ) offset *= - 1.0;\n\n\t\t\t// endcaps\n\t\t\tif ( position.y < 0.0 ) {\n\n\t\t\t\toffset += - dir;\n\n\t\t\t} else if ( position.y > 1.0 ) {\n\n\t\t\t\toffset += dir;\n\n\t\t\t}\n\n\t\t\t// adjust for linewidth\n\t\t\toffset *= linewidth;\n\n\t\t\t// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...\n\t\t\toffset /= resolution.y;\n\n\t\t\t// select end\n\t\t\tvec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;\n\n\t\t\t// back to clip space\n\t\t\toffset *= clip.w;\n\n\t\t\tclip.xy += offset;\n\n\t\t\tgl_Position = clip;\n\n\t\t\tvec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation\n\n\t\t\t#include <logdepthbuf_vertex>\n\t\t\t#include <clipping_planes_vertex>\n\t\t\t#include <fog_vertex>\n\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform vec3 diffuse;\n\t\tuniform float opacity;\n\n\t\t#ifdef USE_DASH\n\n\t\t\tuniform float dashSize;\n\t\t\tuniform float gapSize;\n\n\t\t#endif\n\n\t\tvarying float vLineDistance;\n\n\t\t#include <common>\n\t\t#include <color_pars_fragment>\n\t\t#include <fog_pars_fragment>\n\t\t#include <logdepthbuf_pars_fragment>\n\t\t#include <clipping_planes_pars_fragment>\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\t#include <clipping_planes_fragment>\n\n\t\t\t#ifdef USE_DASH\n\n\t\t\t\tif ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps\n\n\t\t\t\tif ( mod( vLineDistance, dashSize + gapSize ) > dashSize ) discard; // todo - FIX\n\n\t\t\t#endif\n\n\t\t\tif ( abs( vUv.y ) > 1.0 ) {\n\n\t\t\t\tfloat a = vUv.x;\n\t\t\t\tfloat b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;\n\t\t\t\tfloat len2 = a * a + b * b;\n\n\t\t\t\tif ( len2 > 1.0 ) discard;\n\n\t\t\t}\n\n\t\t\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t\t\t#include <logdepthbuf_fragment>\n\t\t\t#include <color_fragment>\n\n\t\t\tgl_FragColor = vec4( diffuseColor.rgb, diffuseColor.a );\n\n\t\t\t#include <premultiplied_alpha_fragment>\n\t\t\t#include <tonemapping_fragment>\n\t\t\t#include <encodings_fragment>\n\t\t\t#include <fog_fragment>\n\n\t\t}\n\t\t"};var LineMaterial=function(t){ShaderMaterial$c.call(this,{type:"LineMaterial",uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader,clipping:!0}),this.dashed=!1,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}}}),this.setValues(t)};LineMaterial.prototype=Object.create(ShaderMaterial$c.prototype),LineMaterial.prototype.constructor=LineMaterial,LineMaterial.prototype.isLineMaterial=!0;var LineSegmentsGeometry=function(){InstancedBufferGeometry.call(this),this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))},vector,box;LineSegmentsGeometry.prototype=Object.assign(Object.create(InstancedBufferGeometry.prototype),{constructor:LineSegmentsGeometry,isLineSegmentsGeometry:!0,applyMatrix:function(t){var e=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),r.applyMatrix4(t),e.data.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},setPositions:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this},setColors:function(t){var e;t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t));var r=new InstancedInterleavedBuffer(e,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(r,3,3)),this},fromWireframeGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromEdgesGeometry:function(t){return this.setPositions(t.attributes.position.array),this},fromMesh:function(t){return this.fromWireframeGeometry(new WireframeGeometry(t.geometry)),this},fromLineSegements:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},computeBoundingBox:(box=new Box3,function(){null===this.boundingBox&&(this.boundingBox=new Box3);var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),box.setFromBufferAttribute(e),this.boundingBox.union(box))}),computeBoundingSphere:(vector=new Vector3$1,function(){null===this.boundingSphere&&(this.boundingSphere=new Sphere),null===this.boundingBox&&this.computeBoundingBox();var t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){var r=this.boundingSphere.center;this.boundingBox.getCenter(r);for(var n=0,i=0,a=t.count;i<a;i++)vector.fromBufferAttribute(t,i),n=Math.max(n,r.distanceToSquared(vector)),vector.fromBufferAttribute(e,i),n=Math.max(n,r.distanceToSquared(vector));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}),toJSON:function(){}});var LineGeometry=function(){LineSegmentsGeometry.call(this),this.type="LineGeometry"};LineGeometry.prototype=Object.assign(Object.create(LineSegmentsGeometry.prototype),{constructor:LineGeometry,isLineGeometry:!0,setPositions:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return LineSegmentsGeometry.prototype.setPositions.call(this,r),this},setColors:function(t){for(var e=t.length-3,r=new Float32Array(2*e),n=0;n<e;n+=3)r[2*n]=t[n],r[2*n+1]=t[n+1],r[2*n+2]=t[n+2],r[2*n+3]=t[n+3],r[2*n+4]=t[n+4],r[2*n+5]=t[n+5];return LineSegmentsGeometry.prototype.setColors.call(this,r),this},fromLine:function(t){var e=t.geometry;return e.isGeometry?this.setPositions(e.vertices):e.isBufferGeometry&&this.setPositions(e.position.array),this},copy:function(){return this}});var LineSegments2=function(t,e){Mesh.call(this),this.type="LineSegments2",this.geometry=void 0!==t?t:new LineSegmentsGeometry,this.material=void 0!==e?e:new LineMaterial({color:16777215*Math.random()})};LineSegments2.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:LineSegments2,isLineSegments2:!0,computeLineDistances:function(){var t=new Vector3$1,e=new Vector3$1;return function(){for(var r=this.geometry,n=r.attributes.instanceStart,i=r.attributes.instanceEnd,a=new Float32Array(2*n.data.count),o=0,s=0,u=n.data.count;o<u;o++,s+=2)t.fromBufferAttribute(n,o),e.fromBufferAttribute(i,o),a[s]=0===s?0:a[s-1],a[s+1]=a[s]+t.distanceTo(e);var l=new InstancedInterleavedBuffer(a,2,1);return r.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(l,1,0)),r.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(l,1,1)),this}}(),raycast:function(){var t=new Vector4,e=new Vector4,r=new Vector4,n=new Vector3$1,i=new Matrix4$2,a=new Line3,o=new Vector3$1;return function(s,u){null===s.camera&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');var l=s.ray,c=s.camera,h=c.projectionMatrix,f=this.geometry,d=this.material,p=d.resolution,m=d.linewidth,v=f.attributes.instanceStart,g=f.attributes.instanceEnd;l.at(1,r),r.w=1,r.applyMatrix4(c.matrixWorldInverse),r.applyMatrix4(h),r.multiplyScalar(1/r.w),r.x*=p.x/2,r.y*=p.y/2,r.z=0,n.copy(r);var y=this.matrixWorld;i.multiplyMatrices(c.matrixWorldInverse,y);for(var _=0,b=v.count;_<b;_++)if(t.fromBufferAttribute(v,_),e.fromBufferAttribute(g,_),t.w=1,e.w=1,t.applyMatrix4(i),e.applyMatrix4(i),t.applyMatrix4(h),e.applyMatrix4(h),t.multiplyScalar(1/t.w),e.multiplyScalar(1/e.w),!(t.z<-1&&e.z<-1||t.z>1&&e.z>1)){t.x*=p.x/2,t.y*=p.y/2,e.x*=p.x/2,e.y*=p.y/2,a.start.copy(t),a.start.z=0,a.end.copy(e),a.end.z=0;var x=a.closestPointToPointParameter(n,!0);a.at(x,o);var w=_Math.lerp(t.z,e.z,x),M=w>=-1&&w<=1,A=n.distanceTo(o)<.5*m;if(M&&A){a.start.fromBufferAttribute(v,_),a.end.fromBufferAttribute(g,_),a.start.applyMatrix4(y),a.end.applyMatrix4(y);var E=new Vector3$1,S=new Vector3$1;l.distanceSqToSegment(a.start,a.end,S,E),u.push({point:S,pointOnLine:E,distance:l.origin.distanceTo(S),object:this,face:null,faceIndex:_,uv:null,uv2:null})}}}}()});var Line2=function(t,e){LineSegments2.call(this),this.type="Line2",this.geometry=void 0!==t?t:new LineGeometry,this.material=void 0!==e?e:new LineMaterial({color:16777215*Math.random()})};Line2.prototype=Object.assign(Object.create(LineSegments2.prototype),{constructor:Line2,isLine2:!0});const{BufferGeometry:BufferGeometry,Geometry:Geometry$1,BufferAttribute:BufferAttribute,Vector3:Vector3}=THREE$1;class MeshLine extends BufferGeometry{constructor(){super(),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.lineWidth=1,this.counters=[],this._points=[],this._geometry=null}get geometry(){return this._geometry}get points(){return this._points}_process(){let t=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];let e,r=this.lineWidth||1;e=this._compareV3(0,t-1)?this._copyV3(t-2):this._copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(let n=0;n<t;n++){if(this.side.push(1),this.side.push(-1),this.width.push(r),this.width.push(r),this.uvs.push(n/(t-1),0),this.uvs.push(n/(t-1),1),n<t-1){e=this._copyV3(n),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);let t=2*n;this.indices_array.push(t,t+1,t+2),this.indices_array.push(t+2,t+1,t+3)}n>0&&(e=this._copyV3(n),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this._compareV3(t-1,0)?this._copyV3(1):this._copyV3(t-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new BufferAttribute(new Float32Array(this.positions),3),previous:new BufferAttribute(new Float32Array(this.previous),3),next:new BufferAttribute(new Float32Array(this.next),3),side:new BufferAttribute(new Float32Array(this.side),1),width:new BufferAttribute(new Float32Array(this.width),1),uv:new BufferAttribute(new Float32Array(this.uvs),2),index:new BufferAttribute(new Uint16Array(this.indices_array),1),counters:new BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}_compareV3(t,e){let r=6*t,n=6*e;return this.positions[r]===this.positions[n]&&this.positions[r+1]===this.positions[n+1]&&this.positions[r+2]===this.positions[n+2]}_copyV3(t){let e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]}_memcpy(t,e,r,n,i){let a;if(t=t.subarray||t.slice?t:t.buffer,r=r.subarray||r.slice?r:r.buffer,t=e?t.subarray?t.subarray(e,i&&e+i):t.slice(e,i&&e+i):t,r.set)r.set(t,n);else for(a=0;a<t.length;a++)r[a+n]=t[a];return r}setGeometry(t,e){return this._geometry=t,this.setPoints(t instanceof Geometry$1?t.vertices:t instanceof BufferGeometry?t.getAttribute("position").array:t,e),this}setPoints(t,e){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.lineWidth=e,this.positions=[],this.counters=[],t.length&&t[0]instanceof Vector3)for(let e=0;e<t.length;e++){let r=t[e],n=e/t.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(n),this.counters.push(n)}else for(let e=0;e<t.length;e+=3){let r=e/t.length;this.positions.push(t[e],t[e+1],t[e+2]),this.positions.push(t[e],t[e+1],t[e+2]),this.counters.push(r),this.counters.push(r)}this._process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")}}var CommonVS="varying vec2 v_uv;\r\nvoid main() {\r\n    v_uv = uv;\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}",DiffuseCircleFS="varying vec2 v_uv;\r\n\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\nvec3 circlePing(float r, float innerTail,  float frontierBorder, float timeResetSeconds,  float radarPingSpeed,  float fadeDistance){\r\n    float t =fract(u_frameNumber / 1000.0 * u_speed) ;\r\n    float time = mod(t , timeResetSeconds) * radarPingSpeed;\r\n    float circle = 0.0;\r\n    circle += smoothstep(time - innerTail, time, r) * smoothstep(time + frontierBorder,time, r);\r\n    circle *= smoothstep(fadeDistance, 0.0, r);\r\n    return vec3(circle);\r\n}\r\n\r\nvoid main() {\r\n    vec2 st = v_uv * 2.0 - 1.0;\r\n    vec2 center = vec2(0.0);\r\n    float dis = distance(st,center);\r\n    vec3 flagColor;\r\n    float r = length(st - center) / 5.0;\r\n    flagColor += circlePing(r, 0.25, 0.025, 4.0, 0.3, 1.0) * u_color;\r\n    gl_FragColor = vec4(flagColor,u_alpha);\r\n}\r\n";const{ShaderMaterial:ShaderMaterial$b,AdditiveBlending:AdditiveBlending$3,DoubleSide:DoubleSide$b,Color:Color$b}=THREE$1,DEF_PARAMS$b={transparent:!0,depthWrite:!0,depthTest:!1,blending:AdditiveBlending$3,side:DoubleSide$b,vertexShader:CommonVS,fragmentShader:DiffuseCircleFS};class DiffuseCircleMaterial extends ShaderMaterial$b{constructor(t={}){super({...DEF_PARAMS$b,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$b).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="DiffuseCircleMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$b).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isDiffuseCircleMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}var ScanCircleFS="varying vec2 v_uv;\r\n\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\n\r\nfloat circle(vec2 uv, float r, float blur) {\r\n    float d = length(uv) / 2.0;\r\n    float c = smoothstep(r+blur, r, d);\r\n    return c;\r\n}\r\n\r\nvoid main(){\r\n    vec2 st = v_uv * 2.0 - 1.0;\r\n    float t =fract(u_frameNumber * u_speed / 1000.0);\r\n    float s = 0.3;\r\n    float radius1 = smoothstep(.0, s, t) * 0.5;\r\n    float alpha1 = circle(st, radius1, 0.01) * circle(st, radius1, -0.01);\r\n    float alpha2 = circle(st, radius1, 0.01 - radius1) * circle(st, radius1, 0.01);\r\n    float radius2 = 0.5 + smoothstep(s, 1.0, t) * 0.5;\r\n    float alpha3 = circle(st, radius1, radius2 + 0.01 - radius1) * circle(st, radius1, -0.01);\r\n    float alpha = smoothstep(1.0, s, t) * (alpha1 + alpha2*0.1 + alpha3*0.1);\r\n    gl_FragColor = vec4(u_color, alpha * u_alpha );\r\n}\r\n";const{ShaderMaterial:ShaderMaterial$a,AdditiveBlending:AdditiveBlending$2,DoubleSide:DoubleSide$a,Color:Color$a}=THREE$1,DEF_PARAMS$a={transparent:!0,depthWrite:!0,depthTest:!1,blending:AdditiveBlending$2,side:DoubleSide$a,vertexShader:CommonVS,fragmentShader:ScanCircleFS};class ScanCircleMaterial extends ShaderMaterial$a{constructor(t={}){super({...DEF_PARAMS$a,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$a).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="ScanCircleMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$a).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isScanCircleMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}var DiffuseWallFS="varying vec2 v_uv;\r\n\r\nuniform float u_frameNumber;\r\nuniform sampler2D u_image;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\nvoid main(void){\r\n    vec2 st = v_uv ;\r\n    st.t=-st.t;\r\n    float time = fract(u_frameNumber / 1000.0 * u_speed);\r\n    vec4 colorImage = texture2D(u_image, vec2(fract(st.t * 0.4 - time), st.s));\r\n    gl_FragColor = vec4(mix(u_color , colorImage.rgb ,0.1) , colorImage.a * u_alpha );\r\n}\r\n";const{ShaderMaterial:ShaderMaterial$9,DoubleSide:DoubleSide$9,Color:Color$9,TextureLoader:TextureLoader$2}=THREE$1,DEF_PARAMS$9={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$9,vertexShader:CommonVS,fragmentShader:DiffuseWallFS},IMG="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAOhlWElmTU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgExAAIAAAAkAAAAZgEyAAIAAAAUAAAAiodpAAQAAAABAAAAngAAAAAAAABIAAAAAQAAAEgAAAABQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkAMjAxODoxMDoyNiAxNTozMDozNAAABJAEAAIAAAAUAAAA1KABAAMAAAABAAEAAKACAAQAAAABAAAAQKADAAQAAAABAAAAQAAAAAAyMDE4OjEwOjI2IDE1OjI0OjI1ALUCxicAAAAJcEhZcwAACxMAAAsTAQCanBgAAAdgaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgICAgICAgICB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iCiAgICAgICAgICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgICAgICAgICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx4bXBNTTpJbnN0YW5jZUlEPnhtcC5paWQ6MjgyZGYxNWEtYzg5MC00ODUzLWJlZDQtOWEyZjQxMmY0NjljPC94bXBNTTpJbnN0YW5jZUlEPgogICAgICAgICA8eG1wTU06RG9jdW1lbnRJRD54bXAuZGlkOjI4MmRmMTVhLWM4OTAtNDg1My1iZWQ0LTlhMmY0MTJmNDY5YzwveG1wTU06RG9jdW1lbnRJRD4KICAgICAgICAgPHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD54bXAuZGlkOjI4MmRmMTVhLWM4OTAtNDg1My1iZWQ0LTlhMmY0MTJmNDY5YzwveG1wTU06T3JpZ2luYWxEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAxOC0xMC0yNlQxNToyNDoyNSswODowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDoyODJkZjE1YS1jODkwLTQ4NTMtYmVkNC05YTJmNDEyZjQ2OWM8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+Y3JlYXRlZDwvc3RFdnQ6YWN0aW9uPgogICAgICAgICAgICAgICA8L3JkZjpsaT4KICAgICAgICAgICAgPC9yZGY6U2VxPgogICAgICAgICA8L3htcE1NOkhpc3Rvcnk+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDE4LTEwLTI2VDE1OjMwOjM0KzA4OjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdG9yVG9vbD5BZG9iZSBQaG90b3Nob3AgQ0MgMjAxOCAoTWFjaW50b3NoKTwveG1wOkNyZWF0b3JUb29sPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDE4LTEwLTI2VDE1OjMwOjM0KzA4OjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wOkNyZWF0ZURhdGU+MjAxOC0xMC0yNlQxNToyNDoyNSswODowMDwveG1wOkNyZWF0ZURhdGU+CiAgICAgICAgIDxwaG90b3Nob3A6SUNDUHJvZmlsZT5zUkdCIElFQzYxOTY2LTIuMTwvcGhvdG9zaG9wOklDQ1Byb2ZpbGU+CiAgICAgICAgIDxwaG90b3Nob3A6Q29sb3JNb2RlPjM8L3Bob3Rvc2hvcDpDb2xvck1vZGU+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgr82RRBAAAQ+0lEQVR4AZWaWZIkNw5Ea5M00khnmi/d/zgyLV017znhTEZWdk8PzCIAAg4QABlLRtXz77///p8//vjjy/v7+5ePj48vf/755xfo/eXl5f2ff/55R/f8NPTDDz9s+dRrfnt7i+3Un/Jpf319feF4lj8/P78yV8bKhHplnpcV8u0Fv1cOx8BxAPrjjz+GL7fXYEZ+09c4Hsj6Nubrzz///C+OX3799dd///LLL7/+9ttvP+tM7O+jv/766xPQIj3+/vvvJ4/SWXx195x4u2knnsbvRutz2hyzQNFRtLiXsdukJxZSbhOelQ9b9NqKwfbyRrAPJkT++MDwgV8OivlggsiYkpA29JHprvN9ImJV90FzdyHVE0v7OwfhX96Z/1nu2ByUWWh1FmBzYe8WtHNTVm+jyCMLoMLA6mHRibMm4rmTE18ddsfyjxcbMMon+XnYGI9TV9kGeXQsJ2BiyKXqTrn46s6xOslmNS+5RahvPHQOQ9jCLUga9SemTWzxBeQSwLZXSkMLK4ixSV2SaOJthNgmWF7/8nu98xpbOm1elto8LF5b7eWfCnnJFdCpwvG/NOSM0zlzCbjtwL5zA0y3BXblTaKTtgk4X7a3wVqINrflxLAIzfsmObGeWcUsHXO72t4QnTvb31U3JwiWS2E3QX9tcCsOB8c0WWG3u80Tn3mVI8wJrHZH2RG5ttxyJSfwuB+fOm02w6KLL9fmrpCfuqN5ezeJkcQ1B7nj6gP4ysk6a6oMX9UpPKDGtRHS3jctJto5NZFTV9kb3NduhGLOJ0bjnE1onHv+PU8l6tqF3/t3zC6JyNyfsPrXnpugyCbZAOVf09d+z4u/58VV77gNOS6fwvZNcCsOwRg9DvWuwYV/pB/dxfbmIwdDrmnuAX2kPLsSXps63Xfc1Z9g23ZilHlZ+WTTz9yKbRw5hwXs+RyLG5XPzDwanVd5bDsP9eqql6Pa8QwkqVtMD+5NAm2C3ETaBECoVsBHW12bAcq98Z1j9LEZs3p1kjr9nJdrcc+PKS8vbk/mh+V9JoWLr0/1jhNwTuo5doWVz4oPWfG5b0pnIbuTJnpffBMpd6Ufkfaz+HtMm1BM7eR02aKdp/ZH4xZejFzcOa7O+BZeW97BO2jwrmb15Q1arl5ZfH3LW9iJFd/CT3195nL0pX/H00eySPmZ/Oj3gmkTN/yCre6cF93TGw4vFPDGjegfktt3b4GY8qw4nSq3QJOQqleurTp5d5LyJOPUZhuO3R8wLoi37/yIIU50/vhBpy1j3cRB+VEELjE8Jfhx2gYEYwiBp1Hyt0ng6aeffnrh0eWLhEHIM+/ll8JMHqcQclc/L0Fn0fOycSm6z11w+cEyBSQ/i8ee5MzHgpikY8vZhU0BaZwGSaxcm9Tx1BKdJ8bZFcXB1w5QoCDsr/v6Q/aHyqVIV7FNKDcYzdv6dGdO2jouft763HW5/4ApX1tBp2mCIoer3CKyQxjf8+2rTbCcucOpJf6MdyBtHjT7zQnyI8HVIdH80jCATQCUa5II4Y5PamHaJWJ8KtoEtBVrbCjJTa7Z9uI4srdHv78FTJ57yxMuTZBLuinjZwgpek+jkxeHuCiXAI5GMUHf47OlfUkRos3tqx1+2dbaStO8S6FtRgs3HInlBofchMPVm7WFalMejGKSd7zqWX1i7hSkfQzlQIPVLthxOLkk1sRZO6CJznt4Hl8AqDe/MhynzhbioD4xzIk5ssrlxNhjISZiDLmZgpNJNi6rrY7YbQrQfD3KyoPrjmjhbVhukviGEpGTcSSLljCGOX/JN0GD7JUD4aexvKC44v+r6NNukcY6dU6m/tBlblRd1SynyYGNTo4dditeOdlPg5Bvezy1rV1j0cYq3cXdu0E9x/NuAAkmSXeByc6Enx6DFiMxQQpbo1uB+G39xEm8owHZCZNAboaVTQh/l8fiIsOz+qotigI7FpqdYjoOIItKY6YR7t7upjQGextkvNUAHPcqAfjwTr12/9quLfLkLcgg1atjwnO1HzbKJHwK6Kc8yWbVLfKwpyjzQ53tPkUGVqwgYphHijXeUD6Ijv9uALYU7/TZAQJMxgLcAV77BPGDQbYzsuaQdsdtQDkxto4CduG1N4ZjC8wpta6bIUkR4nYJWIA49Z7w73XeHaA9Nu3E7X3BYX0zz8wX/TLl5r52AIoEoTrv8L6NaPBLix88cgmo853AIvvu38LQ7R0gzi7VpqyPVJ2YI6GuxKp++QMJJS+bAu1CbcQyv9yWGZCELXGMH6d1iUQ/Y+eu/9otGFS4LP78TbLEEqjO7wUpoisYACd8LsXej4sj1i7eJjg2rvihrBb66DghrmubBUkiGiSLx8cjzowNsQsSo00arOJSKEHEdqxfCNzbG6vqRzUL0uJTwKvAt0KfH60ljRAHwdZrscEEOCZ4sG1aMadNWZokTChJqyMVZQsyVmS59wv8EFdjFMCmEWDTMX0VJ0ZiioMyB4kl3vA0InPaZba6D/0vNMJ7QD5Y4uh3ulwCqUrPKdZx5RZZjJyYaQgTbJz6+gxvkgzTxDbD5iRxDRZAnIhyDVBumHJpdkps0+y97fVBt2+0NCjBVjo8BQAY0JX2E/UXAE3er0ROvn8fnMWKP4ty1cWqnyT21h+crLGNKwHPDkuhLQhdtn7H4PY2V6dfbRZP2ARybn3N26IdYztjd05x2vIU8EkA/sNP0i/uBn7c5DM5uwLMlYygxiLl+MguTwaCR1eMg5kw3BhDaYTzeghTD3YXjLwJzNZb5FB0mnQ9MBGJ6aWVe4e8ToPVlj8+uspufRUWlj+MAs494CyEqJhvDciAE9jdGOSoT7/qBhfAqhUNvso5TfHKUIrYQqC3LT/DNA9MischjXBsXBLpvUI5Om3GZHzbAQx89H3RMI1wG6UB2EItiCi7YLe+NJNFNkaEOZ02Y5TUc7SAyCvU6kiqX5iucjqCf4qVlyzcUMYeuabsLG0u7umjnBchb1pQ/tgoJ4Cyme7rX4DJY1PstZxqHDNBdOXqSujSkNrk0C7cAXOlAvhuin7VkzzDVWCEtdKks9y0jb5NyMpPvOAMPfGcw1qe/Xt6/jxmDiYF+b8CvhD5Suyu2Kupk8meVHv5IxsTRd0dNNhUp+ykkrIFqVKeomsL1y6J0S4nOOpdd/3b4HB9BMklfDzWqzCB8vqLIn+bswEk64P3sgPw+2oD8HUVY8f9siO0lWzCSU2GHPTdzTgKEi4shVlDx+o6Vqd8jtW1SWIl7M4Tjn3fA0zYukMAvP27+ikEOWTy4DrcOgWD1VDMqatN3Ulgd1LqO5bPcEQ3R4rfu0QD1KX/tPIajaFfqXJj5x6AMTVgzIuQYDsBaF/jLWBWcOvB7MKLqU4OPruoOkJnpTMhSuZsAefKZIuOyXQkm9NKDJfCTq4s6Uf82Jk+utoySF+S97OvwW/Uaj5ZfQB+DLXAfBTV8IjAtfDyDcN3605ZQMcmojxFKmZc/c18W3Xd0acJ+g02q1zZS0kZbOIxboNVb9JuDG+t8GDSAF9/0Vm8hsvq4bTJjDtwV+BjcS54ZG02Vpw2SZtc3czpODIcWJqaxJabqt2XyPj1LS+Fi1PnMaHjpJ/CxA1WzNCe00uAJuX5SM1ftOcGiM6nwH4RYqJ9QzyLRL+qhjNZSF3lqs6x9oNSoWPmTtLl+GTc4uTCFjTYuD3QW8eJq7z52NebICtlEXYrr8DIIUB7B6hwtvKzIGVtpw7fveLKkjsCWegm1JHRS9UnUQpLU1DWEBA+2SV1aAOMpTxkrPg5Hn2Mhz4NOO8B/v7PpUCwNMEoyBdSZT9OJXM80gUDPn2bnZYni/4lfBWbbFad2NGZ/AjFHKq1Y/QVNoYtqxubOimYco25BOw0E/pOm1um2doFxybC8Yl0PpX3Yya5NES4ReujjXGyGz+ZyQ3bdlRLVpACHF/z1s2j8kCCc9UDiGeK7w5Yjuj3q7D1Ak7tngwES43oTV57xsgmG7knJ6o8/DI+7cpQlhieJPHpjdHAZzMCNp/BIu66uqJRBDjNKIZYtemnvJslPjvAgiDvgIj7a5BF7xufRWGX7ZVUxk+2CZdLc+7HAJ1LqpAE1RsfvG9v2hmudwYHUMY5rXGud/VjDDt2gnrnSNEaId0tYofJbwEtTswugH3kZEWO5SVgFXcTVrylxjdFbNAS4iRudpnj4pw6YzmYHNqHkqh6zYcy4xhHqQwZK/yUB7xvkF4ac+THkL9UcvMDmAa0cIJcGmBiHBeaiS46G6EC20V/jFPo5N4GZLWMJ+G4G8Lw02UBTjpxu0Hju7o2GGJ4/VP3ekqYnjj3mpeBwaj7tgMoIpcAenC3l5qVW1Q5MU6xN81Nqg1uI+2uqi0bm7Fzq8+yi3MMP69Vg4oJdvDBqRNbnaCh+qdJ6MRk5cVSc2BvfP7yv0OyAzB457cTTujNwFndFTokew0lbDZpDxWI0ee9wzRHjFhpYoWbgcloUxyehEdfHcPb9hbnmFjRM04c57vDaZKCc6HBKBs3LDdBCrUzsOwA4oZSvEmX0BqswwvXAJ0NuRRdsJggh4++iV94AlKUq8XcSdjc8UkIZQ9tKpRPGixs+dgADzB9HOY/RLjp5itqPoJYOhNkWZWhVIxT5HKCtqZwcdBF18G9QRyHiQgxsMlnVR2b8D2pP20tajgsPi7A3vrF1I8x9Yc6x1OfAlazdwByG4C4iIQuDZjkaw4HIDf3i/6RcpLThJhmngV2l2wduCQtr+xEpVM3sWva3Ikgx70U0gDvBvmF5SVAIAtNJcocvV63rA4f2Scy+iclCtWEjU15cGGeJO3QLj6DuGZ7G1ZVG2ExF92JrzwFO9yPQR3ZB8Z52k8BJt+XwK3+JzNyEpNPERms08NCa7cYJ3hA5tKmttiMuRTluTTwNX4O8TpJ6iTtJXXFz5wdJ9bg1t0PAKTK00dehQngLjgvAVRrK0T4xslIj8yqbcLXbCaBrfY2K2NjlsQUO4kbMr6HPrp7H8bVn8VbeA//DSDvnb4M+SqsQx5/ClAvhTV6fG7yj61La27049IQdbnxqVeGGisFqhuDTAoenAV0V2xMG6LNWBNPP0nfXO5w/UPnDnALuGo+b2TfU3wnlzvpI3pkWBmuHPTJKhuDadU2XhBjDy6KNVdEa9FeY8fFGQ9d8tTGIY15/jDCyB0QoIVLBoTkgtdg7gM1n/oTF/DdySCQBaY4eMYDi+wJ6oRrNMWKU0HyxugOiFqTeu3KA43Nm92QdovX93YT9KmIwr+OanD7I6b+cHQJ5OlbNLhvQWJb86+gA8Z1F22SqqMbriyd+gBGmYKJm90jP/wizzj3gcNmve/5HYDgDsgHkJkoxdsIx6Mz2P8kfIAn2a9iBUDaw0+fi2FF2KppXpz0sdgxbgzCjjvxt01/dXCLj957oO/A2QEYvf7tpFsgLCgG/w9NjGZycTU0MdXlJD/H5hbjUQg+G2PssYuLXvvowwdfn8AH23cBbfrnH43yc5ixj0Fv1TpIiJ+SXZbvOBu/xRBX2WzzhDHBFmKolcu6dtdw9WB8srVP3IlXngN28cvgLl6uf4Gl/F2AidwB6pzMuWC7EUm89gOTiU+cjicN1i+vW80tp3ITbJw0RR/IE+J6KkyzMlZuLsUMHrZ8yo9YMeBrjMQezPoW4CWgYYpJ5a7aSfp1cvitOyfo27JTbIRFdHAaBhObskmLG0zYyOoO04IY1zy13TcKnR3Q5lMA2MuHfxp75VN4LgOi4ZNtf74MOUnIwCWDV/5e7uSlkbfCcRMuH2yrvBRlLgcO9xXqjIP/9lUeTLjFI3z8F+ualIvlptDJAAAAAElFTkSuQmCC",textureLoader=new TextureLoader$2;class DiffuseWallMaterial extends ShaderMaterial$9{constructor(t={}){super({...DEF_PARAMS$9,uniforms:{u_frameNumber:{value:1},u_image:{value:textureLoader.load(IMG)},u_color:{value:(new Color$9).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="FlowLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$9).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isDiffuseWallMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}var FadeWallFS="varying vec2 v_uv;\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\nvoid main(void){\r\n    vec2 st = v_uv ;\r\n    float time = fract(u_frameNumber / 1000.0 * u_speed);\r\n    gl_FragColor = vec4( u_color  , (st.t - time) * u_alpha );\r\n}\r\n";const{ShaderMaterial:ShaderMaterial$8,DoubleSide:DoubleSide$8,Color:Color$8}=THREE$1,DEF_PARAMS$8={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$8,vertexShader:CommonVS,fragmentShader:FadeWallFS};class FadeWallMaterial extends ShaderMaterial$8{constructor(t={}){super({...DEF_PARAMS$8,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$8).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="FadeWallMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$8).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isFadeWallMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}var ScanRadarFS="varying vec2 v_uv;\r\n\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\nuniform bool u_isCW;\r\n\r\nconst float PI = 3.14159256;\r\n\r\nfloat RadarSweep(in float time, in vec2 c, in vec2 center, in float radius, in float speed, in bool dir_cw, in float tailLength){\r\n    time *= speed;\r\n    c -= center;\r\n    if(!dir_cw) c.xy = c.yx;\r\n    float x = length(c);\r\n    float y = mod(atan(c.y, c.x) + time, PI * 2.0);\r\n    y /= tailLength;\r\n    float result = 0.0;\r\n    if(x < radius) result += 1.0 - y;\r\n    return result;\r\n}\r\n\r\nvoid main() {\r\n    vec2 st = v_uv * 2.0 - 1.0;\r\n    vec2 center = vec2(0.);\r\n    float time = u_frameNumber / 1000.0;\r\n    gl_FragColor += vec4(u_color * RadarSweep(time, st, center,  PI, pow(u_speed,2.0),  u_isCW, PI / 3.0 ), u_alpha);\r\n}\r\n";const{ShaderMaterial:ShaderMaterial$7,AdditiveBlending:AdditiveBlending$1,DoubleSide:DoubleSide$7,Color:Color$7}=THREE$1,DEF_PARAMS$7={transparent:!0,depthWrite:!0,depthTest:!1,blending:AdditiveBlending$1,side:DoubleSide$7,vertexShader:CommonVS,fragmentShader:ScanRadarFS};class ScanRadarMaterial extends ShaderMaterial$7{constructor(t={}){super({...DEF_PARAMS$7,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$7).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3},u_isCW:{value:"boolean"!=typeof t.isCW||t.isCW}}}),this.type="ScanRadarMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$7).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}set isCW(t){return this.uniforms.u_isCW.value=t,this}get isCW(){return this.uniforms.u_isCW.value}get isScanRadarMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}var MeshLineVS="\r\n#include <logdepthbuf_pars_vertex>\r\n#include <fog_pars_vertex>\r\n\r\nattribute vec3 previous;\r\nattribute vec3 next;\r\nattribute float side;\r\nattribute float width;\r\nattribute float counters;\r\n\r\nvarying vec2 v_uv;\r\nvarying float v_counters;\r\n\r\nuniform vec2 resolution;\r\nuniform bool sizeAttenuation;\r\n\r\nvec2 fix( vec4 i, float aspect ) {\r\n    vec2 res = i.xy / i.w;\r\n    res.x *= aspect;\r\n    return res;\r\n}\r\n\r\nvoid main() {\r\n    v_uv = uv;\r\n    v_counters = counters;\r\n    float aspect = resolution.x / resolution.y;\r\n    mat4 m = projectionMatrix * modelViewMatrix;\r\n    vec4 finalPosition = m * vec4( position, 1.0 );\r\n    vec4 prevPos = m * vec4( previous, 1.0 );\r\n    vec4 nextPos = m * vec4( next, 1.0 );\r\n    vec2 currentP = fix( finalPosition, aspect );\r\n    vec2 prevP = fix( prevPos, aspect );\r\n    vec2 nextP = fix( nextPos, aspect );\r\n\r\n    vec2 dir;\r\n\r\n    if( nextP == currentP ) {\r\n        dir = normalize( currentP - prevP );\r\n    } else if( prevP == currentP ) {\r\n        dir = normalize( nextP - currentP );\r\n    } else {\r\n       vec2 dir1 = normalize( currentP - prevP );\r\n       vec2 dir2 = normalize( nextP - currentP );\r\n       dir = normalize( dir1 + dir2 );\r\n       vec2 perp = vec2( -dir1.y, dir1.x );\r\n       vec2 miter = vec2( -dir.y, dir.x );\r\n    }\r\n\r\n    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );\r\n    normal.xy *= .5 * width;\r\n    normal *= projectionMatrix;\r\n\r\n    if( !sizeAttenuation ) {\r\n      normal.xy *= finalPosition.w;\r\n      normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;\r\n    }\r\n\r\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    finalPosition.xy += normal.xy * side;\r\n\r\n    gl_Position = finalPosition;\r\n\r\n    #include <logdepthbuf_vertex>\r\n    #include <fog_vertex>\r\n}",MeshLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\n\r\nvoid main() {\r\n    #include <logdepthbuf_fragment>\r\n    gl_FragColor = vec4(u_color,u_alpha) ;\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$6,DoubleSide:DoubleSide$6,Color:Color$6}=THREE$1,DEF_PARAMS$6={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$6,vertexShader:MeshLineVS,fragmentShader:MeshLineFS};class MeshLineMaterial extends ShaderMaterial$6{constructor(t={}){super({...DEF_PARAMS$6,uniforms:{u_color:{value:(new Color$6).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1}}}),this.type="MeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$6).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}get isMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this}}var DashMeshLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvarying vec2 v_uv;\r\nvarying float v_counters;\r\n\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_dashLength;\r\nuniform float u_dashOffset;\r\nuniform float u_dashRatio;\r\n\r\nvoid main() {\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec4 fragColor = vec4(u_color,u_alpha);\r\n    float counters  = v_counters;\r\n    fragColor.a *= ceil(mod(counters + u_dashOffset, u_dashLength) - (u_dashLength * u_dashRatio));\r\n    gl_FragColor = fragColor;\r\n\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$5,DoubleSide:DoubleSide$5,Color:Color$5}=THREE$1,DEF_PARAMS$5={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$5,vertexShader:MeshLineVS,fragmentShader:DashMeshLineFS};class DashMeshLineMaterial extends ShaderMaterial$5{constructor(t={}){super({...DEF_PARAMS$5,uniforms:{u_color:{value:(new Color$5).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_dashLength:{value:t.dashLength||.02},u_dashOffset:{value:t.dashOffset||0},u_dashRatio:{value:t.dashRatio||.5}}}),this.type="DashMeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$5).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set dashLength(t){return this.uniforms.u_dashLength.value=t,this}get dashLength(){return this.uniforms.u_dashLength.value}set dashOffset(t){return this.uniforms.u_dashOffset.value=t,this}get dashOffset(){return this.uniforms.u_dashOffset.value}set dashRatio(t){return this.uniforms.u_dashRatio.value=t,this}get dashRatio(){return this.uniforms.u_dashRatio.value}get isDashMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.dashLength=t.dashLength,this.dashOffset=t.dashOffset,this.dashRatio=t.dashRatio,this}}var FlowMashLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvarying vec2 v_uv;\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\nuniform float u_percent;\r\nuniform float u_gradient;\r\n\r\nvoid main(){\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec2 st = v_uv;\r\n\r\n    float t = fract(u_frameNumber / 1000.0 * u_speed ) ;\r\n    t *= (1.0 + u_percent);\r\n    float alpha = smoothstep(t- u_percent, t,  st.s) * step(-t, -st.s);\r\n    alpha += u_gradient;\r\n    gl_FragColor = vec4(u_color, alpha * u_alpha );\r\n\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$4,DoubleSide:DoubleSide$4,Color:Color$4}=THREE$1,DEF_PARAMS$4={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$4,vertexShader:MeshLineVS,fragmentShader:FlowMashLineFS};class FlowMeshLineMaterial extends ShaderMaterial$4{constructor(t={}){super({...DEF_PARAMS$4,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$4).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3},u_percent:{value:t.percent||.08},u_gradient:{value:t.gradient||.02}}}),this.type="FlowMeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$4).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}set percent(t){return this.uniforms.u_percent.value=t,this}get percent(){return this.uniforms.u_percent.value}set gradient(t){return this.uniforms.u_gradient.value=t,this}get gradient(){return this.uniforms.u_gradient.value}get isFlowMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this.percent=t.percent,this.gradient=t.gradient,this.isY=t.isY,this}}var ImageMeshLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvarying vec2 v_uv;\r\nuniform sampler2D u_image;\r\nuniform vec2 u_repeat;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\n\r\n\r\nvoid main() {\r\n    #include <logdepthbuf_fragment>\r\n    vec2 st = v_uv * u_repeat ;\r\n    vec4 imageColor  = texture2D( u_image, st  );\r\n    gl_FragColor = vec4(imageColor.rgb * u_color , u_alpha * imageColor.a)  ;\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$3,DoubleSide:DoubleSide$3,Color:Color$3,TextureLoader:TextureLoader$1,RepeatWrapping:RepeatWrapping$1,Vector2:Vector2$1}=THREE$1,DEF_PARAMS$3={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$3,vertexShader:MeshLineVS,fragmentShader:ImageMeshLineFS};class ImageMeshLineMaterial extends ShaderMaterial$3{constructor(t={}){let e=(new TextureLoader$1).load(t.image);e.wrapS=RepeatWrapping$1,e.wrapT=RepeatWrapping$1,!t.repeat||t.repeat instanceof Vector2$1||(t.repeat=new Vector2$1(t.repeat.x,t.repeat.y)),super({...DEF_PARAMS$3,uniforms:{u_frameNumber:{value:1},u_image:{value:e},u_color:{value:(new Color$3).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_repeat:{value:t.repeat||new Vector2$1(1,1)}}}),this.type="ImageMeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$3).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set image(t){let e=(new TextureLoader$1).load(t);return e.wrapS=RepeatWrapping$1,e.wrapT=RepeatWrapping$1,this.uniforms.u_image.value=e,this}get image(){return this.uniforms.u_image.value}set repeat(t){return!t||t instanceof Vector2$1||(t=new Vector2$1(t.x,t.y)),this.uniforms.u_repeat.value=t,this}get repeat(){return this.uniforms.u_repeat.value}get isImageMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this.image.copy(t.image),this.repeat.copy(t.repeat),this}}var ImageTrailMeshLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nuniform float u_frameNumber;\r\nuniform vec2 u_resolution;\r\nvarying vec2 v_uv;\r\nuniform sampler2D u_image;\r\nuniform vec2 u_repeat;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\nvoid main() {\r\n    #include <logdepthbuf_fragment>\r\n    vec2 st = v_uv * u_repeat ;\r\n    float time = fract(u_frameNumber / 1000.0 * u_speed);\r\n    vec4 imageColor  = texture2D( u_image, vec2(fract(st.s - time),st.t));\r\n    gl_FragColor = vec4(imageColor.rgb * u_color , u_alpha * imageColor.a)  ;\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$2,DoubleSide:DoubleSide$2,Color:Color$2,TextureLoader:TextureLoader,RepeatWrapping:RepeatWrapping,Vector2:Vector2}=THREE$1,DEF_PARAMS$2={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$2,vertexShader:MeshLineVS,fragmentShader:ImageTrailMeshLineFS};class ImageTrailMeshLineMaterial extends ShaderMaterial$2{constructor(t={}){let e=(new TextureLoader).load(t.image);e.wrapS=RepeatWrapping,e.wrapT=RepeatWrapping,!t.repeat||t.repeat instanceof Vector2||(t.repeat=new Vector2(t.repeat.x,t.repeat.y)),super({...DEF_PARAMS$2,uniforms:{u_frameNumber:{value:1},u_image:{value:e},u_color:{value:(new Color$2).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_repeat:{value:t.repeat||new Vector2(1,1)},u_speed:{value:t.speed||3}}}),this.type="ImageTrailMeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$2).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set image(t){let e=(new TextureLoader).load(t);return e.wrapS=RepeatWrapping,e.wrapT=RepeatWrapping,this.uniforms.u_image.value=e,this}get image(){return this.uniforms.u_image.value}set repeat(t){return!t||t instanceof Vector2||(t=new Vector2(t.x,t.y)),this.uniforms.u_repeat.value=t,this}get repeat(){return this.uniforms.u_repeat.value}set speed(t){return this.uniforms.u_speed.value=t}get speed(){return this.uniforms.u_speed.value}get isImageTrailMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this.image.copy(t.image),this.repeat.copy(t.repeat),this}}var TrailMeshLineFS="#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvarying vec2 v_uv;\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\nuniform bool u_isY;\r\n\r\nvoid main() {\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec2 st = v_uv;\r\n    float t = fract(u_frameNumber / 1000.0 * u_speed ) ;\r\n    gl_FragColor = vec4(u_color, u_alpha * fract(st.s - t ) );\r\n\r\n    #include <fog_fragment>\r\n}";const{ShaderMaterial:ShaderMaterial$1,Color:Color$1,DoubleSide:DoubleSide$1}=THREE$1,DEF_PARAMS$1={transparent:!0,depthWrite:!1,depthTest:!1,side:DoubleSide$1,vertexShader:MeshLineVS,fragmentShader:TrailMeshLineFS};class TrailMeshLineMaterial extends ShaderMaterial$1{constructor(t={}){super({...DEF_PARAMS$1,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color$1).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="TrailMeshLineMaterial"}set color(t){return this.uniforms.u_color.value=(new Color$1).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isTrailMeshLineMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this.isY=t.isY,this}}var LightningSphereFS="precision mediump float;\r\nvarying vec2 v_uv;\r\nuniform float u_frameNumber;\r\nuniform vec3 u_color;\r\nuniform float u_alpha;\r\nuniform float u_speed;\r\n\r\nfloat rands(float p){\r\n    return fract(sin(p) * 10000.0);\r\n}\r\n\r\nfloat noise(vec2 p){\r\n    float time = u_frameNumber / 1000. * u_speed;\r\n    float t = time / 20000.0;\r\n    if(t > 1.0) t -= floor(t);\r\n    return rands(p.x * 14. + p.y * sin(t) * 0.5);\r\n}\r\n\r\nvec2 sw(vec2 p){\r\n    return vec2(floor(p.x), floor(p.y));\r\n}\r\nvec2 se(vec2 p){\r\n    return vec2(ceil(p.x), floor(p.y));\r\n}\r\nvec2 nw(vec2 p){\r\n    return vec2(floor(p.x), ceil(p.y));\r\n}\r\nvec2 ne(vec2 p){\r\n    return vec2(ceil(p.x), ceil(p.y));\r\n}\r\n\r\nfloat smoothNoise(vec2 p){\r\n    vec2 inter = smoothstep(0.0, 1.0, fract(p));\r\n    float s = mix(noise(sw(p)), noise(se(p)), inter.x);\r\n    float n = mix(noise(nw(p)), noise(ne(p)), inter.x);\r\n    return mix(s, n, inter.y);\r\n}\r\n\r\nfloat fbm(vec2 p){\r\n    float z = 2.0;\r\n    float rz = 0.0;\r\n    vec2 bp = p;\r\n    for(float i = 1.0; i < 6.0; i++){\r\n        rz += abs((smoothNoise(p) - 0.5)* 2.0) / z;\r\n        z *= 2.0;\r\n        p *= 2.0;\r\n    }\r\n    return rz;\r\n}\r\n\r\nvoid main() {\r\n    vec2 st = v_uv;\r\n    float rz = fbm(st * 4.0);\r\n    rz *= pow(14., 0.9);\r\n    gl_FragColor = mix(vec4(u_color, u_alpha) / rz, vec4(u_color, 0.1), 0.2);\r\n    if (st.s < 0.05) {\r\n        gl_FragColor = mix(vec4(u_color, 0.1), gl_FragColor, st.s / 0.05);\r\n    }\r\n    if (st.s > 0.95){\r\n        gl_FragColor = mix(gl_FragColor, vec4(u_color, 0.1), (st.s - 0.95) / 0.05);\r\n    }\r\n}";const{ShaderMaterial:ShaderMaterial,AdditiveBlending:AdditiveBlending,DoubleSide:DoubleSide,Color:Color}=THREE$1,DEF_PARAMS={transparent:!0,depthWrite:!0,depthTest:!1,side:DoubleSide,blending:AdditiveBlending,vertexShader:CommonVS,fragmentShader:LightningSphereFS};class LightningSphereMaterial extends ShaderMaterial{constructor(t={}){super({...DEF_PARAMS,uniforms:{u_frameNumber:{value:1},u_color:{value:(new Color).setStyle(t.color||"#fff")},u_alpha:{value:"number"==typeof t.alpha?t.alpha:1},u_speed:{value:t.speed||3}}}),this.type="LightningSphereMaterial"}set color(t){return this.uniforms.u_color.value=(new Color).setStyle(t),this}get color(){return this.uniforms.u_color.value}set alpha(t){return this.uniforms.u_alpha.value=t,this}get alpha(){return this.uniforms.u_alpha.value}set speed(t){return this.uniforms.u_speed.value=t,this}get speed(){return this.uniforms.u_speed.value}get isLightningSphereMaterial(){return!0}copy(t){return super.copy(t),this.color.copy(t.color),this.alpha=t.alpha,this.speed=t.speed,this}}function creatLines(t,e,r){let n=t.type;if(!n||"pipe"===n)return function(){let{color:r,width:n,data:a}=t,o=[],s=a[0].coordinate[0],u=e.projectToWorld(s),l=r||"#FFFFFF",c="number"==typeof l?l:(new Color$c).setStyle(l);a.forEach((t=>{let e=i(t.coordinate,u);const r=new LineMaterial({color:c,linewidth:n||1});r.resolution.set(window.innerWidth,window.innerHeight);const a=new LineGeometry;a.setPositions(e);const s=new Line2(a,r);for(let e in t)s.userData[e]=t[e];o.push(s)}));let h=e.Object3D({obj:o}).setCoords(s);return h.userData.added=!0,e.add(h),h}();if("solid"===n)return function(){let{color:n,width:a,data:o,opacity:s}=t,u=[],l=o[0].coordinate[0],c=e.projectToWorld(l);o.forEach((t=>{let e=i(t.coordinate,c),o=new MeshLine,l=new MeshLineMaterial({color:n,alpha:s});window.mapmost_materialCache[r].push(l),o.setPoints(e,a||10);let h=new Mesh(o,l);for(let e in t)h.userData[e]=t[e];u.push(h)}));let h=e.Object3D({obj:u}).setCoords(l);return h.userData.added=!0,e.add(h),h}();if("dash"===n)return function(){let{color:n,width:a,data:o,opacity:s,dashLength:u,dashOffset:l,dashRatio:c}=t,h=[],f=o[0].coordinate[0],d=e.projectToWorld(f);o.forEach((t=>{let e=i(t.coordinate,d),o=new MeshLine,f=new DashMeshLineMaterial({color:n,alpha:s,dashLength:u||.02,dashOffset:l||0,dashRatio:c||.5});window.mapmost_materialCache[r].push(f),o.setPoints(e,a||10);let p=new Mesh(o,f);for(let e in t)p.userData[e]=t[e];h.push(p)}));let p=e.Object3D({obj:h}).setCoords(f);return p.userData.added=!0,e.add(p),p}();if("image"===n)return function(){let{color:n,width:a,data:o,opacity:s,image:u,repeat:l}=t,c=[],h=o[0].coordinate[0],f=e.projectToWorld(h);o.forEach((t=>{let e=i(t.coordinate,f),o=new MeshLine,h=new ImageMeshLineMaterial({color:n,alpha:s,image:u,repeat:l||{x:1,y:1}});window.mapmost_materialCache[r].push(h),o.setPoints(e,a||10);let d=new Mesh(o,h);for(let e in t)d.userData[e]=t[e];c.push(d)}));let d=e.Object3D({obj:c}).setCoords(h);return d.userData.added=!0,e.add(d),d}();function i(t,r){let n=[];for(let i=0;i<t.length;i++){let a=e.projectToWorld(t[i]),o=a.y-r.y,s=a.z-r.z;n.push(a.x-r.x),n.push(o),n.push(s)}return n}}function creatFlowLines(t,e,r){let n=t.type;return"Circle"===n?function(){let r,{radius:n,opacity:i,side:a,repeatX:o,repeatY:s,speed:u,color:l,image:c,closed:h,data:f}=t,d=[],p=f.coordinate[0];n=(n||1)*e.projectedUnitsPerMeter(p[1]);let m=e.projectToWorld(p),v=f.coordinate,g=[];for(let t=0;t<v.length;t++){let r=e.projectToWorld(v[t]);g.push(new Vector3$1(r.x-m.x,r.y-m.y,r.z-m.z))}let y,_=getMaterialSide(a),b=new TubeGeometry(new CatmullRomCurve3(g),100,n,50,h),x="number"==typeof i?i:1,w=l||"#FFFFFF",M="number"==typeof w?w:(new Color$c).setStyle(w);if(c){let t=(new TextureLoader$3).load(c);t.wrapS=RepeatWrapping$2,t.wrapT=RepeatWrapping$2,t.repeat=new Vector2$3(o||10,s||1),y=new MeshPhongMaterial({map:t,color:M,side:_,transparent:!0,opacity:x}),r=setInterval((()=>{t.offset.x+=.01*(u||1)}))}else y=new MeshPhongMaterial({color:M,side:_,transparent:!0,opacity:x});let A=new Mesh(b,y);for(let t in f)A.userData[t]=f[t];d.push(A);let E=e.Object3D({obj:d}).setCoords(p);return r&&(E.userData.interval=r),e.add(E),E}():"Rectangle"===n?function(){let r,{steps:n,rectangle:i,opacity:a,side:o,repeatX:s,repeatY:u,speed:l,color:c,image:h,data:f}=t,d=[],p=f.coordinate[0],m=e.projectedUnitsPerMeter(p[1]),v=e.projectToWorld(p),g=f.coordinate,y=[];for(let t=0;t<g.length;t++)if(y.push(g[t]),0===t){let e=100;y.push([g[t][0]+(g[t+1][0]-g[t][0])/e,g[t][1]+(g[t+1][1]-g[t][1])/e,g[t][2]])}let _=[];for(let t=0;t<y.length;t++){let r=e.projectToWorld(y[t]);_.push(new Vector3$1(r.x-v.x,r.y-v.y,r.z-v.z))}let b=getMaterialSide(o);var x={steps:n||10,bevelEnabled:!1,extrudePath:new CatmullRomCurve3(_)};let w=[],M=i[0]*m,A=i[1]*m;w.push(new Vector2$3(-M/2,-A/2)),w.push(new Vector2$3(M/2,-A/2)),w.push(new Vector2$3(M/2,A/2)),w.push(new Vector2$3(-M/2,A/2));var E=new ExtrudeGeometry(new Shape(w),x);let S;!function(t){const e=t.faces;t.faceVertexUvs[0]=[];const r=[new Vector2$3(0,1),new Vector2$3(1,1),new Vector2$3(1,0),new Vector2$3(0,0)];for(let n=0;n<e.length/2;n++){const e=2*n;t.faceVertexUvs[0][e]=[r[0],r[1],r[3]],t.faceVertexUvs[0][e+1]=[r[1],r[2],r[3]]}t.uvsNeedUpdate=!0}(E);let T="number"==typeof a?a:1,C=c||"#FFFFFF",O="number"==typeof C?C:(new Color$c).setStyle(C);if(h){let t=(new TextureLoader$3).load(h);t.wrapS=RepeatWrapping$2,t.wrapT=RepeatWrapping$2,t.repeat=new Vector2$3(u||1,-1*s||-1),S=new MeshPhongMaterial({map:t,color:O,side:b,transparent:!0,opacity:T}),r=setInterval((()=>{t.offset.y-=.01*(l||1)}))}else S=new MeshPhongMaterial({color:O,side:b,transparent:!0,opacity:T});let P=new Mesh(E,[new MeshPhongMaterial({color:16777215,transparent:!0,side:b,opacity:.01}),S]);for(let t in f)P.userData[t]=f[t];d.push(P);let L=e.Object3D({obj:d}).setCoords(p);return r&&(L.userData.interval=r),e.add(L),L}():"trail"===n?function(){let{color:n,width:i,data:a,opacity:o,speed:s}=t,u=[],l=a.coordinate[0],c=e.projectToWorld(l),h=a.coordinate,f=[];for(let t=0;t<h.length;t++){let r=e.projectToWorld(h[t]),n=r.y-c.y,i=r.z-c.z;f.push(r.x-c.x),f.push(n),f.push(i)}let d=new MeshLine,p=new TrailMeshLineMaterial({color:n||"#003CFF",speed:s||3,alpha:o});window.mapmost_materialCache[r].push(p),d.setPoints(f,i||10);let m=new Mesh(d,p);for(let t in a)m.userData[t]=a[t];u.push(m);let v=e.Object3D({obj:u}).setCoords(l);return e.add(v),v}():"flow"===n?function(){let{color:n,width:i,data:a,opacity:o,speed:s,percent:u,gradient:l}=t,c=[],h=a.coordinate[0],f=e.projectToWorld(h),d=a.coordinate,p=[];for(let t=0;t<d.length;t++){let r=e.projectToWorld(d[t]),n=r.y-f.y,i=r.z-f.z;p.push(r.x-f.x),p.push(n),p.push(i)}let m=new MeshLine,v=new FlowMeshLineMaterial({color:n||"#ffff00",speed:s||3,alpha:o,percent:u||.08,gradient:l||.02});window.mapmost_materialCache[r].push(v),m.setPoints(p,i||10);let g=new Mesh(m,v);for(let t in a)g.userData[t]=a[t];c.push(g);let y=e.Object3D({obj:c}).setCoords(h);return e.add(y),y}():"image"===n?function(){let{color:n,width:i,data:a,opacity:o,repeat:s,speed:u,image:l}=t,c=[],h=a.coordinate[0],f=e.projectToWorld(h),d=a.coordinate,p=[];for(let t=0;t<d.length;t++){let r=e.projectToWorld(d[t]),n=r.y-f.y,i=r.z-f.z;p.push(r.x-f.x),p.push(n),p.push(i)}let m=new MeshLine,v=new ImageTrailMeshLineMaterial({color:n,alpha:o,repeat:s||{x:1,y:1},speed:u||3,image:l});window.mapmost_materialCache[r].push(v),m.setPoints(p,i||10);let g=new Mesh(m,v);for(let t in a)g.userData[t]=a[t];c.push(g);let y=e.Object3D({obj:c}).setCoords(h);return e.add(y),y}():void console.error("The correct parameter for type is required!")}function creatCircle(t,e,r){let n=t.type;return"scan"===n?function(){let{color:n,center:i,speed:a,opacity:o,radius:s,segment:u}=t,l=[],c=e.projectedUnitsPerMeter(i[1]),h=new ScanCircleMaterial({color:n||"#FFFFFF",alpha:o,speed:a||3}),f=new Mesh(new CircleGeometry((s||10)*c,u||256),h);window.mapmost_materialCache[r].push(h),l.push(f);let d=e.Object3D({obj:l}).setCoords(i);return e.add(d),d}():"spread"===n?function(){let{color:n,center:i,speed:a,opacity:o,radius:s,segment:u}=t,l=[],c=e.projectedUnitsPerMeter(i[1]),h=new DiffuseCircleMaterial({color:n||"#FFFFFF",alpha:o,speed:a||3}),f=new Mesh(new CircleGeometry((s||10)*c,u||256),h);window.mapmost_materialCache[r].push(h),l.push(f);let d=e.Object3D({obj:l}).setCoords(i);return e.add(d),d}():"radar"===n?function(){let{color:n,center:i,speed:a,opacity:o,radius:s,segment:u,isCW:l}=t,c=[],h=e.projectedUnitsPerMeter(i[1]),f=new Mesh,d=new ScanRadarMaterial({color:n||"#FFF",alpha:o,speed:a||3,isCW:l});f.geometry=new CircleGeometry((s||10)*h,u||256),f.material=d,window.mapmost_materialCache[r].push(d),c.push(f);let p=e.Object3D({obj:c}).setCoords(i);return e.add(p),p}():void console.error("The correct parameter for type is required!")}function creatGeoFencing(t,e,r){let n=t.type;return"fade"===n?function(){let{color:n,data:i,opacity:a,speed:o,height:s}=t,u=[],l=i.coordinate[0],c=e.projectToWorld(l),h=i.coordinate,f=[];for(let t=0;t<h.length;t++){let r=e.projectToWorld(h[t]);f.push(new Vector2$3(r.x-c.x,r.y-c.y))}const d=new Shape(f);d.holes.push(new Path(f));let p=e.projectedUnitsPerMeter(l[1]),m=new FadeWallMaterial({color:n||"#FFFFFF",alpha:a,speed:o||3}),v=new Mesh(new ExtrudeGeometry(d,{depth:1,bevelEnabled:!1,steps:1}),m);for(let t in i)v.userData[t]=i[t];v.scale.set(1,1,(s||1)*p),window.mapmost_materialCache[r].push(m),u.push(v);let g=e.Object3D({obj:u}).setCoords(l);return e.add(g),g}():"diffuse"===n?function(){let{color:n,data:i,opacity:a,speed:o,height:s}=t,u=[],l=i.coordinate[0],c=e.projectToWorld(l),h=i.coordinate,f=[];for(let t=0;t<h.length;t++){let r=e.projectToWorld(h[t]);f.push(new Vector2$3(r.x-c.x,r.y-c.y))}const d=new Shape(f);d.holes.push(new Path(f));let p=e.projectedUnitsPerMeter(l[1]),m=new DiffuseWallMaterial({color:n||"#FFF",alpha:a,speed:o||3}),v=new Mesh(new ExtrudeGeometry(d,{depth:1,bevelEnabled:!1,steps:1}),m);for(let t in i)v.userData[t]=i[t];v.scale.set(1,1,(s||1)*p),window.mapmost_materialCache[r].push(m),u.push(v);let g=e.Object3D({obj:u}).setCoords(l);return e.add(g),g}():void console.error("The correct parameter for type is required!")}function createModelEffect(t,e,r,n){let i=[];e.length?i=e:i.push(e),t.traverse((t=>{if(t&&t.material){t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere();let e=500;const{max:r,min:a}=t.geometry.boundingBox;let o=t.material;o.transparent=!0,o.needsUpdate=!0;let s={u_frameNumber:{type:"f",value:1}},u="\n                      varying vec2 v_uv;\n                      varying vec3 v_position;\n                      uniform float u_frameNumber;\n                      uniform float u_height;\n                      uniform float u_alpha;\n                       uniform vec3 r_u_color;\n                               ",l="\n                    vec3 distColor = outgoingLight;\n                    vec2 st = v_uv;               \n                    float temp ;\n                    float r_temp;\n                     ";i.map((t=>{let n=t.type;if("gradient"===n){let{startColor:e,endColor:n,opacity:i,percent:o}=t;s.u_startColor={type:"v3",value:(new Color$c).setStyle(e||"#040912")},s.u_endColor={type:"v3",value:(new Color$c).setStyle(n||"#FFFFFF")},s.u_alpha={type:"f",value:"number"==typeof i?i:1},s.u_height={type:"f",value:r.y-a.y},s.g_u_percent={type:"f",value:o||.5},u+="\n                      uniform vec3 u_startColor;\n                      uniform vec3 u_endColor;\n                      uniform float g_u_percent;\n                      ",l+="\n                    float f = v_position.y / (u_height * g_u_percent);\n                    distColor *= mix(u_startColor, u_endColor, f);\n                    "}else if("flow"===n){let{speed:e,color:n,opacity:i,percent:o}=t;s.u_speed={type:"f",value:e||3},s.u_color={type:"v3",value:(new Color$c).setStyle(n||"#339bf6")},s.u_alpha={type:"f",value:"number"==typeof i?i:1},s.u_height={type:"f",value:r.y-a.y},s.f_u_percent={type:"f",value:o||.01},u+="\n                      uniform vec3 u_color;                   \n                      uniform float u_speed;           \n                      uniform float f_u_percent;\n                        ",l+="\n                        float time = fract(u_frameNumber / 1000.0 * u_speed);\n                        temp = time * u_height;\n                        float range = v_position.y + u_height * f_u_percent;\n                        if( temp >  v_position.y && temp < range  ){\n                            float f = sin((range - temp) / (u_height * f_u_percent) * PI);\n                            distColor = mix(distColor,u_color,f);\n                        }\n                    "}else if("circle"===n){let{color:r,center:n,percent:i}=t;s.c_u_center={type:"v3",value:n||new Vector3$1(0,0,0)},s.c_u_radius={type:"f",value:e},s.c_u_color={type:"v3",value:(new Color$c).setStyle(r||"#23fffa")},s.u_alpha={type:"f",value:1},s.c_u_speed={type:"f",value:5},s.c_u_percent={type:"f",value:i||.01},u+="\n                        uniform vec3 c_u_center;\n                        uniform float c_u_radius;\n                        uniform vec3 c_u_color;\n                        uniform float c_u_speed;\n                        uniform float c_u_percent;\n                        ",l+="\n                        temp  = mod(u_frameNumber  * c_u_speed, c_u_radius * 2.0);\n                        float dis = distance(st,vec2(v_position.x,v_position.z));\n                        float diffuse_radius = c_u_percent * c_u_radius;\n                        if(dis < temp && dis > temp - diffuse_radius  ){\n                            float f = sin((temp - dis) / diffuse_radius * PI);\n                            distColor = mix(c_u_color, distColor, 1.0 - f);\n                        }\n                        "}else if("radar"===n){let{speed:r,center:n,color:i,isCW:a}=t;s.r_u_center={type:"v3",value:n||new Vector3$1(0,0,0)},s.r_u_radius={type:"f",value:e},s.r_u_color={type:"v3",value:(new Color$c).setStyle(i||"#FF0000")},s.u_alpha={type:"f",value:1},s.r_u_speed={type:"f",value:r||5},s.r_u_isCW={type:"b",value:a},u+="\n                      uniform vec3 r_u_center;\n                      uniform float r_u_radius;\n                      uniform float r_u_speed;\n                      uniform bool r_u_isCW;\n                        float RadarSweep(in float time, in vec2 c, in vec2 center, in float radius, in float speed, in bool dir_cw, in float tailLength){\n                          time *= speed;\n                          c -= center;\n                          if(!dir_cw) c.xy = c.yx;\n                          float x = length(c);\n                          float y = mod(atan(c.y, c.x) + time, PI * 2.0);\n                          y /= tailLength;\n                          float result = 0.0;\n                          if(x < radius) result += 1.0 - y;\n                          return result;\n                        }\n                            ",l+="\n                    vec2 center = vec2(v_position.x,v_position.z);\n                    float r_time = u_frameNumber / 1000.0 * r_u_speed;\n                    r_temp = RadarSweep(r_time, st, center, r_u_radius * 2.0, pow(r_u_speed,3.0), r_u_isCW, PI / 3.0 ); \n                    "}})),u+="\n                 void main() {\n                 ",l+="\n                if(r_temp  > 0.2 ){\n                gl_FragColor = vec4(r_u_color * ( r_temp + 0.8 ) ,  u_alpha);\n                }else {\n                gl_FragColor = vec4(distColor ,  u_alpha);\n                }\n                 ",o.onBeforeCompile=t=>{for(var e in s)t.uniforms[e]=s[e];t.vertexShader=t.vertexShader.replace("void main() {","\n                  varying vec2 v_uv;\n                  varying vec3 v_position;\n                  void main() {\n                      v_uv = uv;\n                      v_position = position;\n                "),t.fragmentShader=t.fragmentShader.replace("void main() {",u).replace("gl_FragColor = vec4( outgoingLight, diffuseColor.a );",l),window.mapmost_materialCache[n].push(t)}}}))}function creatSphere(t,e,r){let{color:n,center:i,opacity:a,speed:o,radius:s,wSegment:u,hSegment:l,phiStart:c,phiLength:h,thetaStart:f,thetaLength:d}=t,p=[],m=new SphereGeometry((s||10)*e.projectedUnitsPerMeter(i[1]),u||32,l||16,getRadian(c||0),getRadian(h||360),getRadian(f||0),getRadian(d||180)),v=new LightningSphereMaterial({color:n||"#ff0000",alpha:a,speed:o||3}),g=new Mesh(m,v);window.mapmost_materialCache[r].push(v),p.push(g);let y=e.Object3D({obj:p}).setCoords(i);return e.add(y),y}function getRadian(t){return t*Math.PI/180}function creatClassificationBox(t,e){let{coordinate:r,color:n,baseHeight:i,stretchHeight:a}=t,o=[r[0][0],r[0][1],i||0],s=e.projectToWorld(o),u=[];for(let t=0;t<r.length;t++){let n=e.projectToWorld(r[t]);u.push(new Vector2$3(n.x-s.x,n.y-s.y))}let l=new Mesh(new ExtrudeGeometry(new Shape(u),{depth:a*e.projectedUnitsPerMeter(o[1]),bevelEnabled:!1,steps:1}),new MeshBasicMaterial({color:(new Color$c).setStyle(n||"#ff0000")})),c=e.Object3D({obj:l}).setCoords(o);return e.add(c),c.children[0]}function classify3DTiles(t){let{mesh:e,color:r,opacity:n}=t;const i=new Group,a=new MeshBasicMaterial;a.depthWrite=!1,a.colorWrite=!1,a.side=FrontSide,a.stencilWrite=!0,a.stencilZFail=IncrementWrapStencilOp,a.stencilZPass=IncrementWrapStencilOp;const o=a.clone();o.side=BackSide,o.stencilZFail=DecrementWrapStencilOp,o.stencilZPass=DecrementWrapStencilOp;const s=a.clone();s.side=FrontSide,s.stencilZFail=KeepStencilOp,s.stencilZPass=DecrementWrapStencilOp;const u=a.clone();u.side=BackSide,u.stencilZFail=KeepStencilOp,u.stencilZPass=IncrementWrapStencilOp;const l=new MeshBasicMaterial;l.depthWrite=!1,l.depthTest=!1,l.stencilWrite=!0,l.stencilFunc=NotEqualStencilFunc,l.stencilRef=0,l.stencilFail=ReplaceStencilOp,l.stencilZFail=ReplaceStencilOp,l.stencilZPass=ReplaceStencilOp,l.color.set((new Color$c).setStyle(r||"#ff0000")),l.opacity=n||.5,l.transparent=!0,l.blending=CustomBlending,l.side=BackSide;let c=e.geometry;const h=new Mesh(c,a);h.renderOrder=1;const f=new Mesh(c,o);f.renderOrder=2;const d=new Mesh(c,s);d.renderOrder=3;const p=new Mesh(c,u);p.renderOrder=4;const m=new Mesh(c,l);return m.renderOrder=5,i.add(h),i.add(f),i.add(d),i.add(p),i.add(m),e.parent.add(i),i}var CSS2DObject=function(t){Object3D.call(this),this.element=t,this.element.style.position="absolute",this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))};CSS2DObject.prototype=Object.create(Object3D.prototype),CSS2DObject.prototype.constructor=CSS2DObject;var CSS2DRenderer=function(){var t,e,r,n,i=new Vector3$1,a=new Matrix4$2,o=new Matrix4$2,s={objects:new WeakMap},u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.getSize=function(){return{width:t,height:e}},this.setSize=function(i,a){r=(t=i)/2,n=(e=a)/2,u.style.width=i+"px",u.style.height=a+"px"};var l,c,h=function(t,e){if(t instanceof CSS2DObject){i.setFromMatrixPosition(t.matrixWorld),i.applyMatrix4(o);var a=t.element,l="translate(-50%,-50%) translate("+(i.x*r+r)+"px,"+(-i.y*n+n)+"px)";a.style.WebkitTransform=l,a.style.MozTransform=l,a.style.oTransform=l,a.style.transform=l,a.style.display=t.visible&&i.z>=-1&&i.z<=1?"":"none",t.userData.visible=!(i.x<-1||i.x>1||i.y<-1||i.y>1||i.z>1);var c={distanceToCameraSquared:f(e,t)};s.objects.set(t,c),a.parentNode!==u&&u.appendChild(a)}for(var d=0,p=t.children.length;d<p;d++)h(t.children[d],e)},f=(l=new Vector3$1,c=new Vector3$1,function(t,e){return l.setFromMatrixPosition(t.matrixWorld),c.setFromMatrixPosition(e.matrixWorld),l.distanceToSquared(c)});this.render=function(t,e){!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),a.copy(e.matrixWorldInverse),o.multiplyMatrices(e.projectionMatrix,a),h(t,e),function(t){var e=function(t){var e=[];return t.traverse((function(t){t instanceof CSS2DObject&&e.push(t)})),e}(t).sort((function(t,e){return s.objects.get(t).distanceToCameraSquared-s.objects.get(e).distanceToCameraSquared})),r=e.length;let n=[];for(var i=0,a=e.length;i<a;i++){e[i].element.style.zIndex=r-i;let t=e[i].userData;t.visible&&t.avoidance&&n.push(e[i].element)}n.length>0&&function(t){const e=[t[0]];for(let n=1,i=t.length;n<i;n++){let i=t[n];"none"!==i.style.display&&(e.some((t=>r(i.getBoundingClientRect(),t.getBoundingClientRect())))?i.style.display="none":e.push(i))}function r(t,e){let r=Math.abs(t.right+t.left-(e.right+e.left))/2,n=Math.abs(t.top+t.bottom-(e.top+e.bottom))/2;return r<(t.right-t.left+e.right-e.left)/2&&n<(t.bottom-t.top+e.bottom-e.top)/2}}(n)}(t)}};class ModelLayer extends ModelBaseLayer{constructor(t,e){super(t,e)}_init(){super._init();let{tb:t,options:e}=this;this.id=e.id;let r=e.defaultLights;if(""!==e.sky&&(e.sky=e.sky||"http://192.168.84.111:32800/sipsdmap_sdk/files/venice_sunset_2k_fixed5_1.hdr"),!r&&e.sky){let r=t.scene;const n=new HemisphereLight;n.name="hemi_light",r.add(n);const i=new AmbientLight(16777215,.3);i.name="ambient_light",r.add(i);const a=new DirectionalLight(16777215,.3);a.position.set(.5,0,.866),a.name="main_light",r.add(a);let o=t.renderer;o.toneMappingExposure=e.exposure||2.8,o.outputEncoding=sRGBEncoding,o.physicallyCorrectLights=!0,(new RGBELoader).load(e.sky,(function(e){e.encoding=RGBEEncoding,e.wrapS=RepeatWrapping$2,e.wrapT=RepeatWrapping$2,e.flipY=!1;let r=new PMREMGenerator(o);r.compileEquirectangularShader();const n=r.fromEquirectangular(e).texture;r.dispose(),t.scene.environment=n}))}e.project&&"3857"===e.project?this.addModelMercator(e.models,e.center,e.callback):this.addModel(e.models,e.center,e.callback)}addLight(t){super.addLight(t)}removeLight(t){super.removeLight(t)}addModel(t,e,r){let n,i=this.tb,a=[],o=[],s=[],u=this;t&&t.length>0?(t.forEach((t=>{t.type?"model"===t.type?t.model.forEach((t=>{t.rotateX(Math.PI/2).rotateY(Math.PI),s.push(t)})):(a.push(LoadObj(t)),o.push(t.type)):console.log("models 中缺少type定义")})),Promise.all(a).then((t=>{let a=[];t.forEach(((t,e)=>{if(t){let r=o[e],n="glb"===r||"gltf"===r?t.scene:t;n.rotateX(Math.PI/2).rotateY(Math.PI),a.push(n)}})),s=s.concat(a),n=i.Object3D({obj:s,units:"meters"}),n.setCoords(e),i.add(n),r&&r(n,u)}))):r&&r(n,u)}addModelMercator(t,e,r){let n,i=this.tb,a=[],o=[],s=[],u=this;t&&t.length>0?(t.forEach((t=>{t.type?"model"===t.type?t.model.forEach((t=>{t.rotateX(Math.PI/2).rotateY(Math.PI),s.push(t)})):(a.push(LoadObj(t)),o.push(t.type)):console.log("models 中缺少type定义")})),Promise.all(a).then((t=>{let a=[];t.forEach(((t,e)=>{if(t){let r=o[e],n="glb"===r||"gltf"===r?t.scene:t;n.rotateX(Math.PI/2).rotateY(Math.PI),a.push(n)}})),s=s.concat(a),n=i.Object3D({obj:s,units:"3857"}),n.setCoords(e),i.add(n),r&&r(n,u)}))):r&&r(n,u)}addBatchModel(t,e){let r,n=this.tb,{model:i,data:a,deepCopy:o}=t,s=a[0].coordinate,u=n.projectToWorld(s),l=void 0!==t.opacity?t.opacity:1,c=t.scale||1;c=n.projectedUnitsPerMeter(s[1])*c,LoadObj(i).then((t=>{let h="glb"===i.type||"gltf"===i.type?t.scene:t;h.rotateX(Math.PI/2).rotateY(Math.PI),h.scale.set(c,c,c),h.traverse((function(t){t instanceof Mesh&&(t.material.transparent=!0,t.material.opacity=l)})),r=setModel(n,a,s,h,u,o),e&&e(r)}))}addMarker(t){this.mapmost_render_tags||(this.mapmost_render_tags={});let e=this.tb,r=[],{id:n,avoidance:i,data:a}=t,o=a[0].position,s="mapmost_markers_"+n;if(this.mapmost_render_tags[s])return console.error("Current id '"+n+"' already exists!"),this.mapmost_render_tags[s];if(!window.mapmost_render_label){let t=new CSS2DRenderer,{width:r,height:n}=e.map.getCanvas().style;t.setSize(parseFloat(r.split("p")[0]),parseFloat(n.split("p")[0])),t.domElement.style.position="absolute",t.domElement.style.top="0px",e.map.getCanvas().parentElement.appendChild(t.domElement),window.mapmost_render_label=t}let u=[],l=e.projectToWorld(o);for(let t=0;t<a.length;t++){let n=a[t],{name:o,element:c,position:h}=n,f=c.cloneNode(!0);f.id=s+"_"+t,u.push(f.id);const d=new CSS2DObject(f);let p=e.projectToWorld(h),m=p.x-l.x,v=p.y-l.y,g=p.z-l.z;d.userData.avoidance=i,o&&(d.userData.name=o),d.position.set(m,v,g),r.push(d)}let c=e.Object3D({obj:r});c.setCoords(o),e.add(c);let h={element:c},f=this;return h.remove=function(){if(f.mapmost_render_tags[s]){e.remove(c);for(let t=0;t<u.length;t++){let e=document.getElementById(u[t]);window.mapmost_render_label.domElement.removeChild(e)}delete h.element,delete h.remove,delete f.mapmost_render_tags[s],0===window.mapmost_render_label.domElement.childElementCount&&(e.map.getCanvas().parentElement.removeChild(window.mapmost_render_label.domElement),window.mapmost_render_label=void 0)}},h.update=function(t){let r=h.element.children;for(let n=0;n<t.length;n++){let i=t[n];if(i.name)for(let t=0;t<r.length;t++){let n=r[t];if(n.userData.name===i.name){let t=e.projectToWorld(i.position);n.position.set(t.x-l.x,t.y-l.y,t.z-l.z),window.need3DRefresh=!0;break}}}},this.mapmost_render_tags[s]=h,window.need3DRefresh=!0,h}renderMarker(t,e){if(window.mapmost_render_matrix!==e.toString()||window.need3DRefresh){if(window.mapmost_render_label){window.need3DRefresh=!1;let t=this.tb;window.mapmost_render_label.render(t.scene,t.camera)}window.mapmost_render_matrix=e.toString()}}fadeModels(t,e,r,n){fade(t,e,r,n)}addPoints(t){let e,r=this.tb,{type:n,data:i,deepCopy:a}=t,o=i[0].coordinate,s=r.projectToWorld(o),u=void 0!==t.opacity?t.opacity:1,l=t.size||1;return l=r.projectedUnitsPerMeter(o[1])*l,"cube"===n?e=setModel(r,i,o,new Mesh(new BoxGeometry(l,l,l),new MeshBasicMaterial({color:t.color,transparent:!0,opacity:u})),s,a):"sphere"===n?e=setModel(r,i,o,new Mesh(new SphereGeometry(l,32,32),new MeshBasicMaterial({color:t.color,transparent:!0,opacity:u})),s,a):console.error("Please set the type parameter,cube or sphere!"),e}addLines(t){return creatLines(t,this.tb,this.id)}removeModelByAttribute(t,e){let r,n=window.mapmost_materialCache[this.id];this.tb.scene.traverse((function(n){n.userData[t]&&n.userData[t]===e&&(r=n)})),r&&r.type&&(r.parent.remove(r),clearMeshCache(r,n))}removeModel(t){t&&t.type&&(t.userData&&t.userData.interval&&clearInterval(t.userData.interval),clearGroup(t,window.mapmost_materialCache[this.id]),t.parent&&(t.parent=null),t=null)}addPolygons(t){let e=this.tb,{color:r,opacity:n,side:i,data:a}=t,o=[],s=a[0].coordinate[0],u=this.getMaterialSide(i),l=e.projectToWorld(s);a.forEach((t=>{let i=t.coordinate,a=[],s=[],c=i.length;i[0].toString()===i[c-1].toString()&&(c-=1);let h=[],f=1,d=!1,p=e.projectToWorld(i[c-1]),m=e.projectToWorld(i[0]),v=p.x-m.x;0===v?d=!0:f=(p.y-m.y)/v;for(let t=1;t<c-1;t++){let r=e.projectToWorld(i[t]),n=r.x-m.x,a=r.y-m.y;0===n?(0===a||d)&&h.push(t):a/n===f&&h.push(t)}for(let t=0;t<c;t++){let r=e.projectToWorld(i[t]),n=r.x-l.x,o=r.y-l.y,u=r.z-l.z;h.indexOf(t)>-1&&(n+=.1,o+=.1),a.push(new Vector3$1(n,o,u)),s.push(new Vector2$3(n,o))}let g=new Mesh(new ShapeGeometry(new Shape(s)),new MeshBasicMaterial({color:r,side:u,transparent:!0,opacity:void 0!==n?n:1}));for(let e in t)g.userData[e]=t[e];o.push(g);for(let t=0;t<a.length;t++){let e=a.length-t-1;h.indexOf(e)>-1&&(g.geometry.vertices[t].x-=.1,g.geometry.vertices[t].y-=.1),g.geometry.vertices[t].z=a[e].z}}));let c=e.Object3D({obj:o}).setCoords(s);return c.userData.added=!0,e.add(c),c}getMaterialSide(t){let e=FrontSide;return t&&("DoubleSide"===t?e=DoubleSide$c:"BackSide"===t&&(e=BackSide)),e}addPyramid(t){let e=this.tb,{topColor:r,opacity:n,side:i,baseColor:a,topPoint:o,basePoints:s}=t,u=o,l=e.projectToWorld(u),c=[];c.push(new Vector3$1(0,0,0));let h=s;h.reverse();let f=h.length;h[0].toString()===h[f-1].toString()&&(f-=1);for(let t=0;t<f;t++){let r=e.projectToWorld(h[t]);c.push(new Vector3$1(r.x-l.x,r.y-l.y,r.z-l.z))}let d=this.getMaterialSide(i),p=[new MeshBasicMaterial({vertexColors:VertexColors,side:d,transparent:!0,opacity:void 0!==n?n:1}),new MeshBasicMaterial({color:a,transparent:!0,side:d,opacity:a&&void 0!==n?n:0})],m=new Geometry$2;m.vertices.push(...c);for(let t=0;t<c.length-1;t++){let e=new Face3(0,t+1,t+2);t===c.length-2&&(e=new Face3(0,t+1,1)),e.materialIndex=0,e.vertexColors[0]=new Color$c(r[0]),e.vertexColors[1]=new Color$c(r[1]||r[0]),e.vertexColors[2]=new Color$c(r[1]||r[0]),m.faces.push(e)}for(let t=0;t<c.length-3;t++){let e=new Face3(1,t+3,t+2);e.materialIndex=1,m.faces.push(e)}m.computeFaceNormals();let v=new Mesh(m,p),g=e.Object3D({obj:[v]}).setCoords(u);return g.userData.added=!0,e.add(g),g}addFlowLine(t){return creatFlowLines(t,this.tb,this.id)}addCircle(t){return creatCircle(t,this.tb,this.id)}addGeoFencing(t){return creatGeoFencing(t,this.tb,this.id)}addSphere(t){return creatSphere(t,this.tb,this.id)}addModelEffect(t,e){return createModelEffect(t,e,this.tb,this.id)}removeModelEffect(t){t&&t.traverse((t=>{if(t&&t.material){let e=t.material;e.transparent=!0,e.needsUpdate=!0,e.onBeforeCompile=t=>{}}}))}addPolygonByLine(t){let e=this.tb,{color:r,height:n,opacity:i,norepeat:a,image:o,data:s}=t,u=[],l=s[0],c=e.projectedUnitsPerMeter(l[1]),h=e.projectToWorld(l),f=new MeshPhysicalMaterial({color:r||16777215,metalness:1,opacity:void 0!==i?i:1,side:DoubleSide$c,flatShading:!0});for(let t=0;t<s.length-1;t++){let r=[],l=e.projectToWorld(s[t]),d=l.x-h.x,p=l.y-h.y,m=l.z-h.z;r.push(new Vector3$1(d,p,m));let v=e.projectToWorld(s[t+1]),g=v.x-h.x,y=v.y-h.y,_=v.z-h.z;r.push(new Vector3$1(g,y,_)),r.push(new Vector3$1(g,y,_+c*n)),r.push(new Vector3$1(d,p,m+c*n));let b=[];b.push(new Face3(0,1,2)),b.push(new Face3(0,2,3));let x=[],w=[new Vector2$3(0,0),new Vector2$3(1,0),new Vector2$3(1,1),new Vector2$3(0,1)];x.push([w[0],w[1],w[2]]),x.push([w[0],w[2],w[3]]);let M=new Geometry$2;if(M.vertices=r,M.faces=b,M.faceVertexUvs[0]=x,M.computeFaceNormals(),o){let t=(new TextureLoader$3).load(o);t.wrapS=t.wrapT=RepeatWrapping$2;let e=1;a||(e=Math.sqrt(Math.pow(g-d,2)+Math.pow(y-p,2)+Math.pow(_-m,2))/(c*n)),t.needsUpdate=!0,t.repeat.set(e,1),f=new MeshPhysicalMaterial({transparent:!0,opacity:void 0!==i?i:1,map:t,side:DoubleSide$c,metalness:1,flatShading:!0}),f.needsUpdate=!0}let A=new Mesh(M,f);u.push(A)}let d=e.Object3D({obj:u}).setCoords(l);return d.userData.added=!0,e.add(d),d}getIntersectCoordinate(t){let e=this.tb,{object:r,point:n}=t,i=function t(r,n){if(r.coordinates){let t=r.coordinates,i=r.position.clone(),a=e.projectedUnitsPerMeter(t[1]),o=a;if(r.userData&&r.userData.units&&"3857"===r.userData.units&&(o=e.projectedUnitsPerMercator()),r.userData&&r.userData.added&&(o=1,a=1),r.userData&&r.userData.prematrix){let t=new Matrix4$2;t.multiplyMatrices((new Matrix4$2).getInverse(r.userData.prematrix),r.matrix),n=n.clone().applyMatrix4(t)}return i.x+=n.x*o,i.y+=n.y*o,i.z+=n.z*a,i}{let e=n.applyMatrix4(r.matrix);return t(r.parent,e)}}(r,n.clone().applyMatrix4((new Matrix4$2).getInverse(r.matrixWorld)));return e.unprojectFromWorld(i)}getModelCenter(t){let e=[];t.traverse((t=>{if(t instanceof Mesh){let r=t.geometry;r.computeBoundingBox();let{max:n,min:a}=r.boundingBox,o=i(t,n),s=i(t,a),u={};u.max=o,u.min=s,e.push(u)}}));let r=this.tb,n=function(t){let e=-1024e3,r=-1024e3,n=-1024e3,i=1024e3,a=1024e3,o=1024e3;return t.map((t=>{let{max:s,min:u}=t;s.x>e&&(e=s.x),u.x>e&&(e=u.x),s.y>r&&(r=s.y),u.y>r&&(r=u.y),s.z>n&&(n=s.z),u.z>n&&(n=u.z),u.x<i&&(i=u.x),s.x<i&&(i=s.x),u.y<a&&(a=u.y),s.y<a&&(a=s.y),u.z<o&&(o=u.z),s.z<o&&(o=s.z)})),new Vector3$1((e+i)/2,(r+a)/2,(n+o)/2)}(e);return r.unprojectFromWorld(n);function i(t,e){if(t.coordinates){let r=t.position.clone(),n=t.scale.z,i=t.scale.x;if(t.userData&&t.userData.prematrix){let r=new Matrix4$2;r.multiplyMatrices((new Matrix4$2).getInverse(t.userData.prematrix),t.matrix),e=e.clone().applyMatrix4(r)}return r.x+=e.x*i,r.y+=e.y*i,r.z+=e.z*n,r}{let r=e.applyMatrix4(t.matrix);return i(t.parent,r)}}}setVisibility(t){super.setVisibility(t)}selectModel(t,e){let r=e;return e||(r=this.tb.scene),r.traverse((t=>{t instanceof Mesh&&(t.geometry.computeBoundingBox(),t.geometry.computeBoundingSphere())})),super.selectModel(t,e)}getCamera(){return super.getCamera()}setExposure(t){super.setExposure(t)}addParticle(t){let e,r=this.tb,{data:n,size:i,opacity:a,color:o,maxPoints:s}=t,u=n[0].coordinate,l=r.projectToWorld(u),c=mapmost.THREE;const h=this._handlePoints(n,l),f=new c.BufferGeometry,d=new Float32Array(3*(s||n.length));h.forEach(((t,e)=>{d[e]=t})),f.setAttribute("position",new c.Float32BufferAttribute(d,3));const p=new c.ShaderMaterial({uniforms:{color:{value:new c.Color(o||16777215)},size:{value:i||1},opacity:{value:void 0!==a?a:1}},vertexShader:"\n              uniform float size;  \n\n              void main() {\n               vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n               gl_PointSize = size ;\n               gl_Position = projectionMatrix * mvPosition;\n             }\n            ",fragmentShader:"\n             uniform vec3 color;\n             uniform float opacity;\n         \n             void main() {\n                gl_FragColor = vec4( color, opacity );\n            }\n            "}),m=new c.Points(f,p);return e=r.Object3D({obj:[m]}),e.setCoords(u),r.add(e),e}_handlePoints(t,e){let r=this.tb,n=[];return t.forEach((t=>{let i=t.coordinate;if(i){let t=r.projectToWorld(i);n.push(t.x-e.x,t.y-e.y,t.z-e.z)}})),n}updateParticle(t,e){let r=this.tb.projectToWorld(t.coordinates),{data:n,size:i,opacity:a,color:o}=e;if(void 0!==i&&(t.children[0].material.uniforms.size.value=i),void 0!==a&&(t.children[0].material.uniforms.opacity.value=a),void 0!==o&&(t.children[0].material.uniforms.color.value=new Color$c(o||16777215)),void 0!==n){const e=this._handlePoints(n,r);let i=t.children[0].geometry,a=i.attributes;i.setDrawRange(0,n.length),e.forEach(((t,e)=>{a.position.array[e]=t})),a.position.needsUpdate=!0}}onAfterRender(t,e){if(e)return new Promise(((e,r)=>{let n=[];t.traverse((t=>{t instanceof Mesh&&n.push(t)}));let i=0;t.traverse((r=>{r instanceof Mesh&&(r.onAfterRender=function(){r.userData.renderover||(i++,i===n.length&&(t.traverse((t=>{t instanceof Mesh&&(delete t.onAfterRender,delete t.userData.renderover)})),e("Rendering is complete.")),r.userData.renderover=!0)})}))}));{let e=this.tb.camera;return new Promise(((t,r)=>{setTimeout((function(){let r=function(t){t.updateMatrixWorld();let e=new Frustum;return e.setFromMatrix((new Matrix4$2).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse)),e}(e);t(r)}),10)})).then((e=>new Promise(((r,n)=>{let i=[];t.traverse((t=>{t instanceof Mesh&&(t.geometry.computeBoundingSphere(),e.intersectsObject(t)&&i.push(t))}));let a=0;i.map((t=>{t.onAfterRender=function(){t.userData.renderover||(a++,a===i.length&&(i.map((t=>{delete t.onAfterRender,delete t.userData.renderover})),r("Rendering is complete.")),t.userData.renderover=!0)}}))}))))}}creatClassificationBox(t){return creatClassificationBox(t,this.tb)}classify3DTiles(t){return classify3DTiles(t)}}class BuildingsLayer extends ModelBaseLayer{constructor(t,e){super(t,e)}_init(){super._init(),this.options.models&&this.options.center?this._loadModel():this._addBuildings()}_translateTo84(t){let e=t;return this.options&&this.options.proj&&"3857"===this.options.proj&&(e=proj4("EPSG:3857","EPSG:4326",t)),e}_addBuildings(){const t=this.options,{data:e,images:r,heightProp:n,floorHeight:i,showFloor:a,material:o,callback:s}=t,{top:u,wall:l}=o||{},c=i||4;let h=this,f=this.tb;if(e.features&&e.features.length>0){let d={depth:5,steps:1,bevelEnabled:!1},p=[new MeshStandardMaterial({color:16777215}),new MeshStandardMaterial({color:16777215})];if(r){let M,A,E=!1;if("string"==typeof r&&(M=r,A=r),r instanceof Array&&(E=!0,M=r[0],A=r[1]||r[0]),M&&A){let S=new MeshLambertMaterial({transparent:!0,opacity:.9,side:DoubleSide$c,...u});E&&(S=new MeshLambertMaterial({transparent:!0,opacity:.9,map:(new TextureLoader$3).load(M),side:DoubleSide$c,...u}));let T=(new TextureLoader$3).load(A);T.wrapS=RepeatWrapping$2,T.wrapT=RepeatWrapping$2,p=[S,new MeshPhongMaterial({transparent:!0,opacity:1,map:T,side:DoubleSide$c,...l})]}}else p=[new MeshLambertMaterial({transparent:!0,opacity:.9,side:DoubleSide$c,...u}),new MeshLambertMaterial({transparent:!0,opacity:.9,side:DoubleSide$c,...l})];let m=new Geometry$2,v=this._translateTo84(e.features[0].geometry.coordinates[0][0][0]),g=f.projectToWorld(h._translateTo84(v));for(let C=0;C<e.features.length;C++)if(e.features[C].geometry.coordinates.length>0){let O=b(e.features[C].geometry.coordinates[0],e.features[C].properties[n]);m.merge(O)}let y=new Mesh(m,p),_=f.Object3D({obj:y}).setCoords(v);function b(t,e,r){let n,i=[],o=h._translateTo84(t[0][0]),s=f.projectToWorld([o[0],o[1],e]);if(d.depth=s.z,d.steps=a?Math.ceil(e/c):1,1===t.length){for(let e=0;e<t[0].length;e++){let r=f.projectToWorld(h._translateTo84(t[0][e]));i.push(new Vector2$3(r.x-g.x,r.y-g.y))}n=new ExtrudeGeometry(new Shape(i),d)}else{for(let e=0;e<t.length;e++){let r=[];for(let n=0;n<t[e].length;n++){let i=f.projectToWorld(h._translateTo84(t[e][n]));r.push(new Vector2$3(i.x-g.x,i.y-g.y))}i.push(r)}n=x(i,d),n=(new Geometry$2).fromBufferGeometry(n)}return w(n),n}function x(t,e){let r=new Shape(t[0]);for(let e in t)if(e>0){let n=new Path(t[e]);r.holes.push(n)}return new ExtrudeBufferGeometry(r,e)}function w(t){t.computeBoundingBox();const e=t.boundingBox.max,r=t.boundingBox.min,n=new Vector2$3(0-r.x,0-r.y),i=new Vector2$3(e.x-r.x,e.y-r.y),a=t.faces;t.faceVertexUvs[0]=[];const o=[new Vector2$3(0,1),new Vector2$3(1,1),new Vector2$3(1,0),new Vector2$3(0,0)];for(let e=0;e<a.length/2;e++){const r=2*e;if(0!==a[r].normal.z){const e=t.vertices[a[r].a],o=t.vertices[a[r].b],s=t.vertices[a[r].c];t.faceVertexUvs[0][r]=[new Vector2$3((e.x+n.x)/i.x,(e.y+n.y)/i.y),new Vector2$3((o.x+n.x)/i.x,(o.y+n.y)/i.y),new Vector2$3((s.x+n.x)/i.x,(s.y+n.y)/i.y)]}else t.faceVertexUvs[0][r]=[o[0],o[1],o[3]];if(0!==a[r+1].normal.z){const e=t.vertices[a[r+1].a],o=t.vertices[a[r+1].b],s=t.vertices[a[r+1].c];t.faceVertexUvs[0][r+1]=[new Vector2$3((e.x+n.x)/i.x,(e.y+n.y)/i.y),new Vector2$3((o.x+n.x)/i.x,(o.y+n.y)/i.y),new Vector2$3((s.x+n.x)/i.x,(s.y+n.y)/i.y)]}else t.faceVertexUvs[0][r+1]=[o[1],o[2],o[3]]}t.uvsNeedUpdate=!0}f.add(_),s&&s(_,h)}}_loadModel(){const{models:t,center:e,material:r,callback:n,images:i}=this.options;let a;const{top:o,wall:s}=r||{};let u,l;if(i){let t,e,r=!1;if("string"==typeof i&&(t=i,e=i),i instanceof Array&&(r=!0,t=i[0],e=i[1]||i[0]),t&&e){u=new MeshLambertMaterial({transparent:!0,opacity:.8,side:DoubleSide$c,...o}),r&&(u=new MeshLambertMaterial({transparent:!0,opacity:.8,map:(new TextureLoader$3).load(t),side:DoubleSide$c,...o}));let n=(new TextureLoader$3).load(e);n.wrapS=RepeatWrapping$2,n.wrapT=RepeatWrapping$2,l=new MeshPhongMaterial({transparent:!0,opacity:.9,map:n,side:DoubleSide$c,...s})}else u=new MeshLambertMaterial({transparent:!0,opacity:.8,side:DoubleSide$c,...o}),l=new MeshLambertMaterial({transparent:!0,opacity:.8,side:DoubleSide$c,...s})}a=function(t,e){l&&u&&t.traverse((function(t){t instanceof Mesh&&(t.material=t.material.name.toUpperCase().indexOf("WALL")>-1?l:u)})),n&&n(t,e)},this._addModelMercator(t,e,a)}_addModelMercator(t,e,r){let n,i=this.tb,a=[],o=[],s=[],u=this;t&&t.length>0?(t.forEach((t=>{t.type?"model"===t.type?t.model.forEach((t=>{t.rotateX(Math.PI/2).rotateY(Math.PI),s.push(t)})):(a.push(LoadObj(t)),o.push(t.type)):console.log("models 中缺少type定义")})),Promise.all(a).then((t=>{let a=[];t.forEach(((t,e)=>{if(t){let r=o[e],n="glb"===r||"gltf"===r?t.scene:t;n.rotateX(Math.PI/2).rotateY(Math.PI),a.push(n)}})),s=s.concat(a),n=i.Object3D({obj:s,units:"3857"}),n.setCoords(e),i.add(n),r&&r(n,u)}))):r&&r(n,u)}addLight(t){super.addLight(t)}removeLight(t){super.removeLight(t)}setVisibility(t){super.setVisibility(t)}selectModel(t,e){return super.selectModel(t,e)}getCamera(){return super.getCamera()}setExposure(t){super.setExposure(t)}}const shaders={heatmapShader:{vertexShader:"\n        uniform sampler2D heightMap;\n        uniform float heightRatio;\n        uniform float change;\n        varying vec2 vUv;\n        varying float hValue;\n        varying vec3 cl;\n        void main() {\n           vUv = uv;\n            vec3 pos = position;\n                cl = texture2D(heightMap, vUv).rgb;\n                hValue = texture2D(heightMap, vUv).r;\n               pos.y = hValue * heightRatio;\n               if(change > 2.0){\n                           pos.y = pos.y * change;\n             }\n             gl_Position = projectionMatrix * modelViewMatrix * vec4(pos,1.0);\n        }\n        ",fragmentShader:"\n           varying float hValue;\n\t\t\tvarying vec3 cl;\n\t\t\tvoid main() {\n\t\t \t\tfloat v = abs(hValue - 1.);\n\t\t \t\tgl_FragColor = vec4(cl, 1.0 - v * v) ;//透明度渐变，高度越高，透明度越低\n\t\t    }\n         "}};class HeatmapLayer extends ModelBaseLayer{constructor(t,e){super(t,e)}_init(){super._init(),this.options.coordinates?this.addHeatmapData_face():this.addHeatmapData()}addHeatmapData_face(){let t=this.tb;const e=this.options,{data:r,width:n,blur:i,radius:a,proj:o,gradient:s,heightRatio:u,coordinates:l,widthSegments:c,heightSegments:h,maxValue:f,minValue:d,callback:p}=e;let m=n||256,v=a||6;const{minBound:g,maxBound:y,average:_}=getDataBoundValue(l,t,1.5*v/m);let b=y[0]-g[0],x=y[1]-g[1],w=document.createElement("DIV");w.id="heatmap-canvas",w.style.display="none";let M=m*x/b;if(!window.h337)return void console.error("Cannot read property 'window.h337.create' of undefined. Needs heatmap.js");let A=window.h337.create({container:w,width:m,height:M,blur:i||.85,radius:v,gradient:s||{.1:"rgb(0,102,255)",.2:"rgb(102,255,255)",.3:"rgb(102,255,153)",.4:"rgb(125,255,0)",.5:"rgb(255,255,0)",.6:"rgb(255,204,0)",.7:"rgb(255,128,0)",.8:"rgb(255,102,0)",.9:"rgb(255,0,0)"}});function E(e){let r=tb_translate(o,e,t);const{min:n,max:i}=getDataBound_max(r);let a=[];for(let t=0;t<r.length;t++){let e=r[t];a.push({x:parseInt((e[0]-g[0])*m/b),y:parseInt((y[1]-e[1])*M/x),value:e[2]})}A.setData({min:d||n,max:f||i,data:a})}E(r);let S=[(g[0]+y[0])/2,(g[1]+y[1])/2],T=t.unprojectFromWorld(new Vector3$1(S[0],S[1],_)),C=new Texture(A._renderer.canvas);C.needsUpdate=!0;let O=new PlaneGeometry(b,x,c||300,h||300);O.rotateX(.5*-Math.PI);let P=(u||100)*t.projectedUnitsPerMeter(T[1]),L=new ShaderMaterial$c({uniforms:{heightMap:{value:C},heightRatio:{value:P},change:{value:2}},vertexShader:shaders.heatmapShader.vertexShader,fragmentShader:shaders.heatmapShader.fragmentShader,transparent:!0}),I=new Mesh(O,L);I.rotateX(Math.PI/2);let k=t.Object3D({obj:I}).setCoords(T);t.add(k),p&&p(k,this,(function(t){E(t),C=new Texture(A._renderer.canvas),C.needsUpdate=!0,L.uniforms.heightMap.value=C}))}addHeatmapData(){let t=this.tb;const e=this.options,{data:r,width:n,blur:i,radius:a,proj:o,altitude:s,gradient:u,heightRatio:l,widthSegments:c,heightSegments:h,maxValue:f,minValue:d,callback:p}=e;let m=tb_translate(o,r,t),v=n||256,g=a||6;const{minBound:y,maxBound:_,min:b,max:x}=getDataBound(m,1.5*g/v);let w=_[0]-y[0],M=_[1]-y[1],A=[],E=document.createElement("DIV");E.id="heatmap-canvas",E.style.display="none";let S=v*M/w;if(!window.h337)return void console.error("Cannot read property 'window.h337.create' of undefined. Needs heatmap.js");let T=window.h337.create({container:E,width:v,height:S,blur:i||.85,radius:g,gradient:u||{.1:"rgb(0,102,255)",.2:"rgb(102,255,255)",.3:"rgb(102,255,153)",.4:"rgb(125,255,0)",.5:"rgb(255,255,0)",.6:"rgb(255,204,0)",.7:"rgb(255,128,0)",.8:"rgb(255,102,0)",.9:"rgb(255,0,0)"}});for(let t=0;t<m.length;t++){let e=m[t];A.push({x:parseInt((e[0]-y[0])*v/w),y:parseInt((_[1]-e[1])*S/M),value:e[2]})}T.setData({min:d||b,max:f||x,data:A});let C=[(y[0]+_[0])/2,(y[1]+_[1])/2],O=t.unprojectFromWorld(new Vector3$1(C[0],C[1],0)),P=new Texture(T._renderer.canvas);P.needsUpdate=!0;let L=new PlaneGeometry(w,M,c||300,h||300);L.rotateX(.5*-Math.PI);let I=new Mesh(L,new ShaderMaterial$c({uniforms:{heightMap:{value:P},heightRatio:{value:(l||100)*t.projectedUnitsPerMeter(O[1])},change:{value:2}},vertexShader:shaders.heatmapShader.vertexShader,fragmentShader:shaders.heatmapShader.fragmentShader,transparent:!0}));I.rotateX(Math.PI/2);let k=t.Object3D({obj:I}).setCoords([O[0],O[1],s||0]);t.add(k),p&&p(k,this)}addLight(t){super.addLight(t)}removeLight(t){super.removeLight(t)}setVisibility(t){super.setVisibility(t)}getCamera(){return super.getCamera()}setExposure(t){super.setExposure(t)}}function addModelLayer(t){let e,r,n={id:t.id,type:"custom",renderingMode:"3d",onAdd:function(n,i){window.map=n,e=new sipsdThreeMin(n,i,{defaultLights:t.defaultLights,passiveRendering:!1});let a=e.renderer;r={frameNumber:1,resolution:new Vector2$3(a.domElement.width,a.domElement.height)},window.mapmost_materialCache||(window.mapmost_materialCache={}),window.mapmost_materialCache[t.id]=[],new ModelLayer(e,t),t.funcOnAdd&&t.funcOnAdd(e),window.addEventListener("resize",(function(){if(window.mapmost_render_label){let{width:t,height:e}=n.getCanvas().style;window.mapmost_render_label.setSize(parseFloat(t.split("p")[0]),parseFloat(e.split("p")[0]))}}))},render:function(n,a){if(e.cameraSync.setupCamera(),t.funcRender&&t.funcRender(n,a),window.mapmost_materialCache)for(var o in++r.frameNumber,r.frameNumber>15e6&&(r.frameNumber=1),window.mapmost_materialCache){let t=window.mapmost_materialCache[o];t.length>0&&i(t)}e.update(!0)}};function i(t){const e=["frameNumber","resolution"];t.forEach((t=>{e.forEach((e=>{t.uniforms["u_"+e]={value:r[e]},t.uniforms[e]={value:r[e]}}))}))}return n}function addBuildingsLayer(t){let e;return{id:t.id,type:"custom",renderingMode:"3d",onAdd:function(r,n){window.map=r,e=new sipsdThreeMin(r,n,{defaultLights:!1!==t.defaultLights,passiveRendering:!1}),new BuildingsLayer(e,t)},render:function(t,r){e.cameraSync.setupCamera(),e.update(!0)}}}function addHeatmapLayer(t){let e;return{id:t.id,type:"custom",renderingMode:"3d",onAdd:function(r,n){window.map=r,e=new sipsdThreeMin(r,n,{defaultLights:!1!==t.defaultLights,passiveRendering:!1}),new HeatmapLayer(e,t)},render:function(t,r){e.cameraSync.setupCamera(),e.update(!0)}}}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function assert$5(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const uidCounters={};function uid(t="id"){return uidCounters[t]=uidCounters[t]||1,`${t}-${uidCounters[t]++}`}function assert$4(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const config={};function round(t){return Math.round(t/config.EPSILON)*config.EPSILON}function formatValue(t,{precision:e=config.precision||4}={}){return t=round(t),"".concat(parseFloat(t.toPrecision(e)))}function isArray(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function equals$1(t,e,r){const n=config.EPSILON;r&&(config.EPSILON=r);try{if(t===e)return!0;if(isArray(t)&&isArray(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!equals$1(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=config.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{config.EPSILON=n}}function _extendableBuiltin(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}config.EPSILON=1e-12,config.debug=!1,config.precision=4,config.printTypes=!1,config.printDegrees=!1,config.printRowMajor=!0;class MathArray extends(_extendableBuiltin(Array)){get ELEMENTS(){return assert$4(!1),0}clone(){return(new this.constructor).copy(this)}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}fromArray(t,e=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}to(t){return t===this?this:isArray(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toArray(t=[],e=0){for(let r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(config)}formatString(t){let e="";for(let r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+formatValue(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!equals$1(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,r){void 0===r&&(r=e,e=t,t=this);for(let n=0;n<this.ELEMENTS;++n){const i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if(Array.isArray(t))return this.multiply(t);for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.scale(1/t)}clampScalar(t,e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}multiplyByScalar(t){return this.scale(t)}get elements(){return this}check(){if(config.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}function validateVector(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}function checkNumber(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function checkVector(t,e,r=""){if(config.debug&&!validateVector(t,e))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return t}const map$1={};function deprecated(t,e){map$1[t]||(map$1[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}var EPSILON$1=1e-6,ARRAY_TYPE$1="undefined"!=typeof Float32Array?Float32Array:Array,vec;function create$5(){var t=new ARRAY_TYPE$1(2);return ARRAY_TYPE$1!=Float32Array&&(t[0]=0,t[1]=0),t}function transformMat4$3(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function vec2_transformMat4AsVector(t,e,r){const n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}function vec3_transformMat4AsVector(t,e,r){const n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}function create$4(){var t=new ARRAY_TYPE$1(3);return ARRAY_TYPE$1!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function transformMat4$2(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/(o=o||1),t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),vec=create$5(),create$4();class Matrix extends MathArray{get ELEMENTS(){return assert$4(!1),0}get RANK(){return assert$4(!1),0}toString(){let t="[";if(config.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,r){return this[e*this.RANK+t]=checkNumber(r),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[r+t];return e}setColumn(t,e){const r=t*this.RANK;for(let t=0;t<this.RANK;++t)this[r+t]=e[t];return this}}function identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function transpose(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function invert$1(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=r*s-n*o,_=r*u-i*o,b=r*l-a*o,x=n*u-i*s,w=n*l-a*s,M=i*l-a*u,A=c*m-h*p,E=c*v-f*p,S=c*g-d*p,T=h*v-f*m,C=h*g-d*m,O=f*g-d*v,P=y*O-_*C+b*T+x*S-w*E+M*A;return P?(t[0]=(s*O-u*C+l*T)*(P=1/P),t[1]=(i*C-n*O-a*T)*P,t[2]=(m*M-v*w+g*x)*P,t[3]=(f*w-h*M-d*x)*P,t[4]=(u*S-o*O-l*E)*P,t[5]=(r*O-i*S+a*E)*P,t[6]=(v*b-p*M-g*_)*P,t[7]=(c*M-f*b+d*_)*P,t[8]=(o*C-s*S+l*A)*P,t[9]=(n*S-r*C-a*A)*P,t[10]=(p*w-m*b+g*y)*P,t[11]=(h*b-c*w-d*y)*P,t[12]=(s*E-o*T-u*A)*P,t[13]=(r*T-n*E+i*A)*P,t[14]=(m*_-p*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null}function determinant(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15];return(e*o-r*a)*(h*v-f*m)-(e*s-n*a)*(c*v-f*p)+(e*u-i*a)*(c*m-h*p)+(r*s-n*o)*(l*v-f*d)-(r*u-i*o)*(l*m-h*d)+(n*u-i*s)*(l*p-c*d)}function multiply$1(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*i+b*u+x*f+w*v,t[2]=_*a+b*l+x*d+w*g,t[3]=_*o+b*c+x*p+w*y,t[4]=(_=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=_*i+b*u+x*f+w*v,t[6]=_*a+b*l+x*d+w*g,t[7]=_*o+b*c+x*p+w*y,t[8]=(_=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=_*i+b*u+x*f+w*v,t[10]=_*a+b*l+x*d+w*g,t[11]=_*o+b*c+x*p+w*y,t[12]=(_=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=_*i+b*u+x*f+w*v,t[14]=_*a+b*l+x*d+w*g,t[15]=_*o+b*c+x*p+w*y,t}function translate$1(t,e,r){var n,i,a,o,s,u,l,c,h,f,d,p,m=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=n=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+s*v+h*g+e[12],t[13]=i*m+u*v+f*g+e[13],t[14]=a*m+l*v+d*g+e[14],t[15]=o*m+c*v+p*g+e[15]),t}function scale$2(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rotate(t,e,r,n){var i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,E,S,T,C=n[0],O=n[1],P=n[2],L=Math.hypot(C,O,P);return L<EPSILON$1?null:(C*=L=1/L,O*=L,P*=L,i=Math.sin(r),a=Math.cos(r),u=e[1],l=e[2],c=e[3],f=e[5],d=e[6],p=e[7],v=e[9],g=e[10],y=e[11],w=C*O*(o=1-a)-P*i,M=O*O*o+a,A=P*O*o+C*i,E=C*P*o+O*i,S=O*P*o-C*i,T=P*P*o+a,t[0]=(s=e[0])*(_=C*C*o+a)+(h=e[4])*(b=O*C*o+P*i)+(m=e[8])*(x=P*C*o-O*i),t[1]=u*_+f*b+v*x,t[2]=l*_+d*b+g*x,t[3]=c*_+p*b+y*x,t[4]=s*w+h*M+m*A,t[5]=u*w+f*M+v*A,t[6]=l*w+d*M+g*A,t[7]=c*w+p*M+y*A,t[8]=s*E+h*S+m*T,t[9]=u*E+f*S+v*T,t[10]=l*E+d*S+g*T,t[11]=c*E+p*S+y*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function rotateX$1(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+c*n,t[6]=s*i+h*n,t[7]=u*i+f*n,t[8]=l*i-a*n,t[9]=c*i-o*n,t[10]=h*i-s*n,t[11]=f*i-u*n,t}function rotateY(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*n,t[1]=o*i-c*n,t[2]=s*i-h*n,t[3]=u*i-f*n,t[8]=a*n+l*i,t[9]=o*n+c*i,t[10]=s*n+h*i,t[11]=u*n+f*i,t}function rotateZ$1(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+c*n,t[2]=s*i+h*n,t[3]=u*i+f*n,t[4]=l*i-a*n,t[5]=c*i-o*n,t[6]=h*i-s*n,t[7]=f*i-u*n,t}function fromQuat(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,h=n*s,f=i*o,d=i*s,p=i*u,m=a*o,v=a*s,g=a*u;return t[0]=1-h-p,t[1]=c+g,t[2]=f-v,t[3]=0,t[4]=c-g,t[5]=1-l-p,t[6]=d+m,t[7]=0,t[8]=f+v,t[9]=d-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function frustum(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function perspective$1(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function ortho(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t}function lookAt(t,e,r,n){var i,a,o,s,u,l,c,h,f,d,p=e[0],m=e[1],v=e[2],g=n[0],y=n[1],_=n[2],b=r[0],x=r[1],w=r[2];return Math.abs(p-b)<EPSILON$1&&Math.abs(m-x)<EPSILON$1&&Math.abs(v-w)<EPSILON$1?identity(t):(c=p-b,h=m-x,f=v-w,i=y*(f*=d=1/Math.hypot(c,h,f))-_*(h*=d),a=_*(c*=d)-g*f,o=g*h-y*c,(d=Math.hypot(i,a,o))?(i*=d=1/d,a*=d,o*=d):(i=0,a=0,o=0),s=h*o-f*a,u=f*i-c*o,l=c*a-h*i,(d=Math.hypot(s,u,l))?(s*=d=1/d,u*=d,l*=d):(s=0,u=0,l=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=a,t[5]=u,t[6]=h,t[7]=0,t[8]=o,t[9]=l,t[10]=f,t[11]=0,t[12]=-(i*p+a*m+o*v),t[13]=-(s*p+u*m+l*v),t[14]=-(c*p+h*m+f*v),t[15]=1,t)}function create$3(){var t=new ARRAY_TYPE$1(4);return ARRAY_TYPE$1!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function transformMat4$1(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}create$3();const IDENTITY$1=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),ZERO=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),INDICES=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),constants={};class Matrix4$1 extends Matrix{static get IDENTITY(){return constants.IDENTITY=constants.IDENTITY||Object.freeze(new Matrix4$1(IDENTITY$1)),constants.IDENTITY}static get ZERO(){return constants.ZERO=constants.ZERO||Object.freeze(new Matrix4$1(ZERO)),constants.ZERO}get INDICES(){return INDICES}get ELEMENTS(){return 16}get RANK(){return 4}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=l,this[10]=c,this[11]=h,this[12]=f,this[13]=d,this[14]=p,this[15]=m,this.check()}setRowMajor(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=l,this[7]=d,this[8]=r,this[9]=o,this[10]=c,this[11]=p,this[12]=n,this[13]=s,this[14]=h,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(IDENTITY$1)}fromQuaternion(t){return fromQuat(this,t),this.check()}frustum({left:t,right:e,bottom:r,top:n,near:i,far:a}){return a===1/0?Matrix4$1._computeInfinitePerspectiveOffCenter(this,t,e,r,n,i):frustum(this,t,e,r,n,i,a),this.check()}static _computeInfinitePerspectiveOffCenter(t,e,r,n,i,a){const o=2*a/(i-n),s=(r+e)/(r-e),u=(i+n)/(i-n),l=-2*a;return t[0]=2*a/(r-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=s,t[9]=u,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}lookAt(t,e,r){return 1===arguments.length&&({eye:t,center:e,up:r}=t),lookAt(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}ortho({left:t,right:e,bottom:r,top:n,near:i=.1,far:a=500}){return ortho(this,t,e,r,n,i,a),this.check()}orthographic({fovy:t=45*Math.PI/180,aspect:e=1,focalDistance:r=1,near:n=.1,far:i=500}){if(t>2*Math.PI)throw Error("radians");const a=r*Math.tan(t/2),o=a*e;return(new Matrix4$1).ortho({left:-o,right:o,bottom:-a,top:a,near:n,far:i})}perspective({fovy:t,fov:e=45*Math.PI/180,aspect:r=1,near:n=.1,far:i=500}={}){if((t=t||e)>2*Math.PI)throw Error("radians");return perspective$1(this,t,r,n,i),this.check()}determinant(){return determinant(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*a,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t=[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=null){const r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],a=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*a,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*a,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*a,t}transpose(){return transpose(this,this),this.check()}invert(){return invert$1(this,this),this.check()}multiplyLeft(t){return multiply$1(this,t,this),this.check()}multiplyRight(t){return multiply$1(this,this,t),this.check()}rotateX(t){return rotateX$1(this,this,t),this.check()}rotateY(t){return rotateY(this,this,t),this.check()}rotateZ(t){return rotateZ$1(this,this,t),this.check()}rotateXYZ([t,e,r]){return this.rotateX(t).rotateY(e).rotateZ(r)}rotateAxis(t,e){return rotate(this,this,t,e),this.check()}scale(t){return Array.isArray(t)?scale$2(this,this,t):scale$2(this,this,[t,t,t]),this.check()}translate(t){return translate$1(this,this,t),this.check()}transform(t,e){return 4===t.length?(checkVector(e=transformMat4$1(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:r}=t;switch(r){case 2:e=transformMat4$3(e||[-0,-0],t,this);break;case 3:e=transformMat4$2(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return checkVector(e,t.length),e}transformAsVector(t,e){switch(t.length){case 2:e=vec2_transformMat4AsVector(e||[-0,-0],t,this);break;case 3:e=vec3_transformMat4AsVector(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return checkVector(e,t.length),e}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,r){return this.identity().translate([t,e,r])}transformPoint(t,e){return deprecated("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}transformVector(t,e){return deprecated("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}transformDirection(t,e){return deprecated("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}const DRAW_MODE={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Geometry{static get DRAW_MODE(){return DRAW_MODE}constructor(t={}){const{id:e=uid("geometry"),drawMode:r=DRAW_MODE.TRIANGLES,attributes:n={},indices:i=null,vertexCount:a=null}=t;this.id=e,this.drawMode=0|r,this.attributes={},this.userData={},this._setAttributes(n,i),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,e){e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e);for(const e in t){let r=t[e];r=ArrayBuffer.isView(r)?{value:r}:r,assert$5(ArrayBuffer.isView(r.value),`${this._print(e)}: must be typed array or object with value as typed array`),"POSITION"!==e&&"positions"!==e||r.size||(r.size=3),"indices"===e?(assert$5(!this.indices),this.indices=r):this.attributes[e]=r}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(t,e){if(e)return e.value.length;let r=1/0;for(const e in t){const n=t[e],{value:i,size:a,constant:o}=n;!o&&i&&a>=1&&(r=Math.min(r,i.length/a))}return assert$5(Number.isFinite(r)),r}}const INDEX_OFFSETS={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class TruncatedConeGeometry extends Geometry{constructor(t={}){const{id:e=uid("truncated-code-geometry")}=t,{indices:r,attributes:n}=tesselateTruncatedCone(t);super({...t,id:e,indices:r,attributes:{...n,...t.attributes}})}}function tesselateTruncatedCone(t){const{bottomRadius:e=0,topRadius:r=0,height:n=1,nradial:i=10,nvertical:a=10,verticalAxis:o="y",topCap:s=!1,bottomCap:u=!1}=t,l=(s?2:0)+(u?2:0),c=(i+1)*(a+1+l),h=Math.atan2(e-r,n),f=Math.sin,d=Math.cos,p=Math.PI,m=d(h),v=f(h),g=s?-2:0,y=a+(u?2:0),_=i+1,b=new Uint16Array(i*(a+l)*6),x=INDEX_OFFSETS[o],w=new Float32Array(3*c),M=new Float32Array(3*c),A=new Float32Array(2*c);let E=0,S=0;for(let t=g;t<=y;t++){let o,s=t/a,u=n*s;t<0?(u=0,s=1,o=e):t>a?(u=n,s=1,o=r):o=e+t/a*(r-e),-2!==t&&t!==a+2||(o=0,s=0),u-=n/2;for(let e=0;e<_;e++){const r=f(e*p*2/i),n=d(e*p*2/i);w[E+x[0]]=r*o,w[E+x[1]]=u,w[E+x[2]]=n*o,M[E+x[0]]=t<0||t>a?0:r*m,M[E+x[1]]=t<0?-1:t>a?1:v,M[E+x[2]]=t<0||t>a?0:n*m,A[S+0]=e/i,A[S+1]=s,S+=2,E+=3}}for(let t=0;t<a+l;t++)for(let e=0;e<i;e++){const r=6*(t*i+e);b[r+0]=_*(t+0)+0+e,b[r+1]=_*(t+0)+1+e,b[r+2]=_*(t+1)+1+e,b[r+3]=_*(t+0)+0+e,b[r+4]=_*(t+1)+1+e,b[r+5]=_*(t+1)+0+e}return{indices:b,attributes:{POSITION:{size:3,value:w},NORMAL:{size:3,value:M},TEXCOORD_0:{size:2,value:A}}}}class CylinderGeometry extends TruncatedConeGeometry{constructor(t={}){const{id:e=uid("cylinder-geometry"),radius:r=1}=t;super({...t,id:e,bottomRadius:r,topRadius:r})}}const VERSION$1="3.2.2",DEFAULT_DRACO_OPTIONS={draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}},DracoLoader$1={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:VERSION$1,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:DEFAULT_DRACO_OPTIONS};function getMeshBoundingBox(t){let e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0;const s=t.POSITION?t.POSITION.value:[],u=s&&s.length;for(let t=0;t<u;t+=3){const u=s[t],l=s[t+1],c=s[t+2];e=u<e?u:e,r=l<r?l:r,n=c<n?c:n,i=u>i?u:i,a=l>a?l:a,o=c>o?c:o}return[[e,r,n],[i,a,o]]}function assert$3(t,e){if(!t)throw new Error(e||"loader assertion failed.")}class Schema{constructor(t,e){_defineProperty(this,"fields",void 0),_defineProperty(this,"metadata",void 0),assert$3(Array.isArray(t)),checkNames(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){const e=Object.create(null);for(const r of t)e[r]=!0;const r=this.fields.filter((t=>e[t.name]));return new Schema(r,this.metadata)}selectAt(...t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Schema(e,this.metadata)}assign(t){let e,r=this.metadata;if(t instanceof Schema){const n=t;e=n.fields,r=mergeMaps(mergeMaps(new Map,this.metadata),n.metadata)}else e=t;const n=Object.create(null);for(const t of this.fields)n[t.name]=t;for(const t of e)n[t.name]=t;const i=Object.values(n);return new Schema(i,r)}}function checkNames(t){const e={};for(const r of t)e[r.name]&&console.warn("Schema: duplicated field name",r.name,r),e[r.name]=!0}function mergeMaps(t,e){return new Map([...t||new Map,...e||new Map])}class Field{constructor(t,e,r=!1,n=new Map){_defineProperty(this,"name",void 0),_defineProperty(this,"type",void 0),_defineProperty(this,"nullable",void 0),_defineProperty(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new Field(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Type,_Symbol$toStringTag,_Symbol$toStringTag2,_Symbol$toStringTag7;!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(Type||(Type={}));class DataType{static isNull(t){return t&&t.typeId===Type.Null}static isInt(t){return t&&t.typeId===Type.Int}static isFloat(t){return t&&t.typeId===Type.Float}static isBinary(t){return t&&t.typeId===Type.Binary}static isUtf8(t){return t&&t.typeId===Type.Utf8}static isBool(t){return t&&t.typeId===Type.Bool}static isDecimal(t){return t&&t.typeId===Type.Decimal}static isDate(t){return t&&t.typeId===Type.Date}static isTime(t){return t&&t.typeId===Type.Time}static isTimestamp(t){return t&&t.typeId===Type.Timestamp}static isInterval(t){return t&&t.typeId===Type.Interval}static isList(t){return t&&t.typeId===Type.List}static isStruct(t){return t&&t.typeId===Type.Struct}static isUnion(t){return t&&t.typeId===Type.Union}static isFixedSizeBinary(t){return t&&t.typeId===Type.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===Type.FixedSizeList}static isMap(t){return t&&t.typeId===Type.Map}static isDictionary(t){return t&&t.typeId===Type.Dictionary}get typeId(){return Type.NONE}compareTo(t){return this===t}}_Symbol$toStringTag=Symbol.toStringTag;class Int extends DataType{constructor(t,e){super(),_defineProperty(this,"isSigned",void 0),_defineProperty(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return Type.Int}get[_Symbol$toStringTag](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Int8 extends Int{constructor(){super(!0,8)}}class Int16 extends Int{constructor(){super(!0,16)}}class Int32 extends Int{constructor(){super(!0,32)}}class Uint8 extends Int{constructor(){super(!1,8)}}class Uint16 extends Int{constructor(){super(!1,16)}}class Uint32 extends Int{constructor(){super(!1,32)}}const Precision={HALF:16,SINGLE:32,DOUBLE:64};_Symbol$toStringTag2=Symbol.toStringTag;class Float extends DataType{constructor(t){super(),_defineProperty(this,"precision",void 0),this.precision=t}get typeId(){return Type.Float}get[_Symbol$toStringTag2](){return"Float"}toString(){return"Float".concat(this.precision)}}class Float32 extends Float{constructor(){super(Precision.SINGLE)}}class Float64 extends Float{constructor(){super(Precision.DOUBLE)}}_Symbol$toStringTag7=Symbol.toStringTag;class FixedSizeList extends DataType{constructor(t,e){super(),_defineProperty(this,"listSize",void 0),_defineProperty(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return Type.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[_Symbol$toStringTag7](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function getArrowTypeFromTypedArray(t){switch(t.constructor){case Int8Array:return new Int8;case Uint8Array:return new Uint8;case Int16Array:return new Int16;case Uint16Array:return new Uint16;case Int32Array:return new Int32;case Uint32Array:return new Uint32;case Float32Array:return new Float32;case Float64Array:return new Float64;default:throw new Error("array type not supported")}}function deduceMeshField(t,e,r){const n=getArrowTypeFromTypedArray(e.value),i=r||makeMeshAttributeMetadata(e);return new Field(t,new FixedSizeList(e.size,new Field("value",n)),!1,i)}function makeMeshAttributeMetadata(t){const e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}function getDracoSchema(t,e,r){const n=makeMetadata(e.metadata),i=[],a=transformAttributesLoaderData(e.attributes);for(const e in t){const r=getArrowFieldFromAttribute(e,t[e],a[e]);i.push(r)}if(r){const t=getArrowFieldFromAttribute("indices",r);i.push(t)}return new Schema(i,n)}function transformAttributesLoaderData(t){const e={};for(const r in t){const n=t[r];e[n.name||"undefined"]=n}return e}function getArrowFieldFromAttribute(t,e,r){return deduceMeshField(t,e,r?makeMetadata(r.metadata):void 0)}function makeMetadata(t){const e=new Map;for(const r in t)e.set("".concat(r,".string"),JSON.stringify(t[r]));return e}const DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},INDEX_ITEM_SIZE=4;class DracoParser{constructor(t){_defineProperty(this,"draco",void 0),_defineProperty(this,"decoder",void 0),_defineProperty(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const n=this.decoder.GetEncodedGeometryType(r),i=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let t;switch(n){case this.draco.TRIANGULAR_MESH:t=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:t=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!t.ok()||!i.ptr){const e="DRACO decompression failed: ".concat(t.error_msg());throw new Error(e)}const a=this._getDracoLoaderData(i,n,e),o=this._getMeshData(i,a,e),s=getMeshBoundingBox(o.attributes),u=getDracoSchema(o.attributes,a,o.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:s},...o,schema:u}}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,e,r){const n=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:i}}_getDracoAttributes(t,e){const r={};for(let n=0;n<t.num_attributes();n++){const i=this.decoder.GetAttribute(t,n),a=this._getAttributeMetadata(t,n);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:n,metadata:a};const o=this._getQuantizationTransform(i,e);o&&(r[i.unique_id()].quantization_transform=o);const s=this._getOctahedronTransform(i,e);s&&(r[i.unique_id()].octahedron_transform=s)}return r}_getMeshData(t,e,r){const n=this._getMeshAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(t,e,r){const n={};for(const i of Object.values(t.attributes)){const t=this._deduceAttributeName(i,r);i.name=t;const{value:a,size:o}=this._getAttributeValues(e,i);n[t]={value:a,size:o,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return n}_getTriangleListIndices(t){const e=3*t.num_faces(),r=e*INDEX_ITEM_SIZE,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),getUint32Array(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const r=DRACO_DATA_TYPE_TO_TYPED_ARRAY_MAP[e.data_type],n=e.num_components,i=t.num_points()*n,a=i*r.BYTES_PER_ELEMENT,o=getDracoDataType(this.draco,r);let s;const u=this.draco._malloc(a);try{const n=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,n,o,a,u),s=new r(this.draco.HEAPF32.buffer,u,i).slice()}finally{this.draco._free(u)}return{value:s,size:n}}_deduceAttributeName(t,e){const r=t.unique_id;for(const[t,n]of Object.entries(e.extraAttributes||{}))if(n===r)return t;const n=t.attribute_type;for(const t in DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP)if(this.draco[t]===n)return DRACO_TO_GLTF_ATTRIBUTE_NAME_MAP[t];const i=e.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},r=this.metadataQuerier.NumEntries(t);for(let n=0;n<r;n++){const r=this.metadataQuerier.GetEntryName(t,n);e[r]=this._getDracoMetadataField(t,r)}return e}_getDracoMetadataField(t,e){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);const n=getInt32Array(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:r=[]}=t,n=[...e,...r];for(const t of n)this.decoder.SkipAttributeTransform(this.draco[t])}_getQuantizationTransform(t,e){const{quantizedAttributes:r=[]}=e,n=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits(),range:e.range(),min_values:new Float32Array([1,2,3]).map((t=>e.min_value(t)))}}finally{this.draco.destroy(e)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:r=[]}=e,n=t.attribute_type();if(r.map((t=>this.decoder[t])).includes(n)){const e=new this.draco.AttributeQuantizationTransform;try{if(e.InitFromAttribute(t))return{quantization_bits:e.quantization_bits()}}finally{this.draco.destroy(e)}}return null}}function getDracoDataType(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function getInt32Array(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function getUint32Array(t){const e=t.size(),r=new Int32Array(e);for(let n=0;n<e;n++)r[n]=t.GetValue(n);return r}function assert$2(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const globals={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},global_=globals.global||globals.self||globals.window||{},isBrowser="object"!=typeof process||"[object process]"!==String(process)||process.browser,isWorker="function"==typeof importScripts,matches="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);matches&&parseFloat(matches[1]);var _nodeResolve_empty={},node=Object.freeze({__proto__:null,default:_nodeResolve_empty});const VERSION="3.2.2",loadLibraryPromises={};async function loadLibrary(t,e=null,r={}){return e&&(t=getLibraryUrl(t,e,r)),loadLibraryPromises[t]=loadLibraryPromises[t]||loadLibraryFromFile(t),await loadLibraryPromises[t]}function getLibraryUrl(t,e,r){if(t.startsWith("http"))return t;const n=r.modules||{};return n[t]?n[t]:isBrowser?r.CDN?(assert$2(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(e,"@").concat(VERSION,"/dist/libs/").concat(t)):isWorker?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}async function loadLibraryFromFile(t){if(t.endsWith("wasm")){const e=await fetch(t);return await e.arrayBuffer()}if(!isBrowser)try{return node&&void 0}catch{return null}if(isWorker)return importScripts(t);const e=await fetch(t);return loadLibraryFromString(await e.text(),t)}function loadLibraryFromString(t,e){if(!isBrowser)return;if(isWorker)return eval.call(global_,t),null;const r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}const DRACO_VERSION="1.4.1",DRACO_JS_DECODER_URL="https://www.gstatic.com/draco/versioned/decoders/".concat(DRACO_VERSION,"/draco_decoder.js"),DRACO_WASM_WRAPPER_URL="https://www.gstatic.com/draco/versioned/decoders/".concat(DRACO_VERSION,"/draco_wasm_wrapper.js"),DRACO_WASM_DECODER_URL="https://www.gstatic.com/draco/versioned/decoders/".concat(DRACO_VERSION,"/draco_decoder.wasm");let loadDecoderPromise;async function loadDracoDecoderModule(t){const e=t.modules||{};return loadDecoderPromise=e.draco3d?loadDecoderPromise||e.draco3d.createDecoderModule({}).then((t=>({draco:t}))):loadDecoderPromise||loadDracoDecoder(t),await loadDecoderPromise}async function loadDracoDecoder(t){let e,r;return"js"===(t.draco&&t.draco.decoderType)?e=await loadLibrary(DRACO_JS_DECODER_URL,"draco",t):[e,r]=await Promise.all([await loadLibrary(DRACO_WASM_WRAPPER_URL,"draco",t),await loadLibrary(DRACO_WASM_DECODER_URL,"draco",t)]),e=e||globalThis.DracoDecoderModule,await initializeDracoDecoder(e,r)}function initializeDracoDecoder(t,e){const r={};return e&&(r.wasmBinary=e),new Promise((e=>{t({...r,onModuleLoaded:t=>e({draco:t})})}))}const DracoLoader={...DracoLoader$1,parse:parse};async function parse(t,e){const{draco:r}=await loadDracoDecoderModule(e),n=new DracoParser(r);try{return n.parseSync(t,null==e?void 0:e.draco)}finally{n.destroy()}}var dist_min=createCommonjsModule((function(t,e){window,t.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=223)}([function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,r){t.exports=r(242)},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},function(t,e,r){function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}r.d(e,"a",(function(){return n}))},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},function(t,e,r){var n=r(188);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e){function r(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var o=t.apply(e,n);function s(t){r(o,i,a,s,u,"next",t)}function u(t){r(o,i,a,s,u,"throw",t)}s(void 0)}))}}},function(t,e,r){var n=new(r(292).a)({id:"luma.gl"});function i(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function a(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&Number.isFinite(t._version))}function o(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}function s(t){return o(t)?t:null}function u(t){return i(a(t),"Invalid WebGLRenderingContext"),t}function l(t){return i(o(t),"Requires WebGL2"),t}var c=r(35),h={};function f(t,e){h[t]=!0,void 0!==e&&c.global.console&&c.global.console.error&&c.global.console.error(e)}var d=function t(e){var r=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var i=new t.VertexAttrib(r);this.attribs[n]=i}this.maxAttrib=0};(d.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var p=function(t){var e=this;this.gl=t,function(t){var e=t.getError;t.getError=function(){var r;do{0!==(r=e.apply(t))&&(h[r]=!0)}while(0!==r);for(r in h)if(h[r])return delete h[r],parseInt(r,10);return 0}}(t);var r=this.original={getParameter:t.getParameter,enableVertexAttribArray:t.enableVertexAttribArray,disableVertexAttribArray:t.disableVertexAttribArray,bindBuffer:t.bindBuffer,getVertexAttrib:t.getVertexAttrib,vertexAttribPointer:t.vertexAttribPointer};t.getParameter=function(t){return t===e.VERTEX_ARRAY_BINDING_OES?e.currentVertexArrayObject===e.defaultVertexArrayObject?null:e.currentVertexArrayObject:r.getParameter.apply(this,arguments)},t.enableVertexAttribArray=function(t){var n=e.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,t),n.attribs[t].enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},t.disableVertexAttribArray=function(t){var n=e.currentVertexArrayObject;return n.maxAttrib=Math.max(n.maxAttrib,t),n.attribs[t].enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},t.bindBuffer=function(t,n){switch(t){case 34962:e.currentArrayBuffer=n;break;case 34963:e.currentVertexArrayObject.elementArrayBuffer=n}return r.bindBuffer.apply(this,arguments)},t.getVertexAttrib=function(t,n){var i=e.currentVertexArrayObject.attribs[t];switch(n){case 34975:return i.buffer;case 34338:return i.enabled;case 34339:return i.size;case 34340:return i.stride;case 34341:return i.type;case 34922:return i.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},t.vertexAttribPointer=function(t,n,i,a,o,s){var u=e.currentVertexArrayObject;u.maxAttrib=Math.max(u.maxAttrib,t);var l=u.attribs[t];return l.buffer=e.currentArrayBuffer,l.size=n,l.type=i,l.normalized=a,l.stride=o,l.offset=s,l.recache(),r.vertexAttribPointer.apply(this,arguments)},t.instrumentExtension&&t.instrumentExtension(this,"OES_vertex_array_object"),t.canvas&&t.canvas.addEventListener("webglcontextrestored",(function(){c.global.console&&c.global.console.log&&c.global.console.log("OESVertexArrayObject emulation library context restored"),e.reset_()}),!0),this.reset_()};p.prototype.VERTEX_ARRAY_BINDING_OES=34229,p.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;this.maxVertexAttribs=this.gl.getParameter(34921),this.defaultVertexArrayObject=new d(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},p.prototype.createVertexArrayOES=function(){var t=new d(this);return this.vertexArrayObjects.push(t),t},p.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject===t&&this.bindVertexArrayOES(null)},p.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof d&&t.hasBeenBound&&t.ext===this)},p.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var i=this.currentVertexArrayObject;if(n!==i){n&&i.elementArrayBuffer===n.elementArrayBuffer||r.bindBuffer.call(e,34963,i.elementArrayBuffer);for(var a=this.currentArrayBuffer,o=Math.max(n?n.maxAttrib:0,i.maxAttrib),s=0;s<=o;s++){var u=i.attribs[s],l=n?n.attribs[s]:null;if(n&&u.enabled===l.enabled||(u.enabled?r.enableVertexAttribArray.call(e,s):r.disableVertexAttribArray.call(e,s)),u.enabled){var c=!1;n&&u.buffer===l.buffer||(a!==u.buffer&&(r.bindBuffer.call(e,34962,u.buffer),a=u.buffer),c=!0),(c||u.cached!==l.cached)&&r.vertexAttribPointer.call(e,s,u.size,u.type,u.normalized,u.stride,u.offset)}}this.currentArrayBuffer!==a&&r.bindBuffer.call(e,34962,this.currentArrayBuffer)}}else f(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject")};var m,v,g=r(0),y=r.n(g),_=function(t){return o(t)?void 0:0},b=(m={},y()(m,3074,(function(t){return o(t)?void 0:36064})),y()(m,35723,(function(t){return o(t)?void 0:4352})),y()(m,35977,_),y()(m,32937,_),y()(m,36795,(function(t,e){var r=o(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?e(r.GPU_DISJOINT_EXT):0})),y()(m,37445,(function(t,e){var r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_VENDOR_WEBGL||7936)})),y()(m,37446,(function(t,e){var r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_RENDERER_WEBGL||7937)})),y()(m,34047,(function(t,e){var r=t.luma.extensions.EXT_texture_filter_anisotropic;return r?e(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1})),y()(m,32883,_),y()(m,35071,_),y()(m,37447,_),y()(m,36063,(function(t,e){if(!o(t)){var r=t.getExtension("WEBGL_draw_buffers");return r?e(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}})),y()(m,35379,_),y()(m,35374,_),y()(m,35377,_),y()(m,34852,(function(t){if(!o(t)){var e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}})),y()(m,36203,(function(t){return t.getExtension("OES_element_index")?2147483647:65535})),y()(m,33001,(function(t){return t.getExtension("OES_element_index")?16777216:65535})),y()(m,33e3,(function(t){return 16777216})),y()(m,37157,_),y()(m,35373,_),y()(m,35657,_),y()(m,36183,_),y()(m,37137,_),y()(m,34045,_),y()(m,35978,_),y()(m,35979,_),y()(m,35968,_),y()(m,35376,_),y()(m,35375,_),y()(m,35659,_),y()(m,37154,_),y()(m,35371,_),y()(m,35658,_),y()(m,35076,_),y()(m,35077,_),y()(m,35380,_),m),x=(v={},y()(v,"OES_vertex_array_object",{meta:{suffix:"OES"},createVertexArray:function(){i(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:function(){},bindVertexArray:function(){},isVertexArray:function(){return!1}}),y()(v,"ANGLE_instanced_arrays",{meta:{suffix:"ANGLE"},vertexAttribDivisor:function(t,e){i(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:function(){},drawArraysInstanced:function(){}}),y()(v,"WEBGL_draw_buffers",{meta:{suffix:"WEBGL"},drawBuffers:function(){i(!1)}}),y()(v,"EXT_disjoint_timer_query",{meta:{suffix:"EXT"},createQuery:function(){i(!1)},deleteQuery:function(){i(!1)},beginQuery:function(){i(!1)},endQuery:function(){},getQuery:function(t,e){return this.getQueryObject(t,e)},getQueryParameter:function(t,e){return this.getQueryObject(t,e)},getQueryObject:function(){}}),v),w={readBuffer:function(t,e,r){o(t)&&e(r)},getVertexAttrib:function(t,e,r,n){var i,a=function(t,e){return{webgl2:o(t),ext:t.getExtension("ANGLE_instanced_arrays")}}(t),s=a.webgl2,u=a.ext;switch(n){case 35069:i=!!s&&void 0;break;case 35070:i=s||u?void 0:0}return void 0!==i?i:e(r,n)},getProgramParameter:function(t,e,r,n){if(!o(t))switch(n){case 35967:return 35981;case 35971:case 35382:return 0}return e(r,n)},getInternalformatParameter:function(t,e,r,n,i){return o(t)||32937!==i?t.getInternalformatParameter(r,n,i):new Int32Array([0])},getTexParameter:function(t,e,r,n){if(34046===n){var i=t.luma.extensions.EXT_texture_filter_anisotropic;n=i&&i.TEXTURE_MAX_ANISOTROPY_EXT||34046}return e(r,n)},getParameter:function(t,e,r){var n=b[r],i="function"==typeof n?n(t,e,r):n;return void 0!==i?i:e(r)},hint:function(t,e,r,n){return e(r,n)}};function M(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return A(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?A(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function E(t,e){var r=e.extension,n=e.target,a=e.target2,o=x[r];i(o);for(var s=o.meta,u=(void 0===s?{}:s).suffix,l=void 0===u?"":u,c=t.getExtension(r),h=function(){var e=d[f],r="".concat(e).concat(l),i=null;"meta"===e||"function"==typeof t[e]||(c&&"function"==typeof c[r]?i=function(){return c[r].apply(c,arguments)}:"function"==typeof o[e]&&(i=o[e].bind(n))),i&&(n[e]=i,a[e]=i)},f=0,d=Object.keys(o);f<d.length;f++)h()}(void 0!==commonjsGlobal?commonjsGlobal:window).polyfillContext=function(t){t.luma=t.luma||{};var e=t.luma;return e.polyfilled||(function(t){if("function"!=typeof t.createVertexArray){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var r=t.getExtension;t.getExtension=function(e){return r.call(this,e)||("OES_vertex_array_object"!==e?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new p(this)),this.__OESVertexArrayObject))}}}(t),function(t){t.luma.extensions={};var e,r=M(t.getSupportedExtensions()||[]);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.luma[n]=t.getExtension(n)}}catch(t){r.e(t)}finally{r.f()}}(t),function(t,e){var r,n=M(Object.getOwnPropertyNames(e));try{for(n.s();!(r=n.n()).done;){var i=r.value;"overrides"!==i&&E(t,{extension:i,target:t.luma,target2:t})}}catch(t){n.e(t)}finally{n.f()}}(t,x),function(t,e){var r=e.target,n=e.target2;Object.keys(w).forEach((function(e){if("function"==typeof w[e]){var i=t[e]?t[e].bind(t):function(){},a=w[e].bind(null,t,i);r[e]=a,n[e]=a}}))}(t,{target:e,target2:t}),e.polyfilled=!0),t};var S,T,C,O=r(12),P=r.n(O),L=r(15),I=r.n(L),k=(S={},y()(S,3042,!1),y()(S,32773,new Float32Array([0,0,0,0])),y()(S,32777,32774),y()(S,34877,32774),y()(S,32969,1),y()(S,32968,0),y()(S,32971,1),y()(S,32970,0),y()(S,3106,new Float32Array([0,0,0,0])),y()(S,3107,[!0,!0,!0,!0]),y()(S,2884,!1),y()(S,2885,1029),y()(S,2929,!1),y()(S,2931,1),y()(S,2932,513),y()(S,2928,new Float32Array([0,1])),y()(S,2930,!0),y()(S,3024,!0),y()(S,36006,null),y()(S,2886,2305),y()(S,33170,4352),y()(S,2849,1),y()(S,32823,!1),y()(S,32824,0),y()(S,10752,0),y()(S,32938,1),y()(S,32939,!1),y()(S,3089,!1),y()(S,3088,new Int32Array([0,0,1024,1024])),y()(S,2960,!1),y()(S,2961,0),y()(S,2968,4294967295),y()(S,36005,4294967295),y()(S,2962,519),y()(S,2967,0),y()(S,2963,4294967295),y()(S,34816,519),y()(S,36003,0),y()(S,36004,4294967295),y()(S,2964,7680),y()(S,2965,7680),y()(S,2966,7680),y()(S,34817,7680),y()(S,34818,7680),y()(S,34819,7680),y()(S,2978,[0,0,1024,1024]),y()(S,3333,4),y()(S,3317,4),y()(S,37440,!1),y()(S,37441,!1),y()(S,37443,37444),y()(S,35723,4352),y()(S,36010,null),y()(S,35977,!1),y()(S,3330,0),y()(S,3332,0),y()(S,3331,0),y()(S,3314,0),y()(S,32878,0),y()(S,3316,0),y()(S,3315,0),y()(S,32877,0),S),R=function(t,e,r){return e?t.enable(r):t.disable(r)},D=function(t,e,r){return t.hint(r,e)},B=function(t,e,r){return t.pixelStorei(r,e)};function F(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var j=(T={},y()(T,3042,R),y()(T,32773,(function(t,e){return t.blendColor.apply(t,I()(e))})),y()(T,32777,"blendEquation"),y()(T,34877,"blendEquation"),y()(T,32969,"blendFunc"),y()(T,32968,"blendFunc"),y()(T,32971,"blendFunc"),y()(T,32970,"blendFunc"),y()(T,3106,(function(t,e){return t.clearColor.apply(t,I()(e))})),y()(T,3107,(function(t,e){return t.colorMask.apply(t,I()(e))})),y()(T,2884,R),y()(T,2885,(function(t,e){return t.cullFace(e)})),y()(T,2929,R),y()(T,2931,(function(t,e){return t.clearDepth(e)})),y()(T,2932,(function(t,e){return t.depthFunc(e)})),y()(T,2928,(function(t,e){return t.depthRange.apply(t,I()(e))})),y()(T,2930,(function(t,e){return t.depthMask(e)})),y()(T,3024,R),y()(T,35723,D),y()(T,36006,(function(t,e){var r=o(t)?36009:36160;return t.bindFramebuffer(r,e)})),y()(T,2886,(function(t,e){return t.frontFace(e)})),y()(T,33170,D),y()(T,2849,(function(t,e){return t.lineWidth(e)})),y()(T,32823,R),y()(T,32824,"polygonOffset"),y()(T,10752,"polygonOffset"),y()(T,35977,R),y()(T,32938,"sampleCoverage"),y()(T,32939,"sampleCoverage"),y()(T,3089,R),y()(T,3088,(function(t,e){return t.scissor.apply(t,I()(e))})),y()(T,2960,R),y()(T,2961,(function(t,e){return t.clearStencil(e)})),y()(T,2968,(function(t,e){return t.stencilMaskSeparate(1028,e)})),y()(T,36005,(function(t,e){return t.stencilMaskSeparate(1029,e)})),y()(T,2962,"stencilFuncFront"),y()(T,2967,"stencilFuncFront"),y()(T,2963,"stencilFuncFront"),y()(T,34816,"stencilFuncBack"),y()(T,36003,"stencilFuncBack"),y()(T,36004,"stencilFuncBack"),y()(T,2964,"stencilOpFront"),y()(T,2965,"stencilOpFront"),y()(T,2966,"stencilOpFront"),y()(T,34817,"stencilOpBack"),y()(T,34818,"stencilOpBack"),y()(T,34819,"stencilOpBack"),y()(T,2978,(function(t,e){return t.viewport.apply(t,I()(e))})),y()(T,3333,B),y()(T,3317,B),y()(T,37440,B),y()(T,37441,B),y()(T,37443,B),y()(T,3330,B),y()(T,3332,B),y()(T,3331,B),y()(T,36010,(function(t,e){return t.bindFramebuffer(36008,e)})),y()(T,3314,B),y()(T,32878,B),y()(T,3316,B),y()(T,3315,B),y()(T,32877,B),y()(T,"framebuffer",(function(t,e){return t.bindFramebuffer(36160,e&&"handle"in e?e.handle:e)})),y()(T,"blend",(function(t,e){return e?t.enable(3042):t.disable(3042)})),y()(T,"blendColor",(function(t,e){return t.blendColor.apply(t,I()(e))})),y()(T,"blendEquation",(function(t,e){e=F(e)?e:[e,e],t.blendEquationSeparate.apply(t,I()(e))})),y()(T,"blendFunc",(function(t,e){e=F(e)&&2===e.length?[].concat(I()(e),I()(e)):e,t.blendFuncSeparate.apply(t,I()(e))})),y()(T,"clearColor",(function(t,e){return t.clearColor.apply(t,I()(e))})),y()(T,"clearDepth",(function(t,e){return t.clearDepth(e)})),y()(T,"clearStencil",(function(t,e){return t.clearStencil(e)})),y()(T,"colorMask",(function(t,e){return t.colorMask.apply(t,I()(e))})),y()(T,"cull",(function(t,e){return e?t.enable(2884):t.disable(2884)})),y()(T,"cullFace",(function(t,e){return t.cullFace(e)})),y()(T,"depthTest",(function(t,e){return e?t.enable(2929):t.disable(2929)})),y()(T,"depthFunc",(function(t,e){return t.depthFunc(e)})),y()(T,"depthMask",(function(t,e){return t.depthMask(e)})),y()(T,"depthRange",(function(t,e){return t.depthRange.apply(t,I()(e))})),y()(T,"dither",(function(t,e){return e?t.enable(3024):t.disable(3024)})),y()(T,"derivativeHint",(function(t,e){t.hint(35723,e)})),y()(T,"frontFace",(function(t,e){return t.frontFace(e)})),y()(T,"mipmapHint",(function(t,e){return t.hint(33170,e)})),y()(T,"lineWidth",(function(t,e){return t.lineWidth(e)})),y()(T,"polygonOffsetFill",(function(t,e){return e?t.enable(32823):t.disable(32823)})),y()(T,"polygonOffset",(function(t,e){return t.polygonOffset.apply(t,I()(e))})),y()(T,"sampleCoverage",(function(t,e){return t.sampleCoverage.apply(t,I()(e))})),y()(T,"scissorTest",(function(t,e){return e?t.enable(3089):t.disable(3089)})),y()(T,"scissor",(function(t,e){return t.scissor.apply(t,I()(e))})),y()(T,"stencilTest",(function(t,e){return e?t.enable(2960):t.disable(2960)})),y()(T,"stencilMask",(function(t,e){var r=e=F(e)?e:[e,e],n=P()(r,2),i=n[1];t.stencilMaskSeparate(1028,n[0]),t.stencilMaskSeparate(1029,i)})),y()(T,"stencilFunc",(function(t,e){var r=e=F(e)&&3===e.length?[].concat(I()(e),I()(e)):e,n=P()(r,6),i=n[3],a=n[4],o=n[5];t.stencilFuncSeparate(1028,n[0],n[1],n[2]),t.stencilFuncSeparate(1029,i,a,o)})),y()(T,"stencilOp",(function(t,e){var r=e=F(e)&&3===e.length?[].concat(I()(e),I()(e)):e,n=P()(r,6),i=n[3],a=n[4],o=n[5];t.stencilOpSeparate(1028,n[0],n[1],n[2]),t.stencilOpSeparate(1029,i,a,o)})),y()(T,"viewport",(function(t,e){return t.viewport.apply(t,I()(e))})),T);function N(t,e,r){return void 0!==e[t]?e[t]:r[t]}var U={blendEquation:function(t,e,r){return t.blendEquationSeparate(N(32777,e,r),N(34877,e,r))},blendFunc:function(t,e,r){return t.blendFuncSeparate(N(32969,e,r),N(32968,e,r),N(32971,e,r),N(32970,e,r))},polygonOffset:function(t,e,r){return t.polygonOffset(N(32824,e,r),N(10752,e,r))},sampleCoverage:function(t,e,r){return t.sampleCoverage(N(32938,e,r),N(32939,e,r))},stencilFuncFront:function(t,e,r){return t.stencilFuncSeparate(1028,N(2962,e,r),N(2967,e,r),N(2963,e,r))},stencilFuncBack:function(t,e,r){return t.stencilFuncSeparate(1029,N(34816,e,r),N(36003,e,r),N(36004,e,r))},stencilOpFront:function(t,e,r){return t.stencilOpSeparate(1028,N(2964,e,r),N(2965,e,r),N(2966,e,r))},stencilOpBack:function(t,e,r){return t.stencilOpSeparate(1029,N(34817,e,r),N(34818,e,r),N(34819,e,r))}},z={enable:function(t,e){return t(y()({},e,!0))},disable:function(t,e){return t(y()({},e,!1))},pixelStorei:function(t,e,r){return t(y()({},e,r))},hint:function(t,e,r){return t(y()({},e,r))},bindFramebuffer:function(t,e,r){var n;switch(e){case 36160:return t((n={},y()(n,36006,r),y()(n,36010,r),n));case 36009:return t(y()({},36006,r));case 36008:return t(y()({},36010,r));default:return null}},blendColor:function(t,e,r,n,i){return t(y()({},32773,new Float32Array([e,r,n,i])))},blendEquation:function(t,e){var r;return t((r={},y()(r,32777,e),y()(r,34877,e),r))},blendEquationSeparate:function(t,e,r){var n;return t((n={},y()(n,32777,e),y()(n,34877,r),n))},blendFunc:function(t,e,r){var n;return t((n={},y()(n,32969,e),y()(n,32968,r),y()(n,32971,e),y()(n,32970,r),n))},blendFuncSeparate:function(t,e,r,n,i){var a;return t((a={},y()(a,32969,e),y()(a,32968,r),y()(a,32971,n),y()(a,32970,i),a))},clearColor:function(t,e,r,n,i){return t(y()({},3106,new Float32Array([e,r,n,i])))},clearDepth:function(t,e){return t(y()({},2931,e))},clearStencil:function(t,e){return t(y()({},2961,e))},colorMask:function(t,e,r,n,i){return t(y()({},3107,[e,r,n,i]))},cullFace:function(t,e){return t(y()({},2885,e))},depthFunc:function(t,e){return t(y()({},2932,e))},depthRange:function(t,e,r){return t(y()({},2928,new Float32Array([e,r])))},depthMask:function(t,e){return t(y()({},2930,e))},frontFace:function(t,e){return t(y()({},2886,e))},lineWidth:function(t,e){return t(y()({},2849,e))},polygonOffset:function(t,e,r){var n;return t((n={},y()(n,32824,e),y()(n,10752,r),n))},sampleCoverage:function(t,e,r){var n;return t((n={},y()(n,32938,e),y()(n,32939,r),n))},scissor:function(t,e,r,n,i){return t(y()({},3088,new Int32Array([e,r,n,i])))},stencilMask:function(t,e){var r;return t((r={},y()(r,2968,e),y()(r,36005,e),r))},stencilMaskSeparate:function(t,e,r){return t(y()({},1028===e?2968:36005,r))},stencilFunc:function(t,e,r,n){var i;return t((i={},y()(i,2962,e),y()(i,2967,r),y()(i,2963,n),y()(i,34816,e),y()(i,36003,r),y()(i,36004,n),i))},stencilFuncSeparate:function(t,e,r,n,i){var a;return t((a={},y()(a,1028===e?2962:34816,r),y()(a,1028===e?2967:36003,n),y()(a,1028===e?2963:36004,i),a))},stencilOp:function(t,e,r,n){var i;return t((i={},y()(i,2964,e),y()(i,2965,r),y()(i,2966,n),y()(i,34817,e),y()(i,34818,r),y()(i,34819,n),i))},stencilOpSeparate:function(t,e,r,n,i){var a;return t((a={},y()(a,1028===e?2964:34817,r),y()(a,1028===e?2965:34818,n),y()(a,1028===e?2966:34819,i),a))},viewport:function(t,e,r,n,i){return t(y()({},2978,[e,r,n,i]))}},G=function(t,e){return t.isEnabled(e)},V=(C={},y()(C,3042,G),y()(C,2884,G),y()(C,2929,G),y()(C,3024,G),y()(C,32823,G),y()(C,32926,G),y()(C,32928,G),y()(C,3089,G),y()(C,2960,G),y()(C,35977,G),C),H=r(1),W=r.n(H),$=r(3),q=r.n($);function X(t){for(var e in t)return!1;return!0}function K(t,e){if(t===e)return!0;var r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function Z(t,e){var r=t[e].bind(t);t[e]=function(){var e=arguments.length<=0?void 0:arguments[0];return e in t.state.cache&&t.state.enable?t.state.cache[e]:r.apply(void 0,arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function Y(t,e,r){var n=t[e].bind(t);t[e]=function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var o=r.apply(void 0,[t.state._updateCache].concat(i)),s=o.oldValue;return o.valueChanged&&n.apply(void 0,i),s},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function J(t){var e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}var Q=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.copyState,i=void 0!==n&&n,a=r.log,o=void 0===a?function(){}:a;W()(this,t),this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=i?it(e):Object.assign({},k),this.log=o,this._updateCache=this._updateCache.bind(this),Object.seal(this)}return q()(t,[{key:"push",value:function(){this.stateStack.push({})}},{key:"pop",value:function(){i(this.stateStack.length>0),nt(this.gl,this.stateStack[this.stateStack.length-1]),this.stateStack.pop()}},{key:"_updateCache",value:function(t){var e,r=!1,n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(var a in t){i(void 0!==a);var o=t[a],s=this.cache[a];K(o,s)||(r=!0,e=s,!n||a in n||(n[a]=s),this.cache[a]=o)}return{valueChanged:r,oldValue:e}}}]),t}();function tt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.enable,n=void 0===r||r,a=e.copyState;if(i(void 0!==a),!t.state){var o=(void 0!==commonjsGlobal?commonjsGlobal:window).polyfillContext;for(var s in o&&o(t),t.state=new Q(t,{copyState:a}),J(t),z)Y(t,s,z[s]);Z(t,"getParameter"),Z(t,"isEnabled")}return t.state.enable=n,t}function et(t){i(t.state),t.state.pop()}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function nt(t,e){if(i(a(t),"setParameters requires a WebGL context"),!X(e)){var r={};for(var n in e){var o=Number(n),s=j[n];s&&("string"==typeof s?r[s]=!0:s(t,e[n],o))}var u=t.state&&t.state.cache;if(u)for(var l in r)(0,U[l])(t,e,u)}}function it(t,e){if("number"==typeof(e=e||k)){var r=e,n=V[r];return n?n(t,r):t.getParameter(r)}var i,a={},o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return rt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?rt(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(Array.isArray(e)?e:Object.keys(e));try{for(o.s();!(i=o.n()).done;){var s=i.value,u=V[s];a[s]=u?u(t,Number(s)):t.getParameter(Number(s))}}catch(t){o.e(t)}finally{o.f()}return a}function at(t){nt(t,k)}function ot(t,e,r){if(X(e))return r(t);var n,i=e.nocatch,a=void 0===i||i;if(function(t){t.state||tt(t,{copyState:!1}),t.state.push()}(t),nt(t,e),a)n=r(t),et(t);else try{n=r(t)}finally{et(t)}return n}function st(t){var e=t.luma;if(t.canvas&&e){var r=e.canvasSizeInfo.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function ut(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ct(e,st(t),t.drawingBufferWidth,t.drawingBufferHeight,r)}function lt(t){var e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function ct(t,e,r,n,i){var a,o=ht(t[0],e,r),s=ft(t[1],e,n,i),u=ht(t[0]+1,e,r),l=u===r-1?u:u-1;return u=ft(t[1]+1,e,n,i),i?(a=s,s=u=0===u?u:u+1):a=u===n-1?u:u-1,{x:o,y:s,width:Math.max(l-o+1,1),height:Math.max(a-s+1,1)}}function ht(t,e,r){return Math.min(Math.round(t*e),r-1)}function ft(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}var dt=Object(c.isBrowser)(),pt=dt&&"undefined"!=typeof document,mt={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function vt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(dt,"createGLContext only available in the browser.\nCreate your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils");var e,r=t=Object.assign({},mt,t),n=r.width,a=r.height;function o(e){if(t.throwOnError)throw new Error(e);return console.error(e),null}return t.onError=o,(e=_t(bt({canvas:t.canvas,width:n,height:a,onError:o}),t))?(xt(e=gt(e,t)),e):null}function gt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||wt(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var r=e=Object.assign({},mt,e),i=r.debug;return r.manageState&&tt(t,{copyState:!1,log:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return n.log.apply(n,[1].concat(e))()}}),dt&&i&&(c.global.makeDebugContext?(t=c.global.makeDebugContext(t,e),n.level=Math.max(n.level,1)):n.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function yt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.canvas)Mt(t,lt(e.useDevicePixels),e);else{var r=t.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in e&&"height"in e&&r.resize(e.width,e.height)}}function _t(t,e){var r=e.onError,n=null,i=function(t){return n=t.statusMessage||n};t.addEventListener("webglcontextcreationerror",i,!1);var a=e.webgl1,o=void 0===a||a,s=e.webgl2,u=void 0===s||s,l=null;return u&&(l=(l=l||t.getContext("webgl2",e))||t.getContext("experimental-webgl2",e)),o&&(l=(l=l||t.getContext("webgl",e))||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):r("Failed to create ".concat(u&&!o?"WebGL2":"WebGL"," context: ").concat(n||"Unknown error"))}function bt(t){var e,r=t.canvas,n=t.width,i=void 0===n?800:n,a=t.height,o=void 0===a?600:a;return"string"==typeof r?(pt&&"complete"===document.readyState||(0,t.onError)("createGLContext called on canvas '".concat(r,"' before page was loaded")),e=document.getElementById(r)):r?e=r:((e=document.createElement("canvas")).id="lumagl-canvas",e.style.width=Number.isFinite(i)?"".concat(i,"px"):"100%",e.style.height=Number.isFinite(o)?"".concat(o,"px"):"100%",document.body.insertBefore(e,document.body.firstChild)),e}function xt(t){var e=o(t)?"WebGL2":"WebGL1",r=function(t){var e=t.getParameter(7936),r=t.getParameter(7937),n=t.getExtension("WEBGL_debug_renderer_info");return{vendor:n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||7936)||e,renderer:n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||7937)||r,vendorMasked:e,rendererMasked:r,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t),i=r?"(".concat(r.vendor,",").concat(r.renderer,")"):"",a=t.debug?" debug":"";n.info(1,"".concat(e).concat(a," context ").concat(i))()}function wt(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?2:1}function Mt(t,e,r){var i="width"in r?r.width:t.canvas.clientWidth,a="height"in r?r.height:t.canvas.clientHeight;i&&a||(n.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,a=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};var o=t.luma.canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==a||o.devicePixelRatio!==e){var s=e,u=Math.floor(i*s),l=Math.floor(a*s);t.canvas.width=u,t.canvas.height=l,t.drawingBufferWidth===u&&t.drawingBufferHeight===l||(n.warn("Device pixel ratio clamped")(),s=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/a),t.canvas.width=Math.floor(i*s),t.canvas.height=Math.floor(a*s)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:a,devicePixelRatio:e})}}r.d(e,"k",(function(){return n})),r.d(e,"i",(function(){return a})),r.d(e,"j",(function(){return o})),r.d(e,"g",(function(){return s})),r.d(e,"b",(function(){return u})),r.d(e,"a",(function(){return l})),r.d(e,"f",(function(){return it})),r.d(e,"n",(function(){return nt})),r.d(e,"l",(function(){return at})),r.d(e,"o",(function(){return ot})),r.d(e,"c",(function(){return vt})),r.d(e,"m",(function(){return yt})),r.d(e,"h",(function(){return gt})),r.d(e,"e",(function(){return st})),r.d(e,"d",(function(){return ut}))},function(t,e,r){var n=r(11),i=r(17);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},function(t,e,r){function n(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}r.d(e,"a",(function(){return n}))},function(t,e){function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e,r){var n=r(238),i=r(239),a=r(240);t.exports=function(t,e){return n(t)||i(t,e)||a()}},function(t,e,r){r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return a}));var n=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},function(t,e,r){r.d(e,"b",(function(){return a})),r.d(e,"e",(function(){return s})),r.d(e,"f",(function(){return u})),r.d(e,"j",(function(){return c})),r.d(e,"i",(function(){return h})),r.d(e,"h",(function(){return f})),r.d(e,"c",(function(){return d})),r.d(e,"a",(function(){return p})),r.d(e,"g",(function(){return m})),r.d(e,"d",(function(){return v})),r(152),r(214),r(215),r(47);var n=1/Math.PI*180,i=1/180*Math.PI,a={};function o(t){return Math.round(t/a.EPSILON)*a.EPSILON}function s(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,r=void 0===e?a.precision||4:e;return t=o(t),"".concat(parseFloat(t.toPrecision(r)))}function u(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function l(t,e,r){if(u(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function c(t){return f(t)}function h(t){return d(t)}function f(t,e){return l(t,(function(t){return t*i}),e)}function d(t,e){return l(t,(function(t){return t*n}),e)}function p(t,e,r){return l(t,(function(t){return Math.max(e,Math.min(r,t))}))}function m(t,e,r){return u(t)?t.map((function(t,n){return m(t,e[n],r)})):r*e+(1-r)*t}function v(t,e,r){var n=a.EPSILON;r&&(a.EPSILON=r);try{if(t===e)return!0;if(u(t)&&u(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!v(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{a.EPSILON=n}}a.EPSILON=1e-12,a.debug=!1,a.precision=4,a.printTypes=!1,a.printDegrees=!1,a.printRowMajor=!0},function(t,e,r){var n=r(232),i=r(233),a=r(234);t.exports=function(t){return n(t)||i(t)||a()}},function(t,e,r){r.d(e,"a",(function(){return i})),r.d(e,"d",(function(){return a})),r.d(e,"e",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return u}));var n=r(22),i={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(i,"IDENTITY",{get:function(){return n.a.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0}});var a={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},o={common:0,meters:1,pixels:2},s={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},u={DRAW:"draw",MASK:"mask"}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,r){var n=r(241);function i(e,r,a){return t.exports=i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var i=n(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(r):a.value}},i(e,r,a||e)}t.exports=i},function(t,e,r){var n=r(14),i=r(73);r.d(e,"a",(function(){return i.a}));var a="undefined"!=typeof self&&self,o="undefined"!=typeof window&&window;(void 0!==commonjsGlobal&&commonjsGlobal||a||o).mathgl={config:n.b}},function(t,e,r){r.d(e,"q",(function(){return i})),r.d(e,"f",(function(){return a})),r.d(e,"a",(function(){return o})),r.d(e,"h",(function(){return s})),r.d(e,"p",(function(){return u})),r.d(e,"o",(function(){return l})),r.d(e,"k",(function(){return c})),r.d(e,"l",(function(){return h})),r.d(e,"m",(function(){return f})),r.d(e,"n",(function(){return d})),r.d(e,"e",(function(){return p})),r.d(e,"c",(function(){return m})),r.d(e,"d",(function(){return v})),r.d(e,"j",(function(){return g})),r.d(e,"i",(function(){return y})),r.d(e,"g",(function(){return _})),r.d(e,"b",(function(){return b}));var n=r(13);function i(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function a(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=r*s-n*o,_=r*u-i*o,b=r*l-a*o,x=n*u-i*s,w=n*l-a*s,M=i*l-a*u,A=c*m-h*p,E=c*v-f*p,S=c*g-d*p,T=h*v-f*m,C=h*g-d*m,O=f*g-d*v,P=y*O-_*C+b*T+x*S-w*E+M*A;return P?(t[0]=(s*O-u*C+l*T)*(P=1/P),t[1]=(i*C-n*O-a*T)*P,t[2]=(m*M-v*w+g*x)*P,t[3]=(f*w-h*M-d*x)*P,t[4]=(u*S-o*O-l*E)*P,t[5]=(r*O-i*S+a*E)*P,t[6]=(v*b-p*M-g*_)*P,t[7]=(c*M-f*b+d*_)*P,t[8]=(o*C-s*S+l*A)*P,t[9]=(n*S-r*C-a*A)*P,t[10]=(p*w-m*b+g*y)*P,t[11]=(h*b-c*w-d*y)*P,t[12]=(s*E-o*T-u*A)*P,t[13]=(r*T-n*E+i*A)*P,t[14]=(m*_-p*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null}function o(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],d=t[12],p=t[13],m=t[14],v=t[15];return(e*o-r*a)*(h*v-f*m)-(e*s-n*a)*(c*v-f*p)+(e*u-i*a)*(c*m-h*p)+(r*s-n*o)*(l*v-f*d)-(r*u-i*o)*(l*m-h*d)+(n*u-i*s)*(l*p-c*d)}function s(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*i+b*u+x*f+w*v,t[2]=_*a+b*l+x*d+w*g,t[3]=_*o+b*c+x*p+w*y,t[4]=(_=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=_*i+b*u+x*f+w*v,t[6]=_*a+b*l+x*d+w*g,t[7]=_*o+b*c+x*p+w*y,t[8]=(_=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=_*i+b*u+x*f+w*v,t[10]=_*a+b*l+x*d+w*g,t[11]=_*o+b*c+x*p+w*y,t[12]=(_=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=_*i+b*u+x*f+w*v,t[14]=_*a+b*l+x*d+w*g,t[15]=_*o+b*c+x*p+w*y,t}function u(t,e,r){var n,i,a,o,s,u,l,c,h,f,d,p,m=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=n=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+s*v+h*g+e[12],t[13]=i*m+u*v+f*g+e[13],t[14]=a*m+l*v+d*g+e[14],t[15]=o*m+c*v+p*g+e[15]),t}function l(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(t,e,r,i){var a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,E,S,T,C,O=i[0],P=i[1],L=i[2],I=Math.hypot(O,P,L);return I<n.b?null:(O*=I=1/I,P*=I,L*=I,a=Math.sin(r),s=1-(o=Math.cos(r)),l=e[1],c=e[2],h=e[3],d=e[5],p=e[6],m=e[7],g=e[9],y=e[10],_=e[11],M=O*P*s-L*a,A=P*P*s+o,E=L*P*s+O*a,S=O*L*s+P*a,T=P*L*s-O*a,C=L*L*s+o,t[0]=(u=e[0])*(b=O*O*s+o)+(f=e[4])*(x=P*O*s+L*a)+(v=e[8])*(w=L*O*s-P*a),t[1]=l*b+d*x+g*w,t[2]=c*b+p*x+y*w,t[3]=h*b+m*x+_*w,t[4]=u*M+f*A+v*E,t[5]=l*M+d*A+g*E,t[6]=c*M+p*A+y*E,t[7]=h*M+m*A+_*E,t[8]=u*S+f*T+v*C,t[9]=l*S+d*T+g*C,t[10]=c*S+p*T+y*C,t[11]=h*S+m*T+_*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function h(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+c*n,t[6]=s*i+h*n,t[7]=u*i+f*n,t[8]=l*i-a*n,t[9]=c*i-o*n,t[10]=h*i-s*n,t[11]=f*i-u*n,t}function f(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*n,t[1]=o*i-c*n,t[2]=s*i-h*n,t[3]=u*i-f*n,t[8]=a*n+l*i,t[9]=o*n+c*i,t[10]=s*n+h*i,t[11]=u*n+f*i,t}function d(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+c*n,t[2]=s*i+h*n,t[3]=u*i+f*n,t[4]=l*i-a*n,t[5]=c*i-o*n,t[6]=h*i-s*n,t[7]=f*i-u*n,t}function p(t,e){var r=e[4],n=e[5],i=e[6],a=e[8],o=e[9],s=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,n,i),t[2]=Math.hypot(a,o,s),t}function m(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,h=n*s,f=i*o,d=i*s,p=i*u,m=a*o,v=a*s,g=a*u;return t[0]=1-h-p,t[1]=c+g,t[2]=f-v,t[3]=0,t[4]=c-g,t[5]=1-l-p,t[6]=d+m,t[7]=0,t[8]=f+v,t[9]=d-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function v(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function g(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function y(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t}function _(t,e,r,i){var a,o,s,u,l,c,h,f,d,p,m=e[0],v=e[1],g=e[2],y=i[0],_=i[1],b=i[2],x=r[0],w=r[1],M=r[2];return Math.abs(m-x)<n.b&&Math.abs(v-w)<n.b&&Math.abs(g-M)<n.b?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=m-x,f=v-w,d=g-M,a=_*(d*=p=1/Math.hypot(h,f,d))-b*(f*=p),o=b*(h*=p)-y*d,s=y*f-_*h,(p=Math.hypot(a,o,s))?(a*=p=1/p,o*=p,s*=p):(a=0,o=0,s=0),u=f*s-d*o,l=d*a-h*s,c=h*o-f*a,(p=Math.hypot(u,l,c))?(u*=p=1/p,l*=p,c*=p):(u=0,l=0,c=0),t[0]=a,t[1]=u,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=f,t[7]=0,t[8]=s,t[9]=c,t[10]=d,t[11]=0,t[12]=-(a*m+o*v+s*g),t[13]=-(u*m+l*v+c*g),t[14]=-(h*m+f*v+d*g),t[15]=1,t)}function b(t,e){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],g=t[14],y=t[15],_=e[0],b=e[1],x=e[2],w=e[3],M=e[4],A=e[5],E=e[6],S=e[7],T=e[8],C=e[9],O=e[10],P=e[11],L=e[12],I=e[13],k=e[14],R=e[15];return Math.abs(r-_)<=n.b*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-b)<=n.b*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=n.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-w)<=n.b*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-M)<=n.b*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-A)<=n.b*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-E)<=n.b*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=n.b*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=n.b*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-C)<=n.b*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-O)<=n.b*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-P)<=n.b*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-L)<=n.b*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(v-I)<=n.b*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-k)<=n.b*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(y-R)<=n.b*Math.max(1,Math.abs(y),Math.abs(R))}},function(t,e,r){var n={};function i(t){var e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}function a(t){var e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}function o(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n="/";return(e=e.map((function(t,r){return r&&(t=t.replace(new RegExp("^".concat(n)),"")),r!==e.length-1&&(t=t.replace(new RegExp("".concat(n,"$")),"")),t}))).join(n)}r.r(n),r.d(n,"filename",(function(){return i})),r.d(n,"dirname",(function(){return a})),r.d(n,"join",(function(){return o})),r(132);var s=r(195);r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return s}))},function(t,e,r){var n=r(11),i=r.n(n),a=r(15),o=r.n(a),s=r(0),u=r.n(s),l=r(1),c=r.n(l),h=r(3),f=r.n(h),d=r(4),p=r(154);function m(t){try{var e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}Object(p.a)();var v,g=function(){function t(e){c()(this,t);var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Object(d.a)(this,"storage",void 0),Object(d.a)(this,"id",void 0),Object(d.a)(this,"config",{}),this.storage=m(n),this.id=e,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return f()(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function y(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(r=Math.min(r,n/t.width));var a=t.width*r,o=t.height*r,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}function _(t){return"string"==typeof t?v[t.toUpperCase()]||v.WHITE:t}function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(t),i=b(Object.getOwnPropertyNames(n));try{var a=function(){var n=e.value;"function"==typeof t[n]&&(r.find((function(t){return n===t}))||(t[n]=t[n].bind(t)))};for(i.s();!(e=i.n()).done;)a()}catch(t){i.e(t)}finally{i.f()}}function M(t,e){if(!t)throw new Error(e||"Assertion failed")}!function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(v||(v={}));var A={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":i()(process))&&process},E=A.window||A.self||A.global,S=A.process||{};function T(){var t,e,r;if(p.a&&"performance"in E)t=null==E||null===(e=E.performance)||void 0===e||null===(r=e.now)||void 0===r?void 0:r.call(e);else if("hrtime"in S){var n,i=null==S||null===(n=S.hrtime)||void 0===n?void 0:n.call(S);t=1e3*i[0]+i[1]/1e6}else t=Date.now();return t}var C={debug:p.a&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},O={enabled:!0,level:0};function P(){}var L={},I={once:!0},k=function(){function t(){c()(this,t);var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""}).id;Object(d.a)(this,"id",void 0),Object(d.a)(this,"VERSION","1.5.0"),Object(d.a)(this,"_startTs",T()),Object(d.a)(this,"_deltaTs",T()),Object(d.a)(this,"_storage",void 0),Object(d.a)(this,"userData",{}),Object(d.a)(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new g("__probe-".concat(this.id,"__"),O),this.userData={},this.timeStamp("".concat(this.id," started")),w(this),Object.seal(this)}return f()(t,[{key:"level",get:function(){return this.getLevel()},set:function(t){this.setLevel(t)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((T()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((T()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(t){this.level=t}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){return this._storage.updateConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({level:t}),this}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(u()({},t,e))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(t,e){M(t,e)}},{key:"warn",value:function(t){return this._getLogFunction(0,t,C.warn,arguments,I)}},{key:"error",value:function(t){return this._getLogFunction(0,t,C.error,arguments)}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){return this._getLogFunction(t,e,C.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(t,e){return this._getLogFunction(t,e,C.debug,arguments)}},{key:"info",value:function(t,e){return this._getLogFunction(t,e,console.info,arguments)}},{key:"once",value:function(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return this._getLogFunction(t,e,C.debug||C.info,arguments,I)}},{key:"table",value:function(t,e,r){return e?this._getLogFunction(t,e,console.table||P,r&&[r],{tag:B(e)}):P}},{key:"image",value:function(t){var e=t.image,n=t.message,i=void 0===n?"":n,a=t.scale,s=void 0===a?1:a;return this._shouldLog(t.logLevel||t.priority)?p.a?function(t){var e=t.image,r=t.message,n=void 0===r?"":r,i=t.scale,a=void 0===i?1:i;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=y(s,n,a);(t=console).log.apply(t,o()(e))},s.src=e,P}var u,l=e.nodeName||"";if("img"===l.toLowerCase())return(u=console).log.apply(u,o()(y(e,n,a))),P;if("canvas"===l.toLowerCase()){var c=new Image;return c.onload=function(){var t;return(t=console).log.apply(t,o()(y(c,n,a)))},c.src=e.toDataURL(),P}return P}({image:e,message:i,scale:s}):function(t){var e=t.image,n=t.scale,i=void 0===n?1:n,a=null;try{a=r(248)}catch(t){}return a?function(){return a(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then((function(t){return console.log(t)}))}:P}({image:e,message:i,scale:s}):P}},{key:"time",value:function(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}},{key:"timeEnd",value:function(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(t,e){return this._getLogFunction(t,e,console.timeStamp||P)}},{key:"group",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=D({logLevel:t,message:e,opts:r});return n.method=(r.collapsed?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}},{key:"groupCollapsed",value:function(t,e){return this.group(t,e,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction(t,"",console.groupEnd||P)}},{key:"withGroup",value:function(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return this.isEnabled()&&this.getLevel()>=R(t)}},{key:"_getLogFunction",value:function(t,e,r,n,i){if(this._shouldLog(t)){var a;i=D({logLevel:t,message:e,args:n,opts:i}),M(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=T();var s=i.tag||i.message;if(i.once){if(L[s])return P;L[s]=T()}return e=function(t,e,r){if("string"==typeof e){var n=r.time?function(t){var e=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-t.length,0);return"".concat(" ".repeat(e)).concat(t)}((s=r.total)<10?"".concat(s.toFixed(2),"ms"):s<100?"".concat(s.toFixed(1),"ms"):s<1e3?"".concat(s.toFixed(0),"ms"):"".concat((s/1e3).toFixed(2),"s")):"";i=e=r.time?"".concat(t,": ").concat(n,"  ").concat(e):"".concat(t,": ").concat(e),a=r.color,o=r.background,p.a||"string"!=typeof i||(a&&(a=_(a),i="[".concat(a,"m").concat(i,"[39m")),o&&(a=_(o),i="[".concat(o+10,"m").concat(i,"[49m"))),e=i}var i,a,o,s;return e}(this.id,i.message,i),(a=r).bind.apply(a,[console,e].concat(o()(i.args)))}return P}}]),t}();function R(t){if(!t)return 0;var e;switch(i()(t)){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return M(Number.isFinite(e)&&e>=0),e}function D(t){var e=t.logLevel,r=t.message;t.logLevel=R(e);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==r;);switch(i()(e)){case"string":case"function":void 0!==r&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());var a=i()(t.message);return M("string"===a||"object"===a),Object.assign(t,{args:n},t.opts)}function B(t){for(var e in t)for(var r in t[e])return r||"untitled";return"empty"}Object(d.a)(k,"VERSION","1.5.0"),e.a=new k({id:"deck"})},function(t,e,r){r.d(e,"f",(function(){return s})),r.d(e,"h",(function(){return u})),r.d(e,"g",(function(){return l})),r.d(e,"d",(function(){return c})),r.d(e,"a",(function(){return h})),r.d(e,"e",(function(){return f})),r.d(e,"j",(function(){return d})),r.d(e,"b",(function(){return p})),r.d(e,"c",(function(){return m})),r.d(e,"i",(function(){return v})),r.d(e,"k",(function(){return g}));var n=r(11),i=r.n(n),a=function(t){return"boolean"==typeof t},o=function(t){return"function"==typeof t},s=function(t){return null!==t&&"object"===i()(t)},u=function(t){return s(t)&&t.constructor==={}.constructor},l=function(t){return s(t)&&o(t.then)},c=function(t){return t&&"function"==typeof t[Symbol.iterator]},h=function(t){return t&&"function"==typeof t[Symbol.asyncIterator]},f=function(t){return t&&o(t.next)},d=function(t){return"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json},p=function(t){return"undefined"!=typeof Blob&&t instanceof Blob},m=function(t){return t&&"object"===i()(t)&&t.isBuffer},v=function(t){return function(t){return"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||s(t)&&o(t.tee)&&o(t.cancel)&&o(t.getReader)}(t)||function(t){return s(t)&&o(t.read)&&o(t.pipe)&&a(t.readable)}(t)},g=function(t){return function(t){return s(t)&&o(t.abort)&&o(t.getWriter)}(t)||function(t){return s(t)&&o(t.end)&&o(t.write)&&a(t.writable)}(t)}},function(t,e,r){r.d(e,"c",(function(){return i})),r.d(e,"h",(function(){return a})),r.d(e,"f",(function(){return o})),r.d(e,"a",(function(){return s})),r.d(e,"k",(function(){return u})),r.d(e,"l",(function(){return l})),r.d(e,"e",(function(){return c})),r.d(e,"d",(function(){return h})),r.d(e,"i",(function(){return f})),r.d(e,"s",(function(){return d})),r.d(e,"r",(function(){return p})),r.d(e,"t",(function(){return m})),r.d(e,"m",(function(){return v})),r.d(e,"n",(function(){return g})),r.d(e,"o",(function(){return y})),r.d(e,"b",(function(){return _})),r.d(e,"q",(function(){return b})),r.d(e,"j",(function(){return x})),r.d(e,"g",(function(){return w})),r.d(e,"p",(function(){return M}));var n=r(13);function i(){var t=new n.a(3);return n.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function a(t){return Math.hypot(t[0],t[1],t[2])}function o(t,e,r){var i=new n.a(3);return i[0]=t,i[1]=e,i[2]=r,i}function s(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function u(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function l(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function c(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function h(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}function f(t,e,r,n){var i=e[0],a=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t}function d(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/(o=o||1),t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t}function p(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}function m(t,e,r){var n=r[0],i=r[1],a=r[2],o=e[0],s=e[1],u=e[2],l=i*u-a*s,c=a*o-n*u,h=n*s-i*o,f=i*h-a*c,d=a*l-n*h,p=n*c-i*l,m=2*r[3];return c*=m,h*=m,d*=2,p*=2,t[0]=o+(l*=m)+(f*=2),t[1]=s+c+d,t[2]=u+h+p,t}function v(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function g(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function y(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function _(t,e){var r=t[0],n=t[1],i=t[2],a=e[0],o=e[1],s=e[2],u=Math.sqrt(r*r+n*n+i*i)*Math.sqrt(a*a+o*o+s*s),l=u&&c(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}var b=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},x=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},w=a,M=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n};i()},function(t,e,r){r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return u}));var n=r(14);function i(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function a(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function o(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(n.b.debug&&!i(t,e))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return t}var s={};function u(t,e){s[t]||(s[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}},function(t,e,r){r.d(e,"e",(function(){return n})),r.d(e,"d",(function(){return i})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return s}));var n={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},i=Symbol.for("component"),a=Symbol.for("asyncPropDefaults"),o=Symbol.for("asyncPropOriginal"),s=Symbol.for("asyncPropResolved")},function(t,e,r){r(128);var n=r(48),i=r.n(n),a=(r(216),r(217),r(29));function o(t,e){var r=a.n([],e,t);return a.k(r,r,1/r[3]),r}function s(t,e){var r=t%e;return r<0?e+r:r}function u(t,e,r){return r*e+(1-r)*t}function l(t,e,r){return t<e?e:t>r?r:t}var c=Math.log2||function(t){return Math.log(t)*Math.LOG2E},h=(r(20),r(28));function f(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}r(24);var d=Math.PI,p=d/4,m=d/180,v=180/d;function g(t){return Math.pow(2,t)}function y(t){return c(t)}function _(t){var e=i()(t,2),r=e[0],n=e[1];return f(Number.isFinite(r)),f(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude"),[512*(r*m+d)/(2*d),512*(d+Math.log(Math.tan(p+n*m*.5)))/(2*d)]}function b(t){var e=i()(t,2),r=e[0]/512*(2*d)-d,n=2*(Math.atan(Math.exp(e[1]/512*(2*d)-d))-p);return[r*v,n*v]}function x(t){var e=t.latitude;return f(Number.isFinite(e)),y(4003e4*Math.cos(e*m))-9}function w(t){var e=t.latitude,r=t.longitude,n=t.highPrecision,i=void 0!==n&&n;f(Number.isFinite(e)&&Number.isFinite(r));var a={},o=Math.cos(e*m),s=512/360/o,u=512/4003e4/o;if(a.unitsPerMeter=[u,u,u],a.metersPerUnit=[1/u,1/u,1/u],a.unitsPerDegree=[512/360,s,u],a.degreesPerUnit=[.703125,1/s,1/u],i){var l=m*Math.tan(e*m)/o,c=512/4003e4*l,h=c/s*u;a.unitsPerDegree2=[0,512/360*l/2,c],a.unitsPerMeter2=[h,0,h]}return a}function M(t,e){var r=i()(t,3),n=r[0],a=r[1],o=r[2],s=i()(e,3),u=s[0],l=s[1],c=s[2],h=w({longitude:n,latitude:a,highPrecision:!0}),f=h.unitsPerMeter,d=h.unitsPerMeter2,p=_(t);p[0]+=u*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);var m=b(p),v=(o||0)+(c||0);return Number.isFinite(o)||Number.isFinite(c)?[m[0],m[1],v]:m}function A(t){return 2*Math.atan(.5/t)*v}function E(t){return.5/Math.tan(.5*t*m)}function S(t,e){var r=i()(t,3),n=r[0],a=r[1],s=r[2],u=void 0===s?0:s;return f(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(u)),o(e,[n,a,u,1])}function T(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=i()(t,3),a=n[0],s=n[1],u=n[2];if(f(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(u))return o(e,[a,s,u,1]);var l=o(e,[a,s,0,1]),c=o(e,[a,s,1,1]),d=l[2],p=c[2];return h.c([],l,c,d===p?0:((r||0)-d)/(p-d))}function C(t){var e=t.width,r=t.height,n=t.bounds,a=t.minExtent,o=void 0===a?0:a,s=t.maxZoom,u=void 0===s?24:s,h=t.padding,d=void 0===h?0:h,p=t.offset,m=void 0===p?[0,0]:p,v=i()(n,2),g=i()(v[0],2),y=g[0],x=g[1],w=i()(v[1],2),M=w[0],A=w[1];Number.isFinite(d)?d={top:d,bottom:d,left:d,right:d}:f(Number.isFinite(d.top)&&Number.isFinite(d.bottom)&&Number.isFinite(d.left)&&Number.isFinite(d.right));var E=_([y,l(A,-85.051129,85.051129)]),S=_([M,l(x,-85.051129,85.051129)]),T=[Math.max(Math.abs(S[0]-E[0]),o),Math.max(Math.abs(S[1]-E[1]),o)],C=[e-d.left-d.right-2*Math.abs(m[0]),r-d.top-d.bottom-2*Math.abs(m[1])];f(C[0]>0&&C[1]>0);var O=C[0]/T[0],P=C[1]/T[1],L=b([(S[0]+E[0])/2+(d.right-d.left)/2/O,(S[1]+E[1])/2+(d.bottom-d.top)/2/P]),I=Math.min(u,c(Math.abs(Math.min(O,P))));return f(Number.isFinite(I)),{longitude:L[0],latitude:L[1],zoom:I}}var O=Math.PI/180;function P(t){var e,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=t.width,a=t.height,o=t.unproject,s={targetZ:n},u=o([0,a],s),l=o([i,a],s);return(t.fovy?.5*t.fovy*O:Math.atan(.5/t.altitude))>(90-t.pitch)*O-.01?(e=L(t,0,n),r=L(t,i,n)):(e=o([0,0],s),r=o([i,0],s)),[u,l,r,e]}function L(t,e,r){var n=t.pixelUnprojectionMatrix,i=o(n,[e,0,1,1]),a=o(n,[e,t.height,1,1]),s=b(h.c([],i,a,(r*t.distanceScales.unitsPerMeter[2]-i[2])/(a[2]-i[2])));return s[2]=r,s}function I(t){var e=t.width,r=t.height,n=t.longitude,i=t.latitude,a=t.zoom,o=t.pitch,u=void 0===o?0:o,l=t.bearing,h=void 0===l?0:l;(n<-180||n>180)&&(n=s(n+180,360)-180),(h<-180||h>180)&&(h=s(h+180,360)-180);var f=c(r/512);if(a<=f)a=f,i=0;else{var d=r/2/Math.pow(2,a),p=b([0,d])[1];if(i<p)i=p;else{var m=b([0,512-d])[1];i>m&&(i=m)}}return{width:e,height:r,longitude:n,latitude:i,zoom:a,pitch:u,bearing:h}}function k(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return R(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var D=["longitude","latitude","zoom"],B={curve:1.414,speed:1.2};function F(t,e,r){var n={},i=N(t,e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),a=i.startZoom,o=i.startCenterXY,s=i.uDelta,l=i.w0,c=i.u1,f=i.S,d=i.rho,p=i.rho2,m=i.r0;if(c<.01){var v,g=k(D);try{for(g.s();!(v=g.n()).done;){var _=v.value;n[_]=u(t[_],e[_],r)}}catch(t){g.e(t)}finally{g.f()}return n}var x=r*f,w=Math.cosh(m)/Math.cosh(m+d*x),M=l*((Math.cosh(m)*Math.tanh(m+d*x)-Math.sinh(m))/p)/c,A=a+y(1/w),E=h.e([],s,M);h.a(E,E,o);var S=b(E);return n.longitude=S[0],n.latitude=S[1],n.zoom=A,n}function j(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n=Object.assign({},B,n),a=i.screenSpeed,o=i.speed,s=i.maxDuration,u=N(t,e,n),l=u.rho,c=1e3*u.S;return r=Number.isFinite(a)?c/(a/l):c/o,Number.isFinite(s)&&r>s?0:r}function N(t,e,r){var n=(r=Object.assign({},B,r)).curve,i=t.zoom,a=[t.longitude,t.latitude],o=g(i),s=[e.longitude,e.latitude],u=g(e.zoom-i),l=_(a),c=_(s),f=h.f([],c,l),d=Math.max(t.width,t.height),p=d/u,m=h.b(f)*o,v=Math.max(m,.01),y=n*n,b=(p*p-d*d+y*y*v*v)/(2*d*y*v),x=(p*p-d*d-y*y*v*v)/(2*p*y*v),w=Math.log(Math.sqrt(b*b+1)-b),M=Math.log(Math.sqrt(x*x+1)-x);return{startZoom:i,startCenterXY:l,uDelta:f,w0:d,u1:m,S:(M-w)/n,rho:n,rho2:y,r0:w,r1:M}}r.d(e,"f",(function(){return P})),r.d(e,"c",(function(){return C})),r.d(e,"k",(function(){return I})),r.d(e,"d",(function(){return F})),r.d(e,"h",(function(){return j})),r.d(e,"j",(function(){return _})),r.d(e,"m",(function(){return b})),r.d(e,"n",(function(){return S})),r.d(e,"l",(function(){return T})),r.d(e,"b",(function(){return A})),r.d(e,"e",(function(){return E})),r.d(e,"i",(function(){return x})),r.d(e,"g",(function(){return w})),r.d(e,"a",(function(){return M}))},function(t,e,r){r.d(e,"a",(function(){return i})),r.d(e,"e",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"c",(function(){return u})),r.d(e,"g",(function(){return l})),r.d(e,"h",(function(){return c})),r.d(e,"i",(function(){return h})),r.d(e,"j",(function(){return f})),r.d(e,"f",(function(){return p}));var n=r(13);function i(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function a(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function o(t){return Math.hypot(t[0],t[1])}function s(t,e){return t[0]=-e[0],t[1]=-e[1],t}function u(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}function l(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function c(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function h(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function f(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}var d,p=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t};d=new n.a(2),n.a!=Float32Array&&(d[0]=0,d[1]=0)},function(t,e,r){r.d(e,"b",(function(){return a})),r.d(e,"g",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"l",(function(){return u})),r.d(e,"a",(function(){return l})),r.d(e,"k",(function(){return c})),r.d(e,"h",(function(){return h})),r.d(e,"m",(function(){return f})),r.d(e,"j",(function(){return d})),r.d(e,"d",(function(){return p})),r.d(e,"i",(function(){return m})),r.d(e,"n",(function(){return v})),r.d(e,"o",(function(){return g})),r.d(e,"f",(function(){return y})),r.d(e,"e",(function(){return _}));var n,i=r(13);function a(t){var e=new i.a(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function o(t,e,r,n){var a=new i.a(4);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function u(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function l(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function c(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function h(t){return Math.hypot(t[0],t[1],t[2],t[3])}function f(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function d(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t}function p(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function m(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t}function v(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}function g(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*a-u*i,h=l*i+u*n-o*a,f=l*a+o*i-s*n,d=-o*n-s*i-u*a;return t[0]=c*l+d*-o+h*-u-f*-s,t[1]=h*l+d*-s+f*-o-c*-u,t[2]=f*l+d*-u+c*-s-h*-o,t[3]=e[3],t}function y(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _(t,e){var r=t[0],n=t[1],a=t[2],o=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(r-s)<=i.b*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-u)<=i.b*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-l)<=i.b*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=i.b*Math.max(1,Math.abs(o),Math.abs(c))}n=new i.a(4),i.a!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)},function(t,e,r){t.exports=r(260)()},,function(t,e,r){t.exports=r(271)},,function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.default=t.exports,t.exports.__esModule=!0,r(e)}t.exports=r,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){t.exports=r(236)},function(t,e,r){r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return o}));var n=r(22),i={};function a(t){i=t}function o(t){var e;n.a.level>0&&i[t]&&(e=i[t]).call.apply(e,arguments)}},function(t,e,r){var n=r(196);t.exports=function(t){return new n(t)}},function(t,e,r){r.d(e,"a",(function(){return A}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(17),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(42),v=r(72),g=r(61),y=r(8),_=r(10),b=r(125),x={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},w={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:x},M={removedProps:x},A=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,r),(n=e.call(this,t,a)).stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),n.target=a.target||(n.gl.webgl2?36662:34962),n.initialize(a),Object.seal(u()(n)),n}return o()(r,[{key:"getElementCount",value:function(){return Math.round(this.byteLength/v.a.getBytesPerElement(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}},{key:"getVertexCount",value:function(){return Math.round(this.byteLength/v.a.getBytesPerVertex(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.accessor))}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=Object(b.a)("Buffer",t,w),this.usage=t.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data,t.offset,t.byteLength):this._setByteLength(t.byteLength||0),this}},{key:"setProps",value:function(t){return"accessor"in(t=Object(b.a)("Buffer",t,M))&&this.setAccessor(t.accessor),this}},{key:"setAccessor",value:function(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new v.a(t),this}},{key:"reallocate",value:function(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}},{key:"setData",value:function(t){return this.initialize(t)}},{key:"subData",value:function(t){ArrayBuffer.isView(t)&&(t={data:t});var e=t.data,r=t.offset,n=void 0===r?0:r,i=t.srcOffset,a=void 0===i?0:i,o=t.byteLength||t.length;Object(_.a)(e);var s=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(s,this.handle),0!==a||void 0!==o?(Object(y.a)(this.gl),this.gl.bufferSubData(this.target,n,e,a,o)):this.gl.bufferSubData(s,n,e),this.gl.bindBuffer(s,null),this.debugData=null,this._inferType(e),this}},{key:"copyData",value:function(t){var e=t.sourceBuffer,r=t.readOffset,n=void 0===r?0:r,i=t.writeOffset,a=void 0===i?0:i,o=t.size,s=this.gl;return Object(y.a)(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,a,o),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dstData,r=void 0===e?null:e,n=t.srcByteOffset,i=void 0===n?0:n,a=t.dstOffset,o=void 0===a?0:a,s=t.length,u=void 0===s?0:s;Object(y.a)(this.gl);var l,c,h=Object(g.c)(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(i);r?l=(c=r.length)-o:c=o+(l=Math.min(f,u||f));var d=Math.min(f,l);return u=u||d,Object(_.a)(u<=d),r=r||new h(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,i,r,o,u),this.gl.bindBuffer(36662,null),r}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,r=void 0===e?this.target:e,n=t.index,i=void 0===n?this.accessor&&this.accessor.index:n,a=t.offset,o=void 0===a?0:a,s=t.size;return 35345===r||35982===r?void 0!==s?this.gl.bindBufferRange(r,i,this.handle,o,s):(Object(_.a)(0===o),this.gl.bindBufferBase(r,i,this.handle)):this.gl.bindBuffer(r,this.handle),this}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,r=void 0===e?this.target:e,n=t.index;return 35345===r||35982===r?this.gl.bindBufferBase(r,void 0===n?this.accessor&&this.accessor.index:n,null):this.gl.bindBuffer(r,null),this}},{key:"getDebugData",value:function(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(10,this.byteLength)}),{data:this.debugData,changed:!0})}},{key:"invalidateDebugData",value:function(){this.debugData=null}},{key:"_setData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.byteLength+e;Object(_.a)(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();var n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,e,t),this.gl.bindBuffer(n,null),this.debugData=t.slice(0,10),this.bytesUsed=r,this._trackAllocatedMemory(r);var i=Object(g.b)(t);return Object(_.a)(i),this.setAccessor(new v.a(this.accessor,{type:i})),this}},{key:"_setByteLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.usage;Object(_.a)(t>=0),this._trackDeallocatedMemory();var r=t;0===t&&(r=new Float32Array(0));var n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,e),this.gl.bindBuffer(n,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}},{key:"_getTarget",value:function(){return this.gl.webgl2?36663:this.target}},{key:"_getAvailableElementCount",value:function(t){var e=t/Object(g.c)(this.accessor.type||5126,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}},{key:"_inferType",value:function(t){this.accessor.type||this.setAccessor(new v.a(this.accessor,{type:Object(g.b)(t)}))}},{key:"_createHandle",value:function(){return this.gl.createBuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_getParameter",value:function(t){this.gl.bindBuffer(this.target,this.handle);var e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}},{key:"type",get:function(){return y.k.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}},{key:"bytes",get:function(){return y.k.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}},{key:"setByteLength",value:function(t){return y.k.deprecated("setByteLength","reallocate")(),this.reallocate(t)}},{key:"updateAccessor",value:function(t){return y.k.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new v.a(this.accessor,t),this}}]),r}(m.a)},function(t,e,r){var n=r(75),i=r(19);function a(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function o(t,e){var r=t%e;return r<0?e+r:r}function s(t){return[t[12],t[13],t[14]]}function u(t){return{left:h(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:h(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:h(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:h(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:h(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:h(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}r.d(e,"a",(function(){return a})),r.d(e,"e",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return u})),r.d(e,"b",(function(){return f})),r.d(e,"f",(function(){return d}));var l,c=new i.a;function h(t,e,r,n){c.set(t,e,r);var a=c.len();return{distance:n/a,normal:new i.a(-t/a,-e/a,-r/a)}}function f(t){return t-Math.fround(t)}function d(t,e){var r=e.size,i=void 0===r?1:r,a=e.startIndex,o=void 0===a?0:a,s=void 0!==e.endIndex?e.endIndex:t.length,u=(s-o)/i;l=n.a.allocate(l,u,{type:Float32Array,size:2*i});for(var c=o,h=0;c<s;){for(var d=0;d<i;d++){var p=t[c++];l[h+d]=p,l[h+d+i]=f(p)}h+=2*i}return l.subarray(0,u*i*2)}},function(t,e,r){function n(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}r.d(e,"a",(function(){return n}))},function(t,e){t.exports=function(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}},function(t,e,r){r.d(e,"a",(function(){return v}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(8),u=r(130),l=r(54),c=r(10),h=r(60),f=r(151);function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m="Resource subclass must define virtual methods",v=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),Object(s.b)(e);var n=r.id,a=r.userData,o=void 0===a?{}:a;this.gl=e,this.gl2=e,this.id=n||Object(h.c)(this.constructor.name),this.userData=o,this._bound=!1,this._handle=r.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}return o()(t,[{key:"toString",value:function(){return"".concat(this.constructor.name,"(").concat(this.id,")")}},{key:"handle",get:function(){return this._handle}},{key:"delete",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).deleteChildren,e=void 0!==t&&t,r=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,r&&e&&r.filter(Boolean).forEach((function(t){return t.delete()})),this}},{key:"bind",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.handle;return"function"!=typeof e?(this._bindHandle(e),this):(this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t)}},{key:"unbind",value:function(){this.bind(null)}},{key:"getParameter",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=Object(l.b)(this.gl,t),Object(c.a)(t);var r=(this.constructor.PARAMETERS||{})[t];if(r){var n=Object(s.j)(this.gl);if("webgl2"in r&&!n||"extension"in r&&!this.gl.getExtension(r.extension))return n&&"webgl2"in r?r.webgl2:r.webgl1}return this._getParameter(t,e)}},{key:"getParameters",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.parameters,n=e.keys,i=this.constructor.PARAMETERS||{},a=Object(s.j)(this.gl),o={},u=d(r||Object.keys(i));try{for(u.s();!(t=u.n()).done;){var c=t.value,h=i[c];if(h&&(!("webgl2"in h)||a)&&(!("extension"in h)||this.gl.getExtension(h.extension))){var f=n?Object(l.a)(this.gl,c):c;o[f]=this.getParameter(c,e),n&&"GLenum"===h.type&&(o[f]=Object(l.a)(this.gl,o[f]))}}}catch(t){u.e(t)}finally{u.f()}return o}},{key:"setParameter",value:function(t,e){t=Object(l.b)(this.gl,t),Object(c.a)(t);var r=(this.constructor.PARAMETERS||{})[t];if(r){var n=Object(s.j)(this.gl);if("webgl2"in r&&!n||"extension"in r&&!this.gl.getExtension(r.extension))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(e=Object(l.b)(e))}return this._setParameter(t,e),this}},{key:"setParameters",value:function(t){for(var e in t)this.setParameter(e,t[e]);return this}},{key:"stubRemovedMethods",value:function(t,e,r){return Object(f.a)(this,t,e,r)}},{key:"initialize",value:function(t){}},{key:"_createHandle",value:function(){throw new Error(m)}},{key:"_deleteHandle",value:function(){throw new Error(m)}},{key:"_bindHandle",value:function(t){throw new Error(m)}},{key:"_getOptsFromHandle",value:function(){throw new Error(m)}},{key:"_getParameter",value:function(t,e){throw new Error(m)}},{key:"_setParameter",value:function(t,e){throw new Error(m)}},{key:"_context",value:function(){return this.gl.luma=this.gl.luma||{},this.gl.luma}},{key:"_addStats",value:function(){var t=this.constructor.name,e=u.a.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get("".concat(t,"s Created")).incrementCount(),e.get("".concat(t,"s Active")).incrementCount()}},{key:"_removeStats",value:function(){var t=this.constructor.name;u.a.get("Resource Counts").get("".concat(t,"s Active")).decrementCount()}},{key:"_trackAllocatedMemory",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.constructor.name,r=u.a.get("Memory Usage");r.get("GPU Memory").addCount(t),r.get("".concat(e," Memory")).addCount(t),this.byteLength=t}},{key:"_trackDeallocatedMemory",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.constructor.name,e=u.a.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get("".concat(t," Memory")).subtractCount(this.byteLength),this.byteLength=0}}]),t}()},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){r.d(e,"a",(function(){return x}));var n=r(12),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(22),c=r(39),h=r(14),f=r(90),d=r(73),p=r(20),m=r(27),v=r(16),g=Math.PI/180,y=Object(c.a)(),_=[0,0,0],b={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]},x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var r=e.id,n=e.x,i=void 0===n?0:n,a=e.y,s=void 0===a?0:a,u=e.width,l=void 0===u?1:u,c=e.height,h=void 0===c?1:c;this.id=(void 0===r?null:r)||this.constructor.displayName||"viewport",this.x=i,this.y=s,this.width=l||1,this.height=h||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return u()(t,[{key:"metersPerPixel",get:function(){return this.distanceScales.metersPerUnit[2]/this.scale}},{key:"projectionMode",get:function(){return this.isGeospatial?this.zoom<12?v.d.WEB_MERCATOR:v.d.WEB_MERCATOR_AUTO_OFFSET:v.d.IDENTITY}},{key:"equals",value:function(e){return e instanceof t&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Object(h.d)(e.projectionMatrix,this.projectionMatrix)&&Object(h.d)(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,n=this.projectPosition(t),a=Object(m.n)(n,this.pixelProjectionMatrix),o=i()(a,2),s=o[0],u=o[1],l=r?u:this.height-u;return 2===t.length?[s,l]:[s,l,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,a=e.targetZ,o=i()(t,3),s=o[0],u=o[1],l=o[2],c=n?u:this.height-u,h=a&&a*this.distanceScales.unitsPerMeter[2],f=Object(m.l)([s,c,l],this.pixelUnprojectionMatrix,h),d=this.unprojectPosition(f),p=i()(d,3),v=p[0],g=p[1],y=p[2];return Number.isFinite(l)?[v,g,y]:Number.isFinite(a)?[v,g,a]:[v,g]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),r=i()(e,2);return[r[0],r[1],(t[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),r=i()(e,2);return[r[0],r[1],(t[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(t){if(this.isGeospatial){var e=Object(m.j)(t);return e[1]=Object(h.a)(e[1],-318,830),e}return t}},{key:"unprojectFlat",value:function(t){return this.isGeospatial?Object(m.m)(t):t}},{key:"getBounds",value:function(){var t={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},e=this.unproject([0,0],t),r=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),i=this.unproject([this.width,this.height],t);return[Math.min(e[0],r[0],n[0],i[0]),Math.min(e[1],r[1],n[1],i[1]),Math.max(e[0],r[0],n[0],i[0]),Math.max(e[1],r[1],n[1],i[1])]}},{key:"getDistanceScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?Object(m.g)({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}},{key:"containsPixel",value:function(t){var e=t.x,r=t.y,n=t.width,i=t.height;return e<this.x+this.width&&this.x<e+(void 0===n?1:n)&&r<this.y+this.height&&this.y<r+(void 0===i?1:i)}},{key:"getFrustumPlanes",value:function(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,Object(c.d)(this.viewProjectionMatrix)),this._frustumPlanes}},{key:"panByPosition",value:function(t,e){return null}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"getCameraDirection",value:function(){return this.cameraDirection}},{key:"getCameraUp",value:function(){return this.cameraUp}},{key:"_createProjectionMatrix",value:function(t){var e=t.fovyRadians,r=t.aspect,n=t.focalDistance,i=t.near,a=t.far;return t.orthographic?(new f.a).orthographic({fovy:e,aspect:r,focalDistance:n,near:i,far:a}):(new f.a).perspective({fovy:e,aspect:r,near:i,far:a})}},{key:"_initViewMatrix",value:function(t){var e=t.viewMatrix,r=void 0===e?y:e,n=t.longitude,i=void 0===n?null:n,a=t.latitude,o=void 0===a?null:a,s=t.zoom,u=void 0===s?null:s,l=t.position,c=void 0===l?null:l,h=t.modelMatrix,p=void 0===h?null:h,v=t.focalDistance,g=void 0===v?1:v,x=t.distanceScales,w=void 0===x?null:x;this.isGeospatial=Number.isFinite(o)&&Number.isFinite(i),this.zoom=u,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?Object(m.i)({latitude:o})+Math.log2(g):0);var M=Math.pow(2,this.zoom);this.scale=M,this.distanceScales=this.isGeospatial?Object(m.g)({latitude:o,longitude:i}):w||b,this.focalDistance=g,this.distanceScales.metersPerUnit=new d.a(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new d.a(this.distanceScales.unitsPerMeter),this.position=_,this.meterOffset=_,c&&(this.position=c,this.modelMatrix=p,this.meterOffset=p?p.transformVector(c):c),this.isGeospatial?(this.longitude=i,this.latitude=o,this.center=this._getCenterInWorld({longitude:i,latitude:o})):this.center=c?this.projectPosition(c):[0,0,0],this.viewMatrixUncentered=r,this.viewMatrix=(new f.a).multiplyRight(this.viewMatrixUncentered).translate(new d.a(this.center||_).negate())}},{key:"_getCenterInWorld",value:function(t){var e=this.meterOffset,r=this.distanceScales,n=new d.a(this.projectPosition([t.longitude,t.latitude,0]));if(e){var i=new d.a(e).scale(r.unitsPerMeter);n.add(i)}return n}},{key:"_initProjectionMatrix",value:function(t){var e=t.projectionMatrix,r=t.orthographic,n=t.fovy,i=t.near,a=t.far,o=t.focalDistance;this.projectionMatrix=(void 0===e?null:e)||this._createProjectionMatrix({orthographic:void 0!==r&&r,fovyRadians:t.fovyRadians||(void 0===n?75:n)*g,aspect:this.width/this.height,focalDistance:void 0===o?1:o,near:void 0===i?.1:i,far:void 0===a?1e3:a})}},{key:"_initPixelMatrices",value:function(){var t=Object(c.a)();p.h(t,t,this.projectionMatrix),p.h(t,t,this.viewMatrix),this.viewProjectionMatrix=t,this.viewMatrixInverse=p.f([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Object(c.c)(this.viewMatrixInverse);var e=Object(c.a)(),r=Object(c.a)();p.o(e,e,[this.width/2,-this.height/2,1]),p.p(e,e,[1,-1,0]),p.h(r,e,this.viewProjectionMatrix),this.pixelProjectionMatrix=r,this.viewportMatrix=e,this.pixelUnprojectionMatrix=p.f(Object(c.a)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||l.a.warn("Pixel project matrix not invertible")()}}]),t}();x.displayName="Viewport"},function(t,e,r){var n=r(0),i=r.n(n),a=r(23),o=r(98),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(4),f=new(r(292).a)({id:"loaders.gl"}),d=function(){function t(){u()(this,t)}return c()(t,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),t}(),p={fetch:null,mimeType:void 0,nothrow:!1,log:new(function(){function t(){u()(this,t),Object(h.a)(this,"console",void 0),this.console=console}return c()(t,[{key:"log",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.log).bind.apply(t,[this.console].concat(r))}},{key:"info",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.info).bind.apply(t,[this.console].concat(r))}},{key:"warn",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.warn).bind.apply(t,[this.console].concat(r))}},{key:"error",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.error).bind.apply(t,[this.console].concat(r))}}]),t}()),CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},m={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function v(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(){globalThis.loaders=globalThis.loaders||{};var t=globalThis.loaders;return t._state=t._state||{},t._state}r.d(e,"b",(function(){return b})),r.d(e,"d",(function(){return w})),r.d(e,"c",(function(){return M})),r.d(e,"a",(function(){return A}));var x=function(){var t=b();return t.globalOptions=t.globalOptions||_({},p),t.globalOptions};function w(t){var e=b(),r=x();e.globalOptions=T(r,t)}function M(t,e,r,n){return r=r||[],function(t,e){E(t,null,p,m,e);var r,n=v(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;E(t&&t[i.id]||{},i.id,i.options&&i.options[i.id]||{},i.deprecatedOptions&&i.deprecatedOptions[i.id]||{},e)}}catch(t){n.e(t)}finally{n.f()}}(t,r=Array.isArray(r)?r:[r]),T(e,t,n)}function A(t,e){var r=x(),n=t||r;return"function"==typeof n.fetch?n.fetch:Object(a.f)(n.fetch)?function(t){return Object(o.a)(t,n)}:null!=e&&e.fetch?null==e?void 0:e.fetch:o.a}function E(t,e,r,n,i){var o=e||"Top level",s=e?"".concat(e,"."):"";for(var u in t){var l=!e&&Object(a.f)(t[u]);if(!(u in r||"baseUri"===u&&!e||"workerUrl"===u&&e))if(u in n)f.warn("".concat(o," loader option '").concat(s).concat(u,"' no longer supported, use '").concat(n[u],"'"))();else if(!l){var c=S(u,i);f.warn("".concat(o," loader option '").concat(s).concat(u,"' not recognized. ").concat(c))()}}}function S(t,e){var r,n=t.toLowerCase(),i="",a=v(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;for(var s in o.options){if(t===s)return"Did you mean '".concat(o.id,".").concat(s,"'?");var u=s.toLowerCase();(n.startsWith(u)||u.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(s,"'?"))}}}catch(t){a.e(t)}finally{a.f()}return i}function T(t,e,r){var n=_({},t.options||{});return function(t,e){!e||"baseUri"in t||(t.baseUri=e)}(n,r),null===n.log&&(n.log=new d),C(n,x()),C(n,e),n}function C(t,e){for(var r in e)if(r in e){var n=e[r];t[r]=Object(a.h)(n)&&Object(a.h)(t[r])?_(_({},t[r]),e[r]):e[r]}}},function(t,e,r){function n(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}r.d(e,"a",(function(){return n}))},function(t,e,r){var n=r(252),i=r(253),a=r(193),o=r(254);t.exports=function(t,e){return n(t)||i(t,e)||a(t,e)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(189);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(152).default,i=r(243);t.exports=function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(0),i=r.n(n);function a(t){var e=t.source,r=t.target,n=t.start,i=void 0===n?0:n,a=t.size,o=t.getData,s=e.length,u=(t.end||r.length)-i;if(s>u)r.set(e.subarray(0,u),i);else if(r.set(e,i),o)for(var l=s;l<u;)for(var c=o(l,e),h=0;h<a;h++)r[i+l]=c[h]||0,l++}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"e",(function(){return l})),r.d(e,"d",(function(){return c})),r.d(e,"c",(function(){return h})),r.d(e,"a",(function(){return f})),r.d(e,"b",(function(){return d})),r.d(e,"f",(function(){return p}));var u={interpolation:{duration:0,easing:function(t){return t}},spring:{stiffness:.05,damping:.5}};function l(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",s(s(s({},u[t.type]),e),t)):null}function c(t,e){return e.getBuffer()?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function h(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function f(t){t.push(t.shift())}function d(t,e){var r=t.value,n=t.doublePrecision&&r instanceof Float64Array?2:1;return(t.settings.noAlloc?r.length:e*t.size)*n}function p(t){var e=t.buffer,r=t.attribute,n=t.fromLength,i=t.fromStartIndices,o=t.getData,s=void 0===o?function(t){return t}:o,u=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*u,c=r.byteOffset,h=r.startIndices,f=i&&h,p=d(r,t.numInstances),m=r.state.constant;if(f||!(n>=p)){var v=m?r.value:r.getBuffer().getData({srcByteOffset:c});if(r.settings.normalized&&!m){var g=s;s=function(t,e){return r._normalizeConstant(g(t,e))}}var y=m?function(t,e){return s(v,e)}:function(t,e){return s(v.subarray(t,t+l),e)},_=e.getData({length:n}),b=new Float32Array(p);!function(t){var e=t.source,r=t.target,n=t.size,i=t.getData,o=t.sourceStartIndices,s=t.targetStartIndices;if(!Array.isArray(s))return a({source:e,target:r,size:n,getData:i}),r;for(var u=0,l=0,c=i&&function(t,e){return i(t+l,e)},h=Math.min(o.length,s.length),f=1;f<h;f++){var d=o[f]*n,p=s[f]*n;a({source:e.subarray(u,d),target:r,start:l,end:p,size:n,getData:c}),u=d,l=p}l<r.length&&a({source:[],target:r,start:l,size:n,getData:c})}({source:_,target:b,sourceStartIndices:i,targetStartIndices:h,size:l,getData:y}),e.byteLength<b.byteLength+c&&e.reallocate(b.byteLength+c),e.subData({data:b,offset:c})}}},function(t,e,r){r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return l}));var n=r(0),i=r.n(n),a=r(101);function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t){var e;return!!t&&(Array.isArray(t)&&(t=t[0]),Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions))}function l(t){var e,r,n;return Object(a.a)(t,"null loader"),Object(a.a)(u(t),"invalid loader"),Array.isArray(t)&&(n=t[1],t=s(s({},t=t[0]),{},{options:s(s({},t.options),n)})),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(r=t)&&void 0!==r&&r.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}},function(t,e,r){var n=r(259);t.exports=function(t){return function(){return new n(t.apply(this,arguments))}}},function(t,e,r){r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return a}));var n=r(10);function i(t,e){if("string"!=typeof e)return e;var r=Number(e);if(!isNaN(r))return r;var i=t[e=e.replace(/^.*\./,"")];return Object(n.a)(void 0!==i,"Accessing undefined constant GL.".concat(e)),i}function a(t,e){for(var r in e=Number(e),t)if(t[r]===e)return"GL.".concat(r);return String(e)}},function(t,e,r){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,"a",(function(){return n}))},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}r.d(e,"a",(function(){return i}))},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){function n(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}r.d(e,"a",(function(){return n}))},function(t,e,r){r.d(e,"c",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return s}));var n=r(10),i={};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"id";i[t]=i[t]||1;var e=i[t]++;return"".concat(t,"-").concat(e)}function o(t){return Object(n.a)("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function s(t){var e=!0;for(var r in t){e=!1;break}return e}},function(t,e,r){function n(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}function i(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).clamped,r=void 0===e||e;switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function a(t){var e=t.data,r=t.height,n=t.bytesPerPixel,i=t.temp,a=t.width*(void 0===n?4:n);i=i||new Uint8Array(a);for(var o=0;o<r/2;++o){var s=o*a,u=(r-o-1)*a;i.set(e.subarray(s,s+a)),e.copyWithin(s,u,u+a),e.set(i,u)}}function o(t){for(var e=t.data,r=t.width,n=t.height,i=Math.round(r/2),a=Math.round(n/2),o=new Uint8Array(i*a*4),s=0;s<a;s++)for(var u=0;u<i;u++)for(var l=0;l<4;l++)o[4*(s*i+u)+l]=e[4*(2*s*r+2*u)+l];return{data:o,width:i,height:a}}r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return a})),r.d(e,"d",(function(){return o}))},function(t,e,r){r.r(e);var n=r(16),i=r(124),a=r(135),o=r(97),s=r(136),u=r(1),l=r.n(u),c=r(3),h=r.n(c),f=r(6),d=r.n(f),p=r(9),m=r.n(p),v=r(5),g=r.n(v),y=r(111),_=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(){return l()(this,r),e.apply(this,arguments)}return h()(r,[{key:"getProjectedLight",value:function(t){var e=t.layer,r=this.projectedLight,n=e.context.viewport,i=e.props,a=i.coordinateSystem,o=i.coordinateOrigin,s=i.modelMatrix,u=Object(y.b)({viewport:n,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o}).project_uCameraPosition;return r.color=this.color,r.intensity=this.intensity,r.position=u,r}}]),r}(s.a),b=r(12),x=r.n(b),w=r(218),M=r.n(w),A=Math.PI/180,E=23.4397*A;function S(t,e,r){var n=function(t,e,r){var n,i,a,o,s=A*-r,u=A*e,l=function(t){return function(t){return t/864e5-.5+2440588}(t)-2451545}(t),c={declination:(a=i=(n=A*(357.5291+.98560028*l))+A*(1.9148*Math.sin(n)+.02*Math.sin(2*n)+3e-4*Math.sin(3*n))+102.9372*A+Math.PI,o=a,Math.asin(Math.sin(0)*Math.cos(E)+Math.cos(0)*Math.sin(E)*Math.sin(o))),rightAscension:T(i,0)},h=function(t,e){return A*(280.147+360.9856235*t)-e}(l,s)-c.rightAscension;return{azimuth:C(h,u,c.declination),altitude:O(h,u,c.declination)}}(t,e,r),i=n.azimuth,a=n.altitude;return[Math.sin(i)*Math.cos(a),Math.cos(i)*Math.cos(a),-Math.sin(a)]}function T(t,e){var r=t;return Math.atan2(Math.sin(r)*Math.cos(E)-Math.tan(e)*Math.sin(E),Math.cos(r))}function C(t,e,r){var n=t,i=e,a=r;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(i)-Math.tan(a)*Math.cos(i))}function O(t,e,r){var n=t,i=e,a=r;return Math.asin(Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos(n))}var P=["timestamp"],L=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t){var n,i=t.timestamp,a=M()(t,P);return l()(this,r),(n=e.call(this,a)).timestamp=i,n}return h()(r,[{key:"getProjectedLight",value:function(t){var e=t.layer.context.viewport;if(e.resolution>0){var r=S(this.timestamp,0,0),n=x()(r,3);this.direction=[n[0],-n[2],n[1]]}else this.direction=S(this.timestamp,e.latitude,e.longitude);return this}}]),r}(o.a),I=r(78),k=r(17),R=r.n(k),D=r(0),B=r.n(D),F=r(162),j=r(68),N=[-1,-1,1,-1,-1,1,1,1],U=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t,n){var i;l()(this,r);var a=N.map((function(t){return-1===t?0:t}));return(i=e.call(this,t,Object.assign({},n,{vs:"attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",geometry:new j.a({drawMode:5,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(N)},aTexCoord:{size:2,value:new Float32Array(a)},aCoordinate:{size:2,value:new Float32Array(a)}}})}))).setVertexCount(4),i}return r}(F.a),z=r(8),G=r(164),V=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t,n){var i;return l()(this,r),i=e.call(this,t,n),B()(R()(i),"model",void 0),i.model=new U(t,{id:n.id,fs:n.fs,modules:[n.module]}),i}return h()(r,[{key:"render",value:function(t){var e=this,r=this.gl;Object(z.n)(r,{viewport:[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}),Object(z.o)(r,{framebuffer:t.outputBuffer,clearColor:[0,0,0,0]},(function(){return e._renderPass(r,t)}))}},{key:"delete",value:function(){this.model.delete(),this.model=null}},{key:"_renderPass",value:function(t,e){var r=e.inputBuffer;Object(G.a)(t,{color:!0}),this.model.draw({moduleSettings:this.props.moduleSettings,uniforms:{texture:r,texSize:[r.width,r.height]},parameters:{depthWrite:!1,depthTest:!1}})}}]),r}(r(158).a),H=r(179);function W(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var $=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l()(this,r),(n=e.call(this,i)).id="".concat(t.name,"-pass"),Object(H.b)(t),n.module=t,n}return h()(r,[{key:"postRender",value:function(t,e){this.passes||(this.passes=function(t,e,r,n){if(e.filter||e.sampler){var i=K(e);return[new V(t,{id:r,module:e,fs:i,moduleSettings:n})]}return(e.passes||[]).map((function(i,a){var o=K(e,i),s="".concat(r,"-").concat(a);return new V(t,{id:s,module:e,fs:o,moduleSettings:n})}))}(t,this.module,this.id,this.props));for(var r=e.target,n=e.inputBuffer,i=e.swapBuffer,a=0;a<this.passes.length;a++){r&&a===this.passes.length-1&&(i=r),this.passes[a].render({inputBuffer:n,outputBuffer:i});var o=i;i=n,n=o}return n}},{key:"cleanup",value:function(){if(this.passes){var t,e=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return W(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?W(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.passes);try{for(e.s();!(t=e.n()).done;)t.value.delete()}catch(t){e.e(t)}finally{e.f()}this.passes=null}}}]),r}(I.a),q=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ".concat(t,"(gl_FragColor, texSize, texCoord);\n}\n")},X=function(t){return"uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ".concat(t,"(texture, texSize, texCoord);\n}\n")};function K(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;if(e.filter){var r="string"==typeof e.filter?e.filter:"".concat(t.name,"_filterColor");return q(r)}if(e.sampler){var n="string"==typeof e.sampler?e.sampler:"".concat(t.name,"_sampleColor");return X(n)}return null}var Z=r(77),Y=r(206),J=r(147),Q=r(146),tt=r(145),et=r(197),rt=r(148),nt=r(45),it=r(87),at=r(90),ot=r(24),st=r(29);function ut(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function lt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ct=Math.PI/180,ht=180/Math.PI;function ft(){var t=Math.PI/180*256;return{unitsPerMeter:[256/6370972,256/6370972,256/6370972],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,256/6370972],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}var dt=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,r);var i=n.latitude,a=void 0===i?0:i,o=n.longitude,s=void 0===o?0:o,u=n.zoom,c=void 0===u?11:u,h=n.nearZMultiplier,f=void 0===h?.1:h,d=n.farZMultiplier,p=void 0===d?2:d,m=n.resolution,v=void 0===m?10:m,g=n.width,y=n.height,_=n.altitude,b=void 0===_?1.5:_;g=g||1,y=y||1,b=Math.max(.75,b);var x=(new at.a).lookAt({eye:[0,-b,0],up:[0,0,1]}),w=Math.pow(2,c);x.rotateX(a*ct),x.rotateZ(-s*ct),x.scale(w/y);var M=Math.atan(.5/b),A=512*w/y;return(t=e.call(this,lt(lt({},n),{},{width:g,height:y,viewMatrix:x,longitude:s,latitude:a,zoom:c,fovyRadians:2*M,aspect:g/y,focalDistance:b,near:f,far:Math.min(2,1/A+1)*b*p}))).resolution=v,t.distanceScales=ft(),t}return h()(r,[{key:"projectionMode",get:function(){return n.d.GLOBE}},{key:"getDistanceScales",value:function(){return this.distanceScales}},{key:"getBounds",value:function(){var t={targetZ:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).z||0},e=this.unproject([0,this.height/2],t),r=this.unproject([this.width/2,0],t),n=this.unproject([this.width,this.height/2],t),i=this.unproject([this.width/2,this.height],t);return n[0]<this.longitude&&(n[0]+=360),e[0]>this.longitude&&(e[0]-=360),[Math.min(e[0],n[0],r[0],i[0]),Math.min(e[1],n[1],r[1],i[1]),Math.max(e[0],n[0],r[0],i[0]),Math.max(e[1],n[1],r[1],i[1])]}},{key:"unproject",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.topLeft,i=void 0===n||n,a=r.targetZ,o=x()(t,3),s=o[0],u=o[1],l=o[2],c=i?u:this.height-u,h=this.pixelUnprojectionMatrix;if(Number.isFinite(l))e=pt(h,[s,c,l,1]);else{var f=pt(h,[s,c,-1,1]),d=pt(h,[s,c,1,1]),p=256*((a||0)/6370972+1),m=ot.p(ot.q([],f,d)),v=ot.p(f),g=ot.p(d),y=(4*v*g-Math.pow(m-v-g,2))/16*4/m,_=(Math.sqrt(v-y)-Math.sqrt(Math.max(0,p*p-y)))/Math.sqrt(m);e=ot.i([],f,d,_)}var b=this.unprojectPosition(e),w=x()(b,3),M=w[0],A=w[1],E=w[2];return Number.isFinite(l)?[M,A,E]:Number.isFinite(a)?[M,A,a]:[M,A]}},{key:"projectPosition",value:function(t){var e=x()(t,3),r=e[2],n=void 0===r?0:r,i=e[0]*ct,a=e[1]*ct,o=Math.cos(a),s=256*(n/6370972+1);return[Math.sin(i)*o*s,-Math.cos(i)*o*s,Math.sin(a)*s]}},{key:"unprojectPosition",value:function(t){var e=x()(t,3),r=e[0],n=e[1],i=e[2],a=ot.g(t),o=Math.asin(i/a);return[Math.atan2(r,-n)*ht,o*ht,6370972*(a/256-1)]}},{key:"projectFlat",value:function(t){return t}},{key:"unprojectFlat",value:function(t){return t}},{key:"panByPosition",value:function(t,e){var r=this.unproject(e);return{longitude:t[0]-r[0]+this.longitude,latitude:t[1]-r[1]+this.latitude}}}]),r}(nt.a);function pt(t,e){var r=st.n([],e,t);return st.k(r,r,1/r[3]),r}var mt=r(207),vt=r(99),gt=r(198),yt=r(209),_t=r(110),bt=r(67),xt=r(137),wt=r(27),Mt=r(133),At=r(66),Et=r(112),St=r(39),Tt=r(73),Ct=r(14);function Ot(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Pt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ot(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ot(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Lt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}var It={position:[0,0,0],pitch:0,bearing:0,maxPitch:90,minPitch:-90},kt=function(t){d()(r,t);var e=Lt(r);function r(t){var n,i=t.width,a=t.height,o=t.position,s=void 0===o?It.position:o,u=t.bearing,c=void 0===u?It.bearing:u,h=t.pitch,f=void 0===h?It.pitch:h,d=t.longitude,p=t.latitude,m=t.maxPitch,v=void 0===m?It.maxPitch:m,g=t.minPitch,y=void 0===g?It.minPitch:g,_=t.startRotatePos,b=t.startBearing,x=t.startPitch,w=t.startZoomPosition,M=t.startZoom;return l()(this,r),(n=e.call(this,{width:i,height:a,position:s,bearing:c,pitch:f,longitude:d,latitude:p,maxPitch:v,minPitch:y}))._state={startRotatePos:_,startBearing:b,startPitch:x,startZoomPosition:w,startZoom:M},n}return h()(r,[{key:"getDirection",value:function(){return new Mt.a({bearing:this._viewportProps.bearing,pitch:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?90:90+this._viewportProps.pitch}).toVector3().normalize()}},{key:"panStart",value:function(){return this}},{key:"pan",value:function(){return this}},{key:"panEnd",value:function(){return this}},{key:"rotateStart",value:function(t){return this._getUpdatedState({startRotatePos:t.pos,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e=t.pos,r=t.deltaAngleX,n=void 0===r?0:r,i=t.deltaAngleY,a=void 0===i?0:i,o=this._state,s=o.startRotatePos,u=o.startBearing,l=o.startPitch,c=this._viewportProps,h=c.width,f=c.height;return s&&Number.isFinite(u)&&Number.isFinite(l)?this._getUpdatedState(e?{bearing:u-(e[0]-s[0])/h*180,pitch:l-(e[1]-s[1])/f*90}:{bearing:u-n,pitch:l-a}):this}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(){return this._getUpdatedState({startZoomPosition:this._viewportProps.position,startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.scale,r=this._state.startZoomPosition;r||(r=this._viewportProps.position);var n=this.getDirection();return this._move(n,20*Math.log2(e),r)}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"moveLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,e=this.getDirection(!0);return this._move(e.rotateZ({radians:Math.PI/2}),t)}},{key:"moveRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,e=this.getDirection(!0);return this._move(e.rotateZ({radians:-Math.PI/2}),t)}},{key:"moveUp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,e=this.getDirection(!0);return this._move(e,t)}},{key:"moveDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,e=this.getDirection(!0);return this._move(e.negate(),t)}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"zoomIn",value:function(){return this.zoom({scale:arguments.length>0&&void 0!==arguments[0]?arguments[0]:2})}},{key:"zoomOut",value:function(){return this.zoom({scale:1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),r=Pt({},this._viewportProps),n=r.bearing,i=r.longitude;return Math.abs(n-e.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(i-e.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}},{key:"_move",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._viewportProps.position,n=t.scale(e);return this._getUpdatedState({position:new Tt.a(r).add(n)})}},{key:"_getUpdatedState",value:function(t){return new r(Pt(Pt(Pt({},this._viewportProps),this._state),t))}},{key:"_applyConstraints",value:function(t){var e=t.pitch,r=t.maxPitch,n=t.minPitch,i=t.longitude,a=t.bearing;return t.pitch=Object(Ct.a)(e,n,r),(i<-180||i>180)&&(t.longitude=Object(St.e)(i+180,360)-180),(a<-180||a>180)&&(t.bearing=Object(St.e)(a+180,360)-180),t}}]),r}(Et.a),Rt=function(t){d()(r,t);var e=Lt(r);function r(t){return l()(this,r),e.call(this,kt,t)}return h()(r,[{key:"linearTransitionProps",get:function(){return["position","pitch","bearing"]}}]),r}(At.a);function Dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Bt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Dt(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Dt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}var jt=function(t){d()(r,t);var e=Ft(r);function r(t){l()(this,r);var n=t.modelMatrix,i=void 0===n?null:n,a=t.bearing,o=t.pitch,s=void 0===o?0:o,u=t.up,c=void 0===u?[0,0,1]:u,h=function(t){return new Mt.a({bearing:t.bearing,pitch:t.pitch}).toVector3().normalize()}({bearing:void 0===a?0:a,pitch:-90===s?1e-4:90+s}),f=i?i.transformDirection(h):h,d=Object(wt.i)(t),p=Math.pow(2,d),m=(new at.a).lookAt({eye:[0,0,0],center:f,up:c}).scale(p);return e.call(this,Bt(Bt({},t),{},{zoom:d,viewMatrix:m}))}return r}(nt.a),Nt=function(t){d()(r,t);var e=Ft(r);function r(t){return l()(this,r),e.call(this,Bt(Bt({},t),{},{type:jt}))}return h()(r,[{key:"controller",get:function(){return this._getControllerProps({type:Rt})}}]),r}(bt.a);Nt.displayName="FirstPersonView";var Ut=r(108);function zt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Gt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?zt(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):zt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}var Ht=Math.PI/180;function Wt(t){var e=t.height,r=t.focalDistance,n=t.orbitAxis,i=t.rotationX,a=t.rotationOrbit,o=t.zoom,s="Z"===n?[0,0,1]:[0,1,0],u="Z"===n?[0,-r,0]:[0,0,r],l=(new at.a).lookAt({eye:u,up:s});l.rotateX(i*Ht),"Z"===n?l.rotateZ(a*Ht):l.rotateY(a*Ht);var c=Math.pow(2,o)/(e||1);return l.scale(c),l}var $t=function(t){d()(r,t);var e=Vt(r);function r(t){var n;l()(this,r);var i=t.height,a=t.projectionMatrix,o=t.fovy,s=void 0===o?50:o,u=t.orbitAxis,c=t.target,h=void 0===c?[0,0,0]:c,f=t.rotationX,d=void 0===f?0:f,p=t.rotationOrbit,m=void 0===p?0:p,v=t.zoom,g=void 0===v?0:v,y=a?a[5]/2:Object(wt.e)(s);return n=e.call(this,Gt(Gt({},t),{},{longitude:null,viewMatrix:Wt({height:i,focalDistance:y,orbitAxis:u,rotationX:d,rotationOrbit:m,zoom:g}),fovy:s,focalDistance:y,position:h,zoom:g})),B()(R()(n),"projectedCenter",void 0),n.projectedCenter=n.project(n.center),n}return h()(r,[{key:"unproject",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).topLeft,r=void 0===e||e,n=x()(t,3),i=n[0],a=n[1],o=n[2],s=void 0===o?this.projectedCenter[2]:o,u=r?a:this.height-a,l=Object(wt.l)([i,u,s],this.pixelUnprojectionMatrix),c=x()(l,3);return[c[0],c[1],c[2]]}},{key:"panByPosition",value:function(t,e){var r=this.project(t);return{target:this.unproject([this.width/2+r[0]-e[0],this.height/2+r[1]-e[1],this.projectedCenter[2]])}}}]),r}(nt.a);B()($t,"displayName","OrbitView");var qt=function(t){d()(r,t);var e=Vt(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,r);var n=t.orbitAxis,i=void 0===n?"Z":n;return e.call(this,Gt(Gt({},t),{},{orbitAxis:i,type:$t}))}return h()(r,[{key:"controller",get:function(){return this._getControllerProps({type:Ut.b})}}]),r}(bt.a),Xt=r(141),Kt=r(18),Zt=r.n(Kt),Yt=r(106);function Jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}var Qt=function(t){d()(r,t);var e=Jt(r);function r(){return l()(this,r),e.apply(this,arguments)}return h()(r,[{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,n=t.zoom;t.zoom=Object(Ct.a)(n,r,e);var i=t.longitude,a=t.latitude;return(i<-180||i>180)&&(t.longitude=Object(St.e)(i+180,360)-180),t.latitude=Object(Ct.a)(a,-89,89),t}}]),r}(Yt.a),te=function(t){d()(r,t);var e=Jt(r);function r(t){return l()(this,r),t.dragMode=t.dragMode||"pan",e.call(this,Qt,t)}return h()(r,[{key:"setProps",value:function(t){Zt()(g()(r.prototype),"setProps",this).call(this,t),this.dragRotate=!1,this.touchRotate=!1}},{key:"linearTransitionProps",get:function(){return["longitude","latitude","zoom"]}}]),r}(At.a);function ee(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function re(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ee(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ne=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t){return l()(this,r),e.call(this,re(re({},t),{},{type:dt}))}return h()(r,[{key:"controller",get:function(){return this._getControllerProps({type:te})}}]),r}(bt.a);ne.displayName="GlobeView";var ie=r(142),ae=r(69),oe=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,t),B()(this,"props",void 0),this.opts=e}return h()(t,[{key:"equals",value:function(t){return this===t||this.constructor===t.constructor&&Object(ae.a)(this.opts,t.opts)}},{key:"getShaders",value:function(t){return null}},{key:"getSubLayerProps",value:function(t){var e=t.constructor.defaultProps,r=void 0===e?{}:e,n={updateTriggers:{}};for(var i in r)if(i in this.props){var a=r[i],o=this.props[i];n[i]=o,a&&"accessor"===a.type&&(n.updateTriggers[i]=this.props.updateTriggers[i],"function"==typeof o&&(n[i]=this.getSubLayerAccessor(o,!0)))}return n}},{key:"initializeState",value:function(t,e){}},{key:"updateState",value:function(t,e){}},{key:"draw",value:function(t,e){}},{key:"finalizeState",value:function(t){}}]),t}(),se=r(121),ue=r(107),le=r(122);function ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function he(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function fe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?he(Object(r),!0).forEach((function(e){B()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var de=["bearing","pitch"],pe={speed:1.2,curve:1.414},me=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l()(this,r),(t=e.call(this,{compare:["longitude","latitude","zoom","bearing","pitch"],extract:["width","height","longitude","latitude","zoom","bearing","pitch"],required:["width","height","latitude","longitude","zoom"]})).props=fe(fe({},pe),n),t}return h()(r,[{key:"interpolateProps",value:function(t,e,r){var n,i=Object(wt.d)(t,e,r,this.props),a=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ce(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ce(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(de);try{for(a.s();!(n=a.n()).done;){var o=n.value;i[o]=Object(Ct.g)(t[o]||0,e[o]||0,r)}}catch(t){a.e(t)}finally{a.f()}return i}},{key:"getDuration",value:function(t,e){var r=e.transitionDuration;return"auto"===r&&(r=Object(wt.h)(t,e,this.props)),r}}]),r}(ue.a),ve=r(22),ge=r(70),ye=r(75),_e=r(40),be=r(38);function xe(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return we(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?we(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function we(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Me=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,t);var r=e.attributes,n=void 0===r?{}:r;this.typedArrayManager=ye.a,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e),Object.seal(this)}return h()(t,[{key:"updateGeometry",value:function(t){Object.assign(this.opts,t);var e=this.opts,r=e.data,n=e.buffers,i=void 0===n?{}:n,a=e.getGeometry,o=e.geometryBuffer,s=e.positionFormat,u=e.dataChanged,l=e.normalize,c=void 0===l||l;if(this.data=r,this.getGeometry=a,this.positionSize=o&&o.size||("XY"===s?2:3),this.buffers=i,this.normalize=c,o&&(Object(_e.a)(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(o),c||(i.positions=o)),this.geometryBuffer=i.positions,Array.isArray(u)){var h,f=xe(u);try{for(f.s();!(h=f.n()).done;)this._rebuildGeometry(h.value)}catch(t){f.e(t)}finally{f.f()}}else this._rebuildGeometry()}},{key:"updatePartialGeometry",value:function(t){this._rebuildGeometry({startRow:t.startRow,endRow:t.endRow})}},{key:"normalizeGeometry",value:function(t){return t}},{key:"updateGeometryAttributes",value:function(t,e,r){throw new Error("Not implemented")}},{key:"getGeometrySize",value:function(t){throw new Error("Not implemented")}},{key:"getGeometryFromBuffer",value:function(t){var e=t.value||t;return Object(_e.a)(ArrayBuffer.isView(e)),Object(ge.b)(e,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices})}},{key:"_allocate",value:function(t,e){var r=this.attributes,n=this.buffers,i=this._attributeDefs,a=this.typedArrayManager;for(var o in i)if(o in n)a.release(r[o]),r[o]=null;else{var s=i[o];s.copy=e,r[o]=a.allocate(r[o],t,s)}}},{key:"_forEachGeometry",value:function(t,e,r){var n,i=this.data,a=this.getGeometry,o=Object(ge.a)(i,e,r),s=o.objectInfo,u=xe(o.iterable);try{for(u.s();!(n=u.n()).done;){var l=n.value;s.index++,t(a(l,s),s.index)}}catch(t){u.e(t)}finally{u.f()}}},{key:"_rebuildGeometry",value:function(t){var e=this;if(this.data&&this.getGeometry){var r=this.indexStarts,n=this.vertexStarts,i=this.instanceCount,a=this.data,o=this.geometryBuffer,s=t||{},u=s.startRow,l=void 0===u?0:u,c=s.endRow,h=void 0===c?1/0:c,f={};if(t||(r=[0],n=[0]),this.normalize||!o)this._forEachGeometry((function(t,r){t=e.normalizeGeometry(t),f[r]=t,n[r+1]=n[r]+e.getGeometrySize(t)}),l,h),i=n[n.length-1];else if(o.buffer instanceof be.a)i=(n=a.startIndices)[a.length]||o.buffer.byteLength/(o.stride||4*this.positionSize);else{var d=o.value||o;i=(n=a.startIndices)[a.length]||d.length/(o.stride/d.BYTES_PER_ELEMENT||this.positionSize)}this._allocate(i,Boolean(t)),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=i;var p={};this._forEachGeometry((function(t,a){t=f[a]||t,p.vertexStart=n[a],p.indexStart=r[a],p.geometrySize=(a<n.length-1?n[a+1]:i)-n[a],p.geometryIndex=a,e.updateGeometryAttributes(t,p)}),l,h),this.vertexCount=r[r.length-1]}}}]),t}(),Ae=r(74),Ee=r(144),Se=r(86),Te=r(143),Ce=r(123);r.d(e,"COORDINATE_SYSTEM",(function(){return n.a})),r.d(e,"OPERATION",(function(){return n.c})),r.d(e,"UNIT",(function(){return n.e})),r.d(e,"LightingEffect",(function(){return i.a})),r.d(e,"AmbientLight",(function(){return a.a})),r.d(e,"DirectionalLight",(function(){return o.a})),r.d(e,"PointLight",(function(){return s.a})),r.d(e,"_CameraLight",(function(){return _})),r.d(e,"_SunLight",(function(){return L})),r.d(e,"PostProcessEffect",(function(){return $})),r.d(e,"_LayersPass",(function(){return Z.a})),r.d(e,"Deck",(function(){return Y.a})),r.d(e,"LayerManager",(function(){return J.a})),r.d(e,"AttributeManager",(function(){return Q.a})),r.d(e,"Layer",(function(){return tt.a})),r.d(e,"CompositeLayer",(function(){return et.a})),r.d(e,"DeckRenderer",(function(){return rt.a})),r.d(e,"Viewport",(function(){return nt.a})),r.d(e,"WebMercatorViewport",(function(){return it.a})),r.d(e,"_GlobeViewport",(function(){return dt})),r.d(e,"picking",(function(){return mt.a})),r.d(e,"project",(function(){return vt.a})),r.d(e,"project32",(function(){return gt.a})),r.d(e,"gouraudLighting",(function(){return yt.a})),r.d(e,"phongLighting",(function(){return yt.b})),r.d(e,"shadow",(function(){return _t.a})),r.d(e,"View",(function(){return bt.a})),r.d(e,"MapView",(function(){return xt.a})),r.d(e,"FirstPersonView",(function(){return Nt})),r.d(e,"OrbitView",(function(){return qt})),r.d(e,"OrthographicView",(function(){return Xt.a})),r.d(e,"_GlobeView",(function(){return ne})),r.d(e,"Controller",(function(){return At.a})),r.d(e,"MapController",(function(){return Yt.b})),r.d(e,"_GlobeController",(function(){return te})),r.d(e,"FirstPersonController",(function(){return Rt})),r.d(e,"OrbitController",(function(){return Ut.b})),r.d(e,"OrthographicController",(function(){return ie.a})),r.d(e,"Effect",(function(){return I.a})),r.d(e,"LayerExtension",(function(){return oe})),r.d(e,"TRANSITION_EVENTS",(function(){return se.a})),r.d(e,"TransitionInterpolator",(function(){return ue.a})),r.d(e,"LinearInterpolator",(function(){return le.a})),r.d(e,"FlyToInterpolator",(function(){return me})),r.d(e,"log",(function(){return ve.a})),r.d(e,"createIterable",(function(){return ge.a})),r.d(e,"fp64LowPart",(function(){return St.b})),r.d(e,"Tesselator",(function(){return Me})),r.d(e,"_fillArray",(function(){return Ae.a})),r.d(e,"_flatten",(function(){return Ae.b})),r.d(e,"_count",(function(){return Ee.a})),r.d(e,"_memoize",(function(){return Se.a})),r.d(e,"_mergeShaders",(function(){return Te.a})),r.d(e,"_compareProps",(function(){return Ce.a}))},function(t,e,r){r.d(e,"a",(function(){return S}));var n=r(12),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(8),v=r(35),g=r(42),y=r(38),_=r(89),b=r(10),x=r(60);function w(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var A=[9729,9728],E=v.global.WebGLBuffer||function(){},S=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t,n){var i;o()(this,r);var a=n.id,s=void 0===a?Object(x.c)("texture"):a,u=n.target;return(i=e.call(this,t,{id:s,handle:n.handle})).target=u,i.textureUnit=void 0,i.loaded=!1,i.width=void 0,i.height=void 0,i.depth=void 0,i.format=void 0,i.type=void 0,i.dataFormat=void 0,i.border=void 0,i.textureUnit=void 0,i.mipmaps=void 0,i}return u()(r,[{key:"toString",value:function(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}},{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.data;if(r instanceof Promise)return r.then((function(r){return t.initialize(Object.assign({},e,{pixels:r,data:r}))})),this;var n="undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement;if(n&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",(function(){return t.initialize(e)})),this;var i=e.pixels,a=e.format,o=void 0===a?6408:a,s=e.border,u=void 0===s?0:s,l=e.recreate,c=void 0!==l&&l,h=e.parameters,f=void 0===h?{}:h,d=e.pixelStore,p=void 0===d?{}:d,v=e.textureUnit,g=void 0===v?void 0:v;r||(r=void 0===i?null:i);var y=e.width,_=e.height,b=e.dataFormat,x=e.type,w=e.compressed,M=void 0!==w&&w,A=e.mipmaps,E=void 0===A||A,S=e.depth,T=void 0===S?0:S,C=this._deduceParameters({format:o,type:x,dataFormat:b,compressed:M,data:r,width:y,height:_});return _=C.height,M=C.compressed,b=C.dataFormat,x=C.type,this.width=y=C.width,this.height=_,this.depth=T,this.format=o,this.type=x,this.dataFormat=b,this.border=u,this.textureUnit=g,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),E&&this._isNPOT()&&(m.k.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),E=!1,this._updateForNPOT(f)),this.mipmaps=E,this.setImageData({data:r,width:y,height:_,depth:T,format:o,type:x,dataFormat:b,border:u,mipmaps:E,parameters:p,compressed:M}),E&&this.generateMipmap(),this.setParameters(f),c&&(this.data=r),n&&(this._video={video:r,parameters:f,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}},{key:"update",value:function(){if(this._video){var t=this._video,e=t.video;if(t.lastTime===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t.parameters}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}},{key:"resize",value:function(t){var e=t.height,r=t.width,n=t.mipmaps;return r!==this.width||e!==this.height?this.initialize({width:r,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:void 0!==n&&n}):this}},{key:"generateMipmap",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isNPOT()?(m.k.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Object(m.o)(this.gl,e,(function(){t.gl.generateMipmap(t.target)})),this.gl.bindTexture(this.target,null),this)}},{key:"setImageData",value:function(t){this._trackDeallocatedMemory("Texture");var e=t.target,r=void 0===e?this.target:e,n=t.pixels,a=t.level,o=void 0===a?0:a,s=t.format,u=void 0===s?this.format:s,l=t.border,c=void 0===l?this.border:l,h=t.offset,f=void 0===h?0:h,d=t.parameters,p=void 0===d?{}:d,v=t.data,g=void 0===v?null:v,y=t.type,x=void 0===y?this.type:y,M=t.width,A=void 0===M?this.width:M,E=t.height,S=void 0===E?this.height:E,T=t.dataFormat,C=void 0===T?this.dataFormat:T,O=t.compressed,P=void 0!==O&&O;g||(g=void 0===n?null:n);var L=this._deduceParameters({format:u,type:x,dataFormat:C,compressed:P,data:g,width:A,height:S});x=L.type,C=L.dataFormat,P=L.compressed,A=L.width,S=L.height;var I=this.gl;I.bindTexture(this.target,this.handle);var k,R,D=this._getDataType({data:g,compressed:P});return g=D.data,k=D.dataType,Object(m.o)(this.gl,p,(function(){switch(k){case"null":I.texImage2D(r,o,u,A,S,c,C,x,g);break;case"typed-array":I.texImage2D(r,o,u,A,S,c,C,x,g,f);break;case"buffer":(R=Object(m.a)(I)).bindBuffer(35052,g.handle||g),R.texImage2D(r,o,u,A,S,c,C,x,f),R.bindBuffer(35052,null);break;case"browser-object":Object(m.j)(I)?I.texImage2D(r,o,u,A,S,c,C,x,g):I.texImage2D(r,o,u,C,x,g);break;case"compressed":var t,e=w(g.entries());try{for(e.s();!(t=e.n()).done;){var n=i()(t.value,2),a=n[1];I.compressedTexImage2D(r,n[0],a.format,a.width,a.height,c,a.data)}}catch(t){e.e(t)}finally{e.f()}break;default:Object(b.a)(!1,"Unknown image data type")}})),this._trackAllocatedMemory(g&&g.byteLength?g.byteLength:this.width*this.height*(_.a[this.dataFormat]||4)*(_.c[this.type]||1),"Texture"),this.loaded=!0,this}},{key:"setSubImageData",value:function(t){var e=this,r=t.target,n=void 0===r?this.target:r,i=t.pixels,a=void 0===i?null:i,o=t.data,s=void 0===o?null:o,u=t.x,l=void 0===u?0:u,c=t.y,h=void 0===c?0:c,f=t.width,d=void 0===f?this.width:f,p=t.height,v=void 0===p?this.height:p,g=t.level,_=void 0===g?0:g,x=t.format,w=void 0===x?this.format:x,M=t.type,A=void 0===M?this.type:M,S=t.dataFormat,T=void 0===S?this.dataFormat:S,C=t.compressed,O=void 0!==C&&C,P=t.offset,L=void 0===P?0:P,I=t.parameters,k=void 0===I?{}:I,R=this._deduceParameters({format:w,type:A,dataFormat:T,compressed:O,data:s,width:d,height:v});if(A=R.type,T=R.dataFormat,O=R.compressed,d=R.width,v=R.height,Object(b.a)(0===this.depth,"texSubImage not supported for 3D textures"),s||(s=a),s&&s.data){var D=s;s=D.data,d=D.shape[0],v=D.shape[1]}s instanceof y.a&&(s=s.handle),this.gl.bindTexture(this.target,this.handle),Object(m.o)(this.gl,k,(function(){if(O)e.gl.compressedTexSubImage2D(n,_,l,h,d,v,w,s);else if(null===s)e.gl.texSubImage2D(n,_,l,h,d,v,T,A,null);else if(ArrayBuffer.isView(s))e.gl.texSubImage2D(n,_,l,h,d,v,T,A,s,L);else if(s instanceof E){var t=Object(m.a)(e.gl);t.bindBuffer(35052,s),t.texSubImage2D(n,_,l,h,d,v,T,A,L),t.bindBuffer(35052,null)}else Object(m.j)(e.gl)?Object(m.a)(e.gl).texSubImage2D(n,_,l,h,d,v,T,A,s):e.gl.texSubImage2D(n,_,l,h,T,A,s)})),this.gl.bindTexture(this.target,null)}},{key:"copyFramebuffer",value:function(){return m.k.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"getActiveUnit",value:function(){return this.gl.getParameter(34016)-33984}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,this.handle),t}},{key:"unbind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.textureUnit,e=this.gl;return void 0!==t&&(this.textureUnit=t,e.activeTexture(33984+t)),e.bindTexture(this.target,null),t}},{key:"_getDataType",value:function(t){var e=t.data,r=t.compressed;return void 0!==r&&r?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof y.a?{data:e.handle,dataType:"buffer"}:e instanceof E?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}},{key:"_deduceParameters",value:function(t){var e=t.format,r=t.data,n=t.width,i=t.height,a=t.dataFormat,o=t.type,s=t.compressed,u=_.b[e];a=a||u&&u.dataFormat,o=o||u&&u.types[0],s=s||u&&u.compressed;var l=this._deduceImageSize(r,n,i);return{dataFormat:a,type:o,compressed:s,width:n=l.width,height:i=l.height,format:e,data:r}}},{key:"_deduceImageSize",value:function(t,e,r){var n;return n="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:r}:{width:e>=0?e:1,height:r>=0?r:1},Object(b.a)(n,"Could not deduced texture size"),Object(b.a)(void 0===e||n.width===e,"Deduced texture width does not match supplied width"),Object(b.a)(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}},{key:"_createHandle",value:function(){return this.gl.createTexture()}},{key:"_deleteHandle",value:function(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}},{key:"_getParameter",value:function(t){switch(t){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);var e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}},{key:"_setParameter",value:function(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case 33082:case 33083:this.gl.texParameterf(this.handle,t,e);break;case 4096:case 4097:Object(b.a)(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}},{key:"_isNPOT",value:function(){return!(Object(m.j)(this.gl)||!this.width||!this.height||Object(x.b)(this.width)&&Object(x.b)(this.height))}},{key:"_updateForNPOT",value:function(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}},{key:"_getNPOTParam",value:function(t,e){if(this._isNPOT())switch(t){case 10241:-1===A.indexOf(e)&&(e=9729);break;case 10242:case 10243:33071!==e&&(e=33071)}return e}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.format,n=e.linearFiltering,i=!0;return r&&(i=(i=i&&Object(_.d)(t,r))&&(!n||Object(_.e)(t,r))),i}}]),r}(g.a)},function(t,e,r){r.d(e,"a",(function(){return i})),r.d(e,"i",(function(){return a})),r.d(e,"d",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"e",(function(){return u})),r.d(e,"h",(function(){return l})),r.d(e,"f",(function(){return c})),r.d(e,"g",(function(){return h})),r.d(e,"c",(function(){return f}));var n=r(13);function i(){var t=new n.a(9);return n.a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function a(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function o(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*o-s*l,f=-c*a+s*u,d=l*a-o*u,p=r*h+n*f+i*d;return p?(t[0]=h*(p=1/p),t[1]=(-c*n+i*l)*p,t[2]=(s*n-i*o)*p,t[3]=f*p,t[4]=(c*r-i*u)*p,t[5]=(-s*r+i*a)*p,t[6]=d*p,t[7]=(-l*r+n*u)*p,t[8]=(o*r-n*a)*p,t):null}function s(t){var e=t[3],r=t[4],n=t[5],i=t[6],a=t[7],o=t[8];return t[0]*(o*r-n*a)+t[1]*(-o*e+n*i)+t[2]*(a*e-r*i)}function u(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=r[0],d=r[1],p=r[2],m=r[3],v=r[4],g=r[5],y=r[6],_=r[7],b=r[8];return t[0]=f*n+d*o+p*l,t[1]=f*i+d*s+p*c,t[2]=f*a+d*u+p*h,t[3]=m*n+v*o+g*l,t[4]=m*i+v*s+g*c,t[5]=m*a+v*u+g*h,t[6]=y*n+_*o+b*l,t[7]=y*i+_*s+b*c,t[8]=y*a+_*u+b*h,t}function l(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*n+d*o+l,t[7]=f*i+d*s+c,t[8]=f*a+d*u+h,t}function c(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*o,t[1]=d*i+f*s,t[2]=d*a+f*u,t[3]=d*o-f*n,t[4]=d*s-f*i,t[5]=d*u-f*a,t[6]=l,t[7]=c,t[8]=h,t}function h(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function f(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,c=n*o,h=n*s,f=i*o,d=i*s,p=i*u,m=a*o,v=a*s,g=a*u;return t[0]=1-h-p,t[3]=c-g,t[6]=f+v,t[1]=c+g,t[4]=1-l-p,t[7]=d-m,t[2]=f-v,t[5]=d+m,t[8]=1-l-h,t}},function(t,e,r){r.d(e,"b",(function(){return a})),r.d(e,"a",(function(){return o}));var n=r(11),i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":r.n(n)()(process))&&process},a=i.window||i.self||i.global,o=i.process||{}},function(t,e,r){r.d(e,"a",(function(){return w}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(0),u=r.n(s),l=r(121),c=r(122);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){u()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={transitionDuration:0},p={transitionDuration:300,transitionEasing:function(t){return t},transitionInterruption:l.a.BREAK},m=function(t){return 1-(1-t)*(1-t)},v=["wheel"],g=["panstart","panmove","panend"],y=["pinchstart","pinchmove","pinchend"],_=["tripanstart","tripanmove","tripanend"],b=["doubletap"],x=["keydown"],w=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),u()(this,"ControllerState",void 0),u()(this,"controllerState",null),u()(this,"controllerStateProps",null),u()(this,"transitionManager",void 0),u()(this,"_transition",void 0),u()(this,"_events",null),u()(this,"eventManager",null),u()(this,"_interactionState",{isDragging:!1}),u()(this,"_customEvents",[]),u()(this,"onViewStateChange",null),u()(this,"onStateChange",null),u()(this,"makeViewport",void 0),u()(this,"_eventStartBlocked",void 0),u()(this,"_state",void 0),u()(this,"_panMove",void 0),u()(this,"invertPan",void 0),u()(this,"dragMode","rotate"),u()(this,"inertia",0),u()(this,"scrollZoom",!0),u()(this,"dragPan",!0),u()(this,"dragRotate",!0),u()(this,"doubleClickZoom",!0),u()(this,"touchZoom",!0),u()(this,"touchRotate",!1),u()(this,"keyboard",!0),this.ControllerState=e,this.transitionManager=new l.b(e,f(f({},r),{},{onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}));var n=this.linearTransitionProps;this._transition=n&&f(f({},p),{},{transitionInterpolator:new c.a({transitionProps:n})}),this.handleEvent=this.handleEvent.bind(this),this.setProps(r)}return o()(t,[{key:"linearTransitionProps",get:function(){return null}},{key:"events",set:function(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.setProps(this.controllerStateProps)}},{key:"finalize",value:function(){for(var t in this._events)this._events[t]&&this.eventManager.off(t,this.handleEvent);this.transitionManager.finalize()}},{key:"handleEvent",value:function(t){this.controllerState=new(0,this.ControllerState)(f(f({makeViewport:this.makeViewport},this.controllerStateProps),this._state));var e=this._eventStartBlocked;switch(t.type){case"panstart":return!e&&this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return!e&&this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return!e&&this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var e=this.controllerStateProps,r=t.offsetCenter;return[r.x-e.x,r.y-e.y]}},{key:"isPointInBounds",value:function(t,e){var r=this.controllerStateProps;if(e&&e.handled)return!1;var n=t[0]>=0&&t[0]<=r.width&&t[1]>=0&&t[1]<=r.height;return n&&e&&e.stopPropagation(),n}},{key:"isFunctionKeyPressed",value:function(t){var e=t.srcEvent;return Boolean(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"blockEvents",value:function(t){var e=this,r=setTimeout((function(){e._eventStartBlocked===r&&(e._eventStartBlocked=null)}),t);this._eventStartBlocked=r}},{key:"setProps",value:function(t){"onViewStateChange"in t&&(this.onViewStateChange=t.onViewStateChange),"onStateChange"in t&&(this.onStateChange=t.onStateChange),"makeViewport"in t&&(this.makeViewport=t.makeViewport),"dragMode"in t&&(this.dragMode=t.dragMode),this.controllerStateProps=t,"eventManager"in t&&this.eventManager!==t.eventManager&&(this.eventManager=t.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);var e=t.inertia;!0===e&&(e=300),this.inertia=e;var r=t.scrollZoom,n=void 0===r||r,i=t.dragPan,a=void 0===i||i,o=t.dragRotate,s=void 0===o||o,u=t.doubleClickZoom,l=void 0===u||u,c=t.touchZoom,h=void 0===c||c,f=t.touchRotate,d=void 0!==f&&f,p=t.keyboard,m=void 0===p||p,w=Boolean(this.onViewStateChange);this.toggleEvents(v,w&&n),this.toggleEvents(g,w&&(a||s)),this.toggleEvents(y,w&&(h||d)),this.toggleEvents(_,w&&d),this.toggleEvents(b,w&&l),this.toggleEvents(x,w&&m),this.scrollZoom=n,this.dragPan=a,this.dragRotate=s,this.doubleClickZoom=l,this.touchZoom=h,this.touchRotate=d,this.keyboard=m}},{key:"updateTransition",value:function(){this.transitionManager.updateTransition()}},{key:"toggleEvents",value:function(t,e){var r=this;this.eventManager&&t.forEach((function(t){r._events[t]!==e&&(r._events[t]=e,e?r.eventManager.on(t,r.handleEvent):r.eventManager.off(t,r.handleEvent))}))}},{key:"updateViewport",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=f(f({},t.getViewportProps()),e),i=this.controllerState!==t;if(this._state=t.getState(),this._setInteractionState(r),i){var a=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a})}}},{key:"_onTransition",value:function(t){this.onViewStateChange&&(t.interactionState=this._interactionState,this.onViewStateChange(t))}},{key:"_setInteractionState",value:function(t){Object.assign(this._interactionState,t),this.onStateChange&&this.onStateChange(this._interactionState)}},{key:"_onPanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var r=this.isFunctionKeyPressed(t)||t.rightButton;(this.invertPan||"pan"===this.dragMode)&&(r=!r);var n=this.controllerState[r?"panStart":"rotateStart"]({pos:e});return this._panMove=r,this.updateViewport(n,d,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return!!this.isDragging()&&(this._panMove?this._onPanMove(t):this._onPanRotate(t))}},{key:"_onPanEnd",value:function(t){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t))}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var e=this.getCenter(t),r=this.controllerState.pan({pos:e});return this.updateViewport(r,d,{isDragging:!0,isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){var e=this.inertia;if(this.dragPan&&e&&t.velocity){var r=this.getCenter(t),n=this.controllerState.pan({pos:[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2]}).panEnd();this.updateViewport(n,f(f({},this._getTransitionProps()),{},{transitionDuration:e,transitionEasing:m}),{isDragging:!1,isPanning:!0})}else{var i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var e=this.getCenter(t),r=this.controllerState.rotate({pos:e});return this.updateViewport(r,d,{isDragging:!0,isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){var e=this.inertia;if(this.dragRotate&&e&&t.velocity){var r=this.getCenter(t),n=this.controllerState.rotate({pos:[r[0]+t.velocityX*e/2,r[1]+t.velocityY*e/2]}).rotateEnd();this.updateViewport(n,f(f({},this._getTransitionProps()),{},{transitionDuration:e,transitionEasing:m}),{isDragging:!1,isRotating:!0})}else{var i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;t.preventDefault();var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var r=this.scrollZoom,n=r.speed,i=r.smooth,a=void 0!==i&&i,o=t.delta,s=2/(1+Math.exp(-Math.abs(o*(void 0===n?.01:n))));o<0&&0!==s&&(s=1/s);var u=this.controllerState.zoom({pos:e,scale:s});return this.updateViewport(u,f(f({},this._getTransitionProps({around:e})),{},{transitionDuration:a?250:1}),{isZooming:!0,isPanning:!0}),!0}},{key:"_onTriplePanStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var r=this.controllerState.rotateStart({pos:e});return this.updateViewport(r,d,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;var e=this.getCenter(t);e[0]-=t.deltaX;var r=this.controllerState.rotate({pos:e});return this.updateViewport(r,d,{isDragging:!0,isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;var e=this.inertia;if(this.touchRotate&&e&&t.velocityY){var r=this.getCenter(t),n=[r[0],r[1]+=t.velocityY*e/2],i=this.controllerState.rotate({pos:n});this.updateViewport(i,f(f({},this._getTransitionProps()),{},{transitionDuration:e,transitionEasing:m}),{isDragging:!1,isRotating:!0}),this.blockEvents(e)}else{var a=this.controllerState.rotateEnd();this.updateViewport(a,null,{isDragging:!1,isRotating:!1})}return!0}},{key:"_onPinchStart",value:function(t){var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var r=this.controllerState.zoomStart({pos:e}).rotateStart({pos:e});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(r,d,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;var e=this.controllerState;if(this.touchZoom){var r=t.scale,n=this.getCenter(t);e=e.zoom({pos:n,scale:r})}return this.touchRotate&&(e=e.rotate({deltaAngleX:this._startPinchRotation-t.rotation})),this.updateViewport(e,d,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;var e=this.inertia,r=this._lastPinchEvent;if(this.touchZoom&&e&&r&&t.scale!==r.scale){var n=this.getCenter(t),i=this.controllerState.rotateEnd(),a=Math.log2(t.scale),o=(a-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),s=Math.pow(2,a+o*e/2);i=i.zoom({pos:n,scale:s}).zoomEnd(),this.updateViewport(i,f(f({},this._getTransitionProps({around:n})),{},{transitionDuration:e,transitionEasing:m}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(e)}else{var u=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(u,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var e=this.getCenter(t);if(!this.isPointInBounds(e,t))return!1;var r=this.isFunctionKeyPressed(t),n=this.controllerState.zoom({pos:e,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:e}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var e,r=this.isFunctionKeyPressed(t),n=this.keyboard,i=n.zoomSpeed,a=n.moveSpeed,o=n.rotateSpeedX,s=n.rotateSpeedY,u=this.controllerState,l={};switch(t.srcEvent.code){case"Minus":e=r?u.zoomOut(i).zoomOut(i):u.zoomOut(i),l.isZooming=!0;break;case"Equal":e=r?u.zoomIn(i).zoomIn(i):u.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":r?(e=u.rotateLeft(o),l.isRotating=!0):(e=u.moveLeft(a),l.isPanning=!0);break;case"ArrowRight":r?(e=u.rotateRight(o),l.isRotating=!0):(e=u.moveRight(a),l.isPanning=!0);break;case"ArrowUp":r?(e=u.rotateUp(s),l.isRotating=!0):(e=u.moveUp(a),l.isPanning=!0);break;case"ArrowDown":r?(e=u.rotateDown(s),l.isRotating=!0):(e=u.moveDown(a),l.isPanning=!0);break;default:return!1}return this.updateViewport(e,this._getTransitionProps(),l),!0}},{key:"_getTransitionProps",value:function(t){var e=this._transition;return e?t?f(f({},e),{},{transitionInterpolator:new c.a(f(f({},t),{},{transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport}))}):e:d}}]),t}()},function(t,e,r){var n=r(11),i=r.n(n),a=r(0),o=r.n(a),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(45),f=/([0-9]+\.?[0-9]*)(%|px)/;function d(t){switch(i()(t)){case"number":return{position:t,relative:!1};case"string":var e=f.exec(t);if(e&&e.length>=3){var r="%"===e[2],n=parseFloat(e[1]);return{position:r?n/100:n,relative:r}}default:throw new Error("Could not parse position string ".concat(t))}}function p(t,e){return t.relative?Math.round(t.position*e):t.position}var m=r(69),v=r(40);function g(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?g(Object(r),!0).forEach((function(e){o()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return _}));var _=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u()(this,t);var r=e.id,n=void 0===r?null:r,i=e.x,a=void 0===i?0:i,o=e.y,s=void 0===o?0:o,l=e.width,c=void 0===l?"100%":l,f=e.height,d=void 0===f?"100%":f,p=e.viewportInstance,m=e.type,g=void 0===m?h.a:m;Object(v.a)(!p||p instanceof h.a),this.viewportInstance=p,this.id=n||this.constructor.displayName||"view",this.type=g,this.props=y(y({},e),{},{id:this.id}),this._parseDimensions({x:a,y:s,width:c,height:d}),this.equals=this.equals.bind(this),Object.seal(this)}return c()(t,[{key:"equals",value:function(t){return this===t||(this.viewportInstance?t.viewportInstance&&this.viewportInstance.equals(t.viewportInstance):Object(m.a)(this.props,t.props))}},{key:"makeViewport",value:function(t){var e=t.width,r=t.height,n=t.viewState;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);var i=this.getDimensions({width:e,height:r});return this._getViewport(n,i)}},{key:"getViewStateId",value:function(){switch(i()(this.props.viewState)){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}},{key:"filterViewState",value:function(t){if(this.props.viewState&&"object"===i()(this.props.viewState)){if(!this.props.viewState.id)return this.props.viewState;var e=y({},t);for(var r in this.props.viewState)"id"!==r&&(e[r]=this.props.viewState[r]);return e}return t}},{key:"getDimensions",value:function(t){var e=t.width,r=t.height;return{x:p(this._x,e),y:p(this._y,r),width:p(this._width,e),height:p(this._height,r)}}},{key:"_getControllerProps",value:function(t){var e=this.props.controller;return e?!0===e?t:("function"==typeof e&&(e={type:e}),y(y({},t),e)):null}},{key:"_getViewport",value:function(t,e){return new this.type(y(y(y({},t),this.props),e))}},{key:"_parseDimensions",value:function(t){var e=t.y,r=t.width,n=t.height;this._x=d(t.x),this._y=d(e),this._width=d(r),this._height=d(n)}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return d}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(60),c=r(10);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}var f={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},d=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var r=e.id,n=void 0===r?Object(l.c)("geometry"):r,i=e.drawMode,a=void 0===i?f.TRIANGLES:i,s=e.attributes,u=void 0===s?{}:s,c=e.indices,h=void 0===c?null:c,d=e.vertexCount,p=void 0===d?null:d;this.id=n,this.drawMode=0|a,this.attributes={},this.userData={},this._setAttributes(u,h),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}return u()(t,[{key:"mode",get:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getAttributes",value:function(){return this.indices?function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({indices:this.indices},this.attributes):this.attributes}},{key:"_print",value:function(t){return"Geometry ".concat(this.id," attribute ").concat(t)}},{key:"_setAttributes",value:function(t,e){for(var r in e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e),t){var n=t[r];n=ArrayBuffer.isView(n)?{value:n}:n,Object(c.a)(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),"POSITION"!==r&&"positions"!==r||n.size||(n.size=3),"indices"===r?(Object(c.a)(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}},{key:"_calculateVertexCount",value:function(t,e){if(e)return e.value.length;var r=1/0;for(var n in t){var i=t[n],a=i.value,o=i.size;!i.constant&&a&&o>=1&&(r=Math.min(r,a.length/o))}return Object(c.a)(Number.isFinite(r)),r}}],[{key:"DRAW_MODE",get:function(){return f}}]),t}()},function(t,e,r){function n(t,e){if(t===e)return!0;if(!t||!e)return!1;for(var r in t){var i=t[r],a=e[r];if(!(i===a||Array.isArray(i)&&Array.isArray(a)&&n(i,a)))return!1}return!0}r.d(e,"a",(function(){return n}))},function(t,e,r){r.d(e,"a",(function(){return a})),r.d(e,"c",(function(){return o})),r.d(e,"b",(function(){return s}));var n=[],i=[];function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,a=n,o={index:-1,data:t,target:[]};return t?"function"==typeof t[Symbol.iterator]?a=t:t.length>0&&(i.length=t.length,a=i):a=n,(e>0||Number.isFinite(r))&&(a=(Array.isArray(a)?a:Array.from(a)).slice(e,r),o.index=e-1),{iterable:a,objectInfo:o}}function o(t){return t&&t[Symbol.asyncIterator]}function s(t,e){var r=e.size,n=e.stride,i=e.offset,a=e.startIndices,o=e.nested,s=t.BYTES_PER_ELEMENT,u=n?n/s:r,l=i?i/s:0,c=Math.floor((t.length-l)/u);return function(e,n){var i=n.index,s=n.target;if(!a){for(var h=i*u+l,f=0;f<r;f++)s[f]=t[h+f];return s}var d,p=a[i],m=a[i+1]||c;if(o){d=new Array(m-p);for(var v=p;v<m;v++){var g=v*u+l;s=new Array(r);for(var y=0;y<r;y++)s[y]=t[g+y];d[v-p]=s}}else if(u===r)d=t.subarray(p*r+l,m*r+l);else{d=new t.constructor((m-p)*r);for(var _=0,b=p;b<m;b++)for(var x=b*u+l,w=0;w<r;w++)d[_++]=t[x+w]}return d}}},function(t,e,r){var n=r(23),i=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,a=/^([-\w.]+\/[-\w.+]+)/;function o(t){var e=i.exec(t);return e?e[1]:""}r.d(e,"b",(function(){return u})),r.d(e,"a",(function(){return l}));var s=/\?.*/;function u(t){if(Object(n.j)(t)){var e=c(t.url||"");return{url:e,type:(r=t.headers.get("content-type")||"",i=a.exec(r),(i?i[1]:r)||o(e))}}var r,i;return Object(n.b)(t)?{url:c(t.name||""),type:t.type||""}:"string"==typeof t?{url:c(t),type:o(t)}:{url:"",type:""}}function l(t){return Object(n.j)(t)?t.headers["content-length"]||-1:Object(n.b)(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function c(t){return t.replace(s,"")}},function(t,e,r){r.d(e,"a",(function(){return p}));var n=r(210),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(61),c=r(10),h=r(125),f={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},d={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}},p=function(){function t(){var e=this;o()(this,t);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];n.forEach((function(t){return e._assign(t)})),Object.freeze(this)}return u()(t,[{key:"toString",value:function(){return JSON.stringify(this)}},{key:"BYTES_PER_ELEMENT",get:function(){return t.getBytesPerElement(this)}},{key:"BYTES_PER_VERTEX",get:function(){return t.getBytesPerVertex(this)}},{key:"_assign",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return void 0!==(t=Object(h.a)("Accessor",t,d)).type&&(this.type=t.type,5124!==t.type&&5125!==t.type||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&(this.index="boolean"==typeof t.index?t.index?1:0:t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}],[{key:"getBytesPerElement",value:function(t){return Object(l.c)(t.type||5126).BYTES_PER_ELEMENT}},{key:"getBytesPerVertex",value:function(t){return Object(c.a)(t.size),Object(l.c)(t.type||5126).BYTES_PER_ELEMENT*t.size}},{key:"resolve",value:function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return i()(t,[f].concat(r))}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return b}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(153),p=r(14),m=r(25),v=r(24),g=r(81),y=[0,0,0],_={},b=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return i()(this,r),t=e.call(this,-0,-0,-0),1===arguments.length&&Object(p.f)(n)?t.copy(n):(p.b.debug&&(Object(m.a)(n),Object(m.a)(a),Object(m.a)(o)),t[0]=n,t[1]=a,t[2]=o),t}return o()(r,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return p.b.debug&&(Object(m.a)(t.x),Object(m.a)(t.y),Object(m.a)(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Object(m.a)(t)}},{key:"angle",value:function(t){return v.b(this,t)}},{key:"cross",value:function(t){return v.d(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.origin;return v.m(this,this,void 0===e?y:e,t.radians),this.check()}},{key:"rotateY",value:function(t){var e=t.origin;return v.n(this,this,void 0===e?y:e,t.radians),this.check()}},{key:"rotateZ",value:function(t){var e=t.origin;return v.o(this,this,void 0===e?y:e,t.radians),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return v.s(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(g.c)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return v.r(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return Object(g.b)(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return v.t(this,this,t),this.check()}}],[{key:"ZERO",get:function(){return _.ZERO=_.ZERO||Object.freeze(new r(0,0,0,0))}}]),r}(d.a)},function(t,e,r){function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};return Array.isArray(t)?i(t,e,[]):e(t)?[t]:[]}function i(t,e,r){for(var n=-1;++n<t.length;){var a=t[n];Array.isArray(a)?i(a,e,r):e(a)&&r.push(a)}return r}function a(t){for(var e=t.target,r=t.source,n=t.start,i=void 0===n?0:n,a=t.count,o=r.length,s=(void 0===a?1:a)*o,u=0,l=i;u<o;u++)e[l++]=r[u];for(;u<s;)u<s-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+s-u),u=s);return e}r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return a}))},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=function(){function t(e){i()(this,t),this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}return o()(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"allocate",value:function(t,e,r){var n,i=r.size,a=void 0===i?1:i,o=r.padding,s=void 0===o?0:o,u=r.copy,l=void 0!==u&&u,c=r.initialize,h=void 0!==c&&c,f=r.maxCount,d=r.type||t&&t.constructor||Float32Array,p=e*a+s;if(ArrayBuffer.isView(t)){if(p<=t.length)return t;if(p*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new d(t.buffer,0,p)}f&&(n=f*a+s);var m=this._allocate(d,p,h,n);return t&&l?m.set(t):h||m.fill(0,0,4),this._release(t),m}},{key:"release",value:function(t){this._release(t)}},{key:"_allocate",value:function(t,e,r,n){var i=Math.max(Math.ceil(e*this.props.overAlloc),1);i>n&&(i=n);var a=this._pool,o=t.BYTES_PER_ELEMENT*i,s=a.findIndex((function(t){return t.byteLength>=o}));if(s>=0){var u=new t(a.splice(s,1)[0],0,i);return r&&u.fill(0),u}return new t(i)}},{key:"_release",value:function(t){if(ArrayBuffer.isView(t)){var e=this._pool,r=t.buffer,n=r.byteLength,i=e.findIndex((function(t){return t.byteLength>=n}));i<0?e.push(r):(i>0||e.length<this.props.poolSize)&&e.splice(i,0,r),e.length>this.props.poolSize&&e.shift()}}}]),t}();e.a=new s},function(t,e,r){r.r(e);var n=r(98),i=r(7),a=r.n(i),o=r(2),s=r.n(o),u=r(21);function l(t,e,r){return c.apply(this,arguments)}function c(){return(c=a()(s.a.mark((function t(e,r,n){var i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("number"!=typeof e){t.next=4;break}return t.next=3,u.a._readToArrayBuffer(e,r,n);case 3:case 8:return t.abrupt("return",t.sent);case 4:return e instanceof Blob||(e=new Blob([e])),i=e.slice(r,r+n),t.next=8,h(i);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){return f.apply(this,arguments)}function f(){return(f=a()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var n=new FileReader;n.onload=function(e){var r;return t(null==e||null===(r=e.target)||void 0===r?void 0:r.result)},n.onerror=function(t){return r(t)},n.readAsArrayBuffer(e)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var d=r(95),p=r(91),m=r(84),v=r(101);function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t=Object(d.b)(t),!p.c){var r=u.a.readFileSync(t,e);return"string"!=typeof r?Object(m.d)(r):r}return e.nothrow||Object(v.a)(!1),null}var y=r(96);function _(t,e,r){return b.apply(this,arguments)}function b(){return(b=a()(s.a.mark((function t(e,r,n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Object(d.b)(e),p.c){t.next=4;break}return t.next=4,u.a.writeFile(e,Object(y.c)(r),{flag:"w"});case 4:Object(v.a)(!1);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t,e,r){t=Object(d.b)(t),p.c||u.a.writeFileSync(t,Object(y.c)(e),{flag:"w"}),Object(v.a)(!1)}var w=r(46);function M(t){Object(w.d)(t)}var A=r(105),E=r(85),S=r(100),T=r(11),C=r.n(T),O=r(52),P=r(113),L=r(93),I=r(71);function k(t,e,r,n){Object(v.a)(!n||"object"===C()(n)),Array.isArray(e)||Object(O.a)(e)||(n=void 0,r=e,e=void 0),r=r||{};var i=e,a=Object(L.b)(i,n),o=Object(E.b)(t,a,r);if(!o)return null;r=Object(w.c)(r,o,a);var s=Object(I.b)(t).url;return function(t,e,r,n){if(e=Object(P.b)(e,t,r),t.parseTextSync&&"string"==typeof e)return t.parseTextSync(e,r);if(t.parseSync&&e instanceof ArrayBuffer)return t.parseSync(e,r,n);throw new Error("".concat(t.name," loader: 'parseSync' not supported by this loader, use 'parse' instead. ").concat(n.url||""))}(o,t,r,n=Object(L.a)({url:s,parseSync:k,parse:function(){throw new Error("parseSync called parse")},loaders:e},r))}var R=r(0),D=r.n(R),B=r(53),F=r.n(B),j=r(37),N=r.n(j),U=r(41),z=r.n(U),G=r(219),V=r.n(G),H=r(139);function W(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?W(Object(r),!0).forEach((function(e){D()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function q(t,e,r,n){return X.apply(this,arguments)}function X(){return(X=a()(s.a.mark((function t(e,r,n,i){var a,o,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object(v.a)(!i||"object"===C()(i)),Array.isArray(r)||Object(O.a)(r)||(i=void 0,n=r,r=void 0),t.next=4,e;case 4:return e=t.sent,n=n||{},a=Object(I.b)(e),o=a.url,t.next=9,Object(E.a)(e,r,n);case 9:if(u=t.sent){t.next=12;break}return t.abrupt("return",null);case 12:return n=Object(w.c)(n,u,r,o),i=Object(L.a)({url:o,parseInBatches:q,parse:S.a,loaders:r},n,i),t.next=16,K(u,e,n,i);case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function K(t,e,r,n){var i,a,o,u;return s.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return u=function(){return(u=F()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a;case 2:return t.delegateYield(V()(z()(e),N.a),"t0",3);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)},o=function(t){return u.apply(this,arguments)},l.next=4,s.a.awrap(Z(t,e,r,n));case 4:if(i=l.sent,r.metadata){l.next=7;break}return l.abrupt("return",i);case 7:return a={batchType:"metadata",metadata:{_loader:t,_context:n},data:[],bytesUsed:0},l.abrupt("return",o(i));case 9:case"end":return l.stop()}}),null,null,null,Promise)}function Z(t,e,r,n){return Y.apply(this,arguments)}function Y(){return(Y=a()(s.a.mark((function t(e,r,n,i){var a,o,u,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=function(){return(l=F()(s.a.mark((function t(){var r,a,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N()(Object(H.a)(o));case 2:return r=t.sent,t.next=5,N()(Object(S.a)(r,e,$($({},n),{},{mimeType:e.mimeTypes[0]}),i));case 5:return a=t.sent,u={mimeType:e.mimeTypes[0],shape:Array.isArray(a)?"row-table":"unknown",batchType:"data",data:a,length:Array.isArray(a)?a.length:1},t.next=9,u;case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)},u=function(){return l.apply(this,arguments)},t.next=4,Object(P.c)(r,n);case 4:return a=t.sent,t.next=7,J(a,(null==n?void 0:n.transforms)||[]);case 7:if(o=t.sent,!e.parseInBatches){t.next=10;break}return t.abrupt("return",e.parseInBatches(o,n,i));case 10:return t.abrupt("return",u());case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(t){return Q.apply(this,arguments)}function Q(){return(Q=a()(s.a.mark((function t(e){var r,n,i,a,o,u,l,c=arguments;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=c.length>1&&void 0!==c[1]?c[1]:[],n=e,i=!1,a=!1,t.prev=4,u=z()(r);case 6:return t.next=8,u.next();case 8:if(!(i=!(l=t.sent).done)){t.next=14;break}n=(0,l.value)(n);case 11:i=!1,t.next=6;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(4),a=!0,o=t.t0;case 20:if(t.prev=20,t.prev=21,!i||null==u.return){t.next=25;break}return t.next=25,u.return();case 25:if(t.prev=25,!a){t.next=28;break}throw o;case 28:return t.finish(25);case 29:return t.finish(20);case 30:return t.abrupt("return",n);case 31:case"end":return t.stop()}}),t,null,[[4,16,20,30],[21,,25,29]])})))).apply(this,arguments)}var tt=r(194);function et(t,e,r,n){Array.isArray(e)||Object(O.a)(e)||(r=e,e=null);var i=Object(w.a)(r||{});return Array.isArray(t)?t.map((function(t){return rt(t,e,r,i)})):rt(t,e,r,i)}function rt(t,e,r,n){return nt.apply(this,arguments)}function nt(){return(nt=a()(s.a.mark((function t(e,r,n,i){var a,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=8;break}return a=e,t.next=4,i(a);case 4:return o=t.sent,t.next=7,q(o,r,n);case 7:case 10:return t.abrupt("return",t.sent);case 8:return t.next=10,q(e,r,n);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function it(t,e,r){return at.apply(this,arguments)}function at(){return(at=a()(s.a.mark((function t(e,r,i){var a,o,u,l,c,h,f,d,v,g;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.encode){t.next=4;break}return t.next=3,r.encode(e,i);case 3:return t.abrupt("return",t.sent);case 4:if(!r.encodeSync){t.next=6;break}return t.abrupt("return",r.encodeSync(e,i));case 6:if(!r.encodeText){t.next=12;break}return t.t0=new TextEncoder,t.next=10,r.encodeText(e,i);case 10:return t.t1=t.sent,t.abrupt("return",t.t0.encode.call(t.t0,t.t1));case 12:if(!r.encodeInBatches){t.next=44;break}a=lt(e,r,i),o=[],u=!1,l=!1,t.prev=17,h=z()(a);case 19:return t.next=21,h.next();case 21:if(!(u=!(f=t.sent).done)){t.next=27;break}o.push(f.value);case 24:u=!1,t.next=19;break;case 27:t.next=33;break;case 29:t.prev=29,t.t2=t.catch(17),l=!0,c=t.t2;case 33:if(t.prev=33,t.prev=34,!u||null==h.return){t.next=38;break}return t.next=38,h.return();case 38:if(t.prev=38,!l){t.next=41;break}throw c;case 41:return t.finish(38);case 42:return t.finish(33);case 43:return t.abrupt("return",m.b.apply(void 0,o));case 44:if(p.c||!r.encodeURLtoURL){t.next=56;break}return d=ft("input"),t.next=48,_(d,e);case 48:return v=ft("output"),t.next=51,ct(d,v,r,i);case 51:return g=t.sent,t.next=54,Object(n.a)(g);case 54:return t.abrupt("return",t.sent.arrayBuffer());case 56:throw new Error("Writer could not encode data");case 57:case"end":return t.stop()}}),t,null,[[17,29,33,43],[34,,38,42]])})))).apply(this,arguments)}function ot(t,e,r){if(e.encodeSync)return e.encodeSync(t,r);throw new Error("Writer could not synchronously encode data")}function st(t,e,r){return ut.apply(this,arguments)}function ut(){return(ut=a()(s.a.mark((function t(e,r,n){var i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.text||!r.encodeText){t.next=4;break}return t.next=3,r.encodeText(e,n);case 3:return t.abrupt("return",t.sent);case 4:if(!r.text||!r.encode&&!r.encodeInBatches){t.next=9;break}return t.next=7,it(e,r,n);case 7:return i=t.sent,t.abrupt("return",(new TextDecoder).decode(i));case 9:throw new Error("Writer could not encode data as text");case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function lt(t,e,r){if(e.encodeInBatches){var n=function(t){return[{table:t,start:0,end:t.length}]}(t);return e.encodeInBatches(n,r)}throw new Error("Writer could not encode data in batches")}function ct(t,e,r,n){return ht.apply(this,arguments)}function ht(){return(ht=a()(s.a.mark((function t(e,r,n,i){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=Object(d.b)(e),r=Object(d.b)(r),!p.c&&n.encodeURLtoURL){t.next=4;break}throw new Error;case 4:return t.next=6,n.encodeURLtoURL(e,r,i);case 6:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ft(t){return"/tmp/".concat(t)}function dt(t,e,r,n){return pt.apply(this,arguments)}function pt(){return(pt=a()(s.a.mark((function t(e,r,n,i){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,it(e,n,i);case 2:return a=t.sent,t.next=5,_(r,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mt(t,e,r,n){return x(e,ot(t,r,n))}var vt=r(199),gt=r(114);function yt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _t(t,e){var r=t[Symbol.asyncIterator]?t[Symbol.asyncIterator]():t[Symbol.iterator]();return new ReadableStream({type:"bytes",pull:function(t){return a()(s.a.mark((function e(){var n,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.next();case 3:i=(n=e.sent).value,n.done?t.close():t.enqueue(new Uint8Array(i)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},cancel:function(){return a()(s.a.mark((function t(){var e;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==r||null===(e=r.return)||void 0===e?void 0:e.call(r);case 2:case"end":return t.stop()}}),t)})))()}},function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yt(Object(r),!0).forEach((function(e){D()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({highWaterMark:Math.pow(2,24)},e))}var bt,xt,wt={name:"Null loader",id:"null",module:"core",version:"3.1.5",worker:!0,mimeTypes:["application/x.empty"],extensions:["null"],tests:[function(){return!1}],options:{null:{}}},Mt={name:"Null loader",id:"null",module:"core",version:"3.1.5",mimeTypes:["application/x.empty"],extensions:["null"],parse:(xt=a()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e);case 1:case"end":return t.stop()}}),t)}))),function(t){return xt.apply(this,arguments)}),parseSync:function(t){return t},parseInBatches:(bt=F()(s.a.mark((function t(e){var r,n,i,a,o,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!1,n=!1,t.prev=2,a=z()(e);case 4:return t.next=6,N()(a.next());case 6:if(!(r=!(o=t.sent).done)){t.next=13;break}return u=o.value,t.next=10,u;case 10:r=!1,t.next=4;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(2),n=!0,i=t.t0;case 19:if(t.prev=19,t.prev=20,!r||null==a.return){t.next=24;break}return t.next=24,N()(a.return());case 24:if(t.prev=24,!n){t.next=27;break}throw i;case 27:return t.finish(24);case 28:return t.finish(19);case 29:case"end":return t.stop()}}),t,null,[[2,15,19,29],[20,,24,28]])}))),function(t){return bt.apply(this,arguments)}),tests:[function(){return!1}],options:{null:{}}},At=r(200);function Et(t,e){return St.apply(this,arguments)}function St(){return(St=a()(s.a.mark((function t(e,r){var n,i,o,u,l,c,h=arguments;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=h.length>2&&void 0!==h[2]?h[2]:function(){},i=h.length>3&&void 0!==h[3]?h[3]:function(){},t.next=4,e;case 4:if((e=t.sent).ok){t.next=7;break}return t.abrupt("return",e);case 7:if(o=e.body){t.next=10;break}return t.abrupt("return",e);case 10:if(u=e.headers.get("content-length")||0,l=u&&parseInt(u),u>0){t.next=14;break}return t.abrupt("return",e);case 14:if("undefined"!=typeof ReadableStream&&o.getReader){t.next=16;break}return t.abrupt("return",e);case 16:return c=new ReadableStream({start:function(t){return a()(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.getReader(),e.next=3,Tt(t,a,0,l,r,n,i);case 3:case"end":return e.stop()}}),e)})))()}}),t.abrupt("return",new Response(c));case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tt(t,e,r,n,i,a,o){return Ct.apply(this,arguments)}function Ct(){return(Ct=a()(s.a.mark((function t(e,r,n,i,a,o,u){var l,c,h;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.read();case 3:if(c=(l=t.sent).value,!l.done){t.next=10;break}return o(),e.close(),t.abrupt("return");case 10:return n+=c.byteLength,h=Math.round(n/i*100),a(h,{loadedBytes:n,totalBytes:i}),e.enqueue(c),t.next=16,Tt(e,r,n,i,a,o,u);case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(0),e.error(t.t0),u(t.t0);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})))).apply(this,arguments)}var Ot=r(1),Pt=r.n(Ot),Lt=r(3),It=r.n(Lt),kt=r(4),Rt=function(){function t(e,r){Pt()(this,t),Object(kt.a)(this,"_fetch",void 0),Object(kt.a)(this,"files",{}),Object(kt.a)(this,"lowerCaseFiles",{}),Object(kt.a)(this,"usedFiles",{}),this._fetch=(null==r?void 0:r.fetch)||fetch;for(var n=0;n<e.length;++n){var i=e[n];this.files[i.name]=i,this.lowerCaseFiles[i.name.toLowerCase()]=i,this.usedFiles[i.name]=!1}this.fetch=this.fetch.bind(this)}var e,r,n,i,o,u,l;return It()(t,[{key:"fetch",value:(l=a()(s.a.mark((function t(e,r){var n,i,a,o,u,l,c,h;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.includes("://")){t.next=2;break}return t.abrupt("return",this._fetch(e,r));case 2:if(n=this.files[e]){t.next=5;break}return t.abrupt("return",new Response(e,{status:400,statusText:"NOT FOUND"}));case 5:if(i=new Headers(null==r?void 0:r.headers),a=i.get("Range"),!(o=a&&/bytes=($1)-($2)/.exec(a))){t.next=17;break}return u=parseInt(o[1]),l=parseInt(o[2]),t.next=13,n.slice(u,l).arrayBuffer();case 13:return c=new Response(t.sent),Object.defineProperty(c,"url",{value:e}),t.abrupt("return",c);case 17:return h=new Response(n),Object.defineProperty(h,"url",{value:e}),t.abrupt("return",h);case 20:case"end":return t.stop()}}),t,this)}))),function(t,e){return l.apply(this,arguments)})},{key:"readdir",value:(u=a()(s.a.mark((function t(e){var r,n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n in r=[],this.files)r.push(n);return t.abrupt("return",r);case 3:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"stat",value:(o=a()(s.a.mark((function t(e,r){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.files[e]){t.next=3;break}throw new Error(e);case 3:return t.abrupt("return",{size:n.size});case 4:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"unlink",value:(i=a()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:delete this.files[e],delete this.lowerCaseFiles[e],this.usedFiles[e]=!0;case 3:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"open",value:(n=a()(s.a.mark((function t(e,r,n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.files[e]);case 1:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return n.apply(this,arguments)})},{key:"read",value:(r=a()(s.a.mark((function t(e,r){var n,i,a,o=arguments;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>3&&void 0!==o[3]?o[3]:r.byteLength,i=e,a=0,t.next=7,i.slice(a,a+n).arrayBuffer();case 7:return t.abrupt("return",{bytesRead:n,buffer:t.sent});case 9:case"end":return t.stop()}}),t)}))),function(t,e){return r.apply(this,arguments)})},{key:"close",value:(e=a()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"_getFile",value:function(t,e){var r=this.files[t]||this.lowerCaseFiles[t];return r&&e&&(this.usedFiles[t]=!0),r}}]),t}(),Dt=r(119),Bt=r(23);r.d(e,"fetchFile",(function(){return n.a})),r.d(e,"readArrayBuffer",(function(){return l})),r.d(e,"readFileSync",(function(){return g})),r.d(e,"writeFile",(function(){return _})),r.d(e,"writeFileSync",(function(){return x})),r.d(e,"setLoaderOptions",(function(){return M})),r.d(e,"registerLoaders",(function(){return A.c})),r.d(e,"selectLoader",(function(){return E.a})),r.d(e,"selectLoaderSync",(function(){return E.b})),r.d(e,"parse",(function(){return S.a})),r.d(e,"parseSync",(function(){return k})),r.d(e,"parseInBatches",(function(){return q})),r.d(e,"load",(function(){return tt.a})),r.d(e,"loadInBatches",(function(){return et})),r.d(e,"encode",(function(){return it})),r.d(e,"encodeSync",(function(){return ot})),r.d(e,"encodeInBatches",(function(){return lt})),r.d(e,"encodeText",(function(){return st})),r.d(e,"encodeURLtoURL",(function(){return ct})),r.d(e,"save",(function(){return dt})),r.d(e,"saveSync",(function(){return mt})),r.d(e,"setPathPrefix",(function(){return d.c})),r.d(e,"getPathPrefix",(function(){return d.a})),r.d(e,"resolvePath",(function(){return d.b})),r.d(e,"RequestScheduler",(function(){return vt.a})),r.d(e,"makeIterator",(function(){return gt.a})),r.d(e,"makeStream",(function(){return _t})),r.d(e,"NullWorkerLoader",(function(){return wt})),r.d(e,"NullLoader",(function(){return Mt})),r.d(e,"JSONLoader",(function(){return At.a})),r.d(e,"_fetchProgress",(function(){return Et})),r.d(e,"_BrowserFileSystem",(function(){return Rt})),r.d(e,"_unregisterLoaders",(function(){return A.a})),r.d(e,"isBrowser",(function(){return p.c})),r.d(e,"isWorker",(function(){return p.d})),r.d(e,"self",(function(){return p.e})),r.d(e,"window",(function(){return p.f})),r.d(e,"global",(function(){return p.b})),r.d(e,"document",(function(){return p.a})),r.d(e,"assert",(function(){return v.a})),r.d(e,"forEach",(function(){return H.b})),r.d(e,"concatenateArrayBuffersAsync",(function(){return H.a})),r.d(e,"makeTextDecoderIterator",(function(){return Dt.c})),r.d(e,"makeTextEncoderIterator",(function(){return Dt.d})),r.d(e,"makeLineIterator",(function(){return Dt.a})),r.d(e,"makeNumberedLineIterator",(function(){return Dt.b})),r.d(e,"isPureObject",(function(){return Bt.h})),r.d(e,"isPromise",(function(){return Bt.g})),r.d(e,"isIterable",(function(){return Bt.d})),r.d(e,"isAsyncIterable",(function(){return Bt.a})),r.d(e,"isIterator",(function(){return Bt.e})),r.d(e,"isResponse",(function(){return Bt.j})),r.d(e,"isReadableStream",(function(){return Bt.i})),r.d(e,"isWritableStream",(function(){return Bt.k}))},function(t,e,r){r.d(e,"a",(function(){return y}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(6),u=r.n(s),l=r(9),c=r.n(l),h=r(5),f=r.n(h),d=r(158),p=r(8),m=r(164);function v(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var y=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){return i()(this,r),e.apply(this,arguments)}return o()(r,[{key:"render",value:function(t){var e=this.gl;return Object(p.n)(e,{framebuffer:t.target}),this._drawLayers(t)}},{key:"_drawLayers",value:function(t){var e=t.target,r=t.moduleParameters,n=t.viewports,i=t.views,a=t.onViewportActive,o=t.clearCanvas,s=void 0===o||o;t.pass=t.pass||"unknown";var u=this.gl;s&&function(t){var e=t.drawingBufferWidth,r=t.drawingBufferHeight;Object(p.n)(t,{viewport:[0,0,e,r]}),t.clear(16640)}(u);var l,c=[],h=v(n);try{for(h.s();!(l=h.n()).done;){var f=l.value,d=i&&i[f.id];a(f);var m,g=this._getDrawLayerParams(f,t),y=v(f.subViewports||[f]);try{for(y.s();!(m=y.n()).done;){var _=this._drawLayersInViewport(u,{target:e,moduleParameters:r,viewport:m.value,view:d,pass:t.pass,layers:t.layers},g);c.push(_)}}catch(t){y.e(t)}finally{y.f()}}}catch(t){h.e(t)}finally{h.f()}return c}},{key:"_getDrawLayerParams",value:function(t,e){for(var r=e.layers,n=e.pass,i=e.layerFilter,a=e.effects,o=e.moduleParameters,s=[],u=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=function i(a,o){var s,u=a.props._offset,l=a.id,c=a.parent&&a.parent.id;if(!c||c in r||i(a.parent,!1),c in n){var h=n[c]=n[c]||t(r[c],r);s=h(a,o),n[l]=h}else Number.isFinite(u)?(s=u+(r[c]||0),n[l]=null):s=e;return o&&s>=e&&(e=s+1),r[l]=s,s};return i}(),l={layer:r[0],viewport:t,isPicking:n.startsWith("picking"),renderPass:n},c={},h=0;h<r.length;h++){var f=r[h],d=this._shouldDrawLayer(f,l,i,c),p={shouldDrawLayer:d,layerRenderIndex:u(f,d)};d&&(p.moduleParameters=this._getModuleParameters(f,a,n,o),p.layerParameters=this.getLayerParameters(f,h,t)),s[h]=p}return s}},{key:"_drawLayersInViewport",value:function(t,e,r){var n=e.layers,i=e.pass,a=e.viewport,o=e.view,s=function(t,e){var r=e.moduleParameters,n=e.target,i=e.viewport,a=n&&"default-framebuffer"!==n.id,o=r&&r.devicePixelRatio||Object(p.e)(t);return[i.x*o,(a?n.height:t.drawingBufferHeight)-(i.y+i.height)*o,i.width*o,i.height*o]}(t,{moduleParameters:e.moduleParameters,target:e.target,viewport:a});if(o&&o.props.clear){var u=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;Object(p.o)(t,{scissorTest:!0,scissor:s},(function(){return Object(m.a)(t,u)}))}var l={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};Object(p.n)(t,{viewport:s});for(var c=0;c<n.length;c++){var h=n[c],f=r[c],d=f.shouldDrawLayer,v=f.layerRenderIndex,g=f.moduleParameters,y=f.layerParameters;if(d&&h.props.pickable&&l.pickableCount++,h.isComposite)l.compositeCount++;else if(d){l.visibleCount++,g.viewport=a;try{h.drawLayer({moduleParameters:g,uniforms:{layerIndex:v},parameters:y})}catch(t){h.raiseError(t,"drawing ".concat(h," to ").concat(i))}}}return l}},{key:"shouldDrawLayer",value:function(t){return!0}},{key:"getModuleParameters",value:function(t,e){return null}},{key:"getLayerParameters",value:function(t,e,r){return t.props.parameters}},{key:"_shouldDrawLayer",value:function(t,e,r,n){if(!this.shouldDrawLayer(t)||!t.props.visible)return!1;e.layer=t;for(var i=t.parent;i;){if(!i.props.visible||!i.filterSubLayer(e))return!1;e.layer=i,i=i.parent}if(r){var a=e.layer.id;if(a in n||(n[a]=r(e)),!n[a])return!1}return t.activateViewport(e.viewport),!0}},{key:"_getModuleParameters",value:function(t,e,r,n){var i,a=Object.assign(Object.create((null===(i=t.internalState)||void 0===i?void 0:i.propsInTransition)||t.props),{autoWrapLongitude:t.wrapLongitude,viewport:t.context.viewport,mousePosition:t.context.mousePosition,pickingActive:0,devicePixelRatio:Object(p.e)(this.gl)});if(e){var o,s=v(e);try{for(s.s();!(o=s.n()).done;)Object.assign(a,o.value.getModuleParameters(t))}catch(t){s.e(t)}finally{s.f()}}return Object.assign(a,this.getModuleParameters(t,e),n)}}]),r}(d.a)},function(t,e,r){r.d(e,"a",(function(){return h}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(0),u=r.n(s);function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){u()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t),u()(this,"id",void 0),u()(this,"props",void 0),u()(this,"useInPicking",void 0);var r=e.id;this.id=void 0===r?"effect":r,this.props=c({},e),this.useInPicking=!1}return o()(t,[{key:"preRender",value:function(){}},{key:"getModuleParameters",value:function(t){}},{key:"cleanup",value:function(){}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return I}));var n=r(0),i=r.n(n),a=r(12),o=r.n(a),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(17),f=r.n(h),d=r(18),p=r.n(d),m=r(6),v=r.n(m),g=r(9),y=r.n(g),_=r(5),b=r.n(_),x=r(8),w=r(42),M=r(115),A=r(103),E=r(164),S=r(180),T=r(276),C=r(54),O=r(10);function P(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return L(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?L(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var I=function(t){v()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b()(t);if(e){var i=b()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return y()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u()(this,r),(n=e.call(this,t,i)).width=null,n.height=null,n.attachments={},n.readBuffer=36064,n.drawBuffers=[36064],n.ownResources=[],n.initialize(i),Object.seal(f()(n)),n}return c()(r,[{key:"MAX_COLOR_ATTACHMENTS",get:function(){var t=Object(x.a)(this.gl);return t.getParameter(t.MAX_COLOR_ATTACHMENTS)}},{key:"MAX_DRAW_BUFFERS",get:function(){var t=Object(x.a)(this.gl);return t.getParameter(t.MAX_DRAW_BUFFERS)}},{key:"color",get:function(){return this.attachments[36064]||null}},{key:"texture",get:function(){return this.attachments[36064]||null}},{key:"depth",get:function(){return this.attachments[36096]||this.attachments[33306]||null}},{key:"stencil",get:function(){return this.attachments[36128]||this.attachments[33306]||null}},{key:"initialize",value:function(t){var e=t.width,r=void 0===e?1:e,n=t.height,i=void 0===n?1:n,a=t.attachments,o=void 0===a?null:a,s=t.color,u=void 0===s||s,l=t.depth,c=void 0===l||l,h=t.stencil,f=void 0!==h&&h,d=t.check,p=void 0===d||d,m=t.readBuffer,v=void 0===m?void 0:m,g=t.drawBuffers,y=void 0===g?void 0:g;if(Object(O.a)(r>=0&&i>=0,"Width and height need to be integers"),this.width=r,this.height=i,o)for(var _ in o){var b=o[_];(Array.isArray(b)?b[0]:b).resize({width:r,height:i})}else o=this._createDefaultAttachments(u,c,f,r,i);this.update({clearAttachments:!0,attachments:o,readBuffer:v,drawBuffers:y}),o&&p&&this.checkStatus()}},{key:"delete",value:function(){var t,e=P(this.ownResources);try{for(e.s();!(t=e.n()).done;)t.value.delete()}catch(t){e.e(t)}finally{e.f()}return p()(b()(r.prototype),"delete",this).call(this),this}},{key:"update",value:function(t){var e=t.attachments,r=t.readBuffer,n=t.drawBuffers,i=t.clearAttachments,a=t.resizeAttachments;this.attach(void 0===e?{}:e,{clearAttachments:void 0!==i&&i,resizeAttachments:void 0===a||a});var o=this.gl,s=o.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),o.bindFramebuffer(36160,s||null),this}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,r=t.height;if(null===this.handle)return Object(O.a)(void 0===e&&void 0===r),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;for(var n in void 0===e&&(e=this.gl.drawingBufferWidth),void 0===r&&(r=this.gl.drawingBufferHeight),e!==this.width&&r!==this.height&&x.k.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(e,"x").concat(r))(),this.attachments)this.attachments[n].resize({width:e,height:r});return this.width=e,this.height=r,this}},{key:"attach",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.clearAttachments,i=r.resizeAttachments,a=void 0===i||i,s={};void 0!==n&&n&&Object.keys(this.attachments).forEach((function(t){s[t]=null})),Object.assign(s,t);var u=this.gl.bindFramebuffer(36160,this.handle);for(var l in s){Object(O.a)(void 0!==l,"Misspelled framebuffer binding point?");var c=Number(l),h=s[c],f=h;if(f)if(f instanceof A.a)this._attachRenderbuffer({attachment:c,renderbuffer:f});else if(Array.isArray(h)){var d=o()(h,3),p=d[0],m=d[1],v=d[2];f=p,this._attachTexture({attachment:c,texture:p,layer:void 0===m?0:m,level:void 0===v?0:v})}else this._attachTexture({attachment:c,texture:f,layer:0,level:0});else this._unattach(c);a&&f&&f.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter((function(t){return!e.attachments[t]})).forEach((function(t){delete e.attachments[t]}))}},{key:"checkStatus",value:function(){var t=this.getStatus();if(36053!==t)throw new Error(function(t){return(I.STATUS||{})[t]||"Framebuffer error ".concat(t)}(t));return this}},{key:"getStatus",value:function(){var t=this.gl,e=t.bindFramebuffer(36160,this.handle),r=t.checkFramebufferStatus(36160);return t.bindFramebuffer(36160,e||null),r}},{key:"clear",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.color,n=e.depth,i=e.stencil,a=e.drawBuffers,o=void 0===a?[]:a,s=this.gl.bindFramebuffer(36160,this.handle);return(r||n||i)&&Object(E.a)(this.gl,{color:r,depth:n,stencil:i}),o.forEach((function(e,r){Object(E.b)(t.gl,{drawBuffer:r,value:e})})),this.gl.bindFramebuffer(36160,s||null),this}},{key:"readPixels",value:function(){return x.k.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}},{key:"readPixelsToBuffer",value:function(){return x.k.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}},{key:"copyToDataUrl",value:function(){return x.k.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}},{key:"copyToImage",value:function(){return x.k.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}},{key:"copyToTexture",value:function(){return x.k.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}},{key:"blit",value:function(){return x.k.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}},{key:"invalidate",value:function(t){var e=t.attachments,r=void 0===e?[]:e,n=t.x,i=void 0===n?0:n,a=t.y,o=void 0===a?0:a,s=t.width,u=t.height,l=Object(x.a)(this.gl),c=l.bindFramebuffer(36008,this.handle);return 0===i&&0===o&&void 0===s&&void 0===u?l.invalidateFramebuffer(36008,r):l.invalidateFramebuffer(36008,r,i,o,s,u),l.bindFramebuffer(36008,c),this}},{key:"getAttachmentParameter",value:function(t,e,r){var n=this._getAttachmentParameterFallback(e);return null===n&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,t,e),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=Object(C.a)(this.gl,n)),n}},{key:"getAttachmentParameters",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36064,r=arguments.length>1?arguments[1]:void 0,n={},i=P(arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;n[r?Object(C.a)(this.gl,a):a]=this.getAttachmentParameter(e,a,r)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"getParameters",value:function(){for(var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e={},r=0,n=Object.keys(this.attachments);r<n.length;r++){var i=Number(n[r]);e[t?Object(C.a)(this.gl,i):i]=this.getAttachmentParameters(i,t)}return e}},{key:"show",value:function(){return"undefined"!=typeof window&&window.open(Object(S.a)(this),"luma-debug-texture"),this}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(t>x.k.level||"undefined"==typeof window)return this;e=e||"Framebuffer ".concat(this.id);var r=Object(S.a)(this,{targetMaxHeight:100});return x.k.image({logLevel:t,message:e,image:r},e)(),this}},{key:"bind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target;return this.gl.bindFramebuffer(void 0===t?36160:t,this.handle),this}},{key:"unbind",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).target;return this.gl.bindFramebuffer(void 0===t?36160:t,null),this}},{key:"_createDefaultAttachments",value:function(t,e,r,n,a){var o,s=null;return t&&((s=s||{})[36064]=new M.a(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:a,mipmaps:!1,parameters:(o={},i()(o,10241,9729),i()(o,10240,9729),i()(o,10242,33071),i()(o,10243,33071),o)}),this.ownResources.push(s[36064])),e&&r?((s=s||{})[33306]=new A.a(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(s[33306])):e?((s=s||{})[36096]=new A.a(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:a}),this.ownResources.push(s[36096])):r&&Object(O.a)(!1),s}},{key:"_unattach",value:function(t){var e=this.attachments[t];e&&(e instanceof A.a?this.gl.framebufferRenderbuffer(36160,t,36161,null):this.gl.framebufferTexture2D(36160,t,3553,null,0),delete this.attachments[t])}},{key:"_attachRenderbuffer",value:function(t){var e=t.attachment,r=void 0===e?36064:e,n=t.renderbuffer;this.gl.framebufferRenderbuffer(36160,r,36161,n.handle),this.attachments[r]=n}},{key:"_attachTexture",value:function(t){var e=t.attachment,r=void 0===e?36064:e,n=t.texture,i=t.layer,a=t.level,o=this.gl;switch(o.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Object(x.a)(o).framebufferTextureLayer(36160,r,n.target,a,i);break;case 34067:var s=function(t){return t<34069?t+34069:t}(i);o.framebufferTexture2D(36160,r,s,n.handle,a);break;case 3553:o.framebufferTexture2D(36160,r,3553,n.handle,a);break;default:Object(O.a)(!1,"Illegal texture type")}o.bindTexture(n.target,null),this.attachments[r]=n}},{key:"_setReadBuffer",value:function(t){var e=Object(x.g)(this.gl);e?e.readBuffer(t):Object(O.a)(36064===t||1029===t,"Multiple render targets not supported"),this.readBuffer=t}},{key:"_setDrawBuffers",value:function(t){var e=this.gl,r=Object(x.a)(e);if(r)r.drawBuffers(t);else{var n=e.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(t):Object(O.a)(1===t.length&&(36064===t[0]||1029===t[0]),"Multiple render targets not supported")}this.drawBuffers=t}},{key:"_getAttachmentParameterFallback",value:function(t){var e=Object(T.a)(this.gl);switch(t){case 36052:return e.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return e.WEBGL2?null:8;case 33297:return e.WEBGL2?null:5125;case 33296:return e.WEBGL2||e.EXT_sRGB?null:9729;default:return null}}},{key:"_createHandle",value:function(){return this.gl.createFramebuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteFramebuffer(this.handle)}},{key:"_bindHandle",value:function(t){return this.gl.bindFramebuffer(36160,t)}}],[{key:"isSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.colorBufferHalfFloat,n=!0;return e.colorBufferFloat&&(n=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),n}},{key:"getDefaultFramebuffer",value:function(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new r(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}}]),r}(w.a);I.ATTACHMENT_PARAMETERS=[36049,36048,33296,33298,33299,33300,33301,33302,33303]},function(t,e,r){r.d(e,"a",(function(){return d}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s);function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(){}var f={onStart:h,onUpdate:h,onInterrupt:h,onEnd:h},d=function(){function t(e){o()(this,t),this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}return u()(t,[{key:"inProgress",get:function(){return this._inProgress}},{key:"start",value:function(t){this.cancel(),this.settings=c(c({},f),t),this._inProgress=!0,this.settings.onStart(this)}},{key:"end",value:function(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}},{key:"cancel",value:function(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}},{key:"update",value:function(){if(!this._inProgress)return!1;if(null===this._handle){var t=this.timeline,e=this.settings;this._handle=t.addChannel({delay:t.getTime(),duration:e.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}},{key:"_onUpdate",value:function(){}}]),t}()},function(t,e,r){function n(t,e,r){var n=e[0],i=e[1],a=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/a,t[1]=(r[1]*n+r[5]*i)/a,t}function i(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a||1;return t[0]=(r[0]*n+r[4]*i+r[8]*a)/o,t[1]=(r[1]*n+r[5]*i+r[9]*a)/o,t[2]=(r[2]*n+r[6]*i+r[10]*a)/o,t}function a(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2],t}function o(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*a,t[1]=r[1]*n+r[4]*i+r[7]*a,t[2]=r[2]*n+r[5]*i+r[8]*a,t[3]=e[3],t}r.d(e,"a",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"b",(function(){return a})),r.d(e,"d",(function(){return o}))},function(t,e,r){r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return i}));var n="vs",i="fs"},function(t,e,r){r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"c",(function(){return u}));var n=r(11),i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document},a=i.global||i.self||i.window||{},o="object"!==("undefined"==typeof process?"undefined":r.n(n)()(process))||"[object process]"!==String(process)||process.browser,s="function"==typeof importScripts,u="undefined"!=typeof window&&void 0!==window.orientation,l="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);l&&parseFloat(l[1])},function(t,e,r){r.d(e,"d",(function(){return u})),r.d(e,"a",(function(){return l})),r.d(e,"b",(function(){return c})),r.d(e,"c",(function(){return h}));var n=r(11),i=r.n(n),a=r(96);function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t){if(Object(a.b)(t))return Object(a.a)(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"===i()(t)&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function l(t,e,r){if(t.byteLength<(r=r||t.byteLength)||e.byteLength<r)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(e),a=0;a<n.length;++a)if(n[a]!==i[a])return!1;return!0}function c(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n,i=e.map((function(t){return t instanceof ArrayBuffer?new Uint8Array(t):t})),a=i.reduce((function(t,e){return t+e.byteLength}),0),s=new Uint8Array(a),u=0,l=o(i);try{for(l.s();!(n=l.n()).done;){var c=n.value;s.set(c,u),u+=c.byteLength}}catch(t){l.e(t)}finally{l.f()}return s.buffer}function h(t,e,r){var n=void 0!==r?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(n).buffer}},function(t,e,r){r.d(e,"a",(function(){return A})),r.d(e,"b",(function(){return S}));var n=r(0),i=r.n(n),a=r(11),o=r.n(a),s=r(15),u=r.n(s),l=r(7),c=r.n(l),h=r(2),f=r.n(h),d=r(21),p=r(84),m=r(52),v=r(71),g=r(105),y=r(23);function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function x(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return w(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var M=/\.([^.]+)$/;function A(t){return E.apply(this,arguments)}function E(){return(E=c()(f.a.mark((function t(e){var r,n,i,a,o=arguments;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:[],n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,C(e)){t.next=5;break}return t.abrupt("return",null);case 5:if(!(a=S(e,r,b(b({},n),{},{nothrow:!0}),i))){t.next=8;break}return t.abrupt("return",a);case 8:if(!Object(y.b)(e)){t.next=13;break}return t.next=11,e.slice(0,10).arrayBuffer();case 11:a=S(e=t.sent,r,n,i);case 13:if(a||null!=n&&n.nothrow){t.next=15;break}throw new Error(O(e));case 15:return t.abrupt("return",a);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!C(t))return null;if(e&&!Array.isArray(e))return Object(m.b)(e);var i,a=[];e&&(a=a.concat(e)),null!=r&&r.ignoreRegisteredLoaders||(i=a).push.apply(i,u()(Object(g.b)())),P(a);var o=T(t,a,r,n);if(!(o||null!=r&&r.nothrow))throw new Error(O(t));return o}function T(t,e,r,n){var i=Object(v.b)(t),a=i.type,o=i.url||(null==n?void 0:n.url),s=null;return null!=r&&r.mimeType&&(s=L(e,null==r?void 0:r.mimeType)),(s=(s=(s=s||function(t,e){var r=e&&M.exec(e),n=r&&r[1];return n?function(t,e){e=e.toLowerCase();var r,n=x(t);try{for(n.s();!(r=n.n()).done;){var i,a=r.value,o=x(a.extensions);try{for(o.s();!(i=o.n()).done;)if(i.value.toLowerCase()===e)return a}catch(t){o.e(t)}finally{o.f()}}}catch(t){n.e(t)}finally{n.f()}return null}(t,n):null}(e,o))||L(e,a))||function(t,e){if(!e)return null;var r,n=x(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("string"==typeof e){if(I(e,i))return i}else if(ArrayBuffer.isView(e)){if(k(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer&&k(e,0,i))return i}}catch(t){n.e(t)}finally{n.f()}return null}(e,t))||L(e,null==r?void 0:r.fallbackMimeType)}function C(t){return!(t instanceof Response&&204===t.status)}function O(t){var e=Object(v.b)(t),r=e.url,n=e.type,i="No valid loader found (";i+=r?"".concat(d.b.filename(r),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");var a=t?function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?R(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?R(t,0,e):""}(t):"";return(i+=a?' first bytes: "'.concat(a,'"'):"first bytes: not available")+")"}function P(t){var e,r=x(t);try{for(r.s();!(e=r.n()).done;){var n=e.value;Object(m.b)(n)}}catch(t){r.e(t)}finally{r.f()}}function L(t,e){var r,n=x(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.mimeTypes&&i.mimeTypes.includes(e))return i;if(e==="application/x.".concat(i.id))return i}}catch(t){n.e(t)}finally{n.f()}return null}function I(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some((function(e){return t.startsWith(e)}))}function k(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((function(n){return function(t,e,r,n){if(n instanceof ArrayBuffer)return Object(p.a)(n,t,n.byteLength);switch(o()(n)){case"function":return n(t,r);case"string":return n===R(t,e,n.length);default:return!1}}(t,e,r,n)}))}function R(t,e,r){if(t.byteLength<e+r)return"";for(var n=new DataView(t),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}},function(t,e,r){function n(t,e){if(t===e)return!0;if(Array.isArray(t)){var r=t.length;if(!e||e.length!==r)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return!1}function i(t){var e,r={};return function(i){for(var a in i)if(!n(i[a],r[a])){e=t(i),r=i;break}return e}}r.d(e,"a",(function(){return i}))},function(t,e,r){var n=r(12),i=r.n(n),a=r(0),o=r.n(a),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(17),f=r.n(h),d=r(18),p=r.n(d),m=r(6),v=r.n(m),g=r(9),y=r.n(g),_=r(5),b=r.n(_),x=r(45),w=r(27),M=r(29);function A(t,e){var r=M.n([],e,t);return M.k(r,r,1/r[3]),r}var E=r(20),S=r(28),T=r(24);function C(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var O=Math.PI,P=O/4,L=O/180,I=180/O;function k(t){var e=t.height,r=t.pitch,n=t.bearing,i=t.scale,a=t.center,o=void 0===a?null:a,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return E.p(s,s,[0,0,-t.altitude]),E.l(s,s,-r*L),E.n(s,s,n*L),E.o(s,s,[i/=e,i,i]),o&&E.p(s,s,T.k([],o)),s}function R(t){var e=t.width,r=t.height,n=t.fovy,i=void 0===n?D(1.5):n,a=t.altitude,o=t.pitch,s=void 0===o?0:o,u=t.nearZMultiplier,l=void 0===u?1:u,c=t.farZMultiplier,h=void 0===c?1:c;void 0!==a&&(i=D(a));var f=.5*i*L,d=function(t){return.5/Math.tan(.5*t*L)}(i),p=s*L,m=Math.sin(f)*d/Math.sin(Math.min(Math.max(Math.PI/2-p-f,.01),Math.PI-.01)),v=Math.sin(p)*m+d;return{fov:2*f,aspect:e/r,focalDistance:d,near:l,far:Math.min(v*h,10*d)}}function D(t){return 2*Math.atan(.5/t)*I}var B=r(90);function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function j(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach((function(e){o()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return z}));var N=Math.PI/180;function U(t){return 512/4003e4/Math.cos(t*N)}var z=function(t){v()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=b()(t);if(e){var i=b()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return y()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u()(this,r);var i,a=n.latitude,o=void 0===a?0:a,s=n.longitude,l=void 0===s?0:s,c=n.zoom,h=void 0===c?11:c,d=n.pitch,p=void 0===d?0:d,m=n.bearing,v=void 0===m?0:m,g=n.nearZMultiplier,y=void 0===g?.1:g,_=n.farZMultiplier,b=void 0===_?1.01:_,x=n.orthographic,M=void 0!==x&&x,A=n.projectionMatrix,E=n.repeat,S=void 0!==E&&E,T=n.worldOffset,C=void 0===T?0:T,O=n.legacyMeterSizes,P=void 0!==O&&O,L=n.width,I=n.height,D=n.altitude,F=void 0===D?1.5:D,N=Math.pow(2,h);L=L||1,I=I||1;var U=null;A?(F=A[5]/2,i=Object(w.b)(F)):(n.fovy?(i=n.fovy,F=Object(w.e)(i)):i=Object(w.b)(F),U=R({width:L,height:I,pitch:p,fovy:i,nearZMultiplier:y,farZMultiplier:b}));var z=k({height:I,pitch:p,bearing:v,scale:N,altitude:F});return C&&(z=(new B.a).translate([512*C,0,0]).multiplyLeft(z)),(t=e.call(this,j(j(j({},n),{},{width:L,height:I,viewMatrix:z,longitude:l,latitude:o,zoom:h},U),{},{fovy:i,focalDistance:F}))).latitude=o,t.longitude=l,t.zoom=h,t.pitch=p,t.bearing=v,t.altitude=F,t.fovy=i,t.orthographic=M,t._subViewports=S?[]:null,t._pseudoMeters=P,Object.freeze(f()(t)),t}return c()(r,[{key:"subViewports",get:function(){if(this._subViewports&&!this._subViewports.length)for(var t=this.getBounds(),e=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360),i=e;i<=n;i++){var a=i?new r(j(j({},this),{},{worldOffset:i})):this;this._subViewports.push(a)}return this._subViewports}},{key:"projectPosition",value:function(t){if(this._pseudoMeters)return p()(b()(r.prototype),"projectPosition",this).call(this,t);var e=this.projectFlat(t),n=i()(e,2);return[n[0],n[1],(t[2]||0)*U(t[1])]}},{key:"unprojectPosition",value:function(t){if(this._pseudoMeters)return p()(b()(r.prototype),"unprojectPosition",this).call(this,t);var e=this.unprojectFlat(t),n=i()(e,2),a=n[1];return[n[0],a,(t[2]||0)/U(a)]}},{key:"addMetersToLngLat",value:function(t,e){return function(t,e){var r=i()(t,3),n=r[0],a=r[1],o=r[2],s=i()(e,3),u=s[0],l=s[1],c=s[2],h=function(t){var e=t.latitude,r=t.longitude,n=t.highPrecision,i=void 0!==n&&n;C(Number.isFinite(e)&&Number.isFinite(r));var a={},o=Math.cos(e*L),s=512/360/o,u=512/4003e4/o;if(a.unitsPerMeter=[u,u,u],a.metersPerUnit=[1/u,1/u,1/u],a.unitsPerDegree=[512/360,s,u],a.degreesPerUnit=[.703125,1/s,1/u],i){var l=L*Math.tan(e*L)/o,c=512/4003e4*l,h=c/s*u;a.unitsPerDegree2=[0,512/360*l/2,c],a.unitsPerMeter2=[h,0,h]}return a}({longitude:n,latitude:a,highPrecision:!0}),f=h.unitsPerMeter,d=h.unitsPerMeter2,p=function(t){var e=i()(t,2),r=e[0],n=e[1];return C(Number.isFinite(r)),C(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude"),[512*(r*L+O)/(2*O),512*(O+Math.log(Math.tan(P+n*L*.5)))/(2*O)]}(t);p[0]+=u*(f[0]+d[0]*l),p[1]+=l*(f[1]+d[1]*l);var m=function(t){var e=i()(t,2),r=e[0]/512*(2*O)-O,n=2*(Math.atan(Math.exp(e[1]/512*(2*O)-O))-P);return[r*I,n*I]}(p),v=(o||0)+(c||0);return Number.isFinite(o)||Number.isFinite(c)?[m[0],m[1],v]:m}(t,e)}},{key:"panByPosition",value:function(t,e){var r=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=i()(t,3),a=n[0],o=n[1],s=n[2];if(C(Number.isFinite(a)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(s))return A(e,[a,o,s,1]);var u=A(e,[a,o,0,1]),l=A(e,[a,o,1,1]),c=u[2],h=l[2];return S.c([],u,l,c===h?0:((r||0)-c)/(h-c))}(e,this.pixelUnprojectionMatrix),n=this.projectFlat(t),a=S.a([],n,S.d([],r)),o=S.a([],this.center,a),s=this.unprojectFlat(o),u=i()(s,2);return{longitude:u[0],latitude:u[1]}}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object(w.f)(this,t.z||0);return[Math.min(e[0][0],e[1][0],e[2][0],e[3][0]),Math.min(e[0][1],e[1][1],e[2][1],e[3][1]),Math.max(e[0][0],e[1][0],e[2][0],e[3][0]),Math.max(e[0][1],e[1][1],e[2][1],e[3][1])]}},{key:"fitBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,a=Object(w.c)(j({width:n,height:i,bounds:t},e));return new r({width:n,height:i,longitude:a.longitude,latitude:a.latitude,zoom:a.zoom})}}]),r}(x.a);z.displayName="WebMercatorViewport"},function(t,e,r){r.d(e,"c",(function(){return c})),r.d(e,"a",(function(){return h})),r.d(e,"b",(function(){return f}));var n,i=r(12),a=r.n(i),o=r(0),s=r.n(o),u=r(10),l=(n={},s()(n,5126,[5126,1,"float"]),s()(n,35664,[5126,2,"vec2"]),s()(n,35665,[5126,3,"vec3"]),s()(n,35666,[5126,4,"vec4"]),s()(n,5124,[5124,1,"int"]),s()(n,35667,[5124,2,"ivec2"]),s()(n,35668,[5124,3,"ivec3"]),s()(n,35669,[5124,4,"ivec4"]),s()(n,5125,[5125,1,"uint"]),s()(n,36294,[5125,2,"uvec2"]),s()(n,36295,[5125,3,"uvec3"]),s()(n,36296,[5125,4,"uvec4"]),s()(n,35670,[5126,1,"bool"]),s()(n,35671,[5126,2,"bvec2"]),s()(n,35672,[5126,3,"bvec3"]),s()(n,35673,[5126,4,"bvec4"]),s()(n,35674,[5126,8,"mat2"]),s()(n,35685,[5126,8,"mat2x3"]),s()(n,35686,[5126,8,"mat2x4"]),s()(n,35675,[5126,12,"mat3"]),s()(n,35687,[5126,12,"mat3x2"]),s()(n,35688,[5126,12,"mat3x4"]),s()(n,35676,[5126,16,"mat4"]),s()(n,35689,[5126,16,"mat4x2"]),s()(n,35690,[5126,16,"mat4x3"]),n);function c(t){switch(t){case 0:return 0;case 1:case 3:case 2:return 1;case 4:case 5:case 6:return 4;default:return Object(u.a)(!1),0}}function h(t){var e=l[t];if(!e)return null;var r=a()(e,2);return{type:r[0],components:r[1]}}function f(t,e){switch(t){case 5120:case 5121:case 5122:case 5123:t=5126}for(var r in l){var n=a()(l[r],3);if(n[0]===t&&n[1]===e)return{glType:r,name:n[2]}}return null}},function(t,e,r){r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return c})),r.d(e,"c",(function(){return h})),r.d(e,"d",(function(){return f})),r.d(e,"e",(function(){return d}));var n,i,a,o=r(0),s=r.n(o),u=r(8),l=(n={},s()(n,6407,{dataFormat:6407,types:[5121,33635]}),s()(n,6408,{dataFormat:6408,types:[5121,32819,32820]}),s()(n,6406,{dataFormat:6406,types:[5121]}),s()(n,6409,{dataFormat:6409,types:[5121]}),s()(n,6410,{dataFormat:6410,types:[5121]}),s()(n,33326,{dataFormat:6403,types:[5126],gl2:!0}),s()(n,33328,{dataFormat:33319,types:[5126],gl2:!0}),s()(n,34837,{dataFormat:6407,types:[5126],gl2:!0}),s()(n,34836,{dataFormat:6408,types:[5126],gl2:!0}),n),c=(i={},s()(i,6403,1),s()(i,36244,1),s()(i,33319,2),s()(i,33320,2),s()(i,6407,3),s()(i,36248,3),s()(i,6408,4),s()(i,36249,4),s()(i,6402,1),s()(i,34041,1),s()(i,6406,1),s()(i,6409,1),s()(i,6410,2),i),h=(a={},s()(a,5126,4),s()(a,5125,4),s()(a,5124,4),s()(a,5123,2),s()(a,5122,2),s()(a,5131,2),s()(a,5120,1),s()(a,5121,1),a);function f(t,e){var r=l[e];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;var n=Object(u.j)(t)&&r.gl2||r.gl1;return"string"==typeof n?t.getExtension(n):n}function d(t,e){var r=l[e];switch(r&&r.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}},function(t,e,r){r.d(e,"a",(function(){return S}));var n=r(156),i=r.n(n),a=r(43),o=r.n(a),s=r(44),u=r.n(s),l=r(49),c=r.n(l),h=r(50),f=r.n(h),d=r(34),p=r.n(d),m=r(25),v=r(157),g=r(81),y=r(20),_=r(28),b=r(24),x=r(29),w=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),M=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),A=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),E={},S=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n;return o()(this,r),n=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return u()(r,[{key:"INDICES",get:function(){return A}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this[9]=l,this[10]=c,this[11]=h,this[12]=f,this[13]=d,this[14]=p,this[15]=m,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u,l,c,h,f,d,p,m){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=a,this[6]=l,this[7]=d,this[8]=r,this[9]=o,this[10]=c,this[11]=p,this[12]=n,this[13]=s,this[14]=h,this[15]=m,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(w)}},{key:"fromQuaternion",value:function(t){return y.c(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,n=t.right,i=t.bottom,a=t.top,o=t.near,s=t.far;return s===1/0?r._computeInfinitePerspectiveOffCenter(this,e,n,i,a,o):y.d(this,e,n,i,a,o,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return y.g(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.near,r=t.far;return y.i(this,t.left,t.right,t.bottom,t.top,void 0===e?.1:e,void 0===r?500:r),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,n=void 0===e?45*Math.PI/180:e,i=t.aspect,a=void 0===i?1:i,o=t.focalDistance,s=void 0===o?1:o,u=t.near,l=void 0===u?.1:u,c=t.far,h=void 0===c?500:c;if(n>2*Math.PI)throw Error("radians");var f=s*Math.tan(n/2),d=f*a;return(new r).ortho({left:-d,right:d,bottom:-f,top:f,near:l,far:h})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=void 0===e?void 0:e,n=t.fov,i=void 0===n?45*Math.PI/180:n,a=t.aspect,o=void 0===a?1:a,s=t.near,u=void 0===s?.1:s,l=t.far,c=void 0===l?500:l;if((r=r||i)>2*Math.PI)throw Error("radians");return y.j(this,r,o,u,c),this.check()}},{key:"determinant",value:function(){return y.a(this)}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=this.getScale((arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||[-0,-0,-0]),r=1/e[0],n=1/e[1],i=1/e[2];return t[0]=this[0]*r,t[1]=this[1]*n,t[2]=this[2]*i,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*n,t[6]=this[6]*i,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*n,t[10]=this[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=this.getScale((arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||[-0,-0,-0]),r=1/e[0],n=1/e[1],i=1/e[2];return t[0]=this[0]*r,t[1]=this[1]*n,t[2]=this[2]*i,t[3]=this[4]*r,t[4]=this[5]*n,t[5]=this[6]*i,t[6]=this[8]*r,t[7]=this[9]*n,t[8]=this[10]*i,t}},{key:"transpose",value:function(){return y.q(this,this),this.check()}},{key:"invert",value:function(){return y.f(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return y.h(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return y.h(this,this,t),this.check()}},{key:"rotateX",value:function(t){return y.l(this,this,t),this.check()}},{key:"rotateY",value:function(t){return y.m(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return y.n(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=i()(t,3),r=e[1],n=e[2];return this.rotateX(e[0]).rotateY(r).rotateZ(n)}},{key:"rotateAxis",value:function(t,e){return y.k(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?y.o(this,this,t):y.o(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return y.p(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(e=x.n(e||[-0,-0,-0,-0],t,this),Object(m.b)(e,4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=_.j(e||[-0,-0],t,this);break;case 3:e=b.s(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(m.b)(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=Object(g.a)(e||[-0,-0],t,this);break;case 3:e=Object(g.c)(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(m.b)(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return Object(m.c)("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return Object(m.c)("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return Object(m.c)("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"IDENTITY",get:function(){return E.IDENTITY=E.IDENTITY||Object.freeze(new r(w)),E.IDENTITY}},{key:"ZERO",get:function(){return E.ZERO=E.ZERO||Object.freeze(new r(M)),E.ZERO}},{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,a){var o=2*a/(i-n),s=(r+e)/(r-e),u=(i+n)/(i-n),l=-2*a;return t[0]=2*a/(r-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=s,t[9]=u,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=l,t[15]=0,t}}]),r}(v.a)},function(t,e,r){r.d(e,"e",(function(){return a})),r.d(e,"f",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return u})),r.d(e,"c",(function(){return l})),r.d(e,"d",(function(){return c}));var n=r(11),i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document},a=i.self||i.window||i.global||{},o=i.window||i.self||i.global||{},s=i.global||i.self||i.window||{},u=i.document||{},l=Boolean("object"!==("undefined"==typeof process?"undefined":r.n(n)()(process))||"[object process]"!==String(process)||process.browser),c="function"==typeof importScripts,h="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);h&&parseFloat(h[1])},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(4);function u(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){var e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var l=function(){function t(e,r){i()(this,t),Object(s.a)(this,"name",void 0),Object(s.a)(this,"type",void 0),Object(s.a)(this,"sampleSize",1),Object(s.a)(this,"time",void 0),Object(s.a)(this,"count",void 0),Object(s.a)(this,"samples",void 0),Object(s.a)(this,"lastTiming",void 0),Object(s.a)(this,"lastSampleTime",void 0),Object(s.a)(this,"lastSampleCount",void 0),Object(s.a)(this,"_count",0),Object(s.a)(this,"_time",0),Object(s.a)(this,"_samples",0),Object(s.a)(this,"_startTime",0),Object(s.a)(this,"_timerPending",!1),this.name=e,this.type=r,this.reset()}return o()(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=u(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(u()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),c=function(){function t(e){i()(this,t),Object(s.a)(this,"id",void 0),Object(s.a)(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}return o()(t,[{key:"get",value:function(t){return this._getOrCreate({name:t,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name;return this.stats[e]||(this.stats[e]=t instanceof l?t:new l(e,t.type)),this.stats[e]}}]),t}();r.d(e,"a",(function(){return c}))},function(t,e,r){r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return h}));var n=r(15),i=r.n(n),a=r(0),o=r.n(a),s=r(46);function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){o()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(r)return r;var n=l({fetch:Object(s.a)(e,t)},t);return Array.isArray(n.loaders)||(n.loaders=null),n}function h(t,e){if(!e&&t&&!Array.isArray(t))return t;var r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){var n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[].concat(i()(r),i()(n)):n}return r&&r.length?r:null}},,function(t,e,r){r.d(e,"c",(function(){return a})),r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return s}));var n="",i={};function a(t){n=t}function o(){return n}function s(t){for(var e in i)t.startsWith(e)&&(t=t.replace(e,i[e]));return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(n).concat(t)),t}},function(t,e,r){r.d(e,"b",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"a",(function(){return u}));var n=r(11),i=r.n(n),a=r(177);function o(t){return t&&"object"===i()(t)&&t.isBuffer}function s(t){return a.toBuffer?a.toBuffer(t):t}function u(t){return o(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}},function(t,e,r){r.d(e,"a",(function(){return h}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(73),u=[255,255,255],l=[0,0,-1],c=0,h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r=e.color,n=void 0===r?u:r,a=e.intensity,o=void 0===a?1:a,h=e.direction,f=void 0===h?l:h,d=e._shadow,p=void 0!==d&&d;this.id=e.id||"directional-".concat(c++),this.color=n,this.intensity=o,this.type="directional",this.direction=new s.a(f).normalize().toArray(),this.shadow=p}return o()(t,[{key:"getProjectedLight",value:function(){return this}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return l}));var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(95),u=r(102);function l(t,e){return c.apply(this,arguments)}function c(){return(c=i()(o.a.mark((function t(e,r){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=7;break}return e=Object(s.b)(e),n=r,null!=r&&r.fetch&&"function"!=typeof(null==r?void 0:r.fetch)&&(n=r.fetch),t.next=6,fetch(e,n);case 6:case 9:return t.abrupt("return",t.sent);case 7:return t.next=9,Object(u.b)(e);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},function(t,e,r){var n="#define SMOOTH_EDGE_RADIUS 0.5",i={name:"geometry",vs:"\n".concat(n,"\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n"),fs:"\n".concat(n,"\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n")},a=r(16),o=Object.keys(a.a).map((function(t){return"const int COORDINATE_SYSTEM_".concat(t," = ").concat(a.a[t],";")})).join(""),s=Object.keys(a.d).map((function(t){return"const int PROJECTION_MODE_".concat(t," = ").concat(a.d[t],";")})).join(""),u=Object.keys(a.e).map((function(t){return"const int UNIT_".concat(t.toUpperCase()," = ").concat(a.e[t],";")})).join(""),l="".concat(o,"\n").concat(s,"\n").concat(u,"\n\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\n\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size() {\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\n    project_uPseudoMeters == false) {\n    \n    if (geometry.position.w == 0.0) {\n      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);\n      return 1.0 / cos(radians(y));\n    }\n  \n    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\n    float y2 = y * y;\n    float y4 = y2 * y2;\n    float y6 = y4 * y2;\n    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n  }\n  return 1.0;\n}\nfloat project_size(float meters) {\n  return meters * project_uCommonUnitsPerMeter.z * project_size();\n}\n\nvec2 project_size(vec2 meters) {\n  return meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\n\nvec3 project_size(vec3 meters) {\n  return meters * project_uCommonUnitsPerMeter * project_size();\n}\n\nvec4 project_size(vec4 meters) {\n  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\n  vec3 uz = normalize(up);\n  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\n  vec3 uy = cross(uz, ux);\n  return mat3(ux, uy, uz);\n}\n\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    transform = project_get_orientation_matrix(commonPosition);\n    return true;\n  }\n  return false;\n}\nvec3 project_normal(vec3 vector) {\n  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\n  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\n  mat3 rotation;\n  if (project_needs_rotation(geometry.position.xyz, rotation)) {\n    n = rotation * n;\n  }\n  return n;\n}\n\nvec4 project_offset_(vec4 offset) {\n  float dy = offset.y;\n  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\n  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\n  float x = lnglat.x;\n  if (project_uWrapLongitude) {\n    x = mod(x + 180., 360.0) - 180.;\n  }\n  float y = clamp(lnglat.y, -89.9, 89.9);\n  return vec2(\n    radians(x) + PI,\n    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n  ) * WORLD_SCALE;\n}\n\nvec3 project_globe_(vec3 lnglatz) {\n  float lambda = radians(lnglatz.x);\n  float phi = radians(lnglatz.y);\n  float cosPhi = cos(phi);\n  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\n\n  return vec3(\n    sin(lambda) * cosPhi,\n    -cos(lambda) * cosPhi,\n    sin(phi)\n  ) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\n  vec4 position_world = project_uModelMatrix * position;\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_mercator_(position_world.xy),\n        project_size(position_world.z),\n        position_world.w\n      );\n    }\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\n      position_world.xyz += project_uCoordinateOrigin;\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      return vec4(\n        project_globe_(position_world.xyz),\n        position_world.w\n      );\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\n    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\n        return vec4(\n          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,\n          project_size(position_world.z),\n          position_world.w\n        );\n      }\n    }\n  }\n  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\n    position_world.xyz -= project_uCoordinateOrigin;\n  }\n  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_LOW);\n}\n\nvec3 project_position(vec3 position, vec3 position64Low) {\n  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);\n  return projected_position.xyz;\n}\n\nvec3 project_position(vec3 position) {\n  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\n  return projected_position.xyz;\n}\n\nvec2 project_position(vec2 position) {\n  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\n  return projected_position.xy;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  return viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\n  return offset * project_uFocalDistance;\n}\n\nfloat project_size_to_pixel(float meters) {\n  return project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\n  if (unit == UNIT_METERS) return project_size_to_pixel(size);\n  if (unit == UNIT_COMMON) return size * project_uScale;\n  return size;\n}\nfloat project_pixel_size(float pixels) {\n  return pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\n  return pixels / project_uScale;\n}\n"),c=r(111),h={};e.a={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 1.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 1.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null},i],vs:l,getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h;return t.viewport?Object(c.b)(t):{}}}},function(t,e,r){var n=r(11),i=r.n(n),a=r(7),o=r.n(a),s=r(2),u=r.n(s),l=r(59),c=r(138);function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.a;return Object(l.a)(t,"no worker provided"),!(!e||!t.version)}var f=r(174),d=r(52),p=r(46),m=r(113),v=r(93),g=r(71),y=r(85);function _(t,e,r,n){return b.apply(this,arguments)}function b(){return(b=o()(u.a.mark((function t(e,r,n,a){var o,s,c,h,f;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object(l.a)(!a||"object"===i()(a)),!r||Array.isArray(r)||Object(d.a)(r)||(a=void 0,n=r,r=void 0),t.next=4,e;case 4:return e=t.sent,n=n||{},o=Object(g.b)(e),s=o.url,c=r,h=Object(v.b)(c,a),t.next=11,Object(y.a)(e,h,n);case 11:if(f=t.sent){t.next=14;break}return t.abrupt("return",null);case 14:return n=Object(p.c)(n,f,h,s),a=Object(v.a)({url:s,parse:_,loaders:h},n,a),t.next=18,x(f,e,n,a);case 18:return t.abrupt("return",t.sent);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t,e,r,n){return w.apply(this,arguments)}function w(){return(w=o()(u.a.mark((function t(e,r,n,i){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h(e),t.next=3,Object(m.a)(r,e,n);case 3:if(r=t.sent,!e.parseTextSync||"string"!=typeof r){t.next=7;break}return n.dataType="text",t.abrupt("return",e.parseTextSync(r,n,i,e));case 7:if(!Object(f.a)(e,n)){t.next=11;break}return t.next=10,Object(f.b)(e,r,n,i,_);case 10:case 14:case 18:return t.abrupt("return",t.sent);case 11:if(!e.parseText||"string"!=typeof r){t.next=15;break}return t.next=14,e.parseText(r,n,i,e);case 15:if(!e.parse){t.next=19;break}return t.next=18,e.parse(r,n,i,e);case 19:throw Object(l.a)(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r.d(e,"a",(function(){return _}))},function(t,e,r){function n(t,e){if(!t)throw new Error(e||"loader assertion failed.")}r.d(e,"a",(function(){return n}))},function(t,e,r){r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return h}));var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(23),u=r(71);function l(t){return c.apply(this,arguments)}function c(){return(c=i()(o.a.mark((function t(e){var r,n,i,a,l,c,h;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(s.j)(e)){t.next=2;break}return t.abrupt("return",e);case 2:return r={},(n=Object(u.a)(e))>=0&&(r["content-length"]=String(n)),i=Object(u.b)(e),a=i.url,(l=i.type)&&(r["content-type"]=l),t.next=9,m(e);case 9:return(c=t.sent)&&(r["x-first-bytes"]=c),"string"==typeof e&&(e=(new TextEncoder).encode(e)),h=new Response(e,{headers:r}),Object.defineProperty(h,"url",{value:a}),t.abrupt("return",h);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t){return f.apply(this,arguments)}function f(){return(f=i()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=5;break}return t.next=3,d(e);case 3:throw new Error(t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(t){return p.apply(this,arguments)}function p(){return(p=i()(o.a.mark((function t(e){var r,n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): "),t.prev=1,n=e.headers.get("Content-Type"),i=e.statusText,!n.includes("application/json")){t.next=11;break}return t.t0=i,t.t1=" ",t.next=9,e.text();case 9:t.t2=t.sent,i=t.t0+=t.t1.concat.call(t.t1,t.t2);case 11:r=(r+=i).length>60?"".concat(r.slice(60),"..."):r,t.next=17;break;case 15:t.prev=15,t.t3=t.catch(1);case 17:return t.abrupt("return",r);case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function m(t){return v.apply(this,arguments)}function v(){return(v=i()(o.a.mark((function t(e){var r,n,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=5,"string"!=typeof e){t.next=3;break}return t.abrupt("return","data:,".concat(e.slice(0,r)));case 3:if(!(e instanceof Blob)){t.next=8;break}return n=e.slice(0,5),t.next=7,new Promise((function(t){var e=new FileReader;e.onload=function(e){var r;return t(null==e||null===(r=e.target)||void 0===r?void 0:r.result)},e.readAsDataURL(n)}));case 7:return t.abrupt("return",t.sent);case 8:if(!(e instanceof ArrayBuffer)){t.next=12;break}return i=e.slice(0,r),a=g(i),t.abrupt("return","data:base64,".concat(a));case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){for(var e="",r=new Uint8Array(t),n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}},function(t,e,r){var n,i=r(1),a=r.n(i),o=r(3),s=r.n(o),u=r(17),l=r.n(u),c=r(6),h=r.n(c),f=r(9),d=r.n(f),p=r(5),m=r.n(p),v=r(42),g=r(0),y=r.n(g),_="EXT_color_buffer_float",b=(n={},y()(n,33189,{bpp:2}),y()(n,33190,{gl2:!0,bpp:3}),y()(n,36012,{gl2:!0,bpp:4}),y()(n,36168,{bpp:1}),y()(n,34041,{bpp:4}),y()(n,35056,{gl2:!0,bpp:4}),y()(n,36013,{gl2:!0,bpp:5}),y()(n,32854,{bpp:2}),y()(n,36194,{bpp:2}),y()(n,32855,{bpp:2}),y()(n,33321,{gl2:!0,bpp:1}),y()(n,33330,{gl2:!0,bpp:1}),y()(n,33329,{gl2:!0,bpp:1}),y()(n,33332,{gl2:!0,bpp:2}),y()(n,33331,{gl2:!0,bpp:2}),y()(n,33334,{gl2:!0,bpp:4}),y()(n,33333,{gl2:!0,bpp:4}),y()(n,33323,{gl2:!0,bpp:2}),y()(n,33336,{gl2:!0,bpp:2}),y()(n,33335,{gl2:!0,bpp:2}),y()(n,33338,{gl2:!0,bpp:4}),y()(n,33337,{gl2:!0,bpp:4}),y()(n,33340,{gl2:!0,bpp:8}),y()(n,33339,{gl2:!0,bpp:8}),y()(n,32849,{gl2:!0,bpp:3}),y()(n,32856,{gl2:!0,bpp:4}),y()(n,32857,{gl2:!0,bpp:4}),y()(n,36220,{gl2:!0,bpp:4}),y()(n,36238,{gl2:!0,bpp:4}),y()(n,36975,{gl2:!0,bpp:4}),y()(n,36214,{gl2:!0,bpp:8}),y()(n,36232,{gl2:!0,bpp:8}),y()(n,36226,{gl2:!0,bpp:16}),y()(n,36208,{gl2:!0,bpp:16}),y()(n,33325,{gl2:_,bpp:2}),y()(n,33327,{gl2:_,bpp:4}),y()(n,34842,{gl2:_,bpp:8}),y()(n,33326,{gl2:_,bpp:4}),y()(n,33328,{gl2:_,bpp:8}),y()(n,34836,{gl2:_,bpp:16}),y()(n,35898,{gl2:_,bpp:4}),n),x=r(8),w=r(10);function M(t,e,r){var n=r[e];if(!n)return!1;var i=Object(x.j)(t)&&n.gl2||n.gl1;return"string"==typeof i?t.getExtension(i):i}r.d(e,"a",(function(){return A}));var A=function(t){h()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m()(t);if(e){var i=m()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a()(this,r),(n=e.call(this,t,i)).initialize(i),Object.seal(l()(n)),n}return s()(r,[{key:"initialize",value:function(t){var e=t.format,r=t.width,n=void 0===r?1:r,i=t.height,a=void 0===i?1:i,o=t.samples,s=void 0===o?0:o;return Object(w.a)(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),0!==s&&Object(x.j)(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,e,n,a):this.gl.renderbufferStorage(36161,e,n,a),this.format=e,this.width=n,this.height=a,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*b[this.format].bpp),this}},{key:"resize",value:function(t){var e=t.width,r=t.height;return e!==this.width||r!==this.height?this.initialize({width:e,height:r,format:this.format,samples:this.samples}):this}},{key:"_createHandle",value:function(){return this.gl.createRenderbuffer()}},{key:"_deleteHandle",value:function(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}},{key:"_bindHandle",value:function(t){this.gl.bindRenderbuffer(36161,t)}},{key:"_syncHandle",value:function(t){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}},{key:"_getParameter",value:function(t){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,t)}}],[{key:"isSupported",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{format:null}).format;return!e||M(t,e,b)}},{key:"getSamplesForFormat",value:function(t,e){return t.getInternalformatParameter(36161,e.format,32937)}}]),r}(v.a)},function(t,e,r){var n=r(267),i=r(268),a=r(269),o=r(270);t.exports=function(t){return n(t)||i(t)||a(t)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){r.d(e,"c",(function(){return u})),r.d(e,"b",(function(){return l})),r.d(e,"a",(function(){return c}));var n=r(52),i=r(46);function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw a}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var s=function(){var t=Object(i.b)();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function u(t){var e,r=s(),i=a(t=Array.isArray(t)?t:[t]);try{var o=function(){var t=e.value,i=Object(n.b)(t);r.find((function(t){return i===t}))||r.unshift(i)};for(i.s();!(e=i.n()).done;)o()}catch(t){i.e(t)}finally{i.f()}}function l(){return s()}function c(){Object(i.b)().loaderRegistry=[]}},function(t,e,r){r.d(e,"a",(function(){return S})),r.d(e,"b",(function(){return T}));var n=r(18),i=r.n(n),a=r(0),o=r.n(a),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(14),y=r(66),_=r(112),b=r(27),x=r(40);function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function M(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){o()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function A(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}var E={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60,position:[0,0,0]},S=function(t){f()(r,t);var e=A(r);function r(t){var n;u()(this,r);var i=(t=M(M({},E),t))||{},a=i.makeViewport,o=i.width,s=i.height,l=i.latitude,c=i.longitude,h=i.zoom,f=i.bearing,d=i.pitch,p=i.altitude,m=i.position,v=i.maxZoom,g=i.minZoom,y=i.maxPitch,_=i.minPitch,b=i.startPanLngLat,w=i.startZoomLngLat,A=i.startRotatePos,S=i.startBearing,T=i.startPitch,C=i.startZoom,O=i.normalize;return Object(x.a)(Number.isFinite(c)),Object(x.a)(Number.isFinite(l)),Object(x.a)(Number.isFinite(h)),(n=e.call(this,{width:o,height:s,latitude:l,longitude:c,zoom:h,bearing:f,pitch:d,altitude:p,maxZoom:v,minZoom:g,maxPitch:y,minPitch:_,normalize:O,position:m}))._state={startPanLngLat:b,startZoomLngLat:w,startRotatePos:A,startBearing:S,startPitch:T,startZoom:C},n.makeViewport=a,n}return c()(r,[{key:"panStart",value:function(t){return this._getUpdatedState({startPanLngLat:this._unproject(t.pos)})}},{key:"pan",value:function(t){var e=t.pos,r=this._state.startPanLngLat||this._unproject(t.startPos);if(!r)return this;var n=this.makeViewport(this._viewportProps).panByPosition(r,e);return this._getUpdatedState(n)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){return this._getUpdatedState({startRotatePos:t.pos,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var e,r=t.pos,n=t.deltaAngleX,i=void 0===n?0:n,a=t.deltaAngleY,o=void 0===a?0:a,s=this._state,u=s.startRotatePos,l=s.startBearing,c=s.startPitch;return u&&Number.isFinite(l)&&Number.isFinite(c)?(e=r?this._calculateNewPitchAndBearing(M(M({},this._getRotationParams(r,u)),{},{startBearing:l,startPitch:c})):{bearing:l+i,pitch:c+o},this._getUpdatedState(e)):this}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){return this._getUpdatedState({startZoomLngLat:this._unproject(t.pos),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,r=t.startPos,n=t.scale,i=this._state,a=i.startZoom,o=i.startZoomLngLat;Number.isFinite(a)||(a=this._viewportProps.zoom,o=this._unproject(r)||this._unproject(e));var s=this._calculateNewZoom({scale:n,startZoom:a}),u=this.makeViewport(M(M({},this._viewportProps),{},{zoom:s}));return this._getUpdatedState(M({zoom:s},u.panByPosition(o,e)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._zoomFromCenter(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)}},{key:"zoomOut",value:function(){return this._zoomFromCenter(1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2))}},{key:"moveLeft",value:function(){return this._panFromCenter([arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,0])}},{key:"moveRight",value:function(){return this._panFromCenter([-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100),0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:100])}},{key:"moveDown",value:function(){return this._panFromCenter([0,-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:100)])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateRight",value:function(){return this._getUpdatedState({bearing:this._viewportProps.bearing+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateUp",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"rotateDown",value:function(){return this._getUpdatedState({pitch:this._viewportProps.pitch-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),r=M({},this._viewportProps),n=r.bearing,i=r.longitude;return Math.abs(n-e.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(i-e.longitude)>180&&(r.longitude=i<0?i+360:i-360),r}},{key:"_zoomFromCenter",value:function(t){var e=this._viewportProps;return this.zoom({pos:[e.width/2,e.height/2],scale:t})}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps,r=e.width,n=e.height;return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new this.constructor(M(M(M({makeViewport:this.makeViewport},this._viewportProps),this._state),t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,n=t.zoom;t.zoom=Object(g.a)(n,r,e);var i=t.maxPitch,a=t.minPitch,o=t.pitch;t.pitch=Object(g.a)(o,a,i);var s=t.normalize;return(void 0===s||s)&&Object.assign(t,Object(b.k)(t)),t}},{key:"_unproject",value:function(t){var e=this.makeViewport(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewZoom",value:function(t){var e=this._viewportProps,r=e.maxZoom,n=e.minZoom,i=t.startZoom+Math.log2(t.scale);return Object(g.a)(i,n,r)}},{key:"_calculateNewPitchAndBearing",value:function(t){var e=t.deltaScaleX,r=t.deltaScaleY,n=t.startBearing,i=t.startPitch;r=Object(g.a)(r,-1,1);var a=this._viewportProps,o=i;return r>0?o=i+r*(a.maxPitch-i):r<0&&(o=i-r*(a.minPitch-i)),{pitch:o,bearing:n+180*e}}},{key:"_getRotationParams",value:function(t,e){var r=t[1]-e[1],n=t[1],i=e[1],a=this._viewportProps,o=a.height,s=(t[0]-e[0])/a.width,u=0;return r>0?Math.abs(o-i)>5&&(u=r/(i-o)*1.2):r<0&&i>5&&(u=1-n/i),{deltaScaleX:s,deltaScaleY:u=Math.min(1,Math.max(-1,u))}}}]),r}(_.a),T=function(t){f()(r,t);var e=A(r);function r(t){return u()(this,r),t.dragMode=t.dragMode||"pan",e.call(this,S,t)}return c()(r,[{key:"setProps",value:function(t){t.position=t.position||[0,0,0];var e=this.controllerStateProps;i()(v()(r.prototype),"setProps",this).call(this,t),(!e||e.height!==t.height)&&this.updateViewport(new this.ControllerState(M(M({makeViewport:this.makeViewport},this.controllerStateProps),this._state)))}},{key:"linearTransitionProps",get:function(){return["longitude","latitude","zoom","bearing","pitch","position"]}}]),r}(y.a)},function(t,e,r){r.d(e,"a",(function(){return h}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(14),u=r(40);function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t),Array.isArray(e)&&(e={compare:e,extract:e,required:e});var r=e.extract,n=e.required;this._propsToCompare=e.compare,this._propsToExtract=r,this._requiredProps=n}return o()(t,[{key:"arePropsEqual",value:function(t,e){var r,n=l(this._propsToCompare||Object.keys(e));try{for(n.s();!(r=n.n()).done;){var i=r.value;if(!(i in t&&i in e&&Object(s.d)(t[i],e[i])))return!1}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"initializeProps",value:function(t,e){var r;if(this._propsToExtract){var n,i={},a={},o=l(this._propsToExtract);try{for(o.s();!(n=o.n()).done;){var s=n.value;i[s]=t[s],a[s]=e[s]}}catch(t){o.e(t)}finally{o.f()}r={start:i,end:a}}else r={start:t,end:e};return this._checkRequiredProps(r.start),this._checkRequiredProps(r.end),r}},{key:"interpolateProps",value:function(t,e,r){return e}},{key:"getDuration",value:function(t,e){return e.transitionDuration}},{key:"_checkRequiredProps",value:function(t){this._requiredProps&&this._requiredProps.forEach((function(e){var r=t[e];Object(u.a)(Number.isFinite(r)||Array.isArray(r),"".concat(e," is required for transition"))}))}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return M})),r.d(e,"b",(function(){return A}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(14),v=r(66),g=r(112),y=r(39);function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}var w={rotationX:0,rotationOrbit:0,zoom:0,target:[0,0,0],minRotationX:-90,maxRotationX:90,minZoom:-1/0,maxZoom:1/0},M=function(t){c()(r,t);var e=x(r);function r(t){var n,i=t.makeViewport,a=t.width,s=t.height,u=t.rotationX,l=void 0===u?w.rotationX:u,c=t.rotationOrbit,h=void 0===c?w.rotationOrbit:c,f=t.target,d=void 0===f?w.target:f,p=t.zoom,m=void 0===p?w.zoom:p,v=t.minRotationX,g=void 0===v?w.minRotationX:v,y=t.maxRotationX,_=void 0===y?w.maxRotationX:y,b=t.minZoom,x=void 0===b?w.minZoom:b,M=t.maxZoom,A=void 0===M?w.maxZoom:M,E=t.startPanPosition,S=t.startRotatePos,T=t.startRotationX,C=t.startRotationOrbit,O=t.startZoomPosition,P=t.startZoom;return o()(this,r),(n=e.call(this,{width:a,height:s,rotationX:l,rotationOrbit:h,target:d,zoom:m,minRotationX:g,maxRotationX:_,minZoom:x,maxZoom:A}))._state={startPanPosition:E,startRotatePos:S,startRotationX:T,startRotationOrbit:C,startZoomPosition:O,startZoom:P},n.makeViewport=i,n}return u()(r,[{key:"panStart",value:function(t){return this._getUpdatedState({startPanPosition:this._unproject(t.pos)})}},{key:"pan",value:function(t){var e=t.pos,r=this._state.startPanPosition||t.startPosition;if(!r)return this;var n=this.makeViewport(this._viewportProps).panByPosition(r,e);return this._getUpdatedState(n)}},{key:"panEnd",value:function(){return this._getUpdatedState({startPanPosition:null})}},{key:"rotateStart",value:function(t){return this._getUpdatedState({startRotatePos:t.pos,startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}},{key:"rotate",value:function(t){var e,r=t.pos,n=t.deltaAngleX,i=void 0===n?0:n,a=t.deltaAngleY,o=void 0===a?0:a,s=this._state,u=s.startRotatePos,l=s.startRotationX,c=s.startRotationOrbit,h=this._viewportProps,f=h.width,d=h.height;if(!u||!Number.isFinite(l)||!Number.isFinite(c))return this;if(r){var p=(r[0]-u[0])/f;(l<-90||l>90)&&(p*=-1),e={rotationX:l+(r[1]-u[1])/d*180,rotationOrbit:c+180*p}}else e={rotationX:l+o,rotationOrbit:c+i};return this._getUpdatedState(e)}},{key:"rotateEnd",value:function(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}},{key:"shortestPathFrom",value:function(t){var e=t.getViewportProps(),r=b({},this._viewportProps),n=r.rotationOrbit;return Math.abs(n-e.rotationOrbit)>180&&(r.rotationOrbit=n<0?n+360:n-360),r}},{key:"zoomStart",value:function(t){return this._getUpdatedState({startZoomPosition:this._unproject(t.pos),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var e=t.pos,r=t.startPos,n=t.scale,i=this._viewportProps.zoom,a=this._state,o=a.startZoom,s=a.startZoomPosition;Number.isFinite(o)||(o=i,s=this._unproject(r)||this._unproject(e));var u=this._calculateNewZoom({scale:n,startZoom:o}),l=this.makeViewport(b(b({},this._viewportProps),{},{zoom:u}));return this._getUpdatedState(b({zoom:u},l.panByPosition(s,e)))}},{key:"zoomEnd",value:function(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}},{key:"zoomIn",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:arguments.length>0&&void 0!==arguments[0]?arguments[0]:2})})}},{key:"zoomOut",value:function(){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/(arguments.length>0&&void 0!==arguments[0]?arguments[0]:2)})})}},{key:"moveLeft",value:function(){return this._panFromCenter([-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:50),0])}},{key:"moveRight",value:function(){return this._panFromCenter([arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,0])}},{key:"moveUp",value:function(){return this._panFromCenter([0,-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:50)])}},{key:"moveDown",value:function(){return this._panFromCenter([0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:50])}},{key:"rotateLeft",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateRight",value:function(){return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:15)})}},{key:"rotateUp",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX-(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"rotateDown",value:function(){return this._getUpdatedState({rotationX:this._viewportProps.rotationX+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)})}},{key:"_unproject",value:function(t){var e=this.makeViewport(this._viewportProps);return t&&e.unproject(t)}},{key:"_calculateNewZoom",value:function(t){var e=t.scale,r=t.startZoom,n=this._viewportProps,i=n.maxZoom,a=n.minZoom;Number.isFinite(r)||(r=this._viewportProps.zoom);var o=r+Math.log2(e);return Object(m.a)(o,a,i)}},{key:"_panFromCenter",value:function(t){var e=this._viewportProps;return this.pan({startPosition:e.target,pos:[e.width/2+t[0],e.height/2+t[1]]})}},{key:"_getUpdatedState",value:function(t){return new this.constructor(b(b(b({},this._viewportProps),this._state),t))}},{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,n=t.zoom,i=t.maxRotationX,a=t.minRotationX,o=t.rotationOrbit;return t.zoom=Object(m.a)(n,r,e),t.rotationX=Object(m.a)(t.rotationX,a,i),(o<-180||o>180)&&(t.rotationOrbit=Object(y.e)(o+180,360)-180),t}}]),r}(g.a),A=function(t){c()(r,t);var e=x(r);function r(t){return o()(this,r),e.call(this,M,t)}return u()(r,[{key:"linearTransitionProps",get:function(){return["target","zoom","rotationX","rotationOrbit"]}}]),r}(v.a)},function(t,e,r){r.d(e,"a",(function(){return m}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(14),p=r(47),m=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){return i()(this,r),e.apply(this,arguments)}return o()(r,[{key:"ELEMENTS",get:function(){return Object(p.a)(!1),0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:Object(d.f)(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(d.b)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+Object(d.e)(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!Object(d.d)(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]+=a[o];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]-=a[o];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"elements",get:function(){return this}},{key:"check",value:function(){if(d.b.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}}]),r}(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array))},function(t,e,r){var n=r(15),i=r.n(n),a=r(12),o=r.n(a),s=r(16),u=r(99),l=r(90),c=r(73),h=r(86),f=r(27);function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var m=Object(h.a)((function(t){var e=t.center;return new l.a(t.viewport.viewProjectionMatrix).invert().transform(e)})),v=Object(h.a)((function(t){var e,r=t.viewport,n=t.shadowMatrices,a=[],s=r.pixelUnprojectionMatrix,u=r.isGeospatial?void 0:1,h=[[0,0,u],[r.width,0,u],[0,r.height,u],[r.width,r.height,u],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map((function(t){return function(t,e){var r=o()(t,3),n=r[0],i=r[1],a=r[2],s=Object(f.l)([n,i,a],e);return Number.isFinite(a)?s:[s[0],s[1],0]}(t,s)})),p=d(n);try{var m=function(){var t=e.value,n=t.clone().translate(new c.a(r.center).negate()),o=h.map((function(t){return n.transform(t)})),s=(new l.a).ortho({left:Math.min.apply(Math,i()(o.map((function(t){return t[0]})))),right:Math.max.apply(Math,i()(o.map((function(t){return t[0]})))),bottom:Math.min.apply(Math,i()(o.map((function(t){return t[1]})))),top:Math.max.apply(Math,i()(o.map((function(t){return t[1]})))),near:Math.min.apply(Math,i()(o.map((function(t){return-t[2]})))),far:Math.max.apply(Math,i()(o.map((function(t){return-t[2]}))))});a.push(s.multiplyRight(t))};for(p.s();!(e=p.n()).done;)m()}catch(t){p.e(t)}finally{p.f()}return a})),g=[0,0,0,1],y=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function _(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:!!t.shadowMaps&&t.shadowMaps.length>0,shadow_uColor:t.shadowColor||g,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},n=m({viewport:t.viewport,center:e.project_uCenter}),i=[],a=v({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice(),o=0;o<t.shadowMatrices.length;o++){var u=a[o],l=u.clone().translate(new c.a(t.viewport.center).negate());e.project_uCoordinateSystem===s.a.LNGLAT&&e.project_uProjectionMode===s.d.WEB_MERCATOR?(a[o]=l,i[o]=n):(a[o]=u.clone().multiplyRight(y),i[o]=l.transform(n))}for(var h=0;h<a.length;h++)r["shadow_uViewProjectionMatrices[".concat(h,"]")]=a[h],r["shadow_uProjectCenters[".concat(h,"]")]=i[h],r["shadow_uShadowMap".concat(h)]=t.shadowMaps&&t.shadowMaps.length>0?t.shadowMaps[h]:t.dummyShadowMap;return r}e.a={name:"shadow",dependencies:[u.a],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nvarying vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture2D(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){var e=t.shadowEnabled;return(void 0===e||e)&&t.shadowMatrices&&t.shadowMatrices.length>0?_(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}}},function(t,e,r){r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return p}));var n=r(20),i=r(29),a=r(16),o=r(86),s=[0,0,0,0],u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c=[0,0,0],h=[0,0,0],f=Object(o.a)((function(t){var e=t.viewport,r=t.devicePixelRatio,o=t.coordinateSystem,l=function(t,e,r){var a=t.viewMatrixUncentered,o=t.projectionMatrix,l=t.viewMatrix,c=t.viewProjectionMatrix,h=s,f=s,p=t.cameraPosition,m=d(t,e,r),v=m.geospatialOrigin,g=m.shaderCoordinateOrigin;return m.offsetMode&&(f=t.projectPosition(v||g),p=[p[0]-f[0],p[1]-f[1],p[2]-f[2]],f[3]=1,h=i.n([],f,c),c=n.h([],o,l=a||l),c=n.h([],c,u)),{viewMatrix:l,viewProjectionMatrix:c,projectionCenter:h,originCommon:f,cameraPosCommon:p,shaderCoordinateOrigin:g,geospatialOrigin:v}}(e,o,t.coordinateOrigin),h=l.projectionCenter,f=l.viewProjectionMatrix,p=l.originCommon,m=l.cameraPosCommon,v=l.shaderCoordinateOrigin,g=l.geospatialOrigin,y=e.getDistanceScales(),_=[e.width*r,e.height*r],b=i.n([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,x={project_uCoordinateSystem:o,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:v,project_uCommonOrigin:p.slice(0,3),project_uCenter:h,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:_,project_uDevicePixelRatio:r,project_uFocalDistance:b,project_uCommonUnitsPerMeter:y.unitsPerMeter,project_uCommonUnitsPerWorldUnit:y.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:c,project_uScale:e.scale,project_uViewProjectionMatrix:f,project_uCameraPosition:m};if(g){var w=e.getDistanceScales(g);switch(o){case a.a.METER_OFFSETS:x.project_uCommonUnitsPerWorldUnit=w.unitsPerMeter,x.project_uCommonUnitsPerWorldUnit2=w.unitsPerMeter2;break;case a.a.LNGLAT:case a.a.LNGLAT_OFFSETS:e._pseudoMeters||(x.project_uCommonUnitsPerMeter=w.unitsPerMeter),x.project_uCommonUnitsPerWorldUnit=w.unitsPerDegree,x.project_uCommonUnitsPerWorldUnit2=w.unitsPerDegree2;break;case a.a.CARTESIAN:x.project_uCommonUnitsPerWorldUnit=[1,1,w.unitsPerMeter[2]],x.project_uCommonUnitsPerWorldUnit2=[0,0,w.unitsPerMeter2[2]]}}return x}));function d(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h;r.length<3&&(r=[r[0],r[1],0]);var n,i=r,o=!0;switch(n=e===a.a.LNGLAT_OFFSETS||e===a.a.METER_OFFSETS?r:t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case a.d.WEB_MERCATOR:e!==a.a.LNGLAT&&e!==a.a.CARTESIAN||(n=[0,0,0],o=!1);break;case a.d.WEB_MERCATOR_AUTO_OFFSET:e===a.a.LNGLAT?i=n:e===a.a.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case a.d.IDENTITY:(i=t.position.map(Math.fround))[2]=i[2]||0;break;case a.d.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:o}}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.viewport,r=t.devicePixelRatio,n=t.modelMatrix,i=void 0===n?null:n,o=t.coordinateSystem,s=void 0===o?a.a.DEFAULT:o,u=t.autoWrapLongitude,c=void 0!==u&&u;s===a.a.DEFAULT&&(s=e.isGeospatial?a.a.LNGLAT:a.a.CARTESIAN);var h=f({viewport:e,devicePixelRatio:void 0===r?1:r,coordinateSystem:s,coordinateOrigin:t.coordinateOrigin});return h.project_uWrapLongitude=c,h.project_uModelMatrix=i||l,h}},function(t,e,r){r.d(e,"a",(function(){return l}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(0),u=r.n(s),l=function(){function t(e){i()(this,t),u()(this,"_viewportProps",void 0),u()(this,"_state",void 0),this._viewportProps=this._applyConstraints(e)}return o()(t,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"shortestPathFrom",value:function(t){return this._viewportProps}},{key:"_applyConstraints",value:function(t){return t}}]),t}()},function(t,e,r){r.d(e,"b",(function(){return f})),r.d(e,"a",(function(){return d})),r.d(e,"c",(function(){return m}));var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(139),u=r(23),l=r(114),c=r(102),h="Cannot convert supplied data type";function f(t,e,r){if(e.text&&"string"==typeof t)return t;if(Object(u.c)(t)&&(t=t.buffer),t instanceof ArrayBuffer){var n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);var i=t.buffer,a=t.byteLength||t.length;return 0===t.byteOffset&&a===i.byteLength||(i=i.slice(t.byteOffset,t.byteOffset+a)),i}throw new Error(h)}function d(t,e,r){return p.apply(this,arguments)}function p(){return(p=i()(o.a.mark((function t(e,r,n){var i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!i){t.next=3;break}return t.abrupt("return",f(e,r));case 3:if(!Object(u.b)(e)){t.next=7;break}return t.next=6,Object(c.b)(e);case 6:e=t.sent;case 7:if(!Object(u.j)(e)){t.next=21;break}return a=e,t.next=11,Object(c.a)(a);case 11:if(!r.binary){t.next=17;break}return t.next=14,a.arrayBuffer();case 14:t.t0=t.sent,t.next=20;break;case 17:return t.next=19,a.text();case 19:t.t0=t.sent;case 20:return t.abrupt("return",t.t0);case 21:if(Object(u.i)(e)&&(e=Object(l.a)(e,n)),!Object(u.d)(e)&&!Object(u.a)(e)){t.next=24;break}return t.abrupt("return",Object(s.a)(e));case 24:throw new Error(h);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(t,e){return v.apply(this,arguments)}function v(){return(v=i()(o.a.mark((function t(e,r){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!Object(u.e)(e)){t.next=2;break}return t.abrupt("return",e);case 2:if(!Object(u.j)(e)){t.next=10;break}return n=e,t.next=6,Object(c.a)(n);case 6:return t.next=8,n.body;case 8:return i=t.sent,t.abrupt("return",Object(l.a)(i,r));case 10:if(!Object(u.b)(e)&&!Object(u.i)(e)){t.next=12;break}return t.abrupt("return",Object(l.a)(e,r));case 12:if(!Object(u.a)(e)){t.next=14;break}return t.abrupt("return",e[Symbol.asyncIterator]());case 14:return t.abrupt("return",g(e));case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){if(ArrayBuffer.isView(t))return o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.buffer;case 2:case"end":return e.stop()}}),e)}))();if(t instanceof ArrayBuffer)return o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:case"end":return e.stop()}}),e)}))();if(Object(u.e)(t))return t;if(Object(u.d)(t))return t[Symbol.iterator]();throw new Error(h)}},function(t,e,r){var n=r(2),i=r.n(n),a=i.a.mark(o);function o(t,e){var r,n,o,s,u;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=(null==e?void 0:e.chunkSize)||262144,n=0,o=new TextEncoder;case 3:if(!(n<t.length)){i.next=11;break}return s=Math.min(t.length-n,r),u=t.slice(n,n+s),n+=s,i.next=9,o.encode(u);case 9:i.next=3;break;case 11:case"end":return i.stop()}}),a)}var s=i.a.mark(u);function u(t){var e,r,n,a,o,u,l=arguments;return i.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:r=void 0===(e=(l.length>1&&void 0!==l[1]?l[1]:{}).chunkSize)?262144:e,n=0;case 3:if(!(n<t.byteLength)){i.next=14;break}return a=Math.min(t.byteLength-n,r),o=new ArrayBuffer(a),u=new Uint8Array(t,n,a),new Uint8Array(o).set(u),n+=a,i.next=12,o;case 12:i.next=3;break;case 14:case"end":return i.stop()}}),s)}var l=r(37),c=r.n(l),h=r(53),f=r.n(h);function d(){return(d=f()(i.a.mark((function t(e,r){var n,a,o,s;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(null==r?void 0:r.chunkSize)||1048576,a=0;case 2:if(!(a<e.size)){t.next=12;break}return o=a+n,t.next=6,c()(e.slice(a,o).arrayBuffer());case 6:return s=t.sent,a=o,t.next=10,s;case 10:t.next=2;break;case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var p=r(41),m=r.n(p),v=r(91),g=r(84);function y(t,e){return v.c?function(t,e){return _.apply(this,arguments)}(t,e):function(t,e){return b.apply(this,arguments)}(t,e)}function _(){return(_=f()(i.a.mark((function t(e,r){var n,a,o,s,u;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.getReader(),t.prev=1;case 2:return o=a||n.read(),null!=r&&r._streamReadAhead&&(a=n.read()),t.next=7,c()(o);case 7:if(u=(s=t.sent).value,!s.done){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,Object(g.d)(u);case 14:t.next=2;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),n.releaseLock();case 21:case"end":return t.stop()}}),t,null,[[1,18]])})))).apply(this,arguments)}function b(){return(b=f()(i.a.mark((function t(e,r){var n,a,o,s,u,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!1,a=!1,t.prev=2,s=m()(e);case 4:return t.next=6,c()(s.next());case 6:if(!(n=!(u=t.sent).done)){t.next=13;break}return l=u.value,t.next=10,Object(g.d)(l);case 10:n=!1,t.next=4;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(2),a=!0,o=t.t0;case 19:if(t.prev=19,t.prev=20,!n||null==s.return){t.next=24;break}return t.next=24,c()(s.return());case 24:if(t.prev=24,!a){t.next=27;break}throw o;case 27:return t.finish(24);case 28:return t.finish(19);case 29:case"end":return t.stop()}}),t,null,[[2,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var x=r(23);function w(t,e){if("string"==typeof t)return o(t,e);if(t instanceof ArrayBuffer)return u(t,e);if(Object(x.b)(t))return function(t,e){return d.apply(this,arguments)}(t,e);if(Object(x.i)(t))return y(t,e);if(Object(x.j)(t))return y(t.body,e);throw new Error("makeIterator")}r.d(e,"a",(function(){return w}))},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(17),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(8),v=r(63),g=r(10);function y(t,e){return Object(g.a)("string"==typeof t),t=""+t,new Promise((function(r,n){try{var i=new Image;i.onload=function(){return r(i)},i.onerror=function(){return n(new Error("Could not load image ".concat(t,".")))},i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(t){n(t)}}))}r.d(e,"a",(function(){return _}));var _=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,r),Object(m.b)(t),(a instanceof Promise||"string"==typeof a)&&(a={data:a}),"string"==typeof a.data&&(a=Object.assign({},a,{data:y(a.data)})),(n=e.call(this,t,Object.assign({},a,{target:3553}))).initialize(a),Object.seal(u()(n)),n}return o()(r,null,[{key:"isSupported",value:function(t,e){return v.a.isSupported(t,e)}}]),r}(v.a)},function(t,e){},,function(t,e){t.exports=function(t){return t&&t.__esModule?t:{default:t}}},function(t,e,r){r.d(e,"c",(function(){return h})),r.d(e,"d",(function(){return d})),r.d(e,"a",(function(){return m})),r.d(e,"b",(function(){return g}));var n=r(37),i=r.n(n),a=r(53),o=r.n(a),s=r(41),u=r.n(s),l=r(2),c=r.n(l);function h(t){return f.apply(this,arguments)}function f(){return(f=o()(c.a.mark((function t(e){var r,n,a,o,s,l,h,f=arguments;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new TextDecoder(void 0,f.length>1&&void 0!==f[1]?f[1]:{}),n=!1,a=!1,t.prev=4,s=u()(e);case 6:return t.next=8,i()(s.next());case 8:if(!(n=!(l=t.sent).done)){t.next=15;break}return h=l.value,t.next=12,"string"==typeof h?h:r.decode(h,{stream:!0});case 12:n=!1,t.next=6;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(4),a=!0,o=t.t0;case 21:if(t.prev=21,t.prev=22,!n||null==s.return){t.next=26;break}return t.next=26,i()(s.return());case 26:if(t.prev=26,!a){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(21);case 31:case"end":return t.stop()}}),t,null,[[4,17,21,31],[22,,26,30]])})))).apply(this,arguments)}function d(t){return p.apply(this,arguments)}function p(){return(p=o()(c.a.mark((function t(e){var r,n,a,o,s,l,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new TextEncoder,n=!1,a=!1,t.prev=3,s=u()(e);case 5:return t.next=7,i()(s.next());case 7:if(!(n=!(l=t.sent).done)){t.next=14;break}return h=l.value,t.next=11,"string"==typeof h?r.encode(h):h;case 11:n=!1,t.next=5;break;case 14:t.next=20;break;case 16:t.prev=16,t.t0=t.catch(3),a=!0,o=t.t0;case 20:if(t.prev=20,t.prev=21,!n||null==s.return){t.next=25;break}return t.next=25,i()(s.return());case 25:if(t.prev=25,!a){t.next=28;break}throw o;case 28:return t.finish(25);case 29:return t.finish(20);case 30:case"end":return t.stop()}}),t,null,[[3,16,20,30],[21,,25,29]])})))).apply(this,arguments)}function m(t){return v.apply(this,arguments)}function v(){return(v=o()(c.a.mark((function t(e){var r,n,a,o,s,l,h,f;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r="",n=!1,a=!1,t.prev=3,s=u()(e);case 5:return t.next=7,i()(s.next());case 7:if(!(n=!(l=t.sent).done)){t.next=21;break}r+=l.value,h=void 0;case 11:if(!((h=r.indexOf("\n"))>=0)){t.next=18;break}return f=r.slice(0,h+1),r=r.slice(h+1),t.next=16,f;case 16:t.next=11;break;case 18:n=!1,t.next=5;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(3),a=!0,o=t.t0;case 27:if(t.prev=27,t.prev=28,!n||null==s.return){t.next=32;break}return t.next=32,i()(s.return());case 32:if(t.prev=32,!a){t.next=35;break}throw o;case 35:return t.finish(32);case 36:return t.finish(27);case 37:if(!(r.length>0)){t.next=40;break}return t.next=40,r;case 40:case"end":return t.stop()}}),t,null,[[3,23,27,37],[28,,32,36]])})))).apply(this,arguments)}function g(t){return y.apply(this,arguments)}function y(){return(y=o()(c.a.mark((function t(e){var r,n,a,o,s,l,h;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=1,n=!1,a=!1,t.prev=3,s=u()(e);case 5:return t.next=7,i()(s.next());case 7:if(!(n=!(l=t.sent).done)){t.next=15;break}return h=l.value,t.next=11,{counter:r,line:h};case 11:r++;case 12:n=!1,t.next=5;break;case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),a=!0,o=t.t0;case 21:if(t.prev=21,t.prev=22,!n||null==s.return){t.next=26;break}return t.next=26,i()(s.return());case 26:if(t.prev=26,!a){t.next=29;break}throw o;case 29:return t.finish(26);case 30:return t.finish(21);case 31:case"end":return t.stop()}}),t,null,[[3,17,21,31],[22,,26,30]])})))).apply(this,arguments)}},function(t,e,r){function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;return"string"==typeof t?t.slice(0,e):ArrayBuffer.isView(t)?i(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?i(t,0,e):""}function i(t,e,r){if(t.byteLength<=e+r)return"";for(var n=new DataView(t),i="",a=0;a<r;a++)i+=String.fromCharCode(n.getUint8(e+a));return i}r.d(e,"a",(function(){return n}))},function(t,e,r){r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return m}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(80);function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var f=function(){},d={BREAK:1,SNAP_TO_END:2,IGNORE:3},p={transitionEasing:function(t){return t},transitionInterruption:d.BREAK,onTransitionStart:f,onTransitionInterrupt:f,onTransitionEnd:f},m=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,t),this.ControllerState=e,this.props=h(h({},p),r),this.propsInTransition=null,this.transition=new l.a(r.timeline),this.onViewStateChange=r.onViewStateChange||f,this.onStateChange=r.onStateChange||f,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}return u()(t,[{key:"finalize",value:function(){this.transition.cancel()}},{key:"getViewportInTransition",value:function(){return this.propsInTransition}},{key:"processViewStateChange",value:function(t){var e=!1,r=this.props;if(t=h(h({},p),t),this.props=t,this._shouldIgnoreViewportChange(r,t))return e;if(this._isTransitionEnabled(t)){var n=this.transition.settings,i=n.interruption,a=n.endProps,o=h(h({},r),i===d.SNAP_TO_END?a:this.propsInTransition||r);this._triggerTransition(o,t),e=!0}else this.transition.cancel();return e}},{key:"updateTransition",value:function(){this.transition.update()}},{key:"_isTransitionEnabled",value:function(t){var e=t.transitionDuration;return(e>0||"auto"===e)&&Boolean(t.transitionInterpolator)}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return!!this.transition.inProgress&&this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition)}},{key:"_shouldIgnoreViewportChange",value:function(t,e){return this.transition.inProgress?this.transition.settings.interruption===d.IGNORE||this._isUpdateDueToCurrentTransition(e):!this._isTransitionEnabled(e)||e.transitionInterpolator.arePropsEqual(t,e)}},{key:"_triggerTransition",value:function(t,e){var r=new this.ControllerState(t),n=new this.ControllerState(e).shortestPathFrom(r),i=e.transitionInterpolator,a=i.getDuration?i.getDuration(t,e):e.transitionDuration;if(0!==a){var o=e.transitionInterpolator.initializeProps(t,n);this.propsInTransition={},this.duration=a,this.transition.start({duration:a,easing:e.transitionEasing,interpolator:e.transitionInterpolator,interruption:e.transitionInterruption,startProps:o.start,endProps:o.end,onStart:e.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(e.onTransitionInterrupt),onEnd:this._onTransitionEnd(e.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}}},{key:"_onTransitionEnd",value:function(t){var e=this;return function(r){e.propsInTransition=null,e.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t(r)}}},{key:"_onTransitionUpdate",value:function(t){var e=t.settings,r=e.interpolator,n=e.startProps,i=e.endProps,a=(0,e.easing)(t.time/e.duration),o=r.interpolateProps(n,i,a);this.propsInTransition=new this.ControllerState(h(h({},this.props),o)).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return A}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(18),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(107),y=r(14);function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var w=["longitude","latitude","zoom","bearing","pitch"],M=["longitude","latitude","zoom"],A=function(t){f()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,r);var i=Array.isArray(n)?n:n.transitionProps;return(t=e.call(this,i||{compare:w,extract:w,required:M})).opts=n,t}return u()(r,[{key:"initializeProps",value:function(t,e){var n=c()(v()(r.prototype),"initializeProps",this).call(this,t,e),i=this.opts,a=i.makeViewport,o=i.around;if(a&&o){var s=a(t),u=a(e),l=s.unproject(o);n.start.around=o,Object.assign(n.end,{around:u.project(l),aroundPosition:l,width:e.width,height:e.height})}return n}},{key:"interpolateProps",value:function(t,e,r){var n,i={},a=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this._propsToExtract);try{for(a.s();!(n=a.n()).done;){var o=n.value;i[o]=Object(y.g)(t[o]||0,e[o]||0,r)}}catch(t){a.e(t)}finally{a.f()}if(e.aroundPosition){var s=this.opts.makeViewport(b(b({},e),i));Object.assign(i,s.panByPosition(e.aroundPosition,Object(y.g)(t.around,e.around,r)))}return i}}]),r}(g.a)},function(t,e,r){r.d(e,"c",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return l}));var n=r(11),i=r.n(n),a=r(26);function o(t){var e=d(t);for(var r in e){var n=e[r],i=n.validate;if(i&&!i(t[r],n))throw new Error("Invalid prop ".concat(r,": ").concat(t[r]))}}function s(t,e){var r=l({newProps:t,oldProps:e,propTypes:d(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=function(t,e){if(null===e)return"oldProps is null, initial diff";var r=null,n=t.dataComparator,i=t._dataDiff;return n?n(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&i&&(r=i(t.data,e.data)||r),r}(t,e),i=!1;return n||(i=function(t,e){if(null===e)return"oldProps is null, initial diff";if("all"in t.updateTriggers&&f(t,e,"all"))return{all:!0};var r={},n=!1;for(var i in t.updateTriggers)"all"!==i&&f(t,e,i)&&(r[i]=!0,n=r);return n}(t,e)),{dataChanged:n,propsChanged:r,updateTriggersChanged:i,extensionsChanged:h(t,e),transitionsChanged:u(t,e)}}function u(t,e){if(!t.transitions)return null;var r={},n=d(t);for(var i in t.transitions){var a=n[i],o=a&&a.type;("number"===o||"color"===o||"array"===o)&&c(t[i],e[i],a)&&(r[i]=!0)}return r}function l(t){var e=t.newProps,r=t.oldProps,n=t.ignoreProps,a=void 0===n?{}:n,o=t.propTypes,s=void 0===o?{}:o,u=t.triggerName,l=void 0===u?"props":u;if(r===e)return null;if("object"!==i()(e)||null===e)return"".concat(l," changed shallowly");if("object"!==i()(r)||null===r)return"".concat(l," changed shallowly");for(var h=0,f=Object.keys(e);h<f.length;h++){var d=f[h];if(!(d in a)){if(!(d in r))return"".concat(l,".").concat(d," added");var p=c(e[d],r[d],s[d]);if(p)return"".concat(l,".").concat(d," ").concat(p)}}for(var m=0,v=Object.keys(r);m<v.length;m++){var g=v[m];if(!(g in a)){if(!(g in e))return"".concat(l,".").concat(g," dropped");if(!Object.hasOwnProperty.call(e,g)){var y=c(e[g],r[g],s[g]);if(y)return"".concat(l,".").concat(g," ").concat(y)}}}return null}function c(t,e,r){var n=r&&r.equal;return n&&!n(t,e,r)?"changed deeply":n||!(n=t&&e&&t.equals)||n.call(t,e)?n||e===t?null:"changed shallowly":"changed deeply"}function h(t,e){if(null===e)return!0;var r=e.extensions,n=t.extensions;if(n===r)return!1;if(!r||!n)return!0;if(n.length!==r.length)return!0;for(var i=0;i<n.length;i++)if(!n[i].equals(r[i]))return!0;return!1}function f(t,e,r){var n=t.updateTriggers[r],i=e.updateTriggers[r];return l({oldProps:i=null==i?{}:i,newProps:n=null==n?{}:n,triggerName:r})}function d(t){var e=t[a.d],r=e&&e.constructor;return r?r._propTypes:{}}},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(6),u=r.n(s),l=r(9),c=r.n(l),h=r(5),f=r.n(h),d=r(178),p=r(115),m=r(135),v=r(97),g=r(78),y=r(90),_=r(73),b=r(17),x=r.n(b),w=r(18),M=r.n(w),A=r(0),E=r.n(A),S=r(77),T=r(103),C=r(79),O=r(8);function P(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function L(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?P(Object(r),!0).forEach((function(e){E()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var I=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(t,n){var a,o,s;return i()(this,r),s=e.call(this,t,n),E()(x()(s),"shadowMap",void 0),E()(x()(s),"depthBuffer",void 0),E()(x()(s),"fbo",void 0),s.shadowMap=new p.a(t,{width:1,height:1,parameters:(a={},E()(a,10241,9729),E()(a,10240,9729),E()(a,10242,33071),E()(a,10243,33071),a)}),s.depthBuffer=new T.a(t,{format:33189,width:1,height:1}),s.fbo=new C.a(t,{id:"shadowmap",width:1,height:1,attachments:(o={},E()(o,36064,s.shadowMap),E()(o,36096,s.depthBuffer),o)}),s}return o()(r,[{key:"render",value:function(t){var e=this,n=this.fbo;Object(O.o)(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},(function(){var i=t.viewports[0],a=Object(O.e)(e.gl),o=i.width*a,s=i.height*a;o===n.width&&s===n.height||n.resize({width:o,height:s}),M()(f()(r.prototype),"render",e).call(e,L(L({},t),{},{target:n,pass:"shadow"}))}))}},{key:"shouldDrawLayer",value:function(t){return!1!==t.props.shadowEnabled}},{key:"getModuleParameters",value:function(){return{drawToShadowMap:!0}}},{key:"delete",value:function(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}]),r}(S.a),k=r(110);function R(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return D(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return N}));var B={color:[255,255,255],intensity:1.6},F=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],j=[0,0,0,200/255],N=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(t){var n;for(var a in i()(this,r),(n=e.call(this,t)).ambientLight=null,n.directionalLights=[],n.pointLights=[],n.shadowColor=j,n.shadowPasses=[],n.shadowMaps=[],n.dummyShadowMap=null,n.shadow=!1,n.programManager=null,t){var o=t[a];switch(o.type){case"ambient":n.ambientLight=o;break;case"directional":n.directionalLights.push(o);break;case"point":n.pointLights.push(o)}}return n._applyDefaultLights(),n.shadow=n.directionalLights.some((function(t){return t.shadow})),n}return o()(r,[{key:"preRender",value:function(t,e){var r=e.layers,n=e.layerFilter,i=e.viewports,a=e.onViewportActive,o=e.views;if(this.shadow){this.shadowMatrices=this._createLightMatrix(),0===this.shadowPasses.length&&this._createShadowPasses(t),this.programManager||(this.programManager=d.a.getDefaultProgramManager(t),k.a&&this.programManager.addDefaultModule(k.a)),this.dummyShadowMap||(this.dummyShadowMap=new p.a(t,{width:1,height:1}));for(var s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:r,layerFilter:n,viewports:i,onViewportActive:a,views:o,moduleParameters:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}},{key:"getModuleParameters",value:function(t){var e=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return e.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((function(e){return e.getProjectedLight({layer:t})})),pointLights:this.pointLights.map((function(e){return e.getProjectedLight({layer:t})}))},e}},{key:"cleanup",value:function(){var t,e=R(this.shadowPasses);try{for(e.s();!(t=e.n()).done;)t.value.delete()}catch(t){e.e(t)}finally{e.f()}this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(k.a),this.programManager=null)}},{key:"_createLightMatrix",value:function(){var t,e=[],r=R(this.directionalLights);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=(new y.a).lookAt({eye:new _.a(n.direction).negate()});e.push(i)}}catch(t){r.e(t)}finally{r.f()}return e}},{key:"_createShadowPasses",value:function(t){for(var e=0;e<this.directionalLights.length;e++){var r=new I(t);this.shadowPasses[e]=r,this.shadowMaps[e]=r.shadowMap}}},{key:"_applyDefaultLights",value:function(){this.ambientLight||0!==this.pointLights.length||0!==this.directionalLights.length||(this.ambientLight=new m.a(B),this.directionalLights.push(new v.a(F[0]),new v.a(F[1])))}}]),r}(g.a)},function(t,e,r){r.d(e,"a",(function(){return i}));var n=r(8);function i(t,e,r){var i=r.removedProps,a=void 0===i?{}:i,o=r.deprecatedProps,s=void 0===o?{}:o,u=r.replacedProps,l=void 0===u?{}:u;for(var c in a)if(c in e){var h=a[c]?"".concat(t,".").concat(a[c]):"N/A";n.k.removed("".concat(t,".").concat(c),h)()}for(var f in s)if(f in e){var d=s[f];n.k.deprecated("".concat(t,".").concat(f),"".concat(t,".").concat(d))()}var p=null;for(var m in l)if(m in e){var v=l[m];n.k.deprecated("".concat(t,".").concat(m),"".concat(t,".").concat(v))(),(p=p||Object.assign({},e))[v]=e[m],delete p[m]}return p||e}},function(t,e,r){r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return g}));var n=r(0),i=r.n(n),a=r(12),o=r.n(a),s=r(16),u=r(111),l=r(87),c=r(29),h=r(24),f=r(27);function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function p(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.projectPosition(t);if(r&&e instanceof l.a){var i=o()(t,3),a=i[2],s=void 0===a?0:a,u=e.getDistanceScales([i[0],i[1]]);n[2]=s*u.unitsPerMeter[2]}return n}function m(t){var e=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t),r=t.coordinateSystem,n=t.coordinateOrigin,a=t.fromCoordinateOrigin;return r===s.a.DEFAULT&&(r=t.viewport.isGeospatial?s.a.LNGLAT:s.a.CARTESIAN),void 0===t.fromCoordinateSystem&&(e.fromCoordinateSystem=r),void 0===a&&(e.fromCoordinateOrigin=n),e.coordinateSystem=r,e}function v(t,e){var r=e.viewport,n=e.modelMatrix,i=e.coordinateSystem,a=e.coordinateOrigin,u=e.offsetMode,l=o()(t,3),h=l[0],d=l[1],m=l[2],v=void 0===m?0:m;if(n){var g=c.n([],[h,d,v,1],n),y=o()(g,3);h=y[0],d=y[1],v=y[2]}switch(i){case s.a.LNGLAT:return p([h,d,v],r,u);case s.a.LNGLAT_OFFSETS:return p([h+a[0],d+a[1],v+(a[2]||0)],r,u);case s.a.METER_OFFSETS:return p(Object(f.a)(a,[h,d,v]),r,u);default:return r.isGeospatial?[h+a[0],d+a[1],v+a[2]]:r.projectPosition([h,d,v])}}function g(t,e){var r=m(e),n=r.viewport,i=r.coordinateSystem,a=r.coordinateOrigin,o=r.modelMatrix,s=r.fromCoordinateSystem,l=r.fromCoordinateOrigin,c=Object(u.a)(n,i,a),f=c.geospatialOrigin,d=c.shaderCoordinateOrigin,p=c.offsetMode,g=v(t,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:l,offsetMode:p});if(p){var y=n.projectPosition(f||d);h.q(g,g,y)}return g}},function(t,e,r){var n="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n";function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return l}));var o={lightSources:{}};function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.color,r=t.intensity,n=void 0===r?1:r;return(void 0===e?[0,0,0]:e).map((function(t){return t*n/255}))}function u(t){var e=t.ambientLight,r=t.pointLights,n=void 0===r?[]:r,i=t.directionalLights,a=void 0===i?[]:i,o={};return o["lighting_uAmbientLight.color"]=e?s(e):[0,0,0],n.forEach((function(t,e){o["lighting_uPointLight[".concat(e,"].color")]=s(t),o["lighting_uPointLight[".concat(e,"].position")]=t.position,o["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]})),o.lighting_uPointLightCount=n.length,a.forEach((function(t,e){o["lighting_uDirectionalLight[".concat(e,"].color")]=s(t),o["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction})),o.lighting_uDirectionalLightCount=a.length,o}var l={name:"lights",vs:n,fs:n,getUniforms:function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;if("lightSources"in e){var r=e.lightSources||{},n=r.ambientLight,a=r.pointLights,s=r.directionalLights;return n||a&&a.length>0||s&&s.length>0?Object.assign({},u({ambientLight:n,pointLights:a,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){var l,c={pointLights:[],directionalLights:[]},h=i(e.lights||[]);try{for(h.s();!(l=h.n()).done;){var f=l.value;switch(f.type){case"ambient":c.ambientLight=f;break;case"directional":c.directionalLights.push(f);break;case"point":c.pointLights.push(f)}}}catch(t){h.e(t)}finally{h.f()}return t({lightSources:c})}return{}},defines:{MAX_LIGHTS:3}}},function(t,e,r){var n=r(249),i=r(250),a=r(193),o=r(251);t.exports=function(t){return n(t)||i(t)||a(t)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n;
/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */!function(i,a,o,s){var u,l=["","webkit","Moz","MS","ms","o"],c=a.createElement("div"),h=Math.round,f=Math.abs,d=Date.now;function p(t,e,r){return setTimeout(x(t,r),e)}function m(t,e,r){return!!Array.isArray(t)&&(v(t,r[e],r),!0)}function v(t,e,r){var n;if(t)if(t.forEach)t.forEach(e,r);else if(void 0!==t.length)for(n=0;n<t.length;)e.call(r,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(r,t[n],n,t)}function g(t,e,r){var n="DEPRECATED METHOD: "+e+"\n"+r+" AT \n";return function(){var e=new Error("get-stack-trace"),r=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=i.console&&(i.console.warn||i.console.log);return a&&a.call(i.console,n,r),t.apply(this,arguments)}}u="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e}:Object.assign;var y=g((function(t,e,r){for(var n=Object.keys(e),i=0;i<n.length;)(!r||r&&void 0===t[n[i]])&&(t[n[i]]=e[n[i]]),i++;return t}),"extend","Use `assign`."),_=g((function(t,e){return y(t,e,!0)}),"merge","Use `assign`.");function b(t,e,r){var n,i=e.prototype;(n=t.prototype=Object.create(i)).constructor=t,n._super=i,r&&u(n,r)}function x(t,e){return function(){return t.apply(e,arguments)}}function w(t,e){return"function"==typeof t?t.apply(e&&e[0]||void 0,e):t}function M(t,e){return void 0===t?e:t}function A(t,e,r){v(C(e),(function(e){t.addEventListener(e,r,!1)}))}function E(t,e,r){v(C(e),(function(e){t.removeEventListener(e,r,!1)}))}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function T(t,e){return t.indexOf(e)>-1}function C(t){return t.trim().split(/\s+/g)}function O(t,e,r){if(t.indexOf&&!r)return t.indexOf(e);for(var n=0;n<t.length;){if(r&&t[n][r]==e||!r&&t[n]===e)return n;n++}return-1}function P(t){return Array.prototype.slice.call(t,0)}function L(t,e,r){for(var n=[],i=[],a=0;a<t.length;){var o=e?t[a][e]:t[a];O(i,o)<0&&n.push(t[a]),i[a]=o,a++}return r&&(n=e?n.sort((function(t,r){return t[e]>r[e]})):n.sort()),n}function I(t,e){for(var r,n,i=e[0].toUpperCase()+e.slice(1),a=0;a<l.length;){if((n=(r=l[a])?r+i:e)in t)return n;a++}}var k=1;function R(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||i}var D="ontouchstart"in i,B=void 0!==I(i,"PointerEvent"),F=D&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),j=["x","y"],N=["clientX","clientY"];function U(t,e){var r=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){w(t.options.enable,[t])&&r.handler(e)},this.init()}function z(t,e,r){var n=r.pointers.length,i=r.changedPointers.length,a=1&e&&n-i==0,o=12&e&&n-i==0;r.isFirst=!!a,r.isFinal=!!o,a&&(t.session={}),r.eventType=e,function(t,e){var r=t.session,n=e.pointers,i=n.length;r.firstInput||(r.firstInput=G(e)),i>1&&!r.firstMultiple?r.firstMultiple=G(e):1===i&&(r.firstMultiple=!1);var a=r.firstInput,o=r.firstMultiple,s=o?o.center:a.center,u=e.center=V(n);e.timeStamp=d(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=q(s,u),e.distance=$(s,u),function(t,e){var r=e.center,n=t.offsetDelta||{},i=t.prevDelta||{},a=t.prevInput||{};1!==e.eventType&&4!==a.eventType||(i=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=t.offsetDelta={x:r.x,y:r.y}),e.deltaX=i.x+(r.x-n.x),e.deltaY=i.y+(r.y-n.y)}(r,e),e.offsetDirection=W(e.deltaX,e.deltaY);var l,c,h=H(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=f(h.x)>f(h.y)?h.x:h.y,e.scale=o?(l=o.pointers,$((c=n)[0],c[1],N)/$(l[0],l[1],N)):1,e.rotation=o?function(t,e){return q(e[1],e[0],N)+q(t[1],t[0],N)}(o.pointers,n):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length,function(t,e){var r,n,i,a,o=t.lastInterval||e,s=e.timeStamp-o.timeStamp;if(8!=e.eventType&&(s>25||void 0===o.velocity)){var u=e.deltaX-o.deltaX,l=e.deltaY-o.deltaY,c=H(s,u,l);n=c.x,i=c.y,r=f(c.x)>f(c.y)?c.x:c.y,a=W(u,l),t.lastInterval=e}else r=o.velocity,n=o.velocityX,i=o.velocityY,a=o.direction;e.velocity=r,e.velocityX=n,e.velocityY=i,e.direction=a}(r,e);var p=t.element;S(e.srcEvent.target,p)&&(p=e.srcEvent.target),e.target=p}(t,r),t.emit("hammer.input",r),t.recognize(r),t.session.prevInput=r}function G(t){for(var e=[],r=0;r<t.pointers.length;)e[r]={clientX:h(t.pointers[r].clientX),clientY:h(t.pointers[r].clientY)},r++;return{timeStamp:d(),pointers:e,center:V(e),deltaX:t.deltaX,deltaY:t.deltaY}}function V(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var r=0,n=0,i=0;i<e;)r+=t[i].clientX,n+=t[i].clientY,i++;return{x:h(r/e),y:h(n/e)}}function H(t,e,r){return{x:e/t||0,y:r/t||0}}function W(t,e){return t===e?1:f(t)>=f(e)?t<0?2:4:e<0?8:16}function $(t,e,r){r||(r=j);var n=e[r[0]]-t[r[0]],i=e[r[1]]-t[r[1]];return Math.sqrt(n*n+i*i)}function q(t,e,r){return r||(r=j),180*Math.atan2(e[r[1]]-t[r[1]],e[r[0]]-t[r[0]])/Math.PI}U.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&E(this.element,this.evEl,this.domHandler),this.evTarget&&E(this.target,this.evTarget,this.domHandler),this.evWin&&E(R(this.element),this.evWin,this.domHandler)}};var X={mousedown:1,mousemove:2,mouseup:4};function K(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,U.apply(this,arguments)}b(K,U,{handler:function(t){var e=X[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Z={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Y={2:"touch",3:"pen",4:"mouse",5:"kinect"},J="pointerdown",Q="pointermove pointerup pointercancel";function tt(){this.evEl=J,this.evWin=Q,U.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}i.MSPointerEvent&&!i.PointerEvent&&(J="MSPointerDown",Q="MSPointerMove MSPointerUp MSPointerCancel"),b(tt,U,{handler:function(t){var e=this.store,r=!1,n=t.type.toLowerCase().replace("ms",""),i=Z[n],a=Y[t.pointerType]||t.pointerType,o="touch"==a,s=O(e,t.pointerId,"pointerId");1&i&&(0===t.button||o)?s<0&&(e.push(t),s=e.length-1):12&i&&(r=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),r&&e.splice(s,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function rt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,U.apply(this,arguments)}function nt(t,e){var r=P(t.touches),n=P(t.changedTouches);return 12&e&&(r=L(r.concat(n),"identifier",!0)),[r,n]}b(rt,U,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var r=nt.call(this,t,e);12&e&&r[0].length-r[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:t})}}});var it={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function at(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},U.apply(this,arguments)}function ot(t,e){var r=P(t.touches),n=this.targetIds;if(3&e&&1===r.length)return n[r[0].identifier]=!0,[r,r];var i,a,o=P(t.changedTouches),s=[],u=this.target;if(a=r.filter((function(t){return S(t.target,u)})),1===e)for(i=0;i<a.length;)n[a[i].identifier]=!0,i++;for(i=0;i<o.length;)n[o[i].identifier]&&s.push(o[i]),12&e&&delete n[o[i].identifier],i++;return s.length?[L(a.concat(s),"identifier",!0),s]:void 0}function st(){U.apply(this,arguments);var t=x(this.handler,this);this.touch=new at(this.manager,t),this.mouse=new K(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function ut(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,lt.call(this,e)):12&t&&lt.call(this,e)}function lt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var r={x:e.clientX,y:e.clientY};this.lastTouches.push(r);var n=this.lastTouches;setTimeout((function(){var t=n.indexOf(r);t>-1&&n.splice(t,1)}),2500)}}function ct(t){for(var e=t.srcEvent.clientX,r=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var i=this.lastTouches[n],a=Math.abs(e-i.x),o=Math.abs(r-i.y);if(a<=25&&o<=25)return!0}return!1}b(at,U,{handler:function(t){var e=it[t.type],r=ot.call(this,t,e);r&&this.callback(this.manager,e,{pointers:r[0],changedPointers:r[1],pointerType:"touch",srcEvent:t})}}),b(st,U,{handler:function(t,e,r){var n="mouse"==r.pointerType;if(!(n&&r.sourceCapabilities&&r.sourceCapabilities.firesTouchEvents)){if("touch"==r.pointerType)ut.call(this,e,r);else if(n&&ct.call(this,r))return;this.callback(t,e,r)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ht=I(c.style,"touchAction"),ft=void 0!==ht,dt=function(){if(!ft)return!1;var t={},e=i.CSS&&i.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(r){t[r]=!e||i.CSS.supports("touch-action",r)})),t}();function pt(t,e){this.manager=t,this.set(e)}function mt(t){this.options=u({},this.defaults,t||{}),this.id=k++,this.manager=null,this.options.enable=M(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function vt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function gt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function yt(t,e){var r=e.manager;return r?r.get(t):t}function _t(){mt.apply(this,arguments)}function bt(){_t.apply(this,arguments),this.pX=null,this.pY=null}function xt(){_t.apply(this,arguments)}function wt(){mt.apply(this,arguments),this._timer=null,this._input=null}function Mt(){_t.apply(this,arguments)}function At(){_t.apply(this,arguments)}function Et(){mt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function St(t,e){return(e=e||{}).recognizers=M(e.recognizers,St.defaults.preset),new Tt(t,e)}function Tt(t,e){this.options=u({},St.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new(this.options.inputClass||(B?tt:F?at:D?st:K))(this,z),this.touchAction=new pt(this,this.options.touchAction),Ct(this,!0),v(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function Ct(t,e){var r,n=t.element;n.style&&(v(t.options.cssProps,(function(i,a){r=I(n.style,a),e?(t.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=t.oldCssProps[r]||""})),e||(t.oldCssProps={}))}pt.prototype={set:function(t){"compute"==t&&(t=this.compute()),ft&&this.manager.element.style&&dt[t]&&(this.manager.element.style[ht]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return v(this.manager.recognizers,(function(e){w(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(T(t,"none"))return"none";var e=T(t,"pan-x"),r=T(t,"pan-y");return e&&r?"none":e||r?e?"pan-x":"pan-y":T(t,"manipulation")?"manipulation":"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,r=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,i=T(n,"none")&&!dt.none,a=T(n,"pan-y")&&!dt["pan-y"],o=T(n,"pan-x")&&!dt["pan-x"];if(i&&1===t.pointers.length&&t.distance<2&&t.deltaTime<250)return;if(!o||!a)return i||a&&6&r||o&&24&r?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}},mt.prototype={defaults:{},set:function(t){return u(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(m(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=yt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return m(t,"dropRecognizeWith",this)||(t=yt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(m(t,"requireFailure",this))return this;var e=this.requireFail;return-1===O(e,t=yt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(m(t,"dropRequireFailure",this))return this;t=yt(t,this);var e=O(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,r=this.state;function n(r){e.manager.emit(r,t)}r<8&&n(e.options.event+vt(r)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),r>=8&&n(e.options.event+vt(r))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=u({},t);if(!w(this.options.enable,[this,e]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},b(_t,mt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,r=t.eventType,n=6&e,i=this.attrTest(t);return n&&(8&r||!i)?16|e:n||i?4&r?8|e:2&e?4|e:2:32}}),b(bt,_t,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push("pan-y"),24&t&&e.push("pan-x"),e},directionTest:function(t){var e=this.options,r=!0,n=t.distance,i=t.direction,a=t.deltaX,o=t.deltaY;return i&e.direction||(6&e.direction?(i=0===a?1:a<0?2:4,r=a!=this.pX,n=Math.abs(t.deltaX)):(i=0===o?1:o<0?8:16,r=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=i,r&&n>e.threshold&&i&e.direction},attrTest:function(t){return _t.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=gt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),b(xt,_t,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){1!==t.scale&&(t.additionalEvent=this.options.event+(t.scale<1?"in":"out")),this._super.emit.call(this,t)}}),b(wt,mt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,n=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!n||!r||12&t.eventType&&!i)this.reset();else if(1&t.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),b(Mt,_t,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),b(At,_t,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return bt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,r=this.options.direction;return 30&r?e=t.overallVelocity:6&r?e=t.overallVelocityX:24&r&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&r&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&f(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=gt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),b(Et,mt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var e=this.options,r=t.pointers.length===e.pointers,n=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(n&&i&&r){if(4!=t.eventType)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||$(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,o&&a?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=p((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),St.VERSION="2.0.7",St.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Mt,{enable:!1}],[xt,{enable:!1},["rotate"]],[At,{direction:6}],[bt,{direction:6},["swipe"]],[Et],[Et,{event:"doubletap",taps:2},["tap"]],[wt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Tt.prototype={set:function(t){return u(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var r;this.touchAction.preventDefaults(t);var n=this.recognizers,i=e.curRecognizer;(!i||i&&8&i.state)&&(i=e.curRecognizer=null);for(var a=0;a<n.length;)r=n[a],2===e.stopped||i&&r!=i&&!r.canRecognizeWith(i)?r.reset():r.recognize(t),!i&&14&r.state&&(i=e.curRecognizer=r),a++}},get:function(t){if(t instanceof mt)return t;for(var e=this.recognizers,r=0;r<e.length;r++)if(e[r].options.event==t)return e[r];return null},add:function(t){if(m(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(m(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,r=O(e,t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this},on:function(t,e){if(void 0!==t&&void 0!==e){var r=this.handlers;return v(C(t),(function(t){r[t]=r[t]||[],r[t].push(e)})),this}},off:function(t,e){if(void 0!==t){var r=this.handlers;return v(C(t),(function(t){e?r[t]&&r[t].splice(O(r[t],e),1):delete r[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var r=a.createEvent("Event");r.initEvent(t,!0,!0),r.gesture=e,e.target.dispatchEvent(r)}(t,e);var r=this.handlers[t]&&this.handlers[t].slice();if(r&&r.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<r.length;)r[n](e),n++}},destroy:function(){this.element&&Ct(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(St,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Tt,Input:U,TouchAction:pt,TouchInput:at,MouseInput:K,PointerEventInput:tt,TouchMouseInput:st,SingleTouchInput:rt,Recognizer:mt,AttrRecognizer:_t,Tap:Et,Pan:bt,Swipe:At,Pinch:xt,Rotate:Mt,Press:wt,on:A,off:E,each:v,merge:_,extend:y,assign:u,inherit:b,bindFn:x,prefixed:I}),(void 0!==i?i:"undefined"!=typeof self?self:{}).Hammer=St,void 0===(n=function(){return St}.call(e,r,e,t))||(t.exports=n)}(window,document)},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(8);function u(){var t;if("undefined"!=typeof window&&window.performance)t=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){var e=process.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var l=function(){function t(e,r){i()(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return o()(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=u(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(u()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),c=function(){function t(e){var r=e.id,n=e.stats;i()(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return o()(t,[{key:"get",value:function(t){return this._getOrCreate({name:t,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count"})}},{key:"size",get:function(){return Object.keys(this.stats).length}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name;return this.stats[e]||(this.stats[e]=t instanceof l?t:new l(e,t.type)),this.stats[e]}}]),t}(),h=r(35);r.d(e,"a",(function(){return f}));var f=new(function(){function t(){i()(this,t),this.stats=new Map}return o()(t,[{key:"get",value:function(t){return this.stats.has(t)||this.stats.set(t,new c({id:t})),this.stats.get(t)}}]),t}());if(h.global.luma&&"8.5.10"!==h.global.luma.VERSION)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(h.global.luma.VERSION," vs ").concat("8.5.10"));h.global.luma||(Object(h.isBrowser)()&&s.k.log(1,"luma.gl ".concat("8.5.10"," - ").concat("set luma.log.level=1 (or higher) to trace rendering"))(),h.global.luma=h.global.luma||{VERSION:"8.5.10",version:"8.5.10",log:s.k,stats:f,globals:{modules:{},nodeIO:{}}})},,function(t,e){},function(t,e,r){r.d(e,"a",(function(){return f}));var n=r(156),i=r.n(n),a=r(43),o=r.n(a),s=r(44),u=r.n(s),l=r(14),c=r(73),h=r(24),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.phi,n=void 0===r?0:r,i=e.theta,a=void 0===i?0:i,s=e.radius,u=void 0===s?1:s,l=e.bearing,c=void 0===l?void 0:l,h=e.pitch,f=void 0===h?void 0:h,d=e.altitude,p=void 0===d?void 0:d,m=e.radiusScale,v=void 0===m?6371e3:m;o()(this,t),this.phi=n,this.theta=a,this.radius=u||p||1,this.radiusScale=v||1,void 0!==c&&(this.bearing=c),void 0!==f&&(this.pitch=f),this.check()}return u()(t,[{key:"toString",value:function(){return this.formatString(l.b)}},{key:"formatString",value:function(t){var e=t.printTypes,r=l.e;return"".concat(void 0!==e&&e?"Spherical":"","[rho:").concat(r(this.radius),",theta:").concat(r(this.theta),",phi:").concat(r(this.phi),"]")}},{key:"equals",value:function(t){return Object(l.d)(this.radius,t.radius)&&Object(l.d)(this.theta,t.theta)&&Object(l.d)(this.phi,t.phi)}},{key:"exactEquals",value:function(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}},{key:"bearing",get:function(){return 180-Object(l.c)(this.phi)},set:function(t){this.phi=Math.PI-Object(l.h)(t)}},{key:"pitch",get:function(){return Object(l.c)(this.theta)},set:function(t){this.theta=Object(l.h)(t)}},{key:"longitude",get:function(){return Object(l.c)(this.phi)}},{key:"latitude",get:function(){return Object(l.c)(this.theta)}},{key:"lng",get:function(){return Object(l.c)(this.phi)}},{key:"lat",get:function(){return Object(l.c)(this.theta)}},{key:"z",get:function(){return(this.radius-1)*this.radiusScale}},{key:"set",value:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this.check()}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}},{key:"fromLngLatZ",value:function(t){var e=i()(t,3),r=e[0],n=e[1];this.radius=1+e[2]/this.radiusScale,this.phi=Object(l.h)(n),this.theta=Object(l.h)(r)}},{key:"fromVector3",value:function(t){return this.radius=h.h(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(Object(l.a)(t[2]/this.radius,-1,1))),this.check()}},{key:"toVector3",value:function(){return new c.a(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}},{key:"check",value:function(){if(!(Number.isFinite(this.phi)&&Number.isFinite(this.theta)&&this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}]),t}()},function(t,e,r){r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return a}));var n=r(101);function i(t,e){return Object(n.a)(t>=0),Object(n.a)(e>0),t+(e-1)&~(e-1)}function a(t,e,r){var n;return n=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer||t.arrayBuffer,t.byteOffset,t.byteLength),e.set(n,r),r+i(n.byteLength,4)}},function(t,e,r){r.d(e,"a",(function(){return s}));var n=r(1),i=r.n(n),a=[255,255,255],o=0,s=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,t);var r=e.color,n=void 0===r?a:r,s=e.intensity,u=void 0===s?1:s;this.id=e.id||"ambient-".concat(o++),this.color=n,this.intensity=u,this.type="ambient"}},function(t,e,r){r.d(e,"a",(function(){return g}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(126),c=r(16);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d=[255,255,255],p=[0,0,1],m=[0,0,1],v=0,g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var r=e.color,n=void 0===r?d:r,i=e.intensity,a=void 0===i?1:i,s=e.position,u=void 0===s?m:s;this.id=e.id||"point-".concat(v++),this.color=n,this.intensity=a,this.type="point",this.position=u,this.attenuation=y(e),this.projectedLight=f({},this)}return u()(t,[{key:"getProjectedLight",value:function(t){var e=t.layer,r=this.projectedLight,n=e.context.viewport,i=e.props,a=i.coordinateSystem,o=i.coordinateOrigin,s=Object(l.b)(this.position,{viewport:n,coordinateSystem:a,coordinateOrigin:o,fromCoordinateSystem:n.isGeospatial?c.a.LNGLAT:c.a.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return r.color=this.color,r.intensity=this.intensity,r.position=s,r}}]),t}();function y(t){return"attenuation"in t?t.attenuation:"intensity"in t?[0,0,t.intensity]:p}},function(t,e,r){r.d(e,"a",(function(){return b}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(67),v=r(87),g=r(106);function y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?y(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var b=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){return o()(this,r),e.call(this,_(_({},t),{},{type:v.a}))}return u()(r,[{key:"controller",get:function(){return this._getControllerProps({type:g.b})}}]),r}(m.a);b.displayName="MapView"},function(t,e,r){r.d(e,"a",(function(){return n}));var n="3.1.5"},function(t,e,r){r.d(e,"b",(function(){return c})),r.d(e,"a",(function(){return f}));var n=r(7),i=r.n(n),a=r(41),o=r.n(a),s=r(2),u=r.n(s),l=r(84);function c(t,e){return h.apply(this,arguments)}function h(){return(h=i()(u.a.mark((function t(e,r){var n,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,e.next();case 3:if(i=(n=t.sent).value,!n.done){t.next=9;break}return e.return(),t.abrupt("return");case 9:if(!r(i)){t.next=12;break}return t.abrupt("return");case 12:t.next=0;break;case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t){return d.apply(this,arguments)}function d(){return(d=i()(u.a.mark((function t(e){var r,n,i,a,s,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=!1,i=!1,t.prev=3,s=o()(e);case 5:return t.next=7,s.next();case 7:if(!(n=!(c=t.sent).done)){t.next=13;break}r.push(c.value);case 10:n=!1,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),i=!0,a=t.t0;case 19:if(t.prev=19,t.prev=20,!n||null==s.return){t.next=24;break}return t.next=24,s.return();case 24:if(t.prev=24,!i){t.next=27;break}throw a;case 27:return t.finish(24);case 28:return t.finish(19);case 29:return t.abrupt("return",l.b.apply(void 0,r));case 30:case"end":return t.stop()}}),t,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}},function(t,e,r){r.d(e,"a",(function(){return u}));var n=r(178);function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var o=[r(99).a],s=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function u(t){var e,r=n.a.getDefaultProgramManager(t),a=i(o);try{for(a.s();!(e=a.n()).done;)r.addDefaultModule(e.value)}catch(t){a.e(t)}finally{a.f()}var u,l=i(s);try{for(l.s();!(u=l.n()).done;)r.addShaderHook(u.value)}catch(t){l.e(t)}finally{l.f()}return r}},function(t,e,r){r.d(e,"a",(function(){return O}));var n=r(12),i=r.n(n),a=r(0),o=r.n(a),s=r(1),u=r.n(s),l=r(3),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(67),y=r(45),_=r(90),b=r(27),x=r(28),w=r(142);function M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?M(Object(r),!0).forEach((function(e){o()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}var S=(new _.a).lookAt({eye:[0,0,1]});function T(t){var e=t.width,r=t.height,n=t.near,i=t.far;return e=e||1,r=r||1,(new _.a).ortho({left:-e/2,right:e/2,bottom:-r/2,top:r/2,near:n,far:i})}var C=function(t){f()(r,t);var e=E(r);function r(t){u()(this,r);var n,i=t.width,a=t.height,o=t.near,s=void 0===o?.1:o,l=t.far,c=void 0===l?1e3:l,h=t.zoom,f=void 0===h?0:h,d=t.target,p=void 0===d?[0,0,0]:d,m=t.flipY,v=void 0===m||m,g=Array.isArray(f)?f[0]:f,y=Array.isArray(f)?f[1]:f,_=Math.min(g,y),b=Math.pow(2,_);if(g!==y){var x=Math.pow(2,g),w=Math.pow(2,y);n={unitsPerMeter:[x/b,w/b,1],metersPerUnit:[b/x,b/w,1]}}return e.call(this,A(A({},t),{},{longitude:null,position:p,viewMatrix:S.clone().scale([b,b*(v?-1:1),b]),projectionMatrix:T({width:i,height:a,near:s,far:c}),zoom:_,distanceScales:n}))}return c()(r,[{key:"projectFlat",value:function(t){var e=i()(t,2),r=this.distanceScales.unitsPerMeter;return[e[0]*r[0],e[1]*r[1]]}},{key:"unprojectFlat",value:function(t){var e=i()(t,2),r=this.distanceScales.metersPerUnit;return[e[0]*r[0],e[1]*r[1]]}},{key:"panByPosition",value:function(t,e){var r=Object(b.l)(e,this.pixelUnprojectionMatrix),n=this.projectFlat(t),i=x.a([],n,x.d([],r)),a=x.a([],this.center,i);return{target:this.unprojectFlat(a)}}}]),r}(y.a),O=function(t){f()(r,t);var e=E(r);function r(t){return u()(this,r),e.call(this,A(A({},t),{},{type:C}))}return c()(r,[{key:"controller",get:function(){return this._getControllerProps({type:w.a})}}]),r}(g.a);O.displayName="OrthographicView"},function(t,e,r){r.d(e,"a",(function(){return M}));var n=r(12),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(17),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(0),y=r.n(g),_=r(14),b=r(66);function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}var w=function(t){f()(r,t);var e=x(r);function r(t){var n;return o()(this,r),n=e.call(this,t),y()(c()(n),"zoomAxis",void 0),n.zoomAxis=t.zoomAxis||"all",n}return u()(r,[{key:"_applyConstraints",value:function(t){var e=t.maxZoom,r=t.minZoom,n=t.zoom;return t.zoom=Array.isArray(n)?[Object(_.a)(n[0],r,e),Object(_.a)(n[1],r,e)]:Object(_.a)(n,r,e),t}},{key:"_calculateNewZoom",value:function(t){var e=t.startZoom,r=this._viewportProps,n=r.maxZoom,a=r.minZoom;e||0===e||(e=this._viewportProps.zoom);var o=Math.log2(t.scale);if(Array.isArray(e)){var s=e,u=i()(s,2),l=u[0],c=u[1];switch(this.zoomAxis){case"X":l=Object(_.a)(l+o,a,n);break;case"Y":c=Object(_.a)(c+o,a,n);break;default:var h=Math.min(l+o,c+o);h<a&&(o+=a-h),(h=Math.max(l+o,c+o))>n&&(o+=n-h),l+=o,c+=o}return[l,c]}return Object(_.a)(e+o,a,n)}}]),r}(r(108).a),M=function(t){f()(r,t);var e=x(r);function r(t){return o()(this,r),t.dragMode=t.dragMode||"pan",e.call(this,w,t)}return u()(r,[{key:"_onPanRotate",value:function(t){return!1}},{key:"linearTransitionProps",get:function(){return["target","zoom"]}}]),r}(b.a)},function(t,e,r){r.d(e,"a",(function(){return s}));var n=r(0),i=r.n(n);function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e){if(!e)return t;var r=o(o({},t),e);if("defines"in e&&(r.defines=o(o({},t.defines),e.defines)),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some((function(t){return"project64"===t.name})))){var n=r.modules.findIndex((function(t){return"project32"===t.name}));n>=0&&r.modules.splice(n,1)}if("inject"in e)if(t.inject){var i=o({},t.inject);for(var a in e.inject)i[a]=(i[a]||"")+e.inject[a];r.inject=i}else r.inject=e.inject;return r}},function(t,e,r){r.d(e,"a",(function(){return a}));var n=r(11),i=r.n(n);function a(t){if(null===(e=t)||"object"!==i()(e))throw new Error("count(): argument not an object");var e;if("function"==typeof t.count)return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(function(t){return null!==t&&"object"===i()(t)&&t.constructor===Object}(t))return Object.keys(t).length;throw new Error("count(): argument not a container")}},function(t,e,r){var n=r(12),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(0),v=r.n(m),g=r(16),y=r(146),_=r(51),b=r(14),x=r(80),w=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(){return o()(this,r),e.apply(this,arguments)}return u()(r,[{key:"value",get:function(){return this._value}},{key:"_onUpdate",value:function(){var t=this.settings,e=t.fromValue,r=t.toValue,n=(0,t.easing)(this.time/t.duration);this._value=Object(b.g)(e,r,n)}}]),r}(x.a);function M(t,e,r,n,i){var a=e-t;return(r-e)*i+-a*n+a+e}function A(t,e){if(Array.isArray(t)){for(var r=0,n=0;n<t.length;n++){var i=t[n]-e[n];r+=i*i}return Math.sqrt(r)}return Math.abs(t-e)}var E=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(){return o()(this,r),e.apply(this,arguments)}return u()(r,[{key:"value",get:function(){return this._currValue}},{key:"_onUpdate",value:function(){var t=this.settings,e=t.fromValue,r=t.toValue,n=this._prevValue,i=this._currValue,a=void 0===i?e:i,o=function(t,e,r,n,i){if(Array.isArray(r)){for(var a=[],o=0;o<r.length;o++)a[o]=M(t[o],e[o],r[o],n,i);return a}return M(t,e,r,n,i)}(void 0===n?e:n,a,r,t.damping,t.stiffness),s=A(o,r),u=A(o,a);s<1e-5&&u<1e-5&&(o=r,this.end()),this._prevValue=a,this._currValue=o}}]),r}(x.a),S=r(22);function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return C(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var L,I={interpolation:w,spring:E},k=function(){function t(e){o()(this,t),this.transitions=new Map,this.timeline=e}return u()(t,[{key:"active",get:function(){return this.transitions.size>0}},{key:"add",value:function(t,e,r,n){var i=this.transitions;if(i.has(t)){var a=i.get(t),o=a.value;e=void 0===o?a.settings.fromValue:o,this.remove(t)}if(n=Object(_.e)(n)){var s=I[n.type];if(s){var u=new s(this.timeline);u.start(P(P({},n),{},{fromValue:e,toValue:r})),i.set(t,u)}else S.a.error("unsupported transition type '".concat(n.type,"'"))()}}},{key:"remove",value:function(t){var e=this.transitions;e.has(t)&&(e.get(t).cancel(),e.delete(t))}},{key:"update",value:function(){var t,e={},r=T(this.transitions);try{for(r.s();!(t=r.n()).done;){var n=i()(t.value,2),a=n[0],o=n[1];o.update(),e[a]=o.value,o.inProgress||this.remove(a)}}catch(t){r.e(t)}finally{r.f()}return e}},{key:"clear",value:function(){var t,e=T(this.transitions.keys());try{for(e.s();!(t=e.n()).done;)this.remove(t.value)}catch(t){e.e(t)}finally{e.f()}}}]),t}(),R=r(123),D=r(144),B=r(36),F=r(8),j=r(40),N=r(86),U=r(143),z=r(126),G=r(75),V=r(26),H=r(70),W=r(11),$=r.n(W),q=r(115);function X(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function K(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?X(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Z=(L={},v()(L,10241,9987),v()(L,10240,9729),v()(L,10242,33071),v()(L,10243,33071),L),Y={},J=r(69);function Q(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var et={boolean:{validate:function(t,e){return!0},equal:function(t,e,r){return Boolean(t)===Boolean(e)}},number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate:function(t,e){return e.optional&&!t||at(t)&&(3===t.length||4===t.length)},equal:function(t,e,r){return rt(t,e)}},accessor:{validate:function(t,e){var r=ot(t);return"function"===r||r===ot(e.value)},equal:function(t,e,r){return"function"==typeof e||rt(t,e)}},array:{validate:function(t,e){return e.optional&&!t||at(t)},equal:function(t,e,r){return r.compare?rt(t,e):t===e}},object:{equal:function(t,e,r){return r.compare?Object(J.a)(t,e):t===e}},function:{validate:function(t,e){return e.optional&&!t||"function"==typeof t},equal:function(t,e,r){return!r.compare||t===e}},data:{transform:function(t,e,r){var n=r.props.dataTransform;return n&&t?n(t):t}},image:{transform:function(t,e,r){return function(t,e){var r=t.context&&t.context.gl;if(!r||!e)return null;if(e instanceof q.a)return e;e.constructor&&"Object"!==e.constructor.name&&(e={data:e});var n=null;e.compressed&&(n=v()({},10241,e.data.length>1?9985:9729));var i=new q.a(r,K(K({},e),{},{parameters:K(K(K({},Z),n),t.props.textureParameters)}));return Y[i.id]=!0,i}(r,t)},release:function(t){var e;(e=t)&&e instanceof q.a&&Y[e.id]&&(e.delete(),delete Y[e.id])}}};function rt(t,e){if(t===e)return!0;if(!at(t)||!at(e))return!1;var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function nt(t,e){switch(ot(e)){case"object":return it(t,e);case"array":return it(t,{type:"array",value:e,compare:!1});case"boolean":return it(t,{type:"boolean",value:e});case"number":return it(t,{type:"number",value:e});case"function":return it(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function it(t,e){return"type"in e?tt(tt({name:t},et[e.type]),e):"value"in e?tt({name:t,type:ot(e.value)},e):{name:t,type:"object",value:e}}function at(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ot(t){return at(t)?"array":null===t?"null":$()(t)}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ut(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function lt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ct(t,e){var r=ht(t.constructor),n=Object.create(r);n[V.d]=t,n[V.b]={},n[V.c]={};for(var i=0;i<e.length;++i){var a=e[i];for(var o in a)n[o]=a[o]}return Object.freeze(n),n}function ht(t){return pt(t,"_mergedDefaultProps")||(function(t){if(t.prototype){var e=Object.getPrototypeOf(t),r=ht(e),n=function(t){for(var e={},r={},n={},a=0,o=Object.entries(t);a<o.length;a++){var s=i()(o[a],2),u=s[0],l=s[1],c=null==l?void 0:l.deprecatedFor;if(c)n[u]=Array.isArray(c)?c:[c];else{var h=nt(u,l);e[u]=h,r[u]=h.value}}return{propTypes:e,defaultProps:r,deprecatedProps:n}}(pt(t,"defaultProps")||{}),a=function(t,e,r){var n=Object.create(null);Object.assign(n,e,t);var i=function(t){var e=pt(t,"layerName")||pt(t,"componentName");return e||S.a.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}(r);return delete t.id,Object.defineProperties(n,{id:{writable:!0,value:i}}),n}(n.defaultProps,r,t),o=lt(lt({},e._propTypes),n.propTypes);!function(t,e){var r={},n={};for(var i in e){var a=e[i],o=a.name;a.async&&(r[o]=a.value,n[o]=ft(o))}t[V.a]=r,t[V.b]={},Object.defineProperties(t,n)}(a,o);var s=lt(lt({},e._deprecatedProps),n.deprecatedProps);(function(t,e){var r=function(r){Object.defineProperty(t,r,{enumerable:!1,set:function(t){var n,i="".concat(this.id,": ").concat(r),a=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return st(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?st(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(e[r]);try{for(a.s();!(n=a.n()).done;){var o=n.value;dt(this,o)||(this[o]=t)}}catch(t){a.e(t)}finally{a.f()}S.a.deprecated(i,e[r].join("/"))()}})};for(var n in e)r(n)})(a,s),t._mergedDefaultProps=a,t._propTypes=o,t._deprecatedProps=s}}(t),t._mergedDefaultProps)}function ft(t){return{enumerable:!0,set:function(e){"string"==typeof e||e instanceof Promise||Object(H.c)(e)?this[V.b][t]=e:this[V.c][t]=e},get:function(){if(this[V.c]){if(t in this[V.c])return this[V.c][t]||this[V.a][t];if(t in this[V.b]){var e=this[V.d]&&this[V.d].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[V.a][t]}}return this[V.a][t]}}}function dt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function pt(t,e){return dt(t,e)&&t[e]}var mt=r(7),vt=r.n(mt),gt=r(41),yt=r.n(gt),_t=r(2),bt=r.n(_t),xt=Object.freeze({}),wt=function(){function t(e){o()(this,t),v()(this,"component",void 0),v()(this,"onAsyncPropUpdated",void 0),v()(this,"asyncProps",void 0),v()(this,"oldProps",void 0),v()(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=function(){},this.oldProps=null,this.oldAsyncProps=null}var e;return u()(t,[{key:"finalize",value:function(){for(var t in this.asyncProps){var e=this.asyncProps[t];e&&e.type&&e.type.release&&e.type.release(e.resolvedValue,e.type,this.component)}}},{key:"getOldProps",value:function(){return this.oldAsyncProps||this.oldProps||xt}},{key:"resetOldProps",value:function(){this.oldAsyncProps=null,this.oldProps=this.component.props}},{key:"hasAsyncProp",value:function(t){return t in this.asyncProps}},{key:"getAsyncProp",value:function(t){var e=this.asyncProps[t];return e&&e.resolvedValue}},{key:"isAsyncPropLoading",value:function(t){if(t){var e=this.asyncProps[t];return Boolean(e&&e.pendingLoadCount>0&&e.pendingLoadCount!==e.resolvedLoadCount)}for(var r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}},{key:"reloadAsyncProp",value:function(t,e){this._watchPromise(t,Promise.resolve(e))}},{key:"setAsyncProps",value:function(t){var e=t[V.c]||{},r=t[V.b]||t,n=t[V.a]||{};for(var i in e){var a=e[i];this._createAsyncPropData(i,n[i]),this._updateAsyncProp(i,a),e[i]=this.getAsyncProp(i)}for(var o in r){var s=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,s)}}},{key:"_fetch",value:function(t,e){return e}},{key:"_onResolve",value:function(t,e){}},{key:"_onError",value:function(t,e){}},{key:"_updateAsyncProp",value:function(t,e){this._didAsyncInputValueChange(t,e)&&("string"==typeof e&&(e=this._fetch(t,e)),e instanceof Promise?this._watchPromise(t,e):Object(H.c)(e)?this._resolveAsyncIterable(t,e):this._setPropValue(t,e))}},{key:"_freezeAsyncOldProps",value:function(){if(!this.oldAsyncProps&&this.oldProps)for(var t in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}},{key:"_didAsyncInputValueChange",value:function(t,e){var r=this.asyncProps[t];return e!==r.resolvedValue&&e!==r.lastValue&&(r.lastValue=e,!0)}},{key:"_setPropValue",value:function(t,e){this._freezeAsyncOldProps();var r=this.asyncProps[t];r&&(e=this._postProcessValue(r,e),r.resolvedValue=e,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}},{key:"_setAsyncPropValue",value:function(t,e,r){var n=this.asyncProps[t];n&&r>=n.resolvedLoadCount&&void 0!==e&&(this._freezeAsyncOldProps(),n.resolvedValue=e,n.resolvedLoadCount=r,this.onAsyncPropUpdated(t,e))}},{key:"_watchPromise",value:function(t,e){var r=this,n=this.asyncProps[t];if(n){n.pendingLoadCount++;var i=n.pendingLoadCount;e.then((function(e){e=r._postProcessValue(n,e),r._setAsyncPropValue(t,e,i),r._onResolve(t,e)})).catch((function(e){r._onError(t,e)}))}}},{key:"_resolveAsyncIterable",value:(e=vt()(bt.a.mark((function t(e,r){var n,i,a,o,s,u,l,c,h,f,d;return bt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("data"===e){t.next=3;break}return this._setPropValue(e,r),t.abrupt("return");case 3:if(n=this.asyncProps[e]){t.next=6;break}return t.abrupt("return");case 6:n.pendingLoadCount++,i=n.pendingLoadCount,a=[],o=0,s=!1,u=!1,t.prev=12,c=yt()(r);case 14:return t.next=16,c.next();case 16:if(!(s=!(h=t.sent).done)){t.next=26;break}f=h.value,a=(d=this.component.props.dataTransform)?d(f,a):a.concat(f),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:o,endRow:a.length}]}),o=a.length,this._setAsyncPropValue(e,a,i);case 23:s=!1,t.next=14;break;case 26:t.next=32;break;case 28:t.prev=28,t.t0=t.catch(12),u=!0,l=t.t0;case 32:if(t.prev=32,t.prev=33,!s||null==c.return){t.next=37;break}return t.next=37,c.return();case 37:if(t.prev=37,!u){t.next=40;break}throw l;case 40:return t.finish(37);case 41:return t.finish(32);case 42:this._onResolve(e,a);case 43:case"end":return t.stop()}}),t,this,[[12,28,32,42],[33,,37,41]])}))),function(t,r){return e.apply(this,arguments)})},{key:"_postProcessValue",value:function(t,e){var r=t.type;return r&&(r.release&&r.release(t.resolvedValue,r,this.component),r.transform)?r.transform(e,r,this.component):e}},{key:"_createAsyncPropData",value:function(t,e){if(!this.asyncProps[t]){var r=this.component&&this.component.constructor._propTypes;this.asyncProps[t]={type:r&&r[t],lastValue:null,resolvedValue:e,pendingLoadCount:0,resolvedLoadCount:0}}}}]),t}();function Mt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function At(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Mt(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Mt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Et=0,St=function(){function t(){o()(this,t),v()(this,"id",void 0),v()(this,"props",void 0),v()(this,"count",void 0),v()(this,"lifecycle",void 0),v()(this,"parent",void 0),v()(this,"context",void 0),v()(this,"state",void 0),v()(this,"internalState",void 0);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];this.props=ct(this,r),this.id=this.props.id,this.count=Et++,this.lifecycle=V.e.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}return u()(t,[{key:"root",get:function(){for(var t=this;t.parent;)t=t.parent;return t}},{key:"clone",value:function(t){var e=this.props,r={};for(var n in e[V.a])n in e[V.c]?r[n]=e[V.c][n]:n in e[V.b]&&(r[n]=e[V.b][n]);return new this.constructor(At(At(At({},e),r),t))}},{key:"_initState",value:function(){this.internalState=new wt(this)}}]),t}();v()(St,"componentName","Component"),v()(St,"defaultProps",{});var Tt=r(17),Ct=r.n(Tt),Ot=r(18),Pt=r.n(Ot),Lt=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n,i=t.attributeManager,a=t.layer;return o()(this,r),n=e.call(this,a),v()(Ct()(n),"attributeManager",void 0),v()(Ct()(n),"needsRedraw",void 0),v()(Ct()(n),"subLayers",void 0),v()(Ct()(n),"usesPickingColorCache",void 0),n.attributeManager=i,n.needsRedraw=!0,n.subLayers=null,n.usesPickingColorCache=!1,n}return u()(r,[{key:"layer",get:function(){return this.component},set:function(t){this.component=t}},{key:"_fetch",value:function(t,e){var n=this.component.props.fetch;return n?n(e,{propName:t,layer:this.layer}):Pt()(p()(r.prototype),"_fetch",this).call(this,t,e)}},{key:"_onResolve",value:function(t,e){var r=this.component.props.onDataLoad;"data"===t&&r&&r(e,{propName:t,layer:this.layer})}},{key:"_onError",value:function(t,e){this.layer.raiseError(e,"loading ".concat(t," of ").concat(this.layer))}}]),r}(wt),It=r(27),kt=r(194);function Rt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Bt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ft(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Bt(Object(r),!0).forEach((function(e){v()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Bt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return Vt}));var jt=Math.pow(2,24)-1,Nt=Object.freeze([]),Ut=Object(N.a)((function(t){return t.oldViewport.equals(t.viewport)})),zt=new Uint8ClampedArray(0),Gt={data:{type:"data",value:Nt,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:function(t){return t&&t.__diff},compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:function(t,e){var r,n=e.propName,i=e.layer,a=e.loaders,o=e.loadOptions,s=e.signal,u=i.context.resourceManager;o=o||i.getLoadOptions(),a=a||i.props.loaders,s&&(o=Ft(Ft({},o),{},{fetch:Ft(Ft({},null===(r=o)||void 0===r?void 0:r.fetch),{},{signal:s})}));var l=u.contains(t);return l||o||(u.add({resourceId:t,data:Object(kt.a)(t,a),persistent:!1}),l=!0),l?u.subscribe({resourceId:t,onChange:function(t){return i.internalState.reloadAsyncProp(n,t)},consumerId:i.id,requestId:n}):Object(kt.a)(t,a,o)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:g.c.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:g.a.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:function(t){return[0,100*-t.layerIndex]},compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Vt=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(){return o()(this,r),e.apply(this,arguments)}return u()(r,[{key:"toString",value:function(){return"".concat(this.constructor.layerName||this.constructor.name,"({id: '").concat(this.props.id,"'})")}},{key:"raiseError",value:function(t,e){var r,n,i,a;e&&(t.message="".concat(e,": ").concat(t.message)),null!==(r=(n=this.props).onError)&&void 0!==r&&r.call(n,t)||null===(i=this.context)||void 0===i||null===(a=i.onError)||void 0===a||a.call(i,t,this)}},{key:"setState",value:function(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}},{key:"setNeedsRedraw",value:function(){this.internalState&&(this.internalState.needsRedraw=!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}},{key:"setNeedsUpdate",value:function(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}},{key:"getNeedsRedraw",value:function(){return this._getNeedsRedraw(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1})}},{key:"needsUpdate",value:function(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}},{key:"hasUniformTransition",value:function(){return this.internalState.uniformTransitions.active}},{key:"isLoaded",get:function(){return this.internalState&&!this.internalState.isAsyncPropLoading()}},{key:"wrapLongitude",get:function(){return this.props.wrapLongitude}},{key:"isPickable",value:function(){return this.props.pickable&&this.props.visible}},{key:"getModels",value:function(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}},{key:"getAttributeManager",value:function(){return this.internalState&&this.internalState.attributeManager}},{key:"getCurrentLayer",value:function(){return this.internalState&&this.internalState.layer}},{key:"getLoadOptions",value:function(){return this.props.loadOptions}},{key:"project",value:function(t){var e=this.context.viewport,r=Object(z.a)(t,{viewport:e,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),n=Object(It.n)(r,e.pixelProjectionMatrix),a=i()(n,3),o=a[0],s=a[1];return 2===t.length?[o,s]:[o,s,a[2]]}},{key:"unproject",value:function(t){return this.context.viewport.unproject(t)}},{key:"projectPosition",value:function(t,e){return Object(z.b)(t,Ft({viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem},e))}},{key:"use64bitPositions",value:function(){var t=this.props.coordinateSystem;return t===g.a.DEFAULT||t===g.a.LNGLAT||t===g.a.CARTESIAN}},{key:"onHover",value:function(t,e){return!!this.props.onHover&&this.props.onHover(t,e)}},{key:"onClick",value:function(t,e){return!!this.props.onClick&&this.props.onClick(t,e)}},{key:"nullPickingColor",value:function(){return[0,0,0]}},{key:"encodePickingColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e[0]=t+1&255,e[1]=t+1>>8&255,e[2]=t+1>>8>>8&255,e}},{key:"decodePickingColor",value:function(t){Object(j.a)(t instanceof Uint8Array);var e=i()(t,3);return e[0]+256*e[1]+65536*e[2]-1}},{key:"initializeState",value:function(){throw new Error("Layer ".concat(this," has not defined initializeState"))}},{key:"getShaders",value:function(t){var e,r=Rt(this.props.extensions);try{for(r.s();!(e=r.n()).done;){var n=e.value;t=Object(U.a)(t,n.getShaders.call(this,n))}}catch(t){r.e(t)}finally{r.f()}return t}},{key:"getBounds",value:function(){var t,e=this.getAttributeManager();if(!e)return null;var r=e.attributes;return null===(t=r.positions||r.instancePositions)||void 0===t?void 0:t.getBounds()}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.propsOrDataChanged}},{key:"updateState",value:function(t){var e=t.oldProps,r=t.props,n=t.changeFlags,i=this.getAttributeManager();if(n.dataChanged&&i){var a=n.dataChanged;if(Array.isArray(a)){var o,s=Rt(a);try{for(s.s();!(o=s.n()).done;)i.invalidateAll(o.value)}catch(t){s.e(t)}finally{s.f()}}else i.invalidateAll()}var u=Number.isInteger(e.highlightedObjectIndex)||e.pickable,l=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(u!==l&&i){var c=i.attributes,h=c.pickingColors||c.instancePickingColors;h&&(l&&h.constant&&(h.constant=!1,i.invalidate(h.id)),h.value||l||(h.constant=!0,h.value=[0,0,0]))}}},{key:"finalizeState",value:function(){var t,e=Rt(this.getModels());try{for(e.s();!(t=e.n()).done;)t.value.delete()}catch(t){e.e(t)}finally{e.f()}var r=this.getAttributeManager();r&&r.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}},{key:"draw",value:function(t){var e,r=Rt(this.getModels());try{for(r.s();!(e=r.n()).done;)e.value.draw(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"getPickingInfo",value:function(t){var e=t.info,r=e.index;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}},{key:"activateViewport",value:function(t){var e=this.internalState.viewport;this.internalState.viewport=t,e&&Ut({oldViewport:e,viewport:t})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}},{key:"invalidateAttribute",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all",e=this.getAttributeManager();e&&("all"===t?e.invalidateAll():e.invalidate(t))}},{key:"updateAttributes",value:function(t){var e,r=Rt(this.getModels());try{for(r.s();!(e=r.n()).done;)this._setModelAttributes(e.value,t)}catch(t){r.e(t)}finally{r.f()}}},{key:"_updateAttributes",value:function(t){var e=this.getAttributeManager();if(e){var r=this.getNumInstances(t),n=this.getStartIndices(t);e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this,ignoreUnknownAttributes:!0});var i=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}}},{key:"_updateAttributeTransition",value:function(){var t=this.getAttributeManager();t&&t.updateTransition()}},{key:"_updateUniformTransition",value:function(){var t=this.internalState.uniformTransitions;if(t.active){var e=t.update(),r=Object.create(this.props);for(var n in e)Object.defineProperty(r,n,{value:e[n]});return r}return this.props}},{key:"calculateInstancePickingColors",value:function(t,e){var r=e.numInstances;if(!t.constant){var n=Math.floor(zt.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>jt&&S.a.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),zt=G.a.allocate(zt,r,{size:3,copy:!0,maxCount:Math.max(r,jt)});for(var i=Math.floor(zt.length/3),a=[],o=n;o<i;o++)this.encodePickingColor(o,a),zt[3*o+0]=a[0],zt[3*o+1]=a[1],zt[3*o+2]=a[2]}t.value=zt.subarray(0,3*r)}}},{key:"_setModelAttributes",value:function(t,e){var r=this.getAttributeManager().getShaderAttributes(e,t.userData.excludeAttributes||{});t.setAttributes(r)}},{key:"disablePickingIndex",value:function(t){this._disablePickingIndex(t)}},{key:"_disablePickingIndex",value:function(t){var e=this.getAttributeManager().attributes,r=e.pickingColors||e.instancePickingColors,n=r.getVertexOffset(t),i=r.getVertexOffset(t+1);r.buffer.subData({data:new Uint8Array(i-n),offset:n})}},{key:"restorePickingColors",value:function(){var t=this.getAttributeManager().attributes,e=t.pickingColors||t.instancePickingColors;this.internalState.usesPickingColorCache&&e.value.buffer!==zt.buffer&&(e.value=zt.subarray(0,e.value.length)),e.updateSubBuffer({startOffset:0})}},{key:"getNumInstances",value:function(t){return void 0!==(t=t||this.props).numInstances?t.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:Object(D.a)(t.data)}},{key:"getStartIndices",value:function(t){return void 0!==(t=t||this.props).startIndices?t.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}},{key:"_initialize",value:function(){Object(B.a)("layer.initialize",this),this._initState(),this.initializeState(this.context);var t,e=Rt(this.props.extensions);try{for(e.s();!(t=e.n()).done;){var r=t.value;r.initializeState.call(this,this.context,r)}}catch(t){e.e(t)}finally{e.f()}this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}},{key:"_update",value:function(){var t=this.needsUpdate();Object(B.a)("layer.update",this,t),t&&this._updateState()}},{key:"_updateState",value:function(){var t=this.props,e=this.context.viewport,r=this._updateUniformTransition();this.internalState.propsInTransition=r,this.context.viewport=this.internalState.viewport||e,this.props=r;try{var n=this._getUpdateParams(),i=this.getModels();if(this.context.gl)this.updateState(n);else try{this.updateState(n)}catch(t){}var a,o=Rt(this.props.extensions);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.updateState.call(this,n,s)}}catch(t){o.e(t)}finally{o.f()}var u=this.getModels()[0]!==i[0];this._updateModules(n,u),this.isComposite?this._renderLayers(n):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=e,this.props=t,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}},{key:"_finalize",value:function(){Object(B.a)("layer.finalize",this),this.finalizeState(this.context);var t,e=Rt(this.props.extensions);try{for(e.s();!(t=e.n()).done;){var r=t.value;r.finalizeState.call(this,r)}}catch(t){e.e(t)}finally{e.f()}}},{key:"drawLayer",value:function(t){var e=this,r=t.moduleParameters,n=void 0===r?null:r,i=t.uniforms,a=void 0===i?{}:i,o=t.parameters,s=void 0===o?{}:o;this._updateAttributeTransition();var u=this.props;this.props=this.internalState.propsInTransition||u,a.opacity=Math.pow(this.props.opacity,1/2.2);try{n&&this.setModuleParameters(n);var l=this.props.getPolygonOffset,c=l&&l(a)||[0,0];Object(F.n)(this.context.gl,{polygonOffset:c}),Object(F.o)(this.context.gl,s,(function(){var t,r={moduleParameters:n,uniforms:a,parameters:s,context:e.context},i=Rt(e.props.extensions);try{for(i.s();!(t=i.n()).done;){var o=t.value;o.draw.call(e,r,o)}}catch(t){i.e(t)}finally{i.f()}e.draw(r)}))}finally{this.props=u}}},{key:"getChangeFlags",value:function(){return this.internalState.changeFlags}},{key:"setChangeFlags",value:function(t){var e=this.internalState.changeFlags;for(var r in t)if(t[r]){var n=!1;"dataChanged"===r&&Array.isArray(e[r])&&(e[r]=Array.isArray(t[r])?e[r].concat(t[r]):t[r],n=!0),e[r]||(e[r]=t[r],n=!0),n&&Object(B.a)("layer.changeFlag",this,r,t)}var i=e.dataChanged||e.updateTriggersChanged||e.propsChanged||e.extensionsChanged;e.propsOrDataChanged=i,e.somethingChanged=i||t.viewportChanged||t.stateChanged}},{key:"clearChangeFlags",value:function(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}},{key:"diffProps",value:function(t,e){var r=Object(R.b)(t,e);if(r.updateTriggersChanged)for(var n in r.updateTriggersChanged)r.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(r.transitionsChanged)for(var i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,e[i],t[i],t.transitions[i]);return this.setChangeFlags(r)}},{key:"validateProps",value:function(){Object(R.c)(this.props)}},{key:"setModuleParameters",value:function(t){var e,r=Rt(this.getModels());try{for(r.s();!(e=r.n()).done;)e.value.updateModuleSettings(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"updateAutoHighlight",value:function(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}},{key:"_updateAutoHighlight",value:function(t){var e={pickingSelectedColor:t.picked?t.color:null},r=this.props.highlightColor;t.picked&&"function"==typeof r&&(e.pickingHighlightColor=r(t)),this.setModuleParameters(e),this.setNeedsRedraw()}},{key:"_updateModules",value:function(t,e){var r=t.props,n=t.oldProps,i=r.autoHighlight,a=r.highlightedObjectIndex,o=r.highlightColor;if(e||n.autoHighlight!==i||n.highlightedObjectIndex!==a||n.highlightColor!==o){var s={};i||(s.pickingSelectedColor=null),Array.isArray(o)&&(s.pickingHighlightColor=o),Number.isInteger(a)&&(s.pickingSelectedColor=a>=0?this.encodePickingColor(a):null),this.setModuleParameters(s)}}},{key:"_getUpdateParams",value:function(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}},{key:"_getNeedsRedraw",value:function(t){if(!this.internalState)return!1;var e=!1;e=e||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags;var r=this.getAttributeManager(),n=r&&r.getNeedsRedraw(t);return e||n}},{key:"_getAttributeManager",value:function(){return new y.a(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}},{key:"_initState",value:function(){Object(j.a)(!this.internalState&&!this.state),Object(j.a)(isFinite(this.props.coordinateSystem));var t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Lt({attributeManager:t,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:function(){return S.a.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),t}}),this.internalState.layer=this,this.internalState.uniformTransitions=new k(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}},{key:"_transferState",value:function(t){Object(B.a)("layer.matched",this,this===t);var e=t.state;this!==t&&(this.internalState=t.internalState,this.internalState.layer=this,this.state=e,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}},{key:"_onAsyncPropUpdated",value:function(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}]),r}(St);Vt.layerName="Layer",Vt.defaultProps=Gt},function(t,e,r){var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(12),c=r.n(l),h=r(18),f=r.n(h),d=r(6),p=r.n(d),m=r(9),v=r.n(m),g=r(5),y=r.n(g),_=r(276),b=r(176),x=r(38);function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function M(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var A=function(){function t(e,r){o()(this,t),this.opts=r,this.source=e}return u()(t,[{key:"value",get:function(){return this.source.value}},{key:"getValue",value:function(){var t=this.source.getBuffer(),e=this.getAccessor();if(t)return[t,e];var r=this.source.value,n=e.size,i=r;if(r&&r.length!==n){i=new Float32Array(n);for(var a=e.elementOffset||0,o=0;o<n;++o)i[o]=r[a+o]}return i}},{key:"getAccessor",value:function(){return M(M({},this.source.getAccessor()),this.opts)}}]),t}(),E=r(75),S=r(39),T=r(22);function C(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function O(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?C(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function P(t){return t.stride||t.size*t.bytesPerElement}function L(t,e){e.offset&&T.a.removed("shaderAttribute.offset","vertexOffset, elementOffset")();var r=P(t),n=("vertexOffset"in e?e.vertexOffset:t.vertexOffset||0)*r+(e.elementOffset||0)*t.bytesPerElement+(t.offset||0);return O(O({},e),{},{offset:n,stride:r})}var I=function(){function t(e,r){o()(this,t),this.gl=e,this.id=r.id,this.size=r.size;var n=r.logicalType||r.type,i=5130===n,a=r.defaultValue;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0),r.defaultValue=a;var s=n;i?s=5126:!s&&r.isIndexed?s=e&&Object(_.b)(e,b.a.ELEMENT_INDEX_UINT32)?5125:5123:s||(s=5126),r.logicalType=n,r.type=s;var u=function(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}(n||s||5126);this.shaderAttributes={},this.doublePrecision=i,i&&!1===r.fp64&&(u=Float32Array),r.bytesPerElement=u.BYTES_PER_ELEMENT,this.defaultType=u,this.value=null,this.settings=r,this.state={externalBuffer:null,bufferAccessor:r,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null,this.setData(r)}return u()(t,[{key:"buffer",get:function(){if(!this._buffer){var t=this.settings;this._buffer=new x.a(this.gl,{id:this.id,target:t.isIndexed?34963:34962,accessor:{type:t.type}})}return this._buffer}},{key:"byteOffset",get:function(){var t=this.getAccessor();return t.vertexOffset?t.vertexOffset*P(t):0}},{key:"numInstances",get:function(){return this.state.numInstances},set:function(t){this.state.numInstances=t}},{key:"delete",value:function(){this._buffer&&(this._buffer.delete(),this._buffer=null),E.a.release(this.state.allocatedValue)}},{key:"getShaderAttributes",value:function(t,e){if(this.doublePrecision){var r={},n=this.value instanceof Float64Array,a={high:s=L(o=this.getAccessor(),e||{}),low:O(O({},s),{},{offset:s.offset+4*o.size})};return r[t]=new A(this,a.high),r["".concat(t,"64Low")]=n?new A(this,a.low):new Float32Array(this.size),r}var o,s;if(e){var u=L(this.getAccessor(),e);return i()({},t,new A(this,u))}return i()({},t,this)}},{key:"getBuffer",value:function(){return this.state.constant?null:this.state.externalBuffer||this._buffer}},{key:"getValue",value:function(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}},{key:"getAccessor",value:function(){return this.state.bufferAccessor}},{key:"getBounds",value:function(){if(this.state.bounds)return this.state.bounds;var t=null;if(this.state.constant){var e=this.value.slice();t=[e,e]}else{var r=this.value,n=this.size,i=this.numInstances*n;if(r&&i&&r.length>=i){for(var a=new Array(n).fill(1/0),o=new Array(n).fill(-1/0),s=0;s<i;)for(var u=0;u<n;u++){var l=r[s++];l<a[u]&&(a[u]=l),l>o[u]&&(o[u]=l)}t=[a,o]}}return this.state.bounds=t,t}},{key:"setData",value:function(t){var e=this.state;ArrayBuffer.isView(t)?t={value:t}:t instanceof x.a&&(t={buffer:t});var r=O(O({},this.settings),t);if(e.bufferAccessor=r,e.bounds=null,t.constant){var n=t.value;if(n=this._normalizeValue(n,[],0),this.settings.normalized&&(n=this._normalizeConstant(n)),e.constant&&this._areValuesEqual(n,this.value))return!1;e.externalBuffer=null,e.constant=!0,this.value=n}else if(t.buffer){var i=t.buffer;e.externalBuffer=i,e.constant=!1,this.value=t.value;var a=t.value instanceof Float64Array;r.type=t.type||i.accessor.type,r.bytesPerElement=i.accessor.BYTES_PER_ELEMENT*(a?2:1),r.stride=P(r)}else if(t.value){this._checkExternalBuffer(t);var o=t.value;e.externalBuffer=null,e.constant=!1,this.value=o,r.bytesPerElement=o.BYTES_PER_ELEMENT,r.stride=P(r);var s=this.buffer,u=this.byteOffset;this.doublePrecision&&o instanceof Float64Array&&(o=Object(S.f)(o,r));var l=o.byteLength+u+2*r.stride;s.byteLength<l&&s.reallocate(l),s.setAccessor(null),s.subData({data:o,offset:u}),r.type=t.type||s.accessor.type}return!0}},{key:"updateSubBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.bounds=null;var e=this.value,r=t.startOffset,n=void 0===r?0:r,i=t.endOffset;this.buffer.subData({data:this.doublePrecision&&e instanceof Float64Array?Object(S.f)(e,{size:this.size,startIndex:n,endIndex:i}):e.subarray(n,i),offset:n*e.BYTES_PER_ELEMENT+this.byteOffset})}},{key:"allocate",value:function(t){var e=t.copy,r=void 0!==e&&e,n=this.state,i=n.allocatedValue,a=E.a.allocate(i,t.numInstances+1,{size:this.size,type:this.defaultType,copy:r});this.value=a;var o=this.buffer,s=this.byteOffset;return o.byteLength<a.byteLength+s&&(o.reallocate(a.byteLength+s),r&&i&&o.subData({data:i instanceof Float64Array?Object(S.f)(i,this):i,offset:s})),n.allocatedValue=a,n.constant=!1,n.externalBuffer=null,n.bufferAccessor=this.settings,!0}},{key:"_checkExternalBuffer",value:function(t){var e=t.value;if(!t.constant&&e){var r=this.defaultType,n=!1;if(this.doublePrecision&&(n=e.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(e.constructor.name));e instanceof r||!this.settings.normalized||"normalized"in t||T.a.warn("Attribute ".concat(this.id," is normalized"))()}}},{key:"_normalizeConstant",value:function(t){switch(this.settings.type){case 5120:return new Float32Array(t).map((function(t){return(t+128)/255*2-1}));case 5122:return new Float32Array(t).map((function(t){return(t+32768)/65535*2-1}));case 5121:return new Float32Array(t).map((function(t){return t/255}));case 5123:return new Float32Array(t).map((function(t){return t/65535}));default:return t}}},{key:"_normalizeValue",value:function(t,e,r){var n=this.settings,i=n.defaultValue,a=n.size;if(Number.isFinite(t))return e[r]=t,e;if(!t)return e[r]=i[0],e;switch(a){case 4:e[r+3]=Number.isFinite(t[3])?t[3]:i[3];case 3:e[r+2]=Number.isFinite(t[2])?t[2]:i[2];case 2:e[r+1]=Number.isFinite(t[1])?t[1]:i[1];case 1:e[r+0]=Number.isFinite(t[0])?t[0]:i[0];break;default:for(var o=a;--o>=0;)e[r+o]=Number.isFinite(t[o])?t[o]:i[o]}return e}},{key:"_areValuesEqual",value:function(t,e){if(!t||!e)return!1;for(var r=this.size,n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}}]),t}(),k=r(40),R=r(70),D=r(74),B=[],F=[[0,1/0]];function j(t,e){if(t===F)return t;if(e[0]<0&&(e[0]=0),e[0]>=e[1])return t;for(var r=[],n=t.length,i=0,a=0;a<n;a++){var o=t[a];o[1]<e[0]?(r.push(o),i=a+1):o[0]>e[1]?r.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return r.splice(i,0,e),r}var N=r(51);function U(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?z(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var G=function(t){p()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=y()(t);if(e){var i=y()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return v()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,r),n=e.call(this,t,i);var a=i.transition,s=i.noAlloc,u=i.update,l=i.accessor,c=void 0===l?null:l,h=i.transform,f=i.startIndices,d=void 0===f?null:f;return Object.assign(n.settings,{transition:void 0!==a&&a,noAlloc:void 0!==s&&s,update:(void 0===u?null:u)||c&&n._autoUpdater,accessor:c,transform:void 0===h?null:h}),Object.assign(n.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:F,startIndices:d}),Object.seal(n.settings),Object.seal(n.state),n._validateAttributeUpdaters(),n}return u()(r,[{key:"startIndices",get:function(){return this.state.startIndices},set:function(t){this.state.startIndices=t}},{key:"needsUpdate",value:function(){return this.state.needsUpdate}},{key:"needsRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).clearChangedFlags,e=this.state.needsRedraw;return this.state.needsRedraw=e&&!(void 0!==t&&t),e}},{key:"getUpdateTriggers",value:function(){var t=this.settings.accessor;return[this.id].concat("function"!=typeof t&&t||[])}},{key:"supportsTransition",value:function(){return Boolean(this.settings.transition)}},{key:"getTransitionSetting",value:function(t){if(!t||!this.supportsTransition())return null;var e=this.settings.accessor,r=this.settings.transition,n=Array.isArray(e)?t[e.find((function(e){return t[e]}))]:t[e];return Object(N.e)(n,r)}},{key:"setNeedsUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id,e=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),e){var r=e.startRow,n=e.endRow;this.state.updateRanges=j(this.state.updateRanges,[void 0===r?0:r,void 0===n?1/0:n])}else this.state.updateRanges=F}},{key:"clearNeedsUpdate",value:function(){this.state.needsUpdate=!1,this.state.updateRanges=B}},{key:"setNeedsRedraw",value:function(){this.state.needsRedraw=this.state.needsRedraw||(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.id)}},{key:"update",value:function(t){this.setData(t)}},{key:"allocate",value:function(t){var e=this.state,n=this.settings;return!n.noAlloc&&!!n.update&&(f()(y()(r.prototype),"allocate",this).call(this,{numInstances:t,copy:e.updateRanges!==F}),!0)}},{key:"updateBuffer",value:function(t){var e=t.numInstances,n=t.data,i=t.props,a=t.context;if(!this.needsUpdate())return!1;var o=this.state.updateRanges,s=this.settings,u=s.update,l=s.noAlloc,h=!0;if(u){var d,p=U(o);try{for(p.s();!(d=p.n()).done;){var m=c()(d.value,2);u.call(a,this,{data:n,startRow:m[0],endRow:m[1],props:i,numInstances:e})}}catch(t){p.e(t)}finally{p.f()}if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else{var v,g=U(o);try{for(g.s();!(v=g.n()).done;){var _=c()(v.value,2),b=_[0],x=_[1],w=Number.isFinite(b)?this.getVertexOffset(b):0,M=Number.isFinite(x)?this.getVertexOffset(x):l||!Number.isFinite(e)?this.value.length:e*this.size;f()(y()(r.prototype),"updateSubBuffer",this).call(this,{startOffset:w,endOffset:M})}}catch(t){g.e(t)}finally{g.f()}}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}},{key:"setConstantValue",value:function(t){return void 0!==t&&"function"!=typeof t&&(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}},{key:"setExternalBuffer",value:function(t){var e=this.state;return t?(this.clearNeedsUpdate(),e.lastExternalBuffer===t||(e.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t),!0)):(e.lastExternalBuffer=null,!1)}},{key:"setBinaryValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.state,n=this.settings;if(!t)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===t)return this.clearNeedsUpdate(),!0;if(r.binaryValue=t,this.setNeedsRedraw(),ArrayBuffer.isView(t)&&(t={value:t}),n.transform||e!==this.startIndices){Object(k.a)(ArrayBuffer.isView(t.value),"invalid ".concat(n.accessor));var i=t.size&&t.size!==this.size;return r.binaryAccessor=Object(R.b)(t.value,{size:t.size||this.size,stride:t.stride,offset:t.offset,startIndices:e,nested:i}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}},{key:"getVertexOffset",value:function(t){var e=this.startIndices;return(e?e[t]:t)*this.size}},{key:"getShaderAttributes",value:function(){var t=this.settings.shaderAttributes||i()({},this.id,null),e={};for(var n in t)Object.assign(e,f()(y()(r.prototype),"getShaderAttributes",this).call(this,n,t[n]));return e}},{key:"_autoUpdater",value:function(t,e){var r=e.data,n=e.startRow,i=e.endRow,a=e.numInstances;if(!t.constant){var o=t.settings,s=t.value,u=t.size,l=t.startIndices,c=o.accessor,h=o.transform,f=t.state.binaryAccessor||("function"==typeof c?c:e.props[c]);Object(k.a)("function"==typeof f,'accessor "'.concat(c,'" is not a function'));var d,p=t.getVertexOffset(n),m=Object(R.a)(r,n,i),v=m.objectInfo,g=U(m.iterable);try{for(g.s();!(d=g.n()).done;){var y=d.value;v.index++;var _=f(y,v);if(h&&(_=h.call(this,_)),l){var b=(v.index<l.length-1?l[v.index+1]:a)-l[v.index];if(_&&Array.isArray(_[0])){var x,w=p,M=U(_);try{for(M.s();!(x=M.n()).done;)t._normalizeValue(x.value,s,w),w+=u}catch(t){M.e(t)}finally{M.f()}}else _&&_.length>u?s.set(_,p):(t._normalizeValue(_,v.target,0),Object(D.a)({target:s,source:v.target,start:p,count:b}));p+=b*u}else t._normalizeValue(_,s,p),p+=u}}catch(t){g.e(t)}finally{g.f()}}}},{key:"_validateAttributeUpdaters",value:function(){var t=this.settings;if(!t.noAlloc&&"function"!=typeof t.update)throw new Error("Attribute ".concat(this.id," missing update or accessor"))}},{key:"_checkAttributeArray",value:function(){var t=this.value,e=Math.min(4,this.size);if(t&&t.length>=e){var r=!0;switch(e){case 4:r=r&&Number.isFinite(t[3]);case 3:r=r&&Number.isFinite(t[2]);case 2:r=r&&Number.isFinite(t[1]);case 1:r=r&&Number.isFinite(t[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}]),r}(I),V=r(36),H=r(294),W=r(80);function $(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var K=function(){function t(e){var r=e.gl,n=e.attribute,i=e.timeline;o()(this,t),this.gl=r,this.type="interpolation",this.transition=new W.a(i),this.attribute=n,this.attributeInTransition=new G(r,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=function(t,e){var r=Object(N.c)(e.size);return new H.a(t,{vs:"\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nattribute ATTRIBUTE_TYPE aFrom;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"]})}(r,n);var a={byteLength:0,usage:35050};this.buffers=[new x.a(r,a),new x.a(r,a)]}return u()(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(t,e){if(t.duration<=0)this.transition.cancel();else{var r=this.gl,n=this.buffers,i=this.attribute;Object(N.a)(n);var a,o={numInstances:e,attribute:i,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter},s=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return X(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;Object(N.f)(q({buffer:u},o))}}catch(t){s.e(t)}finally{s.f()}this.currentStartIndices=i.startIndices,this.currentLength=Object(N.b)(i,e),this.attributeInTransition.update({buffer:n[1],value:i.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/i.size),sourceBuffers:{aFrom:n[0],aTo:Object(N.d)(r,i)},feedbackBuffers:{vCurrent:n[1]}})}}},{key:"update",value:function(){var t=this.transition.update();if(t){var e=this.transition,r=e.settings,n=(0,r.easing)(e.time/r.duration);this.transform.run({uniforms:{time:n}})}return t}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}}]),t}(),Z=r(180),Y=r(115),J=r(79);function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function tt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function et(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var rt={interpolation:K,spring:function(){function t(e){var r=e.gl,n=e.attribute,a=e.timeline;o()(this,t),this.gl=r,this.type="spring",this.transition=new W.a(a),this.attribute=n,this.attributeInTransition=new G(r,et(et({},n.settings),{},{normalized:!1})),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=function(t){return new Y.a(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}(r),this.framebuffer=function(t,e){return new J.a(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:i()({},36064,e)})}(r,this.texture),this.transform=function(t,e,r){var n=Object(N.c)(e.size);return new H.a(t,{framebuffer:r,vs:"\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nattribute ATTRIBUTE_TYPE aPrev;\nattribute ATTRIBUTE_TYPE aCur;\nattribute ATTRIBUTE_TYPE aTo;\nvarying ATTRIBUTE_TYPE vNext;\nvarying float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nvarying float vIsTransitioningFlag;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  gl_FragColor = vec4(1.0);\n}",defines:{ATTRIBUTE_TYPE:n},varyings:["vNext"]})}(r,n,this.framebuffer);var s={byteLength:0,usage:35050};this.buffers=[new x.a(r,s),new x.a(r,s),new x.a(r,s)]}return u()(t,[{key:"inProgress",get:function(){return this.transition.inProgress}},{key:"start",value:function(t,e){var r,n=this.gl,i=this.buffers,a=this.attribute,o={numInstances:e,attribute:a,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:t.enter},s=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(i);try{for(s.s();!(r=s.n()).done;){var u=r.value;Object(N.f)(et({buffer:u},o))}}catch(t){s.e(t)}finally{s.f()}this.currentStartIndices=a.startIndices,this.currentLength=Object(N.b)(a,e),this.attributeInTransition.update({buffer:i[1],value:a.value}),this.transition.start(t),this.transform.update({elementCount:Math.floor(this.currentLength/a.size),sourceBuffers:{aTo:Object(N.d)(n,a)}})}},{key:"update",value:function(){var t=this.buffers,e=this.transform,r=this.framebuffer,n=this.transition;return!!n.update()&&(e.update({sourceBuffers:{aPrev:t[0],aCur:t[1]},feedbackBuffers:{vNext:t[2]}}),e.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:n.settings.stiffness,damping:n.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),Object(N.a)(t),this.attributeInTransition.update({buffer:t[1],value:this.attribute.value}),Object(Z.c)(r)[0]>0||n.end(),!0)}},{key:"cancel",value:function(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}]),t}()},nt=function(){function t(e,r){var n=r.id,i=r.timeline;o()(this,t),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=H.a.isSupported(e)}return u()(t,[{key:"finalize",value:function(){for(var t in this.transitions)this._removeTransition(t)}},{key:"update",value:function(t){var e=t.attributes,r=t.transitions,n=t.numInstances;for(var i in this.numInstances=n||1,e){var a=e[i],o=a.getTransitionSetting(r);o&&this._updateAttribute(i,a,o)}for(var s in this.transitions){var u=e[s];u&&u.getTransitionSetting(r)||this._removeTransition(s)}}},{key:"hasAttribute",value:function(t){var e=this.transitions[t];return e&&e.inProgress}},{key:"getAttributes",value:function(){var t={};for(var e in this.transitions){var r=this.transitions[e];r.inProgress&&(t[e]=r.attributeInTransition)}return t}},{key:"run",value:function(){if(!this.isSupported||0===this.numInstances)return!1;for(var t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);var e=this.needsRedraw;return this.needsRedraw=!1,e}},{key:"_removeTransition",value:function(t){this.transitions[t].cancel(),delete this.transitions[t]}},{key:"_updateAttribute",value:function(t,e,r){var n=this.transitions[t],i=!n||n.type!==r.type;if(i){if(!this.isSupported)return void T.a.warn("WebGL2 not supported by this browser. Transition for ".concat(t," is disabled."))();n&&this._removeTransition(t);var a=rt[r.type];a?this.transitions[t]=new a({attribute:e,timeline:this.timeline,gl:this.gl}):(T.a.error("unsupported transition type '".concat(r.type,"'"))(),i=!1)}(i||e.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(r,this.numInstances))}}]),t}();function it(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function at(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?it(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return ot}));var ot=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.id,i=void 0===n?"attribute-manager":n,a=r.stats,s=r.timeline;o()(this,t),this.id=i,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=a,this.attributeTransitionManager=new nt(e,{id:"".concat(i,"-transitions"),timeline:s}),Object.seal(this)}return u()(t,[{key:"finalize",value:function(){for(var t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}},{key:"getNeedsRedraw",value:function(){var t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags,t&&this.id}},{key:"setNeedsRedraw",value:function(){return this.needsRedraw=!0,this}},{key:"add",value:function(t,e){this._add(t,e)}},{key:"addInstanced",value:function(t,e){this._add(t,e,{instanced:1})}},{key:"remove",value:function(t){for(var e=0;e<t.length;e++){var r=t[e];void 0!==this.attributes[r]&&(this.attributes[r].delete(),delete this.attributes[r])}}},{key:"invalidate",value:function(t,e){var r=this._invalidateTrigger(t,e);Object(V.a)("attributeManager.invalidate",this,t,r)}},{key:"invalidateAll",value:function(t){for(var e in this.attributes)this.attributes[e].setNeedsUpdate(e,t);Object(V.a)("attributeManager.invalidate",this,"all")}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.data,r=t.numInstances,n=t.startIndices,i=void 0===n?null:n,a=t.transitions,o=t.props,s=void 0===o?{}:o,u=t.buffers,l=void 0===u?{}:u,c=t.context,h=void 0===c?{}:c,f=!1;for(var d in Object(V.a)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){var p=this.attributes[d],m=p.settings.accessor;p.startIndices=i,p.numInstances=r,s[d]&&T.a.removed("props.".concat(d),"data.attributes.".concat(d))(),p.setExternalBuffer(l[d])||p.setBinaryValue(l[m],e.startIndices)||!l[m]&&p.setConstantValue(s[m])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:r,data:e,props:s,context:h})),this.needsRedraw|=p.needsRedraw()}f&&Object(V.a)("attributeManager.updateEnd",this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:a})}},{key:"updateTransition",value:function(){var t=this.attributeTransitionManager.run();return this.needsRedraw=this.needsRedraw||t,t}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getChangedAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearChangedFlags:!1},e=this.attributes,r=this.attributeTransitionManager,n=at({},r.getAttributes());for(var i in e){var a=e[i];a.needsRedraw(t)&&!r.hasAttribute(i)&&(n[i]=a)}return n}},{key:"getShaderAttributes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t||(t=this.getAttributes());var r={};for(var n in t)e[n]||Object.assign(r,t[n].getShaderAttributes());return r}},{key:"getAccessors",value:function(){return this.updateTriggers}},{key:"_add",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(var n in e&&T.a.warn("AttributeManager.add({updaters}) - updater map no longer supported")(),t)this.attributes[n]=this._createAttribute(n,t[n],r);this._mapUpdateTriggersToAttributes()}},{key:"_createAttribute",value:function(t,e,r){var n=at(at({},e),{},{id:t,isIndexed:e.isIndexed||e.elements||!1,constant:e.constant||!1,size:(e.elements?1:e.size)||1,value:e.value||null,divisor:e.instanced||r.instanced?1:e.divisor||0});return new G(this.gl,n)}},{key:"_mapUpdateTriggersToAttributes",value:function(){var t=this,e={},r=function(r){t.attributes[r].getUpdateTriggers().forEach((function(t){e[t]||(e[t]=[]),e[t].push(r)}))};for(var n in this.attributes)r(n);this.updateTriggers=e}},{key:"_invalidateTrigger",value:function(t,e){var r=this.attributes,n=this.updateTriggers[t];return n&&n.forEach((function(t){var n=r[t];n&&n.setNeedsUpdate(n.id,e)})),n}},{key:"_updateAttribute",value:function(t){var e=t.attribute,r=t.numInstances;Object(V.a)("attribute.updateStart",e),e.constant?e.setConstantValue(e.value):(e.allocate(r)&&Object(V.a)("attribute.allocate",e,r),e.updateBuffer(t)&&(this.needsRedraw=!0,Object(V.a)("attribute.updateEnd",e,r)))}}]),t}()},function(t,e,r){var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(290),c=r(26),h=r(22),f=r(36),d=r(74),p=r(92),m=r(194);function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var g=function(){function t(e,r,n){o()(this,t),this.id=e,this.context=n,this._loadCount=0,this._subscribers=new Set,this.setData(r)}return u()(t,[{key:"subscribe",value:function(t){this._subscribers.add(t)}},{key:"unsubscribe",value:function(t){this._subscribers.delete(t)}},{key:"inUse",value:function(){return this._subscribers.size>0}},{key:"delete",value:function(){}},{key:"getData",value:function(){var t=this;return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((function(){return t.getData()}))}},{key:"setData",value:function(t,e){var r=this;if(t!==this._data||e){this._data=t;var n=++this._loadCount,i=t;"string"==typeof t&&(i=Object(m.a)(t)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((function(t){r._loadCount===n&&(r.isLoaded=!0,r._error=null,r._content=t)})).catch((function(t){r._loadCount===n&&(r.isLoaded=!0,r._error=t||!0)}))):(this.isLoaded=!0,this._error=null,this._content=t);var a,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return v(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this._subscribers);try{for(o.s();!(a=o.n()).done;)a.value.onChange(this.getData())}catch(t){o.e(t)}finally{o.f()}}}}]),t}(),y=function(){function t(e){var r=e.gl,n=e.protocol;o()(this,t),this.protocol=n||"resource://",this._context={gl:r,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}return u()(t,[{key:"contains",value:function(t){return!!t.startsWith(this.protocol)||t in this._resources}},{key:"add",value:function(t){var e=t.resourceId,r=t.data,n=t.forceUpdate,i=t.persistent,a=void 0===i||i,o=this._resources[e];o?o.setData(r,void 0!==n&&n):(o=new g(e,r,this._context),this._resources[e]=o),o.persistent=a}},{key:"remove",value:function(t){var e=this._resources[t];e&&(e.delete(),delete this._resources[t])}},{key:"unsubscribe",value:function(t){var e=t.consumerId,r=this._consumers[e];if(r){for(var n in r){var i=r[n];i.resource&&i.resource.unsubscribe(i)}delete this._consumers[e],this.prune()}}},{key:"subscribe",value:function(t){var e=t.resourceId,r=t.onChange,n=t.consumerId,i=t.requestId,a=void 0===i?"default":i,o=this._resources,s=this.protocol;e.startsWith(s)&&(o[e=e.replace(s,"")]||this.add({resourceId:e,data:null,persistent:!1}));var u=o[e];if(this._track(n,a,u,r),u)return u.getData()}},{key:"prune",value:function(){var t=this;this._pruneRequest||(this._pruneRequest=setTimeout((function(){return t._prune()}),0))}},{key:"finalize",value:function(){for(var t in this._resources)this._resources[t].delete()}},{key:"_track",value:function(t,e,r,n){var i=this._consumers,a=i[t]=i[t]||{},o=a[e]||{};o.resource&&(o.resource.unsubscribe(o),o.resource=null,this.prune()),r&&(a[e]=o,o.onChange=n,o.resource=r,r.subscribe(o))}},{key:"_prune",value:function(){this._pruneRequest=null;for(var t=0,e=Object.keys(this._resources);t<e.length;t++){var r=e[t],n=this._resources[r];n.persistent||n.inUse()||(n.delete(),delete this._resources[r])}}}]),t}(),_=r(45),b=r(140);function x(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return w(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?M(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return S}));var E=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}}),S=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.deck,i=r.stats,a=r.viewport,s=r.timeline;o()(this,t),this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new y({gl:e,protocol:"deck://"}),this.context=A(A({},E),{},{layerManager:this,gl:e,deck:n,programManager:e&&Object(b.a)(e),stats:i||new p.a({id:"deck.gl"}),viewport:a||new _.a({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new l.a,resourceManager:this.resourceManager}),this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}return u()(t,[{key:"finalize",value:function(){this.resourceManager.finalize();var t,e=x(this.layers);try{for(e.s();!(t=e.n()).done;)this._finalizeLayer(t.value)}catch(t){e.e(t)}finally{e.f()}}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1},e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var r,n=x(this.layers);try{for(n.s();!(r=n.n()).done;){var i=r.value.getNeedsRedraw(t);e=e||i}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"needsUpdate",value:function(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}},{key:"setNeedsRedraw",value:function(t){this._needsRedraw=this._needsRedraw||t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t}},{key:"getLayers",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).layerIds,e=void 0===t?null:t;return e?this.layers.filter((function(t){return e.find((function(e){return 0===t.id.indexOf(e)}))})):this.layers}},{key:"setProps",value:function(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}},{key:"setLayers",value:function(t,e){Object(f.a)("layerManager.setLayers",this,e,t),this.lastRenderedLayers=t;var r,n=x(t=Object(d.b)(t,Boolean));try{for(n.s();!(r=n.n()).done;)r.value.context=this.context}catch(t){n.e(t)}finally{n.f()}return this._updateLayers(this.layers,t),this}},{key:"updateLayers",value:function(){var t=this.needsUpdate();t&&(this.setNeedsRedraw("updating layers: ".concat(t)),this.setLayers(this._nextLayers||this.lastRenderedLayers,t)),this._nextLayers=null}},{key:"activateViewport",value:function(t){return Object(f.a)("layerManager.activateViewport",this,t),t&&(this.context.viewport=t),this}},{key:"_handleError",value:function(t,e,r){r.raiseError(e,"".concat(t," of ").concat(r))}},{key:"_updateLayers",value:function(t,e){var r,n={},i=x(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;n[a.id]?h.a.warn("Multiple old layers with same id ".concat(a.id))():n[a.id]=a}}catch(t){i.e(t)}finally{i.f()}var o=[];this._updateSublayersRecursively(e,n,o),this._finalizeOldLayers(n);for(var s=!1,u=0,l=o;u<l.length;u++)if(l[u].hasUniformTransition()){s=!0;break}this._needsUpdate=s,this.layers=o}},{key:"_updateSublayersRecursively",value:function(t,e,r){var n,i=x(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.context=this.context;var o=e[a.id];null===o&&h.a.warn("Multiple new layers with same id ".concat(a.id))(),e[a.id]=null;var s=null;try{this._debug&&o!==a&&a.validateProps(),o?(this._transferLayerState(o,a),this._updateLayer(a)):this._initializeLayer(a),r.push(a),s=a.isComposite&&a.getSubLayers()}catch(t){this._handleError("matching",t,a)}s&&this._updateSublayersRecursively(s,e,r)}}catch(t){i.e(t)}finally{i.f()}}},{key:"_finalizeOldLayers",value:function(t){for(var e in t){var r=t[e];r&&this._finalizeLayer(r)}}},{key:"_initializeLayer",value:function(t){try{t._initialize(),t.lifecycle=c.e.INITIALIZED}catch(e){this._handleError("initialization",e,t)}}},{key:"_transferLayerState",value:function(t,e){e._transferState(t),e.lifecycle=c.e.MATCHED,e!==t&&(t.lifecycle=c.e.AWAITING_GC)}},{key:"_updateLayer",value:function(t){try{t._update()}catch(e){this._handleError("update",e,t)}}},{key:"_finalizeLayer",value:function(t){this._needsRedraw=this._needsRedraw||"finalized ".concat(t),t.lifecycle=c.e.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=c.e.FINALIZED}catch(e){this._handleError("finalization",e,t)}}}]),t}()},function(t,e,r){var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(36),c=r(6),h=r.n(c),f=r(9),d=r.n(f),p=r(5),m=r.n(p),v=r(16),g=function(t){h()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m()(t);if(e){var i=m()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return d()(this,r)}}(r);function r(){return o()(this,r),e.apply(this,arguments)}return u()(r,[{key:"shouldDrawLayer",value:function(t){return t.props.operation===v.c.DRAW}}]),r}(r(77).a),y=r(159),_=r(79);function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function M(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"a",(function(){return A}));var A=function(){function t(e){o()(this,t),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new g(e),this.pickLayersPass=new y.a(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}return u()(t,[{key:"setProps",value:function(t){"layerFilter"in t&&this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in t&&this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}},{key:"renderLayers",value:function(t){var e=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;t.layerFilter=t.layerFilter||this.layerFilter,t.effects=t.effects||[],t.target=t.target||_.a.getDefaultFramebuffer(this.gl),this._preRender(t.effects,t);var r=this.lastPostProcessEffect?this.renderBuffers[0]:t.target,n=e.render(M(M({},t),{},{target:r}));this._postRender(t.effects,t),this.renderCount++,Object(l.a)("deckRenderer.renderLayers",this,n,t)}},{key:"needsRedraw",value:function(){var t=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),t}},{key:"finalize",value:function(){var t,e=this.renderBuffers,r=b(e);try{for(r.s();!(t=r.n()).done;)t.value.delete()}catch(t){r.e(t)}finally{r.f()}e.length=0}},{key:"_preRender",value:function(t,e){var r,n=null,i=b(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.preRender(this.gl,e),a.postRender&&(n=a)}}catch(t){i.e(t)}finally{i.f()}n&&this._resizeRenderBuffers(),this.lastPostProcessEffect=n}},{key:"_resizeRenderBuffers",value:function(){var t=this.renderBuffers;0===t.length&&t.push(new _.a(this.gl),new _.a(this.gl));var e,r=b(t);try{for(r.s();!(e=r.n()).done;)e.value.resize()}catch(t){r.e(t)}finally{r.f()}}},{key:"_postRender",value:function(t,e){var r,n=this.renderBuffers,i={inputBuffer:n[0],swapBuffer:n[1],target:null},a=b(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.postRender){if(o===this.lastPostProcessEffect){i.target=e.target,o.postRender(this.gl,i);break}var s=o.postRender(this.gl,i);i.inputBuffer=s,i.swapBuffer=s===n[0]?n[1]:n[0]}}}catch(t){a.e(t)}finally{a.f()}}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return o}));var n=r(11),i=r.n(n),a=r(150);function o(){return!("object"===("undefined"==typeof process?"undefined":i()(process))&&"[object process]"===String(process)&&!process.browser)||Object(a.a)()}},function(t,e,r){r.d(e,"a",(function(){return a}));var n=r(11),i=r.n(n);function a(t){if("undefined"!=typeof window&&"object"===i()(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===i()(process.versions)&&Boolean(process.versions.electron))return!0;var e="object"===("undefined"==typeof navigator?"undefined":i()(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)}},function(t,e,r){r.d(e,"a",(function(){return i}));var n=r(8);function i(t,e,r,i){var a="See luma.gl ".concat(r," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(t);i.forEach((function(t){o.methodName||(o[t]=function(){throw n.k.removed("Calling removed method ".concat(e,".").concat(t,": "),a)(),new Error(t)})}))}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=r=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),r(e)}t.exports=r,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){r.d(e,"a",(function(){return v}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(109),p=r(25),m=r(47),v=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){return i()(this,r),e.apply(this,arguments)}return o()(r,[{key:"ELEMENTS",get:function(){return Object(m.a)(!1),0}},{key:"copy",value:function(t){return Object(m.a)(!1),this}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Object(p.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Object(p.a)(t)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return Object(p.a)(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return Object(p.a)(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]*=a[o];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var a=i[n],o=0;o<this.ELEMENTS;++o)this[o]/=a[o];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return Object(m.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),Object(p.a)(this[t])}},{key:"setComponent",value:function(t,e){return Object(m.a)(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}]),r}(d.a)},function(t,e,r){r.d(e,"a",(function(){return o}));var n=r(11),i=r.n(n),a=r(155);function o(){return!("object"===("undefined"==typeof process?"undefined":i()(process))&&"[object process]"===String(process)&&!process.browser)||Object(a.a)()}},function(t,e,r){r.d(e,"a",(function(){return a}));var n=r(11),i=r.n(n);function a(t){if("undefined"!=typeof window&&"object"===i()(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===i()(process.versions)&&Boolean(process.versions.electron))return!0;var e="object"===("undefined"==typeof navigator?"undefined":i()(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)}},function(t,e,r){var n=r(255),i=r(256),a=r(191),o=r(257);t.exports=function(t,e){return n(t)||i(t,e)||a(t,e)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){r.d(e,"a",(function(){return g}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(109),p=r(25),m=r(14),v=r(47),g=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){return i()(this,r),e.apply(this,arguments)}return o()(r,[{key:"ELEMENTS",get:function(){return Object(v.a)(!1),0}},{key:"RANK",get:function(){return Object(v.a)(!1),0}},{key:"toString",value:function(){var t="[";if(m.b.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+"]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=Object(p.a)(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),r}(d.a)},function(t,e,r){r.d(e,"a",(function(){return h}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(0),u=r.n(s);function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach((function(e){u()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var h=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{id:"pass"};i()(this,t),u()(this,"id",void 0),u()(this,"gl",void 0),u()(this,"props",void 0),this.id=r.id,this.gl=e,this.props=c({},r)}return o()(t,[{key:"setProps",value:function(t){Object.assign(this.props,t)}},{key:"render",value:function(t){}},{key:"cleanup",value:function(){}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return S}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(17),u=r.n(s),l=r(18),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(0),y=r.n(g),_=r(77),b=r(8),x=r(16),w=r(22);function M(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?M(Object(r),!0).forEach((function(e){y()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var E={blendFunc:[1,0,32771,0],blendEquation:32774},S=function(t){f()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}(r);function r(){var t;i()(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a)),y()(u()(t),"pickZ",void 0),y()(u()(t),"_colors",null),t}return o()(r,[{key:"render",value:function(t){return t.pickingFBO?this._drawPickingBuffer(t):c()(v()(r.prototype),"render",this).call(this,t)}},{key:"_drawPickingBuffer",value:function(t){var e=this,n=t.layers,i=t.layerFilter,a=t.views,o=t.viewports,s=t.onViewportActive,u=t.pickingFBO,l=t.deviceRect,h=l.x,f=l.y,d=l.width,p=l.height,m=t.effects,g=t.pass,y=void 0===g?"picking":g,_=t.pickZ,x=this.gl;this.pickZ=_;var w=_?null:{byLayer:new Map,byAlpha:[]};this._colors=w;var M=Object(b.o)(x,A(A({scissorTest:!0,scissor:[h,f,d,p],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},E),{},{blend:!_}),(function(){return c()(v()(r.prototype),"render",e).call(e,{target:u,layers:n,layerFilter:i,views:a,viewports:o,onViewportActive:s,effects:null==m?void 0:m.filter((function(t){return t.useInPicking})),pass:y})}));return this._colors=null,{decodePickingColor:w&&T.bind(null,w),stats:M}}},{key:"shouldDrawLayer",value:function(t){return t.props.pickable&&t.props.operation===x.c.DRAW}},{key:"getModuleParameters",value:function(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}},{key:"getLayerParameters",value:function(t,e,r){var n=A({},t.props.parameters);return this._colors?(Object.assign(n,E),n.blend=!0,n.blendColor=function(t,e,r){var n,i=t.byLayer,a=t.byAlpha,o=i.get(e);return o?(o.viewports.push(r),n=o.a):(n=i.size+1)<=255?(i.set(e,o={a:n,layer:e,viewports:[r]}),a[n]=o):(w.a.warn("Too many pickable layers, only picking the first 255")(),n=0),[0,0,0,n/255]}(this._colors,t,r)):n.blend=!1,n}}]),r}(_.a);function T(t,e){var r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}},function(t,e,r){function n(t){var e=i(t);return function(t){var e=i(t);return e.byteLength>=24&&2303741511===e.getUint32(0,!1)?{mimeType:"image/png",width:e.getUint32(16,!1),height:e.getUint32(20,!1)}:null}(e)||function(t){var e=i(t);if(!(e.byteLength>=3&&65496===e.getUint16(0,!1)&&255===e.getUint8(2)))return null;for(var r=function(){for(var t=new Set([65499,65476,65484,65501,65534]),e=65504;e<65520;++e)t.add(e);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=r.tableMarkers,a=r.sofMarkers,o=2;o+9<e.byteLength;){var s=e.getUint16(o,!1);if(a.has(s))return{mimeType:"image/jpeg",height:e.getUint16(o+5,!1),width:e.getUint16(o+7,!1)};if(!n.has(s))return null;o+=2,o+=e.getUint16(o,!1)}return null}(e)||function(t){var e=i(t);return e.byteLength>=10&&1195984440===e.getUint32(0,!1)?{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}:null}(e)||function(t){var e=i(t);return e.byteLength>=14&&16973===e.getUint16(0,!1)&&e.getUint32(2,!0)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,!0),height:e.getUint32(22,!0)}:null}(e)}function i(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}r.d(e,"a",(function(){return n}))},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(8),c=r(178),h=r(60),f=r(10),d=r(164),p=r(293),m=r(72),v=r(38),g=r(17),y=r.n(g),_=r(18),b=r.n(_),x=r(6),w=r.n(x),M=r(9),A=r.n(M),E=r(5),S=r.n(E),T=r(42),C=null,O=r(65),P=r(149),L=r(150);function I(t){if(!t&&!Object(P.a)())return"Node";if(Object(L.a)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},r=t||e.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),i=-1!==r.indexOf("Trident/");return n||i?"IE":O.b.chrome?"Chrome":O.b.safari?"Safari":O.b.mozInnerScreenX?"Firefox":"Unknown"}var k="elements must be GL.ELEMENT_ARRAY_BUFFER",R=function(t){w()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S()(t);if(e){var i=S()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return A()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,r),(n=e.call(this,t,Object.assign({},i,{id:i.id||i.program&&i.program.id}))).buffer=null,n.bufferValue=null,n.isDefaultArray=i.isDefaultArray||!1,n.gl2=t,n.initialize(i),Object.seal(y()(n)),n}return u()(r,[{key:"delete",value:function(){return b()(S()(r.prototype),"delete",this).call(this),this.buffer&&this.buffer.delete(),this}},{key:"MAX_ATTRIBUTES",get:function(){return r.getMaxAttributes(this.gl)}},{key:"initialize",value:function(){return this.setProps(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"setProps",value:function(t){return this}},{key:"setElementBuffer",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(f.a)(!e||34963===e.target,k),this.bind((function(){t.gl.bindBuffer(34963,e?e.handle:null)})),this}},{key:"setBuffer",value:function(t,e,r){if(34963===e.target)return this.setElementBuffer(e,r);var n=r.size,i=r.type,a=r.stride,o=r.offset,s=r.normalized,u=r.integer,c=r.divisor,h=this.gl,d=this.gl2;return t=Number(t),this.bind((function(){h.bindBuffer(34962,e.handle),u?(Object(f.a)(Object(l.j)(h)),d.vertexAttribIPointer(t,n,i,a,o)):h.vertexAttribPointer(t,n,i,s,a,o),h.enableVertexAttribArray(t),d.vertexAttribDivisor(t,c||0)})),this}},{key:"enable",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!n&&0===t&&!r.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind((function(){return n?e.gl.enableVertexAttribArray(t):e.gl.disableVertexAttribArray(t)}))),this}},{key:"getConstantBuffer",value:function(t,e){var r=this._normalizeConstantArrayValue(e),n=r.byteLength*t,i=r.length*t,a=!this.buffer;if(this.buffer=this.buffer||new v.a(this.gl,n),a=(a=a||this.buffer.reallocate(n))||!this._compareConstantArrayValues(r,this.bufferValue)){var o=function(t,e){var r;return new t((r=t.BYTES_PER_ELEMENT*e,(!C||C.byteLength<r)&&(C=new ArrayBuffer(r)),C),0,e)}(e.constructor,i);!function(t){for(var e=t.target,r=t.source,n=t.start,i=void 0===n?0:n,a=t.count,o=r.length,s=(void 0===a?1:a)*o,u=0,l=i;u<o;u++)e[l++]=r[u];for(;u<s;)u<s-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+s-u),u=s)}({target:o,source:r,start:0,count:i}),this.buffer.subData(o),this.bufferValue=e}return this.buffer}},{key:"_normalizeConstantArrayValue",value:function(t){return Array.isArray(t)?new Float32Array(t):t}},{key:"_compareConstantArrayValues",value:function(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}},{key:"_createHandle",value:function(){return this.gl.createVertexArray()}},{key:"_deleteHandle",value:function(t){return this.gl2.deleteVertexArray(t),[this.elements]}},{key:"_bindHandle",value:function(t){this.gl2.bindVertexArray(t)}},{key:"_getParameter",value:function(t,e){var r=this,n=e.location;return Object(f.a)(Number.isFinite(n)),this.bind((function(){return 34373===t?r.gl.getVertexAttribOffset(n,t):r.gl.getVertexAttrib(n,t)}))}}],[{key:"isSupported",value:function(t){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).constantAttributeZero||Object(l.j)(t)||"Chrome"===I()}},{key:"getDefaultArray",value:function(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new r(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}},{key:"getMaxAttributes",value:function(t){return r.MAX_ATTRIBUTES=r.MAX_ATTRIBUTES||t.getParameter(34921)}},{key:"setConstant",value:function(t,e,n){switch(n.constructor){case Float32Array:r._setConstantFloatArray(t,e,n);break;case Int32Array:r._setConstantIntArray(t,e,n);break;case Uint32Array:r._setConstantUintArray(t,e,n);break;default:Object(f.a)(!1)}}},{key:"_setConstantFloatArray",value:function(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:Object(f.a)(!1)}}},{key:"_setConstantIntArray",value:function(t,e,r){switch(Object(f.a)(Object(l.j)(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:Object(f.a)(!1)}}},{key:"_setConstantUintArray",value:function(t,e,r){switch(Object(f.a)(Object(l.j)(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:Object(f.a)(!1)}}}]),r}(T.a),D=r(151),B=/^(.+)__LOCATION_([0-9]+)$/,F=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"],j=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,t),this.id=r.id||r.program&&r.program.id,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new R(e),Object(D.a)(this,"VertexArray","v6.0",F),this.initialize(r),Object.seal(this)}return u()(t,[{key:"delete",value:function(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}},{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}},{key:"reset",value:function(){this.elements=null,this.elementsAccessor=null;var t=this.vertexArrayObject.MAX_ATTRIBUTES;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}},{key:"setProps",value:function(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}},{key:"clearDrawParams",value:function(){this.drawParams=null}},{key:"getDrawParams",value:function(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}},{key:"setAttributes",value:function(t){var e=this;return Object.assign(this.attributes,t),this.vertexArrayObject.bind((function(){for(var r in t)e._setAttribute(r,t[r]);e.gl.bindBuffer(34962,null)})),this}},{key:"setElementBuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(t,e),this}},{key:"setBuffer",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(34963===e.target)return this.setElementBuffer(e,r);var n=this._resolveLocationAndAccessor(t,e,e.accessor,r),i=n.location,a=n.accessor;return i>=0&&(this.values[i]=e,this.accessors[i]=a,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,e,a)),this}},{key:"setConstant",value:function(t,e){var r=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})),n=r.location,i=r.accessor;return n>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e),this.values[n]=e,this.accessors[n]=i,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}},{key:"unbindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind((function(){t.elements&&t.vertexArrayObject.setElementBuffer(null),t.buffer=t.buffer||new v.a(t.gl,{accessor:{size:4}});for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++)t.values[e]instanceof v.a&&(t.gl.disableVertexAttribArray(e),t.gl.bindBuffer(34962,t.buffer.handle),t.gl.vertexAttribPointer(e,1,5126,!1,0,0))})),this}},{key:"bindBuffers",value:function(){var t=this;return this.vertexArrayObject.bind((function(){t.elements&&t.setElementBuffer(t.elements);for(var e=0;e<t.vertexArrayObject.MAX_ATTRIBUTES;e++){var r=t.values[e];r instanceof v.a&&t.setBuffer(e,r)}})),this}},{key:"bindForDraw",value:function(t,e,r){var n,i=this;return this.vertexArrayObject.bind((function(){i._setConstantAttributes(t,e),n=r()})),n}},{key:"_resolveLocationAndAccessor",value:function(t,e,r,n){var i=this,a={location:-1,accessor:null},o=this._getAttributeIndex(t),s=o.location,u=o.name;if(!Number.isFinite(s)||s<0)return this.unused[t]=e,l.k.once(3,(function(){return"unused value ".concat(t," in ").concat(i.id)}))(),a;var c=this._getAttributeInfo(u||s);if(!c)return a;var h=m.a.resolve(c.accessor,this.accessors[s]||{},r,n),d=h.size,p=h.type;return Object(f.a)(Number.isFinite(d)&&Number.isFinite(p)),{location:s,accessor:h}}},{key:"_getAttributeInfo",value:function(t){return this.configuration&&this.configuration.getAttributeInfo(t)}},{key:"_getAttributeIndex",value:function(t){var e=Number(t);if(Number.isFinite(e))return{location:e};var r=B.exec(t),n=r?r[1]:t,i=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+i,name:n}:{location:-1}}},{key:"_setAttribute",value:function(t,e){if(e instanceof v.a)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof v.a)this.setBuffer(t,e[0],e[1]);else if(ArrayBuffer.isView(e)||Array.isArray(e))this.setConstant(t,e);else{if(!(e.buffer instanceof v.a))throw new Error("VertexArray: attributes must be Buffers or constants (i.e. typed array)");this.setBuffer(t,e.buffer,e)}}},{key:"_setConstantAttributes",value:function(t,e){var r=Math.max(0|t,0|e),n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(var i=1;i<this.vertexArrayObject.MAX_ATTRIBUTES;i++)n=this.values[i],ArrayBuffer.isView(n)&&this._setConstantAttribute(i,n)}},{key:"_setConstantAttributeZero",value:function(t,e){if(R.isSupported(this.gl,{constantAttributeZero:!0}))this._setConstantAttribute(0,t);else{var r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}}},{key:"_setConstantAttribute",value:function(t,e){R.setConstant(this.gl,t,e)}},{key:"_updateDrawParams",value:function(){for(var t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0},e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}},{key:"_updateDrawParamsForLocation",value:function(t,e){var r=this.values[e],n=this.accessors[e];if(r){var i=n.divisor>0;if(t.isInstanced=t.isInstanced||i,r instanceof v.a){var a=r;if(i){var o=a.getVertexCount(n);t.instanceCount=Math.min(t.instanceCount,o)}else{var s=a.getVertexCount(n);t.vertexCount=Math.min(t.vertexCount,s)}}}}},{key:"setElements",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.k.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}]),t}(),N=r(289),U=r(54),z=r(88);function G(t,e){for(var r=e.maxElts,n=void 0===r?16:r,i=e.size,a=void 0===i?1:i,o="[",s=0;s<t.length&&s<n;++s)s>0&&(o+=",".concat(s%a==0?" ":"")),o+=V(t[s],e);var u=t.length>n?"...":"]";return"".concat(o).concat(u)}function V(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=1e-16,n=e.isInteger,i=void 0!==n&&n;if(Array.isArray(t)||ArrayBuffer.isView(t))return G(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<r)return i?"0":"0.";if(i)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);var a=t.toPrecision(2);return a.indexOf(".0")===a.length-2?a.slice(0,-1):a}function H(t,e,r,n){var a,o,s=t.gl;if(!e)return o={},i()(o,n,"null"),i()(o,"Format ","N/A"),o;var u,l,c,h="NOT PROVIDED",f=1,d=0,p=0;if(r&&(h=r.type,f=r.size,u=-1!==(h=String(h).replace("Array","")).indexOf("nt")),e instanceof v.a){var m,g,y=e,_=y.getDebugData(),b=_.data;return l=_.changed?"*":"",c=b,d=(p=y.byteLength)/b.BYTES_PER_ELEMENT/f,r?g="".concat(r.divisor>0?"I ":"P "," ").concat(d," (x").concat(f,"=").concat(p," bytes ").concat(Object(U.a)(s,h),")"):(u=!0,g="".concat(p," bytes")),m={},i()(m,n,"".concat(l).concat(V(c,{size:f,isInteger:u}))),i()(m,"Format ",g),m}return c=e,f=e.length,u=-1!==(h=String(e.constructor.name).replace("Array","")).indexOf("nt"),a={},i()(a,n,"".concat(V(c,{size:f,isInteger:u})," (constant)")),i()(a,"Format ","".concat(f,"x").concat(h," (constant)")),a}function W(t,e){var r=e.type,n=e.size,i=Object(z.b)(r,n);return i?"".concat(t," (").concat(i.name,")"):t}function $(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function X(t){var e=t.header,r=void 0===e?"Uniforms":e,n=t.program,a=t.uniforms,o=t.undefinedOnly,s=void 0!==o&&o;Object(f.a)(n);var u,l={},c=Object.keys(n._uniformSetters).sort(),h=0,d=$(c);try{for(d.s();!(u=d.n()).done;){var p=u.value;p.match(".*_.*")||p.match(".*Matrix")||K({table:l,header:r,uniforms:a,uniformName:p,undefinedOnly:s})&&h++}}catch(t){d.e(t)}finally{d.f()}var m,v=$(c);try{for(v.s();!(m=v.n()).done;){var g=m.value;g.match(".*Matrix")&&K({table:l,header:r,uniforms:a,uniformName:g,undefinedOnly:s})&&h++}}catch(t){v.e(t)}finally{v.f()}var y,_=$(c);try{for(_.s();!(y=_.n()).done;){var b=y.value;l[b]||K({table:l,header:r,uniforms:a,uniformName:b,undefinedOnly:s})&&h++}}catch(t){_.e(t)}finally{_.f()}var x=0,w={};if(!s)for(var M in a){var A=a[M];l[M]||(x++,w[M]=i()({Type:"NOT USED: ".concat(A)},r,V(A)))}return{table:l,count:h,unusedTable:w,unusedCount:x}}function K(t){var e,r=t.table,n=t.header,a=t.uniformName,o=t.undefinedOnly,s=t.uniforms[a],u=function(t){return null!=t}(s);return!(o&&u||(r[a]=(e={},i()(e,n,u?V(s):"N/A"),i()(e,"Uniform Type",u?s:"NOT PROVIDED"),e),0))}function Z(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Y(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Y(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Y(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function J(t){var e=t.accessor,r=e.type,n=e.size,i=Object(z.b)(r,n);return i?"".concat(i.name," ").concat(t.name):t.name}function Q(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function tt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var et={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function rt(t,e){var r=(e||{}).attributeMap,n=void 0===r?et:r;return n&&n[t]||t}function nt(t,e){var r;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":r="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":r="vectors"}switch(r){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2}Object(f.a)(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}r.d(e,"a",(function(){return ot}));var it=function(){},at={},ot=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o()(this,t);var n=r.id,i=void 0===n?Object(h.c)("model"):n;Object(f.a)(Object(l.i)(e)),this.id=i,this.gl=e,this.id=r.id||Object(h.c)("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(r)}return u()(t,[{key:"initialize",value:function(t){this.props={},this.programManager=t.programManager||c.a.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;var e=t.program;this.programProps={program:void 0===e?null:e,vs:t.vs,fs:t.fs,modules:t.modules,defines:t.defines,inject:t.inject,varyings:t.varyings,bufferMode:t.bufferMode,transpileToGLSL100:t.transpileToGLSL100},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(t.moduleSettings))),this.drawMode=void 0!==t.drawMode?t.drawMode:4,this.vertexCount=t.vertexCount||0,this.geometryBuffers={},this.isInstanced=t.isInstanced||t.instanced||t.instanceCount>0,this._setModelProps(t),this.geometry={},Object(f.a)(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),"Model needs drawMode and vertexCount")}},{key:"setProps",value:function(t){this._setModelProps(t)}},{key:"delete",value:function(){for(var t in this._attributes)this._attributes[t]!==this.attributes[t]&&this._attributes[t].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}},{key:"getDrawMode",value:function(){return this.drawMode}},{key:"getVertexCount",value:function(){return this.vertexCount}},{key:"getInstanceCount",value:function(){return this.instanceCount}},{key:"getAttributes",value:function(){return this.attributes}},{key:"getProgram",value:function(){return this.program}},{key:"setProgram",value:function(t){this.programProps={program:t.program,vs:t.vs,fs:t.fs,modules:t.modules,defines:t.defines,inject:t.inject,varyings:t.varyings,bufferMode:t.bufferMode,transpileToGLSL100:t.transpileToGLSL100},this._programDirty=!0}},{key:"getUniforms",value:function(){return this.uniforms}},{key:"setDrawMode",value:function(t){return this.drawMode=t,this}},{key:"setVertexCount",value:function(t){return Object(f.a)(Number.isFinite(t)),this.vertexCount=t,this}},{key:"setInstanceCount",value:function(t){return Object(f.a)(Number.isFinite(t)),this.instanceCount=t,this}},{key:"setGeometry",value:function(t){return this.drawMode=t.drawMode,this.vertexCount=t.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(t,e,r){var n={},i=e.indices;for(var a in e.attributes){var o=e.attributes[a],s=rt(a,void 0);if("indices"===a)i=o;else if(o.constant)n[s]=o.value;else{var u=o.value,l=tt({},o);delete l.value,n[s]=[new v.a(t,u),l],nt(a,l)}}if(i){var c=i.value||i;Object(f.a)(c instanceof Uint16Array||c instanceof Uint32Array,'attribute array for "indices" must be of integer type');var h={size:1,isIndexed:void 0===i.isIndexed||i.isIndexed};n.indices=[new v.a(t,{data:c,target:34963}),h]}return n}(this.gl,t),this.vertexArray.setAttributes(this.geometryBuffers),this}},{key:"setAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(h.a)(t))return this;var e={};for(var r in t){var n=t[r];e[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(e),this}},{key:"setUniforms",value:function(){return Object.assign(this.uniforms,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this}},{key:"getModuleUniforms",value:function(t){this._checkProgram();var e=this.programManager.getUniforms(this.program);return e?e(t):{}}},{key:"updateModuleSettings",value:function(t){var e=this.getModuleUniforms(t||{});return this.setUniforms(e)}},{key:"clear",value:function(t){return Object(d.a)(this.program.gl,t),this}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._checkProgram();var e,r=t.moduleSettings,n=void 0===r?null:r,i=t.framebuffer,a=t.uniforms,o=void 0===a?{}:a,s=t.attributes,u=t.transformFeedback,c=void 0===u?this.transformFeedback:u,h=t.parameters,f=void 0===h?{}:h,d=t.vertexArray,p=void 0===d?this.vertexArray:d;this.setAttributes(void 0===s?{}:s),this.updateModuleSettings(n),this.setUniforms(o),l.k.priority>=2&&(e=this._logDrawCallStart(2));var m=this.vertexArray.getDrawParams(),v=this.props,g=v.isIndexed,y=void 0===g?m.isIndexed:g,_=v.indexType,b=void 0===_?m.indexType:_,x=v.indexOffset,w=void 0===x?m.indexOffset:x,M=v.vertexArrayInstanced;(void 0===M?m.isInstanced:M)&&!this.isInstanced&&l.k.warn("Found instanced attributes on non-instanced model",this.id)();var A=this.isInstanced,E=this.instanceCount,S=this.props,T=S.onBeforeRender,C=S.onAfterRender,O=void 0===C?it:C;(void 0===T?it:T)(),this.program.setUniforms(this.uniforms);var P=this.program.draw(Object.assign(at,t,{logPriority:e,uniforms:null,framebuffer:i,parameters:f,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:p,transformFeedback:c,isIndexed:y,indexType:b,isInstanced:A,instanceCount:E,offset:y?w:0}));return O(),l.k.priority>=2&&this._logDrawCallEnd(e,p,i),P}},{key:"transform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.discard,r=void 0===e||e,n=t.feedbackBuffers,a=t.unbindModels,o=void 0===a?[]:a,s=t.parameters;n&&this._setFeedbackBuffers(n),r&&(s=Object.assign({},s,i()({},35977,r))),o.forEach((function(t){return t.vertexArray.unbindBuffers()}));try{this.draw(Object.assign({},t,{parameters:s}))}finally{o.forEach((function(t){return t.vertexArray.bindBuffers()}))}return this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.k.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(t).draw()}},{key:"_setModelProps",value:function(t){Object.assign(this.props,t),"uniforms"in t&&this.setUniforms(t.uniforms),"pickable"in t&&(this.pickable=t.pickable),"instanceCount"in t&&(this.instanceCount=t.instanceCount),"geometry"in t&&this.setGeometry(t.geometry),"attributes"in t&&this.setAttributes(t.attributes),"_feedbackBuffers"in t&&this._setFeedbackBuffers(t._feedbackBuffers)}},{key:"_checkProgram",value:function(){if(this._programDirty||this.programManager.stateHash!==this._programManagerState){var t=this.programProps.program;if(t)this._managedProgram=!1;else{var e=this.programProps;t=this.programManager.get({vs:e.vs,fs:e.fs,modules:e.modules,inject:e.inject,defines:e.defines,varyings:e.varyings,bufferMode:e.bufferMode,transpileToGLSL100:e.transpileToGLSL100}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Object(f.a)(t instanceof p.a,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new j(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}}},{key:"_deleteGeometryBuffers",value:function(){for(var t in this.geometryBuffers){var e=this.geometryBuffers[t][0]||this.geometryBuffers[t];e instanceof v.a&&e.delete()}}},{key:"_setAnimationProps",value:function(t){this.animated&&Object(f.a)(t,"Model.draw(): animated uniforms but no animationProps")}},{key:"_setFeedbackBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(h.a)(t)||(this.transformFeedback=this.transformFeedback||new N.a(this.program.gl,{program:this.program}),this.transformFeedback.setBuffers(t)),this}},{key:"_logDrawCallStart",value:function(t){var e=t>3?0:1e4;if(!(Date.now()-this.lastLogTime<e))return this.lastLogTime=Date.now(),l.k.group(2,">>> DRAWING MODEL ".concat(this.id),{collapsed:l.k.level<=2})(),t}},{key:"_logDrawCallEnd",value:function(t,e,r,n){if(void 0!==t){var a=function(t){var e=t.vertexArray,r=t.header,n=void 0===r?"Attributes":r;if(!e.configuration)return{};var i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=H(e,e.elements,null,n));var a=e.values;for(var o in a){var s=e._getAttributeInfo(o);if(s){var u="".concat(o,": ").concat(s.name),l=e.accessors[s.location];l&&(u="".concat(o,": ").concat(W(s.name,l))),i[u]=H(e,a[o],l,n)}}return i}({vertexArray:e,header:"".concat(this.id," attributes"),attributes:this._attributes}),o=X({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),s=o.table,u=o.unusedTable,c=o.unusedCount,h=X({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});h.count>0&&l.k.log("MISSING UNIFORMS",Object.keys(h.table))(),c>0&&l.k.log("UNUSED UNIFORMS",Object.keys(u))();var f=function(t){var e,r={},n="Accessors for ".concat(t.id),a=Z(t.attributeInfos);try{for(a.s();!(e=a.n()).done;){var o=e.value;if(o){var s=J(o);r["in ".concat(s)]=i()({},n,JSON.stringify(o.accessor))}}}catch(t){a.e(t)}finally{a.f()}var u,l=Z(t.varyingInfos);try{for(l.s();!(u=l.n()).done;){var c=u.value;if(c){var h=J(c);r["out ".concat(h)]=i()({},n,JSON.stringify(c.accessor))}}}catch(t){l.e(t)}finally{l.f()}return r}(this.vertexArray.configuration);l.k.table(t,a)(),l.k.table(t,s)(),l.k.table(t+1,f)(),n&&n.log({logLevel:2,message:"Rendered to ".concat(n.id)}),l.k.groupEnd(2,">>> DRAWING MODEL ".concat(this.id))()}}}]),t}()},function(t,e,r){function n(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}r.d(e,"a",(function(){return n}))},function(t,e,r){r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return u}));var n=r(12),i=r.n(n),a=r(8),o=r(10);function s(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.framebuffer,n=void 0===r?null:r,i=e.color,s=void 0===i?null:i,u=e.depth,l=void 0===u?null:u,c=e.stencil,h=void 0===c?null:c,f={};n&&(f.framebuffer=n);var d=0;s&&(d|=16384,!0!==s&&(f.clearColor=s)),l&&(d|=256,!0!==l&&(f.clearDepth=l)),h&&(d|=1024,!0!==l&&(f.clearStencil=l)),Object(o.a)(0!==d,"clear: bad arguments"),Object(a.o)(t,f,(function(){t.clear(d)}))}function u(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.framebuffer,n=void 0===r?null:r,s=e.buffer,u=void 0===s?6144:s,l=e.drawBuffer,c=void 0===l?0:l,h=e.value,f=void 0===h?[0,0,0,0]:h;Object(a.a)(t),Object(a.o)(t,{framebuffer:n},(function(){switch(u){case 6144:switch(f.constructor){case Int32Array:t.clearBufferiv(u,c,f);break;case Uint32Array:t.clearBufferuiv(u,c,f);break;case Float32Array:default:t.clearBufferfv(u,c,f)}break;case 6145:t.clearBufferfv(6145,0,[f]);break;case 6146:t.clearBufferiv(6146,0,[f]);break;case 34041:var e=i()(f,2);t.clearBufferfi(34041,0,e[0],e[1]);break;default:Object(o.a)(!1,"clear: bad arguments")}}))}},function(t,e,r){var n,i=r(0),a=r.n(i),o=r(82),s=r(163);r.d(e,"a",(function(){return l})),r.d(e,"c",(function(){return d})),r.d(e,"b",(function(){return p}));var u=(n={},a()(n,o.b,"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"),a()(n,o.a,"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"),n),l="__LUMA_INJECT_DECLARATIONS__",c=/void\s+main\s*\([^)]*\)\s*\{\n?/,h=/}\n?[^{}]*$/,f=[];function d(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e===o.b,a=function(e){var n=r[e];n.sort((function(t,e){return t.order-e.order})),f.length=n.length;for(var a=0,o=n.length;a<o;++a)f[a]=n[a].injection;var s="".concat(f.join("\n"),"\n");switch(e){case"vs:#decl":i&&(t=t.replace(l,s));break;case"vs:#main-start":i&&(t=t.replace(c,(function(t){return t+s})));break;case"vs:#main-end":i&&(t=t.replace(h,(function(t){return s+t})));break;case"fs:#decl":i||(t=t.replace(l,s));break;case"fs:#main-start":i||(t=t.replace(c,(function(t){return t+s})));break;case"fs:#main-end":i||(t=t.replace(h,(function(t){return s+t})));break;default:t=t.replace(e,(function(t){return t+s}))}};for(var s in r)a(s);return t=t.replace(l,""),n&&(t=t.replace(/\}\s*$/,(function(t){return t+u[e]}))),t}function p(t){var e={};return Object(s.a)(Array.isArray(t)&&t.length>1),t.forEach((function(t){for(var r in t)e[r]=e[r]?"".concat(e[r],"\n").concat(t[r]):t[r]})),e}},,,,,,,,function(t,e,r){var n=r(118);Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if("undefined"!=typeof window&&"object"===(0,i.default)(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===(0,i.default)(process.versions)&&Boolean(process.versions.electron))return!0;var e="object"===("undefined"==typeof navigator?"undefined":(0,i.default)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)};var i=n(r(11))},function(t,e,r){var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(0),u=r.n(s),l=r(1),c=r.n(l),h=r(3),f=r.n(h),d=r(4),p=r(83),m=r(59),v=new Map;function g(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}var y=r(11),_=r.n(y);function b(t){return!!t&&(t instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&t instanceof MessagePort||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)}var x=function(){},w=function(){function t(e){c()(this,t),Object(d.a)(this,"name",void 0),Object(d.a)(this,"source",void 0),Object(d.a)(this,"url",void 0),Object(d.a)(this,"terminated",!1),Object(d.a)(this,"worker",void 0),Object(d.a)(this,"onMessage",void 0),Object(d.a)(this,"onError",void 0),Object(d.a)(this,"_loadableURL","");var r=e.name,n=e.source,i=e.url;Object(m.a)(n||i),this.name=r,this.source=n,this.url=i,this.onMessage=x,this.onError=function(t){return console.log(t)},this.worker=this._createBrowserWorker()}return f()(t,[{key:"destroy",value:function(){this.onMessage=x,this.onError=x,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(t,e){e=e||function t(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,i=n||new Set;if(e)if(b(e))i.add(e);else if(b(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(r&&"object"===_()(e))for(var a in e)t(e[a],r,i);return void 0===n?Array.from(i):[]}(t),this.worker.postMessage(t,e)}},{key:"_getErrorFromErrorEvent",value:function(t){var e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}},{key:"_createBrowserWorker",value:function(){var t=this;this._loadableURL=function(t){Object(m.a)(t.source&&!t.url||!t.source&&t.url);var e=v.get(t.source||t.url);return e||(t.url&&(e=function(t){return t.startsWith("http")?g("try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")):t}(t.url),v.set(t.url,e)),t.source&&(e=g(t.source),v.set(t.source,e))),Object(m.a)(e),e}({source:this.source,url:this.url});var e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t._getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(t){return console.error(t)},e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof Worker}}]),t}(),M=function(){function t(e,r){var n=this;c()(this,t),Object(d.a)(this,"name",void 0),Object(d.a)(this,"workerThread",void 0),Object(d.a)(this,"isRunning",void 0),Object(d.a)(this,"result",void 0),Object(d.a)(this,"_resolve",void 0),Object(d.a)(this,"_reject",void 0),this.name=e,this.workerThread=r,this.isRunning=!0,this._resolve=function(){},this._reject=function(){},this.result=new Promise((function(t,e){n._resolve=t,n._reject=e}))}return f()(t,[{key:"postMessage",value:function(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}},{key:"done",value:function(t){Object(m.a)(this.isRunning),this.isRunning=!1,this._resolve(t)}},{key:"error",value:function(t){Object(m.a)(this.isRunning),this.isRunning=!1,this._reject(t)}}]),t}();function A(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function E(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?A(Object(r),!0).forEach((function(e){u()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var S=function(){function t(e){c()(this,t),Object(d.a)(this,"name","unnamed"),Object(d.a)(this,"source",void 0),Object(d.a)(this,"url",void 0),Object(d.a)(this,"maxConcurrency",1),Object(d.a)(this,"maxMobileConcurrency",1),Object(d.a)(this,"onDebug",(function(){})),Object(d.a)(this,"reuseWorkers",!0),Object(d.a)(this,"props",{}),Object(d.a)(this,"jobQueue",[]),Object(d.a)(this,"idleQueue",[]),Object(d.a)(this,"count",0),Object(d.a)(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}var e,r;return f()(t,[{key:"destroy",value:function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0}},{key:"setProps",value:function(t){this.props=E(E({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}},{key:"startJob",value:(r=i()(o.a.mark((function t(e){var r,n,i,a=this,s=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:function(t,e,r){return t.done(r)},n=s.length>2&&void 0!==s[2]?s[2]:function(t,e){return t.error(e)},i=new Promise((function(t){return a.jobQueue.push({name:e,onMessage:r,onError:n,onStart:t}),a})),this._startQueuedJob(),t.next=6,i;case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"_startQueuedJob",value:(e=i()(o.a.mark((function t(){var e,r,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.jobQueue.length){t.next=2;break}return t.abrupt("return");case 2:if(e=this._getAvailableWorker()){t.next=5;break}return t.abrupt("return");case 5:if(!(r=this.jobQueue.shift())){t.next=18;break}return this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length}),n=new M(r.name,e),e.onMessage=function(t){return r.onMessage(n,t.type,t.payload)},e.onError=function(t){return r.onError(n,t)},r.onStart(n),t.prev=12,t.next=15,n.result;case 15:return t.prev=15,this.returnWorkerToQueue(e),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[12,,15,18]])}))),function(){return e.apply(this,arguments)})},{key:"returnWorkerToQueue",value:function(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new w({name:t,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return p.c?this.maxMobileConcurrency:this.maxConcurrency}}]),t}();function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return C(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function O(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?O(Object(r),!0).forEach((function(e){u()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var L={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},I=function(){function t(e){c()(this,t),Object(d.a)(this,"props",void 0),Object(d.a)(this,"workerPools",new Map),this.props=P({},L),this.setProps(e),this.workerPools=new Map}return f()(t,[{key:"destroy",value:function(){var t,e=T(this.workerPools.values());try{for(e.s();!(t=e.n()).done;)t.value.destroy()}catch(t){e.e(t)}finally{e.f()}}},{key:"setProps",value:function(t){this.props=P(P({},this.props),t);var e,r=T(this.workerPools.values());try{for(r.s();!(e=r.n()).done;)e.value.setProps(this._getWorkerPoolProps())}catch(t){r.e(t)}finally{r.f()}}},{key:"getWorkerPool",value:function(t){var e=t.name,r=t.source,n=t.url,i=this.workerPools.get(e);return i||((i=new S({name:e,source:r,url:n})).setProps(this._getWorkerPoolProps()),this.workerPools.set(e,i)),i}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return w.isSupported()}},{key:"getWorkerFarm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t._workerFarm=t._workerFarm||new t({})).setProps(e),t._workerFarm}}]),t}();function k(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e[t.id]||{},n="".concat(t.id,"-worker.js"),i=r.workerUrl;if(i||"compression"!==t.id||(i=e.workerUrl),"test"===e._workerType&&(i="modules/".concat(t.module,"/dist/").concat(n)),!i){var a=t.version;"latest"===a&&(a="latest");var o=a?"@".concat(a):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(n)}return Object(m.a)(i),i}function R(t,e){return!!I.isSupported()&&t.worker&&(null==e?void 0:e.worker)}function D(t,e,r,n,i){return B.apply(this,arguments)}function B(){return(B=i()(o.a.mark((function t(e,r,n,i,a){var s,u,l,c,h,f;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.id,u=k(e,n),l=I.getWorkerFarm(n),c=l.getWorkerPool({name:s,url:u}),n=JSON.parse(JSON.stringify(n)),t.next=7,c.startJob("process-on-worker",F.bind(null,a));case 7:return(h=t.sent).postMessage("process",{input:r,options:n}),t.next=11,h.result;case 11:return f=t.sent,t.next=14,f.result;case 14:return t.abrupt("return",t.sent);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t,e,r,n){return j.apply(this,arguments)}function j(){return(j=i()(o.a.mark((function t(e,r,n,i){var a,s,u,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=n,t.next="done"===t.t0?3:"error"===t.t0?5:"process"===t.t0?7:20;break;case 3:return r.done(i),t.abrupt("break",21);case 5:return r.error(new Error(i.error)),t.abrupt("break",21);case 7:return a=i.id,s=i.input,u=i.options,t.prev=8,t.next=11,e(s,u);case 11:r.postMessage("done",{id:a,result:t.sent}),t.next=19;break;case 15:t.prev=15,t.t1=t.catch(8),l=t.t1 instanceof Error?t.t1.message:"unknown error",r.postMessage("error",{id:a,error:l});case 19:return t.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return t.stop()}}),t,null,[[8,15]])})))).apply(this,arguments)}Object(d.a)(I,"_workerFarm",void 0),r.d(e,"a",(function(){return R})),r.d(e,"b",(function(){return D}))},function(t,e,r){var n=r(0),i=r.n(n),a=r(105),o=r(291),s=r(22),u=r(36),l={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(t){var e=t[0],r=t[t.length-1];return"{"===e&&"}"===r||"["===e&&"]"===r},parseTextSync:JSON.parse};function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var f=globalThis.deck&&globalThis.deck.VERSION;if(f&&"1.5.0"!==f)throw new Error("deck.gl - multiple versions detected: ".concat(f," vs ").concat("1.5.0"));f||(s.a.log(1,"deck.gl ".concat("1.5.0"))(),globalThis.deck=h(h({},globalThis.deck),{},{VERSION:"1.5.0",version:"1.5.0",log:s.a,_registerLoggers:u.b}),Object(a.c)([l,[o.a,{imagebitmap:{premultiplyAlpha:"none"}}]])),e.a=globalThis.deck},function(t,e,r){r.d(e,"a",(function(){return u}));var n,i=r(0),a=r.n(i),o=r(79),s=r(115),u={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};e.b=(n={},a()(n,u.WEBGL2,[!1,!0]),a()(n,u.VERTEX_ARRAY_OBJECT,["OES_vertex_array_object",!0]),a()(n,u.TIMER_QUERY,["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"]),a()(n,u.INSTANCED_RENDERING,["ANGLE_instanced_arrays",!0]),a()(n,u.MULTIPLE_RENDER_TARGETS,["WEBGL_draw_buffers",!0]),a()(n,u.ELEMENT_INDEX_UINT32,["OES_element_index_uint",!0]),a()(n,u.BLEND_EQUATION_MINMAX,["EXT_blend_minmax",!0]),a()(n,u.FLOAT_BLEND,["EXT_float_blend"]),a()(n,u.COLOR_ENCODING_SRGB,["EXT_sRGB",!0]),a()(n,u.TEXTURE_DEPTH,["WEBGL_depth_texture",!0]),a()(n,u.TEXTURE_FLOAT,["OES_texture_float",!0]),a()(n,u.TEXTURE_HALF_FLOAT,["OES_texture_half_float",!0]),a()(n,u.TEXTURE_FILTER_LINEAR_FLOAT,["OES_texture_float_linear"]),a()(n,u.TEXTURE_FILTER_LINEAR_HALF_FLOAT,["OES_texture_half_float_linear"]),a()(n,u.TEXTURE_FILTER_ANISOTROPIC,["EXT_texture_filter_anisotropic"]),a()(n,u.COLOR_ATTACHMENT_RGBA32F,[function(t){var e=new s.a(t,{format:6408,type:5126,dataFormat:6408}),r=new o.a(t,{id:"test-framebuffer",check:!1,attachments:a()({},36064,e)}),n=r.getStatus();return e.delete(),r.delete(),36053===n},"EXT_color_buffer_float"]),a()(n,u.COLOR_ATTACHMENT_FLOAT,[!1,"EXT_color_buffer_float"]),a()(n,u.COLOR_ATTACHMENT_HALF_FLOAT,["EXT_color_buffer_half_float"]),a()(n,u.GLSL_FRAG_DATA,["WEBGL_draw_buffers",!0]),a()(n,u.GLSL_FRAG_DEPTH,["EXT_frag_depth",!0]),a()(n,u.GLSL_DERIVATIVES,["OES_standard_derivatives",!0]),a()(n,u.GLSL_TEXTURE_LOD,["EXT_shader_texture_lod",!0]),n)},function(t,e){},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(12),u=r.n(s),l=r(0),c=r.n(l),h=r(82),f=r(179),d=r(163);function p(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t){return function(t){var e={},r={};return g({modules:t,level:0,moduleMap:e,moduleDepth:r}),Object.keys(r).sort((function(t,e){return r[e]-r[t]})).map((function(t){return e[t]}))}(function t(e,r){return e.map((function(e){return e instanceof f.a||(Object(d.a)("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '".concat(e,"' and use it directly.")),Object(d.a)(e.name,"shader module has no name"),(e=new f.a(e)).dependencies=t(e.dependencies)),e}))}(t))}function g(t){var e=t.modules,r=t.level,n=t.moduleMap,i=t.moduleDepth;if(r>=5)throw new Error("Possible loop in shader dependency graph");var a,o=p(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.name]=s,(void 0===i[s.name]||i[s.name]<r)&&(i[s.name]=r)}}catch(t){o.e(t)}finally{o.f()}var u,l=p(e);try{for(l.s();!(u=l.n()).done;){var c=u.value;c.dependencies&&g({modules:c.dependencies,level:r+1,moduleMap:n,moduleDepth:i})}}catch(t){l.e(t)}finally{l.f()}}function y(){var t="undefined"!=typeof window&&window.navigator||{},e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).userAgent||t.userAgent||"",r=-1!==e.indexOf("MSIE "),n=-1!==e.indexOf("Trident/");return r||n}var _={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},b={};Object.keys(_).forEach((function(t){b[t]=t}));var x={};function w(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=_[e];if(Object(d.a)(n,e),!y(r))return!0;if(e in x)return x[e];var i=r.behavior||"enable",a="#extension GL_".concat(n[0]," : ").concat(i,"\nvoid main(void) {}"),o=t.createShader(35633);t.shaderSource(o,a),t.compileShader(o);var s=t.getShaderParameter(o,35713);return t.deleteShader(o),x[e]=s,s}function M(t,e){return(e=Array.isArray(e)?e:[e]).every((function(e){return function(t,e){var r=_[e];Object(d.a)(r,e);var n=function(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||Boolean(t&&2===t._version)}(t)&&r[1]||r[0],i="string"==typeof n?Boolean(t.getExtension(n)):n;return Object(d.a)(!1===i||!0===i),i}(t,e)}))}var A=r(165);function E(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function S(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}var T,C=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],O=[].concat(C,[[S("attribute"),"in $1"],[S("varying"),"out $1"]]),P=[].concat(C,[[S("varying"),"in $1"]]),L=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],I=[].concat(L,[[S("in"),"attribute $1"],[S("out"),"varying $1"]]),k=[].concat(L,[[S("in"),"varying $1"]]),R=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,D=/void\s+main\s*\([^)]*\)\s*\{\n?/;function B(t,e,r){switch(e){case 300:return r?F(t,O):function(t){var e=(t=F(t,P)).match(R);if(e){var r=e[1];t=t.replace(new RegExp("\\b".concat("gl_FragColor","\\b"),"g"),r)}else t=t.replace(D,(function(t){return"out vec4 ".concat("fragmentColor",";\n").concat(t)})).replace(new RegExp("\\b".concat("gl_FragColor","\\b"),"g"),"fragmentColor");return t}(t);case 100:return r?F(t,I):function(t){var e=(t=F(t,k)).match(R);if(e){var r=e[1];t=t.replace(R,"").replace(new RegExp("\\b".concat(r,"\\b"),"g"),"gl_FragColor")}return t}(t);default:throw new Error("unknown GLSL version ".concat(e))}}function F(t,e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return E(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(e);try{for(n.s();!(r=n.n()).done;){var i=u()(r.value,2);t=t.replace(i[0],i[1])}}catch(t){n.e(t)}finally{n.f()}return t}function j(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var U="\n\n".concat(A.a,"\n\n"),z=(T={},c()(T,h.b,"vertex"),c()(T,h.a,"fragment"),T);function G(t,e){var r=e.vs,n=e.fs,i=v(e.modules||[]);return{gl:t,vs:V(t,Object.assign({},e,{source:r,type:h.b,modules:i})),fs:V(t,Object.assign({},e,{source:n,type:h.a,modules:i})),getUniforms:H(i)}}function V(t,e){var r=e.id,n=e.source,i=e.type,a=e.modules,o=e.defines,s=void 0===o?{}:o,l=e.hookFunctions,c=void 0===l?[]:l,f=e.inject,p=void 0===f?{}:f,m=e.transpileToGLSL100,v=void 0!==m&&m,g=e.prologue,y=void 0===g||g,_=e.log;Object(d.a)("string"==typeof n,"shader source must be a string");var x=i===h.b,E=n.split("\n"),S=100,T="",C=n;0===E[0].indexOf("#version ")?(S=300,T=E[0],C=E.slice(1).join("\n")):T="#version ".concat(S);var O={};a.forEach((function(t){Object.assign(O,t.getDefines())})),Object.assign(O,s);var P=y?"".concat(T,"\n").concat(function(t){var e=t.id,r=t.type;return e&&"string"==typeof e&&-1===t.source.indexOf("SHADER_NAME")?"\n#define SHADER_NAME ".concat(e,"_").concat(z[r],"\n\n"):""}({id:r,source:n,type:i}),"\n").concat(function(t){return"\n#define SHADER_TYPE_".concat(z[t.type].toUpperCase(),"\n")}({type:i}),"\n").concat(function(t){switch(function(t){var e=t.getExtension("WEBGL_debug_renderer_info"),r=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||7936),n=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||7937);return{gpuVendor:function(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(r,n),vendor:r,renderer:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}(t).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(t),"\n").concat(function(t,e,r){var n="#if (__VERSION__ > 120)\n\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n\n// DEPRECATED FLAGS, remove in v9\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return M(t,b.GLSL_FRAG_DEPTH)&&(n+="\n// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),M(t,b.GLSL_DERIVATIVES)&&w(t,b.GLSL_DERIVATIVES)&&(n+="\n// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n# define DERIVATIVES\n#endif\n"),M(t,b.GLSL_FRAG_DATA)&&w(t,b.GLSL_FRAG_DATA,{behavior:"require"})&&(n+="\n// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define FEATURE_GLSL_DRAW_BUFFERS\n#define DRAW_BUFFERS\n#endif\n"),M(t,b.GLSL_TEXTURE_LOD)&&(n+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n\n#endif\n"),n}(t),"\n").concat(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,r="";for(var n in t){0===e&&(r+="\n// APPLICATION DEFINES\n"),e++;var i=t[n];(i||Number.isFinite(i))&&(r+="#define ".concat(n.toUpperCase()," ").concat(t[n],"\n"))}return 0===e&&(r+="\n"),r}(O),"\n").concat(x?"":"precision highp float;\n\n","\n"):"".concat(T,"\n"),L=function(t){var e={vs:{},fs:{}};return t.forEach((function(t){var r;"string"!=typeof t?t=(r=t).hook:r={};var n=(t=t.trim()).split(":"),i=u()(n,2),a=i[0],o=i[1],s=t.replace(/\(.+/,"");e[a][s]=Object.assign(r,{signature:o})})),e}(c),I={},k={},R={};for(var D in p){var F="string"==typeof p[D]?{injection:p[D],order:0}:p[D],N=D.match(/^(v|f)s:(#)?([\w-]+)$/);N?N[2]?"decl"===N[3]?k[D]=[F]:R[D]=[F]:I[D]=[F]:R[D]=[F]}var G,V=j(a);try{for(V.s();!(G=V.n()).done;){var H=G.value;_&&H.checkDeprecations(C,_),P+=H.getModuleSource(i,S);var W=H.injections[i];for(var $ in W){var q=$.match(/^(v|f)s:#([\w-]+)$/);if(q){var X="decl"===q[2]?k:R;X[$]=X[$]||[],X[$].push(W[$])}else I[$]=I[$]||[],I[$].push(W[$])}}}catch(t){V.e(t)}finally{V.f()}return P+=U,P=Object(A.c)(P,i,k),P+=function(t,e){var r="";for(var n in t){var i=t[n];if(r+="void ".concat(i.signature," {\n"),i.header&&(r+="  ".concat(i.header)),e[n]){var a=e[n];a.sort((function(t,e){return t.order-e.order}));var o,s=j(a);try{for(s.s();!(o=s.n()).done;)r+="  ".concat(o.value.injection,"\n")}catch(t){s.e(t)}finally{s.f()}}i.footer&&(r+="  ".concat(i.footer)),r+="}\n"}return r}(L[i],I),P+=C,B(P=Object(A.c)(P,i,R),v?100:S,x)}function H(t){return function(e){var r,n={},i=j(t);try{for(i.s();!(r=i.n()).done;){var a=r.value.getUniforms(e,n);Object.assign(n,a)}}catch(t){i.e(t)}finally{i.f()}return n}}var W=r(293);function $(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return q(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return X}));var X=function(){function t(e){i()(this,t),this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}return o()(t,[{key:"addDefaultModule",value:function(t){this._defaultModules.find((function(e){return e.name===t.name}))||this._defaultModules.push(t),this.stateHash++}},{key:"removeDefaultModule",value:function(t){var e="string"==typeof t?t:t.name;this._defaultModules=this._defaultModules.filter((function(t){return t.name!==e})),this.stateHash++}},{key:"addShaderHook",value:function(t,e){e&&(t=Object.assign(e,{hook:t})),this._hookFunctions.push(t),this.stateHash++}},{key:"get",value:function(){var t,e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.vs,i=void 0===n?"":n,a=r.fs,o=void 0===a?"":a,s=r.defines,u=void 0===s?{}:s,l=r.inject,c=void 0===l?{}:l,h=r.varyings,f=void 0===h?[]:h,d=r.bufferMode,p=void 0===d?35981:d,m=r.transpileToGLSL100,v=void 0!==m&&m,g=this._getModuleList(r.modules),y=this._getHash(i),_=this._getHash(o),b=g.map((function(t){return e._getHash(t.name)})).sort(),x=f.map((function(t){return e._getHash(t)})),w=Object.keys(u).sort(),M=Object.keys(c).sort(),A=[],E=[],S=$(w);try{for(S.s();!(t=S.n()).done;){var T=t.value;A.push(this._getHash(T)),A.push(this._getHash(u[T]))}}catch(t){S.e(t)}finally{S.f()}var C,O=$(M);try{for(O.s();!(C=O.n()).done;){var P=C.value;E.push(this._getHash(P)),E.push(this._getHash(c[P]))}}catch(t){O.e(t)}finally{O.f()}var L="".concat(y,"/").concat(_,"D").concat(A.join("/"),"M").concat(b.join("/"),"I").concat(E.join("/"),"V").concat(x.join("/"),"H").concat(this.stateHash,"B").concat(p).concat(v?"T":"");if(!this._programCache[L]){var I=G(this.gl,{vs:i,fs:o,modules:g,inject:c,defines:u,hookFunctions:this._hookFunctions,transpileToGLSL100:v});this._programCache[L]=new W.a(this.gl,{hash:L,vs:I.vs,fs:I.fs,varyings:f,bufferMode:p}),this._getUniforms[L]=I.getUniforms||function(t){},this._useCounts[L]=0}return this._useCounts[L]++,this._programCache[L]}},{key:"getUniforms",value:function(t){return this._getUniforms[t.hash]||null}},{key:"release",value:function(t){var e=t.hash;this._useCounts[e]--,0===this._useCounts[e]&&(this._programCache[e].delete(),delete this._programCache[e],delete this._getUniforms[e],delete this._useCounts[e])}},{key:"_getHash",value:function(t){return void 0===this._hashes[t]&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}},{key:"_getModuleList",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=new Array(this._defaultModules.length+t.length),r={},n=0,i=0,a=this._defaultModules.length;i<a;++i){var o=this._defaultModules[i],s=o.name;e[n++]=o,r[s]=!0}for(var u=0,l=t.length;u<l;++u){var c=t[u],h=c.name;r[h]||(e[n++]=c,r[h]=!0)}return e.length=n,e}}],[{key:"getDefaultProgramManager",value:function(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new t(e),e.luma.defaultProgramManager}}]),t}()},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(163),u=r(11),l=r.n(u),c={number:{validate:function(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate:function(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function h(t){var e=f(t);return"object"===e?t?"type"in t?Object.assign({},t,c[t.type]):"value"in t?(e=f(t.value),Object.assign({type:e},t,c[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},c[e])}function f(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":l()(t)}r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return p}));var d=function(){function t(e){var r=e.name,n=e.vs,a=e.fs,o=e.dependencies,u=void 0===o?[]:o,l=e.uniforms,c=e.getUniforms,f=e.deprecations,d=void 0===f?[]:f,p=e.defines,m=void 0===p?{}:p,v=e.inject,g=void 0===v?{}:v,y=e.vertexShader,_=e.fragmentShader;i()(this,t),Object(s.a)("string"==typeof r),this.name=r,this.vs=n||y,this.fs=a||_,this.getModuleUniforms=c,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(d),this.defines=m,this.injections=function(t){var e={vs:{},fs:{}};for(var r in t){var n=t[r];"string"==typeof n&&(n={order:0,injection:n}),e[r.slice(0,2)][r]=n}return e}(g),l&&(this.uniforms=function(t){var e={};for(var r in t){var n=h(t[r]);e[r]=n}return e}(l))}return o()(t,[{key:"getModuleSource",value:function(t){var e;switch(t){case"vs":e=this.vs||"";break;case"fs":e=this.fs||"";break;default:Object(s.a)(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),"\n").concat(e,"// END MODULE_").concat(this.name,"\n\n")}},{key:"getUniforms",value:function(t,e){return this.getModuleUniforms?this.getModuleUniforms(t,e):this.uniforms?this._defaultGetUniforms(t):{}}},{key:"getDefines",value:function(){return this.defines}},{key:"checkDeprecations",value:function(t,e){this.deprecations.forEach((function(r){r.regex.test(t)&&(r.deprecated?e.deprecated(r.old,r.new)():e.removed(r.old,r.new)())}))}},{key:"_parseDeprecationDefinitions",value:function(t){return t.forEach((function(t){t.regex="function"===t.type?new RegExp("\\b".concat(t.old,"\\(")):new RegExp("".concat(t.type," ").concat(t.old,";"))})),t}},{key:"_defaultGetUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={},r=this.uniforms;for(var n in r){var i=r[n];n in t&&!i.private?(i.validate&&Object(s.a)(i.validate(t[n],i),"".concat(this.name,": invalid ").concat(n)),e[n]=t[n]):e[n]=i.value}return e}}]),t}();function p(t){if(!t.normalized&&(t.normalized=!0,t.uniforms&&!t.getUniforms)){var e=new d(t);t.getUniforms=e.getUniforms.bind(e)}return t}},function(t,e,r){var n=r(38),i=r(79),a=r(63),o=r(8),s=r(61),u=r(10);function l(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Object(u.a)(!1),0}}var c=r(211);function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.sourceX,n=void 0===r?0:r,i=e.sourceY,a=void 0===i?0:i,o=e.sourceFormat,l=void 0===o?6408:o,c=e.sourceAttachment,h=void 0===c?36064:c,f=e.target,d=void 0===f?null:f,p=e.sourceWidth,g=e.sourceHeight,y=e.sourceType,_=m(t),b=_.framebuffer,x=_.deleteFramebuffer;Object(u.a)(b);var w=b.gl,M=b.handle,A=b.attachments;p=p||b.width,g=g||b.height,36064===h&&null===M&&(h=1028),Object(u.a)(A[h]),d=v(d,y=y||A[h].type,l,p,g),y=y||Object(s.b)(d);var E=w.bindFramebuffer(36160,M);return w.readPixels(n,a,p,g,l,y,d),w.bindFramebuffer(36160,E||null),x&&b.delete(),d}function f(t,e){var r=e.sourceX,i=void 0===r?0:r,a=e.sourceY,s=void 0===a?0:a,c=e.sourceFormat,h=void 0===c?6408:c,f=e.target,d=void 0===f?null:f,p=e.targetByteOffset,v=void 0===p?0:p,g=e.sourceWidth,y=e.sourceHeight,_=e.sourceType,b=m(t),x=b.framebuffer,w=b.deleteFramebuffer;Object(u.a)(x),g=g||x.width,y=y||x.height;var M=Object(o.a)(x.gl);if(_=_||(d?d.type:5121),!d){var A=l(h),E=function(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return Object(u.a)(!1),0}}(_);d=new n.a(M,{byteLength:v+g*y*A*E,accessor:{type:_,size:A}})}return d.bind({target:35051}),Object(o.o)(M,{framebuffer:x},(function(){M.readPixels(i,s,g,y,h,_,v)})),d.unbind({target:35051}),w&&x.delete(),d}function d(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.sourceAttachment,n=e.targetMaxHeight,i=void 0===n?Number.MAX_SAFE_INTEGER:n,a=h(t,{sourceAttachment:void 0===r?36064:r}),o=t.width,u=t.height;u>i;){var l=Object(s.d)({data:a,width:o,height:u});a=l.data,o=l.width,u=l.height}Object(s.a)({data:a,width:o,height:u});var c=document.createElement("canvas");c.width=o,c.height=u;var f=c.getContext("2d"),d=f.createImageData(o,u);return d.data.set(a),f.putImageData(d,0,0),c.toDataURL()}function p(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.sourceX,i=void 0===n?0:n,s=r.sourceY,l=void 0===s?0:s,c=r.targetMipmaplevel,h=void 0===c?0:c,f=r.targetInternalFormat,d=void 0===f?6408:f,p=r.targetX,v=r.targetY,g=r.targetZ,y=r.width,_=r.height,b=m(t),x=b.framebuffer,w=b.deleteFramebuffer;Object(u.a)(x);var M=x.gl,A=void 0!==p||void 0!==v||void 0!==g;p=p||0,v=v||0,g=g||0;var E=M.bindFramebuffer(36160,x.handle);Object(u.a)(e);var S=null;if(e instanceof a.a&&(S=e,y=Number.isFinite(y)?y:S.width,_=Number.isFinite(_)?_:S.height,S.bind(0),e=S.target),A)switch(e){case 3553:case 34067:M.copyTexSubImage2D(e,h,p,v,i,l,y,_);break;case 35866:case 32879:Object(o.a)(M).copyTexSubImage3D(e,h,p,v,g,i,l,y,_)}else M.copyTexImage2D(e,h,d,i,l,y,_,0);return S&&S.unbind(),M.bindFramebuffer(36160,E||null),w&&x.delete(),S}function m(t){return t instanceof i.a?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Object(c.b)(t),deleteFramebuffer:!0}}function v(t,e,r,n,i){return t||(e=e||5121,new(Object(s.c)(e,{clamped:!1}))(n*i*l(r)))}r.d(e,"c",(function(){return h})),r.d(e,"d",(function(){return f})),r.d(e,"a",(function(){return d})),r.d(e,"b",(function(){return p}))},,,,,,function(t,e,r){var n=r(118);Object.defineProperty(e,"__esModule",{value:!0}),e.console=e.process=e.document=e.global=e.window=e.self=void 0;var i=n(r(11)),a={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==commonjsGlobal&&commonjsGlobal,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":(0,i.default)(process))&&process};e.self=a.self||a.window||a.global,e.window=a.window||a.self||a.global,e.global=a.global||a.self||a.window,e.document=a.document||{},e.process=a.process||{};var o=console;e.console=o},function(t,e,r){var n=r(118);Object.defineProperty(e,"__esModule",{value:!0}),e.default=o,e.isBrowserMainThread=function(){return o()&&"undefined"!=typeof document};var i=n(r(11)),a=n(r(173));function o(){return!("object"===("undefined"==typeof process?"undefined":(0,i.default)(process))&&"[object process]"===String(process)&&!process.browser)||(0,a.default)()}},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,r(e,n)}t.exports=r,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(190);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(192);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){r.d(e,"a",(function(){return h}));var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(23),u=r(52),l=r(46),c=r(100);function h(t,e,r,n){return f.apply(this,arguments)}function f(){return(f=i()(o.a.mark((function t(e,r,n,i){var a,h;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(r)||Object(u.a)(r)||(n=r,r=void 0),a=Object(l.a)(n),h=e,"string"!=typeof e){t.next=7;break}return t.next=6,a(e);case 6:h=t.sent;case 7:if(!Object(s.b)(e)){t.next=11;break}return t.next=10,a(e);case 10:h=t.sent;case 11:return t.next=13,Object(c.a)(h,r,n);case 13:return t.abrupt("return",t.sent);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},function(t,e){},function(t,e){t.exports=function(t){this.wrapped=t}},function(t,e,r){r.d(e,"a",(function(){return A}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(18),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(145),y=r(36),_=r(74);function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function M(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var A=function(t){f()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}(r);function r(){return o()(this,r),e.apply(this,arguments)}return u()(r,[{key:"isComposite",get:function(){return!0}},{key:"isLoaded",get:function(){return c()(v()(r.prototype),"isLoaded",this)&&this.getSubLayers().every((function(t){return t.isLoaded}))}},{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(t){c()(v()(r.prototype),"setState",this).call(this,t),this.setNeedsUpdate()}},{key:"getPickingInfo",value:function(t){var e=t.info,r=e.object;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id?(e.object=r.__source.object,e.index=r.__source.index,e):e}},{key:"renderLayers",value:function(){return null}},{key:"filterSubLayer",value:function(t){return!0}},{key:"shouldRenderSubLayer",value:function(t,e){return e&&e.length}},{key:"getSubLayerClass",value:function(t,e){var r=this.props._subLayerProps;return r&&r[t]&&r[t].type||e}},{key:"getSubLayerRow",value:function(t,e,r){return t.__source={parent:this,object:e,index:r},t}},{key:"getSubLayerAccessor",value:function(t){if("function"==typeof t){var e={data:this.props.data,target:[]};return function(r,n){return r&&r.__source?(e.index=r.__source.index,t(r.__source.object,e)):t(r,n)}}return t}},{key:"getSubLayerProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.props,r=e.extensions,n=e._subLayerProps,i={opacity:e.opacity,pickable:e.pickable,visible:e.visible,parameters:e.parameters,getPolygonOffset:e.getPolygonOffset,highlightedObjectIndex:e.highlightedObjectIndex,autoHighlight:e.autoHighlight,highlightColor:e.highlightColor,coordinateSystem:e.coordinateSystem,coordinateOrigin:e.coordinateOrigin,wrapLongitude:e.wrapLongitude,positionFormat:e.positionFormat,modelMatrix:e.modelMatrix,extensions:r,fetch:e.fetch,operation:e.operation},a=n&&n[t.id],o=a&&a.updateTriggers,s=t.id||"sublayer";if(a){var u=this.constructor._propTypes,l=t.type?t.type._propTypes:{};for(var c in a){var h=l[c]||u[c];h&&"accessor"===h.type&&(a[c]=this.getSubLayerAccessor(a[c]))}}Object.assign(i,t,a),i.id="".concat(this.props.id,"-").concat(s),i.updateTriggers=M(M({all:this.props.updateTriggers.all},t.updateTriggers),o);var f,d=b(r);try{for(d.s();!(f=d.n()).done;){var p=f.value,m=p.getSubLayerProps.call(this,p);m&&Object.assign(i,m,{updateTriggers:Object.assign(i.updateTriggers,m.updateTriggers)})}}catch(t){d.e(t)}finally{d.f()}return i}},{key:"_updateAutoHighlight",value:function(t){var e,r=b(this.getSubLayers());try{for(r.s();!(e=r.n()).done;)e.value.updateAutoHighlight(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var t=this.internalState.subLayers,e=!t||this.needsUpdate();e&&(t=this.renderLayers(),t=Object(_.b)(t,Boolean),this.internalState.subLayers=t),Object(y.a)("compositeLayer.renderLayers",this,e,t);var r,n=b(t);try{for(n.s();!(r=n.n()).done;)r.value.parent=this}catch(t){n.e(t)}finally{n.f()}}}]),r}(g.a);A.layerName="CompositeLayer"},function(t,e,r){var n=r(99);e.a={name:"project32",dependencies:[n.a],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"}},function(t,e,r){r.d(e,"a",(function(){return p}));var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(4),c=r(92);function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={id:"request-scheduler",throttleRequests:!0,maxRequests:6},p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t),Object(l.a)(this,"props",void 0),Object(l.a)(this,"stats",void 0),Object(l.a)(this,"activeRequestCount",0),Object(l.a)(this,"requestQueue",[]),Object(l.a)(this,"requestMap",new Map),Object(l.a)(this,"deferredUpdate",null),this.props=f(f({},d),e),this.stats=new c.a({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}return u()(t,[{key:"scheduleRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(t))return this.requestMap.get(t);var r={handle:t,priority:0,getPriority:e},n=new Promise((function(t){return r.resolve=t,r}));return this.requestQueue.push(r),this.requestMap.set(t,n),this._issueNewRequests(),n}},{key:"_issueRequest",value:function(t){var e=this,r=t.handle,n=t.resolve,i=!1,a=function(){i||(i=!0,e.requestMap.delete(r),e.activeRequestCount--,e._issueNewRequests())};return this.activeRequestCount++,n?n({done:a}):Promise.resolve({done:a})}},{key:"_issueNewRequests",value:function(){var t=this;this.deferredUpdate||(this.deferredUpdate=setTimeout((function(){return t._issueNewRequestsAsync()}),0))}},{key:"_issueNewRequestsAsync",value:function(){this.deferredUpdate=null;var t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(var e=0;e<t;++e){var r=this.requestQueue.shift();r&&this._issueRequest(r)}}}},{key:"_updateAllRequests",value:function(){for(var t=this.requestQueue,e=0;e<t.length;++e){var r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort((function(t,e){return t.priority-e.priority}))}},{key:"_updateRequest",value:function(t){return t.priority=t.getPriority(t.handle),!(t.priority<0&&(t.resolve(null),1))}}]),t}()},function(t,e,r){r.d(e,"a",(function(){return u}));var n,i=r(7),a=r.n(i),o=r(2),s=r.n(o),u={name:"JSON",id:"json",module:"json",version:"3.1.5",extensions:["json","geojson"],mimeTypes:["application/json"],category:"json",text:!0,parseTextSync:l,parse:(n=a()(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",l((new TextDecoder).decode(e)));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)}),options:{}};function l(t){return JSON.parse(t)}},function(t,e,r){r.d(e,"a",(function(){return i}));var n=r(120);function i(t){try{return JSON.parse(t)}catch(e){throw new Error('Failed to parse JSON from data starting with "'.concat(Object(n.a)(t),'"'))}}},function(t,e,r){e.a={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:2*Math.PI}},function(t,e,r){r.d(e,"a",(function(){return M}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(157),p=r(25),m=r(81),v=r(64),g=r(28),y=r(24),_=Object.freeze([1,0,0,0,1,0,0,0,1]),b=Object.freeze([0,0,0,0,0,0,0,0,0]),x=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),w={},M=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(t){var n;return i()(this,r),n=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return o()(r,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return x}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=a,this[6]=o,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,a,o,s,u){return this[0]=t,this[1]=n,this[2]=o,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=a,this[8]=u,this.check()}},{key:"determinant",value:function(){return v.b(this)}},{key:"identity",value:function(){return this.copy(_)}},{key:"fromQuaternion",value:function(t){return v.c(this,t),this.check()}},{key:"transpose",value:function(){return v.i(this,this),this.check()}},{key:"invert",value:function(){return v.d(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return v.e(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return v.e(this,this,t),this.check()}},{key:"rotate",value:function(t){return v.f(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?v.g(this,this,t):v.g(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return v.h(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=g.i(e||[-0,-0],t,this);break;case 3:e=y.r(e||[-0,-0,-0],t,this);break;case 4:e=Object(m.d)(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Object(p.b)(e,t.length),e}},{key:"transformVector",value:function(t,e){return Object(p.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return Object(p.c)("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return Object(p.c)("Matrix3.transformVector"),this.transform(t,e)}}],[{key:"IDENTITY",get:function(){return w.IDENTITY=w.IDENTITY||Object.freeze(new r(_)),w.IDENTITY}},{key:"ZERO",get:function(){return w.ZERO=w.ZERO||Object.freeze(new r(b)),w.ZERO}}]),r}(d.a)},function(t,e,r){r.d(e,"a",(function(){return y}));var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(153),p=r(14),m=r(25),v=r(28),g=r(81),y=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i()(this,r),t=e.call(this,2),Object(p.f)(n)&&1===arguments.length?t.copy(n):(p.b.debug&&(Object(m.a)(n),Object(m.a)(a)),t[0]=n,t[1]=a),t}return o()(r,[{key:"set",value:function(t,e){return this[0]=t,this[1]=e,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this.check()}},{key:"fromObject",value:function(t){return p.b.debug&&(Object(m.a)(t.x),Object(m.a)(t.y)),this[0]=t.x,this[1]=t.y,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return v.j(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return Object(g.a)(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return v.i(this,this,t),this.check()}},{key:"transformByMatrix2x3",value:function(t){return v.h(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return v.g(this,this,t),this.check()}}]),r}(d.a)},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(147),c=r(69),h=r(22),f=r(74);function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}return u()(t,[{key:"finalize",value:function(){for(var t in this.controllers)this.controllers[t]&&this.controllers[t].finalize();this.controllers={}}},{key:"needsRedraw",value:function(){var t=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),t}},{key:"setNeedsUpdate",value:function(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}},{key:"updateViewStates",value:function(){for(var t in this.controllers){var e=this.controllers[t];e&&e.updateTransition()}}},{key:"getViewports",value:function(t){return t?this._viewports.filter((function(e){return e.containsPixel(t)})):this._viewports}},{key:"getViews",value:function(){var t={};return this.views.forEach((function(e){t[e.id]=e})),t}},{key:"getView",value:function(t){return"string"==typeof t?this.views.find((function(e){return e.id===t})):t}},{key:"getViewState",value:function(t){var e=this.getView(t),r=e&&this.viewState[e.getViewStateId()]||this.viewState;return e?e.filterViewState(r):r}},{key:"getViewport",value:function(t){return this._viewportMap[t]}},{key:"unproject",value:function(t,e){for(var r=this.getViewports(),n={x:t[0],y:t[1]},i=r.length-1;i>=0;--i){var a=r[i];if(a.containsPixel(n)){var o=t.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,e)}}return null}},{key:"setProps",value:function(t){"views"in t&&this._setViews(t.views),"viewState"in t&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}},{key:"_update",value:function(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}},{key:"_setSize",value:function(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.setNeedsUpdate("Size changed"))}},{key:"_setViews",value:function(t){t=Object(f.b)(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}},{key:"_setViewState",value:function(t){t?(!Object(c.a)(t,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):h.a.warn("missing `viewState` or `initialViewState`")()}},{key:"_onViewStateChange",value:function(t,e){e.viewId=t,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(e)}},{key:"_createController",value:function(t,e){return new e.type(p({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,e.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:function(e){return t._getViewport(e,{width:e.width,height:e.height})}},e))}},{key:"_updateController",value:function(t,e,r,n){var i=t.controller;return i?(i=p(p(p(p({},e),t.props),i),{},{id:t.id,x:r.x,y:r.y,width:r.width,height:r.height}),n?n.setProps(i):n=this._createController(t,i),n):null}},{key:"_rebuildViewports",value:function(){var t=this.width,e=this.height,r=this.views,n=this.controllers;this._viewports=[],this.controllers={};for(var i=!1,a=r.length;a--;){var o=r[a],s=this.getViewState(o),u=o.makeViewport({width:t,height:e,viewState:s}),l=n[o.id];o.controller&&!l&&(i=!0),!i&&o.controller||!l||(l.finalize(),l=null),this.controllers[o.id]=this._updateController(o,s,u,l),this._viewports.unshift(u)}for(var c in n)n[c]&&!this.controllers[c]&&n[c].finalize();this._buildViewportMap()}},{key:"_buildViewportMap",value:function(){var t=this;this._viewportMap={},this._viewports.forEach((function(e){e.id&&(t._viewportMap[e.id]=t._viewportMap[e.id]||e)}))}},{key:"_diffViews",value:function(t,e){return t.length!==e.length||t.some((function(r,n){return!t[n].equals(e[n])}))}}]),t}(),v=r(137),g=r(124),y=r(6),_=r.n(y),b=r(9),x=r.n(b),w=r(5),M=r.n(w),A=r(115),E=r(14),S=r(17),T=r.n(S),C=r(18),O=r.n(C),P=r(79),L=r(8),I=r(16);function k(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function R(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?k(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var D=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(t,n){var a,s;o()(this,r),s=e.call(this,t,n),i()(T()(s),"maskMap",void 0),i()(T()(s),"fbo",void 0);var u=n.mapSize,l=void 0===u?2048:u;return s.maskMap=new A.a(t,{width:l,height:l,parameters:(a={},i()(a,10241,9729),i()(a,10240,9729),i()(a,10242,33071),i()(a,10243,33071),a)}),s.fbo=new P.a(t,{id:"maskmap",width:l,height:l,attachments:i()({},36064,s.maskMap)}),s}return u()(r,[{key:"render",value:function(t){var e=this,n=this.gl,i=[!1,!1,!1,!1];return i[t.channel]=!0,Object(L.o)(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},(function(){return O()(M()(r.prototype),"render",e).call(e,R(R({},t),{},{target:e.fbo,pass:"mask"}))}))}},{key:"shouldDrawLayer",value:function(t){return t.props.operation===I.c.MASK}},{key:"delete",value:function(){this.fbo.delete(),this.maskMap.delete()}}]),r}(r(77).a),B=r(78),F=r(141),j=r(87),N=r(27);function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var G=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(t){var n;return o()(this,r),(n=e.call(this,t)).dummyMaskMap=null,n.useInPicking=!0,n.channels=[],n.masks=null,n}return u()(r,[{key:"preRender",value:function(t,e){var r=e.layers,n=e.layerFilter,i=e.viewports,a=e.onViewportActive,o=e.views;this.dummyMaskMap||(this.dummyMaskMap=new A.a(t,{width:1,height:1}));var s=r.filter((function(t){return t.props.operation===I.c.MASK&&t.props.visible}));if(0===s.length)return this.masks=null,void(this.channels.length=0);this.masks={},this.maskPass||(this.maskPass=new D(t,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);var u=this._sortMaskChannels(s),l=i[0],c=!this.lastViewport||!this.lastViewport.equals(l);for(var h in u)this._renderChannel(u[h],{layerFilter:n,onViewportActive:a,views:o,viewport:l,viewportChanged:c})}},{key:"_renderChannel",value:function(t,e){var r=e.layerFilter,n=e.onViewportActive,i=e.views,a=e.viewport,o=e.viewportChanged,s=this.channels[t.index],u=t===s||s.layers.length!==t.layers.length||t.layerBounds.some((function(t,e){return t!==s.layerBounds[e]}));if(t.bounds=s.bounds,t.maskBounds=s.maskBounds,this.channels[t.index]=t,(u||o)&&(this.lastViewport=a,t.bounds=function(t){var e,r=t.viewport,n=null,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return U(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t.layers);try{for(i.s();!(e=i.n()).done;){var a=e.value.getBounds();a&&(n?(n[0]=Math.min(n[0],a[0][0]),n[1]=Math.min(n[1],a[0][1]),n[2]=Math.max(n[2],a[1][0]),n[3]=Math.max(n[3],a[1][1])):n=[a[0][0],a[0][1],a[1][0],a[1][1]])}}catch(t){i.e(t)}finally{i.f()}var o=r.getBounds();if(!n)return o;var s=function(t){var e=t[2]-t[0],r=t[3]-t[1],n=t[0]+.5*e,i=t[1]+.5*r;return[n-e,i-r,n+e,i+r]}(o);return n[2]-n[0]<s[2]-s[0]||n[3]-n[1]<s[3]-s[1]||(n[0]=Math.max(n[0],s[0]),n[1]=Math.max(n[1],s[1]),n[2]=Math.min(n[2],s[2]),n[3]=Math.min(n[3],s[3])),n}({layers:t.layers,viewport:a}),u||!Object(E.d)(t.bounds,s.bounds))){var l=this.maskPass,c=this.maskMap,h=function(t){var e=t.bounds,r=t.width,n=t.height;if(e[2]<=e[0]||e[3]<=e[1])return null;if(r-=2,n-=2,t.viewport instanceof j.a){var i=Object(N.c)({width:r,height:n,bounds:[[e[0],e[1]],[e[2],e[3]]],maxZoom:20});return new j.a({longitude:i.longitude,latitude:i.latitude,zoom:i.zoom,x:1,y:1,width:r,height:n})}var a=[(e[0]+e[2])/2,(e[1]+e[3])/2,0],o=Math.min(20,r/(e[2]-e[0]),n/(e[3]-e[1]));return new F.a({x:1,y:1}).makeViewport({width:r,height:n,viewState:{target:a,zoom:Math.log2(o)}})}({bounds:t.bounds,viewport:a,width:c.width,height:c.height});t.maskBounds=h?h.getBounds():[0,0,1,1],l.render({channel:t.index,layers:t.layers,layerFilter:r,viewports:h?[h]:[],onViewportActive:n,views:i,moduleParameters:{devicePixelRatio:1}})}this.masks[t.id]={index:t.index,bounds:t.maskBounds,coordinateOrigin:t.coordinateOrigin,coordinateSystem:t.coordinateSystem}}},{key:"_sortMaskChannels",value:function(t){var e,r=this,n={},i=0,a=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?z(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t);try{var o=function(){var t=e.value,a=t.root.id,o=n[a];if(!o){if(++i>4)return h.a.warn("Too many mask layers. The max supported is 4")(),"continue";o={id:a,index:r.channels.findIndex((function(t){return(null==t?void 0:t.id)===a})),layers:[],layerBounds:[],coordinateOrigin:t.root.props.coordinateOrigin,coordinateSystem:t.root.props.coordinateSystem},n[a]=o}o.layers.push(t),o.layerBounds.push(t.getBounds())};for(a.s();!(e=a.n()).done;)o()}catch(t){a.e(t)}finally{a.f()}for(var s=0;s<4;s++){var u=this.channels[s];u&&u.id in n||(this.channels[s]=null)}for(var l in n){var c=n[l];c.index<0&&(c.index=this.channels.findIndex((function(t){return!t})),this.channels[c.index]=c)}return n}},{key:"getModuleParameters",value:function(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}},{key:"cleanup",value:function(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=null),this.maskPass&&(this.maskPass.delete(),this.maskPass=null,this.maskMap=null),this.lastViewport=null,this.masks=null,this.channels.length=0}}]),r}(B.a);function V(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return H(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?H(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var W=new g.a,$=function(){function t(){o()(this,t),i()(this,"effects",void 0),i()(this,"_internalEffects",void 0),i()(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}return u()(t,[{key:"setProps",value:function(t){"effects"in t&&(t.effects.length===this.effects.length&&Object(c.a)(t.effects,this.effects)||(this.setEffects(t.effects),this._needsRedraw="effects changed"))}},{key:"needsRedraw",value:function(){var t=this._needsRedraw;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1}).clearRedrawFlags&&(this._needsRedraw=!1),t}},{key:"getEffects",value:function(){return this._internalEffects}},{key:"finalize",value:function(){this.cleanup()}},{key:"setEffects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.cleanup(),this.effects=t,this._internalEffects=t.slice(),this._internalEffects.push(new G),t.some((function(t){return t instanceof g.a}))||this._internalEffects.push(W)}},{key:"cleanup",value:function(){var t,e=V(this.effects);try{for(e.s();!(t=e.n()).done;)t.value.cleanup()}catch(t){e.e(t)}finally{e.f()}var r,n=V(this._internalEffects);try{for(n.s();!(r=n.n()).done;)r.value.cleanup()}catch(t){n.e(t)}finally{n.f()}this.effects.length=0,this._internalEffects.length=0}}]),t}(),q=r(148),X=r(180),K=r(159);function Z(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var J={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function Q(t){var e=t.pickedColors,r=t.decodePickingColor,n=t.deviceX,i=t.deviceY,a=t.deviceRadius,o=t.deviceRect;if(e){for(var s=o.x,u=o.y,l=o.width,c=o.height,h=a*a,f=-1,d=0,p=0;p<c;p++){var m=p+u-i,v=m*m;if(v>h)d+=4*l;else for(var g=0;g<l;g++){if(e[d+3]-1>=0){var y=g+s-n,_=y*y+v;_<=h&&(h=_,f=d)}d+=4}}if(f>=0){var b=e.slice(f,f+4),x=r(b);if(x){var w=Math.floor(f/4/l),M=f/4-w*l;return Y(Y({},x),{},{pickedColor:b,pickedX:s+M,pickedY:u+w})}}}return J}function tt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function et(t){var e=t.pickInfo,r=t.viewports,n=t.pixelRatio,i=t.x,a=t.y,o=t.z,s=r[0];r.length>1&&(s=function(t,e){for(var r=t.length-1;r>=0;r--){var n=t[r];if(n.containsPixel(e))return n}return t[0]}((null==e?void 0:e.pickedViewports)||r,{x:i,y:a}));var u=s&&s.unproject([i-s.x,a-s.y,o]);return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:a,pixel:[i,a],coordinate:u,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:null,pixelRatio:n}}function rt(t){var e=t.pickInfo,r=t.lastPickedInfo,n=t.mode,a=e.pickedColor,o=e.pickedLayer,s=e.pickedObjectIndex,u=o?[o]:[];if("hover"===n){var l=r.layerId,c=o&&o.props.id;if(c!==l||s!==r.index){if(c!==l){var h=t.layers.find((function(t){return t.props.id===l}));h&&u.unshift(h)}r.layerId=c,r.index=s,r.info=null}}var f=et(t),d=new Map;return d.set(null,f),u.forEach((function(t){var e=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tt(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},f);t===o&&(e.color=a,e.index=s,e.picked=!0),e=nt({layer:t,info:e,mode:n}),t===o&&"hover"===n&&(r.info=e),d.set(e.layer.id,e),"hover"===n&&e.layer.updateAutoHighlight(e)})),d}function nt(t){for(var e=t.layer,r=t.info,n=t.mode;e&&r;){var i=r.layer||null;r.sourceLayer=i,r.layer=e,r=e.getPickingInfo({info:r,mode:n,sourceLayer:i}),e=e.parent}return r}function it(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return at(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?at(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ot(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function st(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ut=function(){function t(e){o()(this,t),this.gl=e,this.pickingFBO=null,this.pickLayersPass=new K.a(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}return u()(t,[{key:"setProps",value:function(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}},{key:"finalize",value:function(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}},{key:"pickObject",value:function(t){return this._pickClosestObject(t)}},{key:"pickObjects",value:function(t){return this._pickVisibleObjects(t)}},{key:"getLastPickedObject",value:function(t){var e=t.x,r=t.y,n=t.viewports,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.lastPickedInfo.info,a=i&&i.layer&&i.layer.id,o=i&&i.viewport&&i.viewport.id,s=a?t.layers.find((function(t){return t.id===a})):null,u=o&&n.find((function(t){return t.id===o}))||n[0],l=u&&u.unproject([e-u.x,r-u.y]),c={x:e,y:r,viewport:u,coordinate:l,layer:s};return st(st({},i),c)}},{key:"_resizeBuffer",value:function(){var t=this.gl;return this.pickingFBO||(this.pickingFBO=new P.a(t),P.a.isSupported(t,{colorBufferFloat:!0})&&(this.depthFBO=new P.a(t),this.depthFBO.attach(i()({},36064,new A.a(t,{format:Object(L.j)(t)?34836:6408,type:5126}))))),this.pickingFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:t.canvas.width,height:t.canvas.height}),this.pickingFBO}},{key:"_getPickable",value:function(t){if(!1===this._pickable)return null;var e=t.filter((function(t){return t.isPickable()&&!t.isComposite}));return e.length?e:null}},{key:"_pickClosestObject",value:function(t){var e=t.layers,r=t.views,n=t.viewports,i=t.x,a=t.y,o=t.radius,s=void 0===o?0:o,u=t.depth,l=void 0===u?1:u,c=t.mode,h=void 0===c?"query":c,f=t.unproject3D,d=t.onViewportActive,p=t.effects;if(!(e=this._getPickable(e)))return{result:[],emptyInfo:et({viewports:n,x:i,y:a})};this._resizeBuffer();for(var m,v=Object(L.e)(this.gl),g=Object(L.d)(this.gl,[i,a],!0),y=[g.x+Math.floor(g.width/2),g.y+Math.floor(g.height/2)],_=Math.round(s*v),b=this.pickingFBO,x=this._getPickingRect({deviceX:y[0],deviceY:y[1],deviceRadius:_,deviceWidth:b.width,deviceHeight:b.height}),w=[],M=new Set,A=0;A<l;A++){var E=Q(st(st({},x&&this._drawAndSample({layers:e,views:r,viewports:n,onViewportActive:d,deviceRect:x,effects:p,pass:"picking:".concat(h),redrawReason:h})),{},{deviceX:y[0],deviceY:y[1],deviceRadius:_,deviceRect:x})),S=void 0;E.pickedLayer&&f&&this.depthFBO&&(S=this._drawAndSample({layers:[E.pickedLayer],views:r,viewports:n,onViewportActive:d,deviceRect:{x:E.pickedX,y:E.pickedY,width:1,height:1},effects:p,pass:"picking:".concat(h),redrawReason:"pick-z",pickZ:!0}).pickedColors[0]),E.pickedLayer&&A+1<l&&(M.add(E.pickedLayer),E.pickedLayer.disablePickingIndex(E.pickedObjectIndex));var T,C=it((m=rt({pickInfo:E,lastPickedInfo:this.lastPickedInfo,mode:h,layers:e,viewports:n,x:i,y:a,z:S,pixelRatio:v})).values());try{for(C.s();!(T=C.n()).done;){var O=T.value;O.layer&&w.push(O)}}catch(t){C.e(t)}finally{C.f()}if(!E.pickedColor)break}var P,I=it(M);try{for(I.s();!(P=I.n()).done;)P.value.restorePickingColors()}catch(t){I.e(t)}finally{I.f()}return{result:w,emptyInfo:m&&m.get(null)}}},{key:"_pickVisibleObjects",value:function(t){var e=t.layers,r=t.views,n=t.viewports,i=t.x,a=t.y,o=t.width,s=void 0===o?1:o,u=t.height,l=void 0===u?1:u,c=t.mode,f=void 0===c?"query":c,d=t.maxObjects,p=void 0===d?null:d,m=t.onViewportActive,v=t.effects;if(!(e=this._getPickable(e)))return[];this._resizeBuffer();for(var g=Object(L.e)(this.gl),y=Object(L.d)(this.gl,[i,a],!0),_=y.x,b=y.y+y.height,x=Object(L.d)(this.gl,[i+s,a+l],!0),w=x.y,M=function(t){var e=t.pickedColors,r=t.decodePickingColor,n=new Map;if(e)for(var i=0;i<e.length;i+=4)if(e[i+3]-1>=0){var a=e.slice(i,i+4),o=a.join(",");if(!n.has(o)){var s=r(a);s?n.set(o,Y(Y({},s),{},{pickedColor:a})):h.a.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:e,views:r,viewports:n,onViewportActive:m,deviceRect:{x:_,y:w,width:x.x+x.width-_,height:b-w},effects:v,pass:"picking:".concat(f),redrawReason:f})),A=new Map,E=Number.isFinite(p),S=0;S<M.length&&!(E&&A.size>=p);S++){var T=M[S],C={color:T.pickedColor,layer:null,index:T.pickedObjectIndex,picked:!0,x:i,y:a,width:s,height:l,pixelRatio:g};C=nt({layer:T.pickedLayer,info:C,mode:f}),A.has(C.object)||A.set(C.object,C)}return Array.from(A.values())}},{key:"_drawAndSample",value:function(t){var e=t.deviceRect,r=t.pickZ,n=r?this.depthFBO:this.pickingFBO,i=this.pickLayersPass.render({layers:t.layers,layerFilter:this.layerFilter,views:t.views,viewports:t.viewports,onViewportActive:t.onViewportActive,pickingFBO:n,deviceRect:e,effects:t.effects,pass:t.pass,redrawReason:t.redrawReason,pickZ:r}).decodePickingColor,a=e.x,o=e.y,s=e.width,u=e.height,l=new(r?Float32Array:Uint8Array)(s*u*4);return Object(X.c)(n,{sourceX:a,sourceY:o,sourceWidth:s,sourceHeight:u,target:l}),{pickedColors:l,decodePickingColor:i}}},{key:"_getPickingRect",value:function(t){var e=t.deviceX,r=t.deviceY,n=t.deviceRadius,i=t.deviceWidth,a=t.deviceHeight,o=Math.max(0,e-n),s=Math.max(0,r-n),u=Math.min(i,e+n+1)-o,l=Math.min(a,r+n+1)-s;return u<=0||l<=0?null:{x:o,y:s,width:u,height:l}}}]),t}(),lt={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"},ct=function(){function t(e){o()(this,t);var r=e.parentElement;r&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,lt),r.appendChild(this.el)),this.isVisible=!1}return u()(t,[{key:"setTooltip",value:function(t,e,r){var n=this.el;if("string"==typeof t)n.innerText=t;else{if(!t)return this.isVisible=!1,void(n.style.display="none");"text"in t&&(n.innerText=t.text),"html"in t&&(n.innerHTML=t.html),"className"in t&&(n.className=t.className),Object.assign(n.style,t.style)}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(e,"px, ").concat(r,"px)")}},{key:"remove",value:function(){this.el&&this.el.remove()}}]),t}(),ht=r(75),ft=r(175),dt=r(154),pt=r(155),mt=globalThis,vt=r(11),gt=r.n(vt),yt=r(7),_t=r.n(yt),bt=r(2),xt=r.n(bt),wt=r(130),Mt=r(10),At=r(42),Et=r(276),St=r(176);function Tt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ct(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ct(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ot=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,r),(n=e.call(this,t,i)).target=null,n._queryPending=!1,n._pollingPromise=null,Object.seal(T()(n)),n}return u()(r,[{key:"beginTimeElapsedQuery",value:function(){return this.begin(35007)}},{key:"beginOcclusionQuery",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).conservative;return this.begin(void 0!==t&&t?36202:35887)}},{key:"beginTransformFeedbackQuery",value:function(){return this.begin(35976)}},{key:"begin",value:function(t){return this._queryPending||(this.target=t,this.gl2.beginQuery(this.target,this.handle)),this}},{key:"end",value:function(){return this._queryPending||this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this}},{key:"isResultAvailable",value:function(){if(!this._queryPending)return!1;var t=this.gl2.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}},{key:"isTimerDisjoint",value:function(){return this.gl2.getParameter(36795)}},{key:"getResult",value:function(){return this.gl2.getQueryParameter(this.handle,34918)}},{key:"getTimerMilliseconds",value:function(){return this.getResult()/1e6}},{key:"createPoll",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;var r=0;return this._pollingPromise=new Promise((function(n,i){requestAnimationFrame((function a(){t.isResultAvailable()?(n(t.getResult()),t._pollingPromise=null):r++>e?(i("Timed out"),t._pollingPromise=null):requestAnimationFrame(a)}))})),this._pollingPromise}},{key:"_createHandle",value:function(){return r.isSupported(this.gl)?this.gl2.createQuery():null}},{key:"_deleteHandle",value:function(){this.gl2.deleteQuery(this.handle)}}],[{key:"isSupported",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Object(L.j)(t),i=Object(Et.c)(t,St.a.TIMER_QUERY),a=n||i,o=Tt(r);try{for(o.s();!(e=o.n()).done;)switch(e.value){case"queries":a=a&&n;break;case"timers":a=a&&i;break;default:Object(Mt.a)(!1)}}catch(t){o.e(t)}finally{o.f()}return a}}]),r}(At.a),Pt=r(35),Lt=Object(Pt.isBrowser)()&&"undefined"!=typeof document,It=0,kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var r=e.onCreateContext,n=void 0===r?function(t){return Object(L.c)(t)}:r,i=e.onAddHTML,a=void 0===i?null:i,s=e.onInitialize,u=void 0===s?function(){}:s,l=e.onRender,c=void 0===l?function(){}:l,h=e.onFinalize,f=void 0===h?function(){}:h,d=e.onError,p=e.gl,m=void 0===p?null:p,v=e.glOptions,g=void 0===v?{}:v,y=e.debug,_=void 0!==y&&y,b=e.createFramebuffer,x=void 0!==b&&b,w=e.autoResizeViewport,M=void 0===w||w,A=e.autoResizeDrawingBuffer,E=void 0===A||A,S=e.stats,T=void 0===S?wt.a.get("animation-loop-".concat(It++)):S,C=e.useDevicePixels,O=void 0===C||C;"useDevicePixelRatio"in e&&(L.k.deprecated("useDevicePixelRatio","useDevicePixels")(),O=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:a,onInitialize:u,onRender:c,onFinalize:f,onError:d,gl:m,glOptions:g,debug:_,createFramebuffer:x},this.gl=m,this.needsRedraw=null,this.timeline=null,this.stats=T,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:M,autoResizeDrawingBuffer:E,useDevicePixels:O}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}var e;return u()(t,[{key:"delete",value:function(){this.stop(),this._setDisplay(null)}},{key:"setNeedsRedraw",value:function(t){return Object(Mt.a)("string"==typeof t),this.needsRedraw=this.needsRedraw||t,this}},{key:"setProps",value:function(t){return"autoResizeViewport"in t&&(this.autoResizeViewport=t.autoResizeViewport),"autoResizeDrawingBuffer"in t&&(this.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer),"useDevicePixels"in t&&(this.useDevicePixels=t.useDevicePixels),this}},{key:"start",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._running)return this;this._running=!0;var r=this._getPageLoadPromise().then((function(){return!t._running||t._initialized?null:(t._createWebGLContext(e),t._createFramebuffer(),t._startEventHandling(),t._initializeCallbackData(),t._updateCallbackData(),t._resizeCanvasDrawingBuffer(),t._resizeViewport(),t._gpuTimeQuery=Ot.isSupported(t.gl,["timers"])?new Ot(t.gl):null,t._initialized=!0,t.onInitialize(t.animationProps))})).then((function(e){t._running&&(t._addCallbackData(e||{}),!1!==e&&t._startLoop())}));return this.props.onError&&r.catch(this.props.onError),this}},{key:"redraw",value:function(){return this.isContextLost()||(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers()),this}},{key:"stop",value:function(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}},{key:"attachTimeline",value:function(t){return this.timeline=t,this.timeline}},{key:"detachTimeline",value:function(){this.timeline=null}},{key:"waitForRender",value:function(){var t=this;return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((function(e){t._resolveNextFrame=e}))),this._nextFramePromise}},{key:"toDataURL",value:(e=_t()(xt.a.mark((function t(){return xt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setNeedsRedraw("toDataURL"),t.next=3,this.waitForRender();case 3:return t.abrupt("return",this.gl.canvas.toDataURL());case 4:case"end":return t.stop()}}),t,this)}))),function(){return e.apply(this,arguments)})},{key:"isContextLost",value:function(){return this.gl.isContextLost()}},{key:"onCreateContext",value:function(){var t;return(t=this.props).onCreateContext.apply(t,arguments)}},{key:"onInitialize",value:function(){var t;return(t=this.props).onInitialize.apply(t,arguments)}},{key:"onRender",value:function(){var t;return(t=this.props).onRender.apply(t,arguments)}},{key:"onFinalize",value:function(){var t;return(t=this.props).onFinalize.apply(t,arguments)}},{key:"getHTMLControlValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=document.getElementById(t);return r?Number(r.value):e}},{key:"setViewParameters",value:function(){return L.k.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}},{key:"_startLoop",value:function(){var t=this;this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame((function e(){t._running&&(t.redraw(),t._animationFrameId=t._requestAnimationFrame(e))}))}},{key:"_getPageLoadPromise",value:function(){return this._pageLoadPromise||(this._pageLoadPromise=Lt?new Promise((function(t,e){Lt&&"complete"===document.readyState?t(document):window.addEventListener("load",(function(){t(document)}))})):Promise.resolve({})),this._pageLoadPromise}},{key:"_setDisplay",value:function(t){this.display&&(this.display.delete(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}},{key:"_cancelAnimationFrame",value:function(t){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e));var e}},{key:"_requestAnimationFrame",value:function(t){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(t):(e=t,"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60));var e}},{key:"_renderFrame",value:function(){var t;this.display?(t=this.display)._renderFrame.apply(t,arguments):this.onRender.apply(this,arguments)}},{key:"_clearNeedsRedraw",value:function(){this.needsRedraw=null}},{key:"_setupFrame",value:function(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}},{key:"_initializeCallbackData",value:function(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}},{key:"_updateCallbackData",value:function(){var t=this._getSizeAndAspect(),e=t.width,r=t.height,n=t.aspect;e===this.animationProps.width&&r===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}},{key:"_finalizeCallbackData",value:function(){this.onFinalize(this.animationProps)}},{key:"_addCallbackData",value:function(t){"object"===gt()(t)&&null!==t&&(this.animationProps=Object.assign({},this.animationProps,t))}},{key:"_createWebGLContext",value:function(t){if(this.offScreen=t.canvas&&"undefined"!=typeof OffscreenCanvas&&t.canvas instanceof OffscreenCanvas,t=Object.assign({},t,this.props.glOptions),this.gl=this.props.gl?Object(L.h)(this.props.gl,t):this.onCreateContext(t),!Object(L.i)(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(L.l)(this.gl),this._createInfoDiv()}},{key:"_createInfoDiv",value:function(){if(this.gl.canvas&&this.props.onAddHTML){var t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";var e=document.createElement("div");e.style.position="absolute",e.style.left="10px",e.style.bottom="10px",e.style.width="300px",e.style.background="white",t.appendChild(this.gl.canvas),t.appendChild(e);var r=this.props.onAddHTML(e);r&&(e.innerHTML=r)}}},{key:"_getSizeAndAspect",value:function(){var t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight,r=1,n=this.gl.canvas;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:t>0&&e>0&&(r=t/e),{width:t,height:e,aspect:r}}},{key:"_resizeViewport",value:function(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}},{key:"_resizeCanvasDrawingBuffer",value:function(){this.autoResizeDrawingBuffer&&Object(L.m)(this.gl,{useDevicePixels:this.useDevicePixels})}},{key:"_createFramebuffer",value:function(){this.props.createFramebuffer&&(this.framebuffer=new P.a(this.gl))}},{key:"_resizeFramebuffer",value:function(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}},{key:"_beginTimers",value:function(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}},{key:"_endTimers",value:function(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}},{key:"_startEventHandling",value:function(){var t=this.gl.canvas;t&&(t.addEventListener("mousemove",this._onMousemove),t.addEventListener("mouseleave",this._onMouseleave))}},{key:"_onMousemove",value:function(t){this.animationProps._mousePosition=[t.offsetX,t.offsetY]}},{key:"_onMouseleave",value:function(t){this.animationProps._mousePosition=null}}]),t}(),Rt=r(290),Dt=r(92);function Bt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ft,jt,Nt=r(55),Ut=r(56),zt=r(129),Gt=r.n(zt),Vt={mousedown:1,mousemove:2,mouseup:4};jt=(Ft=Gt.a.PointerEventInput).prototype.handler,Ft.prototype.handler=function(t){var e=this.store;t.button>0&&(function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return!0;return!1}(e,(function(e){return e.pointerId===t.pointerId}))||e.push(t)),jt.call(this,t)},Gt.a.MouseInput.prototype.handler=function(t){var e=Vt[t.type];1&e&&t.button>=0&&(this.pressed=!0),2&e&&0===t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))};var Ht=Gt.a.Manager,Wt=Gt.a,$t=Wt?[[Wt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Wt.Rotate,{enable:!1}],[Wt.Pinch,{enable:!1}],[Wt.Swipe,{enable:!1}],[Wt.Pan,{threshold:0,enable:!1}],[Wt.Press,{enable:!1}],[Wt.Tap,{event:"doubletap",taps:2,enable:!1}],[Wt.Tap,{event:"anytap",enable:!1}],[Wt.Tap,{enable:!1}]]:null,qt={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Xt={doubletap:["tap"]},Kt={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Zt={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Yt={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Jt="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Qt="undefined"!=typeof window?window:commonjsGlobal,te=!1;try{var ee={get passive(){return te=!0,!0}};Qt.addEventListener("test",ee,ee),Qt.removeEventListener("test",ee,ee)}catch(t){}var re=-1!==Jt.indexOf("firefox"),ne=["wheel","mousewheel","DOMMouseScroll"],ie=function(){function t(e,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Nt.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},i),this.events=ne.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,n.handleEvent,!!te&&{passive:!1})}))}return Object(Ut.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"wheel"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){if(this.options.enable){var e=t.deltaY;Qt.WheelEvent&&(re&&t.deltaMode===Qt.WheelEvent.DOM_DELTA_PIXEL&&(e/=Qt.devicePixelRatio),t.deltaMode===Qt.WheelEvent.DOM_DELTA_LINE&&(e*=40));var r={x:t.clientX,y:t.clientY};0!==e&&e%4.000244140625==0&&(e=Math.floor(e/4.000244140625)),t.shiftKey&&e&&(e*=.25),this._onWheel(t,-e,r)}}},{key:"_onWheel",value:function(t,e,r){this.callback({type:"wheel",center:r,delta:e,srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}(),ae=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],oe=function(){function t(e,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Nt.a)(this,t),this.element=e,this.callback=r,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=ae.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach((function(t){return e.addEventListener(t,n.handleEvent)}))}return Object(Ut.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"pointermove"===t&&(this.enableMoveEvent=e),"pointerover"===t&&(this.enableOverEvent=e),"pointerout"===t&&(this.enableOutEvent=e),"pointerleave"===t&&(this.enableLeaveEvent=e)}},{key:"handleEvent",value:function(t){this.handleOverEvent(t),this.handleOutEvent(t),this.handleLeaveEvent(t),this.handleMoveEvent(t)}},{key:"handleOverEvent",value:function(t){this.enableOverEvent&&"mouseover"===t.type&&this.callback({type:"pointerover",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleOutEvent",value:function(t){this.enableOutEvent&&"mouseout"===t.type&&this.callback({type:"pointerout",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleLeaveEvent",value:function(t){this.enableLeaveEvent&&"mouseleave"===t.type&&this.callback({type:"pointerleave",srcEvent:t,pointerType:"mouse",target:t.target})}},{key:"handleMoveEvent",value:function(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":0===t.which&&(this.pressed=!1),this.pressed||this.callback({type:"pointermove",srcEvent:t,pointerType:"mouse",target:t.target});break;case"mouseup":this.pressed=!1}}}]),t}(),se=["keydown","keyup"],ue=function(){function t(e,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Nt.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=se.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=i.tabIndex||0,e.style.outline="none",this.events.forEach((function(t){return e.addEventListener(t,n.handleEvent)}))}return Object(Ut.a)(t,[{key:"destroy",value:function(){var t=this;this.events.forEach((function(e){return t.element.removeEventListener(e,t.handleEvent)}))}},{key:"enableEventType",value:function(t,e){"keydown"===t&&(this.enableDownEvent=e),"keyup"===t&&(this.enableUpEvent=e)}},{key:"handleEvent",value:function(t){var e=t.target||t.srcElement;"INPUT"===e.tagName&&"text"===e.type||"TEXTAREA"===e.tagName||(this.enableDownEvent&&"keydown"===t.type&&this.callback({type:"keydown",srcEvent:t,key:t.key,target:t.target}),this.enableUpEvent&&"keyup"===t.type&&this.callback({type:"keyup",srcEvent:t,key:t.key,target:t.target}))}}]),t}(),le=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(Nt.a)(this,t),this.element=e,this.callback=r,this.options=Object.assign({enable:!0},n),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}return Object(Ut.a)(t,[{key:"destroy",value:function(){this.element.removeEventListener("contextmenu",this.handleEvent)}},{key:"enableEventType",value:function(t,e){"contextmenu"===t&&(this.options.enable=e)}},{key:"handleEvent",value:function(t){this.options.enable&&this.callback({type:"contextmenu",center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}]),t}();function ce(t){return(ce="function"==typeof Symbol&&"symbol"===gt()(Symbol.iterator)?function(t){return gt()(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":gt()(t)})(t)}var he={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},fe={srcElement:"root",priority:0},de=function(){function t(e){Object(Nt.a)(this,t),this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}return Object(Ut.a)(t,[{key:"isEmpty",value:function(){return!this._active}},{key:"add",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=this.handlers,o=this.handlersByElement;r&&("object"!==ce(r)||r.addEventListener)&&(r={srcElement:r}),r=r?Object.assign({},fe,r):fe;var s=o.get(r.srcElement);s||o.set(r.srcElement,s=[]);var u={type:t,handler:e,srcElement:r.srcElement,priority:r.priority};n&&(u.once=!0),i&&(u.passive=!0),a.push(u),this._active=this._active||!u.passive;for(var l=s.length-1;l>=0&&!(s[l].priority>=u.priority);)l--;s.splice(l+1,0,u)}},{key:"remove",value:function(t,e){for(var r=this.handlers,n=this.handlersByElement,i=r.length-1;i>=0;i--){var a=r[i];if(a.type===t&&a.handler===e){r.splice(i,1);var o=n.get(a.srcElement);o.splice(o.indexOf(a),1),0===o.length&&n.delete(a.srcElement)}}this._active=r.some((function(t){return!t.passive}))}},{key:"handleEvent",value:function(t){if(!this.isEmpty()){for(var e=this._normalizeEvent(t),r=t.srcEvent.target;r&&r!==e.rootElement;){if(this._emit(e,r),e.handled)return;r=r.parentNode}this._emit(e,"root")}}},{key:"_emit",value:function(t,e){var r=this.handlersByElement.get(e);if(r){for(var n=!1,i=function(){t.handled=!0},a=function(){t.handled=!0,n=!0},o=[],s=0;s<r.length;s++){var u=r[s],l=u.once;if((0,u.handler)(Object.assign({},t,{type:u.type,stopPropagation:i,stopImmediatePropagation:a})),l&&o.push(r[s]),n)break}for(var c=0;c<o.length;c++){var h=o[c];this.remove(h.type,h.handler)}}}},{key:"_normalizeEvent",value:function(t){var e=this.eventManager.element;return Object.assign({},t,function(t){var e=he[t.srcEvent.type];if(!e)return null;var r=t.srcEvent,n=r.buttons,i=r.button,a=r.which,o=!1,s=!1,u=!1;return 4===e||2===e&&!Number.isFinite(n)?(o=1===a,s=2===a,u=3===a):2===e?(o=Boolean(1&n),s=Boolean(4&n),u=Boolean(2&n)):1===e&&(o=0===i,s=1===i,u=2===i),{leftButton:o,middleButton:s,rightButton:u}}(t),function(t,e){var r=t.srcEvent;if(!t.center&&!Number.isFinite(r.clientX))return null;var n=t.center||{x:r.clientX,y:r.clientY},i=e.getBoundingClientRect();return{center:n,offsetCenter:{x:(n.x-i.left-e.clientLeft)/(i.width/e.offsetWidth),y:(n.y-i.top-e.clientTop)/(i.height/e.offsetHeight)}}}(t,e),{handled:!1,rootElement:e})}}]),t}();function pe(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return me(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?me(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var ve={events:null,recognizers:null,recognizerOptions:{},Manager:Ht,touchAction:"none",tabIndex:0},ge=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(Nt.a)(this,t),this.options=Object.assign({},ve,r),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);var n=r.events;n&&this.on(n)}return Object(Ut.a)(t,[{key:"setElement",value:function(t){var e=this;if(this.element&&this.destroy(),this.element=t,t){var r=this.options,n=r.Manager;for(var i in this.manager=new n(t,{touchAction:r.touchAction,recognizers:r.recognizers||$t}).on("hammer.input",this._onBasicInput),r.recognizers||Object.keys(qt).forEach((function(t){var r=e.manager.get(t);r&&qt[t].forEach((function(t){r.recognizeWith(t)}))})),r.recognizerOptions){var a=this.manager.get(i);if(a){var o=r.recognizerOptions[i];delete o.enable,a.set(o)}}this.wheelInput=new ie(t,this._onOtherEvent,{enable:!1}),this.moveInput=new oe(t,this._onOtherEvent,{enable:!1}),this.keyInput=new ue(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new le(t,this._onOtherEvent,{enable:!1});var s,u=pe(this.events);try{for(u.s();!(s=u.n()).done;){var l=Bt(s.value,2),c=l[0],h=l[1];h.isEmpty()||(this._toggleRecognizer(h.recognizerName,!0),this.manager.on(c,h.handleEvent))}}catch(t){u.e(t)}finally{u.f()}}}},{key:"destroy",value:function(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}},{key:"on",value:function(t,e,r){this._addEventHandler(t,e,r,!1)}},{key:"once",value:function(t,e,r){this._addEventHandler(t,e,r,!0)}},{key:"watch",value:function(t,e,r){this._addEventHandler(t,e,r,!1,!0)}},{key:"off",value:function(t,e){this._removeEventHandler(t,e)}},{key:"_toggleRecognizer",value:function(t,e){var r=this.manager;if(r){var n=r.get(t);if(n&&n.options.enable!==e){n.set({enable:e});var i=Xt[t];i&&!this.options.recognizers&&i.forEach((function(i){var a=r.get(i);e?(a.requireFailure(t),n.dropRequireFailure(i)):a.dropRequireFailure(t)}))}this.wheelInput.enableEventType(t,e),this.moveInput.enableEventType(t,e),this.keyInput.enableEventType(t,e),this.contextmenuInput.enableEventType(t,e)}}},{key:"_addEventHandler",value:function(t,e,r,n,i){if("string"==typeof t){var a=this.manager,o=this.events,s=Yt[t]||t,u=o.get(s);u||(u=new de(this),o.set(s,u),u.recognizerName=Zt[s]||s,a&&a.on(s,u.handleEvent)),u.add(t,e,r,n,i),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}else for(var l in r=e,t)this._addEventHandler(l,t[l],r,n,i)}},{key:"_removeEventHandler",value:function(t,e){if("string"==typeof t){var r=this.events,n=r.get(Yt[t]||t);if(n&&(n.remove(t,e),n.isEmpty())){var i,a=n.recognizerName,o=!1,s=pe(r.values());try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.recognizerName===a&&!u.isEmpty()){o=!0;break}}}catch(t){s.e(t)}finally{s.f()}o||this._toggleRecognizer(a,!1)}}else for(var l in t)this._removeEventHandler(l,t[l])}},{key:"_onBasicInput",value:function(t){var e=Kt[t.srcEvent.type];e&&this.manager.emit(e,t)}},{key:"_onOtherEvent",value:function(t){this.manager.emit(t.type,t)}}]),t}(),ye=r(40);function _e(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return be(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function xe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function we(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xe(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Me(){}r.d(e,"a",(function(){return Ee}));var Ae={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:Me,onResize:Me,onViewStateChange:Me,onInteractionStateChange:Me,onBeforeRender:Me,onAfterRender:Me,onLoad:Me,onError:function(t,e){return h.a.error(t)()},_onMetrics:null,getCursor:function(t){return t.isDragging?"grabbing":"grab"},debug:!1,drawPickingColors:!1},Ee=function(){function t(e){o()(this,t),e=we(we({},Ae),e),this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&h.a.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),"IE"===function(t){if(!Object(dt.a)())return"Node";if(Object(pt.a)(void 0))return"Electron";var e=("undefined"!=typeof navigator?navigator:{}).userAgent||"";if(e.indexOf("Edge")>-1)return"Edge";var r=-1!==e.indexOf("MSIE "),n=-1!==e.indexOf("Trident/");return r||n?"IE":mt.chrome?"Chrome":mt.safari?"Safari":mt.mozInnerScreenX?"Firefox":"Unknown"}()&&h.a.warn("IE 11 support will be deprecated in v8.0")(),e.gl||"undefined"!=typeof document&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Dt.a({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&ht.a.setProps(e._typedArrayManagerProps),this.animationLoop.start()}return u()(t,[{key:"finalize",value:function(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),this.props.canvas||this.props.gl||!this.canvas||(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}},{key:"setProps",value:function(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&h.a.removed("onLayerHover","onHover")(),"onLayerClick"in t&&h.a.removed("onLayerClick","onClick")(),t.initialViewState&&!Object(c.a)(this.props.initialViewState,t.initialViewState)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);var e=Object.create(this.props);Object.assign(e,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState(),effects:this.props.lights?[this.props.lights]:[]}),this.animationLoop.setProps(e),this.layerManager&&(this.viewManager.setProps(e),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(e),this.effectManager.setProps(e),this.deckRenderer.setProps(e),this.deckPicker.setProps(e)),this.stats.get("setProps Time").timeEnd()}},{key:"needsRedraw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";var e=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);var r=this.viewManager.needsRedraw(t),n=this.layerManager.needsRedraw(t),i=this.effectManager.needsRedraw(t),a=this.deckRenderer.needsRedraw(t);return e||r||n||i||a}},{key:"redraw",value:function(t){if(this.layerManager){var e=t||this.needsRedraw({clearRedrawFlags:!0});e&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(e):this._drawLayers(e))}}},{key:"getViews",value:function(){return this.viewManager.views}},{key:"getViewports",value:function(t){return this.viewManager.getViewports(t)}},{key:"pickObject",value:function(t){var e=this._pick("pickObject","pickObject Time",t).result;return e.length?e[0]:null}},{key:"pickMultipleObjects",value:function(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}},{key:"pickObjects",value:function(t){return this._pick("pickObjects","pickObjects Time",t)}},{key:"_addResources",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var r in t)this.layerManager.resourceManager.add({resourceId:r,data:t[r],forceUpdate:e})}},{key:"_removeResources",value:function(t){var e,r=_e(t);try{for(r.s();!(e=r.n()).done;)this.layerManager.resourceManager.remove(e.value)}catch(t){r.e(t)}finally{r.f()}}},{key:"_pick",value:function(t,e,r){var n=this.stats;n.get("Pick Count").incrementCount(),n.get(e).timeStart();var i=this.deckPicker[t](we({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects()},r));return n.get(e).timeEnd(),i}},{key:"_createCanvas",value:function(t){var e=t.canvas;return"string"==typeof e&&(e=document.getElementById(e),Object(ye.a)(e)),e||((e=document.createElement("canvas")).id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(e)),Object.assign(e.style,t.style),e}},{key:"_setCanvasSize",value:function(t){if(this.canvas){var e=t.width,r=t.height;(e||0===e)&&(e=Number.isFinite(e)?"".concat(e,"px"):e,this.canvas.style.width=e),(r||0===r)&&(r=Number.isFinite(r)?"".concat(r,"px"):r,this.canvas.style.position="absolute",this.canvas.style.height=r)}}},{key:"_updateCanvasSize",value:function(){this._checkForCanvasSizeChange()&&(this.viewManager.setProps({width:this.width,height:this.height}),this.props.onResize({width:this.width,height:this.height}))}},{key:"_checkForCanvasSizeChange",value:function(){var t=this.canvas;if(!t)return!1;var e=t.clientWidth||t.width,r=t.clientHeight||t.height;return(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,!0)}},{key:"_createAnimationLoop",value:function(t){var e=this,r=t.glOptions,n=t.debug,i=t.onError,a=t.onBeforeRender,o=t.onAfterRender;return new kt({width:t.width,height:t.height,useDevicePixels:t.useDevicePixels,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,autoResizeViewport:!1,gl:t.gl,onCreateContext:function(t){return Object(L.c)(we(we(we({},r),t),{},{canvas:e.canvas,debug:n,onContextLost:function(){return e._onContextLost()}}))},onInitialize:function(t){return e._setGLContext(t.gl)},onRender:this._onRenderFrame.bind(this),onBeforeRender:a,onAfterRender:o,onError:i})}},{key:"_getViewState",value:function(){return this.props.viewState||this.viewState}},{key:"_getViews",value:function(){var t=this.props.views||[new v.a({id:"default-view"})];return(t=Array.isArray(t)?t:[t]).length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}},{key:"_onContextLost",value:function(){var t=this.props.onError;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}},{key:"_onPointerMove",value:function(t){var e=this._pickRequest;if("pointerleave"===t.type)e.x=-1,e.y=-1,e.radius=0;else{if(t.leftButton||t.rightButton)return;var r=t.offsetCenter;if(!r)return;e.x=r.x,e.y=r.y,e.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:e.x,y:e.y}),e.event=t,e.mode="hover"}},{key:"_pickAndCallback",value:function(){var t=this._pickRequest;if(t.event){var e=this._pick("pickObject","pickObject Time",t),r=e.result,n=e.emptyInfo;this.interactiveState.isHovering=r.length>0;var i,a=n,o=!1,s=_e(r);try{for(s.s();!(i=s.n()).done;){var u=i.value;a=u,o=u.layer.onHover(u,t.event)}}catch(t){s.e(t)}finally{s.f()}if(!o&&this.props.onHover&&this.props.onHover(a,t.event),this.props.getTooltip){var l=this.props.getTooltip(a);this.tooltip.setTooltip(l,a.x,a.y)}t.event=null}}},{key:"_updateCursor",value:function(){var t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.interactiveState))}},{key:"_setGLContext",value:function(t){if(!this.layerManager){this.canvas||(this.canvas=t.canvas,Object(L.h)(t,{enable:!0,copyState:!0})),this.tooltip=new ct(this.canvas),Object(L.n)(t,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(t);var e=new Rt.a;for(var r in e.play(),this.animationLoop.attachTimeline(e),this.eventManager=new ge(this.props.parent||t.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),I.b)this.eventManager.on(r,this._onEvent);this.viewManager=new m({timeline:e,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});var n=this.viewManager.getViewports()[0];this.layerManager=new l.a(t,{deck:this,stats:this.stats,viewport:n,timeline:e}),this.effectManager=new $,this.deckRenderer=new q.a(t),this.deckPicker=new ut(t),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}}},{key:"_drawLayers",value:function(t,e){var r=this.layerManager.context.gl;Object(L.n)(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers(we({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:t,effects:this.effectManager.getEffects()},e)),this.props.onAfterRender({gl:r})}},{key:"_onRenderFrame",value:function(t){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),h.a.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}},{key:"_onViewStateChange",value:function(t){var e=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState=we(we({},this.viewState),{},i()({},t.viewId,e)),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}},{key:"_onInteractionStateChange",value:function(t){this.interactiveState.isDragging=t.isDragging,this.props.onInteractionStateChange(t)}},{key:"_onEvent",value:function(t){var e=I.b[t.type],r=t.offsetCenter;if(e&&r){var n=this.layerManager.getLayers(),i=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:n,viewports:this.getViewports(r)},this._lastPointerDownInfo),a=i.layer,o=a&&(a[e.handler]||a.props[e.handler]),s=this.props[e.handler],u=!1;o&&(u=o.call(a,i,t)),!u&&s&&s(i,t)}}},{key:"_onPointerDown",value:function(t){var e=t.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:e.x,y:e.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}},{key:"_getFrameStats",value:function(){var t=this.stats;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();var e=this.animationLoop.stats;t.get("GPU Time").addTime(e.get("GPU Time").lastTiming),t.get("CPU Time").addTime(e.get("CPU Time").lastTiming)}},{key:"_getMetrics",value:function(){var t=this.metrics,e=this.stats;t.fps=e.get("frameRate").getHz(),t.setPropsTime=e.get("setProps Time").time,t.updateAttributesTime=e.get("Update Attributes").time,t.framesRedrawn=e.get("Redraw Count").count,t.pickTime=e.get("pickObject Time").time+e.get("pickMultipleObjects Time").time+e.get("pickObjects Time").time,t.pickCount=e.get("Pick Count").count,t.gpuTime=e.get("GPU Time").time,t.cpuTime=e.get("CPU Time").time,t.gpuTimePerFrame=e.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=e.get("CPU Time").getAverageTime();var r=wt.a.get("Memory Usage");t.bufferMemory=r.get("Buffer Memory").count,t.textureMemory=r.get("Texture Memory").count,t.renderbufferMemory=r.get("Renderbuffer Memory").count,t.gpuMemory=r.get("GPU Memory").count}}]),t}();Ee.getPropTypes=function(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(B.a)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,eventRecognizerOptions:t.object,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onInteractionStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}},Ee.defaultProps=Ae,Ee.VERSION=ft.a.VERSION},function(t,e,r){var n=r(0),i=r.n(n),a={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1},o={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,e={};if(void 0!==t.pickingSelectedColor)if(t.pickingSelectedColor){var r=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=r}else e.picking_uSelectedColorValid=0;if(t.pickingHighlightColor){var n=Array.from(t.pickingHighlightColor,(function(t){return t/255}));Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return void 0!==t.pickingActive&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}};function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}e.a=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}},o)},function(t,e,r){var n=r(43),i=r.n(n),a=r(44),o=r.n(a),s=r(49),u=r.n(s),l=r(50),c=r.n(l),h=r(34),f=r.n(h),d=r(109),p=r(25),m=r(47),v=r(13),g=r(64),y=r(24),_=r(29);function b(){var t=new v.a(4);return v.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function x(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function w(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],c=r[3];return t[0]=n*c+o*s+i*l-a*u,t[1]=i*c+o*u+a*s-n*l,t[2]=a*c+o*l+n*u-i*s,t[3]=o*c-n*s-i*u-a*l,t}function M(t,e,r,n){var i,a,o,s,u,l=e[0],c=e[1],h=e[2],f=e[3],d=r[0],p=r[1],m=r[2],g=r[3];return(a=l*d+c*p+h*m+f*g)<0&&(a=-a,d=-d,p=-p,m=-m,g=-g),1-a>v.b?(i=Math.acos(a),o=Math.sin(i),s=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o):(s=1-n,u=n),t[0]=s*l+u*d,t[1]=s*c+u*p,t[2]=s*h+u*m,t[3]=s*f+u*g,t}var A,E,S,T=_.a,C=_.k,O=_.d,P=_.i,L=_.h,I=_.m,k=_.j,R=(A=y.c(),E=y.f(1,0,0),S=y.f(0,1,0),function(t,e,r){var n=y.e(e,r);return n<-.999999?(y.d(A,E,e),y.g(A)<1e-6&&y.d(A,S,e),y.l(A,A),x(t,A,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(y.d(A,e,r),t[0]=A[0],t[1]=A[1],t[2]=A[2],t[3]=1+n,k(t,t))});b(),b(),g.a(),r.d(e,"a",(function(){return B}));var D=[0,0,0,1],B=function(t){u()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f()(t);if(e){var i=f()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return c()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return i()(this,r),t=e.call(this,-0,-0,-0,-0),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,a,o,s),t}return o()(r,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"fromMatrix3",value:function(t){return function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,t[3]=(e[3*a+o]-e[3*o+a])*(r=.5/r),t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}}(this,t),this.check()}},{key:"identity",value:function(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.check()}},{key:"fromAxisRotation",value:function(t,e){return x(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=Object(p.a)(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=Object(p.a)(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=Object(p.a)(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=Object(p.a)(t)}},{key:"len",value:function(){return L(this)}},{key:"lengthSquared",value:function(){return I(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return O(this,t)}},{key:"rotationTo",value:function(t,e){return R(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return T(this,this,t),this.check()}},{key:"calculateW",value:function(){var t,e,r,n;return r=this[1],n=this[2],(t=this)[0]=e=this[0],t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-e*e-r*r-n*n)),this.check()}},{key:"conjugate",value:function(){var t,e;return(t=this)[0]=-(e=this)[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],this.check()}},{key:"invert",value:function(){var t,e,r,n,i,a,o,s;return s=(o=(r=(e=this)[0])*r+(n=e[1])*n+(i=e[2])*i+(a=e[3])*a)?1/o:0,(t=this)[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,this.check()}},{key:"lerp",value:function(t,e,r){return P(this,t,e,r),this.check()}},{key:"multiplyRight",value:function(t,e){return Object(m.a)(!e),w(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return Object(m.a)(!e),w(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return C(this,this,t),this.check()}},{key:"slerp",value:function(t,e,r){switch(arguments.length){case 1:var n=arguments[0],i=n.start;t=void 0===i?D:i,e=n.target,r=n.ratio;break;case 2:var a=Array.prototype.slice.call(arguments);e=a[0],r=a[1],t=this}return M(this,t,e,r),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return _.o(e,t,this),Object(p.b)(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}}]),r}(d.a)},function(t,e,r){var n=r(127),i="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";r.d(e,"a",(function(){return u})),r.d(e,"b",(function(){return l}));var a={};function o(t){var e=t.ambient,r=t.diffuse,n=t.shininess,i=t.specularColor;return{lighting_uAmbient:void 0===e?.35:e,lighting_uDiffuse:void 0===r?.6:r,lighting_uShininess:void 0===n?32:n,lighting_uSpecularColor:(void 0===i?[30,30,30]:i).map((function(t){return t/255}))}}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if(!("material"in t))return{};var e=t.material;return e?o(e):{lighting_uEnabled:!1}}var u={name:"gouraud-lighting",dependencies:[n.a],vs:i,defines:{LIGHTING_VERTEX:1},getUniforms:s},l={name:"phong-lighting",dependencies:[n.a],fs:i,defines:{LIGHTING_FRAGMENT:1},getUniforms:s}},function(t,e,r){var n=r(188);function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function a(e,r,o){return t.exports=a=i()?Reflect.construct:function(t,e,r){var i=[null];i.push.apply(i,e);var a=new(Function.bind.apply(t,i));return r&&n(a,r.prototype),a},a.apply(null,arguments)}t.exports=a},function(t,e,r){r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return h}));var n=r(0),i=r.n(n),a=r(115),o=r(212),s=r(213),u=r(79),l=r(10);function c(t,e){return Object(l.a)(t instanceof a.a||t instanceof o.a||t instanceof s.a),new(0,t.constructor)(t.gl,Object.assign({width:t.width,height:t.height,format:t.format,type:t.type,dataFormat:t.dataFormat,border:t.border,mipmaps:t.mipmaps},e))}function h(t,e){var r=t.width,n=t.height;return new u.a(t.gl,Object.assign({},e,{id:"framebuffer-for-".concat(t.id),width:r,height:n,attachments:i()({},36064,t)}))}},function(t,e,r){r.d(e,"a",(function(){return w}));var n=r(7),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(17),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(2),y=r.n(g),_=r(8),b=r(63),x=[34069,34070,34071,34072,34073,34074],w=function(t){f()(n,t);var e,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}(n);function n(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(this,n),Object(_.b)(t),(e=r.call(this,t,Object.assign({},i,{target:34067}))).initialize(i),Object.seal(c()(e)),e}return u()(n,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.mipmaps,n=void 0===r||r,i=e.parameters,a=void 0===i?{}:i;return this.opts=e,this.setCubeMapImageData(e).then((function(){t.loaded=!0,n&&t.generateMipmap(e),t.setParameters(a)})),this}},{key:"subImage",value:function(t){var e=t.x,r=t.y,n=t.mipmapLevel;return this._subImage({target:t.face,data:t.data,x:void 0===e?0:e,y:void 0===r?0:r,mipmapLevel:void 0===n?0:n})}},{key:"setCubeMapImageData",value:(e=i()(y.a.mark((function t(e){var r,n,i,a,o,s,u,l,c,h,f,d,p=this;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.width,n=e.height,i=e.data,o=void 0===(a=e.border)?0:a,u=void 0===(s=e.format)?6408:s,c=void 0===(l=e.type)?5121:l,h=this.gl,f=e.pixels||i,t.next=5,Promise.all(x.map((function(t){var e=f[t];return Promise.all(Array.isArray(e)?e:[e])})));case 5:d=t.sent,this.bind(),x.forEach((function(t,e){d[e].length>1&&!1!==p.opts.mipmaps&&_.k.warn("".concat(p.id," has mipmap and multiple LODs."))(),d[e].forEach((function(e,i){r&&n?h.texImage2D(t,i,u,r,n,o,u,c,e):h.texImage2D(t,i,u,u,c,e)}))})),this.unbind();case 9:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"setImageDataForFace",value:function(t){var e=this,r=t.face,n=t.width,i=t.height,a=t.border,o=void 0===a?0:a,s=t.format,u=void 0===s?6408:s,l=t.type,c=void 0===l?5121:l,h=this.gl,f=t.pixels||t.data;return this.bind(),f instanceof Promise?f.then((function(n){return e.setImageDataForFace(Object.assign({},t,{face:r,data:n,pixels:n}))})):this.width||this.height?h.texImage2D(r,0,u,n,i,o,u,c,f):h.texImage2D(r,0,u,u,c,f),this}}]),n}(b.a);w.FACES=x},function(t,e,r){r.d(e,"a",(function(){return _}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(17),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(8),v=r(63),g=r(89),y=r(38),_=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,r),Object(m.a)(t),a=Object.assign({depth:1},a,{target:32879,unpackFlipY:!1}),(n=e.call(this,t,a)).initialize(a),Object.seal(u()(n)),n}return o()(r,[{key:"setImageData",value:function(t){var e=this,r=t.level,n=void 0===r?0:r,i=t.dataFormat,a=void 0===i?6408:i,o=t.width,s=t.height,u=t.depth,l=void 0===u?1:u,c=t.border,h=void 0===c?0:c,f=t.format,d=t.type,p=void 0===d?5121:d,v=t.offset,_=void 0===v?0:v,b=t.data,x=t.parameters,w=void 0===x?{}:x;return this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Object(m.o)(this.gl,w,(function(){ArrayBuffer.isView(b)&&e.gl.texImage3D(e.target,n,a,o,s,l,h,f,p,b),b instanceof y.a&&(e.gl.bindBuffer(35052,b.handle),e.gl.texImage3D(e.target,n,a,o,s,l,h,f,p,_))})),this._trackAllocatedMemory(b&&b.byteLength?b.byteLength:this.width*this.height*this.depth*(g.a[this.dataFormat]||4)*(g.c[this.type]||1),"Texture"),this.loaded=!0,this}}],[{key:"isSupported",value:function(t){return Object(m.j)(t)}}]),r}(v.a)},function(t,e,r){var n=r(189),i=r(244);function a(e,r,o){return i()?(t.exports=a=Reflect.construct,t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=a=function(t,e,r){var i=[null];i.push.apply(i,e);var a=new(Function.bind.apply(t,i));return r&&n(a,r.prototype),a},t.exports.default=t.exports,t.exports.__esModule=!0),a.apply(null,arguments)}t.exports=a,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(245),i=r(246),a=r(191),o=r(247);t.exports=function(t){return n(t)||i(t)||a(t)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(258);t.exports=function(t,e){if(null==t)return{};var r,i,a=n(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)e.indexOf(r=o[i])>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}},function(t,e){t.exports=function(t,e){var r={},n=!1;function i(r,i){return n=!0,i=new Promise((function(e){e(t[r](i))})),{done:!1,value:e(i)}}return"function"==typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){return this}),r.next=function(t){return n?(n=!1,t):i("next",t)},"function"==typeof t.throw&&(r.throw=function(t){if(n)throw n=!1,t;return i("throw",t)}),"function"==typeof t.return&&(r.return=function(t){return n?(n=!1,t):i("return",t)}),r}},function(t,e,r){var n=r(262),i=r(263),a=r(264),o=r(266);t.exports=function(t,e){return n(t)||i(t,e)||a(t,e)||o()},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(231),i=r(273);Object.assign(n,i),t.exports=n},,,,,,,,function(t,e,r){var n=r(274),i=r(62),a=r(275).default,o=r(76),s=o.registerLoaders,u=o.load,l=o.parse,c=o.fetchFile,h="undefined"==typeof window?commonjsGlobal:window;h.deck=h.deck||{},h.luma=h.luma||{},h.loaders=h.loaders||{},Object.assign(h.deck,i,{DeckGL:a}),Object.assign(h.luma,n),Object.assign(h.loaders,{registerLoaders:s,load:u,parse:l,fetchFile:c}),t.exports=h.deck},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e){},function(t,e,r){var n=r(118),i=r(11);Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"self",{enumerable:!0,get:function(){return a.self}}),Object.defineProperty(e,"window",{enumerable:!0,get:function(){return a.window}}),Object.defineProperty(e,"global",{enumerable:!0,get:function(){return a.global}}),Object.defineProperty(e,"document",{enumerable:!0,get:function(){return a.document}}),Object.defineProperty(e,"process",{enumerable:!0,get:function(){return a.process}}),Object.defineProperty(e,"console",{enumerable:!0,get:function(){return a.console}}),Object.defineProperty(e,"isBrowser",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"isBrowserMainThread",{enumerable:!0,get:function(){return o.isBrowserMainThread}}),Object.defineProperty(e,"getBrowser",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"isMobile",{enumerable:!0,get:function(){return s.isMobile}}),Object.defineProperty(e,"isElectron",{enumerable:!0,get:function(){return u.default}});var a=r(186),o=c(r(187)),s=c(r(237)),u=n(r(173));function l(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(l=function(t){return t?r:e})(t)}function c(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!==i(t)&&"function"!=typeof t)return{default:t};var r=l(e);if(r&&r.has(t))return r.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var s=a?Object.getOwnPropertyDescriptor(t,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=t[o]}return n.default=t,r&&r.set(t,n),n}},function(t,e,r){var n=r(118);Object.defineProperty(e,"__esModule",{value:!0}),e.isMobile=function(){return void 0!==i.window.orientation},e.default=function(t){if(!t&&!(0,a.default)())return"Node";if((0,o.default)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},r=t||e.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),s=-1!==r.indexOf("Trident/");return n||s?"IE":i.window.chrome?"Chrome":i.window.safari?"Safari":i.window.mozInnerScreenX?"Firefox":"Unknown"};var i=r(186),a=n(r(187)),o=n(r(173))},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e,r){var n=r(5);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t}},function(t,e,r){var n=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var i=Object.create((e&&e.prototype instanceof c?e:c).prototype),a=new w(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=_(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=u(t,e,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}(t,r,a),i}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var l={};function c(){}function h(){}function f(){}var d={};d[i]=function(){return this};var p=Object.getPrototypeOf,m=p&&p(p(M([])));m&&m!==e&&r.call(m,i)&&(d=m);var v=f.prototype=c.prototype=Object.create(d);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function y(t){var e;this._invoke=function(n,i){function a(){return new Promise((function(e,a){!function e(n,i,a,o){var s=u(t[n],t,i);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(t){e("next",t,a,o)}),(function(t){e("throw",t,a,o)})):Promise.resolve(c).then((function(t){l.value=t,a(l)}),(function(t){return e("throw",t,a,o)}))}o(s.arg)}(n,i,e,a)}))}return e=e?e.then(a,a):a()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function M(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=v.constructor=f,f.constructor=h,f[o]=h.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o in t||(t[o]="GeneratorFunction")),t.prototype=Object.create(v),t},t.awrap=function(t){return{__await:t}},g(y.prototype),y.prototype[a]=function(){return this},t.AsyncIterator=y,t.async=function(e,r,n,i){var a=new y(s(e,r,n,i));return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(v),v[o]="Generator",v[i]=function(){return this},v.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=M,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),x(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;x(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:M(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(190);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){},function(t,e,r){var n=r(192);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){if(null==t)return{};var r,n,i={},a=Object.keys(t);for(n=0;n<a.length;n++)e.indexOf(r=a[n])>=0||(i[r]=t[r]);return i}},function(t,e,r){var n=r(196);function i(t){var e,r;function i(e,r){try{var o=t[e](r),s=o.value,u=s instanceof n;Promise.resolve(u?s.wrapped:s).then((function(t){u?i("return"===e?"return":"next",t):a(o.done?"return":"normal",t)}),(function(t){i("throw",t)}))}catch(t){a("throw",t)}}function a(t,n){switch(t){case"return":e.resolve({value:n,done:!0});break;case"throw":e.reject(n);break;default:e.resolve({value:n,done:!1})}(e=e.next)?i(e.key,e.arg):r=null}this._invoke=function(t,n){return new Promise((function(a,o){var s={key:t,arg:n,resolve:a,reject:o,next:null};r?r=r.next=s:(e=r=s,i(t,n))}))},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)},t.exports=i},function(t,e,r){var n=r(261);function i(){}function a(){}a.resetWarningCache=i,t.exports=function(){function t(t,e,r,i,a,o){if(o!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function e(){return t}t.isRequired=t;var r={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:a,resetWarningCache:i};return r.PropTypes=r,r}},function(t,e,r){t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(265);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(205);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){var n=r(205);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e,r){
/** @license React v16.12.0
	 * react.production.min.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */
var n=r(272),i="function"==typeof Symbol&&Symbol.for,a=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,u=i?Symbol.for("react.strict_mode"):60108,l=i?Symbol.for("react.profiler"):60114,c=i?Symbol.for("react.provider"):60109,h=i?Symbol.for("react.context"):60110,f=i?Symbol.for("react.forward_ref"):60112,d=i?Symbol.for("react.suspense"):60113,p=i?Symbol.for("react.memo"):60115,m=i?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function g(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function b(t,e,r){this.props=t,this.context=e,this.refs=_,this.updater=r||y}function x(){}function w(t,e,r){this.props=t,this.context=e,this.refs=_,this.updater=r||y}b.prototype.isReactComponent={},b.prototype.setState=function(t,e){if("object"!=typeof t&&"function"!=typeof t&&null!=t)throw Error(g(85));this.updater.enqueueSetState(this,t,e,"setState")},b.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},x.prototype=b.prototype;var M=w.prototype=new x;M.constructor=w,n(M,b.prototype),M.isPureReactComponent=!0;var A={current:null},E={current:null},S=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function C(t,e,r){var n,i={},o=null,s=null;if(null!=e)for(n in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(o=""+e.key),e)S.call(e,n)&&!T.hasOwnProperty(n)&&(i[n]=e[n]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var l=Array(u),c=0;c<u;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(n in u=t.defaultProps)void 0===i[n]&&(i[n]=u[n]);return{$$typeof:a,type:t,key:o,ref:s,props:i,_owner:E.current}}function O(t){return"object"==typeof t&&null!==t&&t.$$typeof===a}var P=/\/+/g,L=[];function I(t,e,r,n){if(L.length){var i=L.pop();return i.result=t,i.keyPrefix=e,i.func=r,i.context=n,i.count=0,i}return{result:t,keyPrefix:e,func:r,context:n,count:0}}function k(t){t.result=null,t.keyPrefix=null,t.func=null,t.context=null,t.count=0,10>L.length&&L.push(t)}function R(t,e,r){return null==t?0:function t(e,r,n,i){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case a:case o:u=!0}}if(u)return n(i,e,""===r?"."+D(e,0):r),1;if(u=0,r=""===r?".":r+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=r+D(s=e[l],l);u+=t(s,c,n,i)}else if("function"==typeof(c=null===e||"object"!=typeof e?null:"function"==typeof(c=v&&e[v]||e["@@iterator"])?c:null))for(e=c.call(e),l=0;!(s=e.next()).done;)u+=t(s=s.value,c=r+D(s,l++),n,i);else if("object"===s)throw n=""+e,Error(g(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return u}(t,"",e,r)}function D(t,e){return"object"==typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,(function(t){return e[t]}))}(t.key):e.toString(36)}function B(t,e){t.func.call(t.context,e,t.count++)}function F(t,e,r){var n=t.result,i=t.keyPrefix;t=t.func.call(t.context,e,t.count++),Array.isArray(t)?j(t,n,r,(function(t){return t})):null!=t&&(O(t)&&(t=function(t,e){return{$$typeof:a,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(t,i+(!t.key||e&&e.key===t.key?"":(""+t.key).replace(P,"$&/")+"/")+r)),n.push(t))}function j(t,e,r,n,i){var a="";null!=r&&(a=(""+r).replace(P,"$&/")+"/"),R(t,F,e=I(e,a,n,i)),k(e)}function N(){var t=A.current;if(null===t)throw Error(g(321));return t}var U={Children:{map:function(t,e,r){if(null==t)return t;var n=[];return j(t,n,null,e,r),n},forEach:function(t,e,r){if(null==t)return t;R(t,B,e=I(null,null,e,r)),k(e)},count:function(t){return R(t,(function(){return null}),null)},toArray:function(t){var e=[];return j(t,e,null,(function(t){return t})),e},only:function(t){if(!O(t))throw Error(g(143));return t}},createRef:function(){return{current:null}},Component:b,PureComponent:w,createContext:function(t,e){return void 0===e&&(e=null),(t={$$typeof:h,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:c,_context:t},t.Consumer=t},forwardRef:function(t){return{$$typeof:f,render:t}},lazy:function(t){return{$$typeof:m,_ctor:t,_status:-1,_result:null}},memo:function(t,e){return{$$typeof:p,type:t,compare:void 0===e?null:e}},useCallback:function(t,e){return N().useCallback(t,e)},useContext:function(t,e){return N().useContext(t,e)},useEffect:function(t,e){return N().useEffect(t,e)},useImperativeHandle:function(t,e,r){return N().useImperativeHandle(t,e,r)},useDebugValue:function(){},useLayoutEffect:function(t,e){return N().useLayoutEffect(t,e)},useMemo:function(t,e){return N().useMemo(t,e)},useReducer:function(t,e,r){return N().useReducer(t,e,r)},useRef:function(t){return N().useRef(t)},useState:function(t){return N().useState(t)},Fragment:s,Profiler:l,StrictMode:u,Suspense:d,createElement:C,cloneElement:function(t,e,r){if(null==t)throw Error(g(267,t));var i=n({},t.props),o=t.key,s=t.ref,u=t._owner;if(null!=e){if(void 0!==e.ref&&(s=e.ref,u=E.current),void 0!==e.key&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)S.call(e,c)&&!T.hasOwnProperty(c)&&(i[c]=void 0===e[c]&&void 0!==l?l[c]:e[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];i.children=l}return{$$typeof:a,type:t.type,key:o,ref:s,props:i,_owner:u}},createFactory:function(t){var e=C.bind(null,t);return e.type=t,e},isValidElement:O,version:"16.12.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:A,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:E,IsSomeRendererActing:{current:!1},assign:n}},z={default:U},G=z&&U||z;t.exports=G.default||G},function(t,e,r){
/*
	object-assign
	(c) Sindre Sorhus
	@license MIT
	*/
var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var r,s,u=o(t),l=1;l<arguments.length;l++){for(var c in r=Object(arguments[l]))i.call(r,c)&&(u[c]=r[c]);if(n){s=n(r);for(var h=0;h<s.length;h++)a.call(r,s[h])&&(u[s[h]]=r[s[h]])}}return u}},function(t,e,r){r.r(e);var n={};r.r(n),r.d(n,"name",(function(){return cr})),r.d(n,"preprocess",(function(){return hr})),r.d(n,"decode",(function(){return fr}));var i={};r.r(i),r.d(i,"name",(function(){return _r})),r.d(i,"preprocess",(function(){return br}));var a={};r.r(a),r.d(a,"name",(function(){return wr})),r.d(a,"preprocess",(function(){return Mr}));var o={};r.r(o),r.d(o,"name",(function(){return En})),r.d(o,"preprocess",(function(){return Sn})),r.d(o,"decode",(function(){return Tn})),r.d(o,"encode",(function(){return On}));var s={};r.r(s),r.d(s,"name",(function(){return Fn})),r.d(s,"decode",(function(){return jn})),r.d(s,"encode",(function(){return Un}));var u={};r.r(u),r.d(u,"name",(function(){return Hn})),r.d(u,"decode",(function(){return Wn})),r.d(u,"encode",(function(){return qn}));var l={};r.r(l),r.d(l,"name",(function(){return Zn})),r.d(l,"decode",(function(){return Yn})),r.d(l,"encode",(function(){return Qn}));var c=r(0),h=r.n(c),f=r(7),d=r.n(f),p=r(1),m=r.n(p),v=r(3),g=r.n(v),y=r(6),_=r.n(y),b=r(9),x=r.n(b),w=r(5),M=r.n(w),A=r(2),E=r.n(A),S=r(68),T=r(16),C=r(197),O=r(18),P=r.n(O),L=r(198),I=r(209),k=r(207),R=r(145),D=r(162);function B(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function F(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?B(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var j=[0,0,0,255],N=[0,0,1],U={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(t){return t.position}},getNormal:{type:"accessor",value:N},getColor:{type:"accessor",value:j},material:!0,radiusPixels:{deprecatedFor:"pointSize"}},z=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){return m()(this,r),e.apply(this,arguments)}return g()(r,[{key:"getShaders",value:function(){return P()(M()(r.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\nuniform int sizeUnits;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.normal = project_normal(instanceNormals);\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);\n  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n  vColor = vec4(lightColor, instanceColors.a * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[L.a,I.a,k.a]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:N},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:j}})}},{key:"updateState",value:function(t){var e,n,i,a=t.props,o=t.oldProps,s=t.changeFlags;if(P()(M()(r.prototype),"updateState",this).call(this,{props:a,oldProps:o,changeFlags:s}),s.extensionsChanged){var u,l=this.context.gl;null===(u=this.state.model)||void 0===u||u.delete(),this.state.model=this._getModel(l),this.getAttributeManager().invalidateAll()}s.dataChanged&&(i=(e=a.data).attributes,(n=e.header)&&i&&(e.length=n.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0&&(i.instanceColors=i.COLOR_0)))}},{key:"draw",value:function(t){var e=this.props,r=e.pointSize,n=e.sizeUnits;this.state.model.setUniforms(t.uniforms).setUniforms({sizeUnits:T.e[n],radiusPixels:r}).draw()}},{key:"_getModel",value:function(t){for(var e=[],r=0;r<3;r++){var n=r/3*Math.PI*2;e.push(2*Math.cos(n),2*Math.sin(n),0)}return new D.a(t,F(F({},this.getShaders()),{},{id:this.props.id,geometry:new S.a({drawMode:4,attributes:{positions:new Float32Array(e)}}),isInstanced:!0}))}}]),r}(R.a);z.layerName="PointCloudLayer",z.defaultProps=U;var G=r(11),V=r.n(G),H=r(22),W=r(8),$={name:"pbr",vs:"uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n\nvarying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)\n# error PBR fragment shader: Texture LOD is not available\n#endif\n\n#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)\n# error PBR fragment shader: Derivatives are not available\n#endif\n\n\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\nuniform bool pbr_uUnlit;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n\nstruct PBRInfo\n{\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float LdotH;\n  float VdotH;\n  float perceptualRoughness;\n  float metalness;\n  vec3 reflectance0;\n  vec3 reflectance90;\n  float alphaRoughness;\n  vec3 diffuseColor;\n  vec3 specularColor;\n  vec3 n;\n  vec3 v;\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif\n  return vec4(linOut,srgbIn.w);;\n#else\n  return srgbIn;\n#endif\n}\n\nvec3 getNormal()\n{\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0;\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n\n\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n\n\n\n\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);\n  vec3 h = normalize(l+v);\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 color = vec3(0, 0, 0);\n\n  if(pbr_uUnlit){\n    color.rgb = baseColor.rgb;\n  }\n  else{\n\n\n    float perceptualRoughness = u_MetallicRoughnessValues.y;\n    float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n\n    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n    perceptualRoughness = mrSample.g * perceptualRoughness;\n    metallic = mrSample.b * metallic;\n#endif\n    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n    metallic = clamp(metallic, 0.0, 1.0);\n\n    float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n    vec3 f0 = vec3(0.04);\n    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n    diffuseColor *= 1.0 - metallic;\n    vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n\n\n    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n    vec3 specularEnvironmentR0 = specularColor.rgb;\n    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n    vec3 n = getNormal();\n    vec3 v = normalize(u_Camera - pbr_vPosition);\n\n    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n    vec3 reflection = -normalize(reflect(v, n));\n\n    PBRInfo pbrInputs = PBRInfo(\n      0.0,\n      NdotV,\n      0.0,\n      0.0,\n      0.0,\n      perceptualRoughness,\n      metallic,\n      specularEnvironmentR0,\n      specularEnvironmentR90,\n      alphaRoughness,\n      diffuseColor,\n      specularColor,\n      n,\n      v\n    );\n\n#ifdef USE_LIGHTS\n    PBRInfo_setAmbientLight(pbrInputs);\n    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n      if (i < lighting_uDirectionalLightCount) {\n        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n      }\n    }\n    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n      if (i < lighting_uPointLightCount) {\n        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n      }\n    }\n#endif\n#ifdef USE_IBL\n    color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n#ifdef HAS_OCCLUSIONMAP\n    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n    color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n    color += emissive;\n#endif\n\n#ifdef PBR_DEBUG\n\n\n\n\n\n    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  }\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[r(127).a]},q=r(73),X=r(90),K=r(60),Z=r(10),Y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m()(this,t),this.id=e.id||Object(K.c)(this.constructor.name),this.display=!0,this.position=new q.a,this.rotation=new q.a,this.scale=new q.a(1,1,1),this.matrix=new X.a,this.userData={},this.props={},this._setScenegraphNodeProps(e)}return g()(t,[{key:"delete",value:function(){}},{key:"setProps",value:function(t){return this._setScenegraphNodeProps(t),this}},{key:"toString",value:function(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}},{key:"setPosition",value:function(t){return Object(Z.a)(3===t.length,"setPosition requires vector argument"),this.position=t,this}},{key:"setRotation",value:function(t){return Object(Z.a)(3===t.length,"setRotation requires vector argument"),this.rotation=t,this}},{key:"setScale",value:function(t){return Object(Z.a)(3===t.length,"setScale requires vector argument"),this.scale=t,this}},{key:"setMatrix",value:function(t){arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?this.matrix=t:this.matrix.copy(t)}},{key:"setMatrixComponents",value:function(t){var e=t.position,r=t.rotation,n=t.scale,i=t.update,a=void 0===i||i;return e&&this.setPosition(e),r&&this.setRotation(r),n&&this.setScale(n),a&&this.updateMatrix(),this}},{key:"updateMatrix",value:function(){var t=this.position,e=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(e),this.matrix.scale(r),this}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.position,r=t.rotation,n=t.scale;return e&&this.setPosition(e),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}},{key:"getCoordinateUniforms",value:function(t,e){Object(Z.a)(t),e=e||this.matrix;var r=new X.a(t).multiplyRight(e),n=r.invert(),i=n.transpose();return{viewMatrix:t,modelMatrix:e,objectMatrix:e,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:i}}},{key:"_setScenegraphNodeProps",value:function(t){"display"in t&&(this.display=t.display),"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}]),t}(),J=r(38),Q=r(72),tt=r(15),et=r.n(tt);function rt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var it=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m()(this,r);var i=(n=Array.isArray(n)?{children:n}:n).children,a=void 0===i?[]:i;return W.k.assert(a.every((function(t){return t instanceof Y})),"every child must an instance of ScenegraphNode"),(t=e.call(this,n)).children=a,t}return g()(r,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++){var a=i[n];Array.isArray(a)?this.add.apply(this,et()(a)):this.children.push(a)}return this}},{key:"remove",value:function(t){var e=this.children,r=e.indexOf(t);return r>-1&&e.splice(r,1),this}},{key:"removeAll",value:function(){return this.children=[],this}},{key:"delete",value:function(){this.children.forEach((function(t){return t.delete()})),this.removeAll(),P()(M()(r.prototype),"delete",this).call(this)}},{key:"traverse",value:function(t){var e,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).worldMatrix,i=void 0===n?new X.a:n,a=new X.a(i).multiplyRight(this.matrix),o=rt(this.children);try{for(o.s();!(e=o.n()).done;){var s=e.value;s instanceof r?s.traverse(t,{worldMatrix:a}):t(s,{worldMatrix:a})}}catch(t){o.e(t)}finally{o.f()}}}]),r}(Y),at=r(208),ot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},st={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ut(t){if(!t._animation){var e=ot[t.type],r=t.bufferView.data,n=new(0,st[t.componentType])(r.buffer,r.byteOffset+(t.byteOffset||0),e*t.count);if(1===e)t._animation=Array.from(n);else{for(var i=[],a=0;a<n.length;a+=e)i.push(Array.from(n.slice(a,a+e)));t._animation=i}}return t._animation}var lt=new X.a,ct=new at.a,ht=function(){function t(e){m()(this,t),this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}return g()(t,[{key:"animate",value:function(t){if(this.playing){var e=(t/1e3-this.startTime)*this.speed;this.channels.forEach((function(t){var r=t.target;(function(t,e,r,n){var i=e.input,a=e.interpolation,o=e.output,s=t%i[i.length-1],u=i.findIndex((function(t){return t>=s})),l=Math.max(0,u-1);if(!Array.isArray(r[n]))switch(n){case"translation":r[n]=[0,0,0];break;case"rotation":r[n]=[0,0,0,1];break;case"scale":r[n]=[1,1,1];break;default:W.k.warn("Bad animation path ".concat(n))()}Object(Z.a)(r[n].length===o[l].length);var c=i[l],h=i[u];switch(a){case"STEP":!function(t,e,r){for(var n=0;n<r.length;n++)t[e][n]=r[n]}(r,n,o[l]);break;case"LINEAR":h>c&&function(t,e,r,n,i){if("rotation"===e){ct.slerp({start:r,target:n,ratio:i});for(var a=0;a<ct.length;a++)t[e][a]=ct[a]}else for(var o=0;o<r.length;o++)t[e][o]=i*n[o]+(1-i)*r[o]}(r,n,o[l],o[u],(s-c)/(h-c));break;case"CUBICSPLINE":h>c&&function(t,e,r){for(var n=r.p0,i=r.outTangent0,a=r.inTangent1,o=r.p1,s=r.tDiff,u=r.ratio,l=0;l<t[e].length;l++){var c=i[l]*s,h=a[l]*s;t[e][l]=(2*Math.pow(u,3)-3*Math.pow(u,2)+1)*n[l]+(Math.pow(u,3)-2*Math.pow(u,2)+u)*c+(-2*Math.pow(u,3)+3*Math.pow(u,2))*o[l]+(Math.pow(u,3)-Math.pow(u,2))*h}}(r,n,{p0:o[3*l+1],outTangent0:o[3*l+2],inTangent1:o[3*u+0],p1:o[3*u+1],tDiff:h-c,ratio:(s-c)/(h-c)});break;default:W.k.warn("Interpolation ".concat(a," not supported"))()}})(e,t.sampler,r,t.path),function(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){var r=lt.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}(r,r._node)}))}}}]),t}(),ft=function(){function t(e){m()(this,t),this.animations=e.animations.map((function(t,r){var n=t.name||"Animation-".concat(r),i=t.samplers.map((function(t){var r=t.interpolation,n=void 0===r?"LINEAR":r,i=t.output;return{input:ut(e.accessors[t.input]),interpolation:n,output:ut(e.accessors[i])}})),a=t.channels.map((function(t){var r=t.target;return{sampler:i[t.sampler],target:e.nodes[r.node],path:r.path}}));return new ht({name:n,channels:a})}))}return g()(t,[{key:"animate",value:function(t){this.setTime(t)}},{key:"setTime",value:function(t){this.animations.forEach((function(e){return e.animate(t)}))}},{key:"getAnimations",value:function(){return this.animations}}]),t}(),dt=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m()(this,r),(n=e.call(this,i)).onBeforeRender=null,n.AfterRender=null,t instanceof D.a?(n.model=t,n._setModelNodeProps(i)):n.model=new D.a(t,i),n.managedResources=i.managedResources||[],n}return g()(r,[{key:"setProps",value:function(t){return P()(M()(r.prototype),"setProps",this).call(this,t),this._setModelNodeProps(t),this}},{key:"delete",value:function(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach((function(t){return t.delete()})),this.managedResources=[]}},{key:"draw",value:function(){var t;return(t=this.model).draw.apply(t,arguments)}},{key:"setUniforms",value:function(){var t;return(t=this.model).setUniforms.apply(t,arguments),this}},{key:"setAttributes",value:function(){var t;return(t=this.model).setAttributes.apply(t,arguments),this}},{key:"updateModuleSettings",value:function(){var t;return(t=this.model).updateModuleSettings.apply(t,arguments),this}},{key:"_setModelNodeProps",value:function(t){this.model.setProps(t)}}]),r}(Y),pt=r(276),mt=r(176),vt=r(115);function gt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function yt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):gt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var _t=function(){function t(e,r){var n=r.attributes,i=r.material,a=r.pbrDebug,o=r.imageBasedLightingEnvironment,s=r.lights,u=r.useTangents;m()(this,t),this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},Object(pt.b)(e,mt.a.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],o&&(this.uniforms.u_DiffuseEnvSampler=o.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=o.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=o.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),a&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(n.NORMAL,"HAS_NORMALS"),this.defineIfPresent(n.TANGENT&&u,"HAS_TANGENTS"),this.defineIfPresent(n.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(o,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(a,"PBR_DEBUG"),i&&this.parseMaterial(i)}return g()(t,[{key:"defineIfPresent",value:function(t,e){t&&(this.defines[e]=1)}},{key:"parseTexture",value:function(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t.texture&&t.texture.sampler&&t.texture.sampler.parameters||{},a=t.texture.source.image,o={};a.compressed?(r=a,o=h()({},this.gl.TEXTURE_MIN_FILTER,a.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR)):r={data:a};var s=new vt.a(this.gl,yt({id:t.name||t.id,parameters:yt(yt({},i),o),pixelStore:h()({},this.gl.UNPACK_FLIP_Y_WEBGL,!1)},r));this.uniforms[e]=s,this.defineIfPresent(n,n),this.generatedTextures.push(s)}},{key:"parsePbrMetallicRoughness",value:function(t){t.baseColorTexture&&this.parseTexture(t.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&this.parseTexture(t.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");var e=t.metallicFactor,r=t.roughnessFactor;this.uniforms.u_MetallicRoughnessValues=[void 0===e?1:e,void 0===r?1:r]}},{key:"parseMaterial",value:function(t){if(this.uniforms.pbr_uUnlit=Boolean(t.unlit),t.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(t.pbrMetallicRoughness),t.normalTexture){this.parseTexture(t.normalTexture,"u_NormalSampler","HAS_NORMALMAP");var e=t.normalTexture.scale;this.uniforms.u_NormalScale=void 0===e?1:e}if(t.occlusionTexture){this.parseTexture(t.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");var r=t.occlusionTexture.strength;this.uniforms.u_OcclusionStrength=void 0===r?1:r}if(t.emissiveTexture&&(this.parseTexture(t.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=t.emissiveFactor||[0,0,0]),"MASK"===t.alphaMode){var n=t.alphaCutoff,i=void 0===n?.5:n;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=i}else"BLEND"===t.alphaMode&&(W.k.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}}]),t}();function bt(t,e){return Object(W.j)(t)?"#version 300 es\n".concat(e):e}var xt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},wt={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},Mt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m()(this,t),this.gl=e,this.options=Object.assign({},wt,r)}return g()(t,[{key:"instantiate",value:function(t){var e=this;return this.gltf=t,(t.scenes||[]).map((function(t){return e.createScene(t)}))}},{key:"createAnimator",value:function(){return Array.isArray(this.gltf.animations)?new ft(this.gltf):null}},{key:"createScene",value:function(t){var e=this,r=(t.nodes||[]).map((function(t){return e.createNode(t)}));return new it({id:t.name||t.id,children:r})}},{key:"createNode",value:function(t){var e=this;if(!t._node){var r=(t.children||[]).map((function(t){return e.createNode(t)}));t.mesh&&r.push(this.createMesh(t.mesh));var n=new it({id:t.name||t.id,children:r});if(t.matrix)n.setMatrix(t.matrix);else{if(n.matrix.identity(),t.translation&&n.matrix.translate(t.translation),t.rotation){var i=(new X.a).fromQuaternion(t.rotation);n.matrix.multiplyRight(i)}t.scale&&n.matrix.scale(t.scale)}t._node=n}return t._node}},{key:"createMesh",value:function(t){var e=this;if(!t._mesh){var r=(t.primitives||[]).map((function(r,n){return e.createPrimitive(r,n,t)})),n=new it({id:t.name||t.id,children:r});t._mesh=n}return t._mesh}},{key:"getVertexCount",value:function(t){W.k.warn("getVertexCount() not found")()}},{key:"createPrimitive",value:function(t,e,r){return function(t,e){var r=e.id,n=e.drawMode,i=e.vertexCount,a=e.attributes,o=e.modelOptions,s=new _t(t,e);W.k.info(4,"createGLTFModel defines: ",s.defines)();var u=[];u.push.apply(u,et()(s.generatedTextures)),u.push.apply(u,et()(Object.values(a).map((function(t){return t.buffer}))));var l=new dt(t,Object.assign({id:r,drawMode:n,vertexCount:i,modules:[$],defines:s.defines,parameters:s.parameters,vs:bt(t,"\n#if (__VERSION__ < 300)\n  #define _attr attribute\n#else\n  #define _attr in\n#endif\n\n  _attr vec4 POSITION;\n\n  #ifdef HAS_NORMALS\n    _attr vec4 NORMAL;\n  #endif\n\n  #ifdef HAS_TANGENTS\n    _attr vec4 TANGENT;\n  #endif\n\n  #ifdef HAS_UV\n    _attr vec2 TEXCOORD_0;\n  #endif\n\n  void main(void) {\n    vec4 _NORMAL = vec4(0.);\n    vec4 _TANGENT = vec4(0.);\n    vec2 _TEXCOORD_0 = vec2(0.);\n\n    #ifdef HAS_NORMALS\n      _NORMAL = NORMAL;\n    #endif\n\n    #ifdef HAS_TANGENTS\n      _TANGENT = TANGENT;\n    #endif\n\n    #ifdef HAS_UV\n      _TEXCOORD_0 = TEXCOORD_0;\n    #endif\n\n    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);\n    gl_Position = u_MVPMatrix * POSITION;\n  }\n"),fs:bt(t,"\n#if (__VERSION__ < 300)\n  #define fragmentColor gl_FragColor\n#else\n  out vec4 fragmentColor;\n#endif\n\n  void main(void) {\n    fragmentColor = pbr_filterColor(vec4(0));\n  }\n"),managedResources:u},o));return l.setProps({attributes:a}),l.setUniforms(s.uniforms),l}(this.gl,Object.assign({id:t.name||"".concat(r.name||r.id,"-primitive-").concat(e),drawMode:t.mode||4,vertexCount:t.indices?t.indices.count:this.getVertexCount(t.attributes),attributes:this.createAttributes(t.attributes,t.indices),material:t.material},this.options))}},{key:"createAttributes",value:function(t,e){var r=this,n={};return Object.keys(t).forEach((function(e){n[e]=r.createAccessor(t[e],r.createBuffer(t[e],r.gl.ARRAY_BUFFER))})),e&&(n.indices=this.createAccessor(e,this.createBuffer(e,this.gl.ELEMENT_ARRAY_BUFFER))),W.k.info(4,"glTF Attributes",{attributes:t,indices:e,generated:n})(),n}},{key:"createBuffer",value:function(t,e){t.bufferView||(t.bufferView={});var r=t.bufferView;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[e]||(r.lumaBuffers[e]=new J.a(this.gl,{id:"from-".concat(r.id),data:r.data||t.value,target:e})),r.lumaBuffers[e]}},{key:"createAccessor",value:function(t,e){return new Q.a({buffer:e,offset:t.byteOffset||0,stride:t.bufferView.byteStride||0,type:t.componentType,size:xt[t.type]})}},{key:"createSampler",value:function(t){return t}},{key:"needsPOT",value:function(){return!1}}]),t}(),At=r(12),Et=r.n(At),St=r(83),Tt=r(116),Ct=r(59),Ot={};function Pt(t){return Lt.apply(this,arguments)}function Lt(){return(Lt=d()(E.a.mark((function t(e){var r,n,i=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},(r=i.length>1&&void 0!==i[1]?i[1]:null)&&(e=It(e,r,n)),Ot[e]=Ot[e]||kt(e),t.next=6,Ot[e];case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function It(t,e,r){if(t.startsWith("http"))return t;var n=r.modules||{};return n[t]?n[t]:St.b?r.CDN?(Object(Ct.a)(r.CDN.startsWith("http")),"".concat(r.CDN,"/").concat(e,"@").concat("3.1.5","/dist/libs/").concat(t)):St.d?"../src/libs/".concat(t):"modules/".concat(e,"/src/libs/").concat(t):"modules/".concat(e,"/dist/libs/").concat(t)}function kt(t){return Rt.apply(this,arguments)}function Rt(){return(Rt=d()(E.a.mark((function t(e){var r,n;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.endsWith("wasm")){t.next=7;break}return t.next=3,fetch(e);case 3:return r=t.sent,t.next=6,r.arrayBuffer();case 6:return t.abrupt("return",t.sent);case 7:if(St.b){t.next=20;break}if(t.prev=8,t.t0=Tt&&Tt.requireFromFile,!t.t0){t.next=14;break}return t.next=13,Tt.requireFromFile(e);case 13:t.t0=t.sent;case 14:return t.abrupt("return",t.t0);case 17:return t.prev=17,t.t1=t.catch(8),t.abrupt("return",null);case 20:if(!St.d){t.next=22;break}return t.abrupt("return",importScripts(e));case 22:return t.next=24,fetch(e);case 24:return n=t.sent,t.next=27,n.text();case 27:return t.abrupt("return",Dt(t.sent,e));case 29:case"end":return t.stop()}}),t,null,[[8,17]])})))).apply(this,arguments)}function Dt(t,e){if(!St.b)return Tt.requireFromString&&Tt.requireFromString(t,e);if(St.d)return eval.call(St.a,t),null;var r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch(e){r.text=t}return document.body.appendChild(r),null}var Bt,Ft,jt="https://unpkg.com/@loaders.gl/textures@".concat("3.1.5","/dist/libs/basis_encoder.wasm"),Nt="https://unpkg.com/@loaders.gl/textures@".concat("3.1.5","/dist/libs/basis_encoder.js");function Ut(t){return zt.apply(this,arguments)}function zt(){return(zt=d()(E.a.mark((function t(e){var r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.modules||{}).basis){t.next=3;break}return t.abrupt("return",r.basis);case 3:return Bt=Bt||Gt(e),t.next=6,Bt;case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Gt(t){return Vt.apply(this,arguments)}function Vt(){return(Vt=d()(E.a.mark((function t(e){var r,n,i,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,n=null,t.t0=Promise,t.next=5,Pt("basis_transcoder.js","textures",e);case 5:return t.t1=t.sent,t.next=8,Pt("basis_transcoder.wasm","textures",e);case 8:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=12,t.t0.all.call(t.t0,t.t3);case 12:return i=t.sent,a=Et()(i,2),n=a[1],r=(r=a[0])||globalThis.BASIS,t.next=19,Ht(r,n);case 19:return t.abrupt("return",t.sent);case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ht(t,e){var r={};return e&&(r.wasmBinary=e),new Promise((function(e){t(r).then((function(t){var r=t.BasisFile;(0,t.initializeBasis)(),e({BasisFile:r})}))}))}function Wt(t){return $t.apply(this,arguments)}function $t(){return($t=d()(E.a.mark((function t(e){var r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.modules||{}).basisEncoder){t.next=3;break}return t.abrupt("return",r.basisEncoder);case 3:return Ft=Ft||qt(e),t.next=6,Ft;case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function qt(t){return Xt.apply(this,arguments)}function Xt(){return(Xt=d()(E.a.mark((function t(e){var r,n,i,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,n=null,t.t0=Promise,t.next=5,Pt(Nt,"textures",e);case 5:return t.t1=t.sent,t.next=8,Pt(jt,"textures",e);case 8:return t.t2=t.sent,t.t3=[t.t1,t.t2],t.next=12,t.t0.all.call(t.t0,t.t3);case 12:return i=t.sent,a=Et()(i,2),n=a[1],r=(r=a[0])||globalThis.BASIS,t.next=19,Kt(r,n);case 19:return t.abrupt("return",t.sent);case 20:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Kt(t,e){var r={};return e&&(r.wasmBinary=e),new Promise((function(e){t(r).then((function(t){var r=t.BasisFile,n=t.KTX2File,i=t.BasisEncoder;(0,t.initializeBasis)(),e({BasisFile:r,KTX2File:n,BasisEncoder:i})}))}))}function Zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Yt,Jt,Qt,te,ee,re,ne,ie,ae,oe=["","WEBKIT_","MOZ_"],se={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},ue=null;(ae=Yt||(Yt={}))[ae.NONE=0]="NONE",ae[ae.BASISLZ=1]="BASISLZ",ae[ae.ZSTD=2]="ZSTD",ae[ae.ZLIB=3]="ZLIB",function(t){t[t.BASICFORMAT=0]="BASICFORMAT"}(Jt||(Jt={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.ETC1S=163]="ETC1S",t[t.UASTC=166]="UASTC"}(Qt||(Qt={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.SRGB=1]="SRGB"}(te||(te={})),function(t){t[t.UNSPECIFIED=0]="UNSPECIFIED",t[t.LINEAR=1]="LINEAR",t[t.SRGB=2]="SRGB",t[t.ITU=3]="ITU",t[t.NTSC=4]="NTSC",t[t.SLOG=5]="SLOG",t[t.SLOG2=6]="SLOG2"}(ee||(ee={})),function(t){t[t.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",t[t.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(re||(re={})),function(t){t[t.RGB=0]="RGB",t[t.RRR=3]="RRR",t[t.GGG=4]="GGG",t[t.AAA=15]="AAA"}(ne||(ne={})),function(t){t[t.RGB=0]="RGB",t[t.RGBA=3]="RGBA",t[t.RRR=4]="RRR",t[t.RRRG=5]="RRRG"}(ie||(ie={}));var le=[171,75,84,88,32,50,48,187,13,10,26,10];function ce(t){var e=new Uint8Array(t);return!(e.byteLength<le.length||e[0]!==le[0]||e[1]!==le[1]||e[2]!==le[2]||e[3]!==le[3]||e[4]!==le[4]||e[5]!==le[5]||e[6]!==le[6]||e[7]!==le[7]||e[8]!==le[8]||e[9]!==le[9]||e[10]!==le[10]||e[11]!==le[11])}var he={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function fe(){return(fe=d()(E.a.mark((function t(e,r){var n;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("auto"!==r.basis.containerFormat){t.next=11;break}if(!ce(e)){t.next=6;break}return t.next=4,Wt(r);case 4:return t.abrupt("return",me(t.sent.KTX2File,e,r));case 6:return t.next=8,Ut(r);case 8:case 24:return t.abrupt("return",de(t.sent.BasisFile,e,r));case 11:t.t0=r.basis.module,t.next="encoder"===t.t0?14:22;break;case 14:return t.next=16,Wt(r);case 16:n=t.sent,t.t1=r.basis.containerFormat,t.next="ktx2"===t.t1?20:21;break;case 20:return t.abrupt("return",me(n.KTX2File,e,r));case 21:return t.abrupt("return",de(n.BasisFile,e,r));case 22:return t.next=24,Ut(r);case 27:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function de(t,e,r){var n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;for(var i=n.getNumImages(),a=[],o=0;o<i;o++){for(var s=n.getNumLevels(o),u=[],l=0;l<s;l++)u.push(pe(n,o,l,r));a.push(u)}return a}finally{n.close(),n.delete()}}function pe(t,e,r,n){var i=t.getImageWidth(e,r),a=t.getImageHeight(e,r),o=t.getHasAlpha(),s=ge(n,o),u=s.compressed,l=s.format,c=s.basisFormat,h=t.getImageTranscodedSizeInBytes(e,r,c),f=new Uint8Array(h);return t.transcodeImage(f,e,r,c,0,0)?{width:i,height:a,data:f,compressed:u,hasAlpha:o,format:l}:null}function me(t,e,r){var n=new t(new Uint8Array(e));try{if(!n.startTranscoding())return null;for(var i=n.getLevels(),a=[],o=0;o<i;o++){a.push(ve(n,o,r));break}return a}finally{n.close(),n.delete()}}function ve(t,e,r){var n=t.getImageLevelInfo(e,0,0),i=n.alphaFlag,a=n.height,o=n.width,s=ge(r,i),u=s.compressed,l=s.format,c=s.basisFormat,h=t.getImageTranscodedSizeInBytes(e,0,0,c),f=new Uint8Array(h);return t.transcodeImage(f,e,0,0,c,0,-1,-1)?{width:o,height:a,data:f,compressed:u,alphaFlag:i,format:l}:null}function ge(t,e){var r=t&&t.basis&&t.basis.format;return"auto"===r&&(r=ye()),"object"===V()(r)&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),he[r]}function ye(){var t=function(t){if(!ue){t=t||function(){try{return document.createElement("canvas").getContext("webgl")}catch(t){return null}}()||void 0,ue=new Set;var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Zt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zt(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(oe);try{for(r.s();!(e=r.n()).done;){var n=e.value;for(var i in se)t&&t.getExtension("".concat(n).concat(i))&&ue.add(se[i])}}catch(t){r.e(t)}finally{r.f()}}return ue}();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}function _e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function be(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var xe=be(be({},{name:"Basis",id:"basis",module:"textures",version:"3.1.5",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}}),{},{parse:function(t,e){return fe.apply(this,arguments)}}),we=r(291),Me=r(201),Ae=r(84);function Ee(t,e){if(!t)throw new Error(e||"assert failed: gltf")}function Se(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;var r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(t));return r.substr(0,r.lastIndexOf("/")+1)+t}function Te(t,e,r){var n=t.bufferViews[r];Ee(n);var i=e[n.buffer];return Ee(i),new Uint8Array(i.arrayBuffer,(n.byteOffset||0)+i.byteOffset,n.byteLength)}var Ce=r(4),Oe=r(160),Pe=r(134),Le=["SCALAR","VEC2","VEC3","VEC4"],Ie=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ke=new Map(Ie),Re={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},De={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Be={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Fe(t){return Le[t-1]||Le[0]}function je(t){var e=ke.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Ne(t,e){var r=Be[t.componentType],n=Re[t.type],i=t.count*n,a=t.count*n*De[t.componentType];return Ee(a>=0&&a<=e.byteLength),{ArrayType:r,length:i,byteLength:a}}function Ue(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ze(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ze(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ge(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ve(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ge(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ge(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var He,We={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},$e=function(){function t(e){m()(this,t),Object(Ce.a)(this,"gltf",void 0),Object(Ce.a)(this,"sourceBuffers",void 0),Object(Ce.a)(this,"byteLength",void 0),this.gltf=e||{json:Ve({},We),buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return g()(t,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(t){return this.json[t]}},{key:"getExtraData",value:function(t){return(this.json.extras||{})[t]}},{key:"getExtension",value:function(t){return this.getUsedExtensions().find((function(e){return e===t}))?(this.json.extensions||{})[t]||!0:null}},{key:"getRequiredExtension",value:function(t){return this.getRequiredExtensions().find((function(e){return e===t}))?this.getExtension(t):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(t,e){return(t.extensions||{})[e]}},{key:"getScene",value:function(t){return this.getObject("scenes",t)}},{key:"getNode",value:function(t){return this.getObject("nodes",t)}},{key:"getSkin",value:function(t){return this.getObject("skins",t)}},{key:"getMesh",value:function(t){return this.getObject("meshes",t)}},{key:"getMaterial",value:function(t){return this.getObject("materials",t)}},{key:"getAccessor",value:function(t){return this.getObject("accessors",t)}},{key:"getTexture",value:function(t){return this.getObject("textures",t)}},{key:"getSampler",value:function(t){return this.getObject("samplers",t)}},{key:"getImage",value:function(t){return this.getObject("images",t)}},{key:"getBufferView",value:function(t){return this.getObject("bufferViews",t)}},{key:"getBuffer",value:function(t){return this.getObject("buffers",t)}},{key:"getObject",value:function(t,e){if("object"===V()(e))return e;var r=this.json[t]&&this.json[t][e];if(!r)throw new Error("glTF file error: Could not find ".concat(t,"[").concat(e,"]"));return r}},{key:"getTypedArrayForBufferView",value:function(t){var e=(t=this.getBufferView(t)).buffer,r=this.gltf.buffers[e];return Ee(r),new Uint8Array(r.arrayBuffer,(t.byteOffset||0)+r.byteOffset,t.byteLength)}},{key:"getTypedArrayForAccessor",value:function(t){t=this.getAccessor(t);var e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,n=Ne(t,e);return new(0,n.ArrayType)(r,e.byteOffset+t.byteOffset,n.length)}},{key:"getTypedArrayForImageData",value:function(t){t=this.getAccessor(t);var e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data;return new Uint8Array(r,e.byteOffset||0,e.byteLength)}},{key:"addApplicationData",value:function(t,e){return this.json[t]=e,this}},{key:"addExtraData",value:function(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}},{key:"addObjectExtension",value:function(t,e,r){return t.extensions=t.extensions||{},t.extensions[e]=r,this.registerUsedExtension(e),this}},{key:"setObjectExtension",value:function(t,e,r){(t.extensions||{})[e]=r}},{key:"removeObjectExtension",value:function(t,e){var r=t.extensions||{},n=r[e];return delete r[e],n}},{key:"addExtension",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ee(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}},{key:"addRequiredExtension",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ee(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}},{key:"registerUsedExtension",value:function(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(e){return e===t}))||this.json.extensionsUsed.push(t)}},{key:"registerRequiredExtension",value:function(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(e){return e===t}))||this.json.extensionsRequired.push(t)}},{key:"removeExtension",value:function(t){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t),this.json.extensions&&delete this.json.extensions[t]}},{key:"setDefaultScene",value:function(t){this.json.scene=t}},{key:"addScene",value:function(t){var e=t.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}},{key:"addNode",value:function(t){var e=t.meshIndex,r=t.matrix;this.json.nodes=this.json.nodes||[];var n={mesh:e};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}},{key:"addMesh",value:function(t){var e=t.indices,r=t.material,n=t.mode,i=void 0===n?4:n,a={primitives:[{attributes:this._addAttributes(t.attributes),mode:i}]};if(e){var o=this._addIndices(e);a.primitives[0].indices=o}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}},{key:"addPointCloud",value:function(t){var e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}},{key:"addImage",value:function(t,e){var r=Object(Oe.a)(t),n=e||(null==r?void 0:r.mimeType),i={bufferView:this.addBufferView(t),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}},{key:"addBufferView",value:function(t){var e=t.byteLength;Ee(Number.isFinite(e)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);var r={buffer:0,byteOffset:this.byteLength,byteLength:e};return this.byteLength+=Object(Pe.b)(e,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(t,e){var r={bufferView:t,type:Fe(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},r=this.addBufferView(t),n={min:e.min,max:e.max};n.min&&n.max||(n=this._getAccessorMinMax(t,e.size));var i={size:e.size,componentType:je(t),count:Math.round(t.length/e.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(i,e))}},{key:"addTexture",value:function(t){var e={source:t.imageIndex};return this.json.textures=this.json.textures||[],this.json.textures.push(e),this.json.textures.length-1}},{key:"addMaterial",value:function(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var t,e;this.gltf.buffers=[];var r,n=this.byteLength,i=new ArrayBuffer(n),a=new Uint8Array(i),o=0,s=Ue(this.sourceBuffers||[]);try{for(s.s();!(r=s.n()).done;){var u=r.value;o=Object(Pe.a)(u,a,o)}}catch(t){s.e(t)}finally{s.f()}null!==(t=this.json)&&void 0!==t&&null!==(e=t.buffers)&&void 0!==e&&e[0]?this.json.buffers[0].byteLength=n:this.json.buffers=[{byteLength:n}],this.gltf.binary=i,this.sourceBuffers=[i]}},{key:"_removeStringFromArray",value:function(t,e){for(var r=!0;r;){var n=t.indexOf(e);n>-1?t.splice(n,1):r=!1}}},{key:"_addAttributes",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};for(var r in t){var n=t[r],i=this._getGltfAttributeName(r),a=this.addBinaryBuffer(n.value,n);e[i]=a}return e}},{key:"_addIndices",value:function(t){return this.addBinaryBuffer(t,{size:1})}},{key:"_getGltfAttributeName",value:function(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}},{key:"_getAccessorMinMax",value:function(t,e){var r={min:null,max:null};if(t.length<e)return r;r.min=[],r.max=[];var n,i=Ue(t.subarray(0,e));try{for(i.s();!(n=i.n()).done;){var a=n.value;r.min.push(a),r.max.push(a)}}catch(t){i.e(t)}finally{i.f()}for(var o=e;o<t.length;o+=e)for(var s=0;s<e;s++)r.min[0+s]=Math.min(r.min[0+s],t[o+s]),r.max[0+s]=Math.max(r.max[0+s],t[o+s]);return r}}]),t}(),qe="object"!==("undefined"==typeof WebAssembly?"undefined":V()(WebAssembly)),Xe="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Ke="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Ze=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Ye=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Je={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Qe={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function tr(t,e,r,n,i){return er.apply(this,arguments)}function er(){return(er=d()(E.a.mark((function t(e,r,n,i,a){var o,s,u=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=u.length>5&&void 0!==u[5]?u[5]:"NONE",t.next=3,rr();case 3:sr(s=t.sent,s.exports[Qe[a]],e,r,n,i,s.exports[Je[o||"NONE"]]);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function rr(){return nr.apply(this,arguments)}function nr(){return(nr=d()(E.a.mark((function t(){return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return He||(He=ir()),t.abrupt("return",He);case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ir(){return ar.apply(this,arguments)}function ar(){return(ar=d()(E.a.mark((function t(){var e,r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=Xe,WebAssembly.validate(Ze)&&(e=Ke,console.log("Warning: meshopt_decoder is using experimental SIMD support")),t.next=4,WebAssembly.instantiate(or(e),{});case 4:return r=t.sent,t.next=7,r.instance.exports.__wasm_call_ctors();case 7:return t.abrupt("return",r.instance);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function or(t){for(var e=new Uint8Array(t.length),r=0;r<t.length;++r){var n=t.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}for(var i=0,a=0;a<t.length;++a)e[i++]=e[a]<60?Ye[e[a]]:64*(e[a]-60)+e[++a];return e.buffer.slice(0,i)}function sr(t,e,r,n,i,a,o){var s=t.exports.sbrk,u=n+3&-4,l=s(u*i),c=s(a.length),h=new Uint8Array(t.exports.memory.buffer);h.set(a,c);var f=e(l,n,i,c,a.length);if(0===f&&o&&o(l,u,i),r.set(h.subarray(l,l+n*i)),s(l-s(0)),0!==f)throw new Error("Malformed buffer data: ".concat(f))}function ur(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return lr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?lr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function lr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var cr="EXT_meshopt_compression";function hr(t){if(new $e(t).getRequiredExtensions().includes("EXT_meshopt_compression")&&!qe)throw new Error("gltf: Required extension ".concat("EXT_meshopt_compression"," not supported by browser"))}function fr(t,e){return dr.apply(this,arguments)}function dr(){return(dr=d()(E.a.mark((function t(e,r){var n,i,a,o,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=new $e(e),null!=r&&null!==(n=r.gltf)&&void 0!==n&&n.decompressMeshes){t.next=3;break}return t.abrupt("return");case 3:a=[],o=ur(e.json.bufferViews||[]);try{for(o.s();!(s=o.n()).done;)a.push(pr(i,s.value))}catch(t){o.e(t)}finally{o.f()}return t.next=8,Promise.all(a);case 8:i.removeExtension("EXT_meshopt_compression");case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pr(t,e){return mr.apply(this,arguments)}function mr(){return(mr=d()(E.a.mark((function t(e,r){var n,i,a,o,s,u,l,c,h,f;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.getObjectExtension(r,"EXT_meshopt_compression"))){t.next=9;break}return i=n.byteOffset,a=n.byteLength,o=n.byteStride,s=n.count,u=n.mode,c=void 0===(l=n.filter)?"NONE":l,h=new Uint8Array(r.buffer,void 0===i?0:i,void 0===a?0:a),f=new ArrayBuffer(s*o),t.next=8,tr(new Uint8Array(f),s,o,h,u,c);case 8:return t.abrupt("return",f);case 9:return t.abrupt("return",null);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var vr=r(91),gr={};function yr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var _r="EXT_texture_webp";function br(t,e){var r=new $e(t);if(function(t){return void 0===gr[t]&&(gr[t]=function(){if(!vr.c)return!1;try{return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(t){return!1}}()),gr[t]}("image/webp")){var n,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return yr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yr(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(r.json.textures||[]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=r.getObjectExtension(a,"EXT_texture_webp");o&&(a.source=o.source),r.removeObjectExtension(a,"EXT_texture_webp")}}catch(t){i.e(t)}finally{i.f()}r.removeExtension("EXT_texture_webp")}else if(r.getRequiredExtensions().includes("EXT_texture_webp"))throw new Error("gltf: Required extension ".concat("EXT_texture_webp"," not supported by browser"))}function xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var wr="KHR_texture_basisu";function Mr(t,e){var r,n=new $e(t),i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return xr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xr(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(n.json.textures||[]);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=n.getObjectExtension(a,"KHR_texture_basisu");o&&(a.source=o.source),n.removeObjectExtension(a,"KHR_texture_basisu")}}catch(t){i.e(t)}finally{i.f()}n.removeExtension("KHR_texture_basisu")}var Ar={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:"3.1.5",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":V()(WebAssembly))?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Er(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,a=-1/0,o=-1/0,s=t.POSITION?t.POSITION.value:[],u=s&&s.length,l=0;l<u;l+=3){var c=s[l],h=s[l+1],f=s[l+2];e=c<e?c:e,r=h<r?h:r,n=f<n?f:n,i=c>i?c:i,a=h>a?h:a,o=f>o?f:o}return[[e,r,n],[i,a,o]]}function Sr(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Tr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Tr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Cr=function(){function t(e,r){m()(this,t),Object(Ce.a)(this,"fields",void 0),Object(Ce.a)(this,"metadata",void 0),function(t,e){if(!t)throw new Error("loader assertion failed.")}(Array.isArray(e)),function(t){var e,r={},n=Sr(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;r[i.name]&&console.warn("Schema: duplicated field name",i.name,i),r[i.name]=!0}}catch(t){n.e(t)}finally{n.f()}}(e),this.fields=e,this.metadata=r||new Map}return g()(t,[{key:"compareTo",value:function(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(var e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}},{key:"select",value:function(){for(var e=Object.create(null),r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++)e[o[a]]=!0;var s=this.fields.filter((function(t){return e[t.name]}));return new t(s,this.metadata)}},{key:"selectAt",value:function(){for(var e=this,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var a=n.map((function(t){return e.fields[t]})).filter(Boolean);return new t(a,this.metadata)}},{key:"assign",value:function(e){var r,n=this.metadata;if(e instanceof t){var i=e;r=i.fields,n=Or(Or(new Map,this.metadata),i.metadata)}else r=e;var a,o=Object.create(null),s=Sr(this.fields);try{for(s.s();!(a=s.n()).done;){var u=a.value;o[u.name]=u}}catch(t){s.e(t)}finally{s.f()}var l,c=Sr(r);try{for(c.s();!(l=c.n()).done;){var h=l.value;o[h.name]=h}}catch(t){c.e(t)}finally{c.f()}return new t(Object.values(o),n)}}]),t}();function Or(t,e){return new Map([].concat(et()(t||new Map),et()(e||new Map)))}var Pr,Lr=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;m()(this,t),Object(Ce.a)(this,"name",void 0),Object(Ce.a)(this,"type",void 0),Object(Ce.a)(this,"nullable",void 0),Object(Ce.a)(this,"metadata",void 0),this.name=e,this.type=r,this.nullable=n,this.metadata=i}return g()(t,[{key:"typeId",get:function(){return this.type&&this.type.typeId}},{key:"clone",value:function(){return new t(this.name,this.type,this.nullable,this.metadata)}},{key:"compareTo",value:function(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}},{key:"toString",value:function(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}]),t}(),Ir=r(17),kr=r.n(Ir);function Rr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(Pr||(Pr={}));var Dr=function(){function t(){m()(this,t)}return g()(t,[{key:"typeId",get:function(){return Pr.NONE}},{key:"compareTo",value:function(t){return this===t}}],[{key:"isNull",value:function(t){return t&&t.typeId===Pr.Null}},{key:"isInt",value:function(t){return t&&t.typeId===Pr.Int}},{key:"isFloat",value:function(t){return t&&t.typeId===Pr.Float}},{key:"isBinary",value:function(t){return t&&t.typeId===Pr.Binary}},{key:"isUtf8",value:function(t){return t&&t.typeId===Pr.Utf8}},{key:"isBool",value:function(t){return t&&t.typeId===Pr.Bool}},{key:"isDecimal",value:function(t){return t&&t.typeId===Pr.Decimal}},{key:"isDate",value:function(t){return t&&t.typeId===Pr.Date}},{key:"isTime",value:function(t){return t&&t.typeId===Pr.Time}},{key:"isTimestamp",value:function(t){return t&&t.typeId===Pr.Timestamp}},{key:"isInterval",value:function(t){return t&&t.typeId===Pr.Interval}},{key:"isList",value:function(t){return t&&t.typeId===Pr.List}},{key:"isStruct",value:function(t){return t&&t.typeId===Pr.Struct}},{key:"isUnion",value:function(t){return t&&t.typeId===Pr.Union}},{key:"isFixedSizeBinary",value:function(t){return t&&t.typeId===Pr.FixedSizeBinary}},{key:"isFixedSizeList",value:function(t){return t&&t.typeId===Pr.FixedSizeList}},{key:"isMap",value:function(t){return t&&t.typeId===Pr.Map}},{key:"isDictionary",value:function(t){return t&&t.typeId===Pr.Dictionary}}]),t}(),Br=function(t,e){_()(n,t);var r=Rr(n);function n(t,e){var i;return m()(this,n),i=r.call(this),Object(Ce.a)(kr()(i),"isSigned",void 0),Object(Ce.a)(kr()(i),"bitWidth",void 0),i.isSigned=t,i.bitWidth=e,i}return g()(n,[{key:"typeId",get:function(){return Pr.Int}},{key:e,get:function(){return"Int"}},{key:"toString",value:function(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}]),n}(Dr,Symbol.toStringTag),Fr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!0,8)}return r}(Br),jr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!0,16)}return r}(Br),Nr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!0,32)}return r}(Br),Ur=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!1,8)}return r}(Br),zr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!1,16)}return r}(Br),Gr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,!1,32)}return r}(Br),Vr=function(t,e){_()(n,t);var r=Rr(n);function n(t){var e;return m()(this,n),e=r.call(this),Object(Ce.a)(kr()(e),"precision",void 0),e.precision=t,e}return g()(n,[{key:"typeId",get:function(){return Pr.Float}},{key:e,get:function(){return"Float"}},{key:"toString",value:function(){return"Float".concat(this.precision)}}]),n}(Dr,Symbol.toStringTag),Hr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,32)}return r}(Vr),Wr=function(t){_()(r,t);var e=Rr(r);function r(){return m()(this,r),e.call(this,64)}return r}(Vr),$r=function(t,e){_()(n,t);var r=Rr(n);function n(t,e){var i;return m()(this,n),i=r.call(this),Object(Ce.a)(kr()(i),"listSize",void 0),Object(Ce.a)(kr()(i),"children",void 0),i.listSize=t,i.children=[e],i}return g()(n,[{key:"typeId",get:function(){return Pr.FixedSizeList}},{key:"valueType",get:function(){return this.children[0].type}},{key:"valueField",get:function(){return this.children[0]}},{key:e,get:function(){return"FixedSizeList"}},{key:"toString",value:function(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}]),n}(Dr,Symbol.toStringTag);function qr(t,e,r){var n=Kr(e.metadata),i=[],a=function(t){var e={};for(var r in t){var n=t[r];e[n.name||"undefined"]=n}return e}(e.attributes);for(var o in t){var s=Xr(o,t[o],a[o]);i.push(s)}if(r){var u=Xr("indices",r);i.push(u)}return new Cr(i,n)}function Xr(t,e,r){return function(t,e,r){var n=function(t){switch(t.constructor){case Int8Array:return new Fr;case Uint8Array:return new Ur;case Int16Array:return new jr;case Uint16Array:return new zr;case Int32Array:return new Nr;case Uint32Array:return new Gr;case Float32Array:return new Hr;case Float64Array:return new Wr;default:throw new Error("array type not supported")}}(e.value),i=r||function(t){var e=new Map;return"byteOffset"in t&&e.set("byteOffset",t.byteOffset.toString(10)),"byteStride"in t&&e.set("byteStride",t.byteStride.toString(10)),"normalized"in t&&e.set("normalized",t.normalized.toString()),e}(e);return new Lr(t,new $r(e.size,new Lr("value",n)),!1,i)}(t,e,r?Kr(r.metadata):void 0)}function Kr(t){var e=new Map;for(var r in t)e.set("".concat(r,".string"),JSON.stringify(t[r]));return e}function Zr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Yr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Jr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Yr(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Yr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Qr={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},tn={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},en=function(){function t(e){m()(this,t),Object(Ce.a)(this,"draco",void 0),Object(Ce.a)(this,"decoder",void 0),Object(Ce.a)(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return g()(t,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new this.draco.DecoderBuffer;r.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);var n=this.decoder.GetEncodedGeometryType(r),i=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(r,i);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(r,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!i.ptr){var o="DRACO decompression failed: ".concat(a.error_msg());throw new Error(o)}var s=this._getDracoLoaderData(i,n,e),u=this._getMeshData(i,s,e),l=Er(u.attributes),c=qr(u.attributes,s,u.indices);return Jr(Jr({loader:"draco",loaderData:s,header:{vertexCount:i.num_points(),boundingBox:l}},u),{},{schema:c})}finally{this.draco.destroy(r),i&&this.draco.destroy(i)}}},{key:"_getDracoLoaderData",value:function(t,e,r){var n=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,r);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:n,attributes:i}}},{key:"_getDracoAttributes",value:function(t,e){for(var r={},n=0;n<t.num_attributes();n++){var i=this.decoder.GetAttribute(t,n),a=this._getAttributeMetadata(t,n);r[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:n,metadata:a};var o=this._getQuantizationTransform(i,e);o&&(r[i.unique_id()].quantization_transform=o);var s=this._getOctahedronTransform(i,e);s&&(r[i.unique_id()].octahedron_transform=s)}return r}},{key:"_getMeshData",value:function(t,e,r){var n=this._getMeshAttributes(e,t,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");return t instanceof this.draco.Mesh?"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(t),size:1}}:{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(t),size:1}}:{topology:"point-list",mode:0,attributes:n}}},{key:"_getMeshAttributes",value:function(t,e,r){for(var n={},i=0,a=Object.values(t.attributes);i<a.length;i++){var o=a[i],s=this._deduceAttributeName(o,r);o.name=s;var u=this._getAttributeValues(e,o);n[s]={value:u.value,size:u.size,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}},{key:"_getTriangleListIndices",value:function(t){var e=3*t.num_faces(),r=4*e,n=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,n),new Uint32Array(this.draco.HEAPF32.buffer,n,e).slice()}finally{this.draco._free(n)}}},{key:"_getTriangleStripIndices",value:function(t){var e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),function(t){for(var e=t.size(),r=new Int32Array(e),n=0;n<e;n++)r[n]=t.GetValue(n);return r}(e)}finally{this.draco.destroy(e)}}},{key:"_getAttributeValues",value:function(t,e){var r,n=tn[e.data_type],i=e.num_components,a=t.num_points()*i,o=a*n.BYTES_PER_ELEMENT,s=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}(this.draco,n),u=this.draco._malloc(o);try{var l=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,l,s,o,u),r=new n(this.draco.HEAPF32.buffer,u,a).slice()}finally{this.draco._free(u)}return{value:r,size:i}}},{key:"_deduceAttributeName",value:function(t,e){for(var r=t.unique_id,n=0,i=Object.entries(e.extraAttributes||{});n<i.length;n++){var a=Et()(i[n],2);if(a[1]===r)return a[0]}var o=t.attribute_type;for(var s in Qr)if(this.draco[s]===o)return Qr[s];var u=e.attributeNameEntry||"name";return t.metadata[u]?t.metadata[u].string:"CUSTOM_ATTRIBUTE_".concat(r)}},{key:"_getTopLevelMetadata",value:function(t){var e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}},{key:"_getAttributeMetadata",value:function(t,e){var r=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(r)}},{key:"_getDracoMetadata",value:function(t){if(!t||!t.ptr)return{};for(var e={},r=this.metadataQuerier.NumEntries(t),n=0;n<r;n++){var i=this.metadataQuerier.GetEntryName(t,n);e[i]=this._getDracoMetadataField(t,i)}return e}},{key:"_getDracoMetadataField",value:function(t,e){var r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,r);var n=function(t){for(var e=t.size(),r=new Int32Array(e),n=0;n<e;n++)r[n]=t.GetValue(n);return r}(r);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:n}}finally{this.draco.destroy(r)}}},{key:"_disableAttributeTransforms",value:function(t){var e,r=t.quantizedAttributes,n=void 0===r?[]:r,i=t.octahedronAttributes,a=void 0===i?[]:i,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Zr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Zr(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}([].concat(et()(n),et()(a)));try{for(o.s();!(e=o.n()).done;)this.decoder.SkipAttributeTransform(this.draco[e.value])}catch(t){o.e(t)}finally{o.f()}}},{key:"_getQuantizationTransform",value:function(t,e){var r=this,n=e.quantizedAttributes,i=void 0===n?[]:n,a=t.attribute_type();if(i.map((function(t){return r.decoder[t]})).includes(a)){var o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map((function(t){return o.min_value(t)}))}}finally{this.draco.destroy(o)}}return null}},{key:"_getOctahedronTransform",value:function(t,e){var r=this,n=e.octahedronAttributes,i=void 0===n?[]:n,a=t.attribute_type();if(i.map((function(t){return r.decoder[t]})).includes(a)){var o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}]),t}();function rn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function nn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?rn(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var an,on="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.js"),sn="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_wasm_wrapper.js"),un="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.wasm");function ln(t){return cn.apply(this,arguments)}function cn(){return(cn=d()(E.a.mark((function t(e){var r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return an=(r=e.modules||{}).draco3d?an||r.draco3d.createDecoderModule({}).then((function(t){return{draco:t}})):an||hn(e),t.next=4,an;case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function hn(t){return fn.apply(this,arguments)}function fn(){return(fn=d()(E.a.mark((function t(e){var r,n,i,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.draco&&e.draco.decoderType,t.next="js"===t.t0?3:7;break;case 3:return t.next=5,Pt(on,"draco",e);case 5:return r=t.sent,t.abrupt("break",21);case 7:return t.t1=Promise,t.next=10,Pt(sn,"draco",e);case 10:return t.t2=t.sent,t.next=13,Pt(un,"draco",e);case 13:return t.t3=t.sent,t.t4=[t.t2,t.t3],t.next=17,t.t1.all.call(t.t1,t.t4);case 17:i=t.sent,a=Et()(i,2),r=a[0],n=a[1];case 21:return r=r||globalThis.DracoDecoderModule,t.next=24,dn(r,n);case 24:return t.abrupt("return",t.sent);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function dn(t,e){var r={};return e&&(r.wasmBinary=e),new Promise((function(e){t(nn(nn({},r),{},{onModuleLoaded:function(t){return e({draco:t})}}))}))}function pn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function mn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?pn(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):pn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var vn=mn(mn({},Ar),{},{parse:function(t,e){return gn.apply(this,arguments)}});function gn(){return(gn=d()(E.a.mark((function t(e,r){var n;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ln(r);case 2:return n=new en(t.sent.draco),t.prev=5,t.abrupt("return",n.parseSync(e,null==r?void 0:r.draco));case 7:return t.prev=7,n.destroy(),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[5,,7,10]])})))).apply(this,arguments)}function yn(t){var e={};for(var r in t)if("indices"!==r){var n=_n(t[r]);e[r]=n}return e}function _n(t){var e=function(t){var e=t,r=1,n=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?Array.isArray(t)?new e(t):!r||t instanceof e?t:new e(t):null}(e,Float32Array)),n=e.length/r),{buffer:e,size:r,count:n}}(t),r=e.buffer,n=e.size;return{value:r,size:n,byteOffset:0,count:e.count,type:Fe(n),componentType:je(r)}}function bn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function xn(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?bn(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):bn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var wn=E.a.mark(Rn);function Mn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return An(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?An(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function An(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var En="KHR_draco_mesh_compression";function Sn(t,e,r){var n,i=new $e(t),a=Mn(Rn(i));try{for(a.s();!(n=a.n()).done;)i.getObjectExtension(n.value,"KHR_draco_mesh_compression")}catch(t){a.e(t)}finally{a.f()}}function Tn(t,e,r){return Cn.apply(this,arguments)}function Cn(){return(Cn=d()(E.a.mark((function t(e,r,n){var i,a,o,s,u,l;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=r&&null!==(i=r.gltf)&&void 0!==i&&i.decompressMeshes){t.next=2;break}return t.abrupt("return");case 2:a=new $e(e),o=[],s=Mn(Rn(a));try{for(s.s();!(u=s.n()).done;)a.getObjectExtension(l=u.value,"KHR_draco_mesh_compression")&&o.push(Pn(a,l,r,n))}catch(t){s.e(t)}finally{s.f()}return t.next=8,Promise.all(o);case 8:a.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function On(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new $e(t),i=Mn(n.json.meshes||[]);try{for(i.s();!(e=i.n()).done;)In(e.value,r),n.addRequiredExtension("KHR_draco_mesh_compression")}catch(t){i.e(t)}finally{i.f()}}function Pn(t,e,r,n){return Ln.apply(this,arguments)}function Ln(){return(Ln=d()(E.a.mark((function t(e,r,n,i){var a,o,s,u,l,c,h,f,d,p,m,v,g;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.getObjectExtension(r,"KHR_draco_mesh_compression")){t.next=3;break}return t.abrupt("return");case 3:return o=e.getTypedArrayForBufferView(a.bufferView),s=Object(Ae.c)(o.buffer,o.byteOffset),u=i.parse,delete(l=xn({},n))["3d-tiles"],t.next=10,u(s,vn,l,i);case 10:for(h=yn((c=t.sent).attributes),f=0,d=Object.entries(h);f<d.length;f++)p=Et()(d[f],2),v=p[1],(m=p[0])in r.attributes&&null!=(g=e.getAccessor(r.attributes[m]))&&g.min&&null!=g&&g.max&&(v.min=g.min,v.max=g.max);r.attributes=h,c.indices&&(r.indices=_n(c.indices)),kn(r);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function In(t,e){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var o=i.DracoWriter.encodeSync({attributes:t}),s=null==a||null===(r=a.parseSync)||void 0===r?void 0:r.call(a,{attributes:t}),u=i._addFauxAttributes(s.attributes),l=i.addBufferView(o);return{primitives:[{attributes:u,mode:n,extensions:h()({},"KHR_draco_mesh_compression",{bufferView:l,attributes:u})}]}}function kn(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function Rn(t){var e,r,n,i,a;return E.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:e=Mn(t.json.meshes||[]),o.prev=1,e.s();case 3:if((r=e.n()).done){o.next=24;break}n=Mn(r.value.primitives),o.prev=6,n.s();case 8:if((i=n.n()).done){o.next=14;break}return a=i.value,o.next=12,a;case 12:o.next=8;break;case 14:o.next=19;break;case 16:o.prev=16,o.t0=o.catch(6),n.e(o.t0);case 19:return o.prev=19,n.f(),o.finish(19);case 22:o.next=3;break;case 24:o.next=29;break;case 26:o.prev=26,o.t1=o.catch(1),e.e(o.t1);case 29:return o.prev=29,e.f(),o.finish(29);case 32:case"end":return o.stop()}}),wn,null,[[1,26,29,32],[6,16,19,22]])}function Dn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Bn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Bn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Bn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Fn="KHR_lights_punctual";function jn(t){return Nn.apply(this,arguments)}function Nn(){return(Nn=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new $e(e),n=r.json,(i=r.getExtension("KHR_lights_punctual"))&&(r.json.lights=i.lights,r.removeExtension("KHR_lights_punctual")),a=Dn(n.nodes||[]);try{for(a.s();!(o=a.n()).done;)(u=r.getObjectExtension(s=o.value,"KHR_lights_punctual"))&&(s.light=u.light),r.removeObjectExtension(s,"KHR_lights_punctual")}catch(t){a.e(t)}finally{a.f()}case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Un(t){return zn.apply(this,arguments)}function zn(){return(zn=d()(E.a.mark((function t(e){var r,n,i,a,o,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new $e(e),(n=r.json).lights&&(Ee(!(i=r.addExtension("KHR_lights_punctual")).lights),i.lights=n.lights,delete n.lights),r.json.lights){a=Dn(r.json.lights);try{for(a.s();!(o=a.n()).done;)r.addObjectExtension((s=o.value).node,"KHR_lights_punctual",s)}catch(t){a.e(t)}finally{a.f()}delete r.json.lights}case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Gn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Vn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Vn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Hn="KHR_materials_unlit";function Wn(t){return $n.apply(this,arguments)}function $n(){return($n=d()(E.a.mark((function t(e){var r,n,i,a,o;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new $e(e),n=r.json,r.removeExtension("KHR_materials_unlit"),i=Gn(n.materials||[]);try{for(i.s();!(a=i.n()).done;)(o=a.value).extensions&&o.extensions.KHR_materials_unlit&&(o.unlit=!0),r.removeObjectExtension(o,"KHR_materials_unlit")}catch(t){i.e(t)}finally{i.f()}case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function qn(t){var e=new $e(t);if(e.materials){var r,n=Gn(e.json.materials||[]);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.unlit&&(delete i.unlit,e.addObjectExtension(i,"KHR_materials_unlit",{}),e.addExtension("KHR_materials_unlit"))}}catch(t){n.e(t)}finally{n.f()}}}function Xn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Kn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Kn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Kn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Zn="KHR_techniques_webgl";function Yn(t){return Jn.apply(this,arguments)}function Jn(){return(Jn=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u,l;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new $e(e),n=r.json,i=r.getExtension("KHR_techniques_webgl")){a=ei(i,r),o=Xn(n.materials||[]);try{for(o.s();!(s=o.n()).done;)(l=r.getObjectExtension(u=s.value,"KHR_techniques_webgl"))&&(u.technique=Object.assign({},l,a[l.technique]),u.technique.values=ri(u.technique,r)),r.removeObjectExtension(u,"KHR_techniques_webgl")}catch(t){o.e(t)}finally{o.f()}r.removeExtension("KHR_techniques_webgl")}case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Qn(t,e){return ti.apply(this,arguments)}function ti(){return(ti=d()(E.a.mark((function t(e,r){return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ei(t,e){var r=t.programs,n=void 0===r?[]:r,i=t.shaders,a=void 0===i?[]:i,o=t.techniques,s=void 0===o?[]:o,u=new TextDecoder;return a.forEach((function(t){if(!Number.isFinite(t.bufferView))throw new Error("KHR_techniques_webgl: no shader code");t.code=u.decode(e.getTypedArrayForBufferView(t.bufferView))})),n.forEach((function(t){t.fragmentShader=a[t.fragmentShader],t.vertexShader=a[t.vertexShader]})),s.forEach((function(t){t.program=n[t.program]})),s}function ri(t,e){var r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach((function(e){!t.uniforms[e].value||e in r||(r[e]=t.uniforms[e].value)})),Object.keys(r).forEach((function(t){"object"===V()(r[t])&&void 0!==r[t].index&&(r[t].texture=e.getTexture(r[t].index))})),r}function ni(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ii(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ii(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ii(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var ai=[n,i,a,o,s,u,l];function oi(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=ai.filter((function(t){return li(t.name,r)})),a=ni(i);try{for(a.s();!(e=a.n()).done;){var o,s=e.value;null===(o=s.preprocess)||void 0===o||o.call(s,t,r,n)}}catch(t){a.e(t)}finally{a.f()}}function si(t){return ui.apply(this,arguments)}function ui(){return(ui=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u,l=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=l.length>1&&void 0!==l[1]?l[1]:{},n=l.length>2?l[2]:void 0,i=ai.filter((function(t){return li(t.name,r)})),a=ni(i),t.prev=4,a.s();case 6:if((o=a.n()).done){t.next=12;break}return s=o.value,t.next=10,null===(u=s.decode)||void 0===u?void 0:u.call(s,e,r,n);case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),a.e(t.t0);case 17:return t.prev=17,a.f(),t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[4,14,17,20]])})))).apply(this,arguments)}function li(t,e){var r,n=(null==e||null===(r=e.gltf)||void 0===r?void 0:r.excludeExtensions)||{};return!(t in n&&!n[t])}function ci(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function hi(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return fi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function fi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var di,pi={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},mi={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},vi=function(){function t(){m()(this,t),Object(Ce.a)(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),Object(Ce.a)(this,"json",void 0)}return g()(t,[{key:"normalize",value:function(t,e){this.json=t.json;var r=t.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(r.asset.version))}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(t){var e,r=new $e(t),n=r.json,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ci(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ci(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(n.images||[]);try{for(i.s();!(e=i.n()).done;){var a=e.value,o=r.getObjectExtension(a,"KHR_binary_glTF");o&&Object.assign(a,o),r.removeObjectExtension(a,"KHR_binary_glTF")}}catch(t){i.e(t)}finally{i.f()}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,r.removeExtension("KHR_binary_glTF")}(t),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}},{key:"_addAsset",value:function(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(t){for(var e in pi)this._convertTopLevelObjectToArray(t,e)}},{key:"_convertTopLevelObjectToArray",value:function(t,e){var r=t[e];if(r&&!Array.isArray(r))for(var n in t[e]=[],r){var i=r[n];i.id=i.id||n;var a=t[e].length;t[e].push(i),this.idToIndexMap[e][n]=a}}},{key:"_convertObjectIdsToArrayIndices",value:function(t){for(var e in pi)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));var r,n=hi(t.textures);try{for(n.s();!(r=n.n()).done;)this._convertTextureIds(r.value)}catch(t){n.e(t)}finally{n.f()}var i,a=hi(t.meshes);try{for(a.s();!(i=a.n()).done;)this._convertMeshIds(i.value)}catch(t){a.e(t)}finally{a.f()}var o,s=hi(t.nodes);try{for(s.s();!(o=s.n()).done;)this._convertNodeIds(o.value)}catch(t){s.e(t)}finally{s.f()}var u,l=hi(t.scenes);try{for(l.s();!(u=l.n()).done;)this._convertSceneIds(u.value)}catch(t){l.e(t)}finally{l.f()}}},{key:"_convertTextureIds",value:function(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}},{key:"_convertMeshIds",value:function(t){var e,r=hi(t.primitives);try{for(r.s();!(e=r.n()).done;){var n=e.value,i=n.attributes,a=n.indices,o=n.material;for(var s in i)i[s]=this._convertIdToIndex(i[s],"accessor");a&&(n.indices=this._convertIdToIndex(a,"accessor")),o&&(n.material=this._convertIdToIndex(o,"material"))}}catch(t){r.e(t)}finally{r.f()}}},{key:"_convertNodeIds",value:function(t){var e=this;t.children&&(t.children=t.children.map((function(t){return e._convertIdToIndex(t,"node")}))),t.meshes&&(t.meshes=t.meshes.map((function(t){return e._convertIdToIndex(t,"mesh")})))}},{key:"_convertSceneIds",value:function(t){var e=this;t.nodes&&(t.nodes=t.nodes.map((function(t){return e._convertIdToIndex(t,"node")})))}},{key:"_convertIdsToIndices",value:function(t,e){t[e]||(console.warn("gltf v1: json doesn't contain attribute ".concat(e)),t[e]=[]);var r,n=hi(t[e]);try{for(n.s();!(r=n.n()).done;){var i=r.value;for(var a in i){var o=this._convertIdToIndex(i[a],a);i[a]=o}}}catch(t){n.e(t)}finally{n.f()}}},{key:"_convertIdToIndex",value:function(t,e){var r=mi[e];if(r in this.idToIndexMap){var n=this.idToIndexMap[r][t];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(e," with id ").concat(t));return n}return t}},{key:"_updateObjects",value:function(t){var e,r=hi(this.json.buffers);try{for(r.s();!(e=r.n()).done;)delete e.value.type}catch(t){r.e(t)}finally{r.f()}}},{key:"_updateMaterial",value:function(t){var e,r=hi(t.materials);try{var n=function(){var r=e.value;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var n=r.values&&r.values.tex,i=t.textures.findIndex((function(t){return t.id===n}));-1!==i&&(r.pbrMetallicRoughness.baseColorTexture={index:i})};for(r.s();!(e=r.n()).done;)n()}catch(t){r.e(t)}finally{r.f()}}}]),t}();function gi(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new vi).normalize(t,e)}function yi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _i(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?yi(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var bi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xi={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wi={magFilter:10240,minFilter:10241,wrapS:10242,wrapT:10243},Mi=(di={},h()(di,10240,9729),h()(di,10241,9986),h()(di,10242,10497),h()(di,10243,10497),di),Ai=function(){function t(){m()(this,t),Object(Ce.a)(this,"baseUri",""),Object(Ce.a)(this,"json",{}),Object(Ce.a)(this,"buffers",[]),Object(Ce.a)(this,"images",[])}return g()(t,[{key:"postProcess",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.json,n=t.buffers,i=void 0===n?[]:n,a=t.images,o=void 0===a?[]:a,s=t.baseUri,u=void 0===s?"":s;return Ee(r),this.baseUri=u,this.json=r,this.buffers=i,this.images=o,this._resolveTree(this.json,e),this.json}},{key:"_resolveTree",value:function(t){var e=this;t.bufferViews&&(t.bufferViews=t.bufferViews.map((function(t,r){return e._resolveBufferView(t,r)}))),t.images&&(t.images=t.images.map((function(t,r){return e._resolveImage(t,r)}))),t.samplers&&(t.samplers=t.samplers.map((function(t,r){return e._resolveSampler(t,r)}))),t.textures&&(t.textures=t.textures.map((function(t,r){return e._resolveTexture(t,r)}))),t.accessors&&(t.accessors=t.accessors.map((function(t,r){return e._resolveAccessor(t,r)}))),t.materials&&(t.materials=t.materials.map((function(t,r){return e._resolveMaterial(t,r)}))),t.meshes&&(t.meshes=t.meshes.map((function(t,r){return e._resolveMesh(t,r)}))),t.nodes&&(t.nodes=t.nodes.map((function(t,r){return e._resolveNode(t,r)}))),t.skins&&(t.skins=t.skins.map((function(t,r){return e._resolveSkin(t,r)}))),t.scenes&&(t.scenes=t.scenes.map((function(t,r){return e._resolveScene(t,r)}))),void 0!==t.scene&&(t.scene=t.scenes[this.json.scene])}},{key:"getScene",value:function(t){return this._get("scenes",t)}},{key:"getNode",value:function(t){return this._get("nodes",t)}},{key:"getSkin",value:function(t){return this._get("skins",t)}},{key:"getMesh",value:function(t){return this._get("meshes",t)}},{key:"getMaterial",value:function(t){return this._get("materials",t)}},{key:"getAccessor",value:function(t){return this._get("accessors",t)}},{key:"getCamera",value:function(t){return null}},{key:"getTexture",value:function(t){return this._get("textures",t)}},{key:"getSampler",value:function(t){return this._get("samplers",t)}},{key:"getImage",value:function(t){return this._get("images",t)}},{key:"getBufferView",value:function(t){return this._get("bufferViews",t)}},{key:"getBuffer",value:function(t){return this._get("buffers",t)}},{key:"_get",value:function(t,e){if("object"===V()(e))return e;var r=this.json[t]&&this.json[t][e];return r||console.warn("glTF file error: Could not find ".concat(t,"[").concat(e,"]")),r}},{key:"_resolveScene",value:function(t,e){var r=this;return t.id=t.id||"scene-".concat(e),t.nodes=(t.nodes||[]).map((function(t){return r.getNode(t)})),t}},{key:"_resolveNode",value:function(t,e){var r=this;return t.id=t.id||"node-".concat(e),t.children&&(t.children=t.children.map((function(t){return r.getNode(t)}))),void 0!==t.mesh?t.mesh=this.getMesh(t.mesh):void 0!==t.meshes&&t.meshes.length&&(t.mesh=t.meshes.reduce((function(t,e){var n=r.getMesh(e);return t.id=n.id,t.primitives=t.primitives.concat(n.primitives),t}),{primitives:[]})),void 0!==t.camera&&(t.camera=this.getCamera(t.camera)),void 0!==t.skin&&(t.skin=this.getSkin(t.skin)),t}},{key:"_resolveSkin",value:function(t,e){return t.id=t.id||"skin-".concat(e),t.inverseBindMatrices=this.getAccessor(t.inverseBindMatrices),t}},{key:"_resolveMesh",value:function(t,e){var r=this;return t.id=t.id||"mesh-".concat(e),t.primitives&&(t.primitives=t.primitives.map((function(t){var e=(t=_i({},t)).attributes;for(var n in t.attributes={},e)t.attributes[n]=r.getAccessor(e[n]);return void 0!==t.indices&&(t.indices=r.getAccessor(t.indices)),void 0!==t.material&&(t.material=r.getMaterial(t.material)),t}))),t}},{key:"_resolveMaterial",value:function(t,e){if(t.id=t.id||"material-".concat(e),t.normalTexture&&(t.normalTexture=_i({},t.normalTexture),t.normalTexture.texture=this.getTexture(t.normalTexture.index)),t.occlusionTexture&&(t.occlustionTexture=_i({},t.occlustionTexture),t.occlusionTexture.texture=this.getTexture(t.occlusionTexture.index)),t.emissiveTexture&&(t.emmisiveTexture=_i({},t.emmisiveTexture),t.emissiveTexture.texture=this.getTexture(t.emissiveTexture.index)),t.emissiveFactor||(t.emissiveFactor=t.emmisiveTexture?[1,1,1]:[0,0,0]),t.pbrMetallicRoughness){t.pbrMetallicRoughness=_i({},t.pbrMetallicRoughness);var r=t.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture=_i({},r.baseColorTexture),r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture=_i({},r.metallicRoughnessTexture),r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return t}},{key:"_resolveAccessor",value:function(t,e){if(t.id=t.id||"accessor-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView)),t.bytesPerComponent=xi[t.componentType],t.components=bi[t.type],t.bytesPerElement=t.bytesPerComponent*t.components,t.bufferView){var r=t.bufferView.buffer,n=Ne(t,t.bufferView),i=n.ArrayType,a=(t.bufferView.byteOffset||0)+(t.byteOffset||0)+r.byteOffset,o=r.arrayBuffer.slice(a,a+n.byteLength);t.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(r,a,t.bufferView.byteStride,t.bytesPerElement,t.count)),t.value=new i(o)}return t}},{key:"_getValueFromInterleavedBuffer",value:function(t,e,r,n,i){for(var a=new Uint8Array(i*n),o=0;o<i;o++){var s=e+o*r;a.set(new Uint8Array(t.arrayBuffer.slice(s,s+n)),o*n)}return a.buffer}},{key:"_resolveTexture",value:function(t,e){return t.id=t.id||"texture-".concat(e),t.sampler="sampler"in t?this.getSampler(t.sampler):Mi,t.source=this.getImage(t.source),t}},{key:"_resolveSampler",value:function(t,e){for(var r in t.id=t.id||"sampler-".concat(e),t.parameters={},t){var n=this._enumSamplerParameter(r);void 0!==n&&(t.parameters[n]=t[r])}return t}},{key:"_enumSamplerParameter",value:function(t){return wi[t]}},{key:"_resolveImage",value:function(t,e){t.id=t.id||"image-".concat(e),void 0!==t.bufferView&&(t.bufferView=this.getBufferView(t.bufferView));var r=this.images[e];return r&&(t.image=r),t}},{key:"_resolveBufferView",value:function(t,e){var r=t.buffer,n=_i(_i({id:"bufferView-".concat(e)},t),{},{buffer:this.buffers[r]}),i=this.buffers[r].byteOffset||0;return"byteOffset"in t&&(i+=t.byteOffset),n.data=new Uint8Array(this.buffers[r].arrayBuffer,i,t.byteLength),n}},{key:"_resolveCamera",value:function(t,e){return t.id=t.id||"camera-".concat(e),t}}]),t}();function Ei(t,e){return(new Ai).postProcess(t,e)}var Si=r(101);function Ti(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}function Ci(t,e,r){Object(Si.a)(t.header.byteLength>20);var n=e.getUint32(r+0,!0),i=e.getUint32(r+4,!0);return r+=8,Object(Si.a)(0===i),Pi(t,e,r,n),(r+=n)+Li(t,e,r,t.header.byteLength)}function Oi(t,e,r,n){return Object(Si.a)(t.header.byteLength>20),function(t,e,r,n){for(;r+8<=t.header.byteLength;){var i=e.getUint32(r+0,!0),a=e.getUint32(r+4,!0);switch(r+=8,a){case 1313821514:Pi(t,e,r,i);break;case 5130562:Li(t,e,r,i);break;case 0:n.strict||Pi(t,e,r,i);break;case 1:n.strict||Li(t,e,r,i)}r+=Object(Pe.b)(i,4)}}(t,e,r,n),r+t.header.byteLength}function Pi(t,e,r,n){var i=new Uint8Array(e.buffer,r,n),a=new TextDecoder("utf8").decode(i);return t.json=JSON.parse(a),Object(Pe.b)(n,4)}function Li(t,e,r,n){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:e.buffer}),Object(Pe.b)(n,4)}function Ii(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ki(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ki(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ki(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ri(t,e){return Di.apply(this,arguments)}function Di(){return(Di=d()(E.a.mark((function t(e,r){var n,i,a,o,s,u,l,c,h,f=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=f.length>4?f[4]:void 0,Bi(e,r,f.length>2&&void 0!==f[2]?f[2]:0,n=f.length>3?f[3]:void 0),gi(e,{normalize:null==n||null===(a=n.gltf)||void 0===a?void 0:a.normalize}),oi(e,n,i),l=[],null==n||null===(o=n.gltf)||void 0===o||!o.loadBuffers||!e.json.buffers){t.next=10;break}return t.next=10,Fi(e,n,i);case 10:return null!=n&&null!==(s=n.gltf)&&void 0!==s&&s.loadImages&&(c=Ni(e,n,i),l.push(c)),h=si(e,n,i),l.push(h),t.next=15,Promise.all(l);case 15:return t.abrupt("return",null!=n&&null!==(u=n.gltf)&&void 0!==u&&u.postProcess?Ei(e,n):e);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Bi(t,e,r,n){if(n.uri&&(t.baseUri=n.uri),e instanceof ArrayBuffer&&!function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=new DataView(t),i=r.magic,a=void 0===i?1735152710:i,o=n.getUint32(e,!1);return o===a||1735152710===o}(e,r,n)&&(e=(new TextDecoder).decode(e)),"string"==typeof e)t.json=Object(Me.a)(e);else if(e instanceof ArrayBuffer){var i={};r=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(e),i=Ti(n,r+0),a=n.getUint32(r+4,!0),o=n.getUint32(r+8,!0);switch(Object.assign(t,{header:{byteOffset:r,byteLength:o,hasBinChunk:!1},type:i,version:a,json:{},binChunks:[]}),r+=12,t.version){case 1:return Ci(t,n,r);case 2:return Oi(t,n,r,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}(i,e,r,n.glb),Ee("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),t._glb=i,t.json=i.json}else Ee(!1,"GLTF: must be ArrayBuffer or string");if(t.buffers=new Array((t.json.buffers||[]).length).fill(null),t._glb&&t._glb.header.hasBinChunk){var a=t._glb.binChunks;t.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}t.images=new Array((t.json.images||[]).length).fill({})}function Fi(t,e,r){return ji.apply(this,arguments)}function ji(){return(ji=d()(E.a.mark((function t(e,r,n){var i,a,o,s,u,l,c,h;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=e.json.buffers||[],a=0;case 2:if(!(a<i.length)){t.next=19;break}if(!(o=i[a]).uri){t.next=16;break}return Ee(n.fetch),l=Se(o.uri,r),t.next=10,null==n||null===(s=n.fetch)||void 0===s?void 0:s.call(n,l);case 10:return c=t.sent,t.next=13,null==c||null===(u=c.arrayBuffer)||void 0===u?void 0:u.call(c);case 13:e.buffers[a]={arrayBuffer:h=t.sent,byteOffset:0,byteLength:h.byteLength},delete o.uri;case 16:++a,t.next=2;break;case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ni(t,e,r){return Ui.apply(this,arguments)}function Ui(){return(Ui=d()(E.a.mark((function t(e,r,n){var i,a,o,s,u,l;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=zi(e),a=e.json.images||[],o=[],s=Ii(i);try{for(s.s();!(u=s.n()).done;)o.push(Gi(e,a[l=u.value],l,r,n))}catch(t){s.e(t)}finally{s.f()}return t.next=7,Promise.all(o);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function zi(t){var e,r=new Set,n=Ii(t.json.textures||[]);try{for(n.s();!(e=n.n()).done;){var i=e.value;void 0!==i.source&&r.add(i.source)}}catch(t){n.e(t)}finally{n.f()}return Array.from(r).sort()}function Gi(t,e,r,n,i){return Vi.apply(this,arguments)}function Vi(){return(Vi=d()(E.a.mark((function t(e,r,n,i,a){var o,s,u,l,c,h,f;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.fetch,s=a.parse,!r.uri){t.next=9;break}return l=Se(r.uri,i),t.next=5,o(l);case 5:return c=t.sent,t.next=8,c.arrayBuffer();case 8:u=t.sent;case 9:return Number.isFinite(r.bufferView)&&(h=Te(e.json,e.buffers,r.bufferView),u=Object(Ae.c)(h.buffer,h.byteOffset,h.byteLength)),Ee(u,"glTF image has no data"),t.next=13,s(u,[we.a,xe],{mimeType:r.mimeType,basis:i.basis||{format:ye()}},a);case 13:(f=t.sent)&&f[0]&&(f={compressed:!0,mipmaps:!1,width:f[0].width,height:f[0].height,data:f}),e.images=e.images||[],e.images[n]=f;case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Hi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Wi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Hi(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Hi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var $i={name:"glTF",id:"gltf",module:"gltf",version:"3.1.5",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:function(t){return qi.apply(this,arguments)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function qi(){return(qi=d()(E.a.mark((function t(e){var r,n,i,a,o,s=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:{},n=s.length>2?s[2]:void 0,(r=Wi(Wi({},$i.options),r)).gltf=Wi(Wi({},$i.options.gltf),r.gltf),a=void 0===(i=r.byteOffset)?0:i,o={},t.next=8,Ri(o,e,a,r,n);case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Xi(){return(Xi=d()(E.a.mark((function t(e){var r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[],e.scenes.forEach((function(t){t.traverse((function(t){Object.values(t.model.getUniforms()).forEach((function(t){!1===t.loaded&&r.push(t)}))}))})),t.next=4,Ki((function(){return r.some((function(t){return!t.loaded}))}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ki(t){return Zi.apply(this,arguments)}function Zi(){return(Zi=d()(E.a.mark((function t(e){return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e()){t.next=5;break}return t.next=3,new Promise((function(t){return requestAnimationFrame(t)}));case 3:t.next=0;break;case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Yi=r(70);function Ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Qi=Math.PI/180,ta=new Float32Array(16),ea=new Float32Array(12);function ra(t,e,r){var n=e[0]*Qi,i=e[1]*Qi,a=e[2]*Qi,o=Math.sin(a),s=Math.sin(n),u=Math.sin(i),l=Math.cos(a),c=Math.cos(n),h=Math.cos(i),f=r[0],d=r[1],p=r[2];t[0]=f*h*c,t[1]=f*u*c,t[2]=f*-s,t[3]=d*(-u*l+h*s*o),t[4]=d*(h*l+u*s*o),t[5]=d*c*o,t[6]=p*(u*o+h*s*l),t[7]=p*(-h*o+u*s*l),t[8]=p*c*l}function na(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var ia={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update:function(t,e){var r=e.startRow,n=e.endRow,i=this.props,a=i.data,o=i.getOrientation,s=i.getScale,u=i.getTranslation,l=i.getTransformMatrix,c=Array.isArray(l),h=c&&16===l.length,f=Array.isArray(s),d=Array.isArray(o),p=Array.isArray(u),m=h||!c&&Boolean(l(a[0]));t.constant=m?h:d&&f&&p;var v=t.value;if(t.constant){var g;m?(ta.set(l),g=na(ta)):(ra(g=ea,o,s),g.set(u,9)),t.value=new Float32Array(g)}else{var y,_=r*t.size,b=Object(Yi.a)(a,r,n),x=b.objectInfo,w=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ji(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ji(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(b.iterable);try{for(w.s();!(y=w.n()).done;){var M=y.value;x.index++;var A=void 0;m?(ta.set(h?l:l(M,x)),A=na(ta)):(ra(A=ea,d?o:o(M,x),f?s:s(M,x)),A.set(p?u:u(M,x),9)),v[_++]=A[0],v[_++]=A[1],v[_++]=A[2],v[_++]=A[3],v[_++]=A[4],v[_++]=A[5],v[_++]=A[6],v[_++]=A[7],v[_++]=A[8],v[_++]=A[9],v[_++]=A[10],v[_++]=A[11]}}catch(t){w.e(t)}finally{w.f()}}}};function aa(t,e){return e===T.a.CARTESIAN||e===T.a.METER_OFFSETS||e===T.a.DEFAULT&&!t.isGeospatial}function oa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function sa(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?oa(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):oa(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ua=[255,255,255,255],la={scenegraph:{type:"object",value:null,async:!0},getScene:function(t){return t&&t.scenes?"object"===V()(t.scene)?t.scene:t.scenes[t.scene||0]:t},getAnimator:function(t){return t&&t.animator},_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:ua},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[$i]},ca=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){return m()(this,r),e.apply(this,arguments)}return g()(r,[{key:"getShaders",value:function(){var t=[L.a,k.a];return"pbr"===this.props._lighting&&t.push($),{vs:"#version 300 es\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform mat4 sceneModelMatrix;\nuniform bool composeModelMatrix;\nin vec4 POSITION;\n\n#ifdef HAS_UV\n  in vec2 TEXCOORD_0;\n#endif\n\n#ifdef MODULE_PBR\n  #ifdef HAS_NORMALS\n    in vec4 NORMAL;\n  #endif\n#endif\nout vec4 vColor;\n#ifndef MODULE_PBR\n  #ifdef HAS_UV\n    out vec2 vTEXCOORD_0;\n  #endif\n#endif\nvoid main(void) {\n  #if defined(HAS_UV) && !defined(MODULE_PBR)\n    vTEXCOORD_0 = TEXCOORD_0;\n    geometry.uv = vTEXCOORD_0;\n  #endif\n\n  geometry.worldPosition = instancePositions;\n  geometry.pickingColor = instancePickingColors;\n\n  vec3 normal = vec3(0.0, 0.0, 1.0);\n  #ifdef MODULE_PBR\n    #ifdef HAS_NORMALS\n      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;\n    #endif\n  #endif\n\n  float originalSize = project_size_to_pixel(sizeScale);\n  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);\n\n  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;\n  if(composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    geometry.normal = project_normal(normal);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);\n    geometry.normal = project_normal(normal);\n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = TEXCOORD_0;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\nuniform float opacity;\nin vec4 vColor;\n\nout vec4 fragmentColor;\n#ifndef MODULE_PBR\n  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n    in vec2 vTEXCOORD_0;\n    uniform sampler2D u_BaseColorSampler;\n  #endif\n#endif\n\nvoid main(void) {\n  #ifdef MODULE_PBR\n    fragmentColor = vColor * pbr_filterColor(vec4(0));\n    geometry.uv = pbr_vUV;\n  #else\n    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)\n      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);\n      geometry.uv = vTEXCOORD_0;\n    #else\n      fragmentColor = vColor;\n    #endif\n  #endif\n\n  fragmentColor.a *= opacity;\n  DECKGL_FILTER_COLOR(fragmentColor, geometry);\n}\n",modules:t}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:ua,transition:!0},instanceModelMatrix:ia})}},{key:"updateState",value:function(t){P()(M()(r.prototype),"updateState",this).call(this,t);var e=t.props,n=t.oldProps;e.scenegraph!==n.scenegraph?this._updateScenegraph(e):e._animations!==n._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,e._animations)}},{key:"finalizeState",value:function(){P()(M()(r.prototype),"finalizeState",this).call(this),this._deleteScenegraph()}},{key:"_updateScenegraph",value:function(t){var e=this,r=this.context.gl,n=null;if(t.scenegraph instanceof Y)n={scenes:[t.scenegraph]};else if(t.scenegraph&&!t.scenegraph.gltf){var i=t.scenegraph,a=function(t,e,r){var n=new Mt(t,r);return{scenes:n.instantiate(e),animator:n.createAnimator()}}(r,i,this._getModelOptions());n=sa({gltf:i},a),function(t){return Xi.apply(this,arguments)}(a).then((function(){return e.setNeedsRedraw()}))}else t.scenegraph&&(H.a.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),n=t.scenegraph);var o={layer:this,gl:r},s=t.getScene(n,o),u=t.getAnimator(n,o);s instanceof Y?(this._deleteScenegraph(),this._applyAllAttributes(s),this._applyAnimationsProp(s,u,t._animations),this.setState({scenegraph:s,animator:u})):null!==s&&H.a.warn("invalid scenegraph:",s)()}},{key:"_applyAllAttributes",value:function(t){var e=this;if(this.state.attributesAvailable){var r=this.getAttributeManager().getAttributes();t.traverse((function(t){e._setModelAttributes(t.model,r)}))}}},{key:"_applyAnimationsProp",value:function(t,e,r){if(t&&e&&r){var n=e.getAnimations();Object.keys(r).sort().forEach((function(t){var e=r[t];if("*"===t)n.forEach((function(t){Object.assign(t,e)}));else if(Number.isFinite(Number(t))){var i=Number(t);i>=0&&i<n.length?Object.assign(n[i],e):H.a.warn("animation ".concat(t," not found"))()}else{var a=n.find((function(e){return e.name===t}));a?Object.assign(a,e):H.a.warn("animation ".concat(t," not found"))()}}))}}},{key:"_deleteScenegraph",value:function(){var t=this.state.scenegraph;t instanceof Y&&t.delete()}},{key:"_getModelOptions",value:function(){var t=this.props._imageBasedLightingEnvironment,e=null;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:e,modelOptions:sa({isInstanced:!0,transpileToGLSL100:!Object(W.j)(this.context.gl)},this.getShaders()),useTangents:!1}}},{key:"updateAttributes",value:function(t){var e=this;this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse((function(r){e._setModelAttributes(r.model,t)}))}},{key:"draw",value:function(t){var e=t.moduleParameters,r=void 0===e?null:e,n=t.parameters,i=void 0===n?{}:n;if(this.state.scenegraph){this.props._animations&&this.state.animator&&(this.state.animator.animate(t.context.timeline.getTime()),this.setNeedsRedraw());var a=this.context.viewport,o=this.props,s=o.sizeScale,u=o.sizeMinPixels,l=o.sizeMaxPixels,c=o.opacity,h=o.coordinateSystem,f=this.getNumInstances();this.state.scenegraph.traverse((function(t,e){var n=e.worldMatrix;t.model.setInstanceCount(f),t.updateModuleSettings(r),t.draw({parameters:i,uniforms:{sizeScale:s,opacity:c,sizeMinPixels:u,sizeMaxPixels:l,composeModelMatrix:aa(a,h),sceneModelMatrix:n,u_Camera:t.model.getUniforms().project_uCameraPosition}})}))}}}]),r}(R.a);function ha(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function fa(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ha(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ha(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function da(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),H.a.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function pa(t,e){if(t.attributes)return da(t.attributes,e),t instanceof S.a?t:new S.a(t);if(t.positions||t.POSITION)return da(t,e),new S.a({attributes:t});throw Error("Invalid mesh")}ca.layerName="ScenegraphLayer",ca.defaultProps=la;var ma=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){return m()(this,r),e.apply(this,arguments)}return g()(r,[{key:"getShaders",value:function(){var t=!Object(W.j)(this.context.gl),e={};return Object(pt.b)(this.context.gl,mt.a.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),P()(M()(r.prototype),"getShaders",this).call(this,{vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n    geometry.position = position_commonspace;\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n    geometry.position = position_commonspace;\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n  }\n\n  geometry.normal = normals_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[L.a,I.b,k.a],transpileToGLSL100:t,defines:e})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:ia}),this.setState({emptyTexture:new vt.a(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}},{key:"updateState",value:function(t){var e=t.props,n=t.oldProps,i=t.changeFlags;if(P()(M()(r.prototype),"updateState",this).call(this,{props:e,oldProps:n,changeFlags:i}),e.mesh!==n.mesh||i.extensionsChanged){if(this.state.model&&this.state.model.delete(),e.mesh){this.state.model=this.getModel(e.mesh);var a=e.mesh.attributes||e.mesh;this.setState({hasNormals:Boolean(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==n.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}},{key:"finalizeState",value:function(){P()(M()(r.prototype),"finalizeState",this).call(this),this.state.emptyTexture.delete()}},{key:"draw",value:function(t){if(this.state.model){var e=this.context.viewport,r=this.props,n=r.sizeScale,i=r.coordinateSystem,a=r._instanced;this.state.model.setUniforms(t.uniforms).setUniforms({sizeScale:n,composeModelMatrix:!a||aa(e,i),flatShading:!this.state.hasNormals}).draw()}}},{key:"getModel",value:function(t){var e=new D.a(this.context.gl,fa(fa({},this.getShaders()),{},{id:this.props.id,geometry:pa(t,this.props._useMeshColors),isInstanced:!0})),r=this.props.texture;return e.setUniforms({sampler:r||this.state.emptyTexture,hasTexture:Boolean(r)}),e}},{key:"setTexture",value:function(t){var e=this.state,r=e.model;r&&r.setUniforms({sampler:t||e.emptyTexture,hasTexture:Boolean(t)})}}]),r}(R.a);function va(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ga(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?va(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):va(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}ma.layerName="SimpleMeshLayer",ma.defaultProps={mesh:{value:null,type:"object",async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:function(t){return t.position}},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]}};var ya=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){return m()(this,r),e.apply(this,arguments)}return g()(r,[{key:"getShaders",value:function(){var t=P()(M()(r.prototype),"getShaders",this).call(this);return t.modules.push($),ga(ga({},t),{},{vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool u_pickFeatureIds;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvec2 applyUVRegion(vec2 uv) {\n  #ifdef HAS_UV_REGIONS\n    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n  #else\n    return uv;\n  #endif\n}\n\nvoid main(void) {\n  vec2 uv = applyUVRegion(texCoords);\n  geometry.uv = uv;\n\n  if (u_pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  geometry.normal = normals_commonspace;\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  #ifdef MODULE_PBR\n    pbr_vPosition = geometry.position.xyz;\n    #ifdef HAS_NORMALS\n      pbr_vNormal = geometry.normal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"})}},{key:"initializeState",value:function(){var t=this.props.featureIds;P()(M()(r.prototype),"initializeState",this).call(this),t&&this.state.attributeManager.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}},{key:"updateState",value:function(t){var e=t.props,n=t.oldProps,i=t.changeFlags;P()(M()(r.prototype),"updateState",this).call(this,{props:e,oldProps:n,changeFlags:i}),e.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(e.pbrMaterial)}},{key:"draw",value:function(t){var e=this.props.featureIds;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,u_pickFeatureIds:Boolean(e)}),P()(M()(r.prototype),"draw",this).call(this,t))}},{key:"getModel",value:function(t){var e,r=this.props,n=r.id,i=this.parseMaterial(r.pbrMaterial,t),a=this.getShaders();return(e=t.attributes).COLOR_0||e.colors||(e.colors={constant:!0,value:new Float32Array([1,1,1])}),new D.a(this.context.gl,ga(ga({},this.getShaders()),{},{id:n,geometry:t,defines:ga(ga(ga({},a.defines),null==i?void 0:i.defines),{},{HAS_UV_REGIONS:t.attributes.uvRegions}),parameters:null==i?void 0:i.parameters,isInstanced:!0}))}},{key:"updatePbrMaterialUniforms",value:function(t){var e=this.state.model;if(e){var r=this.parseMaterial(t,this.props.mesh);e.setUniforms(r.uniforms)}}},{key:"parseMaterial",value:function(t,e){var r=Boolean(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return new _t(this.context.gl,{attributes:{NORMAL:e.attributes.normals,TEXCOORD_0:e.attributes.texCoords},material:ga({unlit:r},t),pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}},{key:"calculateFeatureIdsPickingColors",value:function(t){for(var e=this.props.featureIds,r=new Uint8ClampedArray(e.length*t.size),n=[],i=0;i<e.length;i++)this.encodePickingColor(e[i],n),r[3*i]=n[0],r[3*i+1]=n[1],r[3*i+2]=n[2];t.value=r}}]),r}(ma);ya.layerName="_MeshLayer",ya.defaultProps={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};var _a=r(194),ba=r(220),xa=r.n(ba),wa=r(221),Ma=r.n(wa),Aa=r(222),Ea=r.n(Aa),Sa=r(47),Ta=r(202),Ca=r(14),Oa=r(24),Pa=function(t){return t},La=new q.a;function Ia(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pa;return Object(Ca.f)(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function ka(t){return Ia(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:La,Ca.b._cartographicRadians?Pa:Ca.j)}function Ra(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pa;return Object(Ca.f)(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}(t,e,Ca.b._cartographicRadians?Pa:Ca.i)}var Da=new q.a,Ba=new q.a,Fa=new q.a,ja=new q.a,Na={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Ua={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},za={east:new q.a,north:new q.a,up:new q.a,west:new q.a,south:new q.a,down:new q.a},Ga=new q.a,Va=new q.a,Ha=new q.a;function Wa(t,e,r,n,i,a){var o,s,u,l=Na[e]&&Na[e][r];Object(Sa.a)(l&&(!n||n===l));var c=ja.copy(i);if(Object(Ca.d)(c.x,0,1e-14)&&Object(Ca.d)(c.y,0,1e-14)){var h=Math.sign(c.z);o=Ga.fromArray(Ua[e]),"east"!==e&&"west"!==e&&o.scale(h),s=Va.fromArray(Ua[r]),"east"!==r&&"west"!==r&&s.scale(h),u=Ha.fromArray(Ua[n]),"east"!==n&&"west"!==n&&u.scale(h)}else{var f=za.up,d=za.east,p=za.north;d.set(-c.y,c.x,0).normalize(),t.geodeticSurfaceNormal(c,f),p.copy(f).cross(d);var m=za.west,v=za.south;za.down.copy(f).scale(-1),m.copy(d).scale(-1),v.copy(p).scale(-1),o=za[e],s=za[r],u=za[n]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=s.x,a[5]=s.y,a[6]=s.z,a[7]=0,a[8]=u.x,a[9]=u.y,a[10]=u.z,a[11]=0,a[12]=c.x,a[13]=c.y,a[14]=c.z,a[15]=1,a}var $a,qa=new q.a,Xa=new q.a,Ka=new q.a,Za=new q.a,Ya=new q.a,Ja=new q.a,Qa=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ma()(this,t),Object(Sa.a)(e>=0),Object(Sa.a)(r>=0),Object(Sa.a)(n>=0),this.radii=new q.a(e,r,n),this.radiiSquared=new q.a(e*e,r*r,n*n),this.radiiToTheFourth=new q.a(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new q.a(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new q.a(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=Ta.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Ea()(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Xa,n=Ka,i=xa()(t,3)[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var a=Math.sqrt(r.dot(n));return n.scale(1/a),r.scale(i),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Ja.from(t);var r=this.scaleToGeodeticSurface(Ja,Za);if(r){var n=this.geodeticSurfaceNormal(r,Xa),i=Ya;return i.copy(Ja).subtract(r),Ra([Math.atan2(n.y,n.x),Math.asin(n.z),Math.sign(Oa.e(i,Ja))*Oa.h(i)],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){return Wa(this,"east","north","up",t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new X.a)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){return Wa(this,t,e,r,n,arguments.length>4&&void 0!==arguments[4]?arguments[4]:new X.a)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return qa.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=ka(t),n=r[0],i=r[1],a=Math.cos(i);return qa.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),qa.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return qa.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new q.a,n=e.oneOverRadii,i=e.oneOverRadiiSquared,a=e.centerToleranceSquared;Da.from(t);var o=t.x,s=t.y,u=t.z,l=n.x,c=n.y,h=n.z,f=o*o*l*l,d=s*s*c*c,p=u*u*h*h,m=f+d+p,v=Math.sqrt(1/m);if(Number.isFinite(v)){var g=Ba;if(g.copy(t).scale(v),m<a)return g.to(r);var y=i.x,_=i.y,b=i.z,x=Fa;x.set(g.x*y*2,g.y*_*2,g.z*b*2);var w,M,A,E,S=(1-v)*t.len()/(.5*x.len()),T=0;do{var C=(w=1/(1+(S-=T)*y))*w,O=(M=1/(1+S*_))*M,P=(A=1/(1+S*b))*A;T=(E=f*C+d*O+p*P-1)/(-2*(f*(C*w)*y+d*(O*M)*_+p*(P*A)*b))}while(Math.abs(E)>Ta.a.EPSILON12);return Da.scale([w,M,A]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Za.from(t);var r=Za.x,n=Za.y,i=Za.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return Za.multiplyScalar(o).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Za.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Za.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(Sa.a)(Object(Ca.d)(this.radii.x,this.radii.y,Ta.a.EPSILON15)),Object(Sa.a)(this.radii.z>0),Za.from(t);var n=Za.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return Za.set(0,0,n).to(r)}}],[{key:"WGS84",get:function(){return $a=$a||new t(6378137,6378137,6356752.314245179)}}]),t}(),to=r(92),eo=r(21),ro=r(199),no=function t(e,r,n){m()(this,t),Object(Ce.a)(this,"item",void 0),Object(Ce.a)(this,"previous",void 0),Object(Ce.a)(this,"next",void 0),this.item=e,this.previous=r,this.next=n},io=function(){function t(){m()(this,t),Object(Ce.a)(this,"head",null),Object(Ce.a)(this,"tail",null),Object(Ce.a)(this,"_length",0)}return g()(t,[{key:"length",get:function(){return this._length}},{key:"add",value:function(t){var e=new no(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}},{key:"remove",value:function(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}},{key:"splice",value:function(t,e){t!==e&&(this.remove(e),this._insert(t,e))}},{key:"_insert",value:function(t,e){var r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}}]),t}();function ao(t){return null!=t}var oo=function(){function t(){m()(this,t),Object(Ce.a)(this,"_list",void 0),Object(Ce.a)(this,"_sentinel",void 0),Object(Ce.a)(this,"_trimTiles",void 0),this._list=new io,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return g()(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(t){var e=t._cacheNode;ao(e)&&this._list.splice(this._sentinel,e)}},{key:"add",value:function(t,e,r){ao(e._cacheNode)||(e._cacheNode=this._list.add(e),r&&r(t,e))}},{key:"unloadTile",value:function(t,e,r){var n=e._cacheNode;ao(n)&&(this._list.remove(n),e._cacheNode=void 0,r&&r(t,e))}},{key:"unloadTiles",value:function(t,e){var r=this._trimTiles;this._trimTiles=!1;for(var n=1024*t.maximumMemoryUsage*1024,i=this._sentinel,a=this._list.head;a!==i&&(t.gpuMemoryUsageInBytes>n||r);){var o=a.item;a=a.next,this.unloadTile(t,o,e)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}(),so=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),uo=r(57),lo=r.n(uo),co=r(58),ho=r.n(co),fo=(new q.a,new q.a,r(20)),po=new q.a,mo=new q.a,vo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;lo()(this,t),this.radius=-0,this.center=new q.a,this.fromCenterRadius(e,r)}return ho()(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=po.from(e),this.center=(new q.a).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.radius,i=po.copy(t.center).subtract(e),a=i.magnitude();if(r>=a+n)return this.clone();if(n>=a+r)return t.clone();var o=.5*(r+a+n);return mo.copy(i).scale((-r+o)/a).add(e),this.center.copy(mo),this.radius=o,this}},{key:"expand",value:function(t){var e=(t=po.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"transform",value:function(t){this.center.transform(t);var e=fo.e(po,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){var e=this.distanceTo(t);return e*e}},{key:"distanceTo",value:function(t){var e=(t=po.from(t)).subtract(this.center);return Math.max(0,e.len()-this.radius)}},{key:"intersectPlane",value:function(t){var e=this.radius,r=t.normal.dot(this.center)+t.distance;return r<-e?so.OUTSIDE:r<e?so.INTERSECTING:so.INSIDE}}]),t}(),go=r(104),yo=r.n(go),_o=r(203),bo=new q.a,xo=new q.a,wo=new q.a,Mo=new q.a,Ao=new q.a,Eo=new q.a,So=new q.a,To=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];lo()(this,t),this.center=(new q.a).from(e),this.halfAxes=new _o.a(r)}return ho()(t,[{key:"halfSize",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new q.a(t).len(),new q.a(e).len(),new q.a(r).len()]}},{key:"quaternion",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new q.a(t).normalize(),i=new q.a(e).normalize(),a=new q.a(r).normalize();return(new at.a).fromMatrix3(new _o.a([].concat(yo()(n),yo()(i),yo()(a))))}},{key:"fromCenterHalfSizeQuaternion",value:function(t,e,r){var n=new at.a(r),i=(new _o.a).fromQuaternion(n);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],this.center=(new q.a).from(t),this.halfAxes=i,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new vo,e=this.halfAxes,r=e.getColumn(0,wo),n=e.getColumn(1,Mo),i=e.getColumn(2,Ao),a=bo.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=a.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,a=r.y,o=r.z,s=Math.abs(i*n[0]+a*n[1]+o*n[2])+Math.abs(i*n[3]+a*n[4]+o*n[5])+Math.abs(i*n[6]+a*n[7]+o*n[8]),u=r.dot(e)+t.distance;return u<=-s?so.OUTSIDE:u>=s?so.INSIDE:so.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=xo.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,wo),i=r.getColumn(1,Mo),a=r.getColumn(2,Ao),o=n.magnitude(),s=i.magnitude(),u=a.magnitude();n.normalize(),i.normalize(),a.normalize();var l,c=0;return(l=Math.abs(e.dot(n))-o)>0&&(c+=l*l),(l=Math.abs(e.dot(i))-s)>0&&(c+=l*l),(l=Math.abs(e.dot(a))-u)>0&&(c+=l*l),c}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=this.center,o=this.halfAxes,s=o.getColumn(0,wo),u=o.getColumn(1,Mo),l=o.getColumn(2,Ao),c=Eo.copy(s).add(u).add(l).add(a),h=So.copy(c).subtract(t),f=e.dot(h);return n=Math.min(f,n),i=Math.max(f,i),c.copy(a).add(s).add(u).subtract(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),c.copy(a).add(s).subtract(u).add(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),c.copy(a).add(s).subtract(u).subtract(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),a.copy(c).subtract(s).add(u).add(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),a.copy(c).subtract(s).add(u).subtract(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),a.copy(c).subtract(s).subtract(u).add(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),a.copy(c).subtract(s).subtract(u).subtract(l),h.copy(c).subtract(t),f=e.dot(h),n=Math.min(f,n),i=Math.max(f,i),r[0]=n,r[1]=i,r}},{key:"transform",value:function(t){this.center.transformAsPoint(t);var e=this.halfAxes.getColumn(0,wo);e.transformAsPoint(t);var r=this.halfAxes.getColumn(1,Mo);r.transformAsPoint(t);var n=this.halfAxes.getColumn(2,Ao);return n.transformAsPoint(t),this.halfAxes=new _o.a([].concat(yo()(e),yo()(r),yo()(n))),this}},{key:"getTransform",value:function(){throw new Error("not implemented")}}]),t}(),Co=new q.a,Oo=new q.a,Po=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;lo()(this,t),this.normal=new q.a,this.distance=-0,this.fromNormalDistance(e,r)}return ho()(t,[{key:"fromNormalDistance",value:function(t,e){return Object(Sa.a)(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=Co.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),Object(Sa.a)(Object(Ca.d)(this.normal.len(),1)),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return Object(Ca.d)(this.distance,t.distance)&&Object(Ca.d)(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=Oo.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=Co.from(t);var r=this.getPointDistance(t),n=Oo.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}();function Lo(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Io(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Io(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Io(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var ko=[new q.a([1,0,0]),new q.a([0,1,0]),new q.a([0,0,1])],Ro=new q.a,Do=new q.a,Bo=(new Po(new q.a(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];lo()(this,t),this.planes=e,Object(Sa.a)(this.planes.every((function(t){return t instanceof Po})))}return ho()(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*ko.length;var e,r=t.center,n=t.radius,i=0,a=Lo(ko);try{for(a.s();!(e=a.n()).done;){var o=e.value,s=this.planes[i],u=this.planes[i+1];s||(s=this.planes[i]=new Po),u||(u=this.planes[i+1]=new Po);var l=Ro.copy(o).scale(-n).add(r);o.dot(l),s.fromPointNormal(l,o);var c=Ro.copy(o).scale(n).add(r),h=Do.copy(o).negate();h.dot(c),u.fromPointNormal(c,h),i+=2}}catch(t){a.e(t)}finally{a.f()}return this}},{key:"computeVisibility",value:function(t){Object(Sa.a)(t);var e,r=so.INSIDE,n=Lo(this.planes);try{for(n.s();!(e=n.n()).done;)switch(t.intersectPlane(e.value)){case so.OUTSIDE:return so.OUTSIDE;case so.INTERSECTING:r=so.INTERSECTING}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(Object(Sa.a)(e,"boundingVolume is required."),Object(Sa.a)(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,a=0;a<this.planes.length;++a){var o=a<31?1<<a:0;if(!(a<31&&0==(r&o))){var s=e.intersectPlane(i[a]);if(s===so.OUTSIDE)return t.MASK_OUTSIDE;s===so.INTERSECTING&&(n|=o)}}return n}}],[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),t}());r(161),new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new q.a,new _o.a,new _o.a,new _o.a,new _o.a,new _o.a,new q.a,new q.a,new q.a,new q.a,new q.a,new _o.a,new _o.a,new _o.a;var Fo=new q.a,jo=new q.a,No=new Bo([new Po,new Po,new Po,new Po,new Po,new Po]);function Uo(t,e){var r=t.cameraDirection,n=t.cameraUp,i=t.height,a=t.distanceScales.metersPerUnit,o=t.unprojectPosition(t.center),s=Qa.WGS84.cartographicToCartesian(o,new q.a),u=Qa.WGS84.eastNorthUpToFixedFrame(s),l=t.unprojectPosition(t.cameraPosition),c=Qa.WGS84.cartographicToCartesian(l,new q.a),h=new q.a(u.transformAsVector(new q.a(r).scale(a))).normalize(),f=new q.a(u.transformAsVector(new q.a(n).scale(a))).normalize();return function(t,e){var r=t.getFrustumPlanes(),n=0;for(var i in r){var a=r[i],o=a.normal.dot(t.center);jo.copy(a.normal).scale(a.distance-o).add(t.center);var s=t.unprojectPosition(jo),u=Qa.WGS84.cartographicToCartesian(s,new q.a);No.planes[n++].fromPointNormal(u,Fo.copy(e).subtract(u))}}(t,s),{camera:{position:c,direction:h,up:f},viewport:t,height:i,cullingVolume:No,frameNumber:e,sseDenominator:1.15}}var zo=new q.a,Go="scenegraph",Vo="pointcloud",Ho="I3S",Wo="TILES3D",$o="geometricError";function qo(t){return null!=t}var Xo=new q.a,Ko=new q.a,Zo=new q.a;function Yo(t,e,r){if(Object(Si.a)(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){var n=new q.a(t[0],t[1],t[2]);e.transform(n,n);var i=[];if(10===t.length){var a=t.slice(3,6),o=new at.a;o.fromArray(t,6);var s=new q.a([1,0,0]),u=new q.a([0,1,0]),l=new q.a([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),u.transformByQuaternion(o),u.scale(a[1]),l.transformByQuaternion(o),l.scale(a[2]),i=[].concat(et()(s.toArray()),et()(u.toArray()),et()(l.toArray()))}else i=[].concat(et()(t.slice(3,6)),et()(t.slice(6,9)),et()(t.slice(9,12)));var c=e.transformAsVector(i.slice(0,3)),h=e.transformAsVector(i.slice(3,6)),f=e.transformAsVector(i.slice(6,9)),d=new _o.a([c[0],c[1],c[2],h[0],h[1],h[2],f[0],f[1],f[2]]);return qo(r)?(r.center=n,r.halfAxes=d,r):new To(n,d)}(t.box,e,r);if(t.region){var n=Et()(t.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],c=Qa.WGS84.cartographicToCartesian([Object(Ca.c)(i),Object(Ca.c)(s),u],Ko),h=Qa.WGS84.cartographicToCartesian([Object(Ca.c)(o),Object(Ca.c)(a),l],Zo),f=(new q.a).addVectors(c,h).multiplyScalar(.5),d=(new q.a).subVectors(c,h).len()/2;return Jo([f[0],f[1],f[2],d],new X.a)}if(t.sphere)return Jo(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Jo(t,e,r){var n=new q.a(t[0],t[1],t[2]);e.transform(n,n);var i=e.getScale(Xo),a=Math.max(Math.max(i[0],i[1]),i[2]),o=t[3]*a;return qo(r)?(r.center=n,r.radius=o,r):new vo(n,o)}function Qo(t,e){var r=e.viewport,n=new r.constructor({longitude:r.longitude,latitude:r.latitude,height:r.height,width:r.width,bearing:r.bearing,zoom:r.zoom,pitch:0}),i=t.header.mbs[1],a=t.header.mbs[0],o=t.header.mbs[2],s=t.header.mbs[3],u=et()(t.boundingVolume.center),l=n.unprojectPosition(n.cameraPosition),c=Qa.WGS84.cartographicToCartesian(l,new q.a),h=new q.a(c).subtract(u).normalize(),f=new X.a;Qa.WGS84.eastNorthUpToFixedFrame(u,f);var d=new X.a(f).invert(),p=new q.a(c).transform(d),m=Math.sqrt(p[0]*p[0]+p[1]*p[1]),v=new q.a([p[0],p[1],m*m/p[2]]).transform(f),g=new q.a(v).subtract(u).normalize(),y=h.cross(g).normalize().scale(s),_=new q.a(u).add(y),b=Qa.WGS84.cartesianToCartographic(_),x=n.project([a,i,o]),w=n.project(b);return new q.a(x).subtract(w).magnitude()}new q.a,new q.a,new X.a,new q.a,new q.a,new q.a;var ts=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;m()(this,t),Object(Ce.a)(this,"_map",new Map),Object(Ce.a)(this,"_array",void 0),Object(Ce.a)(this,"_length",void 0),this._array=new Array(e),this._length=e}return g()(t,[{key:"length",get:function(){return this._length},set:function(t){this._length=t,t>this._array.length&&(this._array.length=t)}},{key:"values",get:function(){return this._array}},{key:"get",value:function(t){return Object(Si.a)(t<this._array.length),this._array[t]}},{key:"set",value:function(t,e){Object(Si.a)(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}},{key:"delete",value:function(t){var e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(t){if(!this._map.has(t)){var e=this.length++;this._array[e]=t,this._map.set(t,e)}}},{key:"pop",value:function(){var t=this._array[--this.length];return this._map.delete(t),t}},{key:"reserve",value:function(t){Object(Si.a)(t>=0),t>this._array.length&&(this._array.length=t)}},{key:"resize",value:function(t){Object(Si.a)(t>=0),this.length=t}},{key:"trim",value:function(t){null==t&&(t=this.length),this._array.length=t}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(t){return this._map.has(t)}}]),t}();function es(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return rs(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?rs(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function rs(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ns(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function is(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ns(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ns(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var as={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""},os=function(){function t(e){m()(this,t),Object(Ce.a)(this,"options",void 0),Object(Ce.a)(this,"root",void 0),Object(Ce.a)(this,"requestedTiles",void 0),Object(Ce.a)(this,"selectedTiles",void 0),Object(Ce.a)(this,"emptyTiles",void 0),Object(Ce.a)(this,"_traversalStack",void 0),Object(Ce.a)(this,"_emptyTraversalStack",void 0),Object(Ce.a)(this,"_frameNumber",void 0),this.options=is(is({},as),e),this._traversalStack=new ts,this._emptyTraversalStack=new ts,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return g()(t,[{key:"traverse",value:function(t,e,r){this.root=t,this.options=is(is({},this.options),r),this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(t,e){var r=this._traversalStack;for(t._selectionDepth=1,r.push(t);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,e)&&(this.updateChildTiles(n,e),i=this.updateAndPushChildren(n,e,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));var a=n.parent,o=Boolean(!a||a._shouldRefine),s=!i;n.hasRenderContent?1===n.refine?(this.loadTile(n,e),this.selectTile(n,e)):2===n.refine&&(this.loadTile(n,e),s&&this.selectTile(n,e)):(this.emptyTiles[n.id]=n,this.loadTile(n,e),s&&this.selectTile(n,e)),this.touchTile(n,e),n._shouldRefine=i&&o}this.options.onTraversalEnd(e)}},{key:"updateChildTiles",value:function(t,e){var r,n=es(t.children);try{for(n.s();!(r=n.n()).done;)this.updateTile(r.value,e)}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"updateAndPushChildren",value:function(t,e,r,n){var i=this.options,a=i.loadSiblings,o=i.skipLevelOfDetail,s=t.children;s.sort(this.compareDistanceToCamera.bind(this));var u,l=2===t.refine&&t.hasRenderContent&&!o,c=!1,h=!0,f=es(s);try{for(f.s();!(u=f.n()).done;){var d,p=u.value;if(p._selectionDepth=n,p.isVisibleAndInRequestVolume?(r.find(p)&&r.delete(p),r.push(p),c=!0):(l||a)&&(this.loadTile(p,e),this.touchTile(p,e)),l)if(d=!!p._inRequestVolume&&(p.hasRenderContent?p.contentAvailable:this.executeEmptyTraversal(p,e)),!(h=h&&d))return!1}}catch(t){f.e(t)}finally{f.f()}return c||(h=!1),h}},{key:"updateTile",value:function(t,e){this.updateTileVisibility(t,e)}},{key:"selectTile",value:function(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}},{key:"loadTile",value:function(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}},{key:"touchTile",value:function(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}},{key:"canTraverse",value:function(t,e){return!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:!!(arguments.length>3&&void 0!==arguments[3]&&arguments[3]||t.isVisibleAndInRequestVolume)&&this.shouldRefine(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]))}},{key:"shouldLoadTile",value:function(t){return t.hasUnloadedContent||t.contentExpired}},{key:"shouldSelectTile",value:function(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(t,e,r){var n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(t,e){var r=[];if(this.options.viewportTraversersMap)for(var n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===e.viewport.id&&r.push(n);else r.push(e.viewport.id);t.updateVisibility(e,r)}},{key:"compareDistanceToCamera",value:function(t,e){return t._distanceToCamera-e._distanceToCamera}},{key:"anyChildrenVisible",value:function(t,e){var r,n=!1,i=es(t.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.updateVisibility(e),n=n||a.isVisibleAndInRequestVolume}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"executeEmptyTraversal",value:function(t,e){var r=!0,n=this._emptyTraversalStack;for(n.push(t);n.length>0&&r;){var i=n.pop();if(this.updateTile(i,e),i.isVisibleAndInRequestVolume||this.loadTile(i,e),this.touchTile(i,e),!i.hasRenderContent&&this.canTraverse(i,e,!1,!0)){var a,o=es(i.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;n.find(s)&&n.delete(s),n.push(s)}}catch(t){o.e(t)}finally{o.f()}}else i.contentAvailable||(r=!1)}return r}}]),t}();function ss(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function us(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ss(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ss(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ls=new q.a,cs=function(){function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";m()(this,t),Object(Ce.a)(this,"tileset",void 0),Object(Ce.a)(this,"header",void 0),Object(Ce.a)(this,"id",void 0),Object(Ce.a)(this,"url",void 0),Object(Ce.a)(this,"parent",void 0),Object(Ce.a)(this,"refine",void 0),Object(Ce.a)(this,"type",void 0),Object(Ce.a)(this,"contentUrl",void 0),Object(Ce.a)(this,"lodMetricType",void 0),Object(Ce.a)(this,"lodMetricValue",void 0),Object(Ce.a)(this,"boundingVolume",void 0),Object(Ce.a)(this,"content",void 0),Object(Ce.a)(this,"contentState",void 0),Object(Ce.a)(this,"gpuMemoryUsageInBytes",void 0),Object(Ce.a)(this,"children",void 0),Object(Ce.a)(this,"depth",void 0),Object(Ce.a)(this,"viewportIds",void 0),Object(Ce.a)(this,"transform",void 0),Object(Ce.a)(this,"extensions",void 0),Object(Ce.a)(this,"userData",void 0),Object(Ce.a)(this,"computedTransform",void 0),Object(Ce.a)(this,"hasEmptyContent",void 0),Object(Ce.a)(this,"hasTilesetContent",void 0),Object(Ce.a)(this,"traverser",void 0),Object(Ce.a)(this,"_cacheNode",void 0),Object(Ce.a)(this,"_frameNumber",void 0),Object(Ce.a)(this,"_lodJudge",void 0),Object(Ce.a)(this,"_expireDate",void 0),Object(Ce.a)(this,"_expiredContent",void 0),Object(Ce.a)(this,"_shouldRefine",void 0),Object(Ce.a)(this,"_distanceToCamera",void 0),Object(Ce.a)(this,"_centerZDepth",void 0),Object(Ce.a)(this,"_screenSpaceError",void 0),Object(Ce.a)(this,"_visibilityPlaneMask",void 0),Object(Ce.a)(this,"_visible",void 0),Object(Ce.a)(this,"_inRequestVolume",void 0),Object(Ce.a)(this,"_stackLength",void 0),Object(Ce.a)(this,"_selectionDepth",void 0),Object(Ce.a)(this,"_touchedFrame",void 0),Object(Ce.a)(this,"_visitedFrame",void 0),Object(Ce.a)(this,"_selectedFrame",void 0),Object(Ce.a)(this,"_requestedFrame",void 0),Object(Ce.a)(this,"_priority",void 0),Object(Ce.a)(this,"_contentBoundingVolume",void 0),Object(Ce.a)(this,"_viewerRequestVolume",void 0),Object(Ce.a)(this,"_initialTransform",void 0),this.header=r,this.tileset=e,this.id=i||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=0,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this.extensions=null,this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new os({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new X.a,this.transform=new X.a,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}var e;return g()(t,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return 3===this.contentState||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return 0===this.contentState}},{key:"contentExpired",get:function(){return 4===this.contentState}},{key:"contentFailed",get:function(){return 5===this.contentState}},{key:"getScreenSpaceError",value:function(t,e){switch(this.tileset.type){case Ho:return Qo(this,t);case Wo:return function(t,e,r){var n=t.tileset,i=r&&t.parent&&t.parent.lodMetricValue||t.lodMetricValue;if(0===i)return 0;var a=Math.max(t._distanceToCamera,1e-7);return i*e.height*(n.options.viewDistanceScale||1)/(a*e.sseDenominator)-function(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){var r=t.dynamicScreenSpaceErrorFactor;return function(t,e){var r=t*e;return 1-Math.exp(-r*r)}(e,t.dynamicScreenSpaceErrorComputedDensity)*r}return 0}(n,a)}(this,t,e);default:throw new Error("Unsupported tileset type")}}},{key:"_getPriority",value:function(){var t=this.tileset._traverser,e=1===this.refine||t.options.skipLevelOfDetail;if(e&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(0===this.contentState)return-1;var r=this.parent;return Math.max((t.root?t.root._screenSpaceError:0)-(!r||e&&0!==this._screenSpaceError&&!r.hasTilesetContent?this._screenSpaceError:r._screenSpaceError),0)}},{key:"loadContent",value:(e=d()(E.a.mark((function t(){var e,r,n,i;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.hasEmptyContent){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.content){t.next=4;break}return t.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=1,t.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(e=t.sent){t.next=13;break}return this.contentState=0,t.abrupt("return",!1);case 13:return t.prev=13,r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,i=us(us({},this.tileset.loadOptions),{},h()({},n.id,us(us({},this.tileset.loadOptions[n.id]),{},{isTileset:"json"===this.type},this._getLoaderSpecificOptions(n.id)))),t.next=19,Object(_a.a)(r,n,i);case 19:if(this.content=t.sent,!this.tileset.options.contentLoader){t.next=23;break}return t.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=3,this._onContentLoaded(),t.abrupt("return",!0);case 29:throw t.prev=29,t.t0=t.catch(13),this.contentState=5,t.t0;case 33:return t.prev=33,e.done(),t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[13,29,33,36]])}))),function(){return e.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=0,!0}},{key:"updateVisibility",value:function(t,e){if(this._frameNumber!==t.frameNumber){var r=this.parent,n=r?r._visibilityPlaneMask:Bo.MASK_INDETERMINATE;this.tileset._traverser.options.updateTransforms&&this._updateTransform(r?r.computedTransform:this.tileset.modelMatrix),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Bo.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}}},{key:"visibility",value:function(t,e){return t.cullingVolume.computeVisibilityWithPlaneMask(this.boundingVolume,e)}},{key:"contentVisibility",value:function(){return!0}},{key:"distanceToTile",value:function(t){return Math.sqrt(Math.max(this.boundingVolume.distanceSquaredTo(t.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(t){var e=t.camera;return ls.subVectors(this.boundingVolume.center,e.position),e.direction.dot(ls)}},{key:"insideViewerRequestVolume",value:function(t){var e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=4,this._expiredContent=this.content)}}},{key:"extras",get:function(){return this.header.extras}},{key:"_initializeLodMetric",value:function(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(t){this.transform=t.transform?new X.a(t.transform):new X.a;var e=this.parent,r=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new X.a(n).multiplyRight(this.transform);var i=e&&e._initialTransform?e._initialTransform.clone():new X.a;this._initialTransform=new X.a(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}},{key:"_initializeContent",value:function(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=0,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Bo.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(t){return t||this.parent&&this.parent.refine||2}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(t){this.boundingVolume=Yo(t.boundingVolume,this.computedTransform,this.boundingVolume);var e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Yo(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Yo(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new X.a).clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}},{key:"_getLoaderSpecificOptions",value:function(t){return"i3s"===t?us(us({},this.tileset.options.i3s),{},{tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1}):{assetGltfUpAxis:(e=this.tileset.tileset).asset&&e.asset.gltfUpAxis||"Y"};var e}}]),t}(),hs=function(t){_()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(r);function r(){return m()(this,r),e.apply(this,arguments)}return g()(r,[{key:"compareDistanceToCamera",value:function(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}},{key:"updateTileVisibility",value:function(t,e){if(P()(M()(r.prototype),"updateTileVisibility",this).call(this,t,e),t.isVisibleAndInRequestVolume){var n=t.children.length>0;if(t.hasTilesetContent&&n){var i=t.children[0];return this.updateTileVisibility(i,e),void(t._visible=i._visible)}(this.meetsScreenSpaceErrorEarly(t,e)||2===t.refine&&1===t._optimChildrenWithinParent&&n&&!this.anyChildrenVisible(t,e))&&(t._visible=!1)}}},{key:"meetsScreenSpaceErrorEarly",value:function(t,e){var r=t.parent;return!(!r||r.hasTilesetContent||1!==r.refine||this.shouldRefine(t,e,!0))}}]),r}(os),fs=function(){function t(){m()(this,t),Object(Ce.a)(this,"_statusMap",void 0),this._statusMap={}}return g()(t,[{key:"add",value:function(t,e,r,n){var i=this;this._statusMap[e]||(this._statusMap[e]={request:t,callback:r,key:e,frameState:n,status:"REQUESTED"},t().then((function(t){i._statusMap[e].status="COMPLETED",i._statusMap[e].callback(t,n)})).catch((function(t){i._statusMap[e].status="ERROR",r(t)})))}},{key:"update",value:function(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}},{key:"find",value:function(t){return this._statusMap[t]}}]),t}();function ds(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ps(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ds(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ds(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ms(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var vs=function(t){_()(n,t);var e,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(n);function n(t){var e;return m()(this,n),e=r.call(this,t),Object(Ce.a)(kr()(e),"_tileManager",void 0),e._tileManager=new fs,e}return g()(n,[{key:"shouldRefine",value:function(t,e){return t._lodJudge=function(t,e){if(0===t.lodMetricValue||isNaN(t.lodMetricValue))return"DIG";var r=2*Qo(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}},{key:"updateChildTiles",value:function(t,e){var r,n=this,i=t.children,a=t.tileset,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ms(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ms(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t.header.children||[]);try{var s=function(){var o=r.value,s="".concat(o.id,"-").concat(e.viewport.id),u=i&&i.find((function(t){return t.id===s}));if(u)u&&n.updateTile(u,e);else{var l=function(){return n._loadTile(o.id,a)};n._tileManager.find(s)?n._tileManager.update(s,e):(a.tileset.nodePages&&(l=function(){return a.tileset.nodePagesTile.formTileFromNodePages(o.id)}),n._tileManager.add(l,s,(function(e){return n._onTileLoad(e,t,s)}),e))}};for(o.s();!(r=o.n()).done;)s()}catch(t){o.e(t)}finally{o.f()}return!1}},{key:"_loadTile",value:(e=d()(E.a.mark((function t(e,r){var n,i,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.loader,i=r.getTileUrl("".concat(r.url,"/nodes/").concat(e)),a=ps(ps({},r.loadOptions),{},{i3s:ps(ps({},r.loadOptions.i3s),{},{isTileHeader:!0,loadContent:!1})}),t.next=5,Object(_a.a)(i,n,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})},{key:"_onTileLoad",value:function(t,e,r){var n=new cs(e.tileset,t,e,r);e.children.push(n);var i=this._tileManager.find(n.id).frameState;this.updateTile(n,i),this._frameNumber===i.frameNumber&&this.executeTraversal(n,i)}}]),n}(os);function gs(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ys(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ys(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ys(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function bs(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_s(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var xs,ws={description:"",ellipsoid:Qa.WGS84,modelMatrix:new X.a,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(t){return t},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Ms=function(){function t(e,r){m()(this,t),Object(Ce.a)(this,"options",void 0),Object(Ce.a)(this,"loadOptions",void 0),Object(Ce.a)(this,"type",void 0),Object(Ce.a)(this,"tileset",void 0),Object(Ce.a)(this,"loader",void 0),Object(Ce.a)(this,"url",void 0),Object(Ce.a)(this,"basePath",void 0),Object(Ce.a)(this,"modelMatrix",void 0),Object(Ce.a)(this,"ellipsoid",void 0),Object(Ce.a)(this,"lodMetricType",void 0),Object(Ce.a)(this,"lodMetricValue",void 0),Object(Ce.a)(this,"refine",void 0),Object(Ce.a)(this,"root",void 0),Object(Ce.a)(this,"roots",void 0),Object(Ce.a)(this,"asset",void 0),Object(Ce.a)(this,"description",void 0),Object(Ce.a)(this,"properties",void 0),Object(Ce.a)(this,"extras",void 0),Object(Ce.a)(this,"attributions",void 0),Object(Ce.a)(this,"credits",void 0),Object(Ce.a)(this,"stats",void 0),Object(Ce.a)(this,"traverseCounter",void 0),Object(Ce.a)(this,"geometricError",void 0),Object(Ce.a)(this,"selectedTiles",void 0),Object(Ce.a)(this,"cartographicCenter",void 0),Object(Ce.a)(this,"cartesianCenter",void 0),Object(Ce.a)(this,"zoom",void 0),Object(Ce.a)(this,"boundingVolume",void 0),Object(Ce.a)(this,"gpuMemoryUsageInBytes",void 0),Object(Ce.a)(this,"dynamicScreenSpaceErrorComputedDensity",void 0),Object(Ce.a)(this,"_traverser",void 0),Object(Ce.a)(this,"_cache",void 0),Object(Ce.a)(this,"_requestScheduler",void 0),Object(Ce.a)(this,"_frameNumber",void 0),Object(Ce.a)(this,"_queryParamsString",void 0),Object(Ce.a)(this,"_queryParams",void 0),Object(Ce.a)(this,"_extensionsUsed",void 0),Object(Ce.a)(this,"_tiles",void 0),Object(Ce.a)(this,"_pendingCount",void 0),Object(Ce.a)(this,"lastUpdatedVieports",void 0),Object(Ce.a)(this,"_requestedTiles",void 0),Object(Ce.a)(this,"_emptyTiles",void 0),Object(Ce.a)(this,"frameStateData",void 0),Object(Ce.a)(this,"maximumMemoryUsage",void 0),Object(Si.a)(e),this.options=bs(bs({},ws),r),this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||eo.b.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new oo,this._requestScheduler=new ro.a({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new to.a({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(e)}var e;return g()(t,[{key:"destroy",value:function(){this._destroy()}},{key:"isLoaded",value:function(){return 0===this._pendingCount&&0!==this._frameNumber}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push("".concat(i,"=").concat(t[i]))}switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}},{key:"setProps",value:function(t){this.options=bs(bs({},this.options),t)}},{key:"setOptions",value:function(t){this.options=bs(bs({},this.options),t)}},{key:"getTileUrl",value:function(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}},{key:"hasExtension",value:function(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}},{key:"update",value:function(t){if((!("loadTiles"in this.options)||this.options.loadTiles)&&!(this.traverseCounter>0)){!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t instanceof Array||(t=[t]),this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;var e,r=[],n=gs(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.id;this._needTraverse(i)?r.push(i):this.traverseCounter--}}catch(t){n.e(t)}finally{n.f()}var a,o=gs(t);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=s.id;if(this.roots[u]||(this.roots[u]=this._initializeTileHeaders(this.tileset,null)),r.includes(u)){var l=Uo(s,this._frameNumber);this._traverser.traverse(this.roots[u],l,this.options)}}}catch(t){o.e(t)}finally{o.f()}}}},{key:"_needTraverse",value:function(t){var e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}},{key:"_onTraversalEnd",value:function(t){var e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var r=this.frameStateData[e],n=Object.values(this._traverser.selectedTiles);r.selectedTiles=n,r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}},{key:"_updateTiles",value:function(){for(var t in this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[],this.frameStateData){var e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);var r,n=gs(this.selectedTiles);try{for(n.s();!(r=n.n()).done;){var i=r.value;this._tiles[i.id]=i}}catch(t){n.e(t)}finally{n.f()}this._loadTiles(),this._unloadTiles(),this._updateStats()}},{key:"_tilesChanged",value:function(t,e){if(t.length!==e.length)return!0;var r=new Set(t.map((function(t){return t.id}))),n=new Set(e.map((function(t){return t.id})));return t.filter((function(t){return!n.has(t.id)})).length>0||e.filter((function(t){return!r.has(t.id)})).length>0}},{key:"_loadTiles",value:function(){var t,e=gs(this._requestedTiles);try{for(e.s();!(t=e.n()).done;){var r=t.value;r.contentUnloaded&&this._loadTile(r)}}catch(t){e.e(t)}finally{e.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(t,e){return t._unloadTile(e)}))}},{key:"_updateStats",value:function(){var t,e=0,r=0,n=gs(this.selectedTiles);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.contentAvailable&&i.content&&(e++,i.content.pointCount&&(r+=i.content.pointCount))}}catch(t){n.e(t)}finally{n.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=e,this.stats.get("Points").count=r}},{key:"_initializeTileSet",value:function(t){this.root=this._initializeTileHeaders(t,null),this.type===Wo&&this._initializeCesiumTileset(t),this.type===Ho&&this._initializeI3STileset(),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var t=this.root;Object(Si.a)(t);var e=t.boundingVolume.center;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new q.a,void(this.zoom=1);this.cartographicCenter=Qa.WGS84.cartesianToCartographic(e,new q.a),this.cartesianCenter=e,this.zoom=function(t){var e=t.halfAxes,r=t.radius,n=t.width,i=t.height;if(e){var a=function(t){t.getColumn(0,zo);var e=t.getColumn(1),r=t.getColumn(2);return zo.add(e).add(r).len()}(e);return Math.log2(6356752.314245179/a)}return r?Math.log2(6356752.314245179/r):i&&n?(Math.log2(6378137/n)+Math.log2(6378137/i))/2:1}(t.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(t,e){var r=new cs(this,t.root,e);if(e&&(e.children.push(r),r.depth=e.depth+1),this.type===Wo){var n=[];for(n.push(r);n.length>0;){var i=n.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var a,o=gs(i.header.children||[]);try{for(o.s();!(a=o.n()).done;){var s=new cs(this,a.value,i);i.children.push(s),s.depth=i.depth+1,n.push(s)}}catch(t){o.e(t)}finally{o.f()}}}return r}},{key:"_initializeTraverser",value:function(){var t;switch(this.type){case Wo:t=hs;break;case Ho:t=vs;break;default:t=os}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(t){this._destroySubtree(t)}},{key:"_loadTile",value:(e=d()(E.a.mark((function t(e){var r;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._onStartTileLoading(),t.next=4,e.loadContent();case 4:r=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this._onTileLoadError(e,t.t0);case 10:return t.prev=10,this._onEndTileLoading(),this._onTileLoad(e,r),t.finish(10);case 14:case"end":return t.stop()}}),t,this,[[0,7,10,14]])}))),function(t){return e.apply(this,arguments)})},{key:"_onTileLoadError",value:function(t,e){this.stats.get("Failed Tile Loads").incrementCount();var r=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,n)}},{key:"_onTileLoad",value:function(t,e){e&&(t&&t.content&&function(t,e){Object(Si.a)(t),Object(Si.a)(e);var r=e.rtcCenter,n=e.gltfUpAxis,i=t.boundingVolume.center,a=new X.a(t.computedTransform);switch(r&&a.translate(r),n){case"Z":break;case"Y":var o=(new X.a).rotateX(Math.PI/2);a=a.multiplyRight(o);break;case"X":var s=(new X.a).rotateY(-Math.PI/2);a=a.multiplyRight(s)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);var u=new q.a(i);e.cartesianModelMatrix=a,e.cartesianOrigin=u;var l=Qa.WGS84.cartesianToCartographic(u,new q.a),c=Qa.WGS84.eastNorthUpToFixedFrame(u).invert();e.cartographicModelMatrix=c.multiplyRight(a),e.cartographicOrigin=l,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(t){this._cache.add(this,t,(function(e){return e._updateCacheStats(t)}))}},{key:"_updateCacheStats",value:function(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(t){this.gpuMemoryUsageInBytes-=t.content&&t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}},{key:"_destroy",value:function(){var t=[];for(this.root&&t.push(this.root);t.length>0;){var e,r=t.pop(),n=gs(r.children);try{for(n.s();!(e=n.n()).done;)t.push(e.value)}catch(t){n.e(t)}finally{n.f()}this._destroyTile(r)}this.root=null}},{key:"_destroySubtree",value:function(t){var e=t,r=[];for(r.push(e);r.length>0;){var n,i=gs((t=r.pop()).children);try{for(i.s();!(n=i.n()).done;)r.push(n.value)}catch(t){i.e(t)}finally{i.f()}t!==e&&this._destroyTile(t)}e.children=[]}},{key:"_destroyTile",value:function(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}},{key:"_initializeCesiumTileset",value:function(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}},{key:"_initializeI3STileset",value:function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}]),t}(),As="cmpt",Es="pnts",Ss="b3dm",Ts="i3dm",Cs="glTF";function Os(t,e,r){Object(Si.a)(t instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(t,e,r);return n.decode(i)}function Ps(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(t);return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}var Ls=(xs={},h()(xs,5130,Float64Array),h()(xs,5126,Float32Array),h()(xs,5123,Uint16Array),h()(xs,5125,Uint32Array),h()(xs,5121,Uint8Array),h()(xs,5120,Int8Array),h()(xs,5122,Int16Array),h()(xs,5124,Int32Array),xs),Is={DOUBLE:5130,FLOAT:5126,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,UNSIGNED_BYTE:5121,BYTE:5120,SHORT:5122,INT:5124},ks=function(){function t(){m()(this,t)}return g()(t,null,[{key:"fromTypedArray",value:function(t){for(var e in t=ArrayBuffer.isView(t)?t.constructor:t,Ls)if(Ls[e]===t)return e;throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(t){var e=Is[t];if(!e)throw new Error("Failed to convert GL type");return e}},{key:"getArrayType",value:function(t){switch(t){case 33635:case 32819:case 32820:return Uint16Array;default:var e=Ls[t];if(!e)throw new Error("Failed to convert GL type");return e}}},{key:"getByteSize",value:function(e){return t.getArrayType(e).BYTES_PER_ELEMENT}},{key:"validate",value:function(e){return Boolean(t.getArrayType(e))}},{key:"createTypedArray",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return void 0===i&&(i=(r.byteLength-n)/t.getByteSize(e)),new(t.getArrayType(e))(r,n,i)}}]),t}(),Rs=function(){function t(e,r){m()(this,t),Object(Ce.a)(this,"json",void 0),Object(Ce.a)(this,"buffer",void 0),Object(Ce.a)(this,"featuresLength",0),Object(Ce.a)(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=r}return g()(t,[{key:"getExtension",value:function(t){return this.json.extensions&&this.json.extensions[t]}},{key:"hasProperty",value:function(t){return Boolean(this.json[t])}},{key:"getGlobalProperty",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5125,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[t];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(t,e,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(t,e,r){var n=this.json[t];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(e=ks.fromName(n.componentType)),this._getTypedArrayFromBinary(t,e,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(t,e,n)}},{key:"getProperty",value:function(t,e,r,n,i){var a=this.json[t];if(!a)return a;var o=this.getPropertyArray(t,e,r);if(1===r)return o[n];for(var s=0;s<r;++s)i[s]=o[r*n+s];return i}},{key:"_getTypedArrayFromBinary",value:function(t,e,r,n,i){var a=this._cachedTypedArrays,o=a[t];return o||(o=ks.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[t]=o),o}},{key:"_getTypedArrayFromArray",value:function(t,e,r){var n=this._cachedTypedArrays,i=n[t];return i||(i=ks.createTypedArray(e,r),n[t]=i),i}}]),t}(),Ds={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bs={SCALAR:function(t,e){return t[e]},VEC2:function(t,e){return[t[2*e+0],t[2*e+1]]},VEC3:function(t,e){return[t[3*e+0],t[3*e+1],t[3*e+2]]},VEC4:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT2:function(t,e){return[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]]},MAT3:function(t,e){return[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]]},MAT4:function(t,e){return[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]}},Fs={SCALAR:function(t,e,r){e[r]=t},VEC2:function(t,e,r){e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:function(t,e,r){e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:function(t,e,r){e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:function(t,e,r){e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:function(t,e,r){e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}},js=function(t){return void 0!==t};function Ns(t,e,r){if(!e)return null;var n=t.getExtension("3DTILES_batch_table_hierarchy"),i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(t,e){var r,n,i,a=t.instancesLength,o=t.classes,s=t.classIds,u=t.parentCounts,l=t.parentIds,c=a;if(js(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,5123),s.type=AttributeType.SCALAR,s=getBinaryAccessor(s).createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,a)),js(u))for(js(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,5123),u.type=AttributeType.SCALAR,u=getBinaryAccessor(u).createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,a)),i=new Uint16Array(a),c=0,r=0;r<a;++r)i[r]=c,c+=u[r];js(l)&&js(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,5123),l.type=AttributeType.SCALAR,l=getBinaryAccessor(l).createArrayBufferView(e.buffer,e.byteOffset+l.byteOffset,c));var h=o.length;for(r=0;r<h;++r){var f=o[r].instances,d=getBinaryProperties(o[r].length,f,e);o[r].instances=combine(d,f)}var p=new Array(h).fill(0),m=new Uint16Array(a);for(r=0;r<a;++r)m[r]=p[n=s[r]],++p[n];var v={classes:o,classIds:s,classIndexes:m,parentCounts:u,parentIndexes:i,parentIds:l};return function(t){for(var e=t.classIds.length,r=0;r<e;++r)zs(t,r,stack)}(v),v}(n,r):null}function Us(t,e,r){if(t){var n=t.parentCounts;return t.parentIds?r(t,e):n>0?function(t,e,r){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=scratchVisited;o.length=Math.max(o.length,t.classIds.length);var s=++marker,u=scratchStack;for(u.length=0,u.push(e);u.length>0;)if(o[e=u.pop()]!==s){o[e]=s;var l=r(t,e);if(js(l))return l;for(var c=n[e],h=a[e],f=0;f<c;++f){var d=i[h+f];d!==e&&u.push(d)}}return null}(t,e,r):function(t,e,r){for(var n=!0;n;){var i=r(t,e);if(js(i))return i;var a=t.parentIds[e];n=a!==e,e=a}throw new Error("traverseHierarchySingleParent")}(t,e,r)}}function zs(t,e,r){var n=t.parentCounts,i=t.parentIds,a=t.parentIndexes,o=t.classIds.length;if(js(i)){assert(e<o,"Parent index ".concat(e," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(e),"Circular dependency detected in the batch table hierarchy."),r.push(e);for(var s=js(n)?n[e]:1,u=js(n)?a[e]:e,l=0;l<s;++l){var c=i[u+l];c!==e&&zs(t,c,r)}r.pop(e)}}function Gs(t){return null!=t}var Vs=function(t,e){return t},Hs={HIERARCHY:!0,extensions:!0,extras:!0},Ws=function(){function t(e,r,n){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var o in m()(this,t),Object(Ce.a)(this,"json",void 0),Object(Ce.a)(this,"binary",void 0),Object(Ce.a)(this,"featureCount",void 0),Object(Ce.a)(this,"_extensions",void 0),Object(Ce.a)(this,"_properties",void 0),Object(Ce.a)(this,"_binaryProperties",void 0),Object(Ce.a)(this,"_hierarchy",void 0),Object(Si.a)(n>=0),this.json=e||{},this.binary=r,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={},this.json)Hs[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Ns(this,this.json,this.binary))}return g()(t,[{key:"getExtension",value:function(t){return this.json&&this.json.extensions&&this.json.extensions[t]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(t,e){return this._checkBatchId(t),Object(Si.a)("string"==typeof e,e),!!this._hierarchy&&Gs(Us(this._hierarchy,t,(function(t,r){return t.classes[t.classIds[r]].name===e})))}},{key:"isExactClass",value:function(t,e){return Object(Si.a)("string"==typeof e,e),this.getExactClassName(t)===e}},{key:"getExactClassName",value:function(t){if(this._checkBatchId(t),this._hierarchy)return this._hierarchy.classes[this._hierarchy.classIds[t]].name}},{key:"hasProperty",value:function(t,e){return this._checkBatchId(t),Object(Si.a)("string"==typeof e,e),Gs(this._properties[e])||this._hasPropertyInHierarchy(t,e)}},{key:"getPropertyNames",value:function(t,e){var r;this._checkBatchId(t),(e=Gs(e)?e:[]).length=0;var n=Object.keys(this._properties);return(r=e).push.apply(r,et()(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}},{key:"getProperty",value:function(t,e){if(this._checkBatchId(t),Object(Si.a)("string"==typeof e,e),this._binaryProperties){var r=this._binaryProperties[e];if(Gs(r))return this._getBinaryProperty(r,t)}var n=this._properties[e];if(Gs(n))return Vs(n[t]);if(this._hierarchy){var i=this._getHierarchyProperty(t,e);if(Gs(i))return i}}},{key:"setProperty",value:function(t,e,r){var n=this.featureCount;if(this._checkBatchId(t),Object(Si.a)("string"==typeof e,e),this._binaryProperties){var i=this._binaryProperties[e];if(i)return void this._setBinaryProperty(i,t,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,t,e,r)){var a=this._properties[e];Gs(a)||(this._properties[e]=new Array(n),a=this._properties[e]),a[t]=Vs(r)}}},{key:"_checkBatchId",value:function(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(t,e){return t.unpack(t.typedArray,e)}},{key:"_setBinaryProperty",value:function(t,e,r){t.pack(r,t.typedArray,e)}},{key:"_initializeBinaryProperties",value:function(){var t=null;for(var e in this._properties){var r=this._initializeBinaryProperty(e,this._properties[e]);r&&((t=t||{})[e]=r)}return t}},{key:"_initializeBinaryProperty",value:function(t,e){if("byteOffset"in e){var r=e;Object(Si.a)(this.binary,"Property ".concat(t," requires a batch table binary.")),Object(Si.a)(r.type,"Property ".concat(t," requires a type."));var n=function(t,e,r,n){var i=t.componentType;Object(Si.a)(t.componentType);var a="string"==typeof i?ks.fromName(i):i,o=Ds[t.type],s=Bs[t.type],u=Fs[t.type];return{values:ks.createTypedArray(a,e,r+=t.byteOffset,o*n),type:a,size:o,unpacker:s,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(t,e){if(!this._hierarchy)return!1;var r=Us(this._hierarchy,t,(function(t,r){return Gs(t.classes[t.classIds[r]].instances[e])}));return Gs(r)}},{key:"_getPropertyNamesInHierarchy",value:function(t,e){Us(this._hierarchy,t,(function(t,r){var n=t.classes[t.classIds[r]].instances;for(var i in n)n.hasOwnProperty(i)&&-1===e.indexOf(i)&&e.push(i)}))}},{key:"_getHierarchyProperty",value:function(t,e){var r=this;return Us(this._hierarchy,t,(function(t,n){var i=t.classIndexes[n],a=t.classes[t.classIds[n]].instances[e];return Gs(a)?Gs(a.typedArray)?r._getBinaryProperty(a,i):Vs(a[i]):null}))}},{key:"_setHierarchyProperty",value:function(t,e,r,n){var i=this,a=Us(this._hierarchy,e,(function(t,a){var o=t.classIndexes[a],s=t.classes[t.classIds[a]].instances[r];return!!Gs(s)&&(Object(Si.a)(a===e,'Inherited property "'.concat(r,'" is read-only.')),Gs(s.typedArray)?i._setBinaryProperty(s,o,n):s[o]=Vs(n),!0)}));return Gs(a)}}]),t}();function $s(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(e);if(t.magic=n.getUint32(r,!0),t.version=n.getUint32(r+=4,!0),t.byteLength=n.getUint32(r+=4,!0),r+=4,1!==t.version)throw new Error("3D Tile Version ".concat(t.version," not supported"));return r}function qs(t,e,r){var n,i=new DataView(e);t.header=t.header||{};var a=i.getUint32(r,!0),o=i.getUint32(r+=4,!0),s=i.getUint32(r+=4,!0),u=i.getUint32(r+=4,!0);return r+=4,s>=570425344?(r-=8,n=a,s=o,u=0,a=0,o=0,console.warn("b3dm tile in legacy format.")):u>=570425344&&(r-=4,n=s,s=a,u=o,a=0,o=0,console.warn("b3dm tile in legacy format.")),t.header.featureTableJsonByteLength=a,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=s,t.header.batchTableBinaryByteLength=u,t.header.batchLength=n,r}function Xs(t,e,r,n){return r=function(t,e,r,n){var i=t.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength;if(t.featureTableJson={BATCH_LENGTH:i.batchLength||0},a>0){var s=Os(e,r,a);t.featureTableJson=JSON.parse(s)}return r+=a,t.featureTableBinary=new Uint8Array(e,r,o),r+o}(t,e,r),function(t,e,r,n){var i=t.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=Os(e,r,a);t.batchTableJson=JSON.parse(s),r+=a,o>0&&(t.batchTableBinary=new Uint8Array(e,r,o),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=o)}return r}(t,e,r)}function Ks(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=t>>5&63,n=31&t;return e[0]=(t>>11&31)<<3,e[1]=r<<2,e[2]=n<<3,e}function Zs(t,e,r){if(!(e||t&&t.batchIds&&r))return null;var n=t.batchIds,i=t.isRGB565,a=t.pointCount;if(n&&r){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var u=r.getProperty(n[s],"dimensions").map((function(t){return 255*t}));o[3*s]=u[0],o[3*s+1]=u[1],o[3*s+2]=u[2]}return{type:5121,value:o,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),c=0;c<a;c++){var h=Ks(e[c]);l[3*c]=h[0],l[3*c+1]=h[1],l[3*c+2]=h[2]}return{type:5121,value:l,size:3,normalized:!0}}return e&&e.length===3*a?{type:5121,value:e,size:3,normalized:!0}:{type:5121,value:e,size:4,normalized:!0}}var Ys=r(204);function Js(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Object(Ca.a)(t,0,e)/e*2-1}function Qs(t){return t<0?-1:1}function tu(t,e,r){return function(t,e,r,n){if(function(t,e){if(!t)throw new Error("math.gl assertion failed. ".concat(void 0))}(n),t<0||t>r||e<0||e>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=Js(t,r),n.y=Js(e,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*Qs(i),n.y=(1-Math.abs(i))*Qs(n.y)}return n.normalize()}(t,e,255,r)}new Ys.a,new q.a,new Ys.a,new Ys.a;var eu=new q.a;function ru(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function nu(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ru(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ru(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function iu(t,e,r,n,i){return au.apply(this,arguments)}function au(){return(au=d()(E.a.mark((function t(e,r,n,i,a){var o,s,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=$s(e,r,n),n=qs(e,r,n),n=Xs(e,r,n),ou(e),o=su(e),s=o.featureTable,u=o.batchTable,t.next=7,hu(e,s,u,i,a);case 7:return uu(e,s,i),lu(e,s,u),cu(e,s),t.abrupt("return",n);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ou(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function su(t){var e=new Rs(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",5126,3);var n=function(t,e){var r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",5123,1),t.batchIds)){var n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");r=new Ws(t.batchTableJson,t.batchTableBinary,n)}return r}(t,e);return{featureTable:e,batchTable:n}}function uu(t,e,r){if(!t.attributes.positions)if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",5126,3);else if(e.hasProperty("POSITION_QUANTIZED")){var n=e.getPropertyArray("POSITION_QUANTIZED",5123,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=function(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,function(t,e){for(var r=new q.a,n=new Float32Array(3*t.pointCount),i=0;i<t.pointCount;i++)r.set(e[3*i],e[3*i+1],e[3*i+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(n,3*i);return n}(t,e)):{type:5123,value:e,size:3,normalized:!0}:e}(t,n,r)}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function lu(t,e,r){if(!t.attributes.colors){var n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",5121,4),t.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",5121,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",5123,1),t.isRGB565=!0),t.attributes.colors=Zs(t,n,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",5121,4))}function cu(t,e){if(!t.attributes.normals){var r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",5126,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",5121,2),t.isOctEncoded16P=!0),t.attributes.normals=function(t,e){if(!e)return null;if(t.isOctEncoded16P){for(var r=new Float32Array(3*t.pointsLength),n=0;n<t.pointsLength;n++)tu(e[2*n],e[2*n+1],eu),eu.toArray(r,3*n);return{type:5126,size:2,value:r}}return{type:5126,size:2,value:e}}(t,r)}}function hu(t,e,r,n,i){return fu.apply(this,arguments)}function fu(){return(fu=d()(E.a.mark((function t(e,r,n,i,a){var o,s,u,l,c,h,f,d;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"])&&(u=l.properties),!(c=r.getExtension("3DTILES_draco_point_compression"))){t.next=15;break}if(h=c.byteOffset,f=c.byteLength,(s=c.properties)&&Number.isFinite(h)&&f){t.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:o=e.featureTableBinary.slice(h,h+f),e.hasPositions=Number.isFinite(s.POSITION),e.hasColors=Number.isFinite(s.RGB)||Number.isFinite(s.RGBA),e.hasNormals=Number.isFinite(s.NORMAL),e.hasBatchIds=Number.isFinite(s.BATCH_ID),e.isTranslucent=Number.isFinite(s.RGBA);case 15:if(o){t.next=17;break}return t.abrupt("return",!0);case 17:return d={buffer:o,properties:nu(nu({},s),u),featureTableProperties:s,batchTableProperties:u,dequantizeInShader:!1},t.next=20,du(e,d,i,a);case 20:return t.abrupt("return",t.sent);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function du(t,e,r,n){return pu.apply(this,arguments)}function pu(){return(pu=d()(E.a.mark((function t(e,r,n,i){var a,o,s,u,l,c,h,f,d,p,m,v,g,y;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=i.parse,delete(o=nu(nu({},n),{},{draco:nu(nu({},n.draco),{},{extraAttributes:r.batchTableProperties||{}})}))["3d-tiles"],t.next=5,a(r.buffer,vn,o);case 5:if(l=(s=t.sent).attributes.COLOR_0&&s.attributes.COLOR_0.value,h=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,f=(c=s.attributes.NORMAL&&s.attributes.NORMAL.value)&&s.attributes.NORMAL.value.quantization,(u=s.attributes.POSITION&&s.attributes.POSITION.value)&&s.attributes.POSITION.value.quantization&&(e.quantizedVolumeScale=new q.a(p=(d=s.POSITION.data.quantization).range,p,p),e.quantizedVolumeOffset=new q.a(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0),f&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0),m={},r.batchTableProperties)for(v=0,g=Object.keys(r.batchTableProperties);v<g.length;v++)s.attributes[y=g[v]]&&s.attributes[y].value&&(m[y.toLowerCase()]=s.attributes[y].value);e.attributes=nu({positions:u,colors:Zs(e,l,void 0),normals:c,batchIds:h},m);case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mu(t,e,r,n){t.rotateYtoZ=!0;var i=t.byteOffset+t.byteLength-r;if(0===i)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=Object(Ae.c)(e,r,i),t.gltfByteOffset=0,t.gltfByteLength=i,r%4==0||console.warn("".concat(t.type,": embedded glb is not aligned to a 4-byte boundary.")),t.byteOffset+t.byteLength}function vu(t,e,r,n){return gu.apply(this,arguments)}function gu(){return(gu=d()(E.a.mark((function t(e,r,n,i){var a,o,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n["3d-tiles"]||{},yu(e,r),!a.loadGLTF){t.next=16;break}if(o=i.parse,s=i.fetch,!e.gltfUrl){t.next=9;break}return t.next=7,s(e.gltfUrl,n);case 7:e.gltfArrayBuffer=t.sent,e.gltfByteOffset=0;case 9:if(!e.gltfArrayBuffer){t.next=16;break}return t.next=12,o(e.gltfArrayBuffer,$i,n,i);case 12:e.gltf=t.sent,delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function yu(t,e,r){switch(e){case 0:var n=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),i=(new TextDecoder).decode(n);t.gltfUrl=i.replace(/[\s\0]+$/,""),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case 1:break;default:throw new Error("b3dm: Illegal glTF format field")}}function _u(t,e,r,n,i){return bu.apply(this,arguments)}function bu(){return(bu=d()(E.a.mark((function t(e,r,n,i,a){var o,s;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=xu(e,r,n,i),t.next=3,vu(e,1,i,a);case 3:return(s=null==e||null===(o=e.gltf)||void 0===o?void 0:o.extensions)&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xu(t,e,r,n,i){r=mu(t,e,r=Xs(t,e,r=qs(t,e,r=$s(t,e,r))),n);var a=new Rs(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=a.getGlobalProperty("RTC_CENTER",5126,3),r}function wu(t,e,r,n,i){return Mu.apply(this,arguments)}function Mu(){return(Mu=d()(E.a.mark((function t(e,r,n,i,a){return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Au(e,r,n,i),t.next=3,vu(e,e.gltfFormat,i,a);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Au(t,e,r,n,i){if(r=$s(t,e,r),1!==t.version)throw new Error("Instanced 3D Model version ".concat(t.version," is not supported"));r=qs(t,e,r);var a=new DataView(e);if(t.gltfFormat=a.getUint32(r,!0),r=mu(t,e,r=Xs(t,e,r+=4),n),0===t.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new Rs(t.featureTableJson,t.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");return t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",5126,3),new Ws(t.batchTableJson,t.batchTableBinary,s),function(t,e,r,n){for(var i=new Array(n),a=new q.a,o=(new q.a,new q.a,new q.a,new _o.a),s=new at.a,u=new q.a,l={},c=new X.a,h=[],f=[],d=new q.a,p=new q.a,m=0;m<n;m++){var v=void 0;if(e.hasProperty("POSITION"))v=e.getProperty("POSITION",5126,3,m,a);else if(e.hasProperty("POSITION_QUANTIZED")){v=e.getProperty("POSITION_QUANTIZED",5123,3,m,a);var g=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",5126,3,d);if(!g)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var y=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",5126,3,p);if(!y)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var _=0;_<3;_++)v[_]=v[_]/65535*y[_]+g[_]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(v),l.translation=a,t.normalUp=e.getProperty("NORMAL_UP",5126,3,m,h),t.normalRight=e.getProperty("NORMAL_RIGHT",5126,3,m,f),t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",5123,2,h),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",5123,2,f),t.octNormalUp){if(!t.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}t.eastNorthUp?(Qa.WGS84.eastNorthUpToFixedFrame(a,c),c.getRotationMatrix3(o)):o.identity()}s.fromMatrix3(o),l.rotation=s,u.set(1,1,1);var b=e.getProperty("SCALE",5126,1,m);Number.isFinite(b)&&u.multiplyByScalar(b);var x=e.getProperty("SCALE_NON_UNIFORM",5126,3,m,h);x&&u.scale(x),l.scale=u;var w=e.getProperty("BATCH_ID",5123,1,m);void 0===w&&(w=m);var M=(new X.a).fromQuaternion(l.rotation);c.identity(),c.translate(l.translation),c.multiplyRight(M),c.scale(l.scale);var A=c.clone();i[m]={modelMatrix:A,batchId:w}}t.instances=i}(t,o,0,s),r}function Eu(t,e,r,n,i,a){return Su.apply(this,arguments)}function Su(){return(Su=d()(E.a.mark((function t(e,r,n,i,a,o){var s,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=$s(e,r,n),s=new DataView(r),e.tilesLength=s.getUint32(n,!0),n+=4,e.tiles=[];case 5:if(!(e.tiles.length<e.tilesLength&&e.byteLength-n>12)){t.next=13;break}return e.tiles.push(u={}),t.next=10,o(r,n,i,a,u);case 10:n=t.sent,t.next=5;break;case 13:return t.abrupt("return",n);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Tu(t,e,r,n){return Cu.apply(this,arguments)}function Cu(){return(Cu=d()(E.a.mark((function t(e,r,n,i){var a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.rotateYtoZ=!0,e.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",a=i.parse,t.next=5,a(r,$i,n,i);case 5:e.gltf=t.sent;case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ou(t){return Pu.apply(this,arguments)}function Pu(){return(Pu=d()(E.a.mark((function t(e){var r,n,i,a,o=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=o.length>2?o[2]:void 0,i=o.length>3?o[3]:void 0,(a=o.length>4&&void 0!==o[4]?o[4]:{}).byteOffset=r=o.length>1&&void 0!==o[1]?o[1]:0,a.type=Ps(e,r),t.t0=a.type,t.next=t.t0===As?9:t.t0===Ss?12:t.t0===Cs?15:t.t0===Ts?18:t.t0===Es?21:24;break;case 9:return t.next=11,Eu(a,e,r,n,i,Ou);case 11:case 14:case 17:case 20:case 23:return t.abrupt("return",t.sent);case 12:return t.next=14,_u(a,e,r,n,i);case 15:return t.next=17,Tu(a,e,n,i);case 18:return t.next=20,wu(a,e,r,n,i);case 21:return t.next=23,iu(a,e,r,n,i);case 24:throw new Error("3DTileLoader: unknown type ".concat(a.type));case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Lu=r(98);function Iu(){return(Iu=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1952609651===new Uint32Array(e.slice(0,4))[0]){t.next=3;break}throw new Error("Wrong subtree file magic number");case 3:if(1===new Uint32Array(e.slice(4,8))[0]){t.next=6;break}throw new Error("Wrong subtree file verson, must be 1");case 6:if(r=Du(e.slice(8,16)),n=new Uint8Array(e,24,r),i=new TextDecoder("utf8"),a=i.decode(n),o=JSON.parse(a),s=Du(e.slice(16,24)),u=new ArrayBuffer(0),s&&(u=e.slice(24+r)),!("bufferView"in o.tileAvailability)){t.next=18;break}return t.next=17,ku(o,"tileAvailability",u);case 17:o.tileAvailability.explicitBitstream=t.sent;case 18:if(!("bufferView"in o.contentAvailability)){t.next=22;break}return t.next=21,ku(o,"contentAvailability",u);case 21:o.contentAvailability.explicitBitstream=t.sent;case 22:if(!("bufferView"in o.childSubtreeAvailability)){t.next=26;break}return t.next=25,ku(o,"childSubtreeAvailability",u);case 25:o.childSubtreeAvailability.explicitBitstream=t.sent;case 26:return t.abrupt("return",o);case 27:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ku(t,e,r){return Ru.apply(this,arguments)}function Ru(){return(Ru=d()(E.a.mark((function t(e,r,n){var i,a,o;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a=e.buffers[(i=e.bufferViews[e[r].bufferView]).buffer]).uri){t.next=11;break}return t.next=6,Object(Lu.a)(a.uri);case 6:return o=t.sent,t.next=9,o.arrayBuffer();case 9:return t.abrupt("return",new Uint8Array(t.sent,i.byteOffset,i.byteLength));case 11:return t.abrupt("return",new Uint8Array(n,i.byteOffset,i.byteLength));case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Du(t){var e=new DataView(t),r=e.getUint32(0,!0),n=e.getUint32(4,!0);return r+Math.pow(2,32)*n}var Bu={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:"3.1.5",extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:function(t){return Iu.apply(this,arguments)},options:{}},Fu={QUADTREE:4,OCTREE:8};function ju(t,e){return Nu.apply(this,arguments)}function Nu(){return(Nu=d()(E.a.mark((function t(e,r){var n,i,a,o,s,u,l,c,h,f,d,p,m,v,g,y,_,b,x,w,M,A,S,T,C,O,P,L,I,k,R,D,B=arguments;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=B.length>2&&void 0!==B[2]?B[2]:{mortonIndex:0,x:0,y:0,z:0},a=B.length>4&&void 0!==B[4]?B[4]:0,o=B.length>5&&void 0!==B[5]?B[5]:{level:0,mortonIndex:0,x:0,y:0,z:0},s=r.subtreeLevels,u=r.maximumLevel,l=r.contentUrlTemplate,c=r.subtreesUriTemplate,h=r.basePath,f={children:[],lodMetricValue:0,contentUrl:""},d=Fu[r.subdivisionScheme],p=1&(i=B.length>3&&void 0!==B[3]?B[3]:0),m=i>>1&1,v=i>>2&1,g=(Math.pow(d,a)-1)/(d-1),y=Gu(n.mortonIndex,i),_=g+y,b=Gu(n.x,p),x=Gu(n.y,m),w=Gu(n.z,v),M=!1,a+1>s&&(M=Uu(e.childSubtreeAvailability,y)),A=Gu(o.x,b),S=Gu(o.y,x),T=Gu(o.z,w),C=a+o.level,!M){t.next=40;break}return O="".concat(h,"/").concat(c),P=Vu(O,C,A,S,T),t.next=27,Object(_a.a)(P,Bu);case 27:e=t.sent,o.mortonIndex=y,o.x=b,o.y=x,o.z=w,o.level=a,y=0,_=0,b=0,x=0,w=0,a=0;case 40:if(Uu(e.tileAvailability,_)&&!(a>u)){t.next=43;break}return t.abrupt("return",f);case 43:Uu(e.contentAvailability,_)&&(f.contentUrl=Vu(l,C,A,S,T)),L=a+1,I={mortonIndex:y,x:b,y:x,z:w},k=0;case 48:if(!(k<d)){t.next=56;break}return t.next=51,ju(e,r,I,k,L,o);case 51:((R=t.sent).contentUrl||R.children.length)&&(D=zu(R,C+1,{childTileX:b,childTileY:x,childTileZ:w},r),f.children.push(D));case 53:k++,t.next=48;break;case 56:return t.abrupt("return",f);case 57:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Uu(t,e){return"constant"in t?Boolean(t.constant):!!t.explicitBitstream&&(r=e,1==(t.explicitBitstream[Math.floor(r/8)]>>r%8&1));var r}function zu(t,e,r,n){var i=n.refine,a=n.getRefine,o=n.lodMetricType,s=n.getTileType,u=n.rootLodMetricValue,l=n.rootBoundingVolume,c=t.contentUrl&&t.contentUrl.replace("".concat(n.basePath,"/"),""),h=u/Math.pow(2,e),f=function(t,e,r){if(e.region){var n=r.childTileX,i=r.childTileY,a=r.childTileZ,o=Et()(e.region,6),s=o[0],u=o[1],l=o[2],c=o[3],h=o[4],f=o[5],d=Math.pow(2,t),p=(l-s)/d,m=(c-u)/d,v=(f-h)/d;return{region:[s+p*n,u+m*i,s+p*(n+1),u+m*(i+1),h+v*a,h+v*(a+1)]}}return console.warn("Unsupported bounding volume type: ",e),null}(e,l,r);return{children:t.children,contentUrl:t.contentUrl,content:{uri:c},id:t.contentUrl,refine:a(i),type:s(t),lodMetricType:o,lodMetricValue:h,boundingVolume:f}}function Gu(t,e){return parseInt(t.toString(2)+e.toString(2),2)}function Vu(t,e,r,n,i){var a=function(t){var e={};for(var r in t)e["{".concat(r,"}")]=t[r];return e}({level:e,x:r,y:n,z:i});return t.replace(/{level}|{x}|{y}|{z}/gi,(function(t){return a[t]}))}function Hu(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Wu(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Wu(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Wu(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $u(t){if(!t.contentUrl)return"empty";var e=t.contentUrl.split(".").pop();switch(e){case"pnts":return Vo;case"i3dm":case"b3dm":case"glb":case"gltf":return Go;default:return e}}function qu(t){switch(t){case"REPLACE":case"replace":return 2;case"ADD":case"add":return 1;default:return t}}function Xu(t,e){if(!t)return null;if(t.content){var r=t.content.uri||t.content.url;t.contentUrl="".concat(e.basePath,"/").concat(r)}return t.id=t.contentUrl,t.lodMetricType=$o,t.lodMetricValue=t.geometricError,t.transformMatrix=t.transform,t.type=$u(t),t.refine=qu(t.refine),t}function Ku(t){var e=t.basePath,r=Xu(t.root,t),n=[];for(n.push(r);n.length>0;){var i,a=Hu((n.pop()||{}).children||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;Xu(o,{basePath:e}),n.push(o)}}catch(t){a.e(t)}finally{a.f()}}return r}function Zu(t){return Yu.apply(this,arguments)}function Yu(){return(Yu=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u,l,c,h,f;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.root){t.next=2;break}return t.abrupt("return",null);case 2:return r=e.basePath,i=(n=e.root.extensions["3DTILES_implicit_tiling"]).subdivisionScheme,a=n.maximumLevel,o=n.subtreeLevels,u=Vu(s=n.subtrees.uri,0,0,0,0),l="".concat(r,"/").concat(u),t.next=9,Object(_a.a)(l,Bu);case 9:return c=t.sent,h="".concat(r,"/").concat(e.root.content.uri),f={contentUrlTemplate:h,subtreesUriTemplate:s,subdivisionScheme:i,subtreeLevels:o,maximumLevel:a,refine:e.root.refine,basePath:r,lodMetricType:$o,rootLodMetricValue:e.root.geometricError,rootBoundingVolume:e.root.boundingVolume,getTileType:$u,getRefine:qu},t.next=17,Ju(e.root,c,f);case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Ju(t,e,r){return Qu.apply(this,arguments)}function Qu(){return(Qu=d()(E.a.mark((function t(e,r,n){var i,a,o;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",null);case 2:return e.lodMetricType=$o,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,t.next=7,ju(r,n);case 7:return a=(i=t.sent).children,(o=i.contentUrl)&&(e.contentUrl=o,e.content={uri:o.replace("".concat(n.basePath,"/"),"")}),e.refine=qu(e.refine),e.type=$u(e),e.children=a,e.id=e.contentUrl,t.abrupt("return",e);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var tl={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:"3.1.5",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:function(t,e,r){return ol.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function el(t){return eo.b.dirname(t.url)}function rl(t,e,r){return nl.apply(this,arguments)}function nl(){return(nl=d()(E.a.mark((function t(e,r,n){var i;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={content:{featureIds:null}},t.next=4,Ou(e,0,r,n,i.content);case 4:return t.abrupt("return",i.content);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function il(t,e,r){return al.apply(this,arguments)}function al(){return(al=d()(E.a.mark((function t(e,r,n){var i,a;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=JSON.parse((new TextDecoder).decode(e))).loader=r.loader||tl,a.url=n.url,a.basePath=el(a),!sl(a)){t.next=10;break}return t.next=7,Zu(a);case 7:t.t0=t.sent,t.next=11;break;case 10:t.t0=Ku(a);case 11:return a.root=t.t0,a.type=Wo,a.lodMetricType=$o,a.lodMetricValue=(null===(i=a.root)||void 0===i?void 0:i.lodMetricValue)||0,t.abrupt("return",a);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ol(){return(ol=d()(E.a.mark((function t(e,r,n){var i;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("auto"===(i=r["3d-tiles"]||{}).isTileset?n.url&&-1!==n.url.indexOf(".json"):i.isTileset)){t.next=8;break}return t.next=5,il(e,r,n);case 5:e=t.sent,t.next=11;break;case 8:return t.next=10,rl(e,r,n);case 10:e=t.sent;case 11:return t.abrupt("return",e);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function sl(t){var e,r;return(null==t||null===(e=t.extensionsRequired)||void 0===e?void 0:e.includes("3DTILES_implicit_tiling"))&&(null==t||null===(r=t.extensionsUsed)||void 0===r?void 0:r.includes("3DTILES_implicit_tiling"))}function ul(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ll(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ul(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ul(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var cl=[0],hl={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:tl,onTilesetLoad:{type:"function",value:function(t){},compare:!1},onTileLoad:{type:"function",value:function(t){},compare:!1},onTileUnload:{type:"function",value:function(t){},compare:!1},onTileError:{type:"function",value:function(t,e,r){},compare:!1},_getMeshColor:{type:"function",value:function(t){return[255,255,255]},compare:!1}},fl=function(t){_()(n,t);var e,r=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=M()(t);if(e){var i=M()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x()(this,r)}}(n);function n(){return m()(this,n),r.apply(this,arguments)}return g()(n,[{key:"initializeState",value:function(){"onTileLoadFail"in this.props&&H.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}},{key:"isLoaded",get:function(){var t=this.state.tileset3d;return t&&t.isLoaded()}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,r=t.changeFlags;if(e.data&&e.data!==t.oldProps.data&&this._loadTileset(e.data),r.viewportChanged){var n=this.state.activeViewports;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(r.propsChanged){var i=this.state.layerMap;for(var a in i)i[a].needsUpdate=!0}}},{key:"activateViewport",value:function(t){var e=this.state,r=e.activeViewports,n=e.lastUpdatedViewports;this.internalState.viewport=t,r[t.id]=t;var i=null==n?void 0:n[t.id];i&&t.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}},{key:"getPickingInfo",value:function(t){var e=t.info,r=t.sourceLayer,n=this.state.layerMap,i=r&&r.id;if(i){var a=i.substring(this.id.length+1),o=a.substring(a.indexOf("-")+1);e.object=n[o]&&n[o].tile}return e}},{key:"filterSubLayer",value:function(t){var e=t.layer.props.tile;return e.selected&&e.viewportIds.includes(t.viewport.id)}},{key:"_updateAutoHighlight",value:function(t){t.sourceLayer&&t.sourceLayer.updateAutoHighlight(t)}},{key:"_loadTileset",value:(e=d()(E.a.mark((function t(e){var r,n,i,a,o,s,u;return E.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0===(r=this.props.loadOptions)?{}:r,i=this.props.loader||this.props.loaders,Array.isArray(i)&&(i=i[0]),a={loadOptions:ll({},n)},!i.preload){t.next=10;break}return t.next=7,i.preload(e,n);case 7:(o=t.sent).headers&&(a.loadOptions.fetch=ll(ll({},a.loadOptions.fetch),{},{headers:o.headers})),Object.assign(a,o);case 10:return t.next=12,Object(_a.a)(e,i,a.loadOptions);case 12:s=t.sent,this.props.transform&&(s.root.transform=new X.a(s.root.transform).multiplyRight(this.props.transform)),u=new Ms(s,ll({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},a)),this.setState({tileset3d:u,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(u);case 18:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"_onTileLoad",value:function(t){var e=this.state.lastUpdatedViewports;this.props.onTileLoad(t),this._updateTileset(e),this.setNeedsUpdate()}},{key:"_onTileUnload",value:function(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}},{key:"_updateTileset",value:function(t){var e=this.state.tileset3d,r=this.context.timeline,n=Object.keys(t).length;if(r&&n&&e){var i=e.update(Object.values(t));this.state.frameNumber!==i&&this.setState({frameNumber:i})}}},{key:"_getSubLayer",value:function(t,e){if(!t.content)return null;switch(t.type){case Vo:return this._makePointCloudLayer(t,e);case Go:return this._make3DModelLayer(t,e);case"mesh":return this._makeSimpleMeshLayer(t,e);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(t.content.type))}}},{key:"_makePointCloudLayer",value:function(t,e){var r=t.content,n=r.attributes,i=r.constantRGBA,a=r.cartographicOrigin,o=r.modelMatrix,s=n.positions;if(!s)return null;var u=e&&e.props.data||{header:{vertexCount:r.pointCount},attributes:{POSITION:s,NORMAL:n.normals,COLOR_0:n.colors}},l=this.props,c=l.pointSize,h=l.getPointColor;return new(this.getSubLayerClass("pointcloud",z))({pointSize:c},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(t.id),tile:t,data:u,coordinateSystem:T.a.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:i||h,_offset:0})}},{key:"_make3DModelLayer",value:function(t){var e=t.content,r=e.gltf,n=e.instances,i=e.cartographicOrigin,a=e.modelMatrix;return new(this.getSubLayerClass("scenegraph",ca))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(t.id),tile:t,data:n||cl,scenegraph:r,coordinateSystem:T.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(t){return t.modelMatrix},getPosition:[0,0,0],_offset:0})}},{key:"_makeSimpleMeshLayer",value:function(t,e){var r=t.content,n=r.indices,i=r.modelMatrix,a=r.cartographicOrigin,o=r.coordinateSystem,s=void 0===o?T.a.METER_OFFSETS:o,u=r.material,l=r.featureIds,c=this.props._getMeshColor,h=e&&e.props.mesh||new S.a({drawMode:4,attributes:dl(r.attributes),indices:n});return new(this.getSubLayerClass("mesh",ya))(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(t.id),tile:t,mesh:h,data:cl,getColor:c(t),pbrMaterial:u,modelMatrix:i,coordinateOrigin:a,coordinateSystem:s,featureIds:l,_offset:0})}},{key:"renderLayers",value:function(){var t=this,e=this.state,r=e.tileset3d,n=e.layerMap;return r?r.tiles.map((function(e){var r=n[e.id]=n[e.id]||{tile:e},i=r.layer;return e.selected&&(i?r.needsUpdate&&(i=t._getSubLayer(e,i),r.needsUpdate=!1):i=t._getSubLayer(e)),r.layer=i,i})).filter(Boolean):null}}]),n}(C.a);function dl(t){var e={};return e.positions=ll(ll({},t.positions),{},{value:new Float32Array(t.positions.value)}),t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}fl.layerName="Tile3DLayer",fl.defaultProps=hl;var pl=r(137),ml=r(206),vl=r(87);function gl(t){var e=t.getCenter();return{longitude:e.lng,latitude:e.lat,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}}function yl(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=t.props.userData.mapboxVersion;return new vl.a(Object.assign({id:"mapbox",x:0,y:0,width:t.width,height:t.height,repeat:e.getRenderWorldCopies()},gl(e),r?{nearZMultiplier:1===n.major&&n.minor>=3||n.major>=2?.02:1/(t.height||1)}:{nearZMultiplier:.1}))}function _l(t){if(!t.props.userData.isExternal){var e=[],r=0;t.props.userData.mapboxLayers.forEach((function(t){var n=new t.props.type(t.props,{_offset:r++});e.push(n)})),t.setProps({layers:e})}}var bl=r(135),xl=r(97),wl=r(136),Ml=r(124),Al=function(){function t(e){if(m()(this,t),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e,!1===e.isAboveGround&&(this.isAboveGround=!1)}return g()(t,[{key:"onAdd",value:function(t,e){var r;this.map=t,this.deck=function(t){var e=t.map,r=t.gl,n=t.deck,i=t.lights;if(e.__deck)return e.__deck;var a=n&&n.props._customRender,o={useDevicePixels:!0,_customRender:function(){setTimeout((function(){e.triggerRepaint()}),0),a&&a()},parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774},userData:{isExternal:!1,mapboxLayers:new Set},views:n&&n.props.views||[new pl.a({id:"mapbox"})]};return n&&n.props.gl!==r||(Object.assign(o,{gl:r,width:!1,height:!1,touchAction:"unset",viewState:gl(e),lights:i}),e.on("move",(function(){return function(t,e){t.setProps({viewState:gl(e)}),t.needsRedraw({clearRedrawFlags:!0})}(n,e)}))),n?(n.setProps(o),n.props.userData.isExternal=!0):(n=new ml.a(o),e.on("remove",(function(){n.finalize(),e.__deck=null}))),n.props.userData.mapboxVersion=function(t){var e=0,r=0;if(t.version){var n=t.version.split(".").slice(0,2).map(Number),i=Et()(n,2);e=i[0],r=i[1]}return{major:e,minor:r}}(e),e.__deck=n,e.on("render",(function(){n.layerManager&&function(t,e){var r=t.props.userData;if(r.isExternal){var n=Array.from(r.mapboxLayers,(function(t){return t.id})),i=t.props.layers.some((function(t){return!n.includes(t.id)})),a=t.getViewports(),o=a.findIndex((function(t){return"mapbox"===t.id}));(i||a.length>1||o<0)&&(o>=0&&((a=a.slice())[o]=yl(t,e,!1)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:function(e){return(!t.props.layerFilter||t.props.layerFilter(e))&&("mapbox"!==e.viewport.id||!n.includes(e.layer.id))},clearCanvas:!1}))}t.props.userData.currentViewport=null}(n,e)})),n}({map:t,gl:e,deck:this.props.deck,lights:this.setLights(this.props.lights)}),(r=this.deck).props.userData.mapboxLayers.add(this),_l(r)}},{key:"setLights",value:function(t){var e;if(t&&t.length>0){var r=[];for(var n in t){var i=t[n];switch(i.type){case"ambient":r.push(new bl.a(i));break;case"directional":r.push(new xl.a(i));break;case"point":r.push(new wl.a(i))}}e=new Ml.a(r)}return e}},{key:"onRemove",value:function(){var t;(t=this.deck).props.userData.mapboxLayers.delete(this),_l(t)}},{key:"setProps",value:function(t){Object.assign(this.props,t,{id:this.id}),this.deck&&_l(this.deck)}},{key:"render",value:function(t,e){var r,n,i;n=this,(i=(r=this.deck).props.userData.currentViewport)||(i=yl(r,this.map,!0),r.props.userData.currentViewport=i),r.layerManager&&r._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:function(t){return n.id===t.layer.id},clearCanvas:!1})}}]),t}(),El=r(32),Sl=r.n(El),Tl=r(30),Cl=r.n(Tl),Ol="undefined"!=typeof window?El.useLayoutEffect:El.useEffect;function Pl(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}var Ll=r(67);function Il(t){return t?"function"==typeof t?Object(El.createElement)(Ll.a,{},t):Array.isArray(t)?t.map(Il):t.type===Sl.a.Fragment?Il(t.props.children):(Pl(t.type,Ll.a),t):t}var kl={position:"absolute",zIndex:-1};function Rl(t,e){return t?"function"==typeof t?t(e):Array.isArray(t)?t.map((function(t){return Rl(t,e)})):(i=(n=(r=t)&&r.type)&&n.defaultProps)&&i.mapStyle?(e.style=kl,Object(El.cloneElement)(t,e)):function(t){var e=t&&t.type;return e&&e.deckGLViewProps}(t)?Object(El.cloneElement)(t,e):t:t;var r,n,i}function Dl(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Bl={mixBlendMode:null};function Fl(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function jl(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Fl(Object(r),!0).forEach((function(e){h()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Fl(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Nl(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}var Ul=Object(El.forwardRef)((function(t,e){var r=Object(El.useRef)({}).current,n=Object(El.useState)(0),i=Et()(n,2),a=i[0];r.forceUpdate=i[1];var o=Object(El.useRef)(null),s=Object(El.useRef)(null),u=Object(El.useMemo)((function(){return function(t){var e=t.layers,r=t.views,n=[],i=[],a={};return Sl.a.Children.forEach(Il(t.children),(function(t){if(t){var e=t.type;if(Pl(e,R.a)){var r=function(t,e){var r={},n=t.defaultProps||{};for(var i in e)n[i]!==e[i]&&(r[i]=e[i]);return new t(r)}(e,t.props);i.push(r)}else n.push(t);if(e!==Ll.a&&Pl(e,Ll.a)&&t.props.id){var o=new e(t.props);a[o.id]=o}}})),Object.keys(a).length>0&&(Array.isArray(r)?r.forEach((function(t){a[t.id]=t})):r&&(a[r.id]=r),r=Object.values(a)),{layers:e=i.length>0?[].concat(i,et()(e)):e,children:n,views:r}}(t)}),[t.layers,t.views,t.children]),l=!0,c=function(e){return l&&t.viewState?(r.viewStateUpdateRequested=e,null):(r.viewStateUpdateRequested=null,t.onViewStateChange(e))},h=function(e){l?r.interactionStateUpdateRequested=e:(r.interactionStateUpdateRequested=null,t.onInteractionStateChange(e))},f=Object(El.useMemo)((function(){var e=jl(jl({},t),{},{style:null,width:"100%",height:"100%",layers:u.layers,views:u.views,onViewStateChange:c,onInteractionStateChange:h});return r.deck&&r.deck.setProps(e),e}),[t]);Object(El.useEffect)((function(){return r.deck=function(t,e){var r=new(e.Deck||ml.a)(jl(jl({},e),{},{style:null,width:"100%",height:"100%",_customRender:function(e){t.redrawReason=e;var n=r.viewManager.getViewports();t.lastRenderedViewports!==n?t.forceUpdate((function(t){return t+1})):Nl(t)}}));return r}(r,jl(jl({},f),{},{parent:o.current,canvas:s.current})),function(){return r.deck.finalize()}}),[]),Ol((function(){Nl(r);var t=r.viewStateUpdateRequested,e=r.interactionStateUpdateRequested;t&&c(t),e&&h(e)})),Object(El.useImperativeHandle)(e,(function(){return function(t){var e={pickObject:function(e){return t.deck.pickObject(e)},pickMultipleObjects:function(e){return t.deck.pickMultipleObjects(e)},pickObjects:function(e){return t.deck.pickObjects(e)}};return Object.defineProperty(e,"deck",{get:function(){return t.deck}}),e}(r)}),[]);var d=(r.deck||{}).viewManager,p=d&&d.getViewports(),m=t.ContextProvider,v=t.width,g=t.height,y=t.id,_=t.style,b=Object(El.useMemo)((function(){return function(t){var e=t.style,r={position:"absolute",zIndex:0,left:0,top:0,width:t.width,height:t.height},n={left:0,top:0};if(e)for(var i in e)i in Bl?n[i]=e[i]:r[i]=e[i];return{containerStyle:r,canvasStyle:n}}({width:v,height:g,style:_})}),[v,g,_]),x=b.containerStyle,w=b.canvasStyle;if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===p||r.version!==a){r.lastRenderedViewports=p,r.version=a;var M=function(t){var e=t.deck,r=t.ContextProvider,n=(e||{}).viewManager;if(!n||!n.views.length)return[];var i,a={},o=n.views[0].id,s=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Dl(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dl(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t.children);try{for(s.s();!(i=s.n()).done;){var u=i.value,l=o,c=u;Pl(u.type,Ll.a)&&(l=u.props.id||o,c=u.props.children);var h=n.getViewport(l),f=n.getViewState(l);h&&(c=Rl(c,{x:h.x,y:h.y,width:h.width,height:h.height,viewport:h,viewState:f}),a[l]||(a[l]={viewport:h,children:[]}),a[l].children.push(c))}}catch(t){s.e(t)}finally{s.f()}return Object.keys(a).map((function(t){var n=a[t],i=n.viewport,o=n.children,s={position:"absolute",left:i.x,top:i.y,width:i.width,height:i.height},u="view-".concat(t),l=El.createElement.apply(void 0,["div",{key:u,id:u,style:s}].concat(et()(o)));if(r){var c={viewport:i,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:function(r){r.viewId=t,e._onViewStateChange(r)}};return Object(El.createElement)(r,{key:u,value:c},l)}return l}))}({children:u.children,deck:r.deck,ContextProvider:m}),A=Object(El.createElement)("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:s,style:w});r.control=Object(El.createElement)("div",{id:"".concat(y||"deckgl","-wrapper"),ref:o,style:x},[A,M])}return l=!1,r.control}));Ul.propTypes=ml.a.getPropTypes(Cl.a),Ul.defaultProps=ml.a.defaultProps;var zl=Ul;r.d(e,"Tile3DLayer",(function(){return fl})),r.d(e,"SimpleMeshLayer",(function(){return ma})),r.d(e,"MapboxLayer",(function(){return Al})),r.d(e,"default",(function(){return zl})),r.d(e,"DeckGL",(function(){return zl}))},function(t,e,r){r.r(e);var n=r(162),i=r(294),a=r(178),o=r(290),s=r(8),u=r(176),l=r(276),c=r(180),h=r(211),f=r(38),d=r(293),p=r(79),m=r(103),v=r(115),g=r(212),y=r(213),_=r(289),b=r(68),x=r(0),w=r.n(x),M=r(1),A=r.n(M),E=r(6),S=r.n(E),T=r(9),C=r.n(T),O=r(5),P=r.n(O),L=r(60);function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var R={x:[2,0,1],y:[0,1,2],z:[1,2,0]},D=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("truncated-code-geometry"):n,a=B(t),o=a.indices,s=a.attributes;return e.call(this,k(k({},t),{},{id:i,indices:o,attributes:k(k({},s),t.attributes)}))}return r}(b.a);function B(t){for(var e=t.bottomRadius,r=void 0===e?0:e,n=t.topRadius,i=void 0===n?0:n,a=t.height,o=void 0===a?1:a,s=t.nradial,u=void 0===s?10:s,l=t.nvertical,c=void 0===l?10:l,h=t.verticalAxis,f=void 0===h?"y":h,d=t.topCap,p=void 0!==d&&d,m=t.bottomCap,v=void 0!==m&&m,g=(p?2:0)+(v?2:0),y=(u+1)*(c+1+g),_=Math.atan2(r-i,o),b=Math.sin,x=Math.cos,w=Math.PI,M=x(_),A=b(_),E=p?-2:0,S=c+(v?2:0),T=u+1,C=new Uint16Array(u*(c+g)*6),O=R[f],P=new Float32Array(3*y),L=new Float32Array(3*y),I=new Float32Array(2*y),k=0,D=0,B=E;B<=S;B++){var F=B/c,j=o*F,N=void 0;B<0?(j=0,F=1,N=r):B>c?(j=o,F=1,N=i):N=r+B/c*(i-r),-2!==B&&B!==c+2||(N=0,F=0),j-=o/2;for(var U=0;U<T;U++){var z=b(U*w*2/u),G=x(U*w*2/u);P[k+O[0]]=z*N,P[k+O[1]]=j,P[k+O[2]]=G*N,L[k+O[0]]=B<0||B>c?0:z*M,L[k+O[1]]=B<0?-1:B>c?1:A,L[k+O[2]]=B<0||B>c?0:G*M,I[D+0]=U/u,I[D+1]=F,D+=2,k+=3}}for(var V=0;V<c+g;V++)for(var H=0;H<u;H++){var W=6*(V*u+H);C[W+0]=T*(V+0)+0+H,C[W+1]=T*(V+0)+1+H,C[W+2]=T*(V+1)+1+H,C[W+3]=T*(V+0)+0+H,C[W+4]=T*(V+1)+1+H,C[W+5]=T*(V+1)+0+H}return{indices:C,attributes:{POSITION:{size:3,value:P},NORMAL:{size:3,value:L},TEXCOORD_0:{size:2,value:I}}}}function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function j(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var N=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("cone-geometry"):n,a=t.radius,o=void 0===a?1:a,s=t.cap,u=void 0===s||s;return e.call(this,j(j({},t),{},{id:i,topRadius:0,topCap:Boolean(u),bottomCap:Boolean(u),bottomRadius:o}))}return r}(D);function U(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function z(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?U(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var G=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),V=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),H=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),W=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),$={POSITION:{size:3,value:new Float32Array(V)},NORMAL:{size:3,value:new Float32Array(H)},TEXCOORD_0:{size:2,value:new Float32Array(W)}},q=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("cube-geometry"):n;return e.call(this,z(z({},t),{},{id:i,indices:{size:1,value:new Uint16Array(G)},attributes:z(z({},$),t.attributes)}))}return r}(b.a);function X(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function K(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?X(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Z=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("cylinder-geometry"):n,a=t.radius,o=void 0===a?1:a;return e.call(this,K(K({},t),{},{id:i,bottomRadius:o,topRadius:o}))}return r}(D),Y=r(73);function J(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?J(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var tt=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],et=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1],rt=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("ico-sphere-geometry"):n,a=nt(t),o=a.indices,s=a.attributes;return e.call(this,Q(Q({},t),{},{id:i,indices:o,attributes:Q(Q({},s),t.attributes)}))}return r}(b.a);function nt(t){var e=t.iterations,r=void 0===e?0:e,n=Math.PI,i=2*n,a=[].concat(tt),o=[].concat(et);a.push(),o.push();for(var s,u=(s={},function(t,e){var r=(t*=3)>(e*=3)?t:e,n="".concat(t<e?t:e,"|").concat(r);if(n in s)return s[n];var i=(a[t]+a[e])/2,o=(a[t+1]+a[e+1])/2,u=(a[t+2]+a[e+2])/2,l=Math.sqrt(i*i+o*o+u*u);return a.push(i/=l,o/=l,u/=l),s[n]=a.length/3-1}),l=0;l<r;l++){for(var c=[],h=0;h<o.length;h+=3){var f=u(o[h+0],o[h+1]),d=u(o[h+1],o[h+2]),p=u(o[h+2],o[h+0]);c.push(p,o[h+0],f,f,o[h+1],d,d,o[h+2],p,f,d,p)}o=c}for(var m=new Array(a.length),v=new Array(a.length/3*2),g=o.length-3;g>=0;g-=3){var y=o[g+0],_=o[g+1],b=o[g+2],x=3*y,w=3*_,M=3*b,A=2*y,E=2*_,S=2*b,T=a[x+0],C=a[x+1],O=a[x+2],P=Math.acos(O/Math.sqrt(T*T+C*C+O*O))/n,L=1-(Math.atan2(C,T)+n)/i,I=a[w+0],k=a[w+1],R=a[w+2],D=Math.acos(R/Math.sqrt(I*I+k*k+R*R))/n,B=1-(Math.atan2(k,I)+n)/i,F=a[M+0],j=a[M+1],N=a[M+2],U=Math.acos(N/Math.sqrt(F*F+j*j+N*N))/n,z=1-(Math.atan2(j,F)+n)/i,G=[T-I,C-k,O-R],V=new Y.a([F-I,j-k,N-R]).cross(G).normalize(),H=void 0;(0===L||0===B||0===z)&&(0===L||L>.5)&&(0===B||B>.5)&&(0===z||z>.5)&&(a.push(a[x+0],a[x+1],a[x+2]),o.push(H=a.length/3-1),v[2*H+0]=1,v[2*H+1]=P,m[3*H+0]=V.x,m[3*H+1]=V.y,m[3*H+2]=V.z,a.push(a[w+0],a[w+1],a[w+2]),o.push(H=a.length/3-1),v[2*H+0]=1,v[2*H+1]=D,m[3*H+0]=V.x,m[3*H+1]=V.y,m[3*H+2]=V.z,a.push(a[M+0],a[M+1],a[M+2]),o.push(H=a.length/3-1),v[2*H+0]=1,v[2*H+1]=U,m[3*H+0]=V.x,m[3*H+1]=V.y,m[3*H+2]=V.z),m[x+0]=m[w+0]=m[M+0]=V.x,m[x+1]=m[w+1]=m[M+1]=V.y,m[x+2]=m[w+2]=m[M+2]=V.z,v[A+0]=L,v[A+1]=P,v[E+0]=B,v[E+1]=D,v[S+0]=z,v[S+1]=U}return{indices:{size:1,value:new Uint16Array(o)},attributes:{POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(m)},TEXCOORD_0:{size:2,value:new Float32Array(v)}}}}function it(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function at(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?it(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ot=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("plane-geometry"):n,a=st(t),o=a.indices,s=a.attributes;return e.call(this,at(at({},t),{},{id:i,indices:o,attributes:at(at({},s),t.attributes)}))}return r}(b.a);function st(t){var e=t.type,r=void 0===e?"x,y":e,n=t.offset,i=void 0===n?0:n,a=t.flipCull,o=void 0!==a&&a,s=t.unpack,u=void 0!==s&&s,l=r.split(","),c=t["".concat(l[0],"len")]||1,h=t["".concat(l[1],"len")]||1,f=t["n".concat(l[0])]||1,d=t["n".concat(l[1])]||1,p=(f+1)*(d+1),m=new Float32Array(3*p),v=new Float32Array(3*p),g=new Float32Array(2*p);o&&(c=-c);for(var y=0,_=0,b=0;b<=d;b++)for(var x=0;x<=f;x++){var w=x/f,M=b/d;switch(g[y+0]=o?1-w:w,g[y+1]=M,r){case"x,y":m[_+0]=c*w-.5*c,m[_+1]=h*M-.5*h,m[_+2]=i,v[_+0]=0,v[_+1]=0,v[_+2]=o?1:-1;break;case"x,z":m[_+0]=c*w-.5*c,m[_+1]=i,m[_+2]=h*M-.5*h,v[_+0]=0,v[_+1]=o?1:-1,v[_+2]=0;break;case"y,z":m[_+0]=i,m[_+1]=c*w-.5*c,m[_+2]=h*M-.5*h,v[_+0]=o?1:-1,v[_+1]=0,v[_+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}y+=2,_+=3}for(var A=f+1,E=new Uint16Array(f*d*6),S=0;S<d;S++)for(var T=0;T<f;T++){var C=6*(S*f+T);E[C+0]=(S+0)*A+T,E[C+1]=(S+1)*A+T,E[C+2]=(S+0)*A+T+1,E[C+3]=(S+1)*A+T,E[C+4]=(S+1)*A+T+1,E[C+5]=(S+0)*A+T+1}var O={indices:{size:1,value:E},attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:v},TEXCOORD_0:{size:2,value:g}}};return u?function(t){var e=t.indices,r=t.attributes;if(!e)return t;var n=e.value.length,i={};for(var a in r){var o=r[a],s=o.value,u=o.size;if(!o.constant&&u){for(var l=new s.constructor(n*u),c=0;c<n;++c)for(var h=e.value[c],f=0;f<u;f++)l[c*u+f]=s[h*u+f];i[a]={size:u,value:l}}}return{attributes:Object.assign({},r,i)}}(O):O}function ut(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function lt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(r),!0).forEach((function(e){w()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ut(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ct=function(t){S()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P()(t);if(e){var i=P()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C()(this,r)}}(r);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A()(this,r);var n=t.id,i=void 0===n?Object(L.c)("sphere-geometry"):n,a=ht(t),o=a.indices,s=a.attributes;return e.call(this,lt(lt({},t),{},{id:i,indices:o,attributes:lt(lt({},s),t.attributes)}))}return r}(b.a);function ht(t){var e=t.nlat,r=void 0===e?10:e,n=t.nlong,i=void 0===n?10:n,a=t.radius,o=void 0===a?1:a,s=Math.PI-0,u=2*Math.PI-0,l=(r+1)*(i+1);if("number"==typeof o){var c=o;o=function(t,e,r,n,i){return c}}for(var h=new Float32Array(3*l),f=new Float32Array(3*l),d=new Float32Array(2*l),p=new(l>65535?Uint32Array:Uint16Array)(r*i*6),m=0;m<=r;m++)for(var v=0;v<=i;v++){var g=v/i,y=m/r,_=v+m*(i+1),b=2*_,x=3*_,w=u*g,M=s*y,A=Math.sin(w),E=Math.cos(w),S=Math.sin(M),T=E*S,C=Math.cos(M),O=A*S,P=o(T,C,O,g,y);h[x+0]=P*T,h[x+1]=P*C,h[x+2]=P*O,f[x+0]=T,f[x+1]=C,f[x+2]=O,d[b+0]=g,d[b+1]=1-y}for(var L=i+1,I=0;I<i;I++)for(var k=0;k<r;k++){var R=6*(I*r+k);p[R+0]=k*L+I,p[R+1]=k*L+I+1,p[R+2]=(k+1)*L+I,p[R+3]=(k+1)*L+I,p[R+4]=k*L+I+1,p[R+5]=(k+1)*L+I+1}return{indices:{size:1,value:p},attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:f},TEXCOORD_0:{size:2,value:d}}}}r.d(e,"Model",(function(){return n.a})),r.d(e,"Transform",(function(){return i.a})),r.d(e,"ProgramManager",(function(){return a.a})),r.d(e,"Timeline",(function(){return o.a})),r.d(e,"instrumentGLContext",(function(){return s.h})),r.d(e,"isWebGL2",(function(){return s.j})),r.d(e,"FEATURES",(function(){return u.a})),r.d(e,"hasFeatures",(function(){return l.c})),r.d(e,"getParameters",(function(){return s.f})),r.d(e,"setParameters",(function(){return s.n})),r.d(e,"withParameters",(function(){return s.o})),r.d(e,"cssToDeviceRatio",(function(){return s.e})),r.d(e,"readPixelsToBuffer",(function(){return c.d})),r.d(e,"copyToTexture",(function(){return c.b})),r.d(e,"cloneTextureFrom",(function(){return h.a})),r.d(e,"Buffer",(function(){return f.a})),r.d(e,"Program",(function(){return d.a})),r.d(e,"Framebuffer",(function(){return p.a})),r.d(e,"Renderbuffer",(function(){return m.a})),r.d(e,"Texture2D",(function(){return v.a})),r.d(e,"TextureCube",(function(){return g.a})),r.d(e,"Texture3D",(function(){return y.a})),r.d(e,"TransformFeedback",(function(){return _.a})),r.d(e,"Geometry",(function(){return b.a})),r.d(e,"ConeGeometry",(function(){return N})),r.d(e,"CubeGeometry",(function(){return q})),r.d(e,"CylinderGeometry",(function(){return Z})),r.d(e,"IcoSphereGeometry",(function(){return rt})),r.d(e,"PlaneGeometry",(function(){return ot})),r.d(e,"SphereGeometry",(function(){return ct})),r.d(e,"TruncatedConeGeometry",(function(){return D}))},function(t,e,r){r.r(e);var n=r(0),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s),l=r(18),c=r.n(l),h=r(6),f=r.n(h),d=r(9),p=r.n(d),m=r(5),v=r.n(m),g=r(55),y=r(56),_=r(4),b=r(30),x=r.n(b),w="undefined"!=typeof document?document:{},M={container:x.a.object,gl:x.a.object,mapboxApiAccessToken:x.a.string,mapboxApiUrl:x.a.string,attributionControl:x.a.bool,preserveDrawingBuffer:x.a.bool,reuseMaps:x.a.bool,transformRequest:x.a.func,mapOptions:x.a.object,mapStyle:x.a.oneOfType([x.a.string,x.a.object]),visible:x.a.bool,asyncRender:x.a.bool,onLoad:x.a.func,onError:x.a.func,width:x.a.number,height:x.a.number,viewState:x.a.object,longitude:x.a.number,latitude:x.a.number,zoom:x.a.number,bearing:x.a.number,pitch:x.a.number,altitude:x.a.number},A={container:w.body,mapboxApiAccessToken:function(){var t=null;if("undefined"!=typeof window&&window.location){var e=window.location.search.match(/access_token=([^&\/]*)/);t=e&&e[1]}return t||"undefined"==typeof process||(t=t||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),t||"no-token"}(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",visible:!0,asyncRender:!1,onLoad:function(){},onError:function(t){t&&console.error(t.error)},width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function E(t){t.debug&&x.a.checkPropTypes(M,t,"prop",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"component")}var S=function(){function t(e){var r=this;if(Object(g.a)(this,t),Object(_.a)(this,"mapboxgl",void 0),Object(_.a)(this,"props",A),Object(_.a)(this,"_map",null),Object(_.a)(this,"width",0),Object(_.a)(this,"height",0),Object(_.a)(this,"_fireLoadEvent",(function(){r.props.onLoad({type:"load",target:r._map})})),!e.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=e.mapboxgl,t.initialized||(t.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(e)}return Object(y.a)(t,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"resize",value:function(){return this._map.resize(),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(e){this._map=t.savedMap;var r=this._map.getContainer(),n=e.container;for(n.classList.add("mapboxgl-map");r.childNodes.length>0;)n.appendChild(r.childNodes[0]);this._map._container=n,t.savedMap=null,e.mapStyle&&this._map.setStyle(e.mapStyle,{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(e){if(e.reuseMaps&&t.savedMap)this._reuse(e);else{if(e.gl){var r=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=r,e.gl}}var n={container:e.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:e.mapStyle,interactive:!1,trackResize:!1,attributionControl:e.attributionControl,preserveDrawingBuffer:e.preserveDrawingBuffer};e.transformRequest&&(n.transformRequest=e.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,e.mapOptions)),this._map.once("load",e.onLoad),this._map.on("error",e.onError)}return this}},{key:"_destroy",value:function(){this._map&&(t.savedMap?this._map.remove():(t.savedMap=this._map,this._map.off("load",this.props.onLoad),this._map.off("error",this.props.onError),this._map.off("styledata",this._fireLoadEvent)),this._map=null)}},{key:"_initialize",value:function(t){var e=this;E(t=Object.assign({},A,t),"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||A.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var r=t.container;Object.defineProperty(r,"offsetWidth",{get:function(){return e.width}}),Object.defineProperty(r,"clientWidth",{get:function(){return e.width}}),Object.defineProperty(r,"offsetHeight",{get:function(){return e.height}}),Object.defineProperty(r,"clientHeight",{get:function(){return e.height}});var n=this._map.getCanvas();n&&(n.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,e){if(this._map){E(e=Object.assign({},this.props,e),"Mapbox");var r=this._updateMapViewport(t,e),n=this._updateMapSize(t,e);e.asyncRender||!r&&!n||this.redraw(),this.props=e}}},{key:"_updateMapSize",value:function(t,e){var r=t.width!==e.width||t.height!==e.height;return r&&(this.width=e.width,this.height=e.height,this.resize()),r}},{key:"_updateMapViewport",value:function(t,e){var r=this._getViewState(t),n=this._getViewState(e),i=n.latitude!==r.latitude||n.longitude!==r.longitude||n.zoom!==r.zoom||n.pitch!==r.pitch||n.bearing!==r.bearing||n.altitude!==r.altitude;return i&&(this._map.jumpTo(this._viewStateToMapboxProps(n)),n.altitude!==r.altitude&&(this._map.transform.altitude=n.altitude)),i}},{key:"_getViewState",value:function(t){var e=t.viewState||t,r=e.pitch,n=e.bearing,i=e.altitude;return{longitude:e.longitude,latitude:e.latitude,zoom:e.zoom,pitch:void 0===r?0:r,bearing:void 0===n?0:n,altitude:void 0===i?1.5:i}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0.47.0";if(void 0!==w)try{var e=w.createElement("div");if(e.className="mapboxgl-map",e.style.display="none",w.body.append(e),"static"===window.getComputedStyle(e).position){var r=w.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),w.head.append(r)}}catch(t){}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),t}();Object(_.a)(S,"initialized",!1),Object(_.a)(S,"propTypes",M),Object(_.a)(S,"defaultProps",A),Object(_.a)(S,"savedMap",null);var T=r(206);function C(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function O(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?C(Object(r),!0).forEach((function(e){i()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.d(e,"default",(function(){return I}));var P={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function L(t){var e=t.container,r=void 0===e?document.body:e;if("string"==typeof r&&(r=document.getElementById(r)),!r)throw Error("Deck: container not found");"static"===window.getComputedStyle(r).position&&(r.style.position="relative");var n=document.createElement("div");r.appendChild(n),Object.assign(n.style,P);var i=document.createElement("canvas");return r.appendChild(i),Object.assign(i.style,P),{container:r,mapCanvas:n,deckCanvas:i}}var I=function(t){f()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=v()(t);if(e){var i=v()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return p()(this,r)}}(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(o()(this,r),"undefined"==typeof document)throw Error("Deck can only be used in the browser");var i=L(n),a=i.mapCanvas,s=i.deckCanvas,u=n.viewState||n.initialViewState,l=Number.isFinite(u&&u.latitude),c=n.map,h=void 0===c?window.mapboxgl:c;return(t=e.call(this,O({canvas:s},n)))._map=h&&h.Map?l&&new S(O(O({},n),{},{viewState:u,container:a,mapboxgl:h})):h,t._onBeforeRender=function(e){if(t.onBeforeRender(e),t._map){var r=t.getViewports()[0];t._map.setProps({width:r.width,height:r.height,viewState:r})}},t}return u()(r,[{key:"getMapboxMap",value:function(){return this._map&&this._map.getMap()}},{key:"finalize",value:function(){this._map&&this._map.finalize(),c()(v()(r.prototype),"finalize",this).call(this)}},{key:"setProps",value:function(t){"onBeforeRender"in t&&this._onBeforeRender&&t.onBeforeRender!==this._onBeforeRender&&(this.onBeforeRender=t.onBeforeRender,t.onBeforeRender=this._onBeforeRender),"mapStyle"in t&&this._map&&this._map._map.setStyle(t.mapStyle),c()(v()(r.prototype),"setProps",this).call(this,t)}}]),r}(T.a)},function(t,e,r){r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return l})),r.d(e,"a",(function(){return c}));var n=r(176),i=r(8),a=r(10);function o(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw a}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e){return l(t,e)}function l(t,e){return(e=Array.isArray(e)?e:[e]).every((function(e){return h(t,e)}))}function c(t){for(var e in t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},n.b)void 0===t.luma.caps[e]&&(t.luma.caps[e]=h(t,e));return t.luma.caps}function h(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},void 0===t.luma.caps[e]&&(t.luma.caps[e]=function(t,e){var r,s=n.b[e];Object(a.a)(s,e);var u=Object(i.j)(t)&&s[1]||s[0];if("function"==typeof u)r=u(t);else if(Array.isArray(u)){r=!0;var l,c=o(u);try{for(c.s();!(l=c.n()).done;)r=r&&Boolean(t.getExtension(l.value))}catch(t){c.e(t)}finally{c.f()}}else"string"==typeof u?r=Boolean(t.getExtension(u)):"boolean"==typeof u?r=u:Object(a.a)(!1);return r}(t,e)),t.luma.caps[e]||i.k.log(2,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}},,,,,,,,,,,,,function(t,e,r){r.d(e,"a",(function(){return _}));var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(17),u=r.n(s),l=r(6),c=r.n(l),h=r(9),f=r.n(h),d=r(5),p=r.n(d),m=r(8),v=r(42),g=r(38),y=r(60),_=function(t){c()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=p()(t);if(e){var i=p()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return f()(this,r)}}(r);function r(t){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,r),Object(m.a)(t),(n=e.call(this,t,a)).initialize(a),n.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(u()(n)),n}return o()(r,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Object(y.a)(this.buffers)||this.bind((function(){return t._unbindBuffers()})),this.setProps(e),this}},{key:"setProps",value:function(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}},{key:"setBuffers",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.bind((function(){for(var r in e)t.setBuffer(r,e[r])})),this}},{key:"setBuffer",value:function(t,e){var r=this,n=this._getVaryingIndex(t),i=this._getBufferParams(e),a=i.buffer,o=i.byteSize,s=i.byteOffset;return n<0?(this.unused[t]=a,m.k.warn((function(){return"".concat(r.id," unused varying buffer ").concat(t)}))(),this):(this.buffers[n]=e,this.bindOnUse||this._bindBuffer(n,a,s,o),this)}},{key:"begin",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}},{key:"end",value:function(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}},{key:"_getBufferParams",value:function(t){var e,r,n;return t instanceof g.a==0?(n=t.buffer,r=t.byteSize,e=t.byteOffset):n=t,void 0===e&&void 0===r||(e=e||0,r=r||n.byteLength-e),{buffer:n,byteOffset:e,byteSize:r}}},{key:"_getVaryingInfo",value:function(t){return this.configuration&&this.configuration.getVaryingInfo(t)}},{key:"_getVaryingIndex",value:function(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;var e=Number(t);return Number.isFinite(e)?e:-1}},{key:"_bindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers){var e=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e.buffer,e.byteOffset,e.byteSize)}}},{key:"_unbindBuffers",value:function(){if(this.bindOnUse)for(var t in this.buffers)this._bindBuffer(t,null)}},{key:"_bindBuffer",value:function(t,e){var r=arguments.length>3?arguments[3]:void 0,n=e&&e.handle;return n&&void 0!==r?this.gl.bindBufferRange(35982,t,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r):this.gl.bindBufferBase(35982,t,n),this}},{key:"_createHandle",value:function(){return this.gl.createTransformFeedback()}},{key:"_deleteHandle",value:function(){this.gl.deleteTransformFeedback(this.handle)}},{key:"_bindHandle",value:function(t){this.gl.bindTransformFeedback(36386,this.handle)}}],[{key:"isSupported",value:function(t){return Object(m.j)(t)}}]),r}(v.a)},function(t,e,r){r.d(e,"a",(function(){return d}));var n=r(12),i=r.n(n),a=r(1),o=r.n(a),s=r(3),u=r.n(s);function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var h=1,f=1,d=function(){function t(){o()(this,t),this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}return u()(t,[{key:"addChannel",value:function(t){var e=t.delay,r=t.duration,n=t.rate,i=t.repeat,a=h++,o={time:0,delay:void 0===e?0:e,duration:void 0===r?Number.POSITIVE_INFINITY:r,rate:void 0===n?1:n,repeat:void 0===i?1:i};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}},{key:"removeChannel",value:function(t){this.channels.delete(t);var e,r=l(this.animations);try{for(r.s();!(e=r.n()).done;){var n=i()(e.value,2);n[1].channel===t&&this.detachAnimation(n[0])}}catch(t){r.e(t)}finally{r.f()}}},{key:"isFinished",value:function(t){var e=this.channels.get(t);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat}},{key:"getTime",value:function(t){if(void 0===t)return this.time;var e=this.channels.get(t);return void 0===e?-1:e.time}},{key:"setTime",value:function(t){this.time=Math.max(0,t);var e,r=l(this.channels.values());try{for(r.s();!(e=r.n()).done;)this._setChannelTime(e.value,this.time)}catch(t){r.e(t)}finally{r.f()}var n,i=l(this.animations.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;a.animation.setTime(this.getTime(a.channel))}}catch(t){i.e(t)}finally{i.f()}}},{key:"play",value:function(){this.playing=!0}},{key:"pause",value:function(){this.playing=!1,this.lastEngineTime=-1}},{key:"reset",value:function(){this.setTime(0)}},{key:"attachAnimation",value:function(t,e){var r=f++;return this.animations.set(r,{animation:t,channel:e}),t.setTime(this.getTime(e)),r}},{key:"detachAnimation",value:function(t){this.animations.delete(t)}},{key:"update",value:function(t){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}},{key:"_setChannelTime",value:function(t,e){var r=e-t.delay;r>=t.duration*t.repeat?t.time=t.duration*t.rate:(t.time=Math.max(0,r)%t.duration,t.time*=t.rate)}}]),t}()},function(t,e,r){var n=r(7),i=r.n(n),a=r(2),o=r.n(a),s=r(101),u=r(91),l=globalThis._parseImageNode,c="undefined"!=typeof Image,h="undefined"!=typeof ImageBitmap,f=Boolean(l),d=!!u.c||f,p=r(11),m=r.n(p);function v(t){switch(function(t){var e=function(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"===m()(t)&&t.data&&t.width&&t.height?"data":null}(t);if(!e)throw new Error("Not an image");return e}(t)){case"data":return t;case"image":case"imagebitmap":var e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}var g=/^data:image\/svg\+xml/,y=/\.svg((\?|#).*)?$/;function _(t){return t&&(g.test(t)||y.test(t))}function b(t,e){if(_(e)){var r=(new TextDecoder).decode(t);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(r=unescape(encodeURIComponent(r)))}catch(t){throw new Error(t.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return x(t,e)}function x(t,e){if(_(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}function w(t,e,r){return M.apply(this,arguments)}function M(){return(M=i()(o.a.mark((function t(e,r,n){var i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=b(e,n),a=self.URL||self.webkitURL,s="string"!=typeof i&&a.createObjectURL(i),t.prev=3,t.next=6,A(s||i,r);case 6:return t.abrupt("return",t.sent);case 7:return t.prev=7,s&&a.revokeObjectURL(s),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[3,,7,10]])})))).apply(this,arguments)}function A(t,e){return E.apply(this,arguments)}function E(){return(E=i()(o.a.mark((function t(e,r){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=new Image).src=e,!(r.image&&r.image.decode&&n.decode)){t.next=6;break}return t.next=5,n.decode();case 5:return t.abrupt("return",n);case 6:return t.next=8,new Promise((function(t,r){try{n.onload=function(){return t(n)},n.onerror=function(t){return r(new Error("Could not load image ".concat(e,": ").concat(t)))}}catch(t){r(t)}}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var S={},T=!0;function C(t,e,r){return O.apply(this,arguments)}function O(){return(O=i()(o.a.mark((function t(e,r,n){var i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!_(n)){t.next=7;break}return t.next=3,w(e,r,n);case 3:i=t.sent,t.next=8;break;case 7:i=x(e,n);case 8:return a=r&&r.imagebitmap,t.next=11,P(i,a);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function P(t){return L.apply(this,arguments)}function L(){return(L=i()(o.a.mark((function t(e){var r,n=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!I(r=n.length>1&&void 0!==n[1]?n[1]:null)&&T||(r=null),!r){t.next=13;break}return t.prev=3,t.next=6,createImageBitmap(e,r);case 6:return t.abrupt("return",t.sent);case 9:t.prev=9,t.t0=t.catch(3),console.warn(t.t0),T=!1;case 13:return t.next=15,createImageBitmap(e);case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}}),t,null,[[3,9]])})))).apply(this,arguments)}function I(t){for(var e in t||S)return!1;return!0}var k=r(160);function R(t,e){return D.apply(this,arguments)}function D(){return(D=i()(o.a.mark((function t(e,r){var n,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Object(k.a)(e)||{},i=n.mimeType,a=globalThis._parseImageNode,Object(s.a)(a),t.next=5,a(e,i);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function B(){return(B=i()(o.a.mark((function t(e,r,n){var i,a,u,l,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=(r=r||{}).image||{},u=(n||{}).url,l=F(a=i.type||"auto"),t.t0=l,t.next="imagebitmap"===t.t0?8:"image"===t.t0?12:"data"===t.t0?16:20;break;case 8:return t.next=10,C(e,r,u);case 10:return c=t.sent,t.abrupt("break",21);case 12:return t.next=14,w(e,r,u);case 14:return c=t.sent,t.abrupt("break",21);case 16:return t.next=18,R(e,r);case 18:return c=t.sent,t.abrupt("break",21);case 20:Object(s.a)(!1);case 21:return"data"===a&&(c=v(c)),t.abrupt("return",c);case 23:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t){switch(t){case"auto":case"data":return function(){if(h)return"imagebitmap";if(c)return"image";if(d)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(t){switch(t){case"auto":return h||c||d;case"imagebitmap":return h;case"image":return c;case"data":return d;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}(t),t}}r.d(e,"a",(function(){return j}));var j={id:"image",module:"images",name:"Images",version:"3.1.5",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(t,e,r){return B.apply(this,arguments)},tests:[function(t){return Boolean(Object(k.a)(new DataView(t)))}],options:{image:{type:"auto",decode:!0}}}},function(t,e,r){var n=r(11),i=r.n(n),a=r(15),o=r.n(a),s=r(0),u=r.n(s),l=r(1),c=r.n(l),h=r(3),f=r.n(h),d=r(149),p=Object(d.a)();function m(t){try{var e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}var v=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";c()(this,t),this.storage=m(n),this.id=e,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return f()(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function g(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(r=Math.min(r,n/t.width));var a=t.width*r,o=t.height*r,s=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(a/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(a,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}var y={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function _(t){return"string"==typeof t?y[t.toUpperCase()]||y.WHITE:t}function b(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(t),i=b(Object.getOwnPropertyNames(n));try{var a=function(){var n=e.value;"function"==typeof t[n]&&(r.find((function(t){return n===t}))||(t[n]=t[n].bind(t)))};for(i.s();!(e=i.n()).done;)a()}catch(t){i.e(t)}finally{i.f()}}function M(t,e){if(!t)throw new Error(e||"Assertion failed")}var A=r(65);function E(){var t;if(p&&A.b.performance)t=A.b.performance.now();else if(A.a.hrtime){var e=A.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}r.d(e,"a",(function(){return I}));var S={debug:p&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},T={enabled:!0,level:0};function C(){}var O={},P={once:!0};function L(t){for(var e in t)for(var r in t[e])return r||"untitled";return"empty"}var I=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""}).id;c()(this,t),this.id=e,this.VERSION="1.5.0",this._startTs=E(),this._deltaTs=E(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new v("__probe-".concat(this.id,"__"),T),this.userData={},this.timeStamp("".concat(this.id," started")),w(this),Object.seal(this)}return f()(t,[{key:"level",get:function(){return this.getLevel()},set:function(t){this.setLevel(t)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((E()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((E()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(t){this.level=t}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){return this._storage.updateConfiguration({enabled:!(arguments.length>0&&void 0!==arguments[0])||arguments[0]}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({level:t}),this}},{key:"assert",value:function(t,e){M(t,e)}},{key:"warn",value:function(t){return this._getLogFunction(0,t,S.warn,arguments,P)}},{key:"error",value:function(t){return this._getLogFunction(0,t,S.error,arguments)}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){return this._getLogFunction(t,e,S.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(t,e){return this._getLogFunction(t,e,S.debug,arguments)}},{key:"info",value:function(t,e){return this._getLogFunction(t,e,console.info,arguments)}},{key:"once",value:function(t,e){return this._getLogFunction(t,e,S.debug||S.info,arguments,P)}},{key:"table",value:function(t,e,r){return e?this._getLogFunction(t,e,console.table||C,r&&[r],{tag:L(e)}):C}},{key:"image",value:function(t){var e=t.image,n=t.message,i=void 0===n?"":n,a=t.scale,s=void 0===a?1:a;return this._shouldLog(t.logLevel||t.priority)?p?function(t){var e=t.image,r=t.message,n=void 0===r?"":r,i=t.scale,a=void 0===i?1:i;if("string"==typeof e){var s=new Image;return s.onload=function(){var t,e=g(s,n,a);(t=console).log.apply(t,o()(e))},s.src=e,C}var u,l=e.nodeName||"";if("img"===l.toLowerCase())return(u=console).log.apply(u,o()(g(e,n,a))),C;if("canvas"===l.toLowerCase()){var c=new Image;return c.onload=function(){var t;return(t=console).log.apply(t,o()(g(c,n,a)))},c.src=e.toDataURL(),C}return C}({image:e,message:i,scale:s}):function(t){var e=t.image,n=t.scale,i=void 0===n?1:n,a=null;try{a=r(235)}catch(t){}return a?function(){return a(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then((function(t){return console.log(t)}))}:C}({image:e,message:i,scale:s}):C}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(u()({},t,e))}},{key:"time",value:function(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}},{key:"timeEnd",value:function(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(t,e){return this._getLogFunction(t,e,console.timeStamp||C)}},{key:"group",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=r=R({logLevel:t,message:e,opts:r});return r.method=(n.collapsed?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}},{key:"groupCollapsed",value:function(t,e){return this.group(t,e,Object.assign({},arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction(t,"",console.groupEnd||C)}},{key:"withGroup",value:function(t,e,r){this.group(t,e)();try{r()}finally{this.groupEnd(t)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return this.isEnabled()&&this.getLevel()>=k(t)}},{key:"_getLogFunction",value:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(t)){var a;i=R({logLevel:t,message:e,args:n,opts:i}),M(r=r||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=E();var s=i.tag||i.message;if(i.once){if(O[s])return C;O[s]=E()}return e=D(this.id,i.message,i),(a=r).bind.apply(a,[console,e].concat(o()(i.args)))}return C}}]),t}();function k(t){if(!t)return 0;var e;switch(i()(t)){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return M(Number.isFinite(e)&&e>=0),e}function R(t){var e=t.logLevel,r=t.message;t.logLevel=k(e);for(var n=t.args?Array.from(t.args):[];n.length&&n.shift()!==r;);switch(t.args=n,i()(e)){case"string":case"function":void 0!==r&&n.unshift(r),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());var a=i()(t.message);return M("string"===a||"object"===a),Object.assign(t,t.opts)}function D(t,e,r){if("string"==typeof e){var n=r.time?function(t){var e=Math.max((arguments.length>1&&void 0!==arguments[1]?arguments[1]:8)-t.length,0);return"".concat(" ".repeat(e)).concat(t)}((s=r.total)<10?"".concat(s.toFixed(2),"ms"):s<100?"".concat(s.toFixed(1),"ms"):s<1e3?"".concat(s.toFixed(0),"ms"):"".concat((s/1e3).toFixed(2),"s")):"";i=e=r.time?"".concat(t,": ").concat(n,"  ").concat(e):"".concat(t,": ").concat(e),a=r.color,o=r.background,p||"string"!=typeof i||(a&&(a=_(a),i="[".concat(a,"m").concat(i,"[39m")),o&&(a=_(o),i="[".concat(o+10,"m").concat(i,"[49m"))),e=i}var i,a,o,s;return e}I.VERSION="1.5.0"},function(t,e,r){var n,i=r(1),a=r.n(i),o=r(3),s=r.n(o),u=r(17),l=r.n(u),c=r(18),h=r.n(c),f=r(6),d=r.n(f),p=r(9),m=r.n(p),v=r(5),g=r.n(v),y=r(42),_=r(63),b=r(79),x=r(0),w=r.n(x),M=r(8),A=r(103),E=r(10),S=(n={},w()(n,5126,z.bind(null,"uniform1fv",I,1,G)),w()(n,35664,z.bind(null,"uniform2fv",I,2,G)),w()(n,35665,z.bind(null,"uniform3fv",I,3,G)),w()(n,35666,z.bind(null,"uniform4fv",I,4,G)),w()(n,5124,z.bind(null,"uniform1iv",k,1,G)),w()(n,35667,z.bind(null,"uniform2iv",k,2,G)),w()(n,35668,z.bind(null,"uniform3iv",k,3,G)),w()(n,35669,z.bind(null,"uniform4iv",k,4,G)),w()(n,35670,z.bind(null,"uniform1iv",k,1,G)),w()(n,35671,z.bind(null,"uniform2iv",k,2,G)),w()(n,35672,z.bind(null,"uniform3iv",k,3,G)),w()(n,35673,z.bind(null,"uniform4iv",k,4,G)),w()(n,35674,z.bind(null,"uniformMatrix2fv",I,4,V)),w()(n,35675,z.bind(null,"uniformMatrix3fv",I,9,V)),w()(n,35676,z.bind(null,"uniformMatrix4fv",I,16,V)),w()(n,35678,U),w()(n,35680,U),w()(n,5125,z.bind(null,"uniform1uiv",R,1,G)),w()(n,36294,z.bind(null,"uniform2uiv",R,2,G)),w()(n,36295,z.bind(null,"uniform3uiv",R,3,G)),w()(n,36296,z.bind(null,"uniform4uiv",R,4,G)),w()(n,35685,z.bind(null,"uniformMatrix2x3fv",I,6,V)),w()(n,35686,z.bind(null,"uniformMatrix2x4fv",I,8,V)),w()(n,35687,z.bind(null,"uniformMatrix3x2fv",I,6,V)),w()(n,35688,z.bind(null,"uniformMatrix3x4fv",I,12,V)),w()(n,35689,z.bind(null,"uniformMatrix4x2fv",I,8,V)),w()(n,35690,z.bind(null,"uniformMatrix4x3fv",I,12,V)),w()(n,35678,U),w()(n,35680,U),w()(n,35679,U),w()(n,35682,U),w()(n,36289,U),w()(n,36292,U),w()(n,36293,U),w()(n,36298,U),w()(n,36299,U),w()(n,36300,U),w()(n,36303,U),w()(n,36306,U),w()(n,36307,U),w()(n,36308,U),w()(n,36311,U),n),T={},C={},O={},P=[0];function L(t,e,r,n){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(P[0]=t,t=P);var i=t.length;if(i%e&&M.k.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof r)return t;var a=n[i];a||(a=new r(i),n[i]=a);for(var o=0;o<i;o++)a[o]=t[o];return a}function I(t,e){return L(t,e,Float32Array,T)}function k(t,e){return L(t,e,Int32Array,C)}function R(t,e){return L(t,e,Uint32Array,O)}function D(t,e,r){var n=S[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,t,e)}function B(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};var e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function F(t,e,r){for(var n in t){var i=t[n];if((!r||Boolean(r[n]))&&!j(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(n),i),new Error("".concat(e," Bad uniform ").concat(n))}return!0}function j(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;for(var e=Math.min(t.length,16),r=0;r<e;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t):!!isFinite(t)||!0===t||!1===t||t instanceof _.a||t instanceof A.a||t instanceof b.a&&Boolean(t.texture)}function N(t,e,r){if(Array.isArray(r)||ArrayBuffer.isView(r))if(t[e])for(var n=t[e],i=0,a=r.length;i<a;++i)n[i]=r[i];else t[e]=r.slice();else t[e]=r}function U(){var t=null;return function(e,r,n){var i=t!==n;return i&&(e.uniform1i(r,n),t=n),i}}function z(t,e,r,n){var i=null,a=null;return function(o,s,u){var l=e(u,r),c=l.length,h=!1;if(null===i)i=new Float32Array(c),a=c,h=!0;else{Object(E.a)(a===c,"Uniform length cannot change.");for(var f=0;f<c;++f)if(l[f]!==i[f]){h=!0;break}}return h&&(n(o,t,s,l),i.set(l)),h}}function G(t,e,r,n){t[e](r,n)}function V(t,e,r,n){t[e](r,!1,n)}function H(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",r=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:e}function W(t,e,r,n){for(var i=t.split(/\r?\n/),a={},o={},s=n||H(e)||"(unnamed)",u="".concat(function(t){switch(t){case 35632:return"fragment";case 35633:return"vertex";default:return"unknown type"}}(r)," shader ").concat(s),l=0;l<i.length;l++){var c=i[l];if(!(c.length<=1)){var h=c.split(":"),f=h[0],d=parseInt(h[2],10);if(isNaN(d))throw new Error("GLSL compilation error in ".concat(u,": ").concat(t));"WARNING"!==f?a[d]=c:o[d]=c}}var p=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:": ",n=t.split(/\r?\n/),i=String(n.length+e-1).length;return n.map((function(t,n){var a=String(n+e);return q(a,i-a.length)+r+t}))}(e);return{shaderName:u,errors:$(a,p),warnings:$(o,p)}}function $(t,e){for(var r="",n=0;n<e.length;n++)if((t[n+3]||t[n+2]||t[n+1])&&(r+="".concat(e[n],"\n"),t[n+1])){var i=t[n+1],a=i.split(":",3),o=a[0],s=parseInt(a[1],10)||0,u=i.substring(a.join(":").length+1).trim();r+=q("^^^ ".concat(o,": ").concat(u,"\n\n"),s)}return r}function q(t,e){for(var r="",n=0;n<e;++n)r+=" ";return"".concat(r).concat(t)}var X=r(60);function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}var Z=function(t){d()(r,t);var e=K(r);function r(t,n){var i;a()(this,r),Object(M.b)(t),Object(E.a)("string"==typeof n.source,"Shader: GLSL source code must be a JavaScript string");var o=H(n.source,null)||n.id||Object(X.c)("unnamed ".concat(r.getTypeName(n.shaderType)));return(i=e.call(this,t,{id:o})).shaderType=n.shaderType,i.source=n.source,i.initialize(n),i}return s()(r,[{key:"initialize",value:function(t){var e=t.source,r=H(e,null);r&&(this.id=Object(X.c)(r)),this._compile(e)}},{key:"getParameter",value:function(t){return this.gl.getShaderParameter(this.handle,t)}},{key:"toString",value:function(){return"".concat(r.getTypeName(this.shaderType),":").concat(this.id)}},{key:"getName",value:function(){return H(this.source)||"unnamed-shader"}},{key:"getSource",value:function(){return this.gl.getShaderSource(this.handle)}},{key:"getTranslatedSource",value:function(){var t=this.gl.getExtension("WEBGL_debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}},{key:"_compile",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.source;if(t.startsWith("#version ")||(t="#version 100\n".concat(t)),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){var e=W(this.gl.getShaderInfoLog(this.handle),this.source,this.shaderType,this.id),r=e.shaderName,n=e.errors,i=e.warnings;throw M.k.error("GLSL compilation errors in ".concat(r,"\n").concat(n))(),M.k.warn("GLSL compilation warnings in ".concat(r,"\n").concat(i))(),new Error("GLSL compilation errors in ".concat(r))}}},{key:"_deleteHandle",value:function(){this.gl.deleteShader(this.handle)}},{key:"_getOptsFromHandle",value:function(){return{type:this.getParameter(35663),source:this.getSource()}}}],[{key:"getTypeName",value:function(t){switch(t){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Object(E.a)(!1),"unknown"}}}]),r}(y.a),Y=function(t){d()(r,t);var e=K(r);function r(t,n){return a()(this,r),"string"==typeof n&&(n={source:n}),e.call(this,t,Object.assign({},n,{shaderType:35633}))}return s()(r,[{key:"_createHandle",value:function(){return this.gl.createShader(35633)}}]),r}(Z),J=function(t){d()(r,t);var e=K(r);function r(t,n){return a()(this,r),"string"==typeof n&&(n={source:n}),e.call(this,t,Object.assign({},n,{shaderType:35632}))}return s()(r,[{key:"_createHandle",value:function(){return this.gl.createShader(35632)}}]),r}(Z),Q=r(72),tt=r(88),et=function(){function t(e){a()(this,t),this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}return s()(t,[{key:"getAttributeInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}},{key:"getAttributeLocation",value:function(t){var e=this.getAttributeInfo(t);return e?e.location:-1}},{key:"getAttributeAccessor",value:function(t){var e=this.getAttributeInfo(t);return e?e.accessor:null}},{key:"getVaryingInfo",value:function(t){var e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}},{key:"getVaryingIndex",value:function(t){var e=this.getVaryingInfo();return e?e.location:-1}},{key:"getVaryingAccessor",value:function(t){var e=this.getVaryingInfo();return e?e.accessor:null}},{key:"_readAttributesFromProgram",value:function(t){for(var e=t.gl,r=e.getProgramParameter(t.handle,35721),n=0;n<r;n++){var i=e.getActiveAttrib(t.handle,n),a=i.name,o=i.type,s=i.size,u=e.getAttribLocation(t.handle,a);u>=0&&this._addAttribute(u,a,o,s)}this.attributeInfos.sort((function(t,e){return t.location-e.location}))}},{key:"_readVaryingsFromProgram",value:function(t){var e=t.gl;if(Object(M.j)(e)){for(var r=e.getProgramParameter(t.handle,35971),n=0;n<r;n++){var i=e.getTransformFeedbackVarying(t.handle,n);this._addVarying(n,i.name,i.type,i.size)}this.varyingInfos.sort((function(t,e){return t.location-e.location}))}}},{key:"_addAttribute",value:function(t,e,r,n){var i=Object(tt.a)(r),a={type:i.type,size:n*i.components};this._inferProperties(t,e,a);var o={location:t,name:e,accessor:new Q.a(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[t]=o,this.attributeInfosByName[o.name]=o}},{key:"_inferProperties",value:function(t,e,r){/instance/i.test(e)&&(r.divisor=1)}},{key:"_addVarying",value:function(t,e,r,n){var i=Object(tt.a)(r),a={location:t,name:e,accessor:new Q.a({type:i.type,size:n*i.components})};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}]),t}(),rt=r(54);function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return at}));var it=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"],at=function(t){d()(r,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=g()(t);if(e){var i=g()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return m()(this,r)}}(r);function r(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a()(this,r),(n=e.call(this,t,i)).stubRemovedMethods("Program","v6.0",it),n._isCached=!1,n.initialize(i),Object.seal(l()(n)),n._setId(i.id),n}return s()(r,[{key:"initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vs,r=t.fs,n=t.varyings,i=t.bufferMode,a=void 0===i?35981:i;return this.hash=t.hash||"",this.vs="string"==typeof e?new Y(this.gl,{id:"".concat(t.id,"-vs"),source:e}):e,this.fs="string"==typeof r?new J(this.gl,{id:"".concat(t.id,"-fs"),source:r}):r,Object(E.a)(this.vs instanceof Y),Object(E.a)(this.fs instanceof J),this.uniforms={},this._textureUniforms={},n&&n.length>0&&(Object(M.a)(this.gl),this.varyings=n,this.gl2.transformFeedbackVaryings(this.handle,n,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new et(this),this.setProps(t)}},{key:"delete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._isCached?this:h()(g()(r.prototype),"delete",this).call(this,t)}},{key:"setProps",value:function(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}},{key:"draw",value:function(t){var e=this,r=t.logPriority,n=t.drawMode,i=void 0===n?4:n,a=t.vertexCount,o=t.offset,s=void 0===o?0:o,u=t.start,l=t.end,c=t.isIndexed,h=void 0!==c&&c,f=t.indexType,d=void 0===f?5123:f,p=t.instanceCount,m=void 0===p?0:p,v=t.isInstanced,g=void 0===v?m>0:v,y=t.vertexArray,_=void 0===y?null:y,b=t.transformFeedback,x=t.framebuffer,w=t.parameters,A=void 0===w?{}:w,S=t.uniforms;if((S||t.samplers)&&(M.k.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(S||{})),M.k.priority>=r){var T=x?x.id:"default",C="mode=".concat(Object(rt.a)(this.gl,i)," verts=").concat(a," ")+"instances=".concat(m," indexType=").concat(Object(rt.a)(this.gl,d)," ")+"isInstanced=".concat(g," isIndexed=").concat(h," ")+"Framebuffer=".concat(T);M.k.log(r,C)()}return Object(E.a)(_),this.gl.useProgram(this.handle),!(!this._areTexturesRenderable()||0===a||g&&0===m||(_.bindForDraw(a,m,(function(){if(void 0!==x&&(A=Object.assign({},A,{framebuffer:x})),b){var t=Object(tt.c)(i);b.begin(t)}e._bindTextures(),Object(M.o)(e.gl,A,(function(){h&&g?e.gl2.drawElementsInstanced(i,a,d,s,m):h&&Object(M.j)(e.gl)&&!isNaN(u)&&!isNaN(l)?e.gl2.drawRangeElements(i,u,l,a,d,s):h?e.gl.drawElements(i,a,d,s):g?e.gl2.drawArraysInstanced(i,s,a,m):e.gl.drawArrays(i,s,a)})),b&&b.end()})),0))}},{key:"setUniforms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in M.k.priority>=2&&F(t,this.id,this._uniformSetters),this.gl.useProgram(this.handle),t){var r=t[e],n=this._uniformSetters[e];if(n){var i=r,a=!1;if(i instanceof b.a&&(i=i.texture),i instanceof _.a)if(a=this.uniforms[e]!==r){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);var o=i,s=n.textureIndex;o.bind(s),i=s,this._textureUniforms[e]=o}else i=n.textureIndex;else this._textureUniforms[e]&&delete this._textureUniforms[e];(n(i)||a)&&N(this.uniforms,e,r)}}return this}},{key:"_areTexturesRenderable",value:function(){var t=!0;for(var e in this._textureUniforms){var r=this._textureUniforms[e];r.update(),t=t&&r.loaded}return t}},{key:"_bindTextures",value:function(){for(var t in this._textureUniforms)this._textureUniforms[t].bind(this._uniformSetters[t].textureIndex)}},{key:"_createHandle",value:function(){return this.gl.createProgram()}},{key:"_deleteHandle",value:function(){this.gl.deleteProgram(this.handle)}},{key:"_getOptionsFromHandle",value:function(t){var e,r={},n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return nt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?nt(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.gl.getAttachedShaders(t));try{for(n.s();!(e=n.n()).done;){var i=e.value;switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Y({handle:i});break;case 35632:r.fs=new J({handle:i})}}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"_getParameter",value:function(t){return this.gl.getProgramParameter(this.handle,t)}},{key:"_setId",value:function(t){if(!t){var e=this._getName();this.id=Object(X.c)(e)}}},{key:"_getName",value:function(){var t=this.vs.getName()||this.fs.getName();return(t=t.replace(/shader/i,""))?"".concat(t,"-program"):"program"}},{key:"_compileAndLink",value:function(){var t=this.gl;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),M.k.time(4,"linkProgram for ".concat(this._getName()))(),t.linkProgram(this.handle),M.k.timeEnd(4,"linkProgram for ".concat(this._getName()))(),t.debug||M.k.level>0){if(!t.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(t.getProgramInfoLog(this.handle)));if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(t.getProgramInfoLog(this.handle)))}}},{key:"_readUniformLocationsFromLinkedProgram",value:function(){var t=this.gl;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(var e=0;e<this._uniformCount;e++){var r=this.gl.getActiveUniform(this.handle,e),n=B(r.name).name,i=t.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=D(t,i,r),r.size>1)for(var a=0;a<r.size;a++)i=t.getUniformLocation(this.handle,"".concat(n,"[").concat(a,"]")),this._uniformSetters["".concat(n,"[").concat(a,"]")]=D(t,i,r)}this._textureIndexCounter=0}},{key:"getActiveUniforms",value:function(t,e){return this.gl2.getActiveUniforms(this.handle,t,e)}},{key:"getUniformBlockIndex",value:function(t){return this.gl2.getUniformBlockIndex(this.handle,t)}},{key:"getActiveUniformBlockParameter",value:function(t,e){return this.gl2.getActiveUniformBlockParameter(this.handle,t,e)}},{key:"uniformBlockBinding",value:function(t,e){this.gl2.uniformBlockBinding(this.handle,t,e)}}]),r}(y.a)},function(t,e,r){var n=r(1),i=r.n(n),a=r(3),o=r.n(a),s=r(12),u=r.n(s),l=r(163),c="void main() {gl_FragColor = vec4(0);}",h="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",f="#version 300 es\n".concat(h);function d(t,e){e=Array.isArray(e)?e:[e];var r=t.replace(/^\s+/,"").split(/\s+/),n=u()(r,3),i=n[0],a=n[1],o=n[2];return e.includes(i)&&a&&o?{qualifier:i,type:a,name:o.split(";")[0]}:null}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,r=void 0===e?100:e,n=t.input,i=t.inputType,a=t.output;if(!n)return 300===r?f:r>300?"#version ".concat(r,"\n").concat(h):c;var o=v(n,i);return r>=300?"#version ".concat(r," ").concat(300===r?"es":"","\nin ").concat(i," ").concat(n,";\nout vec4 ").concat(a,";\nvoid main() {\n  ").concat(a," = ").concat(o,";\n}"):"varying ".concat(i," ").concat(n,";\nvoid main() {\n  gl_FragColor = ").concat(o,";\n}")}function m(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Object(l.a)(!1),null}}function v(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Object(l.a)(!1),null}}var g=r(8),y=r(38),_=r(289),b=r(10);function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var w=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}return o()(t,[{key:"setupResources",value:function(t){var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.bindings);try{for(r.s();!(e=r.n()).done;)this._setupTransformFeedback(e.value,t)}catch(t){r.e(t)}finally{r.f()}}},{key:"updateModelProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.varyings;return e.length>0&&(t=Object.assign({},t,{varyings:e})),t}},{key:"getDrawOptions",value:function(){var t=this.bindings[this.currentIndex],e=t.transformFeedback;return{attributes:Object.assign({},t.sourceBuffers,(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).attributes),transformFeedback:e}}},{key:"swap",value:function(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){this._setupBuffers(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getBuffer",value:function(t){var e=t?this.bindings[this.currentIndex].feedbackBuffers[t]:null;return e?e instanceof y.a?e:e.buffer:null}},{key:"getData",value:function(){var t=this.getBuffer((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).varyingName);return t?t.getData():null}},{key:"delete",value:function(){for(var t in this.resources)this.resources[t].delete()}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setupBuffers(t),this.varyings=t.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Object(b.a)(Object(g.j)(this.gl))}},{key:"_getFeedbackBuffers",value:function(t){var e=t.sourceBuffers,r=void 0===e?{}:e,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var i in this.feedbackMap)i in r&&(n[this.feedbackMap[i]]=i);for(var a in Object.assign(n,t.feedbackBuffers),n){var o=n[a];if("string"==typeof o){var s=r[o];n[a]=this._createNewBuffer(a,{byteLength:s.byteLength,usage:s.usage,accessor:s.accessor})}}return n}},{key:"_setupBuffers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.sourceBuffers,r=void 0===e?null:e;Object.assign(this.feedbackMap,t.feedbackMap);var n=this._getFeedbackBuffers(t);this._updateBindings({sourceBuffers:r,feedbackBuffers:n})}},{key:"_setupTransformFeedback",value:function(t,e){t.transformFeedback=new _.a(this.gl,{program:e.model.program,buffers:t.feedbackBuffers})}},{key:"_updateBindings",value:function(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this.feedbackMap){var e=this._swapBuffers(this.bindings[this.currentIndex]),r=e.sourceBuffers,n=e.feedbackBuffers,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:r,feedbackBuffers:n})}}},{key:"_updateBinding",value:function(t,e){return t?(Object.assign(t.sourceBuffers,e.sourceBuffers),Object.assign(t.feedbackBuffers,e.feedbackBuffers),t.transformFeedback&&t.transformFeedback.setBuffers(t.feedbackBuffers),t):{sourceBuffers:Object.assign({},e.sourceBuffers),feedbackBuffers:Object.assign({},e.feedbackBuffers)}}},{key:"_swapBuffers",value:function(t){if(!this.feedbackMap)return null;var e=Object.assign({},t.sourceBuffers),r=Object.assign({},t.feedbackBuffers);for(var n in this.feedbackMap){var i=this.feedbackMap[n];e[n]=t.feedbackBuffers[i],r[i]=t.sourceBuffers[n],Object(b.a)(r[i]instanceof y.a)}return{sourceBuffers:e,feedbackBuffers:r}}},{key:"_createNewBuffer",value:function(t,e){var r=new y.a(this.gl,e);return this.resources[t]&&this.resources[t].delete(),this.resources[t]=r,r}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}}]),t}(),M=r(0),A=r.n(M),E=r(180),S=r(115),T=r(79),C=r(211);function O(t){var e=100,r=t.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){var n=parseInt(r[1],10);Number.isFinite(n)&&(e=n)}return e}var P,L=r(165),I={name:"transform",vs:"attribute float transform_elementID;\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};function k(t){var e=t.vs,r=t.sourceTextureMap,n=t.targetTextureVarying,i=t.targetTexture,a=Object.keys(r).length,o=null,s={},u=e,c={};if(a>0||n){var h=u.split("\n"),f=h.slice();if(h.forEach((function(t,e,i){if(a>0){var u=function(t,e){var r={},n=function(t){return d(t,["attribute","in"])}(t);if(!n)return null;var i=n.type,a=n.name;if(a&&e[a]){var o="// ".concat(t," => Replaced by Transform with a sampler"),s=function(t){var e="".concat("transform_uSampler_").concat(t),r="".concat("transform_uSize_").concat(t);return{samplerName:e,sizeName:r,uniformDeclerations:"  uniform sampler2D ".concat(e,";\n  uniform vec2 ").concat(r,";")}}(a),u=s.samplerName,c=s.sizeName,h=s.uniformDeclerations,f=function(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Object(l.a)(!1),null}}(i),p="  ".concat(i," ").concat(a," = transform_getInput(").concat(u,", ").concat(c,").").concat(f,";\n");return r[u]=a,{updatedLine:o,inject:{"vs:#decl":h,"vs:#main-start":p},samplerTextureMap:r}}return null}(t,r);if(u){var h=u.inject;f[e]=u.updatedLine,c=Object(L.b)([c,h]),Object.assign(s,u.samplerTextureMap),a--}}n&&!o&&(o=function(t,e){var r=d(t,["varying","out"]);return r&&r.name===e?r.type:null}(t,n))})),n){Object(b.a)(i);var p="".concat("transform_uSize_").concat(n),m={"vs:#decl":"uniform vec2 ".concat(p,";\n"),"vs:#main-start":"     vec2 ".concat("transform_position"," = transform_getPos(").concat(p,");\n     gl_Position = vec4(").concat("transform_position",", 0, 1.);\n")};c=Object(L.b)([c,m])}u=f.join("\n")}return{vs:u,targetTextureType:o,inject:c,samplerTextureMap:s}}function R(t){var e,r,n=t.sourceTextureMap,i=t.targetTextureVarying,a=t.targetTexture,o={};for(var s in i&&(e=a.width,r=a.height,o["".concat("transform_uSize_").concat(i)]=[e,r]),n){var u=n[s];e=u.width,r=u.height,o["".concat("transform_uSize_").concat(s)]=[e,r]}return o}var D=(P={},A()(P,10241,9728),A()(P,10240,9728),A()(P,10242,33071),A()(P,10243,33071),P),B=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(r),Object.seal(this)}return o()(t,[{key:"updateModelProps",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this._processVertexShader(t);return Object.assign({},t,e)}},{key:"getDrawOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.bindings[this.currentIndex],r=e.sourceTextures,n=e.framebuffer,i=e.targetTexture,a=Object.assign({},e.sourceBuffers,t.attributes),o=Object.assign({},t.uniforms),s=Object.assign({},t.parameters),u=t.discard;if(this.hasSourceTextures||this.hasTargetTexture){for(var l in a.transform_elementID=this.elementIDBuffer,this.samplerTextureMap)o[l]=r[this.samplerTextureMap[l]];this._setSourceTextureParameters();var c=R({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(o,c)}return this.hasTargetTexture&&(u=!1,s.viewport=[0,0,n.width,n.height]),{attributes:a,framebuffer:n,uniforms:o,discard:u,parameters:s}}},{key:"swap",value:function(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}},{key:"update",value:function(){this._setupTextures(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getTargetTexture",value:function(){return this.bindings[this.currentIndex].targetTexture}},{key:"getData",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).packed,e=void 0!==t&&t,r=this.bindings[this.currentIndex].framebuffer,n=Object(E.c)(r);if(!e)return n;for(var i=n.constructor,a=m(this.targetTextureType),o=new i(n.length*a/4),s=0,u=0;u<n.length;u+=4)for(var l=0;l<a;l++)o[s++]=n[u+l];return o}},{key:"getFramebuffer",value:function(){return this.bindings[this.currentIndex].framebuffer}},{key:"delete",value:function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t._targetTextureVarying;this._swapTexture=t._swapTexture,this.targetTextureVarying=e,this.hasTargetTexture=e,this._setupTextures(t)}},{key:"_createTargetTexture",value:function(t){var e=t.textureOrReference;if(e instanceof S.a)return e;var r=t.sourceTextures[e];return r?(this._targetRefTexName=e,this._createNewTexture(r)):null}},{key:"_setupTextures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.sourceBuffers,r=t._sourceTextures,n=void 0===r?{}:r,i=this._createTargetTexture({sourceTextures:n,textureOrReference:t._targetTexture});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceBuffers:e,sourceTextures:n,targetTexture:i}),"elementCount"in t&&this._updateElementIDBuffer(t.elementCount)}},{key:"_updateElementIDBuffer",value:function(t){if(!("number"!=typeof t||this.elementCount>=t)){var e=new Float32Array(t);e.forEach((function(t,e,r){r[e]=e})),this.elementIDBuffer?this.elementIDBuffer.setData({data:e}):this.elementIDBuffer=new y.a(this.gl,{data:e,accessor:{size:1}}),this.elementCount=t}}},{key:"_updateBindings",value:function(t){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t),this._swapTexture){var e=this._swapTextures(this.bindings[this.currentIndex]),r=e.sourceTextures,n=e.targetTexture,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:r,targetTexture:n})}}},{key:"_updateBinding",value:function(t,e){var r=e.sourceBuffers,n=e.targetTexture;if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,e.sourceTextures),Object.assign(t.sourceBuffers,r),n){t.targetTexture=n;var i=n.width,a=n.height,o=t.framebuffer;o?(o.update({attachments:A()({},36064,n),resizeAttachments:!1}),o.resize({width:i,height:a})):t.framebuffer=new T.a(this.gl,{id:"transform-framebuffer",width:i,height:a,attachments:A()({},36064,n)})}return t}},{key:"_setSourceTextureParameters",value:function(){var t=this.bindings[this.currentIndex].sourceTextures;for(var e in t)t[e].setParameters(D)}},{key:"_swapTextures",value:function(t){if(!this._swapTexture)return null;var e=Object.assign({},t.sourceTextures);return e[this._swapTexture]=t.targetTexture,{sourceTextures:e,targetTexture:t.sourceTextures[this._swapTexture]}}},{key:"_createNewTexture",value:function(t){var e,r=Object(C.a)(t,{parameters:(e={},A()(e,10241,9728),A()(e,10240,9728),A()(e,10242,33071),A()(e,10243,33071),e),pixelStore:A()({},37440,!1)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=r,r}},{key:"_getNextIndex",value:function(){return(this.currentIndex+1)%2}},{key:"_processVertexShader",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.bindings[this.currentIndex],r=k({vs:t.vs,sourceTextureMap:e.sourceTextures,targetTextureVarying:this.targetTextureVarying,targetTexture:e.targetTexture}),n=r.vs,i=r.uniforms,a=r.targetTextureType,o=r.inject,s=r.samplerTextureMap,u=Object(L.b)([t.inject||{},o]);return this.targetTextureType=a,this.samplerTextureMap=s,{vs:n,fs:t._fs||p({version:O(n),input:this.targetTextureVarying,inputType:a,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[I].concat(t.modules||[]):t.modules,uniforms:i,inject:u}}}]),t}(),F=r(60),j=r(162);function N(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return U(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?U(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}r.d(e,"a",(function(){return z}));var z=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,t),this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(r),Object.seal(this)}return o()(t,[{key:"delete",value:function(){var t=this.model,e=this.bufferTransform,r=this.textureTransform;t&&t.delete(),e&&e.delete(),r&&r.delete()}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.clearRenderTarget,r=void 0===e||e,n=this._updateDrawOptions(t);r&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}},{key:"swap",value:function(){var t,e=!1,r=N([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(t=r.n()).done;)e=e||t.value.swap()}catch(t){r.e(t)}finally{r.f()}Object(b.a)(e,"Nothing to swap")}},{key:"getBuffer",value:function(){return this.bufferTransform&&this.bufferTransform.getBuffer(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}},{key:"getData",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=N([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(t=r.n()).done;){var n=t.value.getData(e);if(n)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getFramebuffer",value:function(){return this.textureTransform&&this.textureTransform.getFramebuffer()}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"elementCount"in t&&this.model.setVertexCount(t.elementCount);var e,r=N([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(r.s();!(e=r.n()).done;)e.value.update(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"_initialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.gl;this._buildResourceTransforms(e,t),t=this._updateModelProps(t),this.model=new j.a(e,Object.assign({},t,{fs:t.fs||p({version:O(t.vs)}),id:t.id||"transform-model",drawMode:t.drawMode||0,vertexCount:t.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}},{key:"_updateModelProps",value:function(t){var e,r=Object.assign({},t),n=N([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(n.s();!(e=n.n()).done;)r=e.value.updateModelProps(r)}catch(t){n.e(t)}finally{n.f()}return r}},{key:"_buildResourceTransforms",value:function(t,e){(function(t){return!(Object(F.a)(t.feedbackBuffers)&&Object(F.a)(t.feedbackMap)&&!(t.varyings&&t.varyings.length>0))})(e)&&(this.bufferTransform=new w(t,e)),function(t){return!(Object(F.a)(t._sourceTextures)&&!t._targetTexture&&!t._targetTextureVarying)}(e)&&(this.textureTransform=new B(t,e)),Object(b.a)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}},{key:"_updateDrawOptions",value:function(t){var e,r=Object.assign({},t),n=N([this.bufferTransform,this.textureTransform].filter(Boolean));try{for(n.s();!(e=n.n()).done;)r=Object.assign(r,e.value.getDrawOptions(r))}catch(t){n.e(t)}finally{n.f()}return r}}],[{key:"isSupported",value:function(t){return Object(g.j)(t)}}]),t}()}])})),deck=unwrapExports(dist_min);class Trees3DLayer{constructor(t){this.options=t;const e=this;this.treeThunkLayer=null,this.treeCrownLayer=null;const r=new Map;this.cleaningData=t=>{const e=t.properties.size||"M",n={L:9,M:7,S:5}[e],i=t.properties.id;if(r.has(i))return r.get(i);const a=.66*n,o={L:.6,M:.5,S:.4}[e],s={L:.1,M:.095,S:.09}[e],u={id:i,position:t.geometry.coordinates,trunk:{translation:[0,0,.75*n/2],scale:[o,.75*n,o]},crown:{translation:[0,0,.6*n],scale:[a*s,a*s,a*s],orientation:[0,0,0]}};return r.set(i,u),u},this.renderTrees=()=>{const r=t.map.getZoom(),n=t.levels||[15,17.5,18.5];if(r<n[0])return;let i=r<=n[1]?["L"]:r<=n[2]?["L","M"]:["L","M","S"];const{innerHeight:a,innerWidth:o}=window,s=r>16?Math.max(a,o)/2*(r-16+1):0,u=t.map.getPitch(),l=t.map.queryRenderedFeatures([[0-s,a+s],[o+s,u>60?(u-60)/25*(a/2):0]],{filter:["match",["get","size"],i,!0,!1],layers:[t.id+"-base"],validate:!1});requestAnimationFrame((()=>{const t=l.map(e.cleaningData);e.treeThunkLayer.setProps({data:t}),e.treeCrownLayer.setProps({data:t})}))}}turnoffListener(){const t=this.options.map;t.off("moveend",this.renderTrees),t.off("resize",this.renderTrees)}loadLayer(){const t=this.options,e=t.map;e.addLayer({id:t.id+"-base",type:"circle",source:t.source,paint:{"circle-color":"rgba(0,0,0,0)"}}),this.treeThunkLayer=new deck.MapboxLayer({id:t.id+"-trunk",type:deck.SimpleMeshLayer,mesh:new CylinderGeometry,getOrientation:[0,0,90],getColor:t.trunkColor||[219,195,154],getTranslation:t=>t.trunk.translation,getScale:t=>t.trunk.scale}),this.treeCrownLayer=new deck.MapboxLayer({id:t.id+"-crown",type:deck.SimpleMeshLayer,mesh:t.crownMesh,loaders:[DracoLoader],getColor:t.crownColor||[175,216,142],getTranslation:t=>t.crown.translation,getScale:t=>t.crown.scale,getOrientation:t=>t.crown.orientation,loadOptions:function(t){let e={};return t&&(t.draco&&t.draco.libsUrl&&(t.draco={libsUrl:t.draco.libsUrl,workerUrl:t.draco.libsUrl+"/draco-worker.js"}),e=t),e}(t.loadOptions)}),e.addLayer(this.treeThunkLayer),e.addLayer(this.treeCrownLayer),e.on("moveend",this.renderTrees),e.once("idle",this.renderTrees),e.on("resize",this.renderTrees);const r=new deck.AmbientLight({intensity:2.25}),n=new deck.DirectionalLight({color:[255,255,255],intensity:.35,direction:[0,0,-1]}),i=new deck.LightingEffect({ambientLight:r,directionalLight:n});this.treeCrownLayer.deck.setProps({effects:[i]})}removeLayer(t){this.turnoffListener();let e=this.options.map;e.getLayer(t+"-base")&&e.removeLayer(t+"-base"),e.getLayer(t+"-trunk")&&e.removeLayer(t+"-trunk"),e.getLayer(t+"-crown")&&e.removeLayer(t+"-crown")}}function projSZ2000(t){let e=proj4("EPSG:3857","EPSG:4326",[t[0],t[1]]);return t[2]&&e.push(t[2]),e}function unprojSZ2000(t){let e=proj4("EPSG:4326","EPSG:3857",[t[0],t[1]]);return t[2]&&e.push(t[2]),e}function convertCoor(t,e){return e&&"SZ2000"===e&&Array.isArray(t)&&t[0]>180&&t[1]>90?projSZ2000(t):t}function convertOption(t,e){if(t.center){let r=convertCoor(t.center,e);t.center=r}else if(t.around){let r=convertCoor(t.around,e);t.around=r}return t}class MigrationLayer{constructor(t,e){let{id:r,data:n,pointImgUrl:i,color:a,blur:o,steps:s}=e||{};this.map=t,this.data=n||[],this.id=r,this.prefix="mapmost-migration",this.pointImgUrl=i,this.color=a||"#00eaff",this.colorBlur=o||"#00e8ff",this.steps=s||400,this._addLayer()}_addLayer(){let{map:t,id:e,data:r,color:n,colorBlur:i,prefix:a,pointImgUrl:o,steps:s}=this;this._addIcon(),this._removeAllLayers(),this._removeAllSource();let u=[],l=[],c=[];r.forEach((t=>{u.push({type:"Feature",geometry:{type:"LineString",coordinates:this._getData([t.coords[0],t.coords[1]],s)}}),l.push({type:"Feature",geometry:{type:"Point",coordinates:t.coords[0]}}),l.push({type:"Feature",geometry:{type:"Point",coordinates:t.coords[1]}}),c.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:t.coords[0]}})}));let h={type:"FeatureCollection",features:u};t.addSource(`${a}-dot-${e}`,{type:"geojson",data:{type:"FeatureCollection",features:l}});let f={type:"FeatureCollection",features:c};t.addSource(`${a}-route-${e}`,{type:"geojson",data:h}),t.addSource(`${a}-point-${e}`,{type:"geojson",data:f}),t.addLayer({id:`${a}-route-${e}`,source:`${a}-route-${e}`,type:"line",paint:{"line-width":6,"line-blur":4,"line-opacity":.4,"line-color":n}}),t.addLayer({id:`${a}-route2-${e}`,source:`${a}-route-${e}`,type:"line",paint:{"line-width":4,"line-blur":4,"line-opacity":.4,"line-color":i}}),t.addLayer({id:`${a}-route3-${e}`,source:`${a}-route-${e}`,type:"line",paint:{"line-width":.2,"line-blur":1,"line-opacity":1,"line-color":"#fafdff"}}),t.addLayer({id:`${a}-point-${e}`,source:`${a}-point-${e}`,type:"symbol",layout:{"icon-image":o?a+"-pnt":`${a}-dot-${e}`,"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),t.addLayer({id:`${a}-dot-${e}`,type:"symbol",source:`${a}-dot-${e}`,layout:{"icon-image":a+"-dot","icon-allow-overlap":!0}});const d=this;!function(){let r=new Image(17,32);const n=d.color.replace("#","").match(/.{1,2}/g),i=[parseInt(n[0],16),parseInt(n[1],16),parseInt(n[2],16)],s=document.createElement("canvas");s.width=17,s.height=32;const u=s.getContext("2d");r.onload=function(){u.drawImage(r,0,0,17,32);const n=u.getImageData(0,0,17,32);for(let t=0;t<n.data.length;t+=4)n.data[t]=i[0],n.data[t+1]=i[1],n.data[t+2]=i[2];u.putImageData(n,0,0);const o=s.toDataURL("data:image/png");o&&t.loadImage(o,((r,n)=>{if(r)throw r;t.addImage("newPic",n),t.setLayoutProperty(`${a}-point-${e}`,"icon-image","newPic"),t.setLayoutProperty(`${a}-point-${e}`,"icon-size",1)}))},r.src=o}();let p=0;!function r(){f.features.forEach(((e,r)=>{e.geometry.coordinates=h.features[r].geometry.coordinates[p],e.properties.bearing=turf.bearing(turf.point(convertCoor(h.features[r].geometry.coordinates[p>=s?p-1:p],t._projection)),turf.point(convertCoor(h.features[r].geometry.coordinates[p>=s?p:p+1],t._projection)))})),t.getSource(`${a}-point-${e}`)&&t.getSource(`${a}-point-${e}`).setData(f),p>s-6?p=0:p+=1,requestAnimationFrame(r)}()}_addIcon(){let{map:t,prefix:e,pointImgUrl:r,color:n}=this;if(!t.hasImage(e+"-dot")){const r=200,i={width:r,height:r,data:new Uint8Array(r*r*4),onAdd:function(){const t=document.createElement("canvas");t.width=this.width,t.height=this.height,this.context=t.getContext("2d")},render:function(){const e=r/3*.2,i=this.context;return i.clearRect(0,0,this.width,this.height),i.beginPath(),i.shadowColor=n,i.shadowBlur=3*e,i.shadowOffsetX=0,i.shadowOffsetY=0,i.beginPath(),i.arc(this.width/2,this.height/2,e,0,2*Math.PI),i.fillStyle=n,i.fill(),this.data=i.getImageData(0,0,this.width,this.height).data,t.triggerRepaint(),!0}};t.addImage(e+"-dot",i,{pixelRatio:2})}t.hasImage(e+"-pnt")&&t.removeImage(e+"-pnt"),t.loadImage(r,((r,n)=>{if(r)throw r;t.addImage(e+"-pnt",n,{pixelRatio:2})}))}_getData(t,e){let r=t[0],n=t[1],i=Math.PI/4,a=[];function o(t,e){let r;if(e[0]===t[0])r=e[1]>t[1]?0:180;else{let n=Math.atan((e[1]-t[1])/(e[0]-t[0]));r=t[0]<e[0]?-n+Math.PI/2:-n+3*Math.PI/2}return 180*r/Math.PI}let s=function(t,e,r){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))/(2*Math.sin(r/2))}(r,n,i),u=function(t,e,r){let n=0,i=0;if(t[0]===e[0])n=t[0]-Math.sqrt(r*r-Math.pow(Math.abs(e[1]-t[1])/2,2)),e[1]>t[1]&&(n=t[0]+Math.sqrt(r*r-Math.pow(Math.abs(e[1]-t[1])/2,2))),i=(t[1]+e[1])/2;else if(t[1]===e[1])n=(t[0]+e[0])/2,i=t[1]-Math.sqrt(r*r-Math.pow(Math.abs(e[0]-t[0])/2,2)),e[0]<t[0]&&(i=t[1]+Math.sqrt(r*r-Math.pow(Math.abs(e[0]-t[0])/2,2)));else{let a=[(t[0]+e[0])/2,(t[1]+e[1])/2],s=(t[0]-e[0])/(e[1]-t[1]),u=1+s*s,l=-2*a[0]-s*s*(t[0]+e[0]),c=a[0]*a[0]+s*s*(t[0]+e[0])*(t[0]+e[0])/4-(r*r-((a[0]-t[0])*(a[0]-t[0])+(a[1]-t[1])*(a[1]-t[1]))),h=1,f=o(t,e);(f<90||f>270)&&(h=-1),n=(-1*l-h*Math.sqrt(l*l-4*u*c))/(2*u),i=s*n-s*a[0]+a[1]}return[n,i]}(r,n,s),l=o(u,r);l=l*Math.PI/180;for(let t=0;t<e;t++){let r=l+i*t/e,n=u[0]+Math.sin(r)*s,o=u[1]+Math.cos(r)*s;a.push([n,o])}return a}_removeAllSource(){const{prefix:t,id:e,map:r}=this;[`${t}-dot-${e}`,`${t}-route-${e}`,`${t}-point-${e}`].forEach((t=>{r.getSource(t)&&r.removeSource(t)}))}_removeAllLayers(){const{prefix:t,id:e,map:r}=this;[`${t}-route-${e}`,`${t}-route2-${e}`,`${t}-route3-${e}`,`${t}-point-${e}`,`${t}-dot-${e}`].forEach((t=>{r.getLayer(t)&&r.removeLayer(t)}))}remove(){this._removeAllLayers(),this._removeAllSource()}}const version="2.8.0";var hls=createCommonjsModule((function(t,e){var r;"undefined"!=typeof window&&(r=function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist/",r(r.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
	  !*** ./node_modules/eventemitter3/index.js ***!
	  \*********************************************/
/*! no static exports found */function(t,e,r){var n=Object.prototype.hasOwnProperty,i="~";function a(){}function o(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,r,n,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new o(r,n||t,a),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0==--t._eventsCount?t._events=new a:delete t._events[e]}function l(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),l.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)n.call(t,e)&&r.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},l.prototype.listeners=function(t){var e=this._events[i?i+t:t];if(!e)return[];if(e.fn)return[e.fn];for(var r=0,n=e.length,a=new Array(n);r<n;r++)a[r]=e[r].fn;return a},l.prototype.listenerCount=function(t){var e=this._events[i?i+t:t];return e?e.fn?1:e.length:0},l.prototype.emit=function(t,e,r,n,a,o){var s=i?i+t:t;if(!this._events[s])return!1;var u,l,c=this._events[s],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,n),!0;case 5:return c.fn.call(c.context,e,r,n,a),!0;case 6:return c.fn.call(c.context,e,r,n,a,o),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,d=c.length;for(l=0;l<d;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,n);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},l.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},l.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},l.prototype.removeListener=function(t,e,r,n){var a=i?i+t:t;if(!this._events[a])return this;if(!e)return u(this,a),this;var o=this._events[a];if(o.fn)o.fn!==e||n&&!o.once||r&&o.context!==r||u(this,a);else{for(var s=0,l=[],c=o.length;s<c;s++)(o[s].fn!==e||n&&!o[s].once||r&&o[s].context!==r)&&l.push(o[s]);l.length?this._events[a]=1===l.length?l[0]:l:u(this,a)}return this},l.prototype.removeAllListeners=function(t){var e;return t?this._events[e=i?i+t:t]&&u(this,e):(this._events=new a,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,t.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
	  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
	  \*****************************************************/
/*! no static exports found */function(t,e,r){var n,i,a,o,s;n=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,t.exports=s={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return r.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var u=i.exec(o.path);o.netLoc=u[1],o.path=u[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(l.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+a.path;l.path=s.normalizePath(h)}else l.path=o.path,a.params||(l.params=o.params,a.query||(l.query=o.query));return null===l.path&&(l.path=r.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(l)},parseURL:function(t){var e=n.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(o,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
	  !*** ./node_modules/webworkify-webpack/index.js ***!
	  \**************************************************/
/*! no static exports found */function(t,e,r){function n(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r.oe=function(t){throw console.error(t),t};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,n){var o={};o[n]=[];var s=e.toString(),u=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return o;for(var l,c=u[1],h=new RegExp("(\\\\n|\\W)"+a(c)+i,"g");l=h.exec(s);)"dll-reference"!==l[3]&&o[n].push(l[3]);for(h=new RegExp("\\("+a(c)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+i,"g");l=h.exec(s);)t[l[2]]||(o[n].push(l[1]),t[l[2]]=r(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);for(var f=Object.keys(o),d=0;d<f.length;d++)for(var p=0;p<o[f[d]].length;p++)isNaN(1*o[f[d]][p])||(o[f[d]][p]=1*o[f[d]][p]);return o}function s(t){return Object.keys(t).reduce((function(e,r){return e||t[r].length>0}),!1)}t.exports=function(t,e){var i={main:r.m},a=(e=e||{}).all?{main:Object.keys(i.main)}:function(t,e){for(var r={main:[e]},n={main:[]},i={main:{}};s(r);)for(var a=Object.keys(r),u=0;u<a.length;u++){var l=a[u],c=r[l].pop();if(i[l]=i[l]||{},!i[l][c]&&t[l][c]){i[l][c]=!0,n[l]=n[l]||[],n[l].push(c);for(var h=o(t,t[l][c],l),f=Object.keys(h),d=0;d<f.length;d++)r[f[d]]=r[f[d]]||[],r[f[d]]=r[f[d]].concat(h[f[d]])}}return n}(i,t),u="";Object.keys(a).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;a[t][e];)e++;a[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+t+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),u=u+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var l=new window.Blob([u],{type:"text/javascript"});if(e.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),h=new window.Worker(c);return h.objectURL=c,h}},"./src/config.ts":
/*!***********************!*\
	  !*** ./src/config.ts ***!
	  \***********************/
/*! exports provided: hlsDefaultConfig, mergeConfig, enableStreamingMode */function(t,e,r){r.r(e),r.d(e,"hlsDefaultConfig",(function(){return M})),r.d(e,"mergeConfig",(function(){return A})),r.d(e,"enableStreamingMode",(function(){return E}));var n=r(/*! ./controller/abr-controller */"./src/controller/abr-controller.ts"),i=r(/*! ./controller/audio-stream-controller */"./src/controller/audio-stream-controller.ts"),a=r(/*! ./controller/audio-track-controller */"./src/controller/audio-track-controller.ts"),o=r(/*! ./controller/subtitle-stream-controller */"./src/controller/subtitle-stream-controller.ts"),s=r(/*! ./controller/subtitle-track-controller */"./src/controller/subtitle-track-controller.ts"),u=r(/*! ./controller/buffer-controller */"./src/controller/buffer-controller.ts"),l=r(/*! ./controller/timeline-controller */"./src/controller/timeline-controller.ts"),c=r(/*! ./controller/cap-level-controller */"./src/controller/cap-level-controller.ts"),h=r(/*! ./controller/fps-controller */"./src/controller/fps-controller.ts"),f=r(/*! ./controller/eme-controller */"./src/controller/eme-controller.ts"),d=r(/*! ./controller/cmcd-controller */"./src/controller/cmcd-controller.ts"),p=r(/*! ./utils/xhr-loader */"./src/utils/xhr-loader.ts"),m=r(/*! ./utils/fetch-loader */"./src/utils/fetch-loader.ts"),v=r(/*! ./utils/cues */"./src/utils/cues.ts"),g=r(/*! ./utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts"),y=r(/*! ./utils/logger */"./src/utils/logger.ts");function _(){return _=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_.apply(this,arguments)}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){w(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function w(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var M=x(x({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:n.default,bufferController:u.default,capLevelController:c.default,fpsController:h.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0},{cueHandler:v.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:o.SubtitleStreamController,subtitleTrackController:s.default,timelineController:l.TimelineController,audioStreamController:i.default,audioTrackController:a.default,emeController:f.default,cmcdController:d.default});function A(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return _({},t,e)}function E(t){var e=t.loader;e!==m.default&&e!==p.default?(y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Object(m.fetchSupported)()&&(t.loader=m.default,t.progressive=!0,t.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":
/*!******************************************!*\
	  !*** ./src/controller/abr-controller.ts ***!
	  \******************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/ewma-bandwidth-estimator */"./src/utils/ewma-bandwidth-estimator.ts"),a=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),s=r(/*! ../errors */"./src/errors.ts"),u=r(/*! ../types/loader */"./src/types/loader.ts"),l=r(/*! ../utils/logger */"./src/utils/logger.ts");var c=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var e=t.config;this.bwEstimator=new i.default(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var e,r=t.prototype;return r.registerListeners=function(){var t=this.hls;t.on(a.Events.FRAG_LOADING,this.onFragLoading,this),t.on(a.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(a.Events.FRAG_LOADING,this.onFragLoading,this),t.off(a.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.Events.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},r.onFragLoading=function(t,e){var r,n=e.frag;n.type===u.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=null!=(r=e.part)?r:null,this.timer=self.setInterval(this.onCheck,100)))},r.onLevelLoaded=function(t,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},r._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,s=r.config,u=r.media;if(t&&u){var c=e?e.stats:t.stats,h=e?e.duration:t.duration;if(c.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!u.paused&&u.playbackRate&&u.readyState){var f=performance.now()-c.loading.start,d=Math.abs(u.playbackRate);if(!(f<=500*h/d)){var p=r.levels,m=r.minAutoLevel,v=c.total||Math.max(c.loaded,Math.round(h*p[t.level].maxBitrate/8)),g=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/f),y=(v-c.loaded)/g,_=u.currentTime,b=(o.BufferHelper.bufferInfo(u,_,s.maxBufferHole).end-_)/d;if(!(b>=2*h/d||y<=b)){var x,w=Number.POSITIVE_INFINITY;for(x=t.level-1;x>m&&!((w=h*p[x].maxBitrate/(6.4*g))<b);x--);if(!(w>=y)){var M=this.bwEstimator.getEstimate();l.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+"\n      Current BW estimate: "+(Object(n.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+w.toFixed(3)+" s\n      Time to underbuffer: "+b.toFixed(3)+" s"),r.nextLoadLevel=x,this.bwEstimator.sample(f,c.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),r.trigger(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:c})}}}}}},r.onFragLoaded=function(t,e){var r=e.frag,i=e.part;if(r.type===u.PlaylistLevelType.MAIN&&Object(n.isFiniteNumber)(r.sn)){var o=i?i.stats:r.stats,s=i?i.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[r.level],c=(l.loaded?l.loaded.bytes:0)+o.loaded,h=(l.loaded?l.loaded.duration:0)+s;l.loaded={bytes:c,duration:h},l.realBitrate=Math.round(8*c/h)}r.bitrateTest&&(this.onFragBuffered(a.Events.FRAG_BUFFERED,{stats:o,frag:r,part:i,id:r.type}),r.bitrateTest=!1)}},r.onFragBuffered=function(t,e){var r=e.frag,n=e.part,i=n?n.stats:r.stats;if(!i.aborted&&r.type===u.PlaylistLevelType.MAIN&&"initSegment"!==r.sn){var a=i.parsing.end-i.loading.start;this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?a/1e3:0}},r.onError=function(t,e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},r.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},r.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,n=r.maxAutoLevel,i=r.config,a=r.minAutoLevel,s=r.media,u=e?e.duration:t?t.duration:0,c=s?s.currentTime:0,h=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,d=(o.BufferHelper.bufferInfo(s,c,i.maxBufferHole).end-c)/h,p=this.findBestLevel(f,a,n,d,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(p>=0)return p;l.logger.trace((d?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var m=u?Math.min(u,i.maxStarvationDelay):i.maxStarvationDelay,v=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(!d){var y=this.bitrateTestDelay;y&&(m=(u?Math.min(u,i.maxLoadingDelay):i.maxLoadingDelay)-y,l.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),v=g=1)}return p=this.findBestLevel(f,a,n,d+m,v,g),Math.max(p,0)},r.findBestLevel=function(t,e,r,n,i,a){for(var o,s=this.fragCurrent,u=this.partCurrent,c=this.lastLoadedFragLevel,h=this.hls.levels,f=h[c],d=!(null==f||null===(o=f.details)||void 0===o||!o.live),p=null==f?void 0:f.codecSet,m=u?u.duration:s?s.duration:0,v=r;v>=e;v--){var g=h[v];if(g&&(!p||g.codecSet===p)){var y,_=g.details,b=(u?null==_?void 0:_.partTarget:null==_?void 0:_.averagetargetduration)||m,x=h[v].maxBitrate,w=x*b/(y=v<=c?i*t:a*t);if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+v+"/"+Math.round(y)+"/"+x+"/"+b+"/"+n+"/"+w),y>x&&(!w||d&&!this.bitrateTestDelay||w<n))return v}}return-1},(e=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var r=this.getNextABRAutoLevel();return-1!==t&&(r=Math.min(t,r)),r},set:function(t){this._nextAutoLevel=t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}();e.default=c},"./src/controller/audio-stream-controller.ts":
/*!***************************************************!*\
	  !*** ./src/controller/audio-stream-controller.ts ***!
	  \***************************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),a=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),s=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),u=r(/*! ../types/level */"./src/types/level.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),h=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts"),f=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),d=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),p=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),m=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),v=r(/*! ../errors */"./src/errors.ts"),g=r(/*! ../utils/logger */"./src/utils/logger.ts");function y(){return y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},y.apply(this,arguments)}function _(t,e){return _=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_(t,e)}var b=function(t){var e,r;function b(e,r){var n;return(n=t.call(this,e,r,"[audio-stream-controller]")||this).videoBuffer=null,n.videoTrackCC=-1,n.waitingVideoCC=-1,n.audioSwitch=!1,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.bufferFlushed=!1,n._registerListeners(),n}r=t,(e=b).prototype=Object.create(r.prototype),e.prototype.constructor=e,_(e,r);var x=b.prototype;return x.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},x._registerListeners=function(){var t=this.hls;t.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(a.Events.ERROR,this.onError,this),t.on(a.Events.BUFFER_RESET,this.onBufferReset,this),t.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x._unregisterListeners=function(){var t=this.hls;t.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(a.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(a.Events.ERROR,this.onError,this),t.off(a.Events.BUFFER_RESET,this.onBufferReset,this),t.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(a.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},x.onInitPtsFound=function(t,e){var r=e.frag,n=e.initPTS;if("main"===e.id){var a=r.cc;this.initPTS[r.cc]=n,this.log("InitPTS for cc: "+a+" found from main: "+n),this.videoTrackCC=a,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},x.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=i.State.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},x.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var e,r=this.levels,n=null==r||null===(e=r[this.trackId])||void 0===e?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var a,s=performance.now(),u=this.retryDate;(!u||s>=u||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var l=this.waitingData;if(l){var c=l.frag,h=l.part,f=l.cache,d=l.complete;if(void 0!==this.initPTS[c.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var m={frag:c,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(m),d&&t.prototype._handleFragmentLoadComplete.call(this,m)}else if(this.videoTrackCC!==this.waitingVideoCC)g.logger.log("Waiting fragment cc ("+c.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var v=this.getLoadPosition(),y=o.BufferHelper.bufferInfo(this.mediaBuffer,v,this.config.maxBufferHole);Object(p.fragmentWithinToleranceTest)(y.end,this.config.maxFragLookUpTolerance,c)<0&&(g.logger.log("Waiting fragment cc ("+c.cc+") @ "+c.start+" cancelled because another fragment at "+y.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},x.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},x.onTickEnd=function(){var t=this.media;t&&t.readyState&&(!this.loadedmetadata&&(this.mediaBuffer?this.mediaBuffer:t).buffered.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime)},x.doTickIdle=function(){var t,e,r=this.hls,n=this.levels,o=this.media,s=this.trackId;if(n&&n[s]&&(o||!this.startFragRequested&&r.config.startFragPrefetch)){var u=n[s].details;if(!u||u.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(u))this.state=i.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,l.PlaylistLevelType.AUDIO));var h=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,l.PlaylistLevelType.AUDIO);if(null!==h){var f=h.len,d=this.getMaxBufferLength(),p=this.audioSwitch;if(!(f>=d)||p){if(!p&&this._streamEnded(h,u))return r.trigger(a.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var m=u.fragments[0].start,v=h.end;if(p){var g=this.getLoadPosition();v=g,u.PTSKnown&&g<m&&(h.end>m||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=m+.05)}var y=this.getNextFragment(v,u);y?"identity"!==(null===(t=y.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=y.decryptdata)&&void 0!==e&&e.key?this.loadFragment(y,u,v):this.loadKey(y,u):this.bufferFlushed=!0}}}}},x.getMaxBufferLength=function(){var e=t.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,l.PlaylistLevelType.MAIN);return null===r?e:Math.max(e,r.len)},x.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},x.onAudioTracksUpdated=function(t,e){var r=e.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(t){return new u.Level(t)}))},x.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;var n=this.fragCurrent;null!=n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},x.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},x.onLevelLoaded=function(t,e){this.mainDetails=e.details},x.onAudioTrackLoaded=function(t,e){var r,n=this.levels,a=e.details,o=e.id;if(n){this.log("Track "+o+" loaded ["+a.startSN+","+a.endSN+"],duration:"+a.totalduration);var s=n[o],u=0;if(a.live||null!==(r=s.details)&&void 0!==r&&r.live){var l=this.mainDetails;if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed||!l)return;!s.details&&a.hasProgramDateTime&&l.hasProgramDateTime?(Object(m.alignMediaPlaylistByPDT)(a,l),u=a.fragments[0].start):u=this.alignPlaylists(a,s.details)}s.details=a,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&a.live||this.setStartPosition(s.details,u),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(a)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+o)},x._handleFragmentLoadProgress=function(t){var e,r=t.frag,n=t.part,a=t.payload,o=this.config,s=this.trackId,u=this.levels;if(u){var c=u[s];console.assert(c,"Audio track is defined on fragment load progress");var p=c.details;console.assert(p,"Audio track details are defined on fragment load progress");var m=o.defaultAudioCodec||c.audioCodec||"mp4a.40.2",v=this.transmuxer;v||(v=this.transmuxer=new f.default(this.hls,l.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var y=this.initPTS[r.cc],_=null===(e=r.initSegment)||void 0===e?void 0:e.data;if(void 0!==y){var b=n?n.index:-1,x=new d.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,a.byteLength,b,-1!==b);v.push(a,_,m,"",r,n,p.totalduration,!1,x,y)}else g.logger.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+s),(this.waitingData=this.waitingData||{frag:r,part:n,cache:new h.default,complete:!1}).cache.push(new Uint8Array(a)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},x._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},x.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},x.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},x.onFragBuffered=function(t,e){var r=e.frag,n=e.part;r.type===l.PlaylistLevelType.AUDIO&&(this.fragContextChanged(r)?this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==r.sn&&(this.fragPrevious=r,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(r,n)))},x.onError=function(e,r){switch(r.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:case v.ErrorDetails.KEY_LOAD_ERROR:case v.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.AUDIO,r);break;case v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=r.fatal?i.State.ERROR:i.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case v.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var n=!0,a=this.getFwdBufferInfo(this.mediaBuffer,l.PlaylistLevelType.AUDIO);a&&a.len>.5&&(n=!this.reduceMaxBufferLength(a.len)),n&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},x.onBufferFlushed=function(t,e){e.type===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},x._handleTransmuxComplete=function(t){var e,r="audio",n=this.hls,o=t.remuxResult,s=t.chunkMeta,u=this.getCurrentContext(s);if(!u)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(s.level);var l=u.frag,h=u.part,f=o.audio,d=o.text,p=o.id3,m=o.initSegment;if(!this.fragContextChanged(l)){if(this.state=i.State.PARSING,this.audioSwitch&&f&&this.completeAudioSwitch(),null!=m&&m.tracks&&(this._bufferInitSegment(m.tracks,l,s),n.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:r,tracks:m.tracks})),f){var v=f.startPTS,g=f.endPTS,_=f.startDTS,b=f.endDTS;h&&(h.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:v,endPTS:g,startDTS:_,endDTS:b}),l.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,v,g,_,b),this.bufferFragmentData(f,l,h,s)}if(null!=p&&null!==(e=p.samples)&&void 0!==e&&e.length){var x=y({frag:l,id:r},p);n.trigger(a.Events.FRAG_PARSING_METADATA,x)}if(d){var w=y({frag:l,id:r},d);n.trigger(a.Events.FRAG_PARSING_USERDATA,w)}}},x._bufferInitSegment=function(t,e,r){if(this.state===i.State.PARSING){t.video&&delete t.video;var n=t.audio;if(n){n.levelCodec=n.codec,n.id="audio",this.log("Init audio buffer, container:"+n.container+", codecs[parsed]=["+n.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,t);var o=n.initSegment;null!=o&&o.byteLength&&this.hls.trigger(a.Events.BUFFER_APPENDING,{type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:o}),this.tick()}}},x.loadFragment=function(e,r,a){var o=this.fragmentTracker.getState(e);this.fragCurrent=e,(this.audioSwitch||o===s.FragmentState.NOT_LOADED||o===s.FragmentState.PARTIAL)&&("initSegment"===e.sn?this._loadInitSegment(e):r.live&&!Object(n.isFiniteNumber)(this.initPTS[e.cc])?(this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,a)))},x.completeAudioSwitch=function(){var e=this.hls,r=this.trackId;this.media&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,e.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:r})},b}(i.default);e.default=b},"./src/controller/audio-track-controller.ts":
/*!**************************************************!*\
	  !*** ./src/controller/audio-track-controller.ts ***!
	  \**************************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),o=r(/*! ../types/loader */"./src/types/loader.ts");function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}var u=function(t){var e,r;function a(e){var r;return(r=t.call(this,e,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}r=t,(e=a).prototype=Object.create(r.prototype),e.prototype.constructor=e,s(e,r);var u,l=a.prototype;return l.registerListeners=function(){var t=this.hls;t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(n.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var t=this.hls;t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(n.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(n.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},l.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},l.onAudioTrackLoaded=function(t,e){var r=e.id,n=e.details,i=this.tracksInGroup[r];if(i){var a=i.details;i.details=e.details,this.log("audioTrack "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,a))}else this.warn("Invalid audio track id "+r)},l.onLevelLoading=function(t,e){this.switchLevel(e.level)},l.onLevelSwitching=function(t,e){this.switchLevel(e.level)},l.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.audioGroupIds){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var i=this.tracks.filter((function(t){return!r||t.groupId===r}));this.selectDefaultTrack&&!i.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var a={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(n.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},l.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===o.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},l.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+t);var i=e[t],a=i.id,o=i.groupId,s=void 0===o?"":o,u=i.name,l=i.type,c=i.url;if(this.trackId=t,this.trackName=u,this.selectDefaultTrack=!1,this.hls.trigger(n.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:s,name:u,type:l,url:c}),!i.details||i.details.live){var h=this.switchParams(i.url,null==r?void 0:r.details);this.loadPlaylist(h)}}},l.selectInitialTrack=function(){console.assert(this.tracksInGroup.length,"Initial audio track should be selected when tracks are known");var t=this.findTrackId(this.trackName)||this.findTrackId();-1!==t?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},l.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var n=e[r];if((!this.selectDefaultTrack||n.default)&&(!t||t===n.name))return n.id}return-1},l.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,i=e.groupId,a=e.url;if(t)try{a=t.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+r),this.clearTimer(),this.hls.trigger(n.Events.AUDIO_TRACK_LOADING,{url:a,id:r,groupId:i,deliveryDirectives:t||null})}},(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(a.prototype,u),a}(a.default);e.default=u},"./src/controller/base-playlist-controller.ts":
/*!****************************************************!*\
	  !*** ./src/controller/base-playlist-controller.ts ***!
	  \****************************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return u}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../types/level */"./src/types/level.ts"),a=r(/*! ./level-helper */"./src/controller/level-helper.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../errors */"./src/errors.ts"),u=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=o.logger.log.bind(o.logger,e+":"),this.warn=o.logger.warn.bind(o.logger,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){e.fatal&&e.type===s.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var r=null==e?void 0:e.renditionReports;if(r)for(var a=0;a<r.length;a++){var o=r[a],s=""+o.URI;if(s===t.substr(-s.length)){var u=parseInt(o["LAST-MSN"]),l=parseInt(o["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var c=Math.min(e.age-e.partTarget,e.targetduration);void 0!==l&&c>e.partTarget&&(l+=1)}if(Object(n.isFiniteNumber)(u))return new i.HlsUrlParameters(u,Object(n.isFiniteNumber)(l)?l:void 0,i.HlsSkip.No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,r){var n=this,i=e.details,o=e.stats,s=o.loading.end?Math.max(0,self.performance.now()-o.loading.end):0;if(i.advancedDateTime=Date.now()-s,i.live||null!=r&&r.live){if(i.reloaded(r),r&&this.log("live playlist "+t+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),r&&i.fragments.length>0&&Object(a.mergeDetails)(r,i),!this.canLoad||!i.live)return;var u,l=void 0,c=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var h=this.hls.config.lowLatencyMode,f=i.lastPartSn,d=i.endSN,p=i.lastPartIndex,m=f===d;-1!==p?(l=m?d+1:f,c=m?h?0:p:p+1):l=d+1;var v=i.age,g=Math.min(v+i.ageHeader-i.partTarget,1.5*i.targetduration);if(g>0){if(r&&g>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+g+" with playlist age: "+i.age),g=0;else{var y=Math.floor(g/i.targetduration);l+=y,void 0!==c&&(c+=Math.round(g%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+g+" skip sn "+y+" to part "+c)}i.tuneInGoal=g}if(u=this.getDeliveryDirectives(i,e.deliveryDirectives,l,c),h||!m)return void this.loadPlaylist(u)}else u=this.getDeliveryDirectives(i,e.deliveryDirectives,l,c);var _=Object(a.computeReloadInterval)(i,o);void 0!==l&&i.canBlockReload&&(_-=i.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout((function(){return n.loadPlaylist(u)}),_)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,r,n){var a=Object(i.getSkipValue)(t,r);return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,n=e.part,a=i.HlsSkip.No),new i.HlsUrlParameters(r,n,a)},e.retryLoadingOrFail=function(t){var e,r=this,n=this.hls.config,i=this.retryCount<n.levelLoadingMaxRetry;if(i)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var a=Math.min(Math.pow(2,this.retryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),a),this.warn("retry playlist loading #"+this.retryCount+" in "+a+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return i},t}()},"./src/controller/base-stream-controller.ts":
/*!**************************************************!*\
	  !*** ./src/controller/base-stream-controller.ts ***!
	  \**************************************************/
/*! exports provided: State, default */function(t,e,r){r.r(e),r.d(e,"State",(function(){return b})),r.d(e,"default",(function(){return x}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../task-loop */"./src/task-loop.ts"),a=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),o=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),s=r(/*! ../utils/logger */"./src/utils/logger.ts"),u=r(/*! ../events */"./src/events.ts"),l=r(/*! ../errors */"./src/errors.ts"),c=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),h=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),f=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),d=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),p=r(/*! ./level-helper */"./src/controller/level-helper.ts"),m=r(/*! ../loader/fragment-loader */"./src/loader/fragment-loader.ts"),v=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),g=r(/*! ../utils/time-ranges */"./src/utils/time-ranges.ts"),y=r(/*! ../types/loader */"./src/types/loader.ts");function _(t,e){return _=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_(t,e)}var b={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},x=function(t){var e,r;function i(e,r,n){var i;return(i=t.call(this)||this).hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=b.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=n,i.log=s.logger.log.bind(s.logger,n+":"),i.warn=s.logger.warn.bind(s.logger,n+":"),i.hls=e,i.fragmentLoader=new m.default(e.config),i.fragmentTracker=r,i.config=e.config,i.decrypter=new v.default(e,e.config),e.on(u.Events.KEY_LOADED,i.onKeyLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,_(e,r);var x,w=i.prototype;return w.doTick=function(){this.onTickEnd()},w.onTickEnd=function(){},w.startLoad=function(t){},w.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.STOPPED},w._streamEnded=function(t,e){var r=this.fragCurrent,n=this.fragmentTracker;if(!e.live&&r&&r.sn>=e.endSN&&!t.nextStart){var i=e.partList;if(null!=i&&i.length){var s=i[i.length-1];return o.BufferHelper.isBuffered(this.media,s.start+s.duration/2)}var u=n.getState(r);return u===a.FragmentState.PARTIAL||u===a.FragmentState.OK}return!1},w.onMediaAttached=function(t,e){var r=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===b.STOPPED&&this.startLoad(n.startPosition)},w.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},w.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,i=this.state,a=r?r.currentTime:0,s=o.BufferHelper.bufferInfo(this.mediaBuffer||r,a,t.maxBufferHole);if(this.log("media seeking to "+(Object(n.isFiniteNumber)(a)?a.toFixed(3):a)+", state: "+i),i===b.ENDED)this.resetLoadingState();else if(e&&!s.len){var u=t.maxFragLookUpTolerance,l=a>e.start+e.duration+u;(a<e.start-u||l)&&(l&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())}r&&(this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},w.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},w.onKeyLoaded=function(t,e){if(this.state===b.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels){this.state=b.IDLE;var r=this.levels[e.frag.level].details;r&&this.loadFragment(e.frag,r,e.frag.start)}},w.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},w.onHandlerDestroyed=function(){this.state=b.STOPPED,this.hls.off(u.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},w.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=b.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(u.Events.KEY_LOADING,{frag:t})},w.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},w._loadFragForPlayback=function(t,e,r){var n=this;this._doFragLoad(t,e,r,(function(e){if(n.fragContextChanged(t))return n.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void n.fragmentTracker.removeFragment(t);t.stats.chunkCount++,n._handleFragmentLoadProgress(e)})).then((function(e){if(e){n.fragLoadError=0;var r=n.state;if(!n.fragContextChanged(t))return"payload"in e&&(n.log("Loaded fragment "+t.sn+" of level "+t.level),n.hls.trigger(u.Events.FRAG_LOADED,e),n.state===b.BACKTRACKING)?(n.fragmentTracker.backtrack(t,e),void n.resetFragmentLoading(t)):void n._handleFragmentLoadComplete(e);(r===b.FRAG_LOADING||r===b.BACKTRACKING||!n.fragCurrent&&r===b.PARSING)&&(n.fragmentTracker.removeFragment(t),n.state=b.IDLE)}})).catch((function(e){n.warn(e),n.resetFragmentLoading(t)}))},w.flushMainBuffer=function(t,e,r){if(void 0===r&&(r=null),t-e){var n={startOffset:t,endOffset:e,type:r};this.fragLoadError=0,this.hls.trigger(u.Events.BUFFER_FLUSHING,n)}},w._loadInitSegment=function(t){var e=this;this._doFragLoad(t).then((function(r){if(!r||e.fragContextChanged(t)||!e.levels)throw new Error("init load aborted");return r})).then((function(r){var n=e.hls,i=r.payload,a=t.decryptdata;if(i&&i.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var o=self.performance.now();return e.decrypter.webCryptoDecrypt(new Uint8Array(i),a.key.buffer,a.iv.buffer).then((function(e){var i=self.performance.now();return n.trigger(u.Events.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:o,tdecrypt:i}}),r.payload=e,r}))}return r})).then((function(r){var n=e.fragCurrent,i=e.hls,a=e.levels;if(!a)throw new Error("init load aborted, missing levels");console.assert(a[t.level].details,"Level details are defined when init segment is loaded");var o=t.stats;e.state=b.IDLE,e.fragLoadError=0,t.data=new Uint8Array(r.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),r.frag===n&&i.trigger(u.Events.FRAG_BUFFERED,{stats:o,frag:n,part:null,id:t.type}),e.tick()})).catch((function(r){e.warn(r),e.resetFragmentLoading(t)}))},w.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},w.fragBufferedComplete=function(t,e){this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+g.default.toString(o.BufferHelper.getBuffered(this.mediaBuffer?this.mediaBuffer:this.media))),this.state=b.IDLE,this.tick()},w._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var r=t.frag,n=t.part,i=t.partsLoaded,a=!i||0===i.length||i.some((function(t){return!t})),o=new c.ChunkMetadata(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);e.flush(o)}},w._handleFragmentLoadProgress=function(t){},w._doFragLoad=function(t,e,r,i){var a=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");if(r=Math.max(t.start,r||0),this.config.lowLatencyMode&&e){var o=e.partList;if(o&&i){r>t.end&&e.fragmentHint&&(t=e.fragmentHint);var s=this.getNextPart(o,t,r);if(s>-1){var l=o[s];return this.log("Loading part sn: "+t.sn+" p: "+l.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+s+"-"+(o.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=l.start+l.duration,this.state=b.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:t,part:o[s],targetBufferTime:r}),this.doFragPartsLoad(t,o,s,i).catch((function(t){return a.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(o,r))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),Object(n.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=b.FRAG_LOADING,this.hls.trigger(u.Events.FRAG_LOADING,{frag:t,targetBufferTime:r}),this.fragmentLoader.load(t,i).catch((function(t){return a.handleFragLoadError(t)}))},w.doFragPartsLoad=function(t,e,r,n){var i=this;return new Promise((function(a,o){var s=[];!function r(l){var c=e[l];i.fragmentLoader.loadPart(t,c,n).then((function(n){s[c.index]=n;var o=n.part;i.hls.trigger(u.Events.FRAG_LOADED,n);var h=e[l+1];if(!h||h.fragment!==t)return a({frag:t,part:o,partsLoaded:s});r(l+1)})).catch(o)}(r)}))},w.handleFragLoadError=function(t){var e=t.data;return e&&e.details===l.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(u.Events.ERROR,e),null},w._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===b.PARSING){var r=e.frag,n=e.part,i=e.level,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(r,n,i,t.partial)}else this.fragCurrent||(this.state=b.IDLE)},w.getCurrentContext=function(t){var e=this.levels,r=t.level,n=t.sn,i=t.part;if(!e||!e[r])return this.warn("Levels object was unset while buffering fragment "+n+" of level "+r+". The current chunk will not be buffered."),null;var a=e[r],o=i>-1?Object(p.getPartWith)(a,n,i):null,s=o?o.fragment:Object(p.getFragmentWithSN)(a,n,this.fragCurrent);return s?{frag:s,part:o,level:a}:null},w.bufferFragmentData=function(t,e,r,n){if(t&&this.state===b.PARSING){var i=t.data1,a=t.data2,o=i;i&&a&&(o=Object(h.appendUint8Array)(i,a)),o&&o.length&&(this.hls.trigger(u.Events.BUFFER_APPENDING,{type:t.type,frag:e,part:r,chunkMeta:n,parent:e.type,data:o}),t.dropped&&t.independent&&!r&&this.flushBufferGap(e))}},w.flushBufferGap=function(t){var e=this.media;if(e)if(o.BufferHelper.isBuffered(e,e.currentTime)){var r=e.currentTime,n=o.BufferHelper.bufferInfo(e,r,0),i=Math.min(2*this.config.maxFragLookUpTolerance,.25*t.duration),a=Math.max(Math.min(t.start-i,n.end-i),r+i);t.start-a>i&&this.flushMainBuffer(a,t.start)}else this.flushMainBuffer(0,t.start)},w.getFwdBufferInfo=function(t,e){var r=this.config,i=this.getLoadPosition();if(!Object(n.isFiniteNumber)(i))return null;var a=o.BufferHelper.bufferInfo(t,i,r.maxBufferHole);if(0===a.len&&void 0!==a.nextStart){var s=this.fragmentTracker.getBufferedFrag(i,e);if(s&&a.nextStart<s.end)return o.BufferHelper.bufferInfo(t,i,Math.max(a.nextStart,r.maxBufferHole))}return a},w.getMaxBufferLength=function(t){var e,r=this.config;return e=t?Math.max(8*r.maxBufferSize/t,r.maxBufferLength):r.maxBufferLength,Math.min(e,r.maxMaxBufferLength)},w.reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=(t||e.maxBufferLength)&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},w.getNextFragment=function(t,e){var r,n,i=e.fragments,a=i.length;if(!a)return null;var o,s=this.config,u=i[0].start;if(e.live){var l=s.initialLiveManifestSize;if(a<l)return this.warn("Not enough fragments to start playback (have: "+a+", need: "+l+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(o=this.getInitialLiveFragment(e,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=u&&(o=i[0]);return o||(o=this.getFragmentAtPosition(t,s.lowLatencyMode?e.partEnd:e.fragmentEnd,e)),null===(r=o)||void 0===r||!r.initSegment||null!==(n=o)&&void 0!==n&&n.initSegment.data||this.bitrateTest||(o=o.initSegment),o},w.getNextPart=function(t,e,r){for(var n=-1,i=!1,a=!0,o=0,s=t.length;o<s;o++){var u=t[o];if(a=a&&!u.independent,n>-1&&r<u.start)break;var l=u.loaded;!l&&(i||u.independent||a)&&u.fragment===e&&(n=o),i=l}return n},w.loadedEndOfParts=function(t,e){var r=t[t.length-1];return r&&e>r.start&&r.loaded},w.getInitialLiveFragment=function(t,e){var r=this.fragPrevious,n=null;if(r){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),n=Object(d.findFragmentByPDT)(e,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var i=r.sn+1;if(i>=t.startSN&&i<=t.endSN){var a=e[i-t.startSN];r.cc===a.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(n=a).sn)}n||(n=Object(d.findFragWithCC)(e,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn)}}else{var o=this.hls.liveSyncPosition;null!==o&&(n=this.getFragmentAtPosition(o,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n},w.getFragmentAtPosition=function(t,e,r){var n,i=this.config,o=this.fragPrevious,s=r.fragments,u=r.endSN,l=r.fragmentHint,c=i.maxFragLookUpTolerance,h=!!(i.lowLatencyMode&&r.partList&&l);if(h&&l&&!this.bitrateTest&&(s=s.concat(l),u=l.sn),t<e){var f=t>e-c?0:c;n=Object(d.findFragmentByPTS)(o,s,t,f)}else n=s[s.length-1];if(n){var p=n.sn-r.startSN,m=o&&n.level===o.level,v=s[p+1];if(this.fragmentTracker.getState(n)===a.FragmentState.BACKTRACKED){n=null;for(var g=p;s[g]&&this.fragmentTracker.getState(s[g])===a.FragmentState.BACKTRACKED;)n=o?s[g--]:s[--g];n||(n=v)}else o&&n.sn===o.sn&&!h&&m&&(n.sn<u&&this.fragmentTracker.getState(v)!==a.FragmentState.OK?(this.log("SN "+n.sn+" just loaded, load next one: "+v.sn),n=v):n=null)}return n},w.synchronizeToLiveEdge=function(t){var e=this.config,r=this.media;if(r){var n=this.hls.liveSyncPosition,i=r.currentTime,a=t.edge,o=i>=t.fragments[0].start-e.maxFragLookUpTolerance&&i<=a;null!==n&&r.duration>n&&(i<n||!o)&&(!o&&r.readyState<4||i<a-(void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=n),r.readyState&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+n.toFixed(3)),r.currentTime=n))}},w.alignPlaylists=function(t,e){var r=this.levelLastLoaded,i=this.fragPrevious,a=null!==r?this.levels[r]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var s=t.fragments[0].start,u=!e,l=t.alignedSliding&&Object(n.isFiniteNumber)(s);if(u||!l&&!s){Object(f.alignStream)(i,a,t);var c=t.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(i?i.sn:"na")+" fragments: "+o),c}return s},w.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},w.setStartPosition=function(t,e){var r=this.startPosition;if(r<e&&(r=-1),-1===r||-1===this.lastCurrentTime){var i=t.startTimeOffset;Object(n.isFiniteNumber)(i)?(r=e+i,i<0&&(r+=t.totalduration),r=Math.min(Math.max(e,r),e+t.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?r=this.hls.liveSyncPosition||e:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},w.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},w.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},w.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=b.IDLE)},w.onFragmentOrKeyLoadError=function(t,e){if(!e.fatal){var r=e.frag;if(r&&r.type===t){var n=this.fragCurrent;console.assert(n&&r.sn===n.sn&&r.level===n.level&&r.urlId===n.urlId,"Frag load error must match current frag to retry");var i=this.config;if(this.fragLoadError+1<=i.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(r.level))return;var a=Math.min(Math.pow(2,this.fragLoadError)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);this.warn("Fragment "+r.sn+" of "+t+" "+r.level+" failed to load, retrying in "+a+"ms"),this.retryDate=self.performance.now()+a,this.fragLoadError++,this.state=b.FRAG_LOADING_WAITING_RETRY}else e.levelRetry?(t===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=b.IDLE):(s.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=b.ERROR)}}},w.afterBufferFlushed=function(t,e,r){if(t){var n=o.BufferHelper.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,n,r),this.state===b.ENDED&&this.resetLoadingState()}},w.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=b.IDLE},w.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=this.levels?this.levels[t].details:null;if(null!=e&&e.live)return this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},w.updateLevelTiming=function(t,e,r,n){var i=this,a=r.details;console.assert(!!a,"level.details must be defined"),Object.keys(t.elementaryStreams).reduce((function(e,o){var s=t.elementaryStreams[o];if(s){var l=s.endPTS-s.startPTS;if(l<=0)return i.warn("Could not parse fragment "+t.sn+" "+o+" duration reliably ("+l+") resetting transmuxer to fallback to playlist timing"),i.resetTransmuxer(),e||!1;var c=n?0:Object(p.updateFragPTSDTS)(a,t,s.startPTS,s.endPTS,s.startDTS,s.endDTS);return i.hls.trigger(u.Events.LEVEL_PTS_UPDATED,{details:a,level:r,drift:c,type:o,frag:t,start:s.startPTS,end:s.endPTS}),!0}return e}),!1)?(this.state=b.PARSED,this.hls.trigger(u.Events.FRAG_PARSED,{frag:t,part:e})):this.resetLoadingState()},w.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},(x=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(i.prototype,x),i}(i.default)},"./src/controller/buffer-controller.ts":
/*!*********************************************!*\
	  !*** ./src/controller/buffer-controller.ts ***!
	  \*********************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return d}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../errors */"./src/errors.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),l=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),c=r(/*! ./buffer-operation-queue */"./src/controller/buffer-operation-queue.ts"),h=Object(u.getMediaSource)(),f=/([ha]vc.)(?:\.[^.,]+)+/,d=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,r=e.media,n=e.mediaSource;a.logger.log("[buffer-controller]: Media source opened"),r&&(e.updateMediaElementDuration(),t.trigger(i.Events.MEDIA_ATTACHED,{media:r})),n&&n.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){a.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){a.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.BUFFER_RESET,this.onBufferReset,this),t.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(i.Events.BUFFER_EOS,this.onBufferEos,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(i.Events.FRAG_PARSED,this.onFragParsed,this),t.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.BUFFER_RESET,this.onBufferReset,this),t.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(i.Events.BUFFER_EOS,this.onBufferEos,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(i.Events.FRAG_PARSED,this.onFragParsed,this),t.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,a.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var r=this.media=e.media;if(r&&h){var n=this.mediaSource=new h;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(n),this._objectUrl=r.src}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(a.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){a.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):a.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){var r=t.sourceBuffer[e];try{r&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(r),t.sourceBuffer[e]=void 0)}catch(t){a.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}})),this._initSourceBuffer()},e.onBufferCodecs=function(t,e){var r=this,n=this.getSourceBufferTypes().length;Object.keys(e).forEach((function(t){if(n){var i=r.tracks[t];if(i&&"function"==typeof i.buffer.changeType){var a=e[t],o=a.codec,s=a.levelCodec,u=a.container;(i.levelCodec||i.codec).replace(f,"$1")!==(s||o).replace(f,"$1")&&r.appendChangeType(t,u+";codecs="+(s||o))}}else r.pendingTracks[t]=e[t]})),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(t,e){var r=this,n=this.operationQueue,i={execute:function(){var i=r.sourceBuffer[t];i&&(a.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),i.changeType(e)),n.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){a.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",e)}};n.append(i,t)},e.onBufferAppending=function(t,e){var r=this,n=this.hls,u=this.operationQueue,l=this.tracks,c=e.data,h=e.type,f=e.frag,d=e.part,p=e.chunkMeta,m=p.buffering[h],v=self.performance.now();m.start=v;var g=f.stats.buffering,y=d?d.stats.buffering:null;0===g.start&&(g.start=v),y&&0===y.start&&(y.start=v);var _=l.audio,b="audio"===h&&1===p.id&&"audio/mpeg"===(null==_?void 0:_.container),x={execute:function(){if(m.executeStart=self.performance.now(),b){var t=r.sourceBuffer[h];if(t){var e=f.start-t.timestampOffset;Math.abs(e)>=.1&&(a.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+e+") sn: "+f.sn+")"),t.timestampOffset=f.start)}}r.appendExecutor(c,h)},onStart:function(){},onComplete:function(){var t=self.performance.now();m.executeEnd=m.end=t,0===g.first&&(g.first=t),y&&0===y.first&&(y.first=t);var e=r.sourceBuffer,n={};for(var a in e)n[a]=s.BufferHelper.getBuffered(e[a]);r.appendError=0,r.hls.trigger(i.Events.BUFFER_APPENDED,{type:h,frag:f,part:d,chunkMeta:p,parent:f.type,timeRanges:n})},onError:function(t){a.logger.error("[buffer-controller]: Error encountered while trying to append to the "+h+" SourceBuffer",t);var e={type:o.ErrorTypes.MEDIA_ERROR,parent:f.type,details:o.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=o.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,e.details=o.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>n.config.appendErrorMaxRetry&&(a.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),n.trigger(i.Events.ERROR,e)}};u.append(x,h)},e.onBufferFlushing=function(t,e){var r=this,n=this.operationQueue,o=function(t){return{execute:r.removeExecutor.bind(r,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(i.Events.BUFFER_FLUSHED,{type:t})},onError:function(e){a.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}};e.type?n.append(o(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){n.append(o(t),t)}))},e.onFragParsed=function(t,e){var r=this,n=e.frag,o=e.part,s=[],u=o?o.elementaryStreams:n.elementaryStreams;u[l.ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(u[l.ElementaryStreamTypes.AUDIO]&&s.push("audio"),u[l.ElementaryStreamTypes.VIDEO]&&s.push("video")),0===s.length&&a.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers((function(){var t=self.performance.now();n.stats.buffering.end=t,o&&(o.stats.buffering.end=t),r.hls.trigger(i.Events.FRAG_BUFFERED,{frag:n,part:o,stats:o?o.stats:n.stats,id:n.type})}),s)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,e){var r=this;this.getSourceBufferTypes().reduce((function(t,n){var i=r.sourceBuffer[n];return e.type&&e.type!==n||i&&!i.ended&&(i.ended=!0,a.logger.log("[buffer-controller]: "+n+" sourceBuffer now EOS")),t&&!(i&&!i.ended)}),!0)&&this.blockBuffers((function(){var t=r.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},e.onLevelUpdated=function(t,e){var r=e.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t=this.hls,e=this.details,r=this.media,a=this.sourceBuffer;if(r&&null!==e){var o=this.getSourceBufferTypes();if(o.length){var u=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(n.isFiniteNumber)(u)&&!(u<0)){var l=r.currentTime,c=e.levelTargetDuration,h=Math.max(u,c),f=Math.floor(l/c)*c-h;o.forEach((function(r){var n=a[r];if(n){var o=s.BufferHelper.getBuffered(n);o.length>0&&f>o.start(0)&&(t.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),e.live&&t.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),t.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:r}))}}))}}}},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,r=this.mediaSource,i=t.fragments[0].start+t.totalduration,o=this.media.duration,s=Object(n.isFiniteNumber)(r.duration)?r.duration:0;t.live&&e.config.liveDurationInfinity?(a.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(i>s&&i>o||!Object(n.isFiniteNumber)(o))&&(a.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),r.duration=i)}},e.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;if(r.length&&t.live&&null!=e&&e.setLiveSeekableRange){var n=Math.max(0,r[0].start),i=Math.max(n,n+t.totalduration);e.setLiveSeekableRange(n,i)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&!t||2===n){this.createSourceBuffers(r),this.pendingTracks={};var a=this.getSourceBufferTypes();if(0===a.length)return void this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});a.forEach((function(t){e.executeNext(t)}))}},e.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var s in t)if(!e[s]){var u=t[s];if(!u)throw Error("source buffer exists for track "+s+", however track does not");var l=u.levelCodec||u.codec,c=u.container+";codecs="+l;a.logger.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var h=e[s]=r.addSourceBuffer(c),f=s;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[s]={buffer:h,codec:l,container:u.container,levelCodec:u.levelCodec,id:u.id},n++}catch(t){a.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:c})}}n&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){a.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(t);r&&r.onError(e)},e.removeExecutor=function(t,e,r){var i=this.media,o=this.mediaSource,s=this.operationQueue,u=this.sourceBuffer[t];if(!i||!o||!u)return a.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void s.shiftAndExecuteNext(t);var l=Object(n.isFiniteNumber)(i.duration)?i.duration:1/0,c=Object(n.isFiniteNumber)(o.duration)?o.duration:1/0,h=Math.max(0,e),f=Math.min(r,l,c);f>h?(a.logger.log("[buffer-controller]: Removing ["+h+","+f+"] from the "+t+" SourceBuffer"),console.assert(!u.updating,t+" sourceBuffer must not be updating"),u.remove(h,f)):s.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var r=this.operationQueue,n=this.sourceBuffer[e];if(!n)return a.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);n.ended=!1,console.assert(!n.updating,e+" sourceBuffer must not be updating"),n.appendBuffer(t)},e.blockBuffers=function(t,e){var r=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return a.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var n=this.operationQueue,i=e.map((function(t){return n.appendBlocker(t)}));Promise.all(i).then((function(){t(),e.forEach((function(t){var e=r.sourceBuffer[t];e&&e.updating||n.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,r){var n=this.sourceBuffer[t];if(n){var i=r.bind(this,t);this.listeners[t].push({event:e,listener:i}),n.addEventListener(e,i)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},t}()},"./src/controller/buffer-operation-queue.ts":
/*!**************************************************!*\
	  !*** ./src/controller/buffer-operation-queue.ts ***!
	  \**************************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return i}));var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,r=new Promise((function(t){e=t}));return this.append({execute:e,onStart:function(){},onComplete:function(){},onError:function(){}},t),r},e.executeNext=function(t){var e=this.buffers[t],r=this.queues[t];if(r.length){var i=r[0];try{i.execute()}catch(a){n.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),i.onError(a),e&&e.updating||(r.shift(),this.executeNext(t))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":
/*!************************************************!*\
	  !*** ./src/controller/cap-level-controller.ts ***!
	  \************************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts");function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e,r,a,o=t.prototype;return o.setStreamController=function(t){this.streamController=t},o.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var t=this.hls;t.on(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var t=this.hls;t.off(n.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(e,r){t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},o.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},o.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},o.getMaxLevel=function(e){var r=this,n=this.hls.levels;if(!n.length)return-1;var i=n.filter((function(n,i){return t.isLevelAllowed(i,r.restrictedLevels)&&i<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e},t.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},t.getMaxLevelByMediaSize=function(t,e,r){if(!t||!t.length)return-1;for(var n,i,a=t.length-1,o=0;o<t.length;o+=1){var s=t[o];if((s.width>=e||s.height>=r)&&(n=s,!(i=t[o+1])||n.width!==i.width||n.height!==i.height)){a=o;break}}return a},e=t,a=[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(t){}return t}}],(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}])&&i(e.prototype,r),a&&i(e,a),t}();e.default=a},"./src/controller/cmcd-controller.ts":
/*!*******************************************!*\
	  !*** ./src/controller/cmcd-controller.ts ***!
	  \*******************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return f}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../types/cmcd */"./src/types/cmcd.ts"),a=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts");function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}function l(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function h(){return h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h.apply(this,arguments)}var f=function(){function t(e){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(t){try{r.apply(t,{ot:i.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(t){o.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,n=r.hls.levels[e.level],a=r.getObjectType(e),s={d:1e3*e.duration,ot:a};a!==i.CMCDObjectType.VIDEO&&a!==i.CMCDObjectType.AUDIO&&a!=i.CMCDObjectType.MUXED||(s.br=n.bitrate/1e3,s.tb=r.getTopBandwidth(a)/1e3,s.bl=r.getBufferLength(a)),r.apply(t,s)}catch(t){o.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;var n=this.config=e.config,a=n.cmcd;null!=a&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=a.sessionId||t.uuid(),this.cid=a.contentId,this.useHeaders=!0===a.useHeaders,this.registerListeners())}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(n.Events.BUFFER_CREATED,this.onBufferCreated,this)},e.unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(n.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},e.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},e.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},e.onBufferCreated=function(t,e){var r,n;this.audioBuffer=null===(r=e.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(n=e.tracks.video)||void 0===n?void 0:n.buffer},e.createData=function(){var t;return{v:i.CMCDVersion,sf:i.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},e.apply=function(e,r){if(void 0===r&&(r={}),h(r,this.createData()),this.starved&&(r.ot===i.CMCDObjectType.INIT||r.ot===i.CMCDObjectType.VIDEO||r.ot===i.CMCDObjectType.MUXED)&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var n=t.toHeaders(r);if(!Object.keys(n).length)return;e.headers||(e.headers={}),h(e.headers,n)}else{var a=t.toQuery(r);if(!a)return;e.url=t.appendQueryToUri(e.url,a)}},e.getObjectType=function(t){var e=t.type;return"subtitle"===e?i.CMCDObjectType.TIMED_TEXT:"initSegment"===t.sn?i.CMCDObjectType.INIT:"audio"===e?i.CMCDObjectType.AUDIO:"main"===e?this.hls.audioTracks.length?i.CMCDObjectType.VIDEO:i.CMCDObjectType.MUXED:void 0},e.getTopBandwidth=function(t){var e,r=0,n=this.hls;if(t===i.CMCDObjectType.AUDIO)e=n.audioTracks;else{var a=n.maxAutoLevel;e=n.levels.slice(0,a>-1?a+1:n.levels.length)}for(var o,s=l(e);!(o=s()).done;){var u=o.value;u.bitrate>r&&(r=u.bitrate)}return r>0?r:NaN},e.getBufferLength=function(t){var e=this.hls.media,r=t===i.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return r&&e?1e3*a.BufferHelper.bufferInfo(r,e.currentTime,this.config.maxBufferHole).len:NaN},e.createPlaylistLoader=function(){var t=this.applyPlaylistData,e=this.config.pLoader||this.config.loader;return function(){function r(t){this.loader=void 0,this.loader=new e(t)}var n=r.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(e,r,n){t(e),this.loader.load(e,r,n)},u(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},e.createFragmentLoader=function(){var t=this.applyFragmentData,e=this.config.fLoader||this.config.loader;return function(){function r(t){this.loader=void 0,this.loader=new e(t)}var n=r.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(e,r,n){t(e),this.loader.load(e,r,n)},u(r,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),r}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)},t.serialize=function(t){for(var e,r=[],n=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},i=function(t){return Math.round(t)},a=function(t){return 100*i(t/100)},o={br:i,d:i,bl:a,dl:a,mtp:a,nor:function(t){return encodeURIComponent(t)},rtp:a,tb:i},s=l(Object.keys(t||{}).sort());!(e=s()).done;){var u=e.value,c=t[u];if(n(c)&&!("v"===u&&1===c||"pr"==u&&1===c)){var h=o[u];h&&(c=h(c));var f,d=typeof c;f="ot"===u||"sf"===u||"st"===u?u+"="+c:"boolean"===d?u:"number"===d?u+"="+c:u+"="+JSON.stringify(c),r.push(f)}}return r.join(",")},t.toHeaders=function(e){for(var r={},n=["Object","Request","Session","Status"],i=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},o=0,s=Object.keys(e);o<s.length;o++){var u=s[o];i[null!=a[u]?a[u]:1][u]=e[u]}for(var l=0;l<i.length;l++){var c=t.serialize(i[l]);c&&(r["CMCD-"+n[l]]=c)}return r},t.toQuery=function(e){return"CMCD="+encodeURIComponent(t.serialize(e))},t.appendQueryToUri=function(t,e){if(!e)return t;var r=t.includes("?")?"&":"?";return""+t+r+e},t}()},"./src/controller/eme-controller.ts":
/*!******************************************!*\
	  !*** ./src/controller/eme-controller.ts ***!
	  \******************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../utils/mediakeys-helper */"./src/utils/mediakeys-helper.ts");var s=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var e,r=t.prototype;return r.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},r._registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},r._unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(n.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this)},r.getLicenseServerUrl=function(t){switch(t){case o.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},r._attemptKeySystemAccess=function(t,e,r){var n=this,i=function(t,e,r,n){if(t===o.KeySystems.WIDEVINE)return function(t,e,r){var n={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){n.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:r.audioRobustness||""})})),e.forEach((function(t){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:r.videoRobustness||""})})),[n]}(e,r,n);throw new Error("Unknown key-system: "+t)}(t,e,r,this._drmSystemOptions);a.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,i);this.mediaKeysPromise=s.then((function(e){return n._onMediaKeySystemAccessObtained(t,e)})),s.catch((function(e){a.logger.error('Failed to obtain key-system "'+t+'" access:',e)}))},r._onMediaKeySystemAccessObtained=function(t,e){var r=this;a.logger.log('Access for key-system "'+t+'" obtained');var n={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(n);var i=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return n.mediaKeys=e,a.logger.log('Media-keys created for key-system "'+t+'"'),r._onMediaKeysCreated(),e}));return i.catch((function(t){a.logger.error("Failed to create media-keys:",t)})),i},r._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},r._onNewMediaKeySession=function(t){var e=this;a.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(r){e._onKeySessionMessage(t,r.message)}),!1)},r._onKeySessionMessage=function(t,e){a.logger.log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){a.logger.log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e)}))},r.onMediaEncrypted=function(t){var e=this;if(a.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var r=function(r){e._media&&(e._attemptSetMediaKeys(r),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(r).catch(r)},r._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return a.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});a.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},r._generateRequestWithPreferredKeySession=function(t,e){var r=this,o=this._mediaKeysList[0];if(!o)return a.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(o.mediaKeysSessionInitialized)a.logger.warn("Key-Session already initialized but requested again");else{var s=o.mediaKeysSession;if(!s)return a.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return a.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});a.logger.log('Generating key-session request for "'+t+'" init data type'),o.mediaKeysSessionInitialized=!0,s.generateRequest(t,e).then((function(){a.logger.debug("Key-session generation succeeded")})).catch((function(t){a.logger.error("Error generating key-session request:",t),r.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},r._createLicenseXhr=function(t,e,r){var n=new XMLHttpRequest;n.responseType="arraybuffer",n.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,n,t,e,r);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,n,t),i=void 0}catch(t){a.logger.error(t)}try{n.readyState||n.open("POST",t,!0),i&&i.call(this.hls,n,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return n},r._onLicenseRequestReadyStageChange=function(t,e,r,o){if(4===t.readyState)if(200===t.status){this._requestLicenseFailureCount=0,a.logger.log("License request succeeded");var s=t.response,u=this._licenseResponseCallback;if(u)try{s=u.call(this.hls,t,e)}catch(t){a.logger.error(t)}o(s)}else{if(a.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});a.logger.warn("Retrying license request, "+(3-this._requestLicenseFailureCount+1)+" attempts left"),this._requestLicense(r,o)}},r._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===o.KeySystems.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},r._requestLicense=function(t,e){a.logger.log("Requesting content license for key-system");var r=this._mediaKeysList[0];if(!r)return a.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var o=this.getLicenseServerUrl(r.mediaKeySystemDomain),s=this._createLicenseXhr(o,t,e);a.logger.log("Sending license request to URL: "+o);var u=this._generateLicenseRequestChallenge(r,t);s.send(u)}catch(t){a.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},r.onMediaAttached=function(t,e){if(this._emeEnabled){var r=e.media;this._media=r,r.addEventListener("encrypted",this._onMediaEncrypted)}},r.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},r.onManifestParsed=function(t,e){if(this._emeEnabled){var r=e.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),n=e.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(o.KeySystems.WIDEVINE,r,n)}},(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}();e.default=s},"./src/controller/fps-controller.ts":
/*!******************************************!*\
	  !*** ./src/controller/fps-controller.ts ***!
	  \******************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/logger */"./src/utils/logger.ts"),a=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=n,n&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,r){var a=performance.now();if(e){if(this.lastTime){var o=r-this.lastDroppedFrames,s=e-this.lastDecodedFrames,u=1e3*o/(a-this.lastTime),l=this.hls;if(l.trigger(n.Events.FPS_DROP,{currentDropped:o,currentDecoded:s,totalDroppedFrames:r}),u>0&&o>l.config.fpsDroppedMonitoringThreshold*s){var c=l.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=c)&&(l.trigger(n.Events.FPS_DROP_LEVEL_CAPPING,{level:c-=1,droppedLevel:l.currentLevel}),l.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}();e.default=a},"./src/controller/fragment-finders.ts":
/*!********************************************!*\
	  !*** ./src/controller/fragment-finders.ts ***!
	  \********************************************/
/*! exports provided: findFragmentByPDT, findFragmentByPTS, fragmentWithinToleranceTest, pdtWithinToleranceTest, findFragWithCC */function(t,e,r){r.r(e),r.d(e,"findFragmentByPDT",(function(){return a})),r.d(e,"findFragmentByPTS",(function(){return o})),r.d(e,"fragmentWithinToleranceTest",(function(){return s})),r.d(e,"pdtWithinToleranceTest",(function(){return u})),r.d(e,"findFragWithCC",(function(){return l}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/binary-search */"./src/utils/binary-search.ts");function a(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!Object(n.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;r=r||0;for(var i=0;i<t.length;++i){var a=t[i];if(u(e,r,a))return a}return null}function o(t,e,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var a=null;return t?a=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(a=e[0]),a&&0===s(r,n,a)?a:i.default.search(e,s.bind(null,r,n))||a}function s(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0);var n=Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=t?1:r.start-n>t&&r.start?-1:0}function u(t,e,r){var n=1e3*Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>t}function l(t,e){return i.default.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}},"./src/controller/fragment-tracker.ts":
/*!********************************************!*\
	  !*** ./src/controller/fragment-tracker.ts ***!
	  \********************************************/
/*! exports provided: FragmentState, FragmentTracker */function(t,e,r){r.r(e),r.d(e,"FragmentState",(function(){return n})),r.d(e,"FragmentTracker",(function(){return o}));var n,i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../types/loader */"./src/types/loader.ts");!function(t){t.NOT_LOADED="NOT_LOADED",t.BACKTRACKED="BACKTRACKED",t.APPENDING="APPENDING",t.PARTIAL="PARTIAL",t.OK="OK"}(n||(n={}));var o=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(i.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(i.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(i.Events.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===a.PlaylistLevelType.MAIN){var r=this.activeFragment,n=this.activeParts;if(!r)return null;if(n)for(var i=n.length;i--;){var o=n[i],s=o?o.end:r.appendedPTS;if(o.start<=t&&void 0!==s&&t<=s)return i>9&&(this.activeParts=n.slice(i-9)),o}else if(r.start<=t&&void 0!==r.appendedPTS&&t<=r.appendedPTS)return r}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var r=this.fragments,n=Object.keys(r),i=n.length;i--;){var a=r[n[i]];if((null==a?void 0:a.body.type)===e&&a.buffered){var o=a.body;if(o.start<=t&&t<=o.end)return o}}return null},e.detectEvictedFragments=function(t,e,r){var n=this;Object.keys(this.fragments).forEach((function(i){var a=n.fragments[i];if(a)if(a.buffered){var o=a.range[t];o&&o.time.some((function(t){var r=!n.isTimeBuffered(t.startPTS,t.endPTS,e);return r&&n.removeFragment(a.body),r}))}else a.body.type===r&&n.removeFragment(a.body)}))},e.detectPartialFragments=function(t){var e=this,r=this.timeRanges,n=t.frag,i=t.part;if(r&&"initSegment"!==n.sn){var a=u(n),o=this.fragments[a];o&&(Object.keys(r).forEach((function(t){var a=n.elementaryStreams[t];a&&(o.range[t]=e.getBufferedTimes(n,i,null!==i||!0===a.partial,r[t]))})),o.backtrack=o.loaded=null,Object.keys(o.range).length?o.buffered=!0:this.removeFragment(o.body))}},e.fragBuffered=function(t){var e=u(t),r=this.fragments[e];r&&(r.backtrack=r.loaded=null,r.buffered=!0)},e.getBufferedTimes=function(t,e,r,n){for(var i={time:[],partial:r},a=e?e.start:t.start,o=e?e.end:t.end,s=t.minEndPTS||o,u=t.maxStartPTS||a,l=0;l<n.length;l++){var c=n.start(l)-this.bufferPadding,h=n.end(l)+this.bufferPadding;if(u>=c&&s<=h){i.time.push({startPTS:Math.max(a,n.start(l)),endPTS:Math.min(o,n.end(l))});break}if(a<h&&o>c)i.partial=!0,i.time.push({startPTS:Math.max(a,n.start(l)),endPTS:Math.min(o,n.end(l))});else if(o<=c)break}return i},e.getPartialFragment=function(t){var e,r,n,i=null,a=0,o=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach((function(l){var c=u[l];c&&s(c)&&(n=c.body.end+o,t>=(r=c.body.start-o)&&t<=n&&(e=Math.min(t-r,n-t),a<=e&&(i=c.body,a=e)))})),i},e.getState=function(t){var e=u(t),r=this.fragments[e];return r?r.buffered?s(r)?n.PARTIAL:n.OK:r.backtrack?n.BACKTRACKED:n.APPENDING:n.NOT_LOADED},e.backtrack=function(t,e){var r=u(t),n=this.fragments[r];if(!n||n.backtrack)return null;var i=n.backtrack=e||n.loaded;return n.loaded=null,i},e.getBacktrackData=function(t){var e=u(t),r=this.fragments[e];if(r){var n,i=r.backtrack;if(null!=i&&null!==(n=i.payload)&&void 0!==n&&n.byteLength)return i;this.removeFragment(t)}return null},e.isTimeBuffered=function(t,e,r){for(var n,i,a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,t>=n&&e<=i)return!0;if(e<=n)return!1}return!1},e.onFragLoaded=function(t,e){var r=e.frag;if("initSegment"!==r.sn&&!r.bitrateTest&&!e.part){var n=u(r);this.fragments[n]={body:r,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var r=this,n=e.frag,i=e.part,o=e.timeRanges;if(n.type===a.PlaylistLevelType.MAIN)if(this.activeFragment=n,i){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(i)}else this.activeParts=null;this.timeRanges=o,Object.keys(o).forEach((function(t){var e=o[t];if(r.detectEvictedFragments(t,e),!i)for(var a=0;a<e.length;a++)n.appendedPTS=Math.max(e.end(a),n.appendedPTS||0)}))},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=u(t);return!!this.fragments[e]},e.removeFragmentsInRange=function(t,e,r){var n=this;Object.keys(this.fragments).forEach((function(i){var a=n.fragments[i];if(a&&a.buffered){var o=a.body;o.type===r&&o.start<e&&o.end>t&&n.removeFragment(o)}}))},e.removeFragment=function(t){var e=u(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function s(t){var e,r;return t.buffered&&((null===(e=t.range.video)||void 0===e?void 0:e.partial)||(null===(r=t.range.audio)||void 0===r?void 0:r.partial))}function u(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":
/*!******************************************!*\
	  !*** ./src/controller/gap-controller.ts ***!
	  \******************************************/
/*! exports provided: STALL_MINIMUM_DURATION_MS, MAX_START_GAP_JUMP, SKIP_BUFFER_HOLE_STEP_SECONDS, SKIP_BUFFER_RANGE_START, default */function(t,e,r){r.r(e),r.d(e,"STALL_MINIMUM_DURATION_MS",(function(){return s})),r.d(e,"MAX_START_GAP_JUMP",(function(){return u})),r.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return l})),r.d(e,"SKIP_BUFFER_RANGE_START",(function(){return c})),r.d(e,"default",(function(){return h}));var n=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../events */"./src/events.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=250,u=2,l=.1,c=.05,h=function(){function t(t,e,r,n){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=n}var e=t.prototype;return e.destroy=function(){this.hls=this.fragmentTracker=this.media=null},e.poll=function(t){var e=this.config,r=this.media,i=this.stalled,a=r.currentTime,l=r.seeking,c=this.seeking&&!l,h=!this.seeking&&l;if(this.seeking=l,a===t){if((h||c)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&n.BufferHelper.getBuffered(r).length){var f=n.BufferHelper.bufferInfo(r,a,0),d=f.nextStart||0;if(f.len>0||d){if(l){var p=f.len>u,m=!d||d-a>u&&!this.fragmentTracker.getPartialFragment(a);if(p||m)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var v,g=Math.max(d,f.start||0)-a,y=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,_=null==y||null===(v=y.details)||void 0===v?void 0:v.live;if(g>0&&g<=(_?2*y.details.targetduration:u))return void this._trySkipBufferHole(null)}var b=self.performance.now();if(null!==i){var x=b-i;!l&&x>=s&&this._reportStall(f.len);var w=n.BufferHelper.bufferInfo(r,a,e.maxBufferHole);this._tryFixBufferStall(w,x)}else this.stalled=b}}}else if(this.moved=!0,null!==i){if(this.stallReported){var M=self.performance.now()-i;o.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(M)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},e._tryFixBufferStall=function(t,e){var r=this.config,n=this.fragmentTracker.getPartialFragment(this.media.currentTime);n&&this._trySkipBufferHole(n)||t.len>r.maxBufferHole&&e>1e3*r.highBufferWatchdogPeriod&&(o.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,o.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,r=this.hls,s=this.media,u=s.currentTime,h=0,f=n.BufferHelper.getBuffered(s),d=0;d<f.length;d++){var p=f.start(d);if(u+e.maxBufferHole>=h&&u<p){var m=Math.max(p+c,s.currentTime+l);return o.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+m),this.moved=!0,this.stalled=null,s.currentTime=m,t&&r.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+m,frag:t}),m}h=f.end(d)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,n=r.currentTime,s=(this.nudgeRetry||0)+1;if(this.nudgeRetry=s,s<t.nudgeMaxRetry){var u=n+s*t.nudgeOffset;o.logger.warn("Nudging 'currentTime' from "+n+" to "+u),r.currentTime=u,e.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else o.logger.error("Playhead still not moving while enough data buffered @"+n+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}()},"./src/controller/id3-track-controller.ts":
/*!************************************************!*\
	  !*** ./src/controller/id3-track-controller.ts ***!
	  \************************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts"),o=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners()},e._registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(Object(i.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return Object(i.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var r=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,o=0;o<n.length;o++){var s=a.getID3Frames(n[o].data);if(s){var u=n[o].pts,l=o<n.length-1?n[o+1].pts:r.end;l-u<=0&&(l=u+.25);for(var c=0;c<s.length;c++){var h=s[c];if(!a.isTimeStampFrame(h)){var f=new i(u,l,"");f.value=h,this.id3Track.addCue(f)}}}}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,n=e.endOffset,a=e.type;if(!a||"audio"===a){var o=this.id3Track;o&&Object(i.removeCuesInRange)(o,r,n)}},t}();e.default=o},"./src/controller/latency-controller.ts":
/*!**********************************************!*\
	  !*** ./src/controller/latency-controller.ts ***!
	  \**********************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return o}));var n=r(/*! ../errors */"./src/errors.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts");var o=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e,r=t.prototype;return r.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},r.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},r.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},r.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},r.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},r.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},r.onLevelUpdated=function(t,e){var r=e.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},r.onError=function(t,e){e.details===n.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,a.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},r.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var n=this.config,i=n.maxLiveSyncPlaybackRate;if(n.lowLatencyMode&&1!==i){var a=this.targetLatency;if(null!==a){var o=r-a,s=Math.min(this.maxLatency,a+e.targetduration);if(e.live&&o<s&&o>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,i)),l=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(u,Math.max(1,l))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},r.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},r.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.targetduration,r=this.config,n=r.liveSyncDuration,i=this.hls.userConfig,a=r.lowLatencyMode&&t.partHoldBack||t.holdBack;return(i.liveSyncDuration||i.liveSyncDurationCount||0===a)&&(a=void 0!==n?n:r.liveSyncDurationCount*e),a+Math.min(1*this.stallCount,e)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var n=r.edge,i=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(n-r.totalduration,t-e-this.edgeStalled),i)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;return null===t?0:Math.max(t.age-3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration),0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return r?t.buffered.end(r-1):e.edge-this.currentTime}}],e&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}()},"./src/controller/level-controller.ts":
/*!********************************************!*\
	  !*** ./src/controller/level-controller.ts ***!
	  \********************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return d}));var n=r(/*! ../types/level */"./src/types/level.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),s=r(/*! ./level-helper */"./src/controller/level-helper.ts"),u=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts");function c(){return c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},c.apply(this,arguments)}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(t){var e,r;function u(e){var r;return(r=t.call(this,e,"[level-controller]")||this)._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}r=t,(e=u).prototype=Object.create(r.prototype),e.prototype.constructor=e,h(e,r);var d,p=u.prototype;return p._registerListeners=function(){var t=this.hls;t.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(i.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var t=this.hls;t.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(i.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},p.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},p.onManifestLoaded=function(t,e){var r,u,l=[],c=[],h=[],d={},p=!1,m=!1,v=!1;if(e.levels.forEach((function(t){var e=t.attrs;p=p||!(!t.width||!t.height),m=m||!!t.videoCodec,v=v||!!t.audioCodec,f&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var r=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(u=d[r])?u.url.push(t.url):(u=new n.Level(t),d[r]=u,l.push(u)),e&&(e.AUDIO&&Object(s.addGroupId)(u,"audio",e.AUDIO),e.SUBTITLES&&Object(s.addGroupId)(u,"text",e.SUBTITLES))})),(p||m)&&v&&(l=l.filter((function(t){return!!t.videoCodec||!(!t.width||!t.height)}))),l=l.filter((function(t){var e=t.audioCodec,r=t.videoCodec;return(!e||Object(o.isCodecSupportedInMp4)(e,"audio"))&&(!r||Object(o.isCodecSupportedInMp4)(r,"video"))})),e.audioTracks&&(c=e.audioTracks.filter((function(t){return!t.audioCodec||Object(o.isCodecSupportedInMp4)(t.audioCodec,"audio")})),Object(s.assignTrackIdsByGroup)(c)),e.subtitles&&(h=e.subtitles,Object(s.assignTrackIdsByGroup)(h)),l.length>0){r=l[0].bitrate,l.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=l;for(var g=0;g<l.length;g++)if(l[g].bitrate===r){this._firstLevel=g,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+r);break}var y={levels:l,audioTracks:c,subtitleTracks:h,firstLevel:this._firstLevel,stats:e.stats,audio:v,video:m,altAudio:!(v&&!m)&&c.some((function(t){return!!t.url}))};this.hls.trigger(i.Events.MANIFEST_PARSED,y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(e,r){if(t.prototype.onError.call(this,e,r),!r.fatal){var n=r.context,i=this._levels[this.currentLevelIndex];if(n&&(n.type===l.PlaylistContextType.AUDIO_TRACK&&i.audioGroupIds&&n.groupId===i.audioGroupIds[i.urlId]||n.type===l.PlaylistContextType.SUBTITLE_TRACK&&i.textGroupIds&&n.groupId===i.textGroupIds[i.urlId]))this.redundantFailover(this.currentLevelIndex);else{var o,s=!1,u=!0;switch(r.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var c=this._levels[r.frag.level];c?(c.fragmentError++,c.fragmentError>this.hls.config.fragLoadingMaxRetry&&(o=r.frag.level)):o=r.frag.level}break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(u=!1),o=n.level),s=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:o=r.level,s=!0}void 0!==o&&this.recoverLevel(r,o,s,u)}}},p.recoverLevel=function(t,e,r,n){var i=t.details,a=this._levels[e];if(a.loadError++,r){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(n){var o=a.url.length;if(o>1&&a.loadError<o)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){var s=0===e?this._levels.length-1:e-1;this.currentLevelIndex!==s&&0===this._levels[s].loadError&&(this.warn(i+": switch to "+s),t.levelRetry=!0,this.hls.nextAutoLevel=s)}}},p.redundantFailover=function(t){var e=this._levels[t],r=e.url.length;if(r>1){var n=(e.urlId+1)%r;this.warn("Switching to redundant URL-id "+n),this._levels.forEach((function(t){t.urlId=n})),this.level=t}},p.onFragLoaded=function(t,e){var r=e.frag;if(void 0!==r&&r.type===l.PlaylistLevelType.MAIN){var n=this._levels[r.level];void 0!==n&&(n.fragmentError=0,n.loadError=0)}},p.onLevelLoaded=function(t,e){var r,n,i=e.level,a=e.details,o=this._levels[i];if(!o)return this.warn("Invalid level index "+i),void(null!==(n=e.deliveryDirectives)&&void 0!==n&&n.skip&&(a.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,o.details)):null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(a.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(t,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var n=-1,i=this.hls.audioTracks[e.id].groupId,a=0;a<r.audioGroupIds.length;a++)if(r.audioGroupIds[a]===i){n=a;break}n!==r.urlId&&(r.urlId=n,this.startLoad())}},p.loadPlaylist=function(t){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&r.url.length>0){var n=r.urlId,a=r.url[n];if(t)try{a=t.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+n+" "+a),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:a,level:e,id:n,deliveryDirectives:t||null})}},p.removeLevel=function(t,e){var r=function(t,r){return r!==e},n=this._levels.filter((function(n,i){return i!==t||n.url.length>1&&void 0!==e&&(n.url=n.url.filter(r),n.audioGroupIds&&(n.audioGroupIds=n.audioGroupIds.filter(r)),n.textGroupIds&&(n.textGroupIds=n.textGroupIds.filter(r)),n.urlId=0,!0)})).map((function(t,e){var r=t.details;return null!=r&&r.fragments&&r.fragments.forEach((function(t){t.level=e})),t}));this._levels=n,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:n})},(d=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==t||null===(e=r[t])||void 0===e||!e.details)){if(t<0||t>=r.length){var n=t<0;if(this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:n,reason:"invalid level idx"}),n)return;t=Math.min(t,r.length-1)}this.clearTimer();var o=this.currentLevelIndex,s=r[o],u=r[t];this.log("switching to level "+t+" from "+o),this.currentLevelIndex=t;var l=c({},u,{level:t,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete l._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,l);var h=u.details;if(!h||h.live){var f=this.switchParams(u.uri,null==s?void 0:s.details);this.loadPlaylist(f)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(u.prototype,d),u}(u.default)},"./src/controller/level-helper.ts":
/*!****************************************!*\
	  !*** ./src/controller/level-helper.ts ***!
	  \****************************************/
/*! exports provided: addGroupId, assignTrackIdsByGroup, updatePTS, updateFragPTSDTS, mergeDetails, mapPartIntersection, mapFragmentIntersection, adjustSliding, addSliding, computeReloadInterval, getFragmentWithSN, getPartWith */function(t,e,r){r.r(e),r.d(e,"addGroupId",(function(){return a})),r.d(e,"assignTrackIdsByGroup",(function(){return o})),r.d(e,"updatePTS",(function(){return s})),r.d(e,"updateFragPTSDTS",(function(){return l})),r.d(e,"mergeDetails",(function(){return c})),r.d(e,"mapPartIntersection",(function(){return h})),r.d(e,"mapFragmentIntersection",(function(){return f})),r.d(e,"adjustSliding",(function(){return d})),r.d(e,"addSliding",(function(){return p})),r.d(e,"computeReloadInterval",(function(){return m})),r.d(e,"getFragmentWithSN",(function(){return v})),r.d(e,"getPartWith",(function(){return g}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/logger */"./src/utils/logger.ts");function a(t,e,r){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(r);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(r)}}function o(t){var e={};t.forEach((function(t){var r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++}))}function s(t,e,r){u(t[e],t[r])}function u(t,e){var r=e.startPTS;if(Object(n.isFiniteNumber)(r)){var i,a=0;e.sn>t.sn?(a=r-t.start,i=t):(a=t.start-r,i=e),i.duration!==a&&(i.duration=a)}else e.start=e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?t.start+(t.minEndPTS-t.start):t.start+t.duration:Math.max(t.start-e.duration,0)}function l(t,e,r,a,o,s){a-r<=0&&(i.logger.warn("Fragment should have a positive duration",e),a=r+e.duration,s=o+e.duration);var l=r,c=a,h=e.startPTS,f=e.endPTS;if(Object(n.isFiniteNumber)(h)){var d=Math.abs(h-r);e.deltaPTS=Object(n.isFiniteNumber)(e.deltaPTS)?Math.max(d,e.deltaPTS):d,l=Math.max(r,h),r=Math.min(r,h),o=Math.min(o,e.startDTS),c=Math.min(a,f),a=Math.max(a,f),s=Math.max(s,e.endDTS)}e.duration=a-r;var p=r-e.start;e.appendedPTS=a,e.start=e.startPTS=r,e.maxStartPTS=l,e.startDTS=o,e.endPTS=a,e.minEndPTS=c,e.endDTS=s;var m,v=e.sn;if(!t||v<t.startSN||v>t.endSN)return 0;var g=v-t.startSN,y=t.fragments;for(y[g]=e,m=g;m>0;m--)u(y[m],y[m-1]);for(m=g;m<y.length-1;m++)u(y[m],y[m+1]);return t.fragmentHint&&u(y[y.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,p}function c(t,e){for(var r=null,a=t.fragments,o=a.length-1;o>=0;o--){var s=a[o].initSegment;if(s){r=s;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var u,c=0;if(f(t,e,(function(t,i){t.relurl&&(c=t.cc-i.cc),Object(n.isFiniteNumber)(t.startPTS)&&Object(n.isFiniteNumber)(t.endPTS)&&(i.start=i.startPTS=t.startPTS,i.startDTS=t.startDTS,i.appendedPTS=t.appendedPTS,i.maxStartPTS=t.maxStartPTS,i.endPTS=t.endPTS,i.endDTS=t.endDTS,i.minEndPTS=t.minEndPTS,i.duration=t.endPTS-t.startPTS,i.duration&&(u=i),e.PTSKnown=e.alignedSliding=!0),i.elementaryStreams=t.elementaryStreams,i.loader=t.loader,i.stats=t.stats,i.urlId=t.urlId,t.initSegment&&(i.initSegment=t.initSegment,r=t.initSegment)})),r&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach((function(t){var e;t.initSegment&&t.initSegment.relurl!==(null===(e=r)||void 0===e?void 0:e.relurl)||(t.initSegment=r)})),e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed)){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=e.skippedSegments;p--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var m=e.fragments;if(c){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var v=0;v<m.length;v++)m[v].cc+=c}e.skippedSegments&&(e.startCC=e.fragments[0].cc),h(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),u?l(e,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):d(t,e),m.length&&(e.totalduration=e.edge-m[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var g=e.advancedDateTime;if(e.advanced&&g){var y=e.edge;e.driftStart||(e.driftStartTime=g,e.driftStart=y),e.driftEndTime=g,e.driftEnd=y}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function h(t,e,r){if(t&&e)for(var n=0,i=0,a=t.length;i<=a;i++){var o=t[i],s=e[i+n];o&&s&&o.index===s.index&&o.fragment.sn===s.fragment.sn?r(o,s):n--}}function f(t,e,r){for(var n=e.skippedSegments,i=Math.max(t.startSN,e.startSN)-e.startSN,a=(t.fragmentHint?1:0)+(n?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,o=e.startSN-t.startSN,s=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=i;l<=a;l++){var c=u[o+l],h=s[l];n&&!h&&l<n&&(h=e.fragments[l]=c),c&&h&&r(c,h)}}function d(t,e){var r=e.startSN+e.skippedSegments-t.startSN,n=t.fragments;r<0||r>=n.length||p(e,n[r].start)}function p(t,e){if(e){for(var r=t.fragments,n=t.skippedSegments;n<r.length;n++)r[n].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function m(t,e){var r,n=1e3*t.levelTargetDuration,i=n/2,a=t.age,o=a>0&&a<3*n,s=e.loading.end-e.loading.start,u=t.availabilityDelay;if(!1===t.updated)if(o){var l=333*t.misses;r=Math.max(Math.min(i,2*s),l),t.availabilityDelay=(t.availabilityDelay||0)+r}else r=i;else o?(u=Math.min(u||n/2,a),t.availabilityDelay=u,r=u+n-a):r=n-s;return Math.round(r)}function v(t,e,r){if(!t||!t.details)return null;var n=t.details,i=n.fragments[e-n.startSN];return i||((i=n.fragmentHint)&&i.sn===e?i:e<n.startSN&&r&&r.sn===e?r:null)}function g(t,e,r){if(!t||!t.details)return null;var n=t.details.partList;if(n)for(var i=n.length;i--;){var a=n[i];if(a.index===r&&a.fragment.sn===e)return a}return null}},"./src/controller/stream-controller.ts":
/*!*********************************************!*\
	  !*** ./src/controller/stream-controller.ts ***!
	  \*********************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return g}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),a=r(/*! ../is-supported */"./src/is-supported.ts"),o=r(/*! ../events */"./src/events.ts"),s=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),u=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),h=r(/*! ../demux/transmuxer-interface */"./src/demux/transmuxer-interface.ts"),f=r(/*! ../types/transmuxer */"./src/types/transmuxer.ts"),d=r(/*! ./gap-controller */"./src/controller/gap-controller.ts"),p=r(/*! ../errors */"./src/errors.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts");function v(t,e){return v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},v(t,e)}var g=function(t){var e,r;function g(e,r){var n;return(n=t.call(this,e,r,"[stream-controller]")||this).audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.stalled=!1,n.couldBacktrack=!1,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}r=t,(e=g).prototype=Object.create(r.prototype),e.prototype.constructor=e,v(e,r);var y,_=g.prototype;return _._registerListeners=function(){var t=this.hls;t.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(o.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(o.Events.ERROR,this.onError,this),t.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_._unregisterListeners=function(){var t=this.hls;t.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(o.Events.ERROR,this.onError,this),t.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},_.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},_.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var n=r.startLevel;-1===n&&(r.config.testBandwidth?(n=0,this.bitrateTest=!0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},_.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},_.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var t,e=this.levels,r=null==e||null===(t=e[this.level])||void 0===t?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var n,a=self.performance.now(),o=this.retryDate;(!o||a>=o||null!==(n=this.media)&&void 0!==n&&n.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},_.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},_.doTickIdle=function(){var t,e,r=this.hls,n=this.levels,a=this.media,s=r.nextLoadLevel;if(null!==this.levelLastLoaded&&(a||!this.startFragRequested&&r.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&n&&n[s]){var h=n[s];this.level=r.nextLoadLevel=s;var f=h.details;if(!f||this.state===i.State.WAITING_LEVEL||f.live&&this.levelLastLoaded!==s)this.state=i.State.WAITING_LEVEL;else{var d=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:a,l.PlaylistLevelType.MAIN);if(null!==d&&!(d.len>=this.getMaxBufferLength(h.maxBitrate))){if(this._streamEnded(d,f)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(o.Events.BUFFER_EOS,p),void(this.state=i.State.ENDED)}var m=d.end,v=this.getNextFragment(m,f);if(this.couldBacktrack&&!this.fragPrevious&&v&&"initSegment"!==v.sn){var g=v.sn-f.startSN;g>1&&this.fragmentTracker.removeFragment(v=f.fragments[g-1])}v&&this.fragmentTracker.getState(v)===u.FragmentState.OK&&this.nextLoadPosition>m&&(this.afterBufferFlushed(a,this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO,l.PlaylistLevelType.MAIN),v=this.getNextFragment(this.nextLoadPosition,f)),v&&(!v.initSegment||v.initSegment.data||this.bitrateTest||(v=v.initSegment),"identity"!==(null===(t=v.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=v.decryptdata)&&void 0!==e&&e.key?this.loadFragment(v,f,m):this.loadKey(v,f))}}}},_.loadFragment=function(e,r,n){var i,a=this.fragmentTracker.getState(e);if(this.fragCurrent=e,a===u.FragmentState.BACKTRACKED){var o=this.fragmentTracker.getBacktrackData(e);if(o)return this._handleFragmentLoadProgress(o),void this._handleFragmentLoadComplete(o);a=u.FragmentState.NOT_LOADED}a===u.FragmentState.NOT_LOADED||a===u.FragmentState.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e):this.bitrateTest?(e.bitrateTest=!0,this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,n)):a===u.FragmentState.APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(i=this.media)||void 0===i?void 0:i.buffered.length)&&this.fragmentTracker.removeAllFragments()},_.getAppendedFrag=function(t){var e=this.fragmentTracker.getAppendedFrag(t,l.PlaylistLevelType.MAIN);return e&&"fragment"in e?e.fragment:e},_.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,l.PlaylistLevelType.MAIN)},_.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},_.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},_.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var r,n=this.getAppendedFrag(e.currentTime);if(n&&n.start>1&&this.flushMainBuffer(0,n.start-1),!e.paused&&t){var i=this.fragLastKbps;r=i&&this.fragCurrent?this.fragCurrent.duration*t[this.hls.nextLoadLevel].maxBitrate/(1e3*i)+1:0}else r=0;var a=this.getBufferedFrag(e.currentTime+r);if(a){var o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();var s=o.duration,u=Math.max(a.end,(o.maxStartPTS?o.maxStartPTS:o.start)+Math.min(Math.max(s-this.config.maxFragLookUpTolerance,.5*s),.75*s));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},_.abortCurrentFrag=function(){var t=this.fragCurrent;this.fragCurrent=null,null!=t&&t.loader&&t.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},_.flushMainBuffer=function(e,r){t.prototype.flushMainBuffer.call(this,e,r,this.altAudio?"video":null)},_.onMediaAttached=function(e,r){t.prototype.onMediaAttached.call(this,e,r);var n=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new d.default(this.config,n,this.fragmentTracker,this.hls)},_.onMediaDetaching=function(){var e=this.media;e&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},_.onMediaPlaying=function(){this.tick()},_.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;Object(n.isFiniteNumber)(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},_.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(o.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},_.onManifestParsed=function(t,e){var r,n=!1,i=!1;e.levels.forEach((function(t){(r=t.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(n=!0),-1!==r.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=n&&i&&!Object(a.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},_.onLevelLoading=function(t,e){var r=this.levels;if(r&&this.state===i.State.IDLE){var n=r[e.level];(!n.details||n.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(n.details))&&(this.state=i.State.WAITING_LEVEL)}},_.onLevelLoaded=function(t,e){var r,n=this.levels,a=e.level,s=e.details;if(n){this.log("Level "+a+" loaded ["+s.startSN+","+s.endSN+"], cc ["+s.startCC+", "+s.endCC+"] duration:"+s.totalduration);var u=this.fragCurrent;!u||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||u.level!==e.level&&u.loader&&(this.state=i.State.IDLE,u.loader.abort());var l=n[a],c=0;if(s.live||null!==(r=l.details)&&void 0!==r&&r.live){if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed)return;c=this.alignPlaylists(s,l.details)}if(l.details=s,this.levelLastLoaded=a,this.hls.trigger(o.Events.LEVEL_UPDATED,{details:s,level:a}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(s))return;this.state=i.State.IDLE}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,c),this.tick()}else this.warn("Levels were reset while loading level "+a)},_._handleFragmentLoadProgress=function(t){var e,r=t.frag,n=t.part,i=t.payload,a=this.levels;if(a){var o=a[r.level],s=o.details;if(s){var u=o.videoCodec,c=s.PTSKnown||!s.live,d=null===(e=r.initSegment)||void 0===e?void 0:e.data,p=this._getAudioCodec(o),m=this.transmuxer=this.transmuxer||new h.default(this.hls,l.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),v=n?n.index:-1,g=new f.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,i.byteLength,v,-1!==v);m.push(i,d,p,u,r,n,s.totalduration,c,g,this.initPTS[r.cc])}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},_.onAudioTrackSwitching=function(t,e){var r=this.altAudio,n=e.id;if(!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;null!=i&&i.loader&&(this.log("Switching to main audio track, cancel main fragment load"),i.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;r&&a.trigger(o.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:n})}},_.onAudioTrackSwitched=function(t,e){var r=!!this.hls.audioTracks[e.id].url;if(r){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r,this.tick()},_.onBufferCreated=function(t,e){var r,n,i=e.tracks,a=!1;for(var o in i){var s=i[o];if("main"===s.id){if(n=o,r=s,"video"===o){var u=i[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&r?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},_.onFragBuffered=function(t,e){var r=e.frag,n=e.part;if(!r||r.type===l.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var a=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*a.total/(a.buffering.end-a.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}},_.onError=function(t,e){switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(l.PlaylistLevelType.MAIN,e);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(e.fatal?(this.warn(""+e.details),this.state=i.State.ERROR):e.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===e.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var r=!0,n=this.getFwdBufferInfo(this.media,l.PlaylistLevelType.MAIN);n&&n.len>.5&&(r=!this.reduceMaxBufferLength(n.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},_.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){var r=s.BufferHelper.getBuffered(t);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):e.poll(this.lastCurrentTime),this.lastCurrentTime=t.currentTime}},_.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},_.onBufferFlushed=function(t,e){var r=e.type;(r!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((r===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,r,l.PlaylistLevelType.MAIN)},_.onLevelsUpdated=function(t,e){this.levels=e.levels},_.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},_.seekToStartPos=function(){var t=this.media,e=t.currentTime,r=this.startPosition;if(r>=0&&e<r){if(t.seeking)return void m.logger.log("could not seek to "+r+", already seeking at "+e);var n=s.BufferHelper.getBuffered(t),i=(n.length?n.start(0):0)-r;i>0&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(m.logger.log("adjusting start position by "+i+" to match buffer start"),this.startPosition=r+=i),this.log("seek to target start position "+r+" from current time "+e),t.currentTime=r}},_._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},_._loadBitrateTestFrag=function(t){var e=this;this._doFragLoad(t).then((function(r){var n=e.hls;if(r&&!n.nextLoadLevel&&!e.fragContextChanged(t)){e.fragLoadError=0,e.state=i.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var a=t.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),n.trigger(o.Events.FRAG_LOADED,r)}}))},_._handleTransmuxComplete=function(t){var e,r="main",a=this.hls,s=t.remuxResult,u=t.chunkMeta,l=this.getCurrentContext(u);if(!l)return this.warn("The loading context changed while buffering fragment "+u.sn+" of level "+u.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(u.level);var h=l.frag,f=l.part,d=l.level,p=s.video,m=s.text,v=s.id3,g=s.initSegment,y=this.altAudio?void 0:s.audio;if(!this.fragContextChanged(h)){if(this.state=i.State.PARSING,g){g.tracks&&(this._bufferInitSegment(d,g.tracks,h,u),a.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:r,tracks:g.tracks}));var _=g.initPTS,b=g.timescale;Object(n.isFiniteNumber)(_)&&(this.initPTS[h.cc]=_,a.trigger(o.Events.INIT_PTS_FOUND,{frag:h,id:r,initPTS:_,timescale:b}))}if(p&&!1!==s.independent){if(d.details){var x=p.startPTS,w=p.endPTS,M=p.startDTS,A=p.endDTS;if(f)f.elementaryStreams[p.type]={startPTS:x,endPTS:w,startDTS:M,endDTS:A};else if(p.firstKeyFrame&&p.independent&&(this.couldBacktrack=!0),p.dropped&&p.independent){if(this.getLoadPosition()+this.config.maxBufferHole<x)return void this.backtrack(h);h.setElementaryStreamInfo(p.type,h.start,w,h.start,A,!0)}h.setElementaryStreamInfo(p.type,x,w,M,A),this.bufferFragmentData(p,h,f,u)}}else if(!1===s.independent)return void this.backtrack(h);if(y){var E=y.startPTS,S=y.endPTS,T=y.startDTS,C=y.endDTS;f&&(f.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:E,endPTS:S,startDTS:T,endDTS:C}),h.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,E,S,T,C),this.bufferFragmentData(y,h,f,u)}null!=v&&null!==(e=v.samples)&&void 0!==e&&e.length&&a.trigger(o.Events.FRAG_PARSING_METADATA,{frag:h,id:r,samples:v.samples}),m&&a.trigger(o.Events.FRAG_PARSING_USERDATA,{frag:h,id:r,samples:m.samples})}},_._bufferInitSegment=function(t,e,r,n){var a=this;if(this.state===i.State.PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var s=e.audio,u=e.video,l=e.audiovideo;if(s){var c=t.audioCodec,h=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(c&&(c=-1!==c.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===h.indexOf("firefox")&&(c="mp4a.40.5")),-1!==h.indexOf("android")&&"audio/mpeg"!==s.container&&this.log("Android: force audio codec to "+(c="mp4a.40.2")),t.audioCodec&&t.audioCodec!==c&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+c+'"'),s.levelCodec=c,s.id="main",this.log("Init audio buffer, container:"+s.container+", codecs[selected/level/parsed]=["+(c||"")+"/"+(t.audioCodec||"")+"/"+s.codec+"]")}u&&(u.levelCodec=t.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+u.codec+"]")),l&&this.log("Init audiovideo buffer, container:"+l.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+l.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var i=e[t].initSegment;null!=i&&i.byteLength&&a.hls.trigger(o.Events.BUFFER_APPENDING,{type:t,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})),this.tick()}},_.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var e=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,e?this.resetFragmentLoading(t):this.state=i.State.BACKTRACKING},_.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var r=t.currentTime;if(s.BufferHelper.isBuffered(t,r)?e=this.getAppendedFrag(r):s.BufferHelper.isBuffered(t,r+.1)&&(e=this.getAppendedFrag(r+.1)),e){var n=this.fragPlaying,i=e.level;n&&e.sn===n.sn&&n.level===i&&e.urlId===n.urlId||(this.hls.trigger(o.Events.FRAG_CHANGED,{frag:e}),n&&n.level===i||this.hls.trigger(o.Events.LEVEL_SWITCHED,{level:i}),this.fragPlaying=e)}}},(y=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(e)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(g.prototype,y),g}(i.default)},"./src/controller/subtitle-stream-controller.ts":
/*!******************************************************!*\
	  !*** ./src/controller/subtitle-stream-controller.ts ***!
	  \******************************************************/
/*! exports provided: SubtitleStreamController */function(t,e,r){r.r(e),r.d(e,"SubtitleStreamController",(function(){return d}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/buffer-helper */"./src/utils/buffer-helper.ts"),a=r(/*! ./fragment-finders */"./src/controller/fragment-finders.ts"),o=r(/*! ../utils/discontinuities */"./src/utils/discontinuities.ts"),s=r(/*! ./level-helper */"./src/controller/level-helper.ts"),u=r(/*! ./fragment-tracker */"./src/controller/fragment-tracker.ts"),l=r(/*! ./base-stream-controller */"./src/controller/base-stream-controller.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),h=r(/*! ../types/level */"./src/types/level.ts");function f(t,e){return f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},f(t,e)}var d=function(t){var e,r;function d(e,r){var n;return(n=t.call(this,e,r,"[subtitle-stream-controller]")||this).levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}r=t,(e=d).prototype=Object.create(r.prototype),e.prototype.constructor=e,f(e,r);var p,m=d.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(n.Events.ERROR,this.onError,this),t.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(n.Events.ERROR,this.onError,this),t.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(n.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(n.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.startLoad=function(){this.stopLoad(),this.state=l.State.IDLE,this.setInterval(500),this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},m.onLevelLoaded=function(t,e){this.mainDetails=e.details},m.onSubtitleFragProcessed=function(t,e){var r=e.frag,n=e.success;if(this.fragPrevious=r,this.state=l.State.IDLE,n){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var a,o=r.start,s=0;s<i.length;s++)if(o>=i[s].start&&o<=i[s].end){a=i[s];break}var u=r.start+r.duration;a?a.end=u:i.push(a={start:o,end:u}),this.fragmentTracker.fragBuffered(r)}}},m.onBufferFlushing=function(t,e){var r=e.startOffset,n=e.endOffset;if(0===r&&n!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,a=this.levels;if(!a.length||!a[i]||!a[i].details)return;var o=n-a[i].details.targetduration;if(o<=0)return;e.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=o)t.shift();else{if(!(t[e].start<o))break;t[e].start=o,e++}})),this.fragmentTracker.removeFragmentsInRange(r,o,c.PlaylistLevelType.SUBTITLE)}},m.onError=function(t,e){var r,n=e.frag;n&&n.type===c.PlaylistLevelType.SUBTITLE&&(null!==(r=this.fragCurrent)&&void 0!==r&&r.loader&&this.fragCurrent.loader.abort(),this.state=l.State.IDLE)},m.onSubtitleTracksUpdated=function(t,e){var r=this,n=e.subtitleTracks;this.tracksBuffered=[],this.levels=n.map((function(t){return new h.Level(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){r.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},m.onSubtitleTrackSwitch=function(t,e){if(this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];this.mediaBuffer=null!=r&&r.details?this.mediaBufferTimeRanges:null,r&&this.setInterval(500)}else this.clearInterval()},m.onSubtitleTrackLoaded=function(t,e){var r,n=e.details,i=e.id,u=this.currentTrackId,c=this.levels;if(c.length){var h=c[u];if(!(i>=c.length||i!==u)&&h){if(this.mediaBuffer=this.mediaBufferTimeRanges,n.live||null!==(r=h.details)&&void 0!==r&&r.live){var f=this.mainDetails;if(n.deltaUpdateFailed||!f)return;var d=f.fragments[0];h.details?0===this.alignPlaylists(n,h.details)&&d&&Object(s.addSliding)(n,d.start):n.hasProgramDateTime&&f.hasProgramDateTime?Object(o.alignMediaPlaylistByPDT)(n,f):d&&Object(s.addSliding)(n,d.start)}h.details=n,this.levelLastLoaded=i,this.tick(),n.live&&!this.fragCurrent&&this.media&&this.state===l.State.IDLE&&(Object(a.findFragmentByPTS)(null,n.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0))}}},m._handleFragmentLoadComplete=function(t){var e=t.frag,r=t.payload,i=e.decryptdata,a=this.hls;if(!this.fragContextChanged(e)&&r&&r.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){var o=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).then((function(t){var r=performance.now();a.trigger(n.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:o,tdecrypt:r}})}))}},m.doTick=function(){if(this.media){if(this.state===l.State.IDLE){var t,e=this.currentTrackId,r=this.levels;if(!r.length||!r[e]||!r[e].details)return;var n=r[e].details,o=n.targetduration,s=this.config,c=i.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,this.media.currentTime-o,s.maxBufferHole),h=c.end;if(c.len>this.getMaxBufferLength()+o)return;console.assert(n,"Subtitle track details are defined on idle subtitle stream controller tick");var f,d=n.fragments,p=d.length,m=this.fragPrevious;if(h<n.edge){var v=s.maxFragLookUpTolerance;!(f=Object(a.findFragmentByPTS)(m,d,h,v))&&m&&m.start<d[0].start&&(f=d[0])}else f=d[p-1];null!==(t=f)&&void 0!==t&&t.encrypted?this.loadKey(f,n):f&&this.fragmentTracker.getState(f)===u.FragmentState.NOT_LOADED&&this.loadFragment(f,n,h)}}else this.state=l.State.IDLE},m.loadFragment=function(e,r,n){this.fragCurrent=e,t.prototype.loadFragment.call(this,e,r,n)},(p=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(d.prototype,p),d}(l.default)},"./src/controller/subtitle-track-controller.ts":
/*!*****************************************************!*\
	  !*** ./src/controller/subtitle-track-controller.ts ***!
	  \*****************************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),a=r(/*! ./base-playlist-controller */"./src/controller/base-playlist-controller.ts"),o=r(/*! ../types/loader */"./src/types/loader.ts");function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}var u=function(t){var e,r;function a(e){var r;return(r=t.call(this,e,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r.subtitleDisplay=!0,r.registerListeners(),r}r=t,(e=a).prototype=Object.create(r.prototype),e.prototype.constructor=e,s(e,r);var u,c=a.prototype;return c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},c.registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(n.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(n.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(n.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(n.Events.ERROR,this.onError,this)},c.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},c.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},c.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),l(this.media.textTracks).forEach((function(t){Object(i.clearCurrentCues)(t)})),this.subtitleTrack=-1,this.media=null)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},c.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},c.onSubtitleTrackLoaded=function(t,e){var r=e.id,n=e.details,i=this.tracksInGroup[this.trackId];if(i){var a=i.details;i.details=e.details,this.log("subtitle track "+r+" loaded ["+n.startSN+"-"+n.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,a))}else this.warn("Invalid subtitle track id "+r)},c.onLevelLoading=function(t,e){this.switchLevel(e.level)},c.onLevelSwitching=function(t,e){this.switchLevel(e.level)},c.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.textGroupIds){var r=e.textGroupIds[e.urlId];if(this.groupId!==r){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,a=this.tracks.filter((function(t){return!r||t.groupId===r}));this.tracksInGroup=a;var o=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=r;var s={subtitleTracks:a};this.log("Updating subtitle tracks, "+a.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(n.Events.SUBTITLE_TRACKS_UPDATED,s),-1!==o&&this.setSubtitleTrack(o,i)}}},c.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var n=e[r];if((!this.selectDefaultTrack||n.default)&&(!t||t===n.name))return n.id}return-1},c.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===o.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},c.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var r=e.id,i=e.groupId,a=e.url;if(t)try{a=t.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADING,{url:a,id:r,groupId:i,deliveryDirectives:t||null})}},c.toggleTrackModes=function(t){var e=this,r=this.media,n=this.subtitleDisplay,i=this.trackId;if(r){var a=l(r.textTracks),o=a.filter((function(t){return t.groupId===e.groupId}));if(-1===t)[].slice.call(a).forEach((function(t){t.mode="disabled"}));else{var s=o[i];s&&(s.mode="disabled")}var u=o[t];u&&(u.mode=n?"showing":"hidden")}},c.setSubtitleTrack=function(t,e){var r,i=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(r=i[t])&&void 0!==r&&r.details)||t<-1||t>=i.length)){this.clearTimer();var a=i[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,a){var o=a.groupId;this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:a.id,groupId:void 0===o?"":o,name:a.name,type:a.type,url:a.url});var s=this.switchParams(a.url,null==e?void 0:e.details);this.loadPlaylist(s)}else this.hls.trigger(n.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},c.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=l(this.media.textTracks),r=0;r<e.length;r++)if("hidden"===e[r].mode)t=r;else if("showing"===e[r].mode){t=r;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},(u=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t,this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(a.prototype,u),a}(a.default);function l(t){for(var e=[],r=0;r<t.length;r++){var n=t[r];"subtitles"===n.kind&&n.label&&e.push(t[r])}return e}e.default=u},"./src/controller/timeline-controller.ts":
/*!***********************************************!*\
	  !*** ./src/controller/timeline-controller.ts ***!
	  \***********************************************/
/*! exports provided: TimelineController */function(t,e,r){r.r(e),r.d(e,"TimelineController",(function(){return f}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/cea-608-parser */"./src/utils/cea-608-parser.ts"),o=r(/*! ../utils/output-filter */"./src/utils/output-filter.ts"),s=r(/*! ../utils/webvtt-parser */"./src/utils/webvtt-parser.ts"),u=r(/*! ../utils/texttrack-utils */"./src/utils/texttrack-utils.ts"),l=r(/*! ../utils/imsc1-ttml-parser */"./src/utils/imsc1-ttml-parser.ts"),c=r(/*! ../types/loader */"./src/types/loader.ts"),h=r(/*! ../utils/logger */"./src/utils/logger.ts"),f=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new o.default(this,"textTrack1"),r=new o.default(this,"textTrack2"),n=new o.default(this,"textTrack3"),s=new o.default(this,"textTrack4");this.cea608Parser1=new a.default(1,e,r),this.cea608Parser2=new a.default(3,n,s)}t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(i.Events.FRAG_LOADING,this.onFragLoading,this),t.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(i.Events.FRAG_LOADING,this.onFragLoading,this),t.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,r,n,a){for(var o,s,u=!1,l=a.length;l--;){var c=a[l],h=(o=c[0],s=e,Math.min(c[1],r)-Math.max(o,s));if(h>=0&&(c[0]=Math.min(c[0],e),c[1]=Math.max(c[1],r),u=!0,h/(r-e)>.5))return}if(u||a.push([e,r]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],e,r,n);else{var f=this.Cues.newCue(null,e,r,n);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:f,track:t})}},e.onInitPtsFound=function(t,e){var r=this,n=e.frag,a=e.timescale,o=this.unparsedVttFrags;"main"===e.id&&(this.initPTS[n.cc]=e.initPTS,this.timescale[n.cc]=a),o.length&&(this.unparsedVttFrags=[],o.forEach((function(t){r.onFragLoaded(i.Events.FRAG_LOADED,t)})))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var n=e.textTracks[r];if(n[t])return n}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsTracks,r=this.media,n=this.captionsProperties[t],i=n.label,a=n.languageCode,o=this.getExistingTrack(t);if(o)e[t]=o,Object(u.clearCurrentCues)(e[t]),Object(u.sendAddTrackEvent)(e[t],r);else{var s=this.createTextTrack("captions",i,a);s&&(s[t]=!0,e[t]=s)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var r={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},e.createTextTrack=function(t,e,r){var n=this.media;if(n)return n.addTextTrack(t,e,r)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){Object(u.clearCurrentCues)(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)Object(u.clearCurrentCues)(e[r])}},e.onSubtitleTracksUpdated=function(t,e){var r=this;this.textTracks=[];var n=e.subtitleTracks||[],a=n.some((function(t){return t.textCodec===l.IMSC1_CODEC}));if(this.config.enableWebVTT||a&&this.config.enableIMSC1){var o=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,e){var n;if(e<s.length){for(var i=null,a=0;a<s.length;a++)if(d(s[a],t)){i=s[a];break}i&&(n=i)}n?Object(u.clearCurrentCues)(n):(n=r.createTextTrack("subtitles",t.name,t.lang))&&(n.mode="disabled"),n&&(n.groupId=t.groupId,r.textTracks.push(n))}))}else if(!o&&this.tracks&&this.tracks.length){var c=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:c})}}},e.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var n=r.captionsProperties["textTrack"+e[1]];n&&(n.label=t.name,t.lang&&(n.languageCode=t.lang),n.media=t)}}))},e.onFragLoading=function(t,e){var r=this.cea608Parser1,n=this.cea608Parser2,i=this.lastSn;if(this.enabled&&r&&n&&e.frag.type===c.PlaylistLevelType.MAIN){var a,o,s=e.frag.sn,u=null!=(a=null==e||null===(o=e.part)||void 0===o?void 0:o.index)?a:-1;s===i+1||s===i&&u===this.lastPartIndex+1||(r.reset(),n.reset()),this.lastSn=s,this.lastPartIndex=u}},e.onFragLoaded=function(t,e){var r=e.frag,a=e.payload,o=this.initPTS,s=this.unparsedVttFrags;if(r.type===c.PlaylistLevelType.SUBTITLE)if(a.byteLength){if(!Object(n.isFiniteNumber)(o[r.cc]))return s.push(e),void(o.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var u=r.decryptdata;if(null==u||null==u.key||"AES-128"!==u.method||"stats"in e){var h=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===l.IMSC1_CODEC?this._parseIMSC1(r,a):this._parseVTTs(r,a,f)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var r=this,n=this.hls;Object(l.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(e){r._appendCues(e,t.level),n.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){h.logger.log("Failed to parse IMSC1: "+e),n.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t,e,r){var n=this,a=this.hls;Object(s.parseWebVTT)(e,this.initPTS[t.cc],this.timescale[t.cc],r,t.cc,t.start,(function(e){n._appendCues(e,t.level),a.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(r){n._fallbackToIMSC1(t,e),h.logger.log("Failed to parse VTT cue: "+r),a.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})}))},e._fallbackToIMSC1=function(t,e){var r=this,n=this.tracks[t.level];n.textCodec||Object(l.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(){n.textCodec=l.IMSC1_CODEC,r._parseIMSC1(t,e)}),(function(){n.textCodec="wvtt"}))},e._appendCues=function(t,e){var r=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[e];if("disabled"===n.mode)return;t.forEach((function(t){return Object(u.addCueToTrack)(n,t)}))}else r.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:t,track:this.tracks[e].default?"default":"subtitles"+e})},e.onFragDecrypted=function(t,e){var r=e.frag;if(r.type===c.PlaylistLevelType.SUBTITLE){if(!Object(n.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(i.Events.FRAG_LOADED,e)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var r=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&r&&n)for(var i=0;i<e.samples.length;i++){var a=e.samples[i].bytes;if(a){var o=this.extractCea608Data(a);r.addData(e.samples[i].pts,o[0]),n.addData(e.samples[i].pts,o[1])}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,n=e.endOffset,i=e.endOffsetSubtitles,a=e.type,o=this.media;if(o&&!(o.currentTime<n)){if(!a||"video"===a){var s=this.captionsTracks;Object.keys(s).forEach((function(t){return Object(u.removeCuesInRange)(s[t],r,n)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==i){var l=this.textTracks;Object.keys(l).forEach((function(t){return Object(u.removeCuesInRange)(l[t],r,i)}))}}},e.extractCea608Data=function(t){for(var e=31&t[0],r=2,n=[[],[]],i=0;i<e;i++){var a=t[r++],o=127&t[r++],s=127&t[r++],u=3&a;0===o&&0===s||0!=(4&a)&&(0!==u&&1!==u||(n[u].push(o),n[u].push(s)))}return n},t}();function d(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}},"./src/crypt/aes-crypto.ts":
/*!*********************************!*\
	  !*** ./src/crypt/aes-crypto.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return n}));var n=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}()},"./src/crypt/aes-decryptor.ts":
/*!************************************!*\
	  !*** ./src/crypt/aes-decryptor.ts ***!
	  \************************************/
/*! exports provided: removePadding, default */function(t,e,r){r.r(e),r.d(e,"removePadding",(function(){return i})),r.d(e,"default",(function(){return a}));var n=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts");function i(t){var e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?Object(n.sliceUint8)(t,0,e-r):t}var a=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),n=0;n<4;n++)r[n]=e.getUint32(4*n);return r},e.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],o=r[3],s=this.invSubMix,u=s[0],l=s[1],c=s[2],h=s[3],f=new Uint32Array(256),d=0,p=0,m=0;for(m=0;m<256;m++)f[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var v=p^p<<1^p<<2^p<<3^p<<4;t[d]=v=v>>>8^255&v^99,e[v]=d;var g=f[d],y=f[g],_=f[y],b=257*f[v]^16843008*v;n[d]=b<<24|b>>>8,i[d]=b<<16|b>>>16,a[d]=b<<8|b>>>24,o[d]=b,u[v]=(b=16843009*_^65537*y^257*g^16843008*d)<<24|b>>>8,l[v]=b<<16|b>>>16,c[v]=b<<8|b>>>24,h[v]=b,d?(d=g^f[f[f[_^g]]],p^=f[f[p]]):d=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,n=0;n<e.length&&r;)r=e[n]===this.key[n],n++;if(!r){this.key=e;var i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,o,s,u,l=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),f=this.sBox,d=this.rcon,p=this.invSubMix,m=p[0],v=p[1],g=p[2],y=p[3];for(a=0;a<l;a++)a<i?s=c[a]=e[a]:(u=s,a%i==0?(u=f[(u=u<<8|u>>>24)>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u],u^=d[a/i|0]<<24):i>6&&a%i==4&&(u=f[u>>>24]<<24|f[u>>>16&255]<<16|f[u>>>8&255]<<8|f[255&u]),c[a]=s=(c[a-i]^u)>>>0);for(o=0;o<l;o++)a=l-o,u=3&o?c[a]:c[a-4],h[o]=o<4||a<=4?u:m[f[u>>>24]]^v[f[u>>>16&255]]^g[f[u>>>8&255]]^y[f[255&u]],h[o]=h[o]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,r){for(var n,i,a,o,s,u,l,c,h,f,d,p,m,v=this.keySize+6,g=this.invKeySchedule,y=this.invSBox,_=this.invSubMix,b=_[0],x=_[1],w=_[2],M=_[3],A=this.uint8ArrayToUint32Array_(r),E=A[0],S=A[1],T=A[2],C=A[3],O=new Int32Array(t),P=new Int32Array(O.length),L=this.networkToHostOrderSwap;e<O.length;){for(c=L(O[e]),h=L(O[e+1]),f=L(O[e+2]),d=L(O[e+3]),o=c^g[0],s=d^g[1],u=f^g[2],l=h^g[3],p=4,m=1;m<v;m++)n=b[s>>>24]^x[u>>16&255]^w[l>>8&255]^M[255&o]^g[p+1],i=b[u>>>24]^x[l>>16&255]^w[o>>8&255]^M[255&s]^g[p+2],a=b[l>>>24]^x[o>>16&255]^w[s>>8&255]^M[255&u]^g[p+3],o=b[o>>>24]^x[s>>16&255]^w[u>>8&255]^M[255&l]^g[p],s=n,u=i,l=a,p+=4;n=y[s>>>24]<<24^y[u>>16&255]<<16^y[l>>8&255]<<8^y[255&o]^g[p+1],i=y[u>>>24]<<24^y[l>>16&255]<<16^y[o>>8&255]<<8^y[255&s]^g[p+2],a=y[l>>>24]<<24^y[o>>16&255]<<16^y[s>>8&255]<<8^y[255&u]^g[p+3],P[e]=L(y[o>>>24]<<24^y[s>>16&255]<<16^y[u>>8&255]<<8^y[255&l]^g[p]^E),P[e+1]=L(a^S),P[e+2]=L(i^T),P[e+3]=L(n^C),E=c,S=h,T=f,C=d,e+=4}return P.buffer},t}()},"./src/crypt/decrypter.ts":
/*!********************************!*\
	  !*** ./src/crypt/decrypter.ts ***!
	  \********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return l}));var n=r(/*! ./aes-crypto */"./src/crypt/aes-crypto.ts"),i=r(/*! ./fast-aes-key */"./src/crypt/fast-aes-key.ts"),a=r(/*! ./aes-decryptor */"./src/crypt/aes-decryptor.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),u=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),l=function(){function t(t,e,r){var n=(void 0===r?{}:r).removePKCS7Padding,i=void 0===n||n;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=i,i)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t=this.currentResult;if(t){var e=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(a.removePadding)(e):e}this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,r,n){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),e,r);var i=this.flush();i&&n(i.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),e,r).then(n)},e.softwareDecrypt=function(t,e,r){var n=this.currentIV,i=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=Object(s.appendUint8Array)(o,t),this.remainderData=null);var l=this.getValidChunk(t);if(!l.length)return null;n&&(r=n);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new a.default),c.expandKey(e);var h=i;return this.currentResult=c.decrypt(l.buffer,0,r),this.currentIV=Object(u.sliceUint8)(l,-16).buffer,h||null},e.webCryptoDecrypt=function(t,e,r){var a=this,o=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new i.default(o,e)),this.fastAesKey.expandKey().then((function(e){return o?new n.default(o,r).decrypt(t.buffer,e):Promise.reject(new Error("web crypto not initialized"))})).catch((function(n){return a.onWebCryptoError(n,t,e,r)}))},e.onWebCryptoError=function(t,e,r,n){return o.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,r,n)},e.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=Object(u.sliceUint8)(t,0,r),this.remainderData=Object(u.sliceUint8)(t,r)),e},e.logOnce=function(t){this.logEnabled&&(o.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":
/*!***********************************!*\
	  !*** ./src/crypt/fast-aes-key.ts ***!
	  \***********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return n}));var n=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":
/*!*********************************!*\
	  !*** ./src/demux/aacdemuxer.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ./adts */"./src/demux/adts.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ../demux/id3 */"./src/demux/id3.ts");function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}var u=function(t){var e,r;function n(e,r){var n;return(n=t.call(this)||this).observer=void 0,n.config=void 0,n.observer=e,n.config=r,n}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,s(e,r);var u=n.prototype;return u.resetInitSegment=function(e,r,n){t.prototype.resetInitSegment.call(this,e,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var e=(o.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(i.probe(t,e))return a.logger.log("ADTS sync word found !"),!0;return!1},u.canParse=function(t,e){return i.canParse(t,e)},u.appendFrame=function(t,e,r){i.initTrackConfig(t,this.observer,e,r,t.manifestCodec);var n=i.appendFrame(t,e,r,this.initPTS,this.frameIndex);if(n&&0===n.missing)return n},n}(n.default);u.minProbeByteLength=9,e.default=u},"./src/demux/adts.ts":
/*!***************************!*\
	  !*** ./src/demux/adts.ts ***!
	  \***************************/
/*! exports provided: getAudioConfig, isHeaderPattern, getHeaderLength, getFullFrameLength, canGetFrameLength, isHeader, canParse, probe, initTrackConfig, getFrameDuration, parseFrameHeader, appendFrame */function(t,e,r){r.r(e),r.d(e,"getAudioConfig",(function(){return o})),r.d(e,"isHeaderPattern",(function(){return s})),r.d(e,"getHeaderLength",(function(){return u})),r.d(e,"getFullFrameLength",(function(){return l})),r.d(e,"canGetFrameLength",(function(){return c})),r.d(e,"isHeader",(function(){return h})),r.d(e,"canParse",(function(){return f})),r.d(e,"probe",(function(){return d})),r.d(e,"initTrackConfig",(function(){return p})),r.d(e,"getFrameDuration",(function(){return m})),r.d(e,"parseFrameHeader",(function(){return v})),r.d(e,"appendFrame",(function(){return g}));var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../events */"./src/events.ts");function o(t,e,r,o){var s,u,l,c,h=navigator.userAgent.toLowerCase(),f=o,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=1+((192&e[r+2])>>>6);var p=(60&e[r+2])>>>2;if(!(p>d.length-1))return l=(1&e[r+2])<<2,l|=(192&e[r+3])>>>6,n.logger.log("manifest codec:"+o+", ADTS type:"+s+", samplingIndex:"+p),/firefox/i.test(h)?p>=6?(s=5,c=new Array(4),u=p-3):(s=2,c=new Array(2),u=p):-1!==h.indexOf("android")?(s=2,c=new Array(2),u=p):(s=5,c=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&p>=6?u=p-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(p>=6&&1===l||/vivaldi/i.test(h))||!o&&1===l)&&(s=2,c=new Array(2)),u=p)),c[0]=s<<3,c[0]|=(14&p)>>1,c[1]|=(1&p)<<7,c[1]|=l<<3,5===s&&(c[1]|=(14&u)>>1,c[2]=(1&u)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[p],channelCount:l,codec:"mp4a.40."+s,manifestCodec:f};t.trigger(a.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function s(t,e){return 255===t[e]&&240==(246&t[e+1])}function u(t,e){return 1&t[e+1]?7:9}function l(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function c(t,e){return e+5<t.length}function h(t,e){return e+1<t.length&&s(t,e)}function f(t,e){return c(t,e)&&s(t,e)&&l(t,e)<=t.length-e}function d(t,e){if(h(t,e)){var r=u(t,e);if(e+r>=t.length)return!1;var n=l(t,e);if(n<=r)return!1;var i=e+n;return i===t.length||h(t,i)}return!1}function p(t,e,r,i,a){if(!t.samplerate){var s=o(e,r,i,a);if(!s)return;t.config=s.config,t.samplerate=s.samplerate,t.channelCount=s.channelCount,t.codec=s.codec,t.manifestCodec=s.manifestCodec,n.logger.log("parsed codec:"+t.codec+", rate:"+s.samplerate+", channels:"+s.channelCount)}}function m(t){return 9216e4/t}function v(t,e,r,n,i){var a=u(t,e),o=l(t,e);if((o-=a)>0)return{headerLength:a,frameLength:o,stamp:r+n*i}}function g(t,e,r,n,i){var a=v(e,r,n,i,m(t.samplerate));if(a){var o,s=a.headerLength,u=a.stamp,l=s+a.frameLength,c=Math.max(0,r+l-e.length);c?(o=new Uint8Array(l-s)).set(e.subarray(r+s,e.length),0):o=e.subarray(r+s,r+l);var h={unit:o,pts:u};return c||t.samples.push(h),{sample:h,length:l,missing:c}}}},"./src/demux/base-audio-demuxer.ts":
/*!*****************************************!*\
	  !*** ./src/demux/base-audio-demuxer.ts ***!
	  \*****************************************/
/*! exports provided: initPTSFn, default */function(t,e,r){r.r(e),r.d(e,"initPTSFn",(function(){return l}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),o=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),s=r(/*! ../utils/typed-array */"./src/utils/typed-array.ts"),u=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(){},e.resetContiguity=function(){},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,r){},e.demux=function(t,e){this.cachedData&&(t=Object(o.appendUint8Array)(this.cachedData,t),this.cachedData=null);var r,n,u=i.getID3Data(t,0),c=u?u.length:0,h=this._audioTrack,f=this._id3Track,d=u?i.getTimeStamp(u):void 0,p=t.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=l(d,e)),u&&u.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:u}),n=this.initPTS;c<p;){if(this.canParse(t,c)){var m=this.appendFrame(h,t,c);m?(this.frameIndex++,n=m.sample.pts,r=c+=m.length):c=p}else i.canParse(t,c)?(u=i.getID3Data(t,c),f.samples.push({pts:n,dts:n,data:u}),r=c+=u.length):c++;if(c===p&&r!==p){var v=Object(s.sliceUint8)(t,r);this.cachedData=this.cachedData?Object(o.appendUint8Array)(this.cachedData,v):v}}return{audioTrack:h,avcTrack:Object(a.dummyTrack)(),id3Track:f,textTrack:Object(a.dummyTrack)()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(a.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(a.dummyTrack)()}},e.destroy=function(){},t}(),l=function(t,e){return Object(n.isFiniteNumber)(t)?90*t:9e4*e};e.default=u},"./src/demux/chunk-cache.ts":
/*!**********************************!*\
	  !*** ./src/demux/chunk-cache.ts ***!
	  \**********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return n}));var n=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks;return e.length?(t=1===e.length?e[0]:function(t,e){for(var r=new Uint8Array(e),n=0,i=0;i<t.length;i++){var a=t[i];r.set(a,n),n+=a.length}return r}(e,this.dataLength),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}()},"./src/demux/dummy-demuxed-track.ts":
/*!******************************************!*\
	  !*** ./src/demux/dummy-demuxed-track.ts ***!
	  \******************************************/
/*! exports provided: dummyTrack */function(t,e,r){function n(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}r.r(e),r.d(e,"dummyTrack",(function(){return n}))},"./src/demux/exp-golomb.ts":
/*!*********************************!*\
	  !*** ./src/demux/exp-golomb.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,n=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");n.set(t.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?r<<e|this.readBits(e):r},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,r=8,n=0;n<t;n++)0!==r&&(r=(e+this.readEG()+256)%256),e=0===r?e:r},e.readSPS=function(){var t,e,r,n=0,i=0,a=0,o=0,s=this.readUByte.bind(this),u=this.readBits.bind(this),l=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),f=this.skipEG.bind(this),d=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);s();var m=s();if(u(5),h(3),s(),d(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var v=l();if(3===v&&h(1),d(),d(),h(1),c())for(e=3!==v?8:12,r=0;r<e;r++)c()&&p(r<6?16:64)}d();var g=l();if(0===g)l();else if(1===g)for(h(1),f(),f(),t=l(),r=0;r<t;r++)f();d(),h(1);var y=l(),_=l(),b=u(1);0===b&&h(1),h(1),c()&&(n=l(),i=l(),a=l(),o=l());var x=[1,1];if(c()&&c())switch(s()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[s()<<8|s(),s()<<8|s()]}return{width:Math.ceil(16*(y+1)-2*n-2*i),height:(2-b)*(_+1)*16-(b?2:4)*(a+o),pixelRatio:x}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e.default=i},"./src/demux/id3.ts":
/*!**************************!*\
	  !*** ./src/demux/id3.ts ***!
	  \**************************/
/*! exports provided: isHeader, isFooter, getID3Data, canParse, getTimeStamp, isTimeStampFrame, getID3Frames, decodeFrame, utf8ArrayToStr, testables */function(t,e,r){r.r(e),r.d(e,"isHeader",(function(){return i})),r.d(e,"isFooter",(function(){return a})),r.d(e,"getID3Data",(function(){return o})),r.d(e,"canParse",(function(){return u})),r.d(e,"getTimeStamp",(function(){return l})),r.d(e,"isTimeStampFrame",(function(){return c})),r.d(e,"getID3Frames",(function(){return f})),r.d(e,"decodeFrame",(function(){return d})),r.d(e,"utf8ArrayToStr",(function(){return y})),r.d(e,"testables",(function(){return _}));var n,i=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},a=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o=function(t,e){for(var r=e,n=0;i(t,e);)n+=10,n+=s(t,e+6),a(t,e+10)&&(n+=10),e+=n;if(n>0)return t.subarray(r,r+n)},s=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,(r|=(127&t[e+2])<<7)|127&t[e+3]},u=function(t,e){return i(t,e)&&s(t,e+6)+10<=t.length-e},l=function(t){for(var e=f(t),r=0;r<e.length;r++){var n=e[r];if(c(n))return g(n)}},c=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},h=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=s(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}},f=function(t){for(var e=0,r=[];i(t,e);){for(var n=s(t,e+6),o=(e+=10)+n;e+8<o;){var u=h(t.subarray(e)),l=d(u);l&&r.push(l),e+=u.size+10}a(t,e)&&(e+=10)}return r},d=function(t){return"PRIV"===t.type?p(t):"W"===t.type[0]?v(t):m(t)},p=function(t){if(!(t.size<2)){var e=y(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},m=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=y(t.data.subarray(e),!0),n=y(t.data.subarray(e+=r.length+1));return{key:t.type,info:r,data:n}}var i=y(t.data.subarray(1));return{key:t.type,data:i}}},v=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=y(t.data.subarray(e),!0),n=y(t.data.subarray(e+=r.length+1));return{key:t.type,info:r,data:n}}var i=y(t.data);return{key:t.type,data:i}},g=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,1&e[3]&&(r+=47721858.84),Math.round(r)}},y=function(t,e){void 0===e&&(e=!1);var r=b();if(r){var n=r.decode(t);if(e){var i=n.indexOf("\0");return-1!==i?n.substring(0,i):n}return n.replace(/\0/g,"")}for(var a,o,s,u=t.length,l="",c=0;c<u;){if(0===(a=t[c++])&&e)return l;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(a);break;case 12:case 13:o=t[c++],l+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=t[c++],s=t[c++],l+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&s)<<0)}}return l},_={decodeTextFrame:m};function b(){return n||void 0===self.TextDecoder||(n=new self.TextDecoder("utf-8")),n}},"./src/demux/mp3demuxer.ts":
/*!*********************************!*\
	  !*** ./src/demux/mp3demuxer.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./base-audio-demuxer */"./src/demux/base-audio-demuxer.ts"),i=r(/*! ../demux/id3 */"./src/demux/id3.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts");function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}var u=function(t){var e,r;function n(){return t.apply(this,arguments)||this}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,s(e,r);var u=n.prototype;return u.resetInitSegment=function(e,r,n){t.prototype.resetInitSegment.call(this,e,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:e,duration:n,inputTimeScale:9e4,dropped:0}},n.probe=function(t){if(!t)return!1;for(var e=(i.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(o.probe(t,e))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},u.canParse=function(t,e){return o.canParse(t,e)},u.appendFrame=function(t,e,r){if(null!==this.initPTS)return o.appendFrame(t,e,r,this.initPTS,this.frameIndex)},n}(n.default);u.minProbeByteLength=4,e.default=u},"./src/demux/mp4demuxer.ts":
/*!*********************************!*\
	  !*** ./src/demux/mp4demuxer.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),i=r(/*! ./dummy-demuxed-track */"./src/demux/dummy-demuxed-track.ts"),a=function(){function t(t,e){this.remainderData=null,this.config=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.resetContiguity=function(){},t.probe=function(t){return Object(n.findBox)({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.demux=function(t){var e=t,r=Object(i.dummyTrack)();if(this.config.progressive){this.remainderData&&(e=Object(n.appendUint8Array)(this.remainderData,t));var a=Object(n.segmentValidRange)(e);this.remainderData=a.remainder,r.samples=a.valid||new Uint8Array}else r.samples=e;return{audioTrack:Object(i.dummyTrack)(),avcTrack:r,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},e.flush=function(){var t=Object(i.dummyTrack)();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:t,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}();a.minProbeByteLength=1024,e.default=a},"./src/demux/mpegaudio.ts":
/*!********************************!*\
	  !*** ./src/demux/mpegaudio.ts ***!
	  \********************************/
/*! exports provided: appendFrame, parseHeader, isHeaderPattern, isHeader, canParse, probe */function(t,e,r){r.r(e),r.d(e,"appendFrame",(function(){return u})),r.d(e,"parseHeader",(function(){return l})),r.d(e,"isHeaderPattern",(function(){return c})),r.d(e,"isHeader",(function(){return h})),r.d(e,"canParse",(function(){return f})),r.d(e,"probe",(function(){return d}));var n=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],a=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],o=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],s=[0,1,1,4];function u(t,e,r,n,i){if(!(r+24>e.length)){var a=l(e,r);if(a&&r+a.frameLength<=e.length){var o=n+i*(9e4*a.samplesPerFrame/a.sampleRate),s={unit:e.subarray(r,r+a.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=a.channelCount,t.samplerate=a.sampleRate,t.samples.push(s),{sample:s,length:a.frameLength,missing:0}}}}function l(t,e){var r=t[e+1]>>3&3,u=t[e+1]>>1&3,l=t[e+2]>>4&15,c=t[e+2]>>2&3;if(1!==r&&0!==l&&15!==l&&3!==c){var h=t[e+3]>>6,f=1e3*i[14*(3===r?3-u:3===u?3:4)+l-1],d=a[3*(3===r?0:2===r?1:2)+c],p=3===h?1:2,m=o[r][u],v=s[u],g=8*m*v,y=Math.floor(m*f/d+(t[e+2]>>1&1))*v;if(null===n){var _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);n=_?parseInt(_[1]):0}return!!n&&n<=87&&2===u&&f>=224e3&&0===h&&(t[e+3]=128|t[e+3]),{sampleRate:d,channelCount:p,frameLength:y,samplesPerFrame:g}}}function c(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function h(t,e){return e+1<t.length&&c(t,e)}function f(t,e){return c(t,e)&&4<=t.length-e}function d(t,e){if(e+1<t.length&&c(t,e)){var r=l(t,e),n=4;null!=r&&r.frameLength&&(n=r.frameLength);var i=e+n;return i===t.length||h(t,i)}return!1}},"./src/demux/sample-aes.ts":
/*!*********************************!*\
	  !*** ./src/demux/sample-aes.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),i=r(/*! ./tsdemuxer */"./src/demux/tsdemuxer.ts"),a=function(){function t(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new n.default(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},e.decryptAacSample=function(t,e,r,n){var i=t[e].unit,a=i.subarray(16,i.length-i.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),s=this;this.decryptBuffer(o,(function(a){var o=new Uint8Array(a);i.set(o,16),n||s.decryptAacSamples(t,e+1,r)}))},e.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var n=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,n),!n)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),n=0,i=32;i<t.length-16;i+=160,n+=16)r.set(t.subarray(i,i+16),n);return r},e.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),n=0,i=32;i<t.length-16;i+=160,n+=16)t.set(r.subarray(n,n+16),i);return t},e.decryptAvcSample=function(t,e,r,n,a,o){var s=Object(i.discardEPB)(a.data),u=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(u.buffer,(function(i){a.data=l.getAvcDecryptedUnit(s,i),o||l.decryptAvcSamples(t,e,r+1,n)}))},e.decryptAvcSamples=function(t,e,r,n){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void n();for(var i=t[e].units;!(r>=i.length);r++){var a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,n,a,o),!o)return}}}},t}();e.default=a},"./src/demux/transmuxer-interface.ts":
/*!*******************************************!*\
	  !*** ./src/demux/transmuxer-interface.ts ***!
	  \*******************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return h}));var n=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../errors */"./src/errors.ts"),u=r(/*! ../utils/mediasource-helper */"./src/utils/mediasource-helper.ts"),l=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),c=Object(u.getMediaSource)()||{isTypeSupported:function(){return!1}},h=function(){function t(t,e,r,u){var h=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=r,this.onFlush=u;var f=t.config,d=function(e,r){(r=r||{}).frag=h.frag,r.id=h.id,t.trigger(e,r)};this.observer=new l.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,d),this.observer.on(i.Events.ERROR,d);var p={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(f.enableWorker&&"undefined"!=typeof Worker){var v;o.logger.log("demuxing in webworker");try{v=this.worker=n(/*! ../demux/transmuxer-worker.ts */"./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(e){t.trigger(i.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},v.postMessage({cmd:"init",typeSupported:p,vendor:m,id:e,config:JSON.stringify(f)})}catch(t){o.logger.warn("Error in worker:",t),o.logger.error("Error while initializing DemuxerWorker, fallback to inline"),v&&self.URL.revokeObjectURL(v.objectURL),this.transmuxer=new a.default(this.observer,p,f,m,e),this.worker=null}}else this.transmuxer=new a.default(this.observer,p,f,m,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.observer=null},e.push=function(t,e,r,n,i,s,u,l,c,h){var f,d,p=this;c.transmuxing.start=self.performance.now();var m=this.transmuxer,v=this.worker,g=s?s.start:i.start,y=i.decryptdata,_=this.frag,b=!(_&&i.cc===_.cc),x=!(_&&c.level===_.level),w=_?c.sn-_.sn:-1,M=this.part?c.part-this.part.index:1,A=!x&&(1===w||0===w&&1===M),E=self.performance.now();(x||w||0===i.stats.parsing.start)&&(i.stats.parsing.start=E),!s||!M&&A||(s.stats.parsing.start=E);var S=!(_&&(null===(f=i.initSegment)||void 0===f?void 0:f.url)===(null===(d=_.initSegment)||void 0===d?void 0:d.url)),T=new a.TransmuxState(b,A,l,x,g,S);if(!A||b||S){o.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+"\n        discontinuity: "+b+"\n        trackSwitch: "+x+"\n        contiguous: "+A+"\n        accurateTimeOffset: "+l+"\n        timeOffset: "+g+"\n        initSegmentChange: "+S);var C=new a.TransmuxConfig(r,n,e,u,h);this.configureTransmuxer(C)}if(this.frag=i,this.part=s,v)v.postMessage({cmd:"demux",data:t,decryptdata:y,chunkMeta:c,state:T},t instanceof ArrayBuffer?[t]:[]);else if(m){var O=m.push(t,y,c,T);Object(a.isPromise)(O)?O.then((function(t){p.handleTransmuxComplete(t)})):this.handleTransmuxComplete(O)}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var r=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:t});else if(r){var i=r.flush(t);Object(a.isPromise)(i)?i.then((function(r){e.handleFlushResult(r,t)})):this.handleFlushResult(i,t)}},e.handleFlushResult=function(t,e){var r=this;t.forEach((function(t){r.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,r=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):r&&r.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":
/*!****************************************!*\
	  !*** ./src/demux/transmuxer-worker.ts ***!
	  \****************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return s}));var n=r(/*! ../demux/transmuxer */"./src/demux/transmuxer.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");function s(t){var e=new o.EventEmitter,r=function(e,r){t.postMessage({event:e,data:r})};e.on(i.Events.FRAG_DECRYPTED,r),e.on(i.Events.ERROR,r),t.addEventListener("message",(function(i){var o=i.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);t.transmuxer=new n.default(e,o.typeSupported,s,o.vendor,o.id),Object(a.enableLogs)(s.debug),r("init",null);break;case"configure":t.transmuxer.configure(o.config);break;case"demux":var l=t.transmuxer.push(o.data,o.decryptdata,o.chunkMeta,o.state);Object(n.isPromise)(l)?l.then((function(e){u(t,e)})):u(t,l);break;case"flush":var h=o.chunkMeta,f=t.transmuxer.flush(h);Object(n.isPromise)(f)?f.then((function(e){c(t,e,h)})):c(t,f,h)}}))}function u(t,e){if((r=e.remuxResult).audio||r.video||r.text||r.id3||r.initSegment){var r,n=[],i=e.remuxResult,a=i.audio,o=i.video;a&&l(n,a),o&&l(n,o),t.postMessage({event:"transmuxComplete",data:e},n)}}function l(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function c(t,e,r){e.forEach((function(e){u(t,e)})),t.postMessage({event:"flush",data:r})}},"./src/demux/transmuxer.ts":
/*!*********************************!*\
	  !*** ./src/demux/transmuxer.ts ***!
	  \*********************************/
/*! exports provided: default, isPromise, TransmuxConfig, TransmuxState */function(t,e,r){r.r(e),r.d(e,"default",(function(){return y})),r.d(e,"isPromise",(function(){return b})),r.d(e,"TransmuxConfig",(function(){return x})),r.d(e,"TransmuxState",(function(){return w}));var n,i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../crypt/decrypter */"./src/crypt/decrypter.ts"),s=r(/*! ../demux/aacdemuxer */"./src/demux/aacdemuxer.ts"),u=r(/*! ../demux/mp4demuxer */"./src/demux/mp4demuxer.ts"),l=r(/*! ../demux/tsdemuxer */"./src/demux/tsdemuxer.ts"),c=r(/*! ../demux/mp3demuxer */"./src/demux/mp3demuxer.ts"),h=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),f=r(/*! ../remux/passthrough-remuxer */"./src/remux/passthrough-remuxer.ts"),d=r(/*! ./chunk-cache */"./src/demux/chunk-cache.ts"),p=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),m=r(/*! ../utils/logger */"./src/utils/logger.ts");try{n=self.performance.now.bind(self.performance)}catch(t){m.logger.debug("Unable to use Performance API on this environment"),n=self.Date.now}var v=[{demux:l.default,remux:h.default},{demux:u.default,remux:f.default},{demux:s.default,remux:h.default},{demux:c.default,remux:h.default}],g=1024;v.forEach((function(t){g=Math.max(g,t.demux.minProbeByteLength)}));var y=function(){function t(t,e,r,n,i){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new d.default,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=n,this.id=i}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,r,i){var a=this,o=r.transmuxing;o.executeStart=n();var s=new Uint8Array(t),u=this.cache,l=this.config,c=this.currentTransmuxState,h=this.transmuxConfig;i&&(this.currentTransmuxState=i);var f=function(t,e){var r=null;return t.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(r=e),r}(s,e);if(f&&"AES-128"===f.method){var d=this.getDecrypter();if(!l.enableSoftwareAES)return this.decryptionPromise=d.webCryptoDecrypt(s,f.key.buffer,f.iv.buffer).then((function(t){var e=a.push(t,null,r);return a.decryptionPromise=null,e})),this.decryptionPromise;var m=d.softwareDecrypt(s,f.key.buffer,f.iv.buffer);if(!m)return o.executeEnd=n(),_(r);s=new Uint8Array(m)}var v=i||c,g=v.contiguous,y=v.discontinuity,b=v.trackSwitch,x=v.accurateTimeOffset,w=v.timeOffset,M=v.initSegmentChange,A=h.defaultInitPts;if((y||b||M)&&this.resetInitSegment(h.initSegmentData,h.audioCodec,h.videoCodec,h.duration),(y||M)&&this.resetInitialTimestamp(A),g||this.resetContiguity(),this.needsProbing(s,y,b)){if(u.dataLength){var E=u.flush();s=Object(p.appendUint8Array)(E,s)}this.configureTransmuxer(s,h)}var S=this.transmux(s,f,w,x,r),T=this.currentTransmuxState;return T.contiguous=!0,T.discontinuity=!1,T.trackSwitch=!1,o.executeEnd=n(),S},e.flush=function(t){var e=this,r=t.transmuxing;r.executeStart=n();var o=this.decrypter,s=this.cache,u=this.currentTransmuxState,l=this.decryptionPromise;if(l)return l.then((function(){return e.flush(t)}));var c=[],h=u.timeOffset;if(o){var f=o.flush();f&&c.push(this.push(f,null,t))}var d=s.dataLength;s.reset();var p=this.demuxer;if(!p||!this.remuxer)return d>=g&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=n(),[_(t)];var m=p.flush(h);return b(m)?m.then((function(r){return e.flushRemux(c,r,t),c})):(this.flushRemux(c,m,t),c)},e.flushRemux=function(t,e,r){var i=e.audioTrack,a=e.avcTrack,o=e.id3Track,s=e.textTrack,u=this.currentTransmuxState,l=u.accurateTimeOffset,c=u.timeOffset;m.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var h=this.remuxer.remux(i,a,o,s,c,l,!0,this.id);t.push({remuxResult:h,chunkMeta:r}),r.transmuxing.executeEnd=n()},e.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,r,n){var i=this.demuxer,a=this.remuxer;i&&a&&(i.resetInitSegment(e,r,n),a.resetInitSegment(t,e,r))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,r,n,i){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,n,i):this.transmuxUnencrypted(t,r,n,i)},e.transmuxUnencrypted=function(t,e,r,n){var i=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i.audioTrack,i.avcTrack,i.id3Track,i.textTrack,e,r,!1,this.id),chunkMeta:n}},e.transmuxSampleAes=function(t,e,r,n,i){var a=this;return this.demuxer.demuxSampleAes(t,e,r).then((function(t){return{remuxResult:a.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,r,n,!1,a.id),chunkMeta:i}}))},e.configureTransmuxer=function(t,e){for(var r,n=this.config,i=this.observer,a=this.typeSupported,o=this.vendor,s=e.audioCodec,l=e.defaultInitPts,c=e.duration,h=e.initSegmentData,d=e.videoCodec,p=0,g=v.length;p<g;p++)if(v[p].demux.probe(t)){r=v[p];break}r||(m.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),r={demux:u.default,remux:f.default});var y=this.demuxer,_=this.remuxer,b=r.remux,x=r.demux;_&&_ instanceof b||(this.remuxer=new b(i,n,a,o)),y&&y instanceof x||(this.demuxer=new x(i,n,a),this.probe=x.probe),this.resetInitSegment(h,s,d,c),this.resetInitialTimestamp(l)},e.needsProbing=function(t,e,r){return!this.demuxer||!this.remuxer||e||r},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new o.default(this.observer,this.config)),t},t}(),_=function(t){return{remuxResult:{},chunkMeta:t}};function b(t){return"then"in t&&t.then instanceof Function}var x=function(t,e,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i},w=function(t,e,r,n,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=a}},"./src/demux/tsdemuxer.ts":
/*!********************************!*\
	  !*** ./src/demux/tsdemuxer.ts ***!
	  \********************************/
/*! exports provided: discardEPB, default */function(t,e,r){r.r(e),r.d(e,"discardEPB",(function(){return b}));var n=r(/*! ./adts */"./src/demux/adts.ts"),i=r(/*! ./mpegaudio */"./src/demux/mpegaudio.ts"),a=r(/*! ./exp-golomb */"./src/demux/exp-golomb.ts"),o=r(/*! ./id3 */"./src/demux/id3.ts"),s=r(/*! ./sample-aes */"./src/demux/sample-aes.ts"),u=r(/*! ../events */"./src/events.ts"),l=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),c=r(/*! ../utils/logger */"./src/utils/logger.ts"),h=r(/*! ../errors */"./src/errors.ts"),f={video:1,audio:2,id3:3,text:4},d=function(){function t(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}t.probe=function(e){var r=t.syncOffset(e);return!(r<0||(r&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),0))},t.syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:f[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",n),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3",n),this._txtTrack=t.createTrack("text",n),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=r,this._duration=n},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},e.demux=function(e,r,n,i){var a;void 0===n&&(n=!1),void 0===i&&(i=!1),n||(this.sampleAes=null);var o=this._avcTrack,s=this._audioTrack,f=this._id3Track,d=o.pid,p=o.pesData,y=s.pid,_=f.pid,b=s.pesData,x=f.pesData,w=!1,M=this.pmtParsed,A=this._pmtId,E=e.length;if(this.remainderData&&(E=(e=Object(l.appendUint8Array)(this.remainderData,e)).length,this.remainderData=null),E<188&&!i)return this.remainderData=e,{audioTrack:s,avcTrack:o,id3Track:f,textTrack:this._txtTrack};var S=Math.max(0,t.syncOffset(e));(E-=(E+S)%188)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));for(var T=0,C=S;C<E;C+=188)if(71===e[C]){var O=!!(64&e[C+1]),P=((31&e[C+1])<<8)+e[C+2],L=void 0;if((48&e[C+3])>>4>1){if((L=C+5+e[C+4])===C+188)continue}else L=C+4;switch(P){case d:O&&(p&&(a=g(p))&&this.parseAVCPES(a,!1),p={data:[],size:0}),p&&(p.data.push(e.subarray(L,C+188)),p.size+=C+188-L);break;case y:O&&(b&&(a=g(b))&&(s.isAAC?this.parseAACPES(a):this.parseMPEGPES(a)),b={data:[],size:0}),b&&(b.data.push(e.subarray(L,C+188)),b.size+=C+188-L);break;case _:O&&(x&&(a=g(x))&&this.parseID3PES(a),x={data:[],size:0}),x&&(x.data.push(e.subarray(L,C+188)),x.size+=C+188-L);break;case 0:O&&(L+=e[L]+1),A=this._pmtId=m(e,L);break;case A:O&&(L+=e[L]+1);var I=v(e,L,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,n);(d=I.avc)>0&&(o.pid=d),(y=I.audio)>0&&(s.pid=y,s.isAAC=I.isAAC),(_=I.id3)>0&&(f.pid=_),w&&!M&&(c.logger.log("reparse from beginning"),w=!1,C=S-188),M=this.pmtParsed=!0;break;case 17:case 8191:break;default:w=!0}}else T++;T>0&&this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+T+" TS packet/s that do not start with 0x47"}),o.pesData=p,s.pesData=b,f.pesData=x;var k={audioTrack:s,avcTrack:o,id3Track:f,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(k),k},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,r=t.audioTrack,n=t.avcTrack,i=t.id3Track,a=n.pesData,o=r.pesData,s=i.pesData;a&&(e=g(a))?(this.parseAVCPES(e,!0),n.pesData=null):n.pesData=a,o&&(e=g(o))?(r.isAAC?this.parseAACPES(e):this.parseMPEGPES(e),r.pesData=null):(null!=o&&o.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o),s&&(e=g(s))?(this.parseID3PES(e),i.pesData=null):i.pesData=s},e.demuxSampleAes=function(t,e,r){var n=this.demux(t,r,!0,!this.config.progressive),i=this.sampleAes=new s.default(this.observer,this.config,e);return this.decrypt(n,i)},e.decrypt=function(t,e){return new Promise((function(r){var n=t.audioTrack,i=t.avcTrack;n.samples&&n.isAAC?e.decryptAacSamples(n.samples,0,(function(){i.samples?e.decryptAvcSamples(i.samples,0,0,(function(){r(t)})):r(t)})):i.samples&&e.decryptAvcSamples(i.samples,0,0,(function(){r(t)}))}))},e.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},e.parseAVCPES=function(t,e){var r,n=this,i=this._avcTrack,s=this.parseAVCNALu(t.data),u=this.avcSample,l=!1;t.data=null,u&&s.length&&!i.audFound&&(y(u,i),u=this.avcSample=p(!1,t.pts,t.dts,"")),s.forEach((function(e){switch(e.type){case 1:r=!0,u||(u=n.avcSample=p(!0,t.pts,t.dts,"")),u.frame=!0;var s=e.data;if(l&&s.length>4){var c=new a.default(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(u.key=!0)}break;case 5:r=!0,u||(u=n.avcSample=p(!0,t.pts,t.dts,"")),u.key=!0,u.frame=!0;break;case 6:r=!0;var h=new a.default(b(e.data));h.readUByte();for(var f=0,d=0,m=!1,v=0;!m&&h.bytesAvailable>1;){f=0;do{f+=v=h.readUByte()}while(255===v);d=0;do{d+=v=h.readUByte()}while(255===v);if(4===f&&0!==h.bytesAvailable){if(m=!0,181===h.readUByte()&&49===h.readUShort()&&1195456820===h.readUInt()&&3===h.readUByte()){for(var g=h.readUByte(),x=31&g,w=[g,h.readUByte()],M=0;M<x;M++)w.push(h.readUByte()),w.push(h.readUByte()),w.push(h.readUByte());_(n._txtTrack.samples,{type:3,pts:t.pts,bytes:w})}}else if(5===f&&0!==h.bytesAvailable){if(m=!0,d>16){for(var A=[],E=0;E<16;E++)A.push(h.readUByte().toString(16)),3!==E&&5!==E&&7!==E&&9!==E||A.push("-");for(var S=d-16,T=new Uint8Array(S),C=0;C<S;C++)T[C]=h.readUByte();_(n._txtTrack.samples,{pts:t.pts,payloadType:f,uuid:A.join(""),userData:Object(o.utf8ArrayToStr)(T),userDataBytes:T})}}else if(d<h.bytesAvailable)for(var O=0;O<d;O++)h.readUByte()}break;case 7:if(r=!0,l=!0,!i.sps){var P=new a.default(e.data).readSPS();i.width=P.width,i.height=P.height,i.pixelRatio=P.pixelRatio,i.sps=[e.data],i.duration=n._duration;for(var L=e.data.subarray(1,4),I="avc1.",k=0;k<3;k++){var R=L[k].toString(16);R.length<2&&(R="0"+R),I+=R}i.codec=I}break;case 8:r=!0,i.pps||(i.pps=[e.data]);break;case 9:r=!1,i.audFound=!0,u&&y(u,i),u=n.avcSample=p(!1,t.pts,t.dts,"");break;case 12:r=!1;break;default:r=!1,u&&(u.debug+="unknown NAL "+e.type+" ")}u&&r&&u.units.push(e)})),e&&u&&(y(u,i),this.avcSample=null)},e.getLastNalUnit=function(){var t,e,r=this.avcSample;if(!r||0===r.units.length){var n=this._avcTrack.samples;r=n[n.length-1]}if(null!==(t=r)&&void 0!==t&&t.units){var i=r.units;e=i[i.length-1]}return e},e.parseAVCNALu=function(t){var e,r,n=t.byteLength,i=this._avcTrack,a=i.naluState||0,o=a,s=[],u=0,l=-1,c=0;for(-1===a&&(l=0,c=31&t[0],a=0,u=1);u<n;)if(e=t[u++],a)if(1!==a)if(e)if(1===e){if(l>=0){var h={data:t.subarray(l,u-a-1),type:c};s.push(h)}else{var f=this.getLastNalUnit();if(f&&(o&&u<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),(r=u-a-1)>0)){var d=new Uint8Array(f.data.byteLength+r);d.set(f.data,0),d.set(t.subarray(0,r),f.data.byteLength),f.data=d,f.state=0}}u<n?(l=u,c=31&t[u],a=0):a=-1}else a=0;else a=3;else a=e?0:2;else a=e?0:1;if(l>=0&&a>=0){var p={data:t.subarray(l,n),type:c,state:a};s.push(p)}if(0===s.length){var m=this.getLastNalUnit();if(m){var v=new Uint8Array(m.data.byteLength+t.byteLength);v.set(m.data,0),v.set(t,m.data.byteLength),m.data=v}}return i.naluState=a,s},e.parseAACPES=function(t){var e,r,i,a,o,s=0,l=this._audioTrack,f=this.aacOverFlow,d=t.data;if(f){this.aacOverFlow=null;var p=f.sample.unit.byteLength,m=Math.min(f.missing,p),v=p-m;f.sample.unit.set(d.subarray(0,m),v),l.samples.push(f.sample),s=f.missing}for(e=s,r=d.length;e<r-1&&!n.isHeader(d,e);e++);if(e===s||(e<r-1?(i="AAC PES did not start with ADTS header,offset:"+e,a=!1):(i="no ADTS header found in AAC PES",a=!0),c.logger.warn("parsing error:"+i),this.observer.emit(u.Events.ERROR,u.Events.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:i}),!a)){if(n.initTrackConfig(l,this.observer,d,e,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!f)return void c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var g=n.getFrameDuration(l.samplerate);o=f.sample.pts+g}for(var y=0;e<r;){if(n.isHeader(d,e)){if(e+5<r){var _=n.appendFrame(l,d,e,o,y);if(_){if(!_.missing){e+=_.length,y++;continue}this.aacOverFlow=_}}break}e++}}},e.parseMPEGPES=function(t){var e=t.data,r=e.length,n=0,a=0,o=t.pts;if(void 0!==o)for(;a<r;)if(i.isHeader(e,a)){var s=i.appendFrame(this._audioTrack,e,a,o,n);if(!s)break;a+=s.length,n++}else a++;else c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(t){void 0!==t.pts?this._id3Track.samples.push(t):c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function p(t,e,r,n){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:n,length:0}}function m(t,e){return(31&t[e+10])<<8|t[e+11]}function v(t,e,r,n){var i={audio:-1,avc:-1,id3:-1,isAAC:!0},a=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<a;){var o=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!n){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=o);break;case 21:-1===i.id3&&(i.id3=o);break;case 219:if(!n){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=o);break;case 3:case 4:r?-1===i.audio&&(i.audio=o,i.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return i}function g(t){var e,r,n,i,a,o=0,s=t.data;if(!t||0===t.size)return null;for(;s[0].length<19&&s.length>1;){var u=new Uint8Array(s[0].length+s[1].length);u.set(s[0]),u.set(s[1],s[0].length),s[0]=u,s.splice(1,1)}if(1===((e=s[0])[0]<<16)+(e[1]<<8)+e[2]){if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;var l=e[7];192&l&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&l?i-(a=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(c.logger.warn(Math.round((i-a)/9e4)+"s delta between PTS and DTS, align them"),i=a):a=i);var h=(n=e[8])+9;if(t.size<=h)return null;t.size-=h;for(var f=new Uint8Array(t.size),d=0,p=s.length;d<p;d++){var m=(e=s[d]).byteLength;if(h){if(h>m){h-=m;continue}e=e.subarray(h),m-=h,h=0}f.set(e,o),o+=m}return r&&(r-=n+3),{data:f,pts:i,dts:a,len:r}}return null}function y(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,n=r.length;if(!n)return void e.dropped++;var i=r[n-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&c.logger.log(t.pts+"/"+t.dts+":"+t.debug)}function _(t,e){var r=t.length;if(r>0){if(e.pts>=t[r-1].pts)t.push(e);else for(var n=r-1;n>=0;n--)if(e.pts<t[n].pts){t.splice(n,0,e);break}}else t.push(e)}function b(t){for(var e=t.byteLength,r=[],n=1;n<e-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return t;var i=e-r.length,a=new Uint8Array(i),o=0;for(n=0;n<i;o++,n++)o===r[0]&&(o++,r.shift()),a[n]=t[o];return a}d.minProbeByteLength=188,e.default=d},"./src/errors.ts":
/*!***********************!*\
	  !*** ./src/errors.ts ***!
	  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(t,e,r){var n,i;r.r(e),r.d(e,"ErrorTypes",(function(){return n})),r.d(e,"ErrorDetails",(function(){return i})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(n||(n={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown"}(i||(i={}))},"./src/events.ts":
/*!***********************!*\
	  !*** ./src/events.ts ***!
	  \***********************/
/*! exports provided: Events */function(t,e,r){var n;r.r(e),r.d(e,"Events",(function(){return n})),function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"}(n||(n={}))},"./src/hls.ts":
/*!********************!*\
	  !*** ./src/hls.ts ***!
	  \********************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return y}));var n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),i=r(/*! ./loader/playlist-loader */"./src/loader/playlist-loader.ts"),a=r(/*! ./loader/key-loader */"./src/loader/key-loader.ts"),o=r(/*! ./controller/id3-track-controller */"./src/controller/id3-track-controller.ts"),s=r(/*! ./controller/latency-controller */"./src/controller/latency-controller.ts"),u=r(/*! ./controller/level-controller */"./src/controller/level-controller.ts"),l=r(/*! ./controller/fragment-tracker */"./src/controller/fragment-tracker.ts"),c=r(/*! ./controller/stream-controller */"./src/controller/stream-controller.ts"),h=r(/*! ./is-supported */"./src/is-supported.ts"),f=r(/*! ./utils/logger */"./src/utils/logger.ts"),d=r(/*! ./config */"./src/config.ts"),p=r(/*! eventemitter3 */"./node_modules/eventemitter3/index.js"),m=r(/*! ./events */"./src/events.ts"),v=r(/*! ./errors */"./src/errors.ts");function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(d.mergeConfig)(t.DefaultConfig,e);this.userConfig=e,Object(f.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(d.enableStreamingMode)(r);var n=r.bufferController,h=r.capLevelController,m=r.fpsController,v=this.abrController=new(0,r.abrController)(this),g=this.bufferController=new n(this),y=this.capLevelController=new h(this),_=new m(this),b=new i.default(this),x=new a.default(this),w=new o.default(this),M=this.levelController=new u.default(this),A=new l.FragmentTracker(this),E=this.streamController=new c.default(this,A);y.setStreamController(E),_.setStreamController(E);var S=[M,E];this.networkControllers=S;var T=[b,x,v,g,y,_,w,A];this.audioTrackController=this.createController(r.audioTrackController,null,S),this.createController(r.audioStreamController,A,S),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,S),this.createController(r.subtitleStreamController,A,S),this.createController(r.timelineController,null,T),this.emeController=this.createController(r.emeController,null,T),this.cmcdController=this.createController(r.cmcdController,null,T),this.latencyController=this.createController(s.default,null,T),this.coreComponents=T}t.isSupported=function(){return Object(h.isSupported)()};var e,r,y,_=t.prototype;return _.createController=function(t,e,r){if(t){var n=e?new t(this,e):new t(this);return r&&r.push(n),n}return null},_.on=function(t,e,r){void 0===r&&(r=this),this._emitter.on(t,e,r)},_.once=function(t,e,r){void 0===r&&(r=this),this._emitter.once(t,e,r)},_.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},_.off=function(t,e,r,n){void 0===r&&(r=this),this._emitter.off(t,e,r,n)},_.listeners=function(t){return this._emitter.listeners(t)},_.emit=function(t,e,r){return this._emitter.emit(t,e,r)},_.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){f.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(m.Events.ERROR,{type:v.ErrorTypes.OTHER_ERROR,details:v.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},_.listenerCount=function(t){return this._emitter.listenerCount(t)},_.destroy=function(){f.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},_.attachMedia=function(t){f.logger.log("attachMedia"),this._media=t,this.trigger(m.Events.MEDIA_ATTACHING,{media:t})},_.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},_.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,i=this.url=n.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});f.logger.log("loadSource:"+i),e&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(m.Events.MANIFEST_LOADING,{url:t})},_.startLoad=function(t){void 0===t&&(t=-1),f.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},_.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},_.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},_.recoverMediaError=function(){f.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},_.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},e=t,r=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){f.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){f.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){f.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){f.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){f.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(f.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,n=0;n<r;n++)if(t[n].maxBitrate>e)return n;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],y=[{key:"version",get:function(){return"1.1.5"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return v.ErrorTypes}},{key:"ErrorDetails",get:function(){return v.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:d.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}],r&&g(e.prototype,r),y&&g(e,y),t}();y.defaultConfig=void 0},"./src/is-supported.ts":
/*!*****************************!*\
	  !*** ./src/is-supported.ts ***!
	  \*****************************/
/*! exports provided: isSupported, changeTypeSupported */function(t,e,r){r.r(e),r.d(e,"isSupported",(function(){return a})),r.d(e,"changeTypeSupported",(function(){return o}));var n=r(/*! ./utils/mediasource-helper */"./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function a(){var t=Object(n.getMediaSource)();if(!t)return!1;var e=i();return!(!t||"function"!=typeof t.isTypeSupported||!t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||e&&(!e.prototype||"function"!=typeof e.prototype.appendBuffer||"function"!=typeof e.prototype.remove))}function o(){var t,e=i();return"function"==typeof(null==e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":
/*!***************************************!*\
	  !*** ./src/loader/fragment-loader.ts ***!
	  \***************************************/
/*! exports provided: default, LoadError */function(t,e,r){r.r(e),r.d(e,"default",(function(){return h})),r.d(e,"LoadError",(function(){return d}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../errors */"./src/errors.ts");function a(t){var e="function"==typeof Map?new Map:void 0;return a=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return o(t,arguments,l(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)},a(t)}function o(t,e,r){return o=s()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&u(i,r.prototype),i},o.apply(null,arguments)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var c=Math.pow(2,17),h=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var r=this,n=t.url;if(!n)return Promise.reject(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var a=this.config,o=a.fLoader,s=a.loader;return new Promise((function(n,u){r.loader&&r.loader.destroy();var l=r.loader=t.loader=o?new o(a):new s(a),h=f(t),p={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:c};t.stats=l.stats,l.load(h,p,{onSuccess:function(e,i,a,o){r.resetLoader(t,l),n({frag:t,part:null,payload:e.data,networkDetails:o})},onError:function(e,n,a){r.resetLoader(t,l),u(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:e,networkDetails:a}))},onAbort:function(e,n,a){r.resetLoader(t,l),u(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:a}))},onTimeout:function(e,n,a){r.resetLoader(t,l),u(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:a}))},onProgress:function(r,n,i,a){e&&e({frag:t,part:null,payload:i,networkDetails:a})}})}))},e.loadPart=function(t,e,r){var n=this;this.abort();var a=this.config,o=a.fLoader,s=a.loader;return new Promise((function(u,l){n.loader&&n.loader.destroy();var h=n.loader=t.loader=o?new o(a):new s(a),p=f(t,e),m={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout,highWaterMark:c};e.stats=h.stats,h.load(p,m,{onSuccess:function(i,a,o,s){n.resetLoader(t,h),n.updateStatsFromPart(t,e);var l={frag:t,part:e,payload:i.data,networkDetails:s};r(l),u(l)},onError:function(r,a,o){n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:r,networkDetails:o}))},onAbort:function(r,a,o){t.stats.aborted=e.stats.aborted,n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:o}))},onTimeout:function(r,a,o){n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:o}))}})}))},e.updateStatsFromPart=function(t,e){var r=t.stats,n=e.stats,i=n.total;if(r.loaded+=n.loaded,i){var a=Math.round(t.duration/e.duration),o=Math.min(Math.round(r.loaded/i),a),s=(a-o)*Math.round(r.loaded/o);r.total=r.loaded+s}else r.total=Math.max(r.loaded,r.total);var u=r.loading,l=n.loading;u.start?u.first+=l.first-l.start:(u.start=l.start,u.first=l.first),u.end=l.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function f(t,e){void 0===e&&(e=null);var r=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},a=r.byteRangeStartOffset,o=r.byteRangeEndOffset;return Object(n.isFiniteNumber)(a)&&Object(n.isFiniteNumber)(o)&&(i.rangeStart=a,i.rangeEnd=o),i}var d=function(t){var e,r;function n(e){for(var r,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return(r=t.call.apply(t,[this].concat(i))||this).data=void 0,r.data=e,r}return r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r),n}(a(Error))},"./src/loader/fragment.ts":
/*!********************************!*\
	  !*** ./src/loader/fragment.ts ***!
	  \********************************/
/*! exports provided: ElementaryStreamTypes, BaseSegment, Fragment, Part */function(t,e,r){r.r(e),r.d(e,"ElementaryStreamTypes",(function(){return n})),r.d(e,"BaseSegment",(function(){return d})),r.d(e,"Fragment",(function(){return p})),r.d(e,"Part",(function(){return m}));var n,i=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),a=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ./level-key */"./src/loader/level-key.ts"),u=r(/*! ./load-stats */"./src/loader/load-stats.ts");function l(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,r){return e&&h(t.prototype,e),r&&h(t,r),t}!function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"}(n||(n={}));var d=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[n.AUDIO]=null,e[n.VIDEO]=null,e[n.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var r=t.split("@",2),n=[];n[0]=1===r.length?e?e.byteRangeEndOffset:0:parseInt(r[1]),n[1]=parseInt(r[0])+n[0],this._byteRange=n},f(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(a.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),p=function(t){function e(e,r){var n;return(n=t.call(this,r)||this)._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkey=void 0,n.type=void 0,n.loader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.appendedPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new u.LoadStats,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.type=e,n}l(e,t);var r=e.prototype;return r.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},r.setDecryptDataFromLevelKey=function(t,e){var r=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((r=s.LevelKey.fromURI(t.uri)).method=t.method,r.iv=this.createInitializationVector(e),r.keyFormat="identity"),r},r.setElementaryStreamInfo=function(t,e,r,n,i,a){void 0===a&&(a=!1);var o=this.elementaryStreams,s=o[t];s?(s.startPTS=Math.min(s.startPTS,e),s.endPTS=Math.max(s.endPTS,r),s.startDTS=Math.min(s.startDTS,n),s.endDTS=Math.max(s.endDTS,i)):o[t]={startPTS:e,endPTS:r,startDTS:n,endDTS:i,partial:a}},r.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[n.AUDIO]=null,t[n.VIDEO]=null,t[n.AUDIOVIDEO]=null},f(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&o.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(i.isFiniteNumber)(this.programDateTime))return null;var t=Object(i.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),e}(d),m=function(t){function e(e,r,n,i,a){var o;(o=t.call(this,n)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new u.LoadStats,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=r,o.index=i;var s=e.enumeratedString("BYTERANGE");return s&&o.setByteRange(s,a),a&&(o.fragOffset=a.fragOffset+a.duration),o}return l(e,t),f(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(d)},"./src/loader/key-loader.ts":
/*!**********************************!*\
	  !*** ./src/loader/key-loader.ts ***!
	  \**********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return o}));var n=r(/*! ../events */"./src/events.ts"),i=r(/*! ../errors */"./src/errors.ts"),a=r(/*! ../utils/logger */"./src/utils/logger.ts"),o=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){this.hls.on(n.Events.KEY_LOADING,this.onKeyLoading,this)},e._unregisterListeners=function(){this.hls.off(n.Events.KEY_LOADING,this.onKeyLoading)},e.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},e.onKeyLoading=function(t,e){var r=e.frag,i=r.type,o=this.loaders[i];if(r.decryptdata){var s=r.decryptdata.uri;if(s!==this.decrypturl||null===this.decryptkey){var u=this.hls.config;if(o&&(a.logger.warn("abort previous key loader for type:"+i),o.abort()),!s)return void a.logger.warn("key uri is falsy");var l=r.loader=this.loaders[i]=new(0,u.loader)(u);this.decrypturl=s,this.decryptkey=null;var c={url:s,frag:r,responseType:"arraybuffer"},h={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:u.fragLoadingRetryDelay,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(c,h,f)}else this.decryptkey&&(r.decryptdata.key=this.decryptkey,this.hls.trigger(n.Events.KEY_LOADED,{frag:r}))}else a.logger.warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=function(t,e,r){var i=r.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=null,delete this.loaders[i.type],this.hls.trigger(n.Events.KEY_LOADED,{frag:i})):a.logger.error("after key load, decryptdata unset")},e.loaderror=function(t,e){var r=e.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},e.loadtimeout=function(t,e){var r=e.frag,a=r.loader;a&&a.abort(),delete this.loaders[r.type],this.hls.trigger(n.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},t}()},"./src/loader/level-details.ts":
/*!*************************************!*\
	  !*** ./src/loader/level-details.ts ***!
	  \*************************************/
/*! exports provided: LevelDetails */function(t,e,r){r.r(e),r.d(e,"LevelDetails",(function(){return i}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts");var i=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}var e;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||e>0||0===e&&r>0,this.misses=this.updated||this.advanced?Math.floor(.6*t.misses):t.misses+1,this.availabilityDelay=t.availabilityDelay},(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(n.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}()},"./src/loader/level-key.ts":
/*!*********************************!*\
	  !*** ./src/loader/level-key.ts ***!
	  \*********************************/
/*! exports provided: LevelKey */function(t,e,r){r.r(e),r.d(e,"LevelKey",(function(){return i}));var n=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js");var i=function(){function t(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(n.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}var e;return t.fromURL=function(e,r){return new t(e,r)},t.fromURI=function(e){return new t(e)},(e=[{key:"uri",get:function(){return this._uri}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}()},"./src/loader/load-stats.ts":
/*!**********************************!*\
	  !*** ./src/loader/load-stats.ts ***!
	  \**********************************/
/*! exports provided: LoadStats */function(t,e,r){r.r(e),r.d(e,"LoadStats",(function(){return n}));var n=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":
/*!***********************************!*\
	  !*** ./src/loader/m3u8-parser.ts ***!
	  \***********************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return v}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! url-toolkit */"./node_modules/url-toolkit/src/url-toolkit.js"),a=r(/*! ./fragment */"./src/loader/fragment.ts"),o=r(/*! ./level-details */"./src/loader/level-details.ts"),s=r(/*! ./level-key */"./src/loader/level-key.ts"),u=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts"),l=r(/*! ../utils/logger */"./src/utils/logger.ts"),c=r(/*! ../utils/codecs */"./src/utils/codecs.ts"),h=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,f=/#EXT-X-MEDIA:(.*)/g,d=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=/\.(mp4|m4s|m4v|m4a)$/i,v=function(){function t(){}return t.findGroup=function(t,e){for(var r=0;r<t.length;r++){var n=t[r];if(n.id===e)return n}},t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(e.length>2){var r=e.shift()+".";return(r+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).substr(-4)}return t},t.resolve=function(t,e){return i.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,r){var n,i=[],a={},o=!1;for(h.lastIndex=0;null!=(n=h.exec(e));)if(n[1]){var s=new u.AttrList(n[1]),l={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:t.resolve(n[2],r)},c=s.decimalResolution("RESOLUTION");c&&(l.width=c.width,l.height=c.height),g((s.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=t.convertAVC1ToAVCOTI(l.videoCodec)),i.push(l)}else if(n[3]){var f=new u.AttrList(n[3]);f["DATA-ID"]&&(o=!0,a[f["DATA-ID"]]=f)}return{levels:i,sessionData:o?a:null}},t.parseMasterPlaylistMedia=function(e,r,n,i){var a;void 0===i&&(i=[]);var o=[],s=0;for(f.lastIndex=0;null!==(a=f.exec(e));){var l=new u.AttrList(a[1]);if(l.TYPE===n){var c={attrs:l,bitrate:0,id:s++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:n,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?t.resolve(l.URI,r):""};if(i.length){var h=t.findGroup(i,c.groupId)||i[0];y(c,h,"audioCodec"),y(c,h,"textCodec")}o.push(c)}}return o},t.parseLevelPlaylist=function(t,e,r,c,h){var f,v,g,y=new o.LevelDetails(e),b=y.fragments,x=null,w=0,M=0,A=0,E=0,S=null,T=new a.Fragment(c,e),C=-1,O=!1;for(d.lastIndex=0,y.m3u8=t;null!==(f=d.exec(t));){O&&(O=!1,(T=new a.Fragment(c,e)).start=A,T.sn=w,T.cc=E,T.level=r,x&&(T.initSegment=x,T.rawProgramDateTime=x.rawProgramDateTime));var P=f[1];if(P){T.duration=parseFloat(P);var L=(" "+f[2]).slice(1);T.title=L||null,T.tagList.push(L?["INF",P,L]:["INF",P])}else if(f[3])Object(n.isFiniteNumber)(T.duration)&&(T.start=A,g&&(T.levelkey=g),T.sn=w,T.level=r,T.cc=E,T.urlId=h,b.push(T),T.relurl=(" "+f[3]).slice(1),_(T,S),S=T,A+=T.duration,w++,M=0,O=!0);else if(f[4]){var I=(" "+f[4]).slice(1);S?T.setByteRange(I,S):T.setByteRange(I)}else if(f[5])T.rawProgramDateTime=(" "+f[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),-1===C&&(C=b.length);else{if(!(f=f[0].match(p))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(v=1;v<f.length&&void 0===f[v];v++);var k=(" "+f[v]).slice(1),R=(" "+f[v+1]).slice(1),D=f[v+2]?(" "+f[v+2]).slice(1):"";switch(k){case"PLAYLIST-TYPE":y.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":w=y.startSN=parseInt(R);break;case"SKIP":var B=new u.AttrList(R),F=B.decimalInteger("SKIPPED-SEGMENTS");if(Object(n.isFiniteNumber)(F)){y.skippedSegments=F;for(var j=F;j--;)b.unshift(null);w+=F}var N=B.enumeratedString("RECENTLY-REMOVED-DATERANGES");N&&(y.recentlyRemovedDateranges=N.split("\t"));break;case"TARGETDURATION":y.targetduration=parseFloat(R);break;case"VERSION":y.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":y.live=!1;break;case"#":(R||D)&&T.tagList.push(D?[R,D]:[R]);break;case"DIS":E++;case"GAP":T.tagList.push([k]);break;case"BITRATE":T.tagList.push([k,R]);break;case"DISCONTINUITY-SEQ":E=parseInt(R);break;case"KEY":var U,z=new u.AttrList(R),G=z.enumeratedString("METHOD"),V=z.URI,H=z.hexadecimalInteger("IV"),W=z.enumeratedString("KEYFORMATVERSIONS"),$=z.enumeratedString("KEYID"),q=null!=(U=z.enumeratedString("KEYFORMAT"))?U:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(q)>-1){l.logger.warn("Keyformat "+q+" is not supported from the manifest");continue}if("identity"!==q)continue;G&&(g=s.LevelKey.fromURL(e,V),V&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(G)>=0&&(g.method=G,g.keyFormat=q,$&&(g.keyID=$),W&&(g.keyFormatVersions=W),g.iv=H));break;case"START":var X=new u.AttrList(R).decimalFloatingPoint("TIME-OFFSET");Object(n.isFiniteNumber)(X)&&(y.startTimeOffset=X);break;case"MAP":var K=new u.AttrList(R);T.relurl=K.URI,K.BYTERANGE&&T.setByteRange(K.BYTERANGE),T.level=r,T.sn="initSegment",g&&(T.levelkey=g),T.initSegment=null,x=T,O=!0;break;case"SERVER-CONTROL":var Z=new u.AttrList(R);y.canBlockReload=Z.bool("CAN-BLOCK-RELOAD"),y.canSkipUntil=Z.optionalFloat("CAN-SKIP-UNTIL",0),y.canSkipDateRanges=y.canSkipUntil>0&&Z.bool("CAN-SKIP-DATERANGES"),y.partHoldBack=Z.optionalFloat("PART-HOLD-BACK",0),y.holdBack=Z.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Y=new u.AttrList(R);y.partTarget=Y.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=y.partList;J||(J=y.partList=[]);var Q=M>0?J[J.length-1]:void 0,tt=M++,et=new a.Part(new u.AttrList(R),T,e,tt,Q);J.push(et),T.duration+=et.duration;break;case"PRELOAD-HINT":var rt=new u.AttrList(R);y.preloadHint=rt;break;case"RENDITION-REPORT":var nt=new u.AttrList(R);y.renditionReports=y.renditionReports||[],y.renditionReports.push(nt);break;default:l.logger.warn("line parsed but not handled: "+f)}}}S&&!S.relurl?(b.pop(),A-=S.duration,y.partList&&(y.fragmentHint=S)):y.partList&&(_(T,S),T.cc=E,y.fragmentHint=T);var it=b.length,at=b[0],ot=b[it-1];if((A+=y.skippedSegments*y.targetduration)>0&&it&&ot){y.averagetargetduration=A/it;var st=ot.sn;y.endSN="initSegment"!==st?st:0,at&&(y.startCC=at.cc,at.initSegment||y.fragments.every((function(t){return t.relurl&&m.test(null!=(e=null===(r=i.parseURL(t.relurl))||void 0===r?void 0:r.path)?e:"");var e,r}))&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(T=new a.Fragment(c,e)).relurl=ot.relurl,T.level=r,T.sn="initSegment",at.initSegment=T,y.needSidxRanges=!0))}else y.endSN=0,y.startCC=0;return y.fragmentHint&&(A+=y.fragmentHint.duration),y.totalduration=A,y.endCC=E,C>0&&function(t,e){for(var r=t[e],n=e;n--;){var i=t[n];if(!i)return;i.programDateTime=r.programDateTime-1e3*i.duration,r=i}}(b,C),y},t}();function g(t,e){["video","audio","text"].forEach((function(r){var n=t.filter((function(t){return Object(c.isCodecType)(t,r)}));if(n.length){var i=n.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[r+"Codec"]=i.length>0?i[0]:n[0],t=t.filter((function(t){return-1===n.indexOf(t)}))}})),e.unknownCodecs=t}function y(t,e,r){var n=e[r];n&&(t[r]=n)}function _(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(n.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":
/*!***************************************!*\
	  !*** ./src/loader/playlist-loader.ts ***!
	  \***************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../events */"./src/events.ts"),a=r(/*! ../errors */"./src/errors.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),u=r(/*! ./m3u8-parser */"./src/loader/m3u8-parser.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../utils/attr-list */"./src/utils/attr-list.ts");function h(t,e){var r=t.url;return void 0!==r&&0!==r.indexOf("data:")||(r=e.url),r}var f=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,r=new(e.pLoader||e.loader)(e);return t.loader=r,this.loaders[t.type]=r,r},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){this.load({id:null,groupId:null,level:0,responseType:"text",type:l.PlaylistContextType.MANIFEST,url:e.url,deliveryDirectives:null})},e.onLevelLoading=function(t,e){this.load({id:e.id,groupId:null,level:e.level,responseType:"text",type:l.PlaylistContextType.LEVEL,url:e.url,deliveryDirectives:e.deliveryDirectives})},e.onAudioTrackLoading=function(t,e){this.load({id:e.id,groupId:e.groupId,level:null,responseType:"text",type:l.PlaylistContextType.AUDIO_TRACK,url:e.url,deliveryDirectives:e.deliveryDirectives})},e.onSubtitleTrackLoading=function(t,e){this.load({id:e.id,groupId:e.groupId,level:null,responseType:"text",type:l.PlaylistContextType.SUBTITLE_TRACK,url:e.url,deliveryDirectives:e.deliveryDirectives})},e.load=function(t){var e,r,n,i,a,s,u=this.hls.config,c=this.getInternalLoader(t);if(c){var h=c.context;if(h&&h.url===t.url)return void o.logger.trace("[playlist-loader]: playlist request ongoing");o.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),c.abort()}switch(t.type){case l.PlaylistContextType.MANIFEST:r=u.manifestLoadingMaxRetry,n=u.manifestLoadingTimeOut,i=u.manifestLoadingRetryDelay,a=u.manifestLoadingMaxRetryTimeout;break;case l.PlaylistContextType.LEVEL:case l.PlaylistContextType.AUDIO_TRACK:case l.PlaylistContextType.SUBTITLE_TRACK:r=0,n=u.levelLoadingTimeOut;break;default:r=u.levelLoadingMaxRetry,n=u.levelLoadingTimeOut,i=u.levelLoadingRetryDelay,a=u.levelLoadingMaxRetryTimeout}if(c=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part&&(t.type===l.PlaylistContextType.LEVEL&&null!==t.level?s=this.hls.levels[t.level].details:t.type===l.PlaylistContextType.AUDIO_TRACK&&null!==t.id?s=this.hls.audioTracks[t.id].details:t.type===l.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(s=this.hls.subtitleTracks[t.id].details),s)){var f=s.partTarget,d=s.targetduration;f&&d&&(n=Math.min(1e3*Math.max(3*f,.8*d),n))}var p={timeout:n,maxRetry:r,retryDelay:i,maxRetryDelay:a,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(t,p,m)},e.loadsuccess=function(t,e,r,n){if(void 0===n&&(n=null),r.isSidxRequest)return this.handleSidxRequest(t,r),void this.handlePlaylistLoaded(t,e,r,n);this.resetInternalLoader(r.type);var i=t.data;0===i.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,r,n):this.handleMasterPlaylist(t,e,r,n)):this.handleManifestParsingError(t,r,"no EXTM3U delimiter",n)},e.loaderror=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!1,t)},e.loadtimeout=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!0)},e.handleMasterPlaylist=function(t,e,r,n){var a=this.hls,s=t.data,l=h(t,r),f=u.default.parseMasterPlaylist(s,l),d=f.levels,p=f.sessionData;if(d.length){var m=d.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),v=d.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),g=u.default.parseMasterPlaylistMedia(s,l,"AUDIO",m),y=u.default.parseMasterPlaylistMedia(s,l,"SUBTITLES",v),_=u.default.parseMasterPlaylistMedia(s,l,"CLOSED-CAPTIONS");g.length&&(g.some((function(t){return!t.url}))||!d[0].audioCodec||d[0].attrs.AUDIO||(o.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}))),a.trigger(i.Events.MANIFEST_LOADED,{levels:d,audioTracks:g,subtitles:y,captions:_,url:l,stats:e,networkDetails:n,sessionData:p})}else this.handleManifestParsingError(t,r,"no level found in manifest",n)},e.handleTrackOrLevelPlaylist=function(t,e,r,o){var s=this.hls,f=r.id,d=r.level,p=r.type,m=h(t,r),v=Object(n.isFiniteNumber)(f)?f:0,g=Object(n.isFiniteNumber)(d)?d:v,y=function(t){switch(t.type){case l.PlaylistContextType.AUDIO_TRACK:return l.PlaylistLevelType.AUDIO;case l.PlaylistContextType.SUBTITLE_TRACK:return l.PlaylistLevelType.SUBTITLE;default:return l.PlaylistLevelType.MAIN}}(r),_=u.default.parseLevelPlaylist(t.data,m,g,y,v);if(_.fragments.length){if(p===l.PlaylistContextType.MANIFEST){var b={attrs:new c.AttrList({}),bitrate:0,details:_,name:"",url:m};s.trigger(i.Events.MANIFEST_LOADED,{levels:[b],audioTracks:[],url:m,stats:e,networkDetails:o,sessionData:null})}if(e.parsing.end=performance.now(),_.needSidxRanges){var x,w=null===(x=_.fragments[0].initSegment)||void 0===x?void 0:x.url;this.load({url:w,isSidxRequest:!0,type:p,level:d,levelDetails:_,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else r.levelDetails=_,this.handlePlaylistLoaded(t,e,r,o)}else s.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},e.handleSidxRequest=function(t,e){var r=Object(s.parseSegmentIndex)(new Uint8Array(t.data));if(r){var n=e.levelDetails;r.references.forEach((function(t,e){var i=t.info,a=n.fragments[e];0===a.byteRange.length&&a.setByteRange(String(1+i.end-i.start)+"@"+String(i.start)),a.initSegment&&a.initSegment.setByteRange(String(r.moovEndOffset)+"@0")}))}},e.handleManifestParsingError=function(t,e,r,n){this.hls.trigger(i.Events.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===l.PlaylistContextType.MANIFEST,url:t.url,reason:r,response:t,context:e,networkDetails:n})},e.handleNetworkError=function(t,e,r,n){void 0===r&&(r=!1),o.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var s=a.ErrorDetails.UNKNOWN,u=!1,c=this.getInternalLoader(t);switch(t.type){case l.PlaylistContextType.MANIFEST:s=r?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case l.PlaylistContextType.LEVEL:s=r?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case l.PlaylistContextType.AUDIO_TRACK:s=r?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case l.PlaylistContextType.SUBTITLE_TRACK:s=r?a.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:a.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}c&&this.resetInternalLoader(t.type);var h={type:a.ErrorTypes.NETWORK_ERROR,details:s,fatal:u,url:t.url,loader:c,context:t,networkDetails:e};n&&(h.response=n),this.hls.trigger(i.Events.ERROR,h)},e.handlePlaylistLoaded=function(t,e,r,n){var a=r.type,o=r.level,s=r.id,u=r.groupId,c=r.loader,h=r.levelDetails,f=r.deliveryDirectives;if(null!=h&&h.targetduration){if(c)switch(h.live&&(c.getCacheAge&&(h.ageHeader=c.getCacheAge()||0),c.getCacheAge&&!isNaN(h.ageHeader)||(h.ageHeader=0)),a){case l.PlaylistContextType.MANIFEST:case l.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:h,level:o||0,id:s||0,stats:e,networkDetails:n,deliveryDirectives:f});break;case l.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:h,id:s||0,groupId:u||"",stats:e,networkDetails:n,deliveryDirectives:f});break;case l.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:h,id:s||0,groupId:u||"",stats:e,networkDetails:n,deliveryDirectives:f})}}else this.handleManifestParsingError(t,r,"invalid target duration",n)},t}();e.default=f},"./src/polyfills/number.ts":
/*!*********************************!*\
	  !*** ./src/polyfills/number.ts ***!
	  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(t,e,r){r.r(e),r.d(e,"isFiniteNumber",(function(){return n})),r.d(e,"MAX_SAFE_INTEGER",(function(){return i}));var n=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":
/*!*********************************!*\
	  !*** ./src/remux/aac-helper.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e),e.default=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}()},"./src/remux/mp4-generator.ts":
/*!************************************!*\
	  !*** ./src/remux/mp4-generator.ts ***!
	  \************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=Math.pow(2,32)-1,i=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:n};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=a,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,u,o,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,i))},t.box=function(t){for(var e=8,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=n.length,o=a;a--;)e+=n[a].byteLength;var s=new Uint8Array(e);for(s[0]=e>>24&255,s[1]=e>>16&255,s[2]=e>>8&255,s[3]=255&e,s.set(t,4),a=0,e=8;a<o;a++)s.set(n[a],e),e+=n[a].byteLength;return s},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return t.box(t.types.minf,"audio"===e.type?t.box(t.types.smhd,t.SMHD):t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,n){return t.box(t.types.moof,t.mfhd(e),t.traf(n,r))},t.moov=function(e){for(var r=e.length,n=[];r--;)n[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(n).concat(t.mvex(e)))},t.mvex=function(e){for(var r=e.length,n=[];r--;)n[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(n))},t.mvhd=function(e,r){r*=e;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(e){var r,n,i=e.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)a[r+4]=(n=i[r].flags).dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,a)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r,n,i,a=[],o=[];for(r=0;r<e.sps.length;r++)a.push((i=(n=e.sps[r]).byteLength)>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(n));for(r=0;r<e.pps.length;r++)o.push((i=(n=e.pps[r]).byteLength)>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(n));var s=t.box(t.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|e.sps.length].concat(a).concat([e.pps.length]).concat(o))),u=e.width,l=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return t.box(t.types.stsd,t.STSD,"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.mp4a(e):t.mp3(e):t.avc1(e))},t.tkhd=function(e){var r=e.id,i=e.duration*e.timescale,a=e.width,o=e.height,s=Math.floor(i/(n+1)),u=Math.floor(i%(n+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]))},t.traf=function(e,r){var i=t.sdtp(e),a=e.id,o=Math.floor(r/(n+1)),s=Math.floor(r%(n+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var n,i,a,o,s,u,l=e.samples||[],c=l.length,h=12+16*c,f=new Uint8Array(h);for(f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,(r+=8+h)>>>24&255,r>>>16&255,r>>>8&255,255&r],0),n=0;n<c;n++)f.set([(a=(i=l[n]).duration)>>>24&255,a>>>16&255,a>>>8&255,255&a,(o=i.size)>>>24&255,o>>>16&255,o>>>8&255,255&o,(s=i.flags).isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,(u=i.cts)>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*n);return t.box(t.types.trun,f)},t.initSegment=function(e){t.types||t.init();var r=t.moov(e),n=new Uint8Array(t.FTYP.byteLength+r.byteLength);return n.set(t.FTYP),n.set(r,t.FTYP.byteLength),n},t}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,e.default=i},"./src/remux/mp4-remuxer.ts":
/*!**********************************!*\
	  !*** ./src/remux/mp4-remuxer.ts ***!
	  \**********************************/
/*! exports provided: default, normalizePts */function(t,e,r){r.r(e),r.d(e,"default",(function(){return m})),r.d(e,"normalizePts",(function(){return v}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./aac-helper */"./src/remux/aac-helper.ts"),a=r(/*! ./mp4-generator */"./src/remux/mp4-generator.ts"),o=r(/*! ../events */"./src/events.ts"),s=r(/*! ../errors */"./src/errors.ts"),u=r(/*! ../utils/logger */"./src/utils/logger.ts"),l=r(/*! ../types/loader */"./src/types/loader.ts"),c=r(/*! ../utils/timescale-conversion */"./src/utils/timescale-conversion.ts");function h(){return h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h.apply(this,arguments)}var f=null,d=null,p=!1,m=function(){function t(t,e,r,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===f){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);f=i?parseInt(i[1]):0}if(null===d){var a=navigator.userAgent.match(/Safari\/(\d+)/i);d=a?parseInt(a[1]):0}p=!!f&&f<75||!!d&&d<600}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){u.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){u.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){u.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,r=t.reduce((function(t,r){var n=r.pts-t;return n<-4294967296?(e=!0,v(t,r.pts)):n>0?t:r.pts}),t[0].pts);return e&&u.logger.debug("PTS rollover detected"),r},e.remux=function(t,e,r,n,i,a,o,s){var c,h,f,d,p,m,g=i,y=i,_=e.pid>-1,b=e.samples.length,x=t.samples.length>0,w=b>1;if((!(t.pid>-1)||x)&&(!_||w)||this.ISGenerated||o){this.ISGenerated||(f=this.generateIS(t,e,i));var M=this.isVideoContiguous,A=-1;if(w&&(A=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,A>0){u.logger.warn("[mp4-remuxer]: Dropped "+A+" out of "+b+" video samples due to a missing keyframe");var E=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(A),e.dropped+=A,y+=(e.samples[0].pts-E)/(e.timescale||9e4)}else-1===A&&(u.logger.warn("[mp4-remuxer]: No keyframe found out of "+b+" video samples"),m=!1);if(this.ISGenerated){if(x&&w){var S=this.getVideoStartPts(e.samples),T=(v(t.samples[0].pts,S)-S)/e.inputTimeScale;g+=Math.max(0,T),y+=Math.max(0,-T)}if(x){if(t.samplerate||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(t,e,i)),h=this.remuxAudio(t,g,this.isAudioContiguous,a,_||w||s===l.PlaylistLevelType.AUDIO?y:void 0),w){var C=h?h.endPTS-h.startPTS:0;e.inputTimeScale||(u.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(t,e,i)),c=this.remuxVideo(e,y,M,C)}}else w&&(c=this.remuxVideo(e,y,M,0));c&&(c.firstKeyFrame=A,c.independent=-1!==A)}}return this.ISGenerated&&(r.samples.length&&(p=this.remuxID3(r,i)),n.samples.length&&(d=this.remuxText(n,i))),{audio:h,video:c,initSegment:f,independent:m,text:d,id3:p}},e.generateIS=function(t,e,r){var i,o,s,u=t.samples,l=e.samples,c=this.typeSupported,h={},f=!Object(n.isFiniteNumber)(this._initPTS),d="audio/mp4";if(f&&(i=o=1/0),t.config&&u.length&&(t.timescale=t.samplerate,t.isAAC||(c.mpeg?(d="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3")),h.audio={id:"audio",container:d,codec:t.codec,initSegment:!t.isAAC&&c.mpeg?new Uint8Array(0):a.default.initSegment([t]),metadata:{channelCount:t.channelCount}},f&&(s=t.inputTimeScale,i=o=u[0].pts-Math.round(s*r))),e.sps&&e.pps&&l.length&&(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:a.default.initSegment([e]),metadata:{width:e.width,height:e.height}},f)){s=e.inputTimeScale;var p=this.getVideoStartPts(l),m=Math.round(s*r);o=Math.min(o,v(l[0].dts,p)-m),i=Math.min(i,p-m)}if(Object.keys(h).length)return this.ISGenerated=!0,f&&(this._initPTS=i,this._initDTS=o),{tracks:h,initPTS:i,timescale:s}},e.remuxVideo=function(t,e,r,n){var i,l,d,m=t.inputTimeScale,y=t.samples,_=[],b=y.length,x=this._initPTS,w=this.nextAvcDts,M=8,A=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,S=0,T=!1;r&&null!==w||(w=e*m-(y[0].pts-v(y[0].dts,y[0].pts)));for(var C=0;C<b;C++){var O=y[C];O.pts=v(O.pts-x,w),O.dts=v(O.dts-x,w),O.dts>O.pts&&(S=Math.max(Math.min(S,O.pts-O.dts),-18e3)),O.dts<y[C>0?C-1:C].dts&&(T=!0)}T&&y.sort((function(t,e){return t.dts-e.dts||t.pts-e.pts})),l=y[0].dts,d=y[y.length-1].dts;var P=Math.round((d-l)/(b-1));if(S<0){if(S<-2*P){u.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-P,!0)+" ms");for(var L=S,I=0;I<b;I++)y[I].dts=L=Math.max(L,y[I].pts-P),y[I].pts=Math.max(L,y[I].pts)}else{u.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(S,!0)+" ms to overcome this issue");for(var k=0;k<b;k++)y[k].dts=y[k].dts+S}l=y[0].dts}if(r){var R=l-w,D=R>P;if(D||R<-1){u.logger.warn(D?"AVC: "+Object(c.toMsFromMpegTsClock)(R,!0)+" ms ("+R+"dts) hole between fragments detected, filling it":"AVC: "+Object(c.toMsFromMpegTsClock)(-R,!0)+" ms ("+R+"dts) overlapping between fragments detected");var B=y[0].pts-R;y[0].dts=l=w,y[0].pts=B,u.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(B,!0)+"/"+Object(c.toMsFromMpegTsClock)(l,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(R,!0)+" ms")}}p&&(l=Math.max(0,l));for(var F=0,j=0,N=0;N<b;N++){for(var U=y[N],z=U.units,G=z.length,V=0,H=0;H<G;H++)V+=z[H].data.length;j+=V,F+=G,U.length=V,U.dts=Math.max(U.dts,l),U.pts=Math.max(U.pts,U.dts,0),A=Math.min(U.pts,A),E=Math.max(U.pts,E)}d=y[b-1].dts;var W,$=j+4*F+8;try{W=new Uint8Array($)}catch(t){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:$,reason:"fail allocating video mdat "+$})}var q=new DataView(W.buffer);q.setUint32(0,$),W.set(a.default.types.mdat,4);for(var X=0;X<b;X++){for(var K=y[X],Z=K.units,Y=0,J=0,Q=Z.length;J<Q;J++){var tt=Z[J],et=tt.data,rt=tt.data.byteLength;q.setUint32(M,rt),W.set(et,M+=4),M+=rt,Y+=4+rt}if(X<b-1)i=y[X+1].dts-K.dts;else{var nt=this.config,it=K.dts-y[X>0?X-1:X].dts;if(nt.stretchShortVideoTrack&&null!==this.nextAudioPts){var at=Math.floor(nt.maxBufferHole*m),ot=(n?A+n*m:this.nextAudioPts)-K.pts;ot>at?((i=ot-it)<0&&(i=it),u.logger.log("[mp4-remuxer]: It is approximately "+ot/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=it}else i=it}var st=Math.round(K.pts-K.dts);_.push(new g(K.key,i,Y,st))}if(_.length&&f&&f<70){var ut=_[0].flags;ut.dependsOn=2,ut.isNonSync=0}console.assert(void 0!==i,"mp4SampleDuration must be computed"),this.nextAvcDts=w=d+i,this.isVideoContiguous=!0;var lt={data1:a.default.moof(t.sequenceNumber++,l,h({},t,{samples:_})),data2:W,startPTS:A/m,endPTS:(E+i)/m,startDTS:l/m,endDTS:w/m,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(W.length,"MDAT length must not be zero"),lt},e.remuxAudio=function(t,e,r,n,l){var c=t.inputTimeScale,f=c/(t.samplerate?t.samplerate:c),d=t.isAAC?1024:1152,p=d*f,m=this._initPTS,y=!t.isAAC&&this.typeSupported.mpeg,_=[],b=t.samples,x=y?0:8,w=this.nextAudioPts||-1,M=e*c;if(this.isAudioContiguous=r=r||b.length&&w>0&&(n&&Math.abs(M-w)<9e3||Math.abs(v(b[0].pts-m,M)-w)<20*p),b.forEach((function(t){t.pts=v(t.pts-m,M)})),!r||w<0){if(b=b.filter((function(t){return t.pts>=0})),!b.length)return;w=0===l?0:n?Math.max(0,M):b[0].pts}if(t.isAAC)for(var A=void 0!==l,E=this.config.maxAudioFramesDrift,S=0,T=w;S<b.length;S++){var C=b[S],O=C.pts,P=O-T,L=Math.abs(1e3*P/c);if(P<=-E*p&&A)0===S&&(u.logger.warn("Audio frame @ "+(O/c).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*P/c)+" ms."),this.nextAudioPts=w=T=O);else if(P>=E*p&&L<1e4&&A){var I=Math.round(P/p);(T=O-I*p)<0&&(I--,T+=p),0===S&&(this.nextAudioPts=w=T),u.logger.warn("[mp4-remuxer]: Injecting "+I+" audio frame @ "+(T/c).toFixed(3)+"s due to "+Math.round(1e3*P/c)+" ms gap.");for(var k=0;k<I;k++){var R=Math.max(T,0),D=i.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);D||(u.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),D=C.unit.subarray()),b.splice(S,0,{unit:D,pts:R}),T+=p,S++}}C.pts=T,T+=p}for(var B,F=null,j=null,N=0,U=b.length;U--;)N+=b[U].unit.byteLength;for(var z=0,G=b.length;z<G;z++){var V=b[z],H=V.unit,W=V.pts;if(null!==j)_[z-1].duration=Math.round((W-j)/f);else{if(r&&t.isAAC&&(W=w),F=W,!(N>0))return;N+=x;try{B=new Uint8Array(N)}catch(t){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:s.ErrorTypes.MUX_ERROR,details:s.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N})}y||(new DataView(B.buffer).setUint32(0,N),B.set(a.default.types.mdat,4))}B.set(H,x);var $=H.byteLength;x+=$,_.push(new g(!0,d,$,0)),j=W}var q=_.length;if(q){this.nextAudioPts=w=j+f*_[_.length-1].duration;var X=y?new Uint8Array(0):a.default.moof(t.sequenceNumber++,F/f,h({},t,{samples:_}));t.samples=[];var K=F/c,Z=w/c,Y={data1:X,data2:B,startPTS:K,endPTS:Z,startDTS:K,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:q};return this.isAudioContiguous=!0,console.assert(B.length,"MDAT length must not be zero"),Y}},e.remuxEmptyAudio=function(t,e,r,n){var a=t.inputTimeScale,o=this.nextAudioPts,s=(null!==o?o:n.startDTS*a)+this._initDTS,l=a/(t.samplerate?t.samplerate:a)*1024,c=Math.ceil((n.endDTS*a+this._initDTS-s)/l),h=i.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(u.logger.warn("[mp4-remuxer]: remux empty Audio"),h){for(var f=[],d=0;d<c;d++){var p=s+d*l;f.push({unit:h,pts:p,dts:p})}return t.samples=f,this.remuxAudio(t,e,r,!1)}u.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e.remuxID3=function(t,e){var r=t.samples.length;if(r){for(var n=t.inputTimeScale,i=this._initPTS,a=this._initDTS,o=0;o<r;o++){var s=t.samples[o];s.pts=v(s.pts-i,e*n)/n,s.dts=v(s.dts-a,e*n)/n}var u=t.samples;return t.samples=[],{samples:u}}},e.remuxText=function(t,e){var r=t.samples.length;if(r){for(var n=t.inputTimeScale,i=this._initPTS,a=0;a<r;a++){var o=t.samples[a];o.pts=v(o.pts-i,e*n)/n}t.samples.sort((function(t,e){return t.pts-e.pts}));var s=t.samples;return t.samples=[],{samples:s}}},t}();function v(t,e){var r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t}var g=function(t,e,r,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=n,this.flags=new y(t)},y=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":
/*!******************************************!*\
	  !*** ./src/remux/passthrough-remuxer.ts ***!
	  \******************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../utils/mp4-tools */"./src/utils/mp4-tools.ts"),a=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),o=r(/*! ../utils/logger */"./src/utils/logger.ts"),s=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},e.resetNextTimestamp=function(){this.lastEndDTS=null},e.resetInitSegment=function(t,e,r){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment(t),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=Object(i.parseInitSegment)(t);e||(e=l(n.audio,a.ElementaryStreamTypes.AUDIO)),r||(r=l(n.video,a.ElementaryStreamTypes.VIDEO));var s={};n.audio&&n.video?s.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:n.audio?s.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:n.video?s.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},e.remux=function(t,e,r,a,s){var l=this.initPTS,c=this.lastEndDTS,h={audio:void 0,video:void 0,text:a,id3:r,initSegment:void 0};Object(n.isFiniteNumber)(c)||(c=this.lastEndDTS=s||0);var f=e.samples;if(!f||!f.length)return h;var d={initPTS:void 0,timescale:1},p=this.initData;if(p&&p.length||(this.generateInitSegment(f),p=this.initData),!p||!p.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1),Object(n.isFiniteNumber)(l)||(this.initPTS=d.initPTS=l=u(p,f,c));var m=Object(i.getDuration)(f,p),v=c,g=m+v;Object(i.offsetStartDTS)(p,f,l),m>0?this.lastEndDTS=g:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!p.audio,_=!!p.video,b="";y&&(b+="audio"),_&&(b+="video");var x={data1:f,startPTS:v,startDTS:v,endPTS:g,endDTS:g,type:b,hasAudio:y,hasVideo:_,nb:1,dropped:0};return h.audio="audio"===x.type?x:void 0,h.video="audio"!==x.type?x:void 0,h.text=a,h.id3=r,h.initSegment=d,h},t}(),u=function(t,e,r){return Object(i.getStartDTS)(t,e)-r};function l(t,e){var r=null==t?void 0:t.codec;return r&&r.length>4?r:"hvc1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||e===a.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}e.default=s},"./src/task-loop.ts":
/*!**************************!*\
	  !*** ./src/task-loop.ts ***!
	  \**************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return n}));var n=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}()},"./src/types/cmcd.ts":
/*!***************************!*\
	  !*** ./src/types/cmcd.ts ***!
	  \***************************/
/*! exports provided: CMCDVersion, CMCDObjectType, CMCDStreamingFormat, CMCDStreamType */function(t,e,r){r.r(e),r.d(e,"CMCDVersion",(function(){return o})),r.d(e,"CMCDObjectType",(function(){return n})),r.d(e,"CMCDStreamingFormat",(function(){return i})),r.d(e,"CMCDStreamType",(function(){return a}));var n,i,a,o=1;!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(n||(n={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(i||(i={})),function(t){t.VOD="v",t.LIVE="l"}(a||(a={}))},"./src/types/level.ts":
/*!****************************!*\
	  !*** ./src/types/level.ts ***!
	  \****************************/
/*! exports provided: HlsSkip, getSkipValue, HlsUrlParameters, Level */function(t,e,r){var n;function i(t,e){var r=t.canSkipUntil;return r&&(void 0!==e?e-t.endSN:0)<r?t.canSkipDateRanges?n.v2:n.Yes:n.No}r.r(e),r.d(e,"HlsSkip",(function(){return n})),r.d(e,"getSkipValue",(function(){return i})),r.d(e,"HlsUrlParameters",(function(){return a})),r.d(e,"Level",(function(){return o})),function(t){t.No="",t.Yes="YES",t.v2="v2"}(n||(n={}));var a=function(){function t(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}return t.prototype.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},t}(),o=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var e;return(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var e=t%this.url.length;this._urlId!==e&&(this.details=void 0,this._urlId=e)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(t.prototype,e),t}()},"./src/types/loader.ts":
/*!*****************************!*\
	  !*** ./src/types/loader.ts ***!
	  \*****************************/
/*! exports provided: PlaylistContextType, PlaylistLevelType */function(t,e,r){var n,i;r.r(e),r.d(e,"PlaylistContextType",(function(){return n})),r.d(e,"PlaylistLevelType",(function(){return i})),function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(n||(n={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(i||(i={}))},"./src/types/transmuxer.ts":
/*!*********************************!*\
	  !*** ./src/types/transmuxer.ts ***!
	  \*********************************/
/*! exports provided: ChunkMetadata */function(t,e,r){r.r(e),r.d(e,"ChunkMetadata",(function(){return n}));var n=function(t,e,r,n,i,a){void 0===n&&(n=0),void 0===i&&(i=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=r,this.size=n,this.part=i,this.partial=a}},"./src/utils/attr-list.ts":
/*!********************************!*\
	  !*** ./src/utils/attr-list.ts ***!
	  \********************************/
/*! exports provided: AttrList */function(t,e,r){r.r(e),r.d(e,"AttrList",(function(){return a}));var n=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,a=function(){function t(e){for(var r in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(r)&&(this[r]=e[r])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),n=0;n<e.length/2;n++)r[n]=parseInt(e.slice(2*n,2*n+2),16);return r}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var r=this[t];return r?parseFloat(r):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=n.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,r={};for(i.lastIndex=0;null!==(e=i.exec(t));){var n=e[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),r[e[1]]=n}return r},t}()},"./src/utils/binary-search.ts":
/*!************************************!*\
	  !*** ./src/utils/binary-search.ts ***!
	  \************************************/
/*! exports provided: default */function(t,e,r){r.r(e),e.default={search:function(t,e){for(var r=0,n=t.length-1,i=null,a=null;r<=n;){var o=e(a=t[i=(r+n)/2|0]);if(o>0)r=i+1;else{if(!(o<0))return a;n=i-1}}return null}}},"./src/utils/buffer-helper.ts":
/*!************************************!*\
	  !*** ./src/utils/buffer-helper.ts ***!
	  \************************************/
/*! exports provided: BufferHelper */function(t,e,r){r.r(e),r.d(e,"BufferHelper",(function(){return a}));var n=r(/*! ./logger */"./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},a=function(){function t(){}return t.isBuffered=function(e,r){try{if(e)for(var n=t.getBuffered(e),i=0;i<n.length;i++)if(r>=n.start(i)&&r<=n.end(i))return!0}catch(t){}return!1},t.bufferInfo=function(e,r,n){try{if(e){var i,a=t.getBuffered(e),o=[];for(i=0;i<a.length;i++)o.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(o,r,n)}}catch(t){}return{len:0,start:r,end:r,nextStart:void 0}},t.bufferedInfo=function(t,e,r){e=Math.max(0,e),t.sort((function(t,e){return t.start-e.start||e.end-t.end}));var n=[];if(r)for(var i=0;i<t.length;i++){var a=n.length;if(a){var o=n[a-1].end;t[i].start-o<r?t[i].end>o&&(n[a-1].end=t[i].end):n.push(t[i])}else n.push(t[i])}else n=t;for(var s,u=0,l=e,c=e,h=0;h<n.length;h++){var f=n[h].start,d=n[h].end;if(e+r>=f&&e<d)l=f,u=(c=d)-e;else if(e+r<f){s=f;break}}return{len:u,start:l||0,end:c||0,nextStart:s}},t.getBuffered=function(t){try{return t.buffered}catch(t){return n.logger.log("failed to get media.buffered",t),i}},t}()},"./src/utils/cea-608-parser.ts":
/*!*************************************!*\
	  !*** ./src/utils/cea-608-parser.ts ***!
	  \*************************************/
/*! exports provided: Row, CaptionScreen, default */function(t,e,r){r.r(e),r.d(e,"Row",(function(){return y})),r.d(e,"CaptionScreen",(function(){return _}));var n,i=r(/*! ../utils/logger */"./src/utils/logger.ts"),a={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},o=function(t){var e=t;return a.hasOwnProperty(t)&&(e=a[t]),String.fromCharCode(e)},s=15,u=100,l={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},c={17:2,18:4,21:6,22:8,23:10,19:13,20:15},h={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},d=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(n||(n={}));var p=function(){function t(){this.time=null,this.verboseLevel=n.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&i.logger.log(this.time+" ["+t+"] "+e)},t}(),m=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e},v=function(){function t(t,e,r,n,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var n=e[r];t.hasOwnProperty(n)&&(this[n]=t[n])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),g=function(){function t(t,e,r,n,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new v(e,r,n,i,a)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),y=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<u;e++)this.chars.push(new g);this.logger=t,this.pos=0,this.currPenState=new v}var e=t.prototype;return e.equals=function(t){for(var e=!0,r=0;r<u;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<u;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<u;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(n.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>u&&(this.logger.log(n.DEBUG,"Too large cursor position "+this.pos),this.pos=u)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=o(t);this.pos>=u?this.logger.log(n.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<u;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,r=0;r<u;r++){var n=this.chars[r].uchar;" "!==n&&(e=!1),t.push(n)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),_=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<s;e++)this.rows.push(new y(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<s;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,r=0;r<s;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<s;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<s;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(n.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(n.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<s;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var o=a.rows[i].cueStartTime,u=this.logger.time;if(o&&null!==u&&o<u)for(var l=0;l<this.nrRollUpRows;l++)this.rows[e-this.nrRollUpRows+l+1].copy(a.rows[i+l])}}this.currRow=e;var c=this.rows[this.currRow];if(null!==t.indent){var h=Math.max(t.indent-1,0);c.setCursor(t.indent),t.color=c.chars[h].penState.foreground}this.setPen({foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1})},e.setBkgData=function(t){this.logger.log(n.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(n.TEXT,this.getDisplayText());var t=this.rows.splice(this.currRow+1-this.nrRollUpRows,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(n.INFO,"Rolling up")}else this.logger.log(n.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],r="",n=0;n<s;n++){var i=this.rows[n].getTextString();i&&e.push(t?"Row "+(n+1)+": '"+i+"'":i.trim())}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r},e.getTextAndFormat=function(){return this.rows},t}(),b=function(){function t(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new _(r),this.nonDisplayedMemory=new _(r),this.lastOutputScreen=new _(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(n.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);this.logger.log(n.INFO,(this.writeScreen===this.displayedMemory?"DISP":"NON_DISP")+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(n.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(n.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(n.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(n.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(n.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(n.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(n.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(n.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(n.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(n.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(n.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(n.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(n.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(n.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(n.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(n.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),x=function(){function t(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var n=new p;this.channels=[null,new b(t,e,n),new b(t+1,r,n)],this.cmdHistory={a:null,b:null},this.logger=n}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var r,i,a,o=!1;this.logger.time=t;for(var s=0;s<e.length;s+=2)if(a=127&e[s+1],0!=(i=127&e[s])||0!==a){if(this.logger.log(n.DATA,"["+m([e[s],e[s+1]])+"] -> ("+m([i,a])+")"),(r=this.parseCmd(i,a))||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(o=this.parseChars(i,a))){var u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(n.WARNING,"No channel found yet. TEXT-MODE?")}r||o||this.logger.log(n.WARNING,"Couldn't parse cleaned data "+m([i,a])+" orig: "+m([e[s],e[s+1]]))}},e.parseCmd=function(t,e){var r=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(M(t,e,r))return w(null,null,r),this.logger.log(n.DEBUG,"Repeated command ("+m([t,e])+") is dropped"),!0;var i=20===t||21===t||23===t?1:2,a=this.channels[i];return 20===t||21===t||28===t||29===t?32===e?a.ccRCL():33===e?a.ccBS():34===e?a.ccAOF():35===e?a.ccAON():36===e?a.ccDER():37===e?a.ccRU(2):38===e?a.ccRU(3):39===e?a.ccRU(4):40===e?a.ccFON():41===e?a.ccRDC():42===e?a.ccTR():43===e?a.ccRTD():44===e?a.ccEDM():45===e?a.ccCR():46===e?a.ccENM():47===e&&a.ccEOC():a.ccTO(e-32),w(t,e,r),this.currentChannel=i,!0},e.parseMidrow=function(t,e){var r=0;if((17===t||25===t)&&e>=32&&e<=47){if((r=17===t?1:2)!==this.currentChannel)return this.logger.log(n.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[r];return!!i&&(i.ccMIDROW(e),this.logger.log(n.DEBUG,"MIDROW ("+m([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(M(t,e,r))return w(null,null,r),!0;var n=t<=23?1:2,i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC(e>=64&&e<=95?1===n?l[t]:h[t]:1===n?c[t]:f[t],e)),w(t,e,r),this.currentChannel=n,!0)},e.interpretPAC=function(t,e){var r,n={color:null,italics:!1,indent:null,underline:!1,row:t};return n.underline=1==(1&(r=e>95?e-96:e-64)),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},e.parseChars=function(t,e){var r,i,a=null,s=null;if(t>=25?(r=2,s=t-8):(r=1,s=t),s>=17&&s<=19?(this.logger.log(n.INFO,"Special char '"+o(i=17===s?e+80:18===s?e+112:e+144)+"' in channel "+r),a=[i]):t>=32&&t<=127&&(a=0===e?[t]:[t,e]),a){var u=m(a);this.logger.log(n.DEBUG,"Char codes =  "+u.join(",")),w(t,e,this.cmdHistory)}return a},e.parseBackgroundAttributes=function(t,e){var r;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var n={};return 16===t||24===t?(r=Math.floor((e-32)/2),n.background=d[r],e%2==1&&(n.background=n.background+"_semi")):45===e?n.background="transparent":(n.foreground="black",47===e&&(n.underline=!0)),this.channels[t<=23?1:2].setBkgData(n),w(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},t}();function w(t,e,r){r.a=t,r.b=e}function M(t,e,r){return r.a===t&&r.b===e}e.default=x},"./src/utils/codecs.ts":
/*!*****************************!*\
	  !*** ./src/utils/codecs.ts ***!
	  \*****************************/
/*! exports provided: isCodecType, isCodecSupportedInMp4 */function(t,e,r){r.r(e),r.d(e,"isCodecType",(function(){return i})),r.d(e,"isCodecSupportedInMp4",(function(){return a}));var n={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(t,e){var r=n[e];return!!r&&!0===r[t.slice(0,4)]}function a(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":
/*!***************************!*\
	  !*** ./src/utils/cues.ts ***!
	  \***************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ./vttparser */"./src/utils/vttparser.ts"),i=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts"),a=r(/*! ./texttrack-utils */"./src/utils/texttrack-utils.ts"),o=/\s/,s={newCue:function(t,e,r,s){for(var u,l,c,h,f,d=[],p=self.VTTCue||self.TextTrackCue,m=0;m<s.rows.length;m++)if(c=!0,h=0,f="",!(u=s.rows[m]).isEmpty()){for(var v=0;v<u.chars.length;v++)o.test(u.chars[v].uchar)&&c?h++:(f+=u.chars[v].uchar,c=!1);u.cueStartTime=e,e===r&&(r+=1e-4),h>=16?h--:h++;var g=Object(n.fixLineBreaks)(f.trim()),y=Object(i.generateCueId)(e,r,g);t&&t.cues&&t.cues.getCueById(y)||((l=new p(e,r,g)).id=y,l.line=m+1,l.align="left",l.position=10+Math.min(80,10*Math.floor(8*h/32)),d.push(l))}return t&&d.length&&(d.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),d.forEach((function(e){return Object(a.addCueToTrack)(t,e)}))),d}};e.default=s},"./src/utils/discontinuities.ts":
/*!**************************************!*\
	  !*** ./src/utils/discontinuities.ts ***!
	  \**************************************/
/*! exports provided: findFirstFragWithCC, shouldAlignOnDiscontinuities, findDiscontinuousReferenceFrag, adjustSlidingStart, alignStream, alignPDT, alignFragmentByPDTDelta, alignMediaPlaylistByPDT */function(t,e,r){r.r(e),r.d(e,"findFirstFragWithCC",(function(){return o})),r.d(e,"shouldAlignOnDiscontinuities",(function(){return s})),r.d(e,"findDiscontinuousReferenceFrag",(function(){return u})),r.d(e,"adjustSlidingStart",(function(){return c})),r.d(e,"alignStream",(function(){return h})),r.d(e,"alignPDT",(function(){return f})),r.d(e,"alignFragmentByPDTDelta",(function(){return d})),r.d(e,"alignMediaPlaylistByPDT",(function(){return p}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./logger */"./src/utils/logger.ts"),a=r(/*! ../controller/level-helper */"./src/controller/level-helper.ts");function o(t,e){for(var r=null,n=0,i=t.length;n<i;n++){var a=t[n];if(a&&a.cc===e){r=a;break}}return r}function s(t,e,r){return!(!e.details||!(r.endCC>r.startCC||t&&t.cc<r.startCC))}function u(t,e){var r=t.fragments,n=e.fragments;if(n.length&&r.length){var a=o(r,n[0].cc);if(a&&(!a||a.startPTS))return a;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function l(t,e){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function c(t,e){for(var r=e.fragments,n=0,i=r.length;n<i;n++)l(r[n],t);e.fragmentHint&&l(e.fragmentHint,t),e.alignedSliding=!0}function h(t,e,r){e&&(function(t,e,r){if(s(t,r,e)){var a=u(r.details,e);a&&Object(n.isFiniteNumber)(a.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),c(a.start,e))}}(t,r,e),!r.alignedSliding&&e.details&&f(r,e.details),r.alignedSliding||!e.details||r.skippedSegments||Object(a.adjustSliding)(e.details,r))}function f(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var r=e.fragments[0].programDateTime,a=t.fragments[0].programDateTime,o=(a-r)/1e3+e.fragments[0].start;o&&Object(n.isFiniteNumber)(o)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(a-r)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),c(o,t))}}function d(t,e){var r=t.programDateTime;if(r){var n=(r-e)/1e3;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function p(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var r=e.fragments[0].programDateTime-1e3*e.fragments[0].start;t.fragments.forEach((function(t){d(t,r)})),t.fragmentHint&&d(t.fragmentHint,r),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":
/*!***********************************************!*\
	  !*** ./src/utils/ewma-bandwidth-estimator.ts ***!
	  \***********************************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../utils/ewma */"./src/utils/ewma.ts");e.default=function(){function t(t,e,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new n.default(t),this.fast_=new n.default(e)}var e=t.prototype;return e.update=function(t,e){var r=this.slow_,i=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new n.default(t,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new n.default(e,i.getEstimate(),i.getTotalWeight()))},e.sample=function(t,e){var r=(t=Math.max(t,this.minDelayMs_))/1e3,n=8*e/r;this.fast_.sample(r,n),this.slow_.sample(r,n)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}()},"./src/utils/ewma.ts":
/*!***************************!*\
	  !*** ./src/utils/ewma.ts ***!
	  \***************************/
/*! exports provided: default */function(t,e,r){r.r(e),e.default=function(){function t(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}var e=t.prototype;return e.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}()},"./src/utils/fetch-loader.ts":
/*!***********************************!*\
	  !*** ./src/utils/fetch-loader.ts ***!
	  \***********************************/
/*! exports provided: fetchSupported, default */function(t,e,r){r.r(e),r.d(e,"fetchSupported",(function(){return f}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),a=r(/*! ../demux/chunk-cache */"./src/demux/chunk-cache.ts");function o(t){var e="function"==typeof Map?new Map:void 0;return o=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return s(t,arguments,c(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,t)},o(t)}function s(t,e,r){return s=u()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&l(i,r.prototype),i},s.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function h(){return h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h.apply(this,arguments)}function f(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var d=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||p,this.controller=new self.AbortController,this.stats=new i.LoadStats}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,r){var i=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var o=function(t,e){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(h({},t.headers))};return t.rangeEnd&&r.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),r}(t,this.controller.signal),s=r.onProgress,u="arraybuffer"===t.responseType,l=u?"byteLength":"length";this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){i.abortInternal(),r.onTimeout(a,t,i.response)}),e.timeout),self.fetch(this.request).then((function(r){if(i.response=i.loader=r,!r.ok)throw new m(r.statusText||"fetch, bad network response",r.status,r);return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),s&&Object(n.isFiniteNumber)(e.highWaterMark)?i.loadProgressively(r,a,t,e.highWaterMark,s):u?r.arrayBuffer():r.text()})).then((function(o){var u=i.response;self.clearTimeout(i.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=o[l];var c={url:u.url,data:o};s&&!Object(n.isFiniteNumber)(e.highWaterMark)&&s(a,t,o,u),r.onSuccess(c,a,t,u)})).catch((function(e){self.clearTimeout(i.requestTimeout),a.aborted||r.onError({code:e.code||0,text:e.message},t,e.details)}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.loadProgressively=function(t,e,r,n,i){void 0===n&&(n=0);var o=new a.default,s=t.body.getReader();return function a(){return s.read().then((function(s){if(s.done)return o.dataLength&&i(e,r,o.flush(),t),Promise.resolve(new ArrayBuffer(0));var u=s.value,l=u.length;return e.loaded+=l,l<n||o.dataLength?(o.push(u),o.dataLength>=n&&i(e,r,o.flush(),t)):i(e,r,u,t),a()})).catch((function(){return Promise.reject()}))}()},t}();function p(t,e){return new self.Request(t.url,e)}var m=function(t){var e,r;function n(e,r,n){var i;return(i=t.call(this,e)||this).code=void 0,i.details=void 0,i.code=r,i.details=n,i}return r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,l(e,r),n}(o(Error));e.default=d},"./src/utils/imsc1-ttml-parser.ts":
/*!****************************************!*\
	  !*** ./src/utils/imsc1-ttml-parser.ts ***!
	  \****************************************/
/*! exports provided: IMSC1_CODEC, parseIMSC1 */function(t,e,r){r.r(e),r.d(e,"IMSC1_CODEC",(function(){return c})),r.d(e,"parseIMSC1",(function(){return p}));var n=r(/*! ./mp4-tools */"./src/utils/mp4-tools.ts"),i=r(/*! ./vttparser */"./src/utils/vttparser.ts"),a=r(/*! ./vttcue */"./src/utils/vttcue.ts"),o=r(/*! ../demux/id3 */"./src/demux/id3.ts"),s=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),u=r(/*! ./webvtt-parser */"./src/utils/webvtt-parser.ts");function l(){return l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},l.apply(this,arguments)}var c="stpp.ttml.im1t",h=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,f=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,d={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(t,e,r,i,c){var h=Object(n.findBox)(new Uint8Array(t),["mdat"]);if(0!==h.length){var f=h[0],p=Object(o.utf8ArrayToStr)(new Uint8Array(t,f.start,f.end-f.start)),x=Object(s.toTimescaleFromScale)(e,1,r);try{i(function(t,e){var r=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");var n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(n).reduce((function(t,e){return t[e]=r.getAttribute("ttp:"+e)||n[e],t}),{}),o="preserve"!==r.getAttribute("xml:space"),s=v(m(r,"styling","style")),c=v(m(r,"layout","region")),h=m(r,"body","[begin]");return[].map.call(h,(function(t){var r=g(t,o);if(!r||!t.hasAttribute("begin"))return null;var n=b(t.getAttribute("begin"),i),h=b(t.getAttribute("dur"),i),f=b(t.getAttribute("end"),i);if(null===n)throw _(t);if(null===f){if(null===h)throw _(t);f=n+h}var p=new a.default(n-e,f-e,r);p.id=Object(u.generateCueId)(p.startTime,p.endTime,p.text);var m=c[t.getAttribute("region")],v=s[t.getAttribute("style")];p.position=10,p.size=80;var x=function(t,e){var r="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(n,i){var a=y(e,r,i)||y(t,r,i);return a&&(n[i]=a),n}),{})}(m,v),w=x.textAlign;if(w){var M=d[w];M&&(p.lineAlign=M),p.align=w}return l(p,x),p})).filter((function(t){return null!==t}))}(p,x))}catch(t){c(t)}}else c(new Error("Could not parse IMSC1 mdat"))}function m(t,e,r){var n=t.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function v(t){return t.reduce((function(t,e){var r=e.getAttribute("xml:id");return r&&(t[r]=e),t}),{})}function g(t,e){return[].slice.call(t.childNodes).reduce((function(t,r,n){var i;return"br"===r.nodeName&&n?t+"\n":null!==(i=r.childNodes)&&void 0!==i&&i.length?g(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent}),"")}function y(t,e,r){return t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function _(t){return new Error("Could not parse ttml timestamp "+t)}function b(t,e){if(!t)return null;var r=Object(i.parseTimeStamp)(t);return null===r&&(h.test(t)?r=function(t,e){var r=h.exec(t);return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+((0|r[4])+(0|r[5])/e.subFrameRate)/e.frameRate}(t,e):f.test(t)&&(r=function(t,e){var r=f.exec(t),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}(t,e))),r}},"./src/utils/logger.ts":
/*!*****************************!*\
	  !*** ./src/utils/logger.ts ***!
	  \*****************************/
/*! exports provided: enableLogs, logger */function(t,e,r){r.r(e),r.d(e,"enableLogs",(function(){return s})),r.d(e,"logger",(function(){return u}));var n=function(){},i={trace:n,debug:n,log:n,warn:n,info:n,error:n},a=i;function o(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):n}function s(t){if(self.console&&!0===t||"object"==typeof t){!function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];r.forEach((function(e){a[e]=t[e]?t[e].bind(t):o(e)}))}(t,"debug","log","info","warn","error");try{a.log()}catch(t){a=i}}else a=i}var u=i},"./src/utils/mediakeys-helper.ts":
/*!***************************************!*\
	  !*** ./src/utils/mediakeys-helper.ts ***!
	  \***************************************/
/*! exports provided: KeySystems, requestMediaKeySystemAccess */function(t,e,r){var n;r.r(e),r.d(e,"KeySystems",(function(){return n})),r.d(e,"requestMediaKeySystemAccess",(function(){return i})),function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(n||(n={}));var i="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":
/*!*****************************************!*\
	  !*** ./src/utils/mediasource-helper.ts ***!
	  \*****************************************/
/*! exports provided: getMediaSource */function(t,e,r){function n(){return self.MediaSource||self.WebKitMediaSource}r.r(e),r.d(e,"getMediaSource",(function(){return n}))},"./src/utils/mp4-tools.ts":
/*!********************************!*\
	  !*** ./src/utils/mp4-tools.ts ***!
	  \********************************/
/*! exports provided: bin2str, readUint16, readUint32, writeUint32, findBox, parseSegmentIndex, parseInitSegment, getStartDTS, getDuration, computeRawDurationFromSamples, offsetStartDTS, segmentValidRange, appendUint8Array */function(t,e,r){r.r(e),r.d(e,"bin2str",(function(){return s})),r.d(e,"readUint16",(function(){return u})),r.d(e,"readUint32",(function(){return l})),r.d(e,"writeUint32",(function(){return c})),r.d(e,"findBox",(function(){return h})),r.d(e,"parseSegmentIndex",(function(){return f})),r.d(e,"parseInitSegment",(function(){return d})),r.d(e,"getStartDTS",(function(){return p})),r.d(e,"getDuration",(function(){return m})),r.d(e,"computeRawDurationFromSamples",(function(){return v})),r.d(e,"offsetStartDTS",(function(){return g})),r.d(e,"segmentValidRange",(function(){return y})),r.d(e,"appendUint8Array",(function(){return _}));var n=r(/*! ./typed-array */"./src/utils/typed-array.ts"),i=r(/*! ../loader/fragment */"./src/loader/fragment.ts"),a=Math.pow(2,32)-1,o=[].push;function s(t){return String.fromCharCode.apply(null,t)}function u(t,e){"data"in t&&(e+=t.start,t=t.data);var r=t[e]<<8|t[e+1];return r<0?65536+r:r}function l(t,e){"data"in t&&(e+=t.start,t=t.data);var r=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return r<0?4294967296+r:r}function c(t,e,r){"data"in t&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r}function h(t,e){var r,n,i,a=[];if(!e.length)return a;"data"in t?(r=t.data,n=t.start,i=t.end):(n=0,i=(r=t).byteLength);for(var u=n;u<i;){var c=l(r,u),f=c>1?u+c:i;if(s(r.subarray(u+4,u+8))===e[0])if(1===e.length)a.push({data:r,start:u+8,end:f});else{var d=h({data:r,start:u+8,end:f},e.slice(1));d.length&&o.apply(a,d)}u=f}return a}function f(t){var e=h(t,["moov"])[0],r=e?e.end:null,n=h(t,["sidx"]);if(!n||!n[0])return null;var i=[],a=n[0],o=a.data[0],s=0===o?8:16,c=l(a,s);s+=4,s+=0===o?8:16;var f=a.end+0,d=u(a,s+=2);s+=2;for(var p=0;p<d;p++){var m=s,v=l(a,m);m+=4;var g=2147483647&v;if(1==(2147483648&v)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var y=l(a,m);m+=4,i.push({referenceSize:g,subsegmentDuration:y,info:{duration:y/c,start:f,end:f+g-1}}),f+=g,s=m+=4}return{earliestPresentationTime:0,timescale:c,version:o,referencesCount:d,references:i,moovEndOffset:r}}function d(t){for(var e=[],r=h(t,["moov","trak"]),n=0;n<r.length;n++){var a=r[n],o=h(a,["tkhd"])[0];if(o){var u=o.data[o.start],c=0===u?12:20,f=l(o,c),d=h(a,["mdia","mdhd"])[0];if(d){var p=l(d,c=0===(u=d.data[d.start])?12:20),m=h(a,["mdia","hdlr"])[0];if(m){var v=s(m.data.subarray(m.start+8,m.start+12)),g={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[v];if(g){var y=h(a,["mdia","minf","stbl","stsd"])[0],_=void 0;y&&(_=s(y.data.subarray(y.start+12,y.start+16))),e[f]={timescale:p,type:g},e[g]={timescale:p,id:f,codec:_}}}}}}return h(t,["moov","mvex","trex"]).forEach((function(t){var r=l(t,4),n=e[r];n&&(n.default={duration:l(t,12),flags:l(t,20)})})),e}function p(t,e){return h(e,["moof","traf"]).reduce((function(e,r){var n=h(r,["tfdt"])[0],i=n.data[n.start],a=h(r,["tfhd"]).reduce((function(e,r){var a=l(r,4),o=t[a];if(o){var s=l(n,4);1===i&&(s*=Math.pow(2,32),s+=l(n,8));var u=s/(o.timescale||9e4);if(isFinite(u)&&(null===e||u<e))return u}return e}),null);return null!==a&&isFinite(a)&&(null===e||a<e)?a:e}),null)||0}function m(t,e){for(var r=0,n=0,a=0,o=h(t,["moof","traf"]),s=0;s<o.length;s++){var u=o[s],c=h(u,["tfhd"])[0],d=e[l(c,4)];if(d){var p=d.default,m=l(c,0)|(null==p?void 0:p.flags),g=null==p?void 0:p.duration;8&m&&(g=l(c,2&m?12:8));for(var y=d.timescale||9e4,_=h(u,["trun"]),b=0;b<_.length;b++)!(r=v(_[b]))&&g&&(r=g*l(_[b],4)),d.type===i.ElementaryStreamTypes.VIDEO?n+=r/y:d.type===i.ElementaryStreamTypes.AUDIO&&(a+=r/y)}}if(0===n&&0===a){var x=f(t);if(null!=x&&x.references)return x.references.reduce((function(t,e){return t+e.info.duration||0}),0)}return n||a}function v(t){var e=l(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var n=0,i=l(t,4),a=0;a<i;a++)256&e&&(n+=l(t,r),r+=4),512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4);return n}function g(t,e,r){h(e,["moof","traf"]).forEach((function(e){h(e,["tfhd"]).forEach((function(n){var i=l(n,4),o=t[i];if(o){var s=o.timescale||9e4;h(e,["tfdt"]).forEach((function(t){var e=t.data[t.start],n=l(t,4);if(0===e)c(t,4,n-r*s);else{n*=Math.pow(2,32),n+=l(t,8),n-=r*s,n=Math.max(n,0);var i=Math.floor(n/(a+1)),o=Math.floor(n%(a+1));c(t,4,i),c(t,8,o)}}))}}))}))}function y(t){var e={valid:null,remainder:null},r=h(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;var i=r[r.length-1];return e.valid=Object(n.sliceUint8)(t,0,i.start-8),e.remainder=Object(n.sliceUint8)(t,i.start-8),e}function _(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}},"./src/utils/output-filter.ts":
/*!************************************!*\
	  !*** ./src/utils/output-filter.ts ***!
	  \************************************/
/*! exports provided: default */function(t,e,r){r.r(e),r.d(e,"default",(function(){return n}));var n=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[],this.startTime=null},t}()},"./src/utils/texttrack-utils.ts":
/*!**************************************!*\
	  !*** ./src/utils/texttrack-utils.ts ***!
	  \**************************************/
/*! exports provided: sendAddTrackEvent, addCueToTrack, clearCurrentCues, removeCuesInRange, getCuesInRange */function(t,e,r){r.r(e),r.d(e,"sendAddTrackEvent",(function(){return i})),r.d(e,"addCueToTrack",(function(){return a})),r.d(e,"clearCurrentCues",(function(){return o})),r.d(e,"removeCuesInRange",(function(){return s})),r.d(e,"getCuesInRange",(function(){return u}));var n=r(/*! ./logger */"./src/utils/logger.ts");function i(t,e){var r;try{r=new Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function a(t,e){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){n.logger.debug("[texttrack-utils]: "+r);var i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,t.addCue(i)}"disabled"===r&&(t.mode=r)}function o(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function s(t,e,r){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var i=u(t.cues,e,r),a=0;a<i.length;a++)t.removeCue(i[a]);"disabled"===n&&(t.mode=n)}function u(t,e,r){var n=[],i=function(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;for(var n=0,i=r;n<=i;){var a=Math.floor((i+n)/2);if(e<t[a].startTime)i=a-1;else{if(!(e>t[a].startTime&&n<r))return a;n=a+1}}return t[n].startTime-e<e-t[i].startTime?n:i}(t,e);if(i>-1)for(var a=i,o=t.length;a<o;a++){var s=t[a];if(s.startTime>=e&&s.endTime<=r)n.push(s);else if(s.startTime>r)return n}return n}},"./src/utils/time-ranges.ts":
/*!**********************************!*\
	  !*** ./src/utils/time-ranges.ts ***!
	  \**********************************/
/*! exports provided: default */function(t,e,r){r.r(e),e.default={toString:function(t){for(var e="",r=t.length,n=0;n<r;n++)e+="["+t.start(n).toFixed(3)+","+t.end(n).toFixed(3)+"]";return e}}},"./src/utils/timescale-conversion.ts":
/*!*******************************************!*\
	  !*** ./src/utils/timescale-conversion.ts ***!
	  \*******************************************/
/*! exports provided: toTimescaleFromBase, toTimescaleFromScale, toMsFromMpegTsClock, toMpegTsClockFromTimescale */function(t,e,r){function n(t,e,r,n){void 0===r&&(r=1),void 0===n&&(n=!1);var i=t*e*r;return n?Math.round(i):i}function i(t,e,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),n(t,e,1/r,i)}function a(t,e){return void 0===e&&(e=!1),n(t,1e3,1/9e4,e)}function o(t,e){return void 0===e&&(e=1),n(t,9e4,1/e)}r.r(e),r.d(e,"toTimescaleFromBase",(function(){return n})),r.d(e,"toTimescaleFromScale",(function(){return i})),r.d(e,"toMsFromMpegTsClock",(function(){return a})),r.d(e,"toMpegTsClockFromTimescale",(function(){return o}))},"./src/utils/typed-array.ts":
/*!**********************************!*\
	  !*** ./src/utils/typed-array.ts ***!
	  \**********************************/
/*! exports provided: sliceUint8 */function(t,e,r){function n(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}r.r(e),r.d(e,"sliceUint8",(function(){return n}))},"./src/utils/vttcue.ts":
/*!*****************************!*\
	  !*** ./src/utils/vttcue.ts ***!
	  \*****************************/
/*! exports provided: default */function(t,e,r){r.r(e),e.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function r(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;var r=e.toLowerCase();return!!~t.indexOf(r)&&r}function n(t){return r(e,t)}function i(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];for(var i=1;i<arguments.length;i++){var a=arguments[i];for(var o in a)t[o]=a[o]}return t}function a(e,a,o){var s=this,u={enumerable:!0};s.hasBeenReset=!1;var l="",c=!1,h=e,f=a,d=o,p=null,m="",v=!0,g="auto",y="start",_=50,b="middle",x=50,w="middle";Object.defineProperty(s,"id",i({},u,{get:function(){return l},set:function(t){l=""+t}})),Object.defineProperty(s,"pauseOnExit",i({},u,{get:function(){return c},set:function(t){c=!!t}})),Object.defineProperty(s,"startTime",i({},u,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",i({},u,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",i({},u,{get:function(){return d},set:function(t){d=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",i({},u,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",i({},u,{get:function(){return m},set:function(e){var n=function(e){return r(t,e)}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");m=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",i({},u,{get:function(){return v},set:function(t){v=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",i({},u,{get:function(){return g},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",i({},u,{get:function(){return y},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",i({},u,{get:function(){return _},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",i({},u,{get:function(){return b},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",i({},u,{get:function(){return x},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");x=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",i({},u,{get:function(){return w},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");w=e,this.hasBeenReset=!0}})),s.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}()},"./src/utils/vttparser.ts":
/*!********************************!*\
	  !*** ./src/utils/vttparser.ts ***!
	  \********************************/
/*! exports provided: parseTimeStamp, fixLineBreaks, VTTParser */function(t,e,r){r.r(e),r.d(e,"parseTimeStamp",(function(){return a})),r.d(e,"fixLineBreaks",(function(){return h})),r.d(e,"VTTParser",(function(){return f}));var n=r(/*! ./vttcue */"./src/utils/vttcue.ts"),i=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function a(t){function e(t,e,r,n){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(n||0)}var r=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?e(r[2],r[3],0,r[4]):e(r[1],r[2],r[3],r[4]):null}var o=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,r){for(var n=0;n<r.length;++n)if(e===r[n]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(t,r),!0}return!1},t}();function s(t,e,r,n){var i=n?t.split(n):[t];for(var a in i)if("string"==typeof i[a]){var o=i[a].split(r);2===o.length&&e(o[0],o[1])}}var u=new n.default(0,0,""),l="middle"===u.align?"middle":"center";function c(t,e,r){var n=t;function i(){var e=a(t);if(null===e)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function c(){t=t.replace(/^\s+/,"")}if(c(),e.startTime=i(),c(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);t=t.substr(3),c(),e.endTime=i(),c(),function(t,e){var n=new o;s(t,(function(t,e){var i;switch(t){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===e){n.set(t,r[a].region);break}break;case"vertical":n.alt(t,e,["rl","lr"]);break;case"line":i=e.split(","),n.integer(t,i[0]),n.percent(t,i[0])&&n.set("snapToLines",!1),n.alt(t,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",l,"end"]);break;case"position":i=e.split(","),n.percent(t,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",l,"end","line-left","line-right","auto"]);break;case"size":n.percent(t,e);break;case"align":n.alt(t,e,["start",l,"end","left","right"])}}),/:/,/\s/),e.region=n.get("region",null),e.vertical=n.get("vertical","");var i=n.get("line","auto");"auto"===i&&-1===u.line&&(i=-1),e.line=i,e.lineAlign=n.get("lineAlign","start"),e.snapToLines=n.get("snapToLines",!0),e.size=n.get("size",100),e.align=n.get("align",l);var a=n.get("position","auto");"auto"===a&&50===u.position&&(a="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=a}(t,e)}function h(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var f=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function r(){var t=e.buffer,r=0;for(t=h(t);r<t.length&&"\r"!==t[r]&&"\n"!==t[r];)++r;var n=t.substr(0,r);return"\r"===t[r]&&++r,"\n"===t[r]&&++r,e.buffer=t.substr(r),n}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var i="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var a=(i=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var o=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:i=r(),e.state){case"HEADER":/:/.test(i)?s(i,(function(t,e){}),/:/):i||(e.state="ID");continue;case"NOTE":i||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){e.state="NOTE";break}if(!i)continue;if(e.cue=new n.default(0,0,""),e.state="CUE",-1===i.indexOf("--\x3e")){e.cue.id=i;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{c(i,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var u=-1!==i.indexOf("--\x3e");if(!i||u&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=i;continue;case"BADCUE":i||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":
/*!************************************!*\
	  !*** ./src/utils/webvtt-parser.ts ***!
	  \************************************/
/*! exports provided: generateCueId, parseWebVTT */function(t,e,r){r.r(e),r.d(e,"generateCueId",(function(){return h})),r.d(e,"parseWebVTT",(function(){return f}));var n=r(/*! ./src/polyfills/number */"./src/polyfills/number.ts"),i=r(/*! ./vttparser */"./src/utils/vttparser.ts"),a=r(/*! ../demux/id3 */"./src/demux/id3.ts"),o=r(/*! ./timescale-conversion */"./src/utils/timescale-conversion.ts"),s=r(/*! ../remux/mp4-remuxer */"./src/remux/mp4-remuxer.ts"),u=/\r\n|\n\r|\n|\r/g,l=function(t,e,r){return void 0===r&&(r=0),t.substr(r,e.length)===e},c=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()};function h(t,e,r){return c(t.toString())+c(e.toString())+c(r)}function f(t,e,r,c,f,d,p,m){var v,g=new i.VTTParser,y=Object(a.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(u,"\n").split("\n"),_=[],b=Object(o.toMpegTsClockFromTimescale)(e,r),x="00:00.000",w=0,M=0,A=!0,E=!1;g.oncue=function(t){var e=c[f],r=c.ccOffset,n=(w-b)/9e4;if(null!=e&&e.new&&(void 0!==M?r=c.ccOffset=e.start:function(t,e,r){var n=t[e],i=t[n.prevCC];if(!i||!i.new&&n.new)return t.ccOffset=t.presentationOffset=n.start,void(n.new=!1);for(;null!==(a=i)&&void 0!==a&&a.new;){var a;t.ccOffset+=n.start-i.start,n.new=!1,i=t[(n=i).prevCC]}t.presentationOffset=r}(c,f,n)),n&&(r=n-c.presentationOffset),E){var i=t.endTime-t.startTime,a=Object(s.normalizePts)(9e4*(t.startTime+r-M),9e4*d)/9e4;t.startTime=a,t.endTime=a+i}var o=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(o)),t.id||(t.id=h(t.startTime,t.endTime,o)),t.endTime>0&&_.push(t)},g.onparsingerror=function(t){v=t},g.onflush=function(){v?m(v):p(_)},y.forEach((function(t){if(A){if(l(t,"X-TIMESTAMP-MAP=")){A=!1,E=!0,t.substr(16).split(",").forEach((function(t){l(t,"LOCAL:")?x=t.substr(6):l(t,"MPEGTS:")&&(w=parseInt(t.substr(7)))}));try{M=function(t){var e=parseInt(t.substr(-3)),r=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),a=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(n.isFiniteNumber)(e)&&Object(n.isFiniteNumber)(r)&&Object(n.isFiniteNumber)(i)&&Object(n.isFiniteNumber)(a)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*r,(e+=6e4*i)+36e5*a}(x)/1e3}catch(t){E=!1,v=t}return}""===t&&(A=!1)}g.parse(t+"\n")})),g.flush()}},"./src/utils/xhr-loader.ts":
/*!*********************************!*\
	  !*** ./src/utils/xhr-loader.ts ***!
	  \*********************************/
/*! exports provided: default */function(t,e,r){r.r(e);var n=r(/*! ../utils/logger */"./src/utils/logger.ts"),i=r(/*! ../loader/load-stats */"./src/loader/load-stats.ts"),a=/^age:\s*[\d.]+\s*$/m,o=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0;var i=this.xhrSetup;try{if(i)try{i(r,e.url)}catch(t){r.open("GET",e.url,!0),i(r,e.url)}r.readyState||r.open("GET",e.url,!0);var a=this.context.headers;if(a)for(var o in a)r.setRequestHeader(o,a[o])}catch(t){return void this.callbacks.onError({code:r.status,text:t.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()}},e.readystatechange=function(){var t=this.context,e=this.loader,r=this.stats;if(t&&e){var i=e.readyState,a=this.config;if(!r.aborted&&i>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===i){e.onreadystatechange=null,e.onprogress=null;var o=e.status;if(o>=200&&o<300){var s,u;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),u="arraybuffer"===t.responseType?(s=e.response).byteLength:(s=e.responseText).length,r.loaded=r.total=u,!this.callbacks)return;var l=this.callbacks.onProgress;if(l&&l(r,t,s,e),!this.callbacks)return;this.callbacks.onSuccess({url:e.responseURL,data:s},r,t,e)}else r.retry>=a.maxRetry||o>=400&&o<499?(n.logger.error(o+" while loading "+t.url),this.callbacks.onError({code:o,text:e.statusText},t,e)):(n.logger.warn(o+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout)}},e.loadtimeout=function(){n.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&a.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},t}();e.default=o}}).default},t.exports=r())})),Hls=unwrapExports(hls),flv=createCommonjsModule((function(t,e){var r;self,r=function(){return function(){var t={"./node_modules/es6-promise/dist/es6-promise.js":
/*!******************************************************!*\
	  !*** ./node_modules/es6-promise/dist/es6-promise.js ***!
	  \******************************************************/function(t,e,r){
/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   v4.2.8+1e68dce6
	 */
t.exports=function(){function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,i=void 0,a=void 0,o=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(a?a(p):v())},s="undefined"!=typeof window?window:void 0,u=s||{},l=u.MutationObserver||u.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(p,1)}}var d=new Array(1e3);function p(){for(var t=0;t<n;t+=2)(0,d[t])(d[t+1]),d[t]=void 0,d[t+1]=void 0;n=0}var m,v=void 0;function g(t,e){var r=this,n=new this.constructor(b);void 0===n[_]&&L(n);var i=r._state;if(i){var a=arguments[i-1];o((function(){return O(i,n,a,r._result)}))}else T(r,n,t,e);return n}function y(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(b);return M(e,t),e}v=c?function(){return process.nextTick(p)}:l?function(){var t=0,e=new l(p),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():h?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===s?function(){try{var t=Function("return this")().require("vertx");return void 0!==(i=t.runOnLoop||t.runOnContext)?function(){i(p)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function b(){}var x=void 0;function w(e,r,n){r.constructor===e.constructor&&n===g&&r.constructor.resolve===y?function(t,e){1===e._state?E(t,e._result):2===e._state?S(t,e._result):T(e,void 0,(function(e){return M(t,e)}),(function(e){return S(t,e)}))}(e,r):void 0===n?E(e,r):t(n)?function(t,e,r){o((function(t){var n=!1,i=function(r,i,a,o){try{r.call(i,(function(r){n||(n=!0,e!==r?M(t,r):E(t,r))}),(function(e){n||(n=!0,S(t,e))}))}catch(t){return t}}(r,e);!n&&i&&(n=!0,S(t,i))}),t)}(e,r,n):E(e,r)}function M(t,e){if(t===e)S(t,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=e),null===n||"object"!==i&&"function"!==i)E(t,e);else{var r=void 0;try{r=e.then}catch(e){return void S(t,e)}w(t,e,r)}var n,i}function A(t){t._onerror&&t._onerror(t._result),C(t)}function E(t,e){t._state===x&&(t._result=e,t._state=1,0!==t._subscribers.length&&o(C,t))}function S(t,e){t._state===x&&(t._state=2,t._result=e,o(A,t))}function T(t,e,r,n){var i=t._subscribers,a=i.length;t._onerror=null,i[a]=e,i[a+1]=r,i[a+2]=n,0===a&&t._state&&o(C,t)}function C(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n=void 0,i=void 0,a=t._result,o=0;o<e.length;o+=3)i=e[o+r],(n=e[o])?O(r,n,i,a):i(a);t._subscribers.length=0}}function O(e,r,n,i){var a=t(n),o=void 0,s=void 0,u=!0;if(a){try{o=n(i)}catch(t){u=!1,s=t}if(r===o)return void S(r,new TypeError("A promises callback cannot return that same promise."))}else o=i;r._state!==x||(a&&u?M(r,o):!1===u?S(r,s):1===e?E(r,o):2===e&&S(r,o))}var P=0;function L(t){t[_]=P++,t._state=void 0,t._result=void 0,t._subscribers=[]}var I=function(){function t(t,r){this._instanceConstructor=t,this.promise=new t(b),this.promise[_]||L(this.promise),e(r)?(this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(r),0===this._remaining&&E(this.promise,this._result))):S(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===y){var i=void 0,a=void 0,o=!1;try{i=t.then}catch(t){o=!0,a=t}if(i===g&&t._state!==x)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(r===k){var s=new r(b);o?S(s,a):w(s,t,i),this._willSettleAt(s,e)}else this._willSettleAt(new r((function(e){return e(t)})),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===x&&(this._remaining--,2===t?S(n,r):this._result[e]=r),0===this._remaining&&E(n,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;T(t,void 0,(function(t){return r._settledAt(1,e,t)}),(function(t){return r._settledAt(2,e,t)}))},t}(),k=function(){function e(t){this[_]=P++,this._result=this._state=void 0,this._subscribers=[],b!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){M(t,e)}),(function(e){S(t,e)}))}catch(e){S(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):r.then(e,e)},e}();return k.prototype.then=g,k.all=function(t){return new I(this,t).promise},k.race=function(t){var r=this;return e(t)?new r((function(e,n){for(var i=t.length,a=0;a<i;a++)r.resolve(t[a]).then(e,n)})):new r((function(t,e){return e(new TypeError("You must pass an array to race."))}))},k.resolve=y,k.reject=function(t){var e=new this(b);return S(e,t),e},k._setScheduler=function(t){a=t},k._setAsap=function(t){o=t},k._asap=o,k.polyfill=function(){var t=void 0;if(void 0!==r.g)t=r.g;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=k},k.Promise=k,k}()},"./node_modules/events/events.js":
/*!***************************************!*\
	  !*** ./node_modules/events/events.js ***!
	  \***************************************/function(t){var e,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,t.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,a),n(r)}function a(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}m(t,e,a,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,i)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var o=10;function s(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function l(t,e,r,n){var i,a,o;if(s(r),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),a=t._events),o=a[e]),void 0===o)o=a[e]=r,++t._eventsCount;else if("function"==typeof o?o=a[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),(i=u(t))>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,console&&console.warn&&console.warn(l)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function f(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):p(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function m(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(a){n.once&&t.removeEventListener(e,i),r(a)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var s=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw s.context=o,s}var u=a[t];if(void 0===u)return!1;if("function"==typeof u)n(u,this,e);else{var l=u.length,c=p(u,l);for(r=0;r<l;++r)n(c[r],this,e)}return!0},a.prototype.on=a.prototype.addListener=function(t,e){return l(this,t,e,!1)},a.prototype.prependListener=function(t,e){return l(this,t,e,!0)},a.prototype.once=function(t,e){return s(e),this.on(t,h(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){return s(e),this.prependListener(t,h(this,t,e)),this},a.prototype.off=a.prototype.removeListener=function(t,e){var r,n,i,a,o;if(s(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===e||r[a].listener===e){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},a.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},a.prototype.listeners=function(t){return f(this,t,!0)},a.prototype.rawListeners=function(t){return f(this,t,!1)},a.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},a.prototype.listenerCount=d,a.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
	  !*** ./node_modules/webworkify-webpack/index.js ***!
	  \**************************************************/function(t,e,r){function n(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r.oe=function(t){throw console.error(t),t};var n=r(r.s=ENTRY_MODULE);return n.default||n}var i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,n){var o={};o[n]=[];var s=e.toString(),u=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return o;for(var l,c=u[1],h=new RegExp("(\\\\n|\\W)"+a(c)+i,"g");l=h.exec(s);)"dll-reference"!==l[3]&&o[n].push(l[3]);for(h=new RegExp("\\("+a(c)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+i,"g");l=h.exec(s);)t[l[2]]||(o[n].push(l[1]),t[l[2]]=r(l[1]).m),o[l[2]]=o[l[2]]||[],o[l[2]].push(l[4]);for(var f=Object.keys(o),d=0;d<f.length;d++)for(var p=0;p<o[f[d]].length;p++)isNaN(1*o[f[d]][p])||(o[f[d]][p]=1*o[f[d]][p]);return o}function s(t){return Object.keys(t).reduce((function(e,r){return e||t[r].length>0}),!1)}t.exports=function(t,e){var i={main:r.m},a=(e=e||{}).all?{main:Object.keys(i.main)}:function(t,e){for(var r={main:[e]},n={main:[]},i={main:{}};s(r);)for(var a=Object.keys(r),u=0;u<a.length;u++){var l=a[u],c=r[l].pop();if(i[l]=i[l]||{},!i[l][c]&&t[l][c]){i[l][c]=!0,n[l]=n[l]||[],n[l].push(c);for(var h=o(t,t[l][c],l),f=Object.keys(h),d=0;d<f.length;d++)r[f[d]]=r[f[d]]||[],r[f[d]]=r[f[d]].concat(h[f[d]])}}return n}(i,t),u="";Object.keys(a).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;a[t][e];)e++;a[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+t+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),u=u+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var l=new window.Blob([u],{type:"text/javascript"});if(e.bare)return l;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),h=new window.Worker(c);return h.objectURL=c,h}},"./src/config.js":
/*!***********************!*\
	  !*** ./src/config.js ***!
	  \***********************/function(t,e,r){r.r(e),r.d(e,{defaultConfig:function(){return n},createDefaultConfig:function(){return i}});var n={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function i(){return Object.assign({},n)}},"./src/core/features.js":
/*!******************************!*\
	  !*** ./src/core/features.js ***!
	  \******************************/function(t,e,r){r.r(e);var n=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),i=r(/*! ../config.js */"./src/config.js"),a=function(){function t(){}return t.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},t.supportNetworkStreamIO=function(){var t=new n.default({},(0,i.createDefaultConfig)()),e=t.loaderType;return t.destroy(),"fetch-stream-loader"==e||"xhr-moz-chunked-loader"==e},t.getNetworkLoaderTypeName=function(){var t=new n.default({},(0,i.createDefaultConfig)()),e=t.loaderType;return t.destroy(),e},t.supportNativeMediaPlayback=function(e){null==t.videoElement&&(t.videoElement=window.document.createElement("video"));var r=t.videoElement.canPlayType(e);return"probably"===r||"maybe"==r},t.getFeatureList=function(){var e={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return e.mseFlvPlayback=t.supportMSEH264Playback(),e.networkStreamIO=t.supportNetworkStreamIO(),e.networkLoaderName=t.getNetworkLoaderTypeName(),e.mseLiveFlvPlayback=e.mseFlvPlayback&&e.networkStreamIO,e.nativeMP4H264Playback=t.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),e.nativeWebmVP8Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),e.nativeWebmVP9Playback=t.supportNativeMediaPlayback('video/webm; codecs="vp9"'),e},t}();e.default=a},"./src/core/media-info.js":
/*!********************************!*\
	  !*** ./src/core/media-info.js ***!
	  \********************************/function(t,e,r){r.r(e);var n=function(){function t(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return t.prototype.isComplete=function(){return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&(!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount)&&(!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen)},t.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},t.prototype.getNearestKeyframe=function(t){if(null==this.keyframesIndex)return null;var e=this.keyframesIndex,r=this._search(e.times,t);return{index:r,milliseconds:e.times[r],fileposition:e.filepositions[r]}},t.prototype._search=function(t,e){var r=0,n=t.length-1,i=0,a=0,o=n;for(e<t[0]&&(r=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===n||e>=t[i]&&e<t[i+1]){r=i;break}t[i]<e?a=i+1:o=i-1}return r},t}();e.default=n},"./src/core/media-segment-info.js":
/*!****************************************!*\
	  !*** ./src/core/media-segment-info.js ***!
	  \****************************************/function(t,e,r){r.r(e),r.d(e,{SampleInfo:function(){return n},MediaSegmentInfo:function(){return i},IDRSampleList:function(){return a},MediaSegmentInfoList:function(){return o}});var n=function(t,e,r,n,i){this.dts=t,this.pts=e,this.duration=r,this.originalDts=n,this.isSyncPoint=i,this.fileposition=null},i=function(){function t(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return t.prototype.appendSyncPoint=function(t){t.isSyncPoint=!0,this.syncPoints.push(t)},t}(),a=function(){function t(){this._list=[]}return t.prototype.clear=function(){this._list=[]},t.prototype.appendArray=function(t){var e=this._list;0!==t.length&&(e.length>0&&t[0].originalDts<e[e.length-1].originalDts&&this.clear(),Array.prototype.push.apply(e,t))},t.prototype.getLastSyncPointBeforeDts=function(t){if(0==this._list.length)return null;var e=this._list,r=0,n=e.length-1,i=0,a=0,o=n;for(t<e[0].dts&&(r=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===n||t>=e[i].dts&&t<e[i+1].dts){r=i;break}e[i].dts<t?a=i+1:o=i-1}return this._list[r]},t}(),o=function(){function t(t){this._type=t,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),t.prototype.isEmpty=function(){return 0===this._list.length},t.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},t.prototype._searchNearestSegmentBefore=function(t){var e=this._list;if(0===e.length)return-2;var r=e.length-1,n=0,i=0,a=r,o=0;if(t<e[0].originalBeginDts)return-1;for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||t>e[n].lastSample.originalDts&&t<e[n+1].originalBeginDts){o=n;break}e[n].originalBeginDts<t?i=n+1:a=n-1}return o},t.prototype._searchNearestSegmentAfter=function(t){return this._searchNearestSegmentBefore(t)+1},t.prototype.append=function(t){var e=this._list,r=t,n=this._lastAppendLocation,i=0;-1!==n&&n<e.length&&r.originalBeginDts>=e[n].lastSample.originalDts&&(n===e.length-1||n<e.length-1&&r.originalBeginDts<e[n+1].originalBeginDts)?i=n+1:e.length>0&&(i=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=i,this._list.splice(i,0,r)},t.prototype.getLastSegmentBefore=function(t){var e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null},t.prototype.getLastSampleBefore=function(t){var e=this.getLastSegmentBefore(t);return null!=e?e.lastSample:null},t.prototype.getLastSyncPointBefore=function(t){for(var e=this._searchNearestSegmentBefore(t),r=this._list[e].syncPoints;0===r.length&&e>0;)e--,r=this._list[e].syncPoints;return r.length>0?r[r.length-1]:null},t}()},"./src/core/mse-controller.js":
/*!************************************!*\
	  !*** ./src/core/mse-controller.js ***!
	  \************************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),o=r(/*! ../utils/browser.js */"./src/utils/browser.js"),s=r(/*! ./mse-events.js */"./src/core/mse-events.js"),u=r(/*! ./media-segment-info.js */"./src/core/media-segment-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),c=function(){function t(t){this.TAG="MSEController",this._config=t,this._emitter=new(i()),this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new u.IDRSampleList}return t.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new l.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},t.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var r=this._pendingSegments[e];r.splice(0,r.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var n=this._sourceBuffers[e];if(n){if("closed"!==t.readyState){try{t.removeSourceBuffer(n)}catch(t){a.default.e(this.TAG,t.message)}n.removeEventListener("error",this.e.onSourceBufferError),n.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if("open"===t.readyState)try{t.endOfStream()}catch(t){a.default.e(this.TAG,t.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},t.prototype.appendInitSegment=function(t,e){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(t),void this._pendingSegments[t.type].push(t);var r=t,n=""+r.container;r.codec&&r.codec.length>0&&(n+=";codecs="+r.codec);var i=!1;if(a.default.v(this.TAG,"Received Initialization Segment, mimeType: "+n),this._lastInitSegments[r.type]=r,n!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])a.default.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+n);else{i=!0;try{var u=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(n);u.addEventListener("error",this.e.onSourceBufferError),u.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(t){return a.default.e(this.TAG,t.message),void this._emitter.emit(s.default.ERROR,{code:t.code,msg:t.message})}}this._mimeTypes[r.type]=n}e||this._pendingSegments[r.type].push(r),i||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),o.default.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())},t.prototype.appendMediaSegment=function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[e.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},t.prototype.seek=function(t){for(var e in this._sourceBuffers)if(this._sourceBuffers[e]){var r=this._sourceBuffers[e];if("open"===this._mediaSource.readyState)try{r.abort()}catch(t){a.default.e(this.TAG,t.message)}this._idrList.clear();var n=this._pendingSegments[e];if(n.splice(0,n.length),"closed"!==this._mediaSource.readyState){for(var i=0;i<r.buffered.length;i++){var s=r.buffered.start(i),u=r.buffered.end(i);this._pendingRemoveRanges[e].push({start:s,end:u})}if(r.updating||this._doRemoveRanges(),o.default.safari){var l=this._lastInitSegments[e];l&&(this._pendingSegments[e].push(l),r.updating||this._doAppendSegments())}}}},t.prototype.endOfStream=function(){var t=this._mediaSource,e=this._sourceBuffers;t&&"open"===t.readyState?e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream()):t&&"closed"===t.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},t.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},t.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var r=this._sourceBuffers[e];if(r){var n=r.buffered;if(n.length>=1&&t-n.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},t.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var r=this._sourceBuffers[e];if(r){for(var n=r.buffered,i=!1,a=0;a<n.length;a++){var o=n.start(a),s=n.end(a);o<=t&&t<s+3?t-o>=this._config.autoCleanupMaxBackwardDuration&&(i=!0,this._pendingRemoveRanges[e].push({start:o,end:t-this._config.autoCleanupMinBackwardDuration})):s<t&&(i=!0,this._pendingRemoveRanges[e].push({start:o,end:s}))}i&&!r.updating&&this._doRemoveRanges()}}},t.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(e)||r>e)&&(a.default.v(this.TAG,"Update MediaSource duration from "+e+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},t.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating)for(var e=this._sourceBuffers[t],r=this._pendingRemoveRanges[t];r.length&&!e.updating;){var n=r.shift();e.remove(n.start,n.end)}},t.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var e in t)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating&&t[e].length>0){var r=t[e].shift();if(r.timestampOffset){var n=this._sourceBuffers[e].timestampOffset,i=r.timestampOffset/1e3;Math.abs(n-i)>.1&&(a.default.v(this.TAG,"Update MPEG audio timestampOffset from "+n+" to "+i),this._sourceBuffers[e].timestampOffset=i),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[e].appendBuffer(r.data),this._isBufferFull=!1,"video"===e&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(t){this._pendingSegments[e].unshift(r),22===t.code?(this._isBufferFull||this._emitter.emit(s.default.BUFFER_FULL),this._isBufferFull=!0):(a.default.e(this.TAG,t.message),this._emitter.emit(s.default.ERROR,{code:t.code,msg:t.message}))}}},t.prototype._onSourceOpen=function(){if(a.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(s.default.SOURCE_OPEN)},t.prototype._onSourceEnded=function(){a.default.v(this.TAG,"MediaSource onSourceEnded")},t.prototype._onSourceClose=function(){a.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},t.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},t.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},t.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(s.default.UPDATE_END)},t.prototype._onSourceBufferError=function(t){a.default.e(this.TAG,"SourceBuffer Error: "+t)},t}();e.default=c},"./src/core/mse-events.js":
/*!********************************!*\
	  !*** ./src/core/mse-events.js ***!
	  \********************************/function(t,e,r){r.r(e),e.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},"./src/core/transmuxer.js":
/*!********************************!*\
	  !*** ./src/core/transmuxer.js ***!
	  \********************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),o=r.n(a),s=r(/*! ../utils/logger.js */"./src/utils/logger.js"),u=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),l=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),c=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),h=r(/*! ./media-info.js */"./src/core/media-info.js"),f=function(){function t(t,e){if(this.TAG="Transmuxer",this._emitter=new(i()),e.enableWorker&&"undefined"!=typeof Worker)try{this._worker=o()(/*! ./transmuxing-worker */"./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[t,e]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},u.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:u.default.getConfig()})}catch(r){s.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new l.default(t,e)}else this._controller=new l.default(t,e);if(this._controller){var r=this._controller;r.on(c.default.IO_ERROR,this._onIOError.bind(this)),r.on(c.default.DEMUX_ERROR,this._onDemuxError.bind(this)),r.on(c.default.INIT_SEGMENT,this._onInitSegment.bind(this)),r.on(c.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),r.on(c.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),r.on(c.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),r.on(c.default.MEDIA_INFO,this._onMediaInfo.bind(this)),r.on(c.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),r.on(c.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),r.on(c.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),r.on(c.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return t.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),u.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.hasWorker=function(){return null!=this._worker},t.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},t.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},t.prototype.seek=function(t){this._worker?this._worker.postMessage({cmd:"seek",param:t}):this._controller.seek(t)},t.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},t.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},t.prototype._onInitSegment=function(t,e){var r=this;Promise.resolve().then((function(){r._emitter.emit(c.default.INIT_SEGMENT,t,e)}))},t.prototype._onMediaSegment=function(t,e){var r=this;Promise.resolve().then((function(){r._emitter.emit(c.default.MEDIA_SEGMENT,t,e)}))},t.prototype._onLoadingComplete=function(){var t=this;Promise.resolve().then((function(){t._emitter.emit(c.default.LOADING_COMPLETE)}))},t.prototype._onRecoveredEarlyEof=function(){var t=this;Promise.resolve().then((function(){t._emitter.emit(c.default.RECOVERED_EARLY_EOF)}))},t.prototype._onMediaInfo=function(t){var e=this;Promise.resolve().then((function(){e._emitter.emit(c.default.MEDIA_INFO,t)}))},t.prototype._onMetaDataArrived=function(t){var e=this;Promise.resolve().then((function(){e._emitter.emit(c.default.METADATA_ARRIVED,t)}))},t.prototype._onScriptDataArrived=function(t){var e=this;Promise.resolve().then((function(){e._emitter.emit(c.default.SCRIPTDATA_ARRIVED,t)}))},t.prototype._onStatisticsInfo=function(t){var e=this;Promise.resolve().then((function(){e._emitter.emit(c.default.STATISTICS_INFO,t)}))},t.prototype._onIOError=function(t,e){var r=this;Promise.resolve().then((function(){r._emitter.emit(c.default.IO_ERROR,t,e)}))},t.prototype._onDemuxError=function(t,e){var r=this;Promise.resolve().then((function(){r._emitter.emit(c.default.DEMUX_ERROR,t,e)}))},t.prototype._onRecommendSeekpoint=function(t){var e=this;Promise.resolve().then((function(){e._emitter.emit(c.default.RECOMMEND_SEEKPOINT,t)}))},t.prototype._onLoggingConfigChanged=function(t){this._worker&&this._worker.postMessage({cmd:"logging_config",param:t})},t.prototype._onWorkerMessage=function(t){var e=t.data,r=e.data;if("destroyed"===e.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(e.msg){case c.default.INIT_SEGMENT:case c.default.MEDIA_SEGMENT:this._emitter.emit(e.msg,r.type,r.data);break;case c.default.LOADING_COMPLETE:case c.default.RECOVERED_EARLY_EOF:this._emitter.emit(e.msg);break;case c.default.MEDIA_INFO:Object.setPrototypeOf(r,h.default.prototype),this._emitter.emit(e.msg,r);break;case c.default.METADATA_ARRIVED:case c.default.SCRIPTDATA_ARRIVED:case c.default.STATISTICS_INFO:this._emitter.emit(e.msg,r);break;case c.default.IO_ERROR:case c.default.DEMUX_ERROR:this._emitter.emit(e.msg,r.type,r.info);break;case c.default.RECOMMEND_SEEKPOINT:this._emitter.emit(e.msg,r);break;case"logcat_callback":s.default.emitter.emit("log",r.type,r.logcat)}},t}();e.default=f},"./src/core/transmuxing-controller.js":
/*!********************************************!*\
	  !*** ./src/core/transmuxing-controller.js ***!
	  \********************************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),o=r(/*! ../utils/browser.js */"./src/utils/browser.js"),s=r(/*! ./media-info.js */"./src/core/media-info.js"),u=r(/*! ../demux/flv-demuxer.js */"./src/demux/flv-demuxer.js"),l=r(/*! ../remux/mp4-remuxer.js */"./src/remux/mp4-remuxer.js"),c=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),h=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),f=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),d=function(){function t(t,e){this.TAG="TransmuxingController",this._emitter=new(i()),this._config=e,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(n){n.timestampBase=r,r+=n.duration,n.cors=t.cors,n.withCredentials=t.withCredentials,e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return t.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},t.prototype._loadSegment=function(t,e){this._currentSegmentIndex=t;var r=this._ioctl=new h.default(this._mediaDataSource.segments[t],this._config,t);r.onError=this._onIOException.bind(this),r.onSeeked=this._onIOSeeked.bind(this),r.onComplete=this._onIOComplete.bind(this),r.onRedirect=this._onIORedirect.bind(this),r.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),e?this._demuxer.bindDataSource(this._ioctl):r.onDataArrival=this._onInitChunkArrival.bind(this),r.open(e)},t.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},t.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},t.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},t.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},t.prototype.seek=function(t){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var e=this._searchSegmentIndexContains(t);if(e===this._currentSegmentIndex){var r=this._mediaInfo.segments[e];if(null==r)this._pendingSeekTime=t;else{var n=r.getNearestKeyframe(t);this._remuxer.seek(n.milliseconds),this._ioctl.seek(n.fileposition),this._pendingResolveSeekPoint=n.milliseconds}}else{var i=this._mediaInfo.segments[e];null==i?(this._pendingSeekTime=t,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(e)):(n=i.getNearestKeyframe(t),this._internalAbort(),this._remuxer.seek(t),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[e].timestampBase,this._loadSegment(e,n.fileposition),this._pendingResolveSeekPoint=n.milliseconds,this._reportSegmentMediaInfo(e))}this._enableStatisticsReporter()}},t.prototype._searchSegmentIndexContains=function(t){for(var e=this._mediaDataSource.segments,r=e.length-1,n=0;n<e.length;n++)if(t<e[n].timestampBase){r=n-1;break}return r},t.prototype._onInitChunkArrival=function(t,e){var r=this,n=null,i=0;if(e>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,i=this._demuxer.parseChunks(t,e);else if((n=u.default.probe(t)).match){this._demuxer=new u.default(n,this._config),this._remuxer||(this._remuxer=new l.default(this._config));var o=this._mediaDataSource;null==o.duration||isNaN(o.duration)||(this._demuxer.overridedDuration=o.duration),"boolean"==typeof o.hasAudio&&(this._demuxer.overridedHasAudio=o.hasAudio),"boolean"==typeof o.hasVideo&&(this._demuxer.overridedHasVideo=o.hasVideo),this._demuxer.timestampBase=o.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),i=this._demuxer.parseChunks(t,e)}else n=null,a.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then((function(){r._internalAbort()})),this._emitter.emit(f.default.DEMUX_ERROR,c.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),i=0;return i},t.prototype._onMediaInfo=function(t){var e=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},t),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,s.default.prototype));var r=Object.assign({},t);Object.setPrototypeOf(r,s.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var t=e._pendingSeekTime;e._pendingSeekTime=null,e.seek(t)}))},t.prototype._onMetaDataArrived=function(t){this._emitter.emit(f.default.METADATA_ARRIVED,t)},t.prototype._onScriptDataArrived=function(t){this._emitter.emit(f.default.SCRIPTDATA_ARRIVED,t)},t.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},t.prototype._onIOComplete=function(t){var e=t+1;e<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(e)):(this._remuxer.flushStashedSamples(),this._emitter.emit(f.default.LOADING_COMPLETE),this._disableStatisticsReporter())},t.prototype._onIORedirect=function(t){this._mediaDataSource.segments[this._ioctl.extraData].redirectedURL=t},t.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(f.default.RECOVERED_EARLY_EOF)},t.prototype._onIOException=function(t,e){a.default.e(this.TAG,"IOException: type = "+t+", code = "+e.code+", msg = "+e.msg),this._emitter.emit(f.default.IO_ERROR,t,e),this._disableStatisticsReporter()},t.prototype._onDemuxException=function(t,e){a.default.e(this.TAG,"DemuxException: type = "+t+", info = "+e),this._emitter.emit(f.default.DEMUX_ERROR,t,e)},t.prototype._onRemuxerInitSegmentArrival=function(t,e){this._emitter.emit(f.default.INIT_SEGMENT,t,e)},t.prototype._onRemuxerMediaSegmentArrival=function(t,e){if(null==this._pendingSeekTime&&(this._emitter.emit(f.default.MEDIA_SEGMENT,t,e),null!=this._pendingResolveSeekPoint&&"video"===t)){var r=e.info.syncPoints,n=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,o.default.safari&&r.length>0&&r[0].originalDts===n&&(n=r[0].pts),this._emitter.emit(f.default.RECOMMEND_SEEKPOINT,n)}},t.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},t.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype._reportSegmentMediaInfo=function(t){var e=Object.assign({},this._mediaInfo.segments[t]);e.duration=this._mediaInfo.duration,e.segmentCount=this._mediaInfo.segmentCount,delete e.segments,delete e.keyframesIndex,this._emitter.emit(f.default.MEDIA_INFO,e)},t.prototype._reportStatisticsInfo=function(){var t={};t.url=this._ioctl.currentURL,t.hasRedirect=this._ioctl.hasRedirect,t.hasRedirect&&(t.redirectedURL=this._ioctl.currentRedirectedURL),t.speed=this._ioctl.currentSpeed,t.loaderType=this._ioctl.loaderType,t.currentSegmentIndex=this._currentSegmentIndex,t.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(f.default.STATISTICS_INFO,t)},t}();e.default=d},"./src/core/transmuxing-events.js":
/*!****************************************!*\
	  !*** ./src/core/transmuxing-events.js ***!
	  \****************************************/function(t,e,r){r.r(e),e.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},"./src/core/transmuxing-worker.js":
/*!****************************************!*\
	  !*** ./src/core/transmuxing-worker.js ***!
	  \****************************************/function(t,e,r){r.r(e);var n=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),i=r(/*! ../utils/polyfill.js */"./src/utils/polyfill.js"),a=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),o=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");e.default=function(t){var e=null,r=function(e,r){t.postMessage({msg:"logcat_callback",data:{type:e,logcat:r}})}.bind(this);function s(e,r){t.postMessage({msg:o.default.INIT_SEGMENT,data:{type:e,data:r}},[r.data])}function u(e,r){t.postMessage({msg:o.default.MEDIA_SEGMENT,data:{type:e,data:r}},[r.data])}function l(){t.postMessage({msg:o.default.LOADING_COMPLETE})}function c(){t.postMessage({msg:o.default.RECOVERED_EARLY_EOF})}function h(e){t.postMessage({msg:o.default.MEDIA_INFO,data:e})}function f(e){t.postMessage({msg:o.default.METADATA_ARRIVED,data:e})}function d(e){t.postMessage({msg:o.default.SCRIPTDATA_ARRIVED,data:e})}function p(e){t.postMessage({msg:o.default.STATISTICS_INFO,data:e})}function m(e,r){t.postMessage({msg:o.default.IO_ERROR,data:{type:e,info:r}})}function v(e,r){t.postMessage({msg:o.default.DEMUX_ERROR,data:{type:e,info:r}})}function g(e){t.postMessage({msg:o.default.RECOMMEND_SEEKPOINT,data:e})}i.default.install(),t.addEventListener("message",(function(i){switch(i.data.cmd){case"init":(e=new a.default(i.data.param[0],i.data.param[1])).on(o.default.IO_ERROR,m.bind(this)),e.on(o.default.DEMUX_ERROR,v.bind(this)),e.on(o.default.INIT_SEGMENT,s.bind(this)),e.on(o.default.MEDIA_SEGMENT,u.bind(this)),e.on(o.default.LOADING_COMPLETE,l.bind(this)),e.on(o.default.RECOVERED_EARLY_EOF,c.bind(this)),e.on(o.default.MEDIA_INFO,h.bind(this)),e.on(o.default.METADATA_ARRIVED,f.bind(this)),e.on(o.default.SCRIPTDATA_ARRIVED,d.bind(this)),e.on(o.default.STATISTICS_INFO,p.bind(this)),e.on(o.default.RECOMMEND_SEEKPOINT,g.bind(this));break;case"destroy":e&&(e.destroy(),e=null),t.postMessage({msg:"destroyed"});break;case"start":e.start();break;case"stop":e.stop();break;case"seek":e.seek(i.data.param);break;case"pause":e.pause();break;case"resume":e.resume();break;case"logging_config":var y=i.data.param;n.default.applyConfig(y),!0===y.enableCallback?n.default.addLogListener(r):n.default.removeLogListener(r)}}))}},"./src/demux/amf-parser.js":
/*!*********************************!*\
	  !*** ./src/demux/amf-parser.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ../utils/utf8-conv.js */"./src/utils/utf8-conv.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),s=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256===new Int16Array(n)[0]),u=function(){function t(){}return t.parseScriptData=function(e,r,n){var a={};try{var o=t.parseValue(e,r,n),s=t.parseValue(e,r+o.size,n-o.size);a[o.data]=s.data}catch(t){i.default.e("AMF",t.toString())}return a},t.parseObject=function(e,r,n){if(n<3)throw new o.IllegalStateException("Data not enough when parse ScriptDataObject");var i=t.parseString(e,r,n),a=t.parseValue(e,r+i.size,n-i.size);return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:a.objectEnd}},t.parseVariable=function(e,r,n){return t.parseObject(e,r,n)},t.parseString=function(t,e,r){if(r<2)throw new o.IllegalStateException("Data not enough when parse String");var n=new DataView(t,e,r).getUint16(0,!s);return{data:n>0?(0,a.default)(new Uint8Array(t,e+2,n)):"",size:2+n}},t.parseLongString=function(t,e,r){if(r<4)throw new o.IllegalStateException("Data not enough when parse LongString");var n=new DataView(t,e,r).getUint32(0,!s);return{data:n>0?(0,a.default)(new Uint8Array(t,e+4,n)):"",size:4+n}},t.parseDate=function(t,e,r){if(r<10)throw new o.IllegalStateException("Data size invalid when parse Date");var n=new DataView(t,e,r),i=n.getFloat64(0,!s),a=n.getInt16(8,!s);return{data:new Date(i+=60*a*1e3),size:10}},t.parseValue=function(e,r,n){if(n<1)throw new o.IllegalStateException("Data not enough when parse Value");var a,u=new DataView(e,r,n),l=1,c=u.getUint8(0),h=!1;try{switch(c){case 0:a=u.getFloat64(1,!s),l+=8;break;case 1:a=!!u.getUint8(1),l+=1;break;case 2:var f=t.parseString(e,r+1,n-1);a=f.data,l+=f.size;break;case 3:a={};var d=0;for(9==(16777215&u.getUint32(n-4,!s))&&(d=3);l<n-4;){var p=t.parseObject(e,r+l,n-l-d);if(p.objectEnd)break;a[p.data.name]=p.data.value,l+=p.size}l<=n-3&&9==(16777215&u.getUint32(l-1,!s))&&(l+=3);break;case 8:for(a={},l+=4,d=0,9==(16777215&u.getUint32(n-4,!s))&&(d=3);l<n-8;){var m=t.parseVariable(e,r+l,n-l-d);if(m.objectEnd)break;a[m.data.name]=m.data.value,l+=m.size}l<=n-3&&9==(16777215&u.getUint32(l-1,!s))&&(l+=3);break;case 9:a=void 0,l=1,h=!0;break;case 10:a=[];var v=u.getUint32(1,!s);l+=4;for(var g=0;g<v;g++){var y=t.parseValue(e,r+l,n-l);a.push(y.data),l+=y.size}break;case 11:var _=t.parseDate(e,r+1,n-1);a=_.data,l+=_.size;break;case 12:var b=t.parseString(e,r+1,n-1);a=b.data,l+=b.size;break;default:l=n,i.default.w("AMF","Unsupported AMF value type "+c)}}catch(t){i.default.e("AMF",t.toString())}return{data:a,size:l,objectEnd:h}},t}();e.default=u},"./src/demux/demux-errors.js":
/*!***********************************!*\
	  !*** ./src/demux/demux-errors.js ***!
	  \***********************************/function(t,e,r){r.r(e),e.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},"./src/demux/exp-golomb.js":
/*!*********************************!*\
	  !*** ./src/demux/exp-golomb.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n=r(/*! ../utils/exception.js */"./src/utils/exception.js"),i=function(){function t(t){this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return t.prototype.destroy=function(){this._buffer=null},t.prototype._fillCurrentWord=function(){var t=this._total_bytes-this._buffer_index;if(t<=0)throw new n.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var e=Math.min(4,t),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+e)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=e,this._current_word_bits_left=8*e},t.prototype.readBits=function(t){if(t>32)throw new n.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(t<=this._current_word_bits_left){var e=this._current_word>>>32-t;return this._current_word<<=t,this._current_word_bits_left-=t,e}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var i=t-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(i,this._current_word_bits_left),o=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,r<<a|o},t.prototype.readBool=function(){return 1===this.readBits(1)},t.prototype.readByte=function(){return this.readBits(8)},t.prototype._skipLeadingZero=function(){var t;for(t=0;t<this._current_word_bits_left;t++)if(0!=(this._current_word&2147483648>>>t))return this._current_word<<=t,this._current_word_bits_left-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()},t.prototype.readUEG=function(){var t=this._skipLeadingZero();return this.readBits(t+1)-1},t.prototype.readSEG=function(){var t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)},t}();e.default=i},"./src/demux/flv-demuxer.js":
/*!**********************************!*\
	  !*** ./src/demux/flv-demuxer.js ***!
	  \**********************************/function(t,e,r){r.r(e);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./amf-parser.js */"./src/demux/amf-parser.js"),a=r(/*! ./sps-parser.js */"./src/demux/sps-parser.js"),o=r(/*! ./demux-errors.js */"./src/demux/demux-errors.js"),s=r(/*! ../core/media-info.js */"./src/core/media-info.js"),u=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=function(){function t(t,e){var r;this.TAG="FLVDemuxer",this._config=e,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new s.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0])}return t.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},t.probe=function(t){var e=new Uint8Array(t),r={match:!1};if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])return r;var n,i=(n=e)[5]<<24|n[6]<<16|n[7]<<8|n[8];return i<9?r:{match:!0,consumed:i,dataOffset:i,hasAudioTrack:(4&e[4])>>>2!=0,hasVideoTrack:0!=(1&e[4])}},t.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(t.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),t.prototype.resetMediaInfo=function(){this._mediaInfo=new s.default},t.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},t.prototype.parseChunks=function(e,r){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new u.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,a=this._littleEndian;if(0===r){if(!(e.byteLength>13))return 0;i=t.probe(e).dataOffset}for(this._firstParse&&(this._firstParse=!1,r+i!==this._dataOffset&&n.default.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(o=new DataView(e,i)).getUint32(0,!a)&&n.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4);i<e.byteLength;){this._dispatch=!0;var o=new DataView(e,i);if(i+11+4>e.byteLength)break;var s=o.getUint8(0),l=16777215&o.getUint32(0,!a);if(i+11+l+4>e.byteLength)break;if(8===s||9===s||18===s){var c=o.getUint8(4),h=o.getUint8(5),f=o.getUint8(6)|h<<8|c<<16|o.getUint8(7)<<24;0!=(16777215&o.getUint32(7,!a))&&n.default.w(this.TAG,"Meet tag which has StreamID != 0!");var d=i+11;switch(s){case 8:this._parseAudioData(e,d,l,f);break;case 9:this._parseVideoData(e,d,l,f,r+i);break;case 18:this._parseScriptData(e,d,l)}var p=o.getUint32(11+l,!a);p!==11+l&&n.default.w(this.TAG,"Invalid PrevTagSize "+p),i+=11+l+4}else n.default.w(this.TAG,"Unsupported tag type "+s+", skipped"),i+=11+l+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i},t.prototype._parseScriptData=function(t,e,r){var a=i.default.parseScriptData(t,e,r);if(a.hasOwnProperty("onMetaData")){if(null==a.onMetaData||"object"!=typeof a.onMetaData)return void n.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&n.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=a;var o=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},o)),"boolean"==typeof o.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=o.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof o.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=o.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof o.audiodatarate&&(this._mediaInfo.audioDataRate=o.audiodatarate),"number"==typeof o.videodatarate&&(this._mediaInfo.videoDataRate=o.videodatarate),"number"==typeof o.width&&(this._mediaInfo.width=o.width),"number"==typeof o.height&&(this._mediaInfo.height=o.height),"number"==typeof o.duration){if(!this._durationOverrided){var s=Math.floor(o.duration*this._timescale);this._duration=s,this._mediaInfo.duration=s}}else this._mediaInfo.duration=0;if("number"==typeof o.framerate){var u=Math.floor(1e3*o.framerate);if(u>0){var l=u/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=l,this._referenceFrameRate.fps_num=u,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=l}}"object"==typeof o.keyframes?(this._mediaInfo.hasKeyframesIndex=!0,this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(o.keyframes),o.keyframes=null):this._mediaInfo.hasKeyframesIndex=!1,this._dispatch=!1,this._mediaInfo.metadata=o,n.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(a).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},a))},t.prototype._parseKeyframesIndex=function(t){for(var e=[],r=[],n=1;n<t.times.length;n++){var i=this._timestampBase+Math.floor(1e3*t.times[n]);e.push(i),r.push(t.filepositions[n])}return{times:e,filepositions:r}},t.prototype._parseAudioData=function(t,e,r,i){if(r<=1)n.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var a=new DataView(t,e,r).getUint8(0),s=a>>>4;if(2===s||10===s){var u=0,l=(12&a)>>>2;if(l>=0&&l<=4){u=this._flvSoundRateTable[l];var c=1&a,h=this._audioMetadata,f=this._audioTrack;if(h||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(h=this._audioMetadata={}).type="audio",h.id=f.id,h.timescale=this._timescale,h.duration=this._duration,h.audioSampleRate=u,h.channelCount=0===c?1:2),10===s){var d=this._parseAACAudioData(t,e+1,r-1);if(null==d)return;0===d.packetType?(h.config&&n.default.w(this.TAG,"Found another AudioSpecificConfig!"),h.audioSampleRate=(p=d.data).samplingRate,h.channelCount=p.channelCount,h.codec=p.codec,h.originalCodec=p.originalCodec,h.config=p.config,h.refSampleDuration=1024/h.audioSampleRate*h.timescale,n.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",h),(m=this._mediaInfo).audioCodec=h.originalCodec,m.audioSampleRate=h.audioSampleRate,m.audioChannelCount=h.channelCount,m.hasVideo?null!=m.videoCodec&&(m.mimeType='video/x-flv; codecs="'+m.videoCodec+","+m.audioCodec+'"'):m.mimeType='video/x-flv; codecs="'+m.audioCodec+'"',m.isComplete()&&this._onMediaInfo(m)):1===d.packetType?(f.samples.push({unit:d.data,length:d.data.byteLength,dts:v=this._timestampBase+i,pts:v}),f.length+=d.data.length):n.default.e(this.TAG,"Flv: Unsupported AAC data type "+d.packetType)}else if(2===s){if(!h.codec){var p,m;if(null==(p=this._parseMP3AudioData(t,e+1,r-1,!0)))return;h.audioSampleRate=p.samplingRate,h.channelCount=p.channelCount,h.codec=p.codec,h.originalCodec=p.originalCodec,h.refSampleDuration=1152/h.audioSampleRate*h.timescale,n.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",h),(m=this._mediaInfo).audioCodec=h.codec,m.audioSampleRate=h.audioSampleRate,m.audioChannelCount=h.channelCount,m.audioDataRate=p.bitRate,m.hasVideo?null!=m.videoCodec&&(m.mimeType='video/x-flv; codecs="'+m.videoCodec+","+m.audioCodec+'"'):m.mimeType='video/x-flv; codecs="'+m.audioCodec+'"',m.isComplete()&&this._onMediaInfo(m)}var v,g=this._parseMP3AudioData(t,e+1,r-1,!1);if(null==g)return;f.samples.push({unit:g,length:g.byteLength,dts:v=this._timestampBase+i,pts:v}),f.length+=g.length}}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l)}else this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s)}},t.prototype._parseAACAudioData=function(t,e,r){if(!(r<=1)){var i={},a=new Uint8Array(t,e,r);return i.packetType=a[0],i.data=0===a[0]?this._parseAACAudioSpecificConfig(t,e+1,r-1):a.subarray(1),i}n.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},t.prototype._parseAACAudioSpecificConfig=function(t,e,r){var n,i,a=new Uint8Array(t,e,r),s=null,u=0,l=null;if(u=n=a[0]>>>3,(i=(7&a[0])<<1|a[1]>>>7)<0||i>=this._mpegSamplingRates.length)this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var c=this._mpegSamplingRates[i],h=(120&a[1])>>>3;if(!(h<0||h>=8)){5===u&&(l=(7&a[1])<<1|a[2]>>>7);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?i>=6?(u=5,s=new Array(4),l=i-3):(u=2,s=new Array(2),l=i):-1!==f.indexOf("android")?(u=2,s=new Array(2),l=i):(u=5,l=i,s=new Array(4),i>=6?l=i-3:1===h&&(u=2,s=new Array(2),l=i)),s[0]=u<<3,s[0]|=(15&i)>>>1,s[1]=(15&i)<<7,s[1]|=(15&h)<<3,5===u&&(s[1]|=(15&l)>>>1,s[2]=(1&l)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:c,channelCount:h,codec:"mp4a.40."+u,originalCodec:"mp4a.40."+n}}this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},t.prototype._parseMP3AudioData=function(t,e,r,i){if(!(r<4)){var a=new Uint8Array(t,e,r),o=null;if(i){if(255!==a[0])return;var s=(6&a[1])>>1,u=(240&a[2])>>>4,l=(12&a[2])>>>2,c=3!=(a[3]>>>6&3)?2:1,h=0,f=0;switch(a[1]>>>3&3){case 0:h=this._mpegAudioV25SampleRateTable[l];break;case 2:h=this._mpegAudioV20SampleRateTable[l];break;case 3:h=this._mpegAudioV10SampleRateTable[l]}switch(s){case 1:u<this._mpegAudioL3BitRateTable.length&&(f=this._mpegAudioL3BitRateTable[u]);break;case 2:u<this._mpegAudioL2BitRateTable.length&&(f=this._mpegAudioL2BitRateTable[u]);break;case 3:u<this._mpegAudioL1BitRateTable.length&&(f=this._mpegAudioL1BitRateTable[u])}o={bitRate:f,samplingRate:h,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else o=a;return o}n.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},t.prototype._parseVideoData=function(t,e,r,i,a){if(r<=1)n.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(t,e,r)[0],u=15&s;7===u?this._parseAVCVideoPacket(t,e+1,r-1,i,a,(240&s)>>>4):this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+u)}},t.prototype._parseAVCVideoPacket=function(t,e,r,i,a,s){if(r<4)n.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var u=this._littleEndian,l=new DataView(t,e,r),c=l.getUint8(0),h=(16777215&l.getUint32(0,!u))<<8>>8;if(0===c)this._parseAVCDecoderConfigurationRecord(t,e+4,r-4);else if(1===c)this._parseAVCVideoData(t,e+4,r-4,i,a,s,h);else if(2!==c)return void this._onError(o.default.FORMAT_ERROR,"Flv: Invalid video packet type "+c)}},t.prototype._parseAVCDecoderConfigurationRecord=function(t,e,r){if(r<7)n.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,s=this._videoTrack,u=this._littleEndian,l=new DataView(t,e,r);i?void 0!==i.avcc&&n.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=s.id,i.timescale=this._timescale,i.duration=this._duration);var c=l.getUint8(0),h=l.getUint8(1);if(l.getUint8(2),l.getUint8(3),1===c&&0!==h)if(this._naluLengthSize=1+(3&l.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var f=31&l.getUint8(5);if(0!==f){f>1&&n.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+f);for(var d=6,p=0;p<f;p++){var m=l.getUint16(d,!u);if(d+=2,0!==m){var v=new Uint8Array(t,e+d,m);d+=m;var g=a.default.parseSPS(v);if(0===p){i.codecWidth=g.codec_size.width,i.codecHeight=g.codec_size.height,i.presentWidth=g.present_size.width,i.presentHeight=g.present_size.height,i.profile=g.profile_string,i.level=g.level_string,i.bitDepth=g.bit_depth,i.chromaFormat=g.chroma_format,i.sarRatio=g.sar_ratio,i.frameRate=g.frame_rate,!1!==g.frame_rate.fixed&&0!==g.frame_rate.fps_num&&0!==g.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate),i.refSampleDuration=i.timescale*(i.frameRate.fps_den/i.frameRate.fps_num);for(var y=v.subarray(1,4),_="avc1.",b=0;b<3;b++){var x=y[b].toString(16);x.length<2&&(x="0"+x),_+=x}i.codec=_;var w=this._mediaInfo;w.width=i.codecWidth,w.height=i.codecHeight,w.fps=i.frameRate.fps,w.profile=i.profile,w.level=i.level,w.refFrames=g.ref_frames,w.chromaFormat=g.chroma_format_string,w.sarNum=i.sarRatio.width,w.sarDen=i.sarRatio.height,w.videoCodec=_,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this._onMediaInfo(w)}}}var M=l.getUint8(d);if(0!==M){for(M>1&&n.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+M),d++,p=0;p<M;p++)m=l.getUint16(d,!u),d+=2,0!==m&&(d+=m);i.avcc=new Uint8Array(r),i.avcc.set(new Uint8Array(t,e,r),0),n.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(o.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},t.prototype._parseAVCVideoData=function(t,e,r,i,a,o,s){for(var u=this._littleEndian,l=new DataView(t,e,r),c=[],h=0,f=0,d=this._naluLengthSize,p=this._timestampBase+i,m=1===o;f<r;){if(f+4>=r){n.default.w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+f+", dataSize = "+r);break}var v=l.getUint32(f,!u);if(3===d&&(v>>>=8),v>r-d)return void n.default.w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var g=31&l.getUint8(f+d);5===g&&(m=!0);var y=new Uint8Array(t,e+f,d+v);c.push({type:g,data:y}),h+=y.byteLength,f+=d+v}if(c.length){var _=this._videoTrack,b={units:c,length:h,isKeyframe:m,dts:p,cts:s,pts:p+s};m&&(b.fileposition=a),_.samples.push(b),_.length+=h}},t}();e.default=l},"./src/demux/sps-parser.js":
/*!*********************************!*\
	  !*** ./src/demux/sps-parser.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n=r(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js"),i=function(){function t(){}return t._ebsp2rbsp=function(t){for(var e=t,r=e.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===e[a]&&0===e[a-1]&&0===e[a-2]||(n[i]=e[a],i++);return new Uint8Array(n.buffer,0,i)},t.parseSPS=function(e){var r=t._ebsp2rbsp(e),i=new n.default(r);i.readByte();var a=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var s=t.getProfileString(a),u=t.getLevelString(o),l=1,c=420,h=8;if((100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a||138===a||144===a)&&(3===(l=i.readUEG())&&i.readBits(1),l<=3&&(c=[0,420,422,444][l]),h=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==l?8:12,d=0;d<f;d++)i.readBool()&&t._skipScalingList(i,d<6?16:64);i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();var m=i.readUEG();for(d=0;d<m;d++)i.readSEG()}var v=i.readUEG();i.readBits(1);var g=i.readUEG(),y=i.readUEG(),_=i.readBits(1);0===_&&i.readBits(1),i.readBits(1);var b=0,x=0,w=0,M=0;i.readBool()&&(b=i.readUEG(),x=i.readUEG(),w=i.readUEG(),M=i.readUEG());var A=1,E=1,S=0,T=!0,C=0,O=0;if(i.readBool()){if(i.readBool()){var P=i.readByte();P>0&&P<16?(A=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][P-1],E=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][P-1]):255===P&&(A=i.readByte()<<8|i.readByte(),E=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var L=i.readBits(32),I=i.readBits(32);T=i.readBool(),S=(C=I)/(O=2*L)}}var k=1;1===A&&1===E||(k=A/E);var R=0,D=0;0===l?(R=1,D=2-_):(R=3===l?1:2,D=(1===l?2:1)*(2-_));var B=16*(g+1),F=16*(y+1)*(2-_);B-=(b+x)*R,F-=(w+M)*D;var j=Math.ceil(B*k);return i.destroy(),i=null,{profile_string:s,level_string:u,bit_depth:h,ref_frames:v,chroma_format:c,chroma_format_string:t.getChromaFormatString(c),frame_rate:{fixed:T,fps:S,fps_den:O,fps_num:C},sar_ratio:{width:A,height:E},codec_size:{width:B,height:F},present_size:{width:j,height:F}}},t._skipScalingList=function(t,e){for(var r=8,n=8,i=0;i<e;i++)0!==n&&(n=(r+t.readSEG()+256)%256),r=0===n?r:n},t.getProfileString=function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},t.getLevelString=function(t){return(t/10).toFixed(1)},t.getChromaFormatString=function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},t}();e.default=i},"./src/flv.js":
/*!********************!*\
	  !*** ./src/flv.js ***!
	  \********************/function(t,e,r){r.r(e);var n=r(/*! ./utils/polyfill.js */"./src/utils/polyfill.js"),i=r(/*! ./core/features.js */"./src/core/features.js"),a=r(/*! ./io/loader.js */"./src/io/loader.js"),o=r(/*! ./player/flv-player.js */"./src/player/flv-player.js"),s=r(/*! ./player/native-player.js */"./src/player/native-player.js"),u=r(/*! ./player/player-events.js */"./src/player/player-events.js"),l=r(/*! ./player/player-errors.js */"./src/player/player-errors.js"),c=r(/*! ./utils/logging-control.js */"./src/utils/logging-control.js"),h=r(/*! ./utils/exception.js */"./src/utils/exception.js");n.default.install();var f={createPlayer:function(t,e){var r=t;if(null==r||"object"!=typeof r)throw new h.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new h.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");return"flv"===r.type?new o.default(r,e):new s.default(r,e)},isSupported:function(){return i.default.supportMSEH264Playback()},getFeatureList:function(){return i.default.getFeatureList()}};f.BaseLoader=a.BaseLoader,f.LoaderStatus=a.LoaderStatus,f.LoaderErrors=a.LoaderErrors,f.Events=u.default,f.ErrorTypes=l.ErrorTypes,f.ErrorDetails=l.ErrorDetails,f.FlvPlayer=o.default,f.NativePlayer=s.default,f.LoggingControl=c.default,Object.defineProperty(f,"version",{enumerable:!0,get:function(){return"1.6.2"}}),e.default=f},"./src/index.js":
/*!**********************!*\
	  !*** ./src/index.js ***!
	  \**********************/function(t,e,r){t.exports=r(/*! ./flv.js */"./src/flv.js").default},"./src/io/fetch-stream-loader.js":
/*!***************************************!*\
	  !*** ./src/io/fetch-stream-loader.js ***!
	  \***************************************/function(t,e,r){r.r(e);var n,i=r(/*! ../utils/browser.js */"./src/utils/browser.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),s=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(t){function e(e,r){var n=t.call(this,"fetch-stream-loader")||this;return n.TAG="FetchStreamLoader",n._seekHandler=e,n._config=r,n._needStash=!0,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n}return s(e,t),e.isSupported=function(){try{return self.fetch&&self.ReadableStream&&(!i.default.msedge||i.default.msedge&&i.default.version.minor>=15048)}catch(t){return!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),t.prototype.destroy.call(this)},e.prototype.open=function(t,e){var r=this;this._dataSource=t,this._range=e;var n=t.url;this._config.reuseRedirectedURL&&null!=t.redirectedURL&&(n=t.redirectedURL);var i=this._seekHandler.getConfig(n,e),s=new self.Headers;if("object"==typeof i.headers){var u=i.headers;for(var l in u)u.hasOwnProperty(l)&&s.append(l,u[l])}var c={method:"GET",headers:s,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var l in this._config.headers)s.append(l,this._config.headers[l]);!1===t.cors&&(c.mode="same-origin"),t.withCredentials&&(c.credentials="include"),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,c.signal=this._abortController.signal),this._status=a.LoaderStatus.kConnecting,self.fetch(i.url,c).then((function(t){if(r._requestAbort)return r._status=a.LoaderStatus.kIdle,void t.body.cancel();if(t.ok&&t.status>=200&&t.status<=299){if(t.url!==i.url&&r._onURLRedirect){var e=r._seekHandler.removeURLParameters(t.url);r._onURLRedirect(e)}var n=t.headers.get("Content-Length");return null!=n&&(r._contentLength=parseInt(n),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,t.body.getReader())}if(r._status=a.LoaderStatus.kError,!r._onError)throw new o.RuntimeException("FetchStreamLoader: Http code invalid, "+t.status+" "+t.statusText);r._onError(a.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})})).catch((function(t){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=a.LoaderStatus.kError,!r._onError)throw t;r._onError(a.LoaderErrors.EXCEPTION,{code:-1,msg:t.message})}}))},e.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==a.LoaderStatus.kBuffering||!i.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(t){}},e.prototype._pump=function(t){var e=this;return t.read().then((function(r){if(r.done)if(null!==e._contentLength&&e._receivedLength<e._contentLength){e._status=a.LoaderStatus.kError;var n=a.LoaderErrors.EARLY_EOF,i={code:-1,msg:"Fetch stream meet Early-EOF"};if(!e._onError)throw new o.RuntimeException(i.msg);e._onError(n,i)}else e._status=a.LoaderStatus.kComplete,e._onComplete&&e._onComplete(e._range.from,e._range.from+e._receivedLength-1);else{if(e._abortController&&e._abortController.signal.aborted)return void(e._status=a.LoaderStatus.kComplete);if(!0===e._requestAbort)return e._status=a.LoaderStatus.kComplete,t.cancel();e._status=a.LoaderStatus.kBuffering;var s=r.value.buffer,u=e._range.from+e._receivedLength;e._receivedLength+=s.byteLength,e._onDataArrival&&e._onDataArrival(s,u,e._receivedLength),e._pump(t)}})).catch((function(t){if(e._abortController&&e._abortController.signal.aborted)e._status=a.LoaderStatus.kComplete;else if(11!==t.code||!i.default.msedge){e._status=a.LoaderStatus.kError;var r=0,n=null;if(19!==t.code&&"network error"!==t.message||!(null===e._contentLength||null!==e._contentLength&&e._receivedLength<e._contentLength)?(r=a.LoaderErrors.EXCEPTION,n={code:t.code,msg:t.message}):(r=a.LoaderErrors.EARLY_EOF,n={code:t.code,msg:"Fetch stream meet Early-EOF"}),!e._onError)throw new o.RuntimeException(n.msg);e._onError(r,n)}}))},e}(a.BaseLoader);e.default=u},"./src/io/io-controller.js":
/*!*********************************!*\
	  !*** ./src/io/io-controller.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ./fetch-stream-loader.js */"./src/io/fetch-stream-loader.js"),s=r(/*! ./xhr-moz-chunked-loader.js */"./src/io/xhr-moz-chunked-loader.js"),u=r(/*! ./xhr-range-loader.js */"./src/io/xhr-range-loader.js"),l=r(/*! ./websocket-loader.js */"./src/io/websocket-loader.js"),c=r(/*! ./range-seek-handler.js */"./src/io/range-seek-handler.js"),h=r(/*! ./param-seek-handler.js */"./src/io/param-seek-handler.js"),f=r(/*! ../utils/exception.js */"./src/utils/exception.js"),d=function(){function t(t,e,r){this.TAG="IOController",this._config=e,this._extraData=r,this._stashInitialSize=393216,null!=e.stashInitialSize&&e.stashInitialSize>0&&(this._stashInitialSize=e.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===e.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new i.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return t.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},t.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},t.prototype.isPaused=function(){return this._paused},Object.defineProperty(t.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(t){this._onSeeked=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(t){this._onRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(t){this._onRecoveredEarlyEof=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._loaderClass===u.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),t.prototype._selectSeekHandler=function(){var t=this._config;if("range"===t.seekType)this._seekHandler=new c.default(this._config.rangeLoadZeroStart);else if("param"===t.seekType)this._seekHandler=new h.default(t.seekParamStart||"bstart",t.seekParamEnd||"bend");else{if("custom"!==t.seekType)throw new f.InvalidArgumentException("Invalid seekType in config: "+t.seekType);if("function"!=typeof t.customSeekHandler)throw new f.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new t.customSeekHandler}},t.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=l.default;else if(o.default.isSupported())this._loaderClass=o.default;else if(s.default.isSupported())this._loaderClass=s.default;else{if(!u.default.isSupported())throw new f.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=u.default}},t.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},t.prototype.open=function(t){this._currentRange={from:0,to:-1},t&&(this._currentRange.from=t),this._speedSampler.reset(),t||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},t.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},t.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},t.prototype.resume=function(){if(this._paused){this._paused=!1;var t=this._resumeFrom;this._resumeFrom=0,this._internalSeek(t,!0)}},t.prototype.seek=function(t){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(t,!0)},t.prototype._internalSeek=function(t,e){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(e),this._loader.destroy(),this._loader=null;var r={from:t,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},t.prototype.updateUrl=function(t){if(!t||"string"!=typeof t||0===t.length)throw new f.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=t},t.prototype._expandBuffer=function(t){for(var e=this._stashSize;e+1048576<t;)e*=2;if((e+=1048576)!==this._bufferSize){var r=new ArrayBuffer(e);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,e).set(n,0)}this._stashBuffer=r,this._bufferSize=e}},t.prototype._normalizeSpeed=function(t){var e=this._speedNormalizeList,r=e.length-1,n=0,i=0,a=r;if(t<e[0])return e[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||t>=e[n]&&t<e[n+1])return e[n];e[n]<t?i=n+1:a=n-1}},t.prototype._adjustStashSize=function(t){var e=0;(e=this._config.isLive||t<512?t:t>=512&&t<=1024?Math.floor(1.5*t):2*t)>8192&&(e=8192);var r=1024*e+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*e},t.prototype._dispatchChunks=function(t,e){return this._currentRange.to=e+t.byteLength-1,this._onDataArrival(t,e)},t.prototype._onURLRedirect=function(t){this._redirectedURL=t,this._onRedirect&&this._onRedirect(t)},t.prototype._onContentLengthKnown=function(t){t&&this._fullRequestFlag&&(this._totalLength=t,this._fullRequestFlag=!1)},t.prototype._onLoaderChunkArrival=function(t,e,r){if(!this._onDataArrival)throw new f.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(t.byteLength);var n=this._speedSampler.lastSecondKBps;if(0!==n){var i=this._normalizeSpeed(n);this._speedNormalized!==i&&(this._speedNormalized=i,this._adjustStashSize(i))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=e),this._stashUsed+t.byteLength<=this._stashSize)(s=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength;else if(s=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var a=this._stashBuffer.slice(0,this._stashUsed);(u=this._dispatchChunks(a,this._stashByteStart))<a.byteLength?u>0&&(l=new Uint8Array(a,u),s.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=u):(this._stashUsed=0,this._stashByteStart+=u),this._stashUsed+t.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+t.byteLength),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else(u=this._dispatchChunks(t,e))<t.byteLength&&((o=t.byteLength-u)>this._bufferSize&&(this._expandBuffer(o),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(t,u),0),this._stashUsed+=o,this._stashByteStart=e+u);else if(0===this._stashUsed){var o;(u=this._dispatchChunks(t,e))<t.byteLength&&((o=t.byteLength-u)>this._bufferSize&&this._expandBuffer(o),(s=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(t,u),0),this._stashUsed+=o,this._stashByteStart=e+u)}else{var s,u;if(this._stashUsed+t.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+t.byteLength),(s=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength,(u=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&u>0){var l=new Uint8Array(this._stashBuffer,u);s.set(l,0)}this._stashUsed-=u,this._stashByteStart+=u}}},t.prototype._flushStashBuffer=function(t){if(this._stashUsed>0){var e=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(e,this._stashByteStart),i=e.byteLength-r;if(r<e.byteLength){if(!t){if(r>0){var a=new Uint8Array(this._stashBuffer,0,this._bufferSize),o=new Uint8Array(e,r);a.set(o,0),this._stashUsed=o.byteLength,this._stashByteStart+=r}return 0}n.default.w(this.TAG,i+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,i}return 0},t.prototype._onLoaderComplete=function(t,e){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},t.prototype._onLoaderError=function(t,e){if(n.default.e(this.TAG,"Loader error, code = "+e.code+", msg = "+e.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,t=a.LoaderErrors.UNRECOVERABLE_EARLY_EOF),t===a.LoaderErrors.EARLY_EOF){if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(n.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}t=a.LoaderErrors.UNRECOVERABLE_EARLY_EOF}if(!this._onError)throw new f.RuntimeException("IOException: "+e.msg);this._onError(t,e)},t}();e.default=d},"./src/io/loader.js":
/*!**************************!*\
	  !*** ./src/io/loader.js ***!
	  \**************************/function(t,e,r){r.r(e),r.d(e,{LoaderStatus:function(){return i},LoaderErrors:function(){return a},BaseLoader:function(){return o}});var n=r(/*! ../utils/exception.js */"./src/utils/exception.js"),i={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},a={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},o=function(){function t(t){this._type=t||"undefined",this._status=i.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return t.prototype.destroy=function(){this._status=i.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},t.prototype.isWorking=function(){return this._status===i.kConnecting||this._status===i.kBuffering},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(t){this._onContentLengthKnown=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(t){this._onURLRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),t.prototype.open=function(t,e){throw new n.NotImplementedException("Unimplemented abstract function!")},t.prototype.abort=function(){throw new n.NotImplementedException("Unimplemented abstract function!")},t}()},"./src/io/param-seek-handler.js":
/*!**************************************!*\
	  !*** ./src/io/param-seek-handler.js ***!
	  \**************************************/function(t,e,r){r.r(e);var n=function(){function t(t,e){this._startName=t,this._endName=e}return t.prototype.getConfig=function(t,e){var r=t;if(0!==e.from||-1!==e.to){var n=!0;-1===r.indexOf("?")&&(r+="?",n=!1),n&&(r+="&"),r+=this._startName+"="+e.from.toString(),-1!==e.to&&(r+="&"+this._endName+"="+e.to.toString())}return{url:r,headers:{}}},t.prototype.removeURLParameters=function(t){var e=t.split("?")[0],r=void 0,n=t.indexOf("?");-1!==n&&(r=t.substring(n+1));var i="";if(null!=r&&r.length>0)for(var a=r.split("&"),o=0;o<a.length;o++){var s=a[o].split("=");s[0]!==this._startName&&s[0]!==this._endName&&(o>0&&(i+="&"),i+=a[o])}return 0===i.length?e:e+"?"+i},t}();e.default=n},"./src/io/range-seek-handler.js":
/*!**************************************!*\
	  !*** ./src/io/range-seek-handler.js ***!
	  \**************************************/function(t,e,r){r.r(e);var n=function(){function t(t){this._zeroStart=t||!1}return t.prototype.getConfig=function(t,e){var r,n={};0!==e.from||-1!==e.to?(r=-1!==e.to?"bytes="+e.from.toString()+"-"+e.to.toString():"bytes="+e.from.toString()+"-",n.Range=r):this._zeroStart&&(n.Range="bytes=0-");return{url:t,headers:n}},t.prototype.removeURLParameters=function(t){return t},t}();e.default=n},"./src/io/speed-sampler.js":
/*!*********************************!*\
	  !*** ./src/io/speed-sampler.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n=function(){function t(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,this._now=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now}return t.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},t.prototype.addBytes=function(t){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=t,this._totalBytes+=t):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=t,this._totalBytes+=t):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=t,this._totalBytes+=t,this._lastCheckpoint=this._now())},Object.defineProperty(t.prototype,"currentKBps",{get:function(){this.addBytes(0);var t=(this._now()-this._lastCheckpoint)/1e3;return 0==t&&(t=1),this._intervalBytes/t/1024},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageKBps",{get:function(){var t=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/t/1024},enumerable:!1,configurable:!0}),t}();e.default=n},"./src/io/websocket-loader.js":
/*!************************************!*\
	  !*** ./src/io/websocket-loader.js ***!
	  \************************************/function(t,e,r){r.r(e);var n,i=r(/*! ./loader.js */"./src/io/loader.js"),a=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(t){function e(){var e=t.call(this,"websocket-loader")||this;return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return o(e,t),e.isSupported=function(){try{return void 0!==self.WebSocket}catch(t){return!1}},e.prototype.destroy=function(){this._ws&&this.abort(),t.prototype.destroy.call(this)},e.prototype.open=function(t){try{var e=this._ws=new self.WebSocket(t.url);e.binaryType="arraybuffer",e.onopen=this._onWebSocketOpen.bind(this),e.onclose=this._onWebSocketClose.bind(this),e.onmessage=this._onWebSocketMessage.bind(this),e.onerror=this._onWebSocketError.bind(this),this._status=i.LoaderStatus.kConnecting}catch(t){this._status=i.LoaderStatus.kError;var r={code:t.code,msg:t.message};if(!this._onError)throw new a.RuntimeException(r.msg);this._onError(i.LoaderErrors.EXCEPTION,r)}},e.prototype.abort=function(){var t=this._ws;!t||0!==t.readyState&&1!==t.readyState||(this._requestAbort=!0,t.close()),this._ws=null,this._status=i.LoaderStatus.kComplete},e.prototype._onWebSocketOpen=function(t){this._status=i.LoaderStatus.kBuffering},e.prototype._onWebSocketClose=function(t){!0!==this._requestAbort?(this._status=i.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},e.prototype._onWebSocketMessage=function(t){var e=this;if(t.data instanceof ArrayBuffer)this._dispatchArrayBuffer(t.data);else if(t.data instanceof Blob){var r=new FileReader;r.onload=function(){e._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(t.data)}else{this._status=i.LoaderStatus.kError;var n={code:-1,msg:"Unsupported WebSocket message type: "+t.data.constructor.name};if(!this._onError)throw new a.RuntimeException(n.msg);this._onError(i.LoaderErrors.EXCEPTION,n)}},e.prototype._dispatchArrayBuffer=function(t){var e=t,r=this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,r,this._receivedLength)},e.prototype._onWebSocketError=function(t){this._status=i.LoaderStatus.kError;var e={code:t.code,msg:t.message};if(!this._onError)throw new a.RuntimeException(e.msg);this._onError(i.LoaderErrors.EXCEPTION,e)},e}(i.BaseLoader);e.default=s},"./src/io/xhr-moz-chunked-loader.js":
/*!******************************************!*\
	  !*** ./src/io/xhr-moz-chunked-loader.js ***!
	  \******************************************/function(t,e,r){r.r(e);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),s=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),u=function(t){function e(e,r){var n=t.call(this,"xhr-moz-chunked-loader")||this;return n.TAG="MozChunkedLoader",n._seekHandler=e,n._config=r,n._needStash=!0,n._xhr=null,n._requestAbort=!1,n._contentLength=null,n._receivedLength=0,n}return s(e,t),e.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===t.responseType}catch(t){return i.default.w("MozChunkedLoader",t.message),!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),t.prototype.destroy.call(this)},e.prototype.open=function(t,e){this._dataSource=t,this._range=e;var r=t.url;this._config.reuseRedirectedURL&&null!=t.redirectedURL&&(r=t.redirectedURL);var n=this._seekHandler.getConfig(r,e);this._requestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="moz-chunked-arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onloadend=this._onLoadEnd.bind(this),i.onerror=this._onXhrError.bind(this),t.withCredentials&&(i.withCredentials=!0),"object"==typeof n.headers){var o=n.headers;for(var s in o)o.hasOwnProperty(s)&&i.setRequestHeader(s,o[s])}if("object"==typeof this._config.headers)for(var s in o=this._config.headers)o.hasOwnProperty(s)&&i.setRequestHeader(s,o[s]);this._status=a.LoaderStatus.kConnecting,i.send()},e.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=a.LoaderStatus.kComplete},e.prototype._onReadyStateChange=function(t){var e=t.target;if(2===e.readyState){if(null!=e.responseURL&&e.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(e.responseURL);this._onURLRedirect(r)}if(0!==e.status&&(e.status<200||e.status>299)){if(this._status=a.LoaderStatus.kError,!this._onError)throw new o.RuntimeException("MozChunkedLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(a.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}else this._status=a.LoaderStatus.kBuffering}},e.prototype._onProgress=function(t){if(this._status!==a.LoaderStatus.kError){null===this._contentLength&&null!==t.total&&0!==t.total&&(this._contentLength=t.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var e=t.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=e.byteLength,this._onDataArrival&&this._onDataArrival(e,r,this._receivedLength)}},e.prototype._onLoadEnd=function(t){!0!==this._requestAbort?this._status!==a.LoaderStatus.kError&&(this._status=a.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},e.prototype._onXhrError=function(t){this._status=a.LoaderStatus.kError;var e=0,r=null;if(this._contentLength&&t.loaded<this._contentLength?(e=a.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(e=a.LoaderErrors.EXCEPTION,r={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new o.RuntimeException(r.msg);this._onError(e,r)},e}(a.BaseLoader);e.default=u},"./src/io/xhr-range-loader.js":
/*!************************************!*\
	  !*** ./src/io/xhr-range-loader.js ***!
	  \************************************/function(t,e,r){r.r(e);var n,i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),o=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),u=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),l=function(t){function e(e,r){var n=t.call(this,"xhr-range-loader")||this;return n.TAG="RangeLoader",n._seekHandler=e,n._config=r,n._needStash=!1,n._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],n._currentChunkSizeKB=384,n._currentSpeedNormalized=0,n._zeroSpeedChunkCount=0,n._xhr=null,n._speedSampler=new a.default,n._requestAbort=!1,n._waitForTotalLength=!1,n._totalLengthReceived=!1,n._currentRequestURL=null,n._currentRedirectedURL=null,n._currentRequestRange=null,n._totalLength=null,n._contentLength=null,n._receivedLength=0,n._lastTimeLoaded=0,n}return u(e,t),e.isSupported=function(){try{var t=new XMLHttpRequest;return t.open("GET","https://example.com",!0),t.responseType="arraybuffer","arraybuffer"===t.responseType}catch(t){return i.default.w("RangeLoader",t.message),!1}},e.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),t.prototype.destroy.call(this)},Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),e.prototype.open=function(t,e){this._dataSource=t,this._range=e,this._status=o.LoaderStatus.kConnecting;var r=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},e.prototype._openSubRange=function(){var t=this._range.from+this._receivedLength,e=t+1024*this._currentChunkSizeKB;null!=this._contentLength&&e-this._range.from>=this._contentLength&&(e=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:e},this._internalOpen(this._dataSource,this._currentRequestRange)},e.prototype._internalOpen=function(t,e){this._lastTimeLoaded=0;var r=t.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=t.redirectedURL&&(r=t.redirectedURL));var n=this._seekHandler.getConfig(r,e);this._currentRequestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="arraybuffer",i.onreadystatechange=this._onReadyStateChange.bind(this),i.onprogress=this._onProgress.bind(this),i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),t.withCredentials&&(i.withCredentials=!0),"object"==typeof n.headers){var a=n.headers;for(var o in a)a.hasOwnProperty(o)&&i.setRequestHeader(o,a[o])}if("object"==typeof this._config.headers)for(var o in a=this._config.headers)a.hasOwnProperty(o)&&i.setRequestHeader(o,a[o]);i.send()},e.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=o.LoaderStatus.kComplete},e.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},e.prototype._onReadyStateChange=function(t){var e=t.target;if(2===e.readyState){if(null!=e.responseURL){var r=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=o.LoaderStatus.kBuffering}else{if(this._status=o.LoaderStatus.kError,!this._onError)throw new s.RuntimeException("RangeLoader: Http code invalid, "+e.status+" "+e.statusText);this._onError(o.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})}}},e.prototype._onProgress=function(t){if(this._status!==o.LoaderStatus.kError){if(null===this._contentLength){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var r=t.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(this._contentLength=-1===this._range.to?this._totalLength-this._range.from:this._range.to-this._range.from+1,e)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=t.loaded-this._lastTimeLoaded;this._lastTimeLoaded=t.loaded,this._speedSampler.addBytes(n)}},e.prototype._normalizeSpeed=function(t){var e=this._chunkSizeKBList,r=e.length-1,n=0,i=0,a=r;if(t<e[0])return e[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||t>=e[n]&&t<e[n+1])return e[n];e[n]<t?i=n+1:a=n-1}},e.prototype._onLoad=function(t){if(this._status!==o.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(0===e&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps)),0!==e){var r=this._normalizeSpeed(e);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var n=t.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(n,i,this._receivedLength),a&&(this._status=o.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},e.prototype._onXhrError=function(t){this._status=o.LoaderStatus.kError;var e=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=o.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=o.LoaderErrors.EXCEPTION,r={code:-1,msg:t.constructor.name+" "+t.type}),!this._onError)throw new s.RuntimeException(r.msg);this._onError(e,r)},e}(o.BaseLoader);e.default=l},"./src/player/flv-player.js":
/*!**********************************!*\
	  !*** ./src/player/flv-player.js ***!
	  \**********************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),o=r(/*! ../utils/browser.js */"./src/utils/browser.js"),s=r(/*! ./player-events.js */"./src/player/player-events.js"),u=r(/*! ../core/transmuxer.js */"./src/core/transmuxer.js"),l=r(/*! ../core/transmuxing-events.js */"./src/core/transmuxing-events.js"),c=r(/*! ../core/mse-controller.js */"./src/core/mse-controller.js"),h=r(/*! ../core/mse-events.js */"./src/core/mse-events.js"),f=r(/*! ./player-errors.js */"./src/player/player-errors.js"),d=r(/*! ../config.js */"./src/config.js"),p=r(/*! ../utils/exception.js */"./src/utils/exception.js"),m=function(){function t(t,e){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(i()),this._config=(0,d.createDefaultConfig)(),"object"==typeof e&&Object.assign(this._config,e),"flv"!==t.type.toLowerCase())throw new p.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===t.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},this._now=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=t,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null,this._alwaysSeekKeyframe=!!(o.default.chrome&&(o.default.version.major<50||50===o.default.version.major&&o.default.version.build<2661)||o.default.msedge||o.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return t.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){var r=this;t===s.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){r._emitter.emit(s.default.MEDIA_INFO,r.mediaInfo)})):t===s.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){r._emitter.emit(s.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){var e=this;if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),t.addEventListener("seeking",this.e.onvSeeking),t.addEventListener("canplay",this.e.onvCanPlay),t.addEventListener("stalled",this.e.onvStalled),t.addEventListener("progress",this.e.onvProgress),this._msectl=new c.default(this._config),this._msectl.on(h.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(h.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(h.default.SOURCE_OPEN,(function(){e._mseSourceOpened=!0,e._hasPendingLoad&&(e._hasPendingLoad=!1,e.load())})),this._msectl.on(h.default.ERROR,(function(t){e._emitter.emit(s.default.ERROR,f.ErrorTypes.MEDIA_ERROR,f.ErrorDetails.MEDIA_MSE_ERROR,t)})),this._msectl.attachMediaElement(t),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},t.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},t.prototype.load=function(){var t=this;if(!this._mediaElement)throw new p.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new p.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new u.default(this._mediaDataSource,this._config),this._transmuxer.on(l.default.INIT_SEGMENT,(function(e,r){t._msectl.appendInitSegment(r)})),this._transmuxer.on(l.default.MEDIA_SEGMENT,(function(e,r){t._msectl.appendMediaSegment(r),t._config.lazyLoad&&!t._config.isLive&&r.info.endDts>=1e3*(t._mediaElement.currentTime+t._config.lazyLoadMaxDuration)&&null==t._progressChecker&&(a.default.v(t.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),t._suspendTransmuxer())})),this._transmuxer.on(l.default.LOADING_COMPLETE,(function(){t._msectl.endOfStream(),t._emitter.emit(s.default.LOADING_COMPLETE)})),this._transmuxer.on(l.default.RECOVERED_EARLY_EOF,(function(){t._emitter.emit(s.default.RECOVERED_EARLY_EOF)})),this._transmuxer.on(l.default.IO_ERROR,(function(e,r){t._emitter.emit(s.default.ERROR,f.ErrorTypes.NETWORK_ERROR,e,r)})),this._transmuxer.on(l.default.DEMUX_ERROR,(function(e,r){t._emitter.emit(s.default.ERROR,f.ErrorTypes.MEDIA_ERROR,e,{code:-1,msg:r})})),this._transmuxer.on(l.default.MEDIA_INFO,(function(e){t._mediaInfo=e,t._emitter.emit(s.default.MEDIA_INFO,Object.assign({},e))})),this._transmuxer.on(l.default.METADATA_ARRIVED,(function(e){t._emitter.emit(s.default.METADATA_ARRIVED,e)})),this._transmuxer.on(l.default.SCRIPTDATA_ARRIVED,(function(e){t._emitter.emit(s.default.SCRIPTDATA_ARRIVED,e)})),this._transmuxer.on(l.default.STATISTICS_INFO,(function(e){t._statisticsInfo=t._fillStatisticsInfo(e),t._emitter.emit(s.default.STATISTICS_INFO,Object.assign({},t._statisticsInfo))})),this._transmuxer.on(l.default.RECOMMEND_SEEKPOINT,(function(e){t._mediaElement&&!t._config.accurateSeek&&(t._requestSetTime=!0,t._mediaElement.currentTime=e/1e3)})),this._transmuxer.open()))},t.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},t.prototype.play=function(){return this._mediaElement.play()},t.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._internalSeek(t):this._pendingSeekTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),t.prototype._fillStatisticsInfo=function(t){if(t.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,r=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();r=i.totalVideoFrames,n=i.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=r,t.droppedFrames=n),t},t.prototype._onmseUpdateEnd=function(){if(this._config.lazyLoad&&!this._config.isLive){for(var t=this._mediaElement.buffered,e=this._mediaElement.currentTime,r=0,n=0;n<t.length;n++){var i=t.start(n),o=t.end(n);if(i<=e&&e<o){r=o;break}}r>=e+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(a.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},t.prototype._onmseBufferFull=function(){a.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},t.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},t.prototype._checkProgressAndResume=function(){for(var t=this._mediaElement.currentTime,e=this._mediaElement.buffered,r=!1,n=0;n<e.length;n++){var i=e.start(n),o=e.end(n);if(t>=i&&t<o){t>=o-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(a.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},t.prototype._isTimepointBuffered=function(t){for(var e=this._mediaElement.buffered,r=0;r<e.length;r++){var n=e.start(r),i=e.end(r);if(t>=n&&t<i)return!0}return!1},t.prototype._internalSeek=function(t){var e=this._isTimepointBuffered(t),r=!1,n=0;if(t<1&&this._mediaElement.buffered.length>0){var i=this._mediaElement.buffered.start(0);(i<1&&t<i||o.default.safari)&&(r=!0,n=o.default.safari?.1:i)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=n;else if(e){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*t));this._requestSetTime=!0,this._mediaElement.currentTime=null!=a?a.dts/1e3:t}else this._requestSetTime=!0,this._mediaElement.currentTime=t;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t)},t.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var t=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(t)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(t),this._transmuxer.seek(Math.floor(1e3*t)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=t))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},t.prototype._checkAndResumeStuckPlayback=function(t){var e=this._mediaElement;if(t||!this._receivedCanPlay||e.readyState<2){var r=e.buffered;r.length>0&&e.currentTime<r.start(0)&&(a.default.w(this.TAG,"Playback seems stuck at "+e.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},t.prototype._onvLoadedMetadata=function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},t.prototype._onvSeeking=function(t){var e=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(e<1&&r.length>0){var n=r.start(0);if(n<1&&e<n||o.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=o.default.safari?.1:n)}if(this._isTimepointBuffered(e)){if(this._alwaysSeekKeyframe){var i=this._msectl.getNearestKeyframe(Math.floor(1e3*e));null!=i&&(this._requestSetTime=!0,this._mediaElement.currentTime=i.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:e,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},t.prototype._onvCanPlay=function(t){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},t.prototype._onvStalled=function(t){this._checkAndResumeStuckPlayback(!0)},t.prototype._onvProgress=function(t){this._checkAndResumeStuckPlayback()},t}();e.default=m},"./src/player/native-player.js":
/*!*************************************!*\
	  !*** ./src/player/native-player.js ***!
	  \*************************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ./player-events.js */"./src/player/player-events.js"),o=r(/*! ../config.js */"./src/config.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),u=function(){function t(t,e){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(i()),this._config=(0,o.createDefaultConfig)(),"object"==typeof e&&Object.assign(this._config,e),"flv"===t.type.toLowerCase())throw new s.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(t.hasOwnProperty("segments"))throw new s.InvalidArgumentException("NativePlayer("+t.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=t,this._mediaElement=null}return t.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},t.prototype.on=function(t,e){var r=this;t===a.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(a.default.MEDIA_INFO,r.mediaInfo)})):t===a.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(a.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(t,e)},t.prototype.off=function(t,e){this._emitter.removeListener(t,e)},t.prototype.attachMediaElement=function(t){if(this._mediaElement=t,t.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{t.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}},t.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype.load=function(){if(!this._mediaElement)throw new s.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},t.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},t.prototype.play=function(){return this._mediaElement.play()},t.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(t){this._mediaElement.volume=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(t){this._mediaElement.muted=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(t){this._mediaElement?this._mediaElement.currentTime=t:this._pendingSeekTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaInfo",{get:function(){var t={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"statisticsInfo",{get:function(){var t={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return t;var e=!0,r=0,n=0;if(this._mediaElement.getVideoPlaybackQuality){var i=this._mediaElement.getVideoPlaybackQuality();r=i.totalVideoFrames,n=i.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,n=this._mediaElement.webkitDroppedFrameCount):e=!1;return e&&(t.decodedFrames=r,t.droppedFrames=n),t},enumerable:!1,configurable:!0}),t.prototype._onvLoadedMetadata=function(t){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(a.default.MEDIA_INFO,this.mediaInfo)},t.prototype._reportStatisticsInfo=function(){this._emitter.emit(a.default.STATISTICS_INFO,this.statisticsInfo)},t}();e.default=u},"./src/player/player-errors.js":
/*!*************************************!*\
	  !*** ./src/player/player-errors.js ***!
	  \*************************************/function(t,e,r){r.r(e),r.d(e,{ErrorTypes:function(){return a},ErrorDetails:function(){return o}});var n=r(/*! ../io/loader.js */"./src/io/loader.js"),i=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),a={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},o={NETWORK_EXCEPTION:n.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:n.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:n.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:n.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:i.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:i.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:i.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":
/*!*************************************!*\
	  !*** ./src/player/player-events.js ***!
	  \*************************************/function(t,e,r){r.r(e),e.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},"./src/remux/aac-silent.js":
/*!*********************************!*\
	  !*** ./src/remux/aac-silent.js ***!
	  \*********************************/function(t,e,r){r.r(e);var n=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}();e.default=n},"./src/remux/mp4-generator.js":
/*!************************************!*\
	  !*** ./src/remux/mp4-generator.js ***!
	  \************************************/function(t,e,r){r.r(e);var n=function(){function t(){}return t.init=function(){for(var e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]})t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=t.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},t.box=function(t){for(var e=8,r=null,n=Array.prototype.slice.call(arguments,1),i=n.length,a=0;a<i;a++)e+=n[a].byteLength;(r=new Uint8Array(e))[0]=e>>>24&255,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=255&e,r.set(t,4);var o=8;for(a=0;a<i;a++)r.set(n[a],o),o+=n[a].byteLength;return r},t.generateInitSegment=function(e){var r=t.box(t.types.ftyp,t.constants.FTYP),n=t.moov(e),i=new Uint8Array(r.byteLength+n.byteLength);return i.set(r,0),i.set(n,r.byteLength),i},t.moov=function(e){var r=t.mvhd(e.timescale,e.duration),n=t.trak(e),i=t.mvex(e);return t.box(t.types.moov,r,n,i)},t.mvhd=function(e,r){return t.box(t.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},t.trak=function(e){return t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.tkhd=function(e){var r=e.id,n=e.duration,i=e.presentWidth,a=e.presentHeight;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,a>>>8&255,255&a,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e),t.hdlr(e),t.minf(e))},t.mdhd=function(e){var r=e.timescale,n=e.duration;return t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n,85,196,0,0]))},t.hdlr=function(e){return t.box(t.types.hdlr,"audio"===e.type?t.constants.HDLR_AUDIO:t.constants.HDLR_VIDEO)},t.minf=function(e){var r;return r="audio"===e.type?t.box(t.types.smhd,t.constants.SMHD):t.box(t.types.vmhd,t.constants.VMHD),t.box(t.types.minf,r,t.dinf(),t.stbl(e))},t.dinf=function(){return t.box(t.types.dinf,t.box(t.types.dref,t.constants.DREF))},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.constants.STTS),t.box(t.types.stsc,t.constants.STSC),t.box(t.types.stsz,t.constants.STSZ),t.box(t.types.stco,t.constants.STCO))},t.stsd=function(e){return t.box(t.types.stsd,t.constants.STSD_PREFIX,"audio"===e.type?"mp3"===e.codec?t.mp3(e):t.mp4a(e):t.avc1(e))},t.mp3=function(e){var r=e.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return t.box(t.types[".mp3"],n)},t.mp4a=function(e){var r=e.audioSampleRate,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>>8&255,255&r,0,0]);return t.box(t.types.mp4a,n,t.esds(e))},t.esds=function(e){var r=e.config||[],n=r.length,i=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(r).concat([6,1,2]));return t.box(t.types.esds,i)},t.avc1=function(e){var r=e.avcc,n=e.codecWidth,i=e.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>>8&255,255&n,i>>>8&255,255&i,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.box(t.types.avc1,a,t.box(t.types.avcC,r))},t.mvex=function(e){return t.box(t.types.mvex,t.trex(e))},t.trex=function(e){var r=e.id,n=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return t.box(t.types.trex,n)},t.moof=function(e,r){return t.box(t.types.moof,t.mfhd(e.sequenceNumber),t.traf(e,r))},t.mfhd=function(e){var r=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return t.box(t.types.mfhd,r)},t.traf=function(e,r){var n=e.id,i=t.box(t.types.tfhd,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=t.box(t.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),o=t.sdtp(e),s=t.trun(e,o.byteLength+16+16+8+16+8+8);return t.box(t.types.traf,i,a,s,o)},t.sdtp=function(e){for(var r=e.samples||[],n=r.length,i=new Uint8Array(4+n),a=0;a<n;a++){var o=r[a].flags;i[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return t.box(t.types.sdtp,i)},t.trun=function(e,r){var n=e.samples||[],i=n.length,a=12+16*i,o=new Uint8Array(a);o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,255&i,(r+=8+a)>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var s=0;s<i;s++){var u=n[s].duration,l=n[s].size,c=n[s].flags,h=n[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return t.box(t.types.trun,o)},t.mdat=function(e){return t.box(t.types.mdat,e)},t}();n.init(),e.default=n},"./src/remux/mp4-remuxer.js":
/*!**********************************!*\
	  !*** ./src/remux/mp4-remuxer.js ***!
	  \**********************************/function(t,e,r){r.r(e);var n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),i=r(/*! ./mp4-generator.js */"./src/remux/mp4-generator.js"),a=r(/*! ./aac-silent.js */"./src/remux/aac-silent.js"),o=r(/*! ../utils/browser.js */"./src/utils/browser.js"),s=r(/*! ../core/media-segment-info.js */"./src/core/media-segment-info.js"),u=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=function(){function t(t){this.TAG="MP4Remuxer",this._config=t,this._isLive=!0===t.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new s.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new s.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!o.default.chrome||!(o.default.version.major<50||50===o.default.version.major&&o.default.version.build<2661)),this._fillSilentAfterSeek=o.default.msedge||o.default.msie,this._mp3UseMpegAudio=!o.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return t.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},t.prototype.bindDataSource=function(t){return t.onDataAvailable=this.remux.bind(this),t.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(t.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(t){this._onInitSegment=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(t){this._onMediaSegment=t},enumerable:!1,configurable:!0}),t.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},t.prototype.seek=function(t){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},t.prototype.remux=function(t,e){if(!this._onMediaSegment)throw new u.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(t,e),this._remuxVideo(e),this._remuxAudio(t)},t.prototype._onTrackMetadataReceived=function(t,e){var r=null,n="mp4",a=e.codec;if("audio"===t)this._audioMeta=e,"mp3"===e.codec&&this._mp3UseMpegAudio?(n="mpeg",a="",r=new Uint8Array):r=i.default.generateInitSegment(e);else{if("video"!==t)return;this._videoMeta=e,r=i.default.generateInitSegment(e)}if(!this._onInitSegment)throw new u.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(t,{type:t,data:r.buffer,codec:a,container:t+"/"+n,mediaDuration:e.duration})},t.prototype._calculateDtsBase=function(t,e){this._dtsBaseInited||(t.samples&&t.samples.length&&(this._audioDtsBase=t.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},t.prototype.flushStashedSamples=function(){var t=this._videoStashedLastSample,e=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=t&&(r.samples.push(t),r.length=t.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=e&&(n.samples.push(e),n.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(n,!0)},t.prototype._remuxAudio=function(t,e){if(null!=this._audioMeta){var r,u=t,l=u.samples,c=void 0,h=-1,f=this._audioMeta.refSampleDuration,d="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,p=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(l&&0!==l.length&&(1!==l.length||e)){var v=0,g=null,y=0;d?(v=0,y=u.length):(v=8,y=8+u.length);var _=null;if(l.length>1&&(y-=(_=l.pop()).length),null!=this._audioStashedLastSample){var b=this._audioStashedLastSample;this._audioStashedLastSample=null,l.unshift(b),y+=b.length}null!=_&&(this._audioStashedLastSample=_);var x=l[0].dts-this._dtsBase;if(this._audioNextDts)c=x-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())c=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var w=this._audioSegmentInfoList.getLastSampleBefore(x);if(null!=w){var M=x-(w.originalDts+w.duration);M<=3&&(M=0),c=x-(w.dts+w.duration+M)}else c=0}if(m){var A=x-c,E=this._videoSegmentInfoList.getLastSegmentBefore(x);null!=E&&E.beginDts<A?(D=a.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(n.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+(P=E.beginDts)+", duration: "+(A-E.beginDts)),l.unshift({unit:D,dts:P,pts:P}),y+=D.byteLength):m=!1}for(var S=[],T=0;T<l.length;T++){var C=(b=l[T]).unit,O=b.dts-this._dtsBase,P=O,L=!1,I=null,k=0;if(!(O<-.001)){if("mp3"!==this._audioMeta.codec){var R=O;if(this._audioNextDts&&(R=this._audioNextDts),(c=O-R)<=-3*f){n.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+O+" ms ,curRefDts: "+R+" ms)  due to dtsCorrection: "+c+" ms overlap.");continue}if(c>=3*f&&this._fillAudioTimestampGap&&!o.default.safari){L=!0;var D,B=Math.floor(c/f);n.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+O+" ms, curRefDts: "+R+" ms, dtsCorrection: "+Math.round(c)+" ms, generate: "+B+" frames"),P=Math.floor(R),k=Math.floor(R+f)-P,null==(D=a.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(n.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),D=C),I=[];for(var F=0;F<B;F++){R+=f;var j=Math.floor(R),N=Math.floor(R+f)-j,U={dts:j,pts:j,cts:0,unit:D,size:D.byteLength,duration:N,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};I.push(U),y+=U.size}this._audioNextDts=R+f}else P=Math.floor(R),k=Math.floor(R+f)-P,this._audioNextDts=R+f}else P=O-c,k=T!==l.length-1?l[T+1].dts-this._dtsBase-c-P:null!=_?_.dts-this._dtsBase-c-P:S.length>=1?S[S.length-1].duration:Math.floor(f),this._audioNextDts=P+k;-1===h&&(h=P),S.push({dts:P,pts:P,cts:0,unit:b.unit,size:b.unit.byteLength,duration:k,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),L&&S.push.apply(S,I)}}if(0===S.length)return u.samples=[],void(u.length=0);for(d?g=new Uint8Array(y):((g=new Uint8Array(y))[0]=y>>>24&255,g[1]=y>>>16&255,g[2]=y>>>8&255,g[3]=255&y,g.set(i.default.types.mdat,4)),T=0;T<S.length;T++)g.set(C=S[T].unit,v),v+=C.byteLength;var z=S[S.length-1];r=z.dts+z.duration;var G,V=new s.MediaSegmentInfo;V.beginDts=h,V.endDts=r,V.beginPts=h,V.endPts=r,V.originalBeginDts=S[0].originalDts,V.originalEndDts=z.originalDts+z.duration,V.firstSample=new s.SampleInfo(S[0].dts,S[0].pts,S[0].duration,S[0].originalDts,!1),V.lastSample=new s.SampleInfo(z.dts,z.pts,z.duration,z.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(V),u.samples=S,u.sequenceNumber++,G=d?new Uint8Array:i.default.moof(u,h),u.samples=[],u.length=0;var H={type:"audio",data:this._mergeBoxes(G,g).buffer,sampleCount:S.length,info:V};d&&p&&(H.timestampOffset=h),this._onMediaSegment("audio",H)}}},t.prototype._remuxVideo=function(t,e){if(null!=this._videoMeta){var r,n,a=t,o=a.samples,u=void 0,l=-1,c=-1;if(o&&0!==o.length&&(1!==o.length||e)){var h=8,f=null,d=8+t.length,p=null;if(o.length>1&&(d-=(p=o.pop()).length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,o.unshift(m),d+=m.length}null!=p&&(this._videoStashedLastSample=p);var v=o[0].dts-this._dtsBase;if(this._videoNextDts)u=v-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())u=0;else{var g=this._videoSegmentInfoList.getLastSampleBefore(v);if(null!=g){var y=v-(g.originalDts+g.duration);y<=3&&(y=0),u=v-(g.dts+g.duration+y)}else u=0}for(var _=new s.MediaSegmentInfo,b=[],x=0;x<o.length;x++){var w,M=(m=o[x]).dts-this._dtsBase,A=m.isKeyframe,E=M-u,S=m.cts,T=E+S;if(-1===l&&(l=E,c=T),w=x!==o.length-1?o[x+1].dts-this._dtsBase-u-E:null!=p?p.dts-this._dtsBase-u-E:b.length>=1?b[b.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),A){var C=new s.SampleInfo(E,T,w,m.dts,!0);C.fileposition=m.fileposition,_.appendSyncPoint(C)}b.push({dts:E,pts:T,cts:S,units:m.units,size:m.length,isKeyframe:A,duration:w,originalDts:M,flags:{isLeading:0,dependsOn:A?2:1,isDependedOn:A?1:0,hasRedundancy:0,isNonSync:A?0:1}})}for((f=new Uint8Array(d))[0]=d>>>24&255,f[1]=d>>>16&255,f[2]=d>>>8&255,f[3]=255&d,f.set(i.default.types.mdat,4),x=0;x<b.length;x++)for(var O=b[x].units;O.length;){var P=O.shift().data;f.set(P,h),h+=P.byteLength}var L=b[b.length-1];if(n=L.pts+L.duration,this._videoNextDts=r=L.dts+L.duration,_.beginDts=l,_.endDts=r,_.beginPts=c,_.endPts=n,_.originalBeginDts=b[0].originalDts,_.originalEndDts=L.originalDts+L.duration,_.firstSample=new s.SampleInfo(b[0].dts,b[0].pts,b[0].duration,b[0].originalDts,b[0].isKeyframe),_.lastSample=new s.SampleInfo(L.dts,L.pts,L.duration,L.originalDts,L.isKeyframe),this._isLive||this._videoSegmentInfoList.append(_),a.samples=b,a.sequenceNumber++,this._forceFirstIDR){var I=b[0].flags;I.dependsOn=2,I.isNonSync=0}var k=i.default.moof(a,l);a.samples=[],a.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(k,f).buffer,sampleCount:b.length,info:_})}}},t.prototype._mergeBoxes=function(t,e){var r=new Uint8Array(t.byteLength+e.byteLength);return r.set(t,0),r.set(e,t.byteLength),r},t}();e.default=l},"./src/utils/browser.js":
/*!******************************!*\
	  !*** ./src/utils/browser.js ***!
	  \******************************/function(t,e,r){r.r(e);var n={};!function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(t)||[],r=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],i={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:r[0]||""},a={};if(i.browser){a[i.browser]=!0;var o=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}for(var s in i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a.msie=!0),a.edge&&(delete a.edge,i.browser="msedge",a.msedge=!0),a.opr&&(i.browser="opera",a.opera=!0),a.safari&&a.android&&(i.browser="android",a.android=!0),a.name=i.browser,a.platform=i.platform,n)n.hasOwnProperty(s)&&delete n[s];Object.assign(n,a)}(),e.default=n},"./src/utils/exception.js":
/*!********************************!*\
	  !*** ./src/utils/exception.js ***!
	  \********************************/function(t,e,r){r.r(e),r.d(e,{RuntimeException:function(){return a},IllegalStateException:function(){return o},InvalidArgumentException:function(){return s},NotImplementedException:function(){return u}});var n,i=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=function(){function t(t){this._message=t}return Object.defineProperty(t.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.name+": "+this.message},t}(),o=function(t){function e(e){return t.call(this,e)||this}return i(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),e}(a),s=function(t){function e(e){return t.call(this,e)||this}return i(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),e}(a),u=function(t){function e(e){return t.call(this,e)||this}return i(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),e}(a)},"./src/utils/logger.js":
/*!*****************************!*\
	  !*** ./src/utils/logger.js ***!
	  \*****************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=function(){function t(){}return t.e=function(e,r){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+r;t.ENABLE_CALLBACK&&t.emitter.emit("log","error",n),t.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))},t.i=function(e,r){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+r;t.ENABLE_CALLBACK&&t.emitter.emit("log","info",n),t.ENABLE_INFO&&(console.info?console.info(n):console.log(n))},t.w=function(e,r){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+r;t.ENABLE_CALLBACK&&t.emitter.emit("log","warn",n),t.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))},t.d=function(e,r){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+r;t.ENABLE_CALLBACK&&t.emitter.emit("log","debug",n),t.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))},t.v=function(e,r){e&&!t.FORCE_GLOBAL_TAG||(e=t.GLOBAL_TAG);var n="["+e+"] > "+r;t.ENABLE_CALLBACK&&t.emitter.emit("log","verbose",n),t.ENABLE_VERBOSE&&console.log(n)},t}();a.GLOBAL_TAG="flv.js",a.FORCE_GLOBAL_TAG=!1,a.ENABLE_ERROR=!0,a.ENABLE_INFO=!0,a.ENABLE_WARN=!0,a.ENABLE_DEBUG=!0,a.ENABLE_VERBOSE=!0,a.ENABLE_CALLBACK=!1,a.emitter=new(i()),e.default=a},"./src/utils/logging-control.js":
/*!**************************************!*\
	  !*** ./src/utils/logging-control.js ***!
	  \**************************************/function(t,e,r){r.r(e);var n=r(/*! events */"./node_modules/events/events.js"),i=r.n(n),a=r(/*! ./logger.js */"./src/utils/logger.js"),o=function(){function t(){}return Object.defineProperty(t,"forceGlobalTag",{get:function(){return a.default.FORCE_GLOBAL_TAG},set:function(e){a.default.FORCE_GLOBAL_TAG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"globalTag",{get:function(){return a.default.GLOBAL_TAG},set:function(e){a.default.GLOBAL_TAG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableAll",{get:function(){return a.default.ENABLE_VERBOSE&&a.default.ENABLE_DEBUG&&a.default.ENABLE_INFO&&a.default.ENABLE_WARN&&a.default.ENABLE_ERROR},set:function(e){a.default.ENABLE_VERBOSE=e,a.default.ENABLE_DEBUG=e,a.default.ENABLE_INFO=e,a.default.ENABLE_WARN=e,a.default.ENABLE_ERROR=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableDebug",{get:function(){return a.default.ENABLE_DEBUG},set:function(e){a.default.ENABLE_DEBUG=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableVerbose",{get:function(){return a.default.ENABLE_VERBOSE},set:function(e){a.default.ENABLE_VERBOSE=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableInfo",{get:function(){return a.default.ENABLE_INFO},set:function(e){a.default.ENABLE_INFO=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableWarn",{get:function(){return a.default.ENABLE_WARN},set:function(e){a.default.ENABLE_WARN=e,t._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(t,"enableError",{get:function(){return a.default.ENABLE_ERROR},set:function(e){a.default.ENABLE_ERROR=e,t._notifyChange()},enumerable:!1,configurable:!0}),t.getConfig=function(){return{globalTag:a.default.GLOBAL_TAG,forceGlobalTag:a.default.FORCE_GLOBAL_TAG,enableVerbose:a.default.ENABLE_VERBOSE,enableDebug:a.default.ENABLE_DEBUG,enableInfo:a.default.ENABLE_INFO,enableWarn:a.default.ENABLE_WARN,enableError:a.default.ENABLE_ERROR,enableCallback:a.default.ENABLE_CALLBACK}},t.applyConfig=function(t){a.default.GLOBAL_TAG=t.globalTag,a.default.FORCE_GLOBAL_TAG=t.forceGlobalTag,a.default.ENABLE_VERBOSE=t.enableVerbose,a.default.ENABLE_DEBUG=t.enableDebug,a.default.ENABLE_INFO=t.enableInfo,a.default.ENABLE_WARN=t.enableWarn,a.default.ENABLE_ERROR=t.enableError,a.default.ENABLE_CALLBACK=t.enableCallback},t._notifyChange=function(){var e=t.emitter;if(e.listenerCount("change")>0){var r=t.getConfig();e.emit("change",r)}},t.registerListener=function(e){t.emitter.addListener("change",e)},t.removeListener=function(e){t.emitter.removeListener("change",e)},t.addLogListener=function(e){a.default.emitter.addListener("log",e),a.default.emitter.listenerCount("log")>0&&(a.default.ENABLE_CALLBACK=!0,t._notifyChange())},t.removeLogListener=function(e){a.default.emitter.removeListener("log",e),0===a.default.emitter.listenerCount("log")&&(a.default.ENABLE_CALLBACK=!1,t._notifyChange())},t}();o.emitter=new(i()),e.default=o},"./src/utils/polyfill.js":
/*!*******************************!*\
	  !*** ./src/utils/polyfill.js ***!
	  \*******************************/function(t,e,r){r.r(e);var n=function(){function t(){}return t.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Object.assign=Object.assign||function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e},"function"!=typeof self.Promise&&r(/*! es6-promise */"./node_modules/es6-promise/dist/es6-promise.js").polyfill()},t}();n.install(),e.default=n},"./src/utils/utf8-conv.js":
/*!********************************!*\
	  !*** ./src/utils/utf8-conv.js ***!
	  \********************************/function(t,e,r){function n(t,e,r){var n=t;if(e+r<n.length){for(;r--;)if(128!=(192&n[++e]))return!1;return!0}return!1}r.r(e),e.default=function(t){for(var e=[],r=t,i=0,a=t.length;i<a;)if(r[i]<128)e.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(n(r,i,1)&&(o=(31&r[i])<<6|63&r[i+1])>=128){e.push(String.fromCharCode(65535&o)),i+=2;continue}}else if(r[i]<240){if(n(r,i,2)&&(o=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2])>=2048&&55296!=(63488&o)){e.push(String.fromCharCode(65535&o)),i+=3;continue}}else if(r[i]<248){var o;if(n(r,i,3)&&(o=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3])>65536&&o<1114112){o-=65536,e.push(String.fromCharCode(o>>>10|55296)),e.push(String.fromCharCode(1023&o|56320)),i+=4;continue}}e.push(String.fromCharCode(65533)),++i}return e.join("")}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}return r.m=t,r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r("./src/index.js")}()},t.exports=r()})),flvjs=unwrapExports(flv);const domId="sipsd_for_video";class VideoOnline{constructor(t){this.id=t.id,this.coordinates=t.coordinates,this.url=t.url,this.mask=t.mask,this.type=t.type}getLayerOptions(){let t,{id:e}=this,r=this;return{id:e,type:"custom",renderingMode:"3d",onAdd:(e,n)=>{window.map=e,t=r.tb=new sipsdThreeMin(e,n,{defaultLights:!0,passiveRendering:!1}),r.addVideo(r.coordinates,r.url)},render:(e,r)=>{t.cameraSync.setupCamera(),t.update(!0)}}}_addVideo(t){const e=this.id;let r=document.getElementById(domId);r||(r=document.createElement("div"),r.id=domId,document.body.appendChild(r));let n=document.createElement("VIDEO");if(n.id=e,n.width="200",n.height="100",n.style.visibility="hidden",n.poster="",n.muted=!0,n.loop=!0,n.autoPlay=!0,n.controls=!0,r.appendChild(n),this.type)if("hls"===this.type){if(Hls.isSupported()){let e=this.hls=new Hls;e.loadSource(t),e.attachMedia(n),e.on(Hls.Events.MANIFEST_PARSED,(function(){n.play()}))}}else if("flv"===this.type){let e=this.player=flvjs.createPlayer({type:"flv",url:t,isLive:!0,hasAudio:!1});e.attachMediaElement(n),e.load(),this.playerPromise=e.play()}else"mp4"===this.type&&(n.setAttribute("crossorigin","anonymous"),n.src=t,n.load(),n.play())}_createMesh(t){let e=this.tb,r=[],n=t[0],i=e.projectToWorld(n);for(let n=0;n<t.length;n++){let a=e.projectToWorld(t[n]);r.push(new Vector3$1(a.x-i.x,a.y-i.y,a.z-i.z))}let a=new Geometry$2;a.vertices.push(...r);let o=new Vector3$1(0,0,1),s=new Face3(0,3,2,o),u=new Face3(0,2,1,o);a.faces.push(s,u);let l=new Vector2$3(0,0),c=new Vector2$3(1,0),h=new Vector2$3(1,1),f=new Vector2$3(0,1);a.faceVertexUvs[0].push([f,l,c],[f,c,h]);const d=this.getVideoMaterial();let p=this.mesh=new Mesh(a,d),m=e.Object3D({obj:p}).setCoords(n);e.add(m)}getVideoMaterial(){let t=new VideoTexture(document.getElementById(this.id));return this.mask?new ShaderMaterial$c({uniforms:{u_image:{value:t},u_alpha_image:{value:(new TextureLoader$3).load(this.mask)}},side:FrontSide,transparent:!0,vertexShader:"\n              varying vec2 v_uv;\n              void main() {\n                  v_uv = uv;\n                  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n              }\n        ",fragmentShader:"\n              varying vec2 v_uv;\n              uniform sampler2D u_image;\n              uniform sampler2D u_alpha_image;\n              void main() {\n                  vec4 image = texture2D( u_image, v_uv );\n                  vec4 alpha_image  = texture2D( u_alpha_image, v_uv );\n                  gl_FragColor = image * alpha_image.a;\n              }\n         "}):new MeshLambertMaterial({map:t})}addVideo(t,e){e&&t&&t.length>3&&(this._addVideo(e),this._createMesh(t))}removeVideo(){let t=document.getElementById(this.id);if("hls"===this.type)this.hls.destroy(),t.pause(),t.remove();else if("flv"===this.type){let e=this.player;this.playerPromise.then((()=>{e.pause(),e.unload(),e.detachMediaElement(),e.destroy(),e=null,t.remove()}))}else if("mp4"===this.type){let e=setInterval((function(){4===t.readyState&&(t.pause(),t.remove(),clearInterval(e))}),100)}}}class Matrix4 extends Matrix4$1{constructor(){super()}}function cameraFlyTo(t,e,r){let{duration:n,position:i,bearing:a,pitch:o,complete:s}=e;o&&(o>85&&(o=85),o<0&&(o=0));const u=t.superFun("get","getCameraParameter"),l=u.position;let c=0,h=window.performance.now(),f=l.toLngLat();i=convertCoor(i,r);const d=[f.lng,f.lat],p=[i[0],i[1]],m=[l.toAltitude(),i[2]];function v(e,r,n,i){const a=t.superFun("get","getCameraParameter");a.position=sipsdmapgl.MercatorCoordinate.fromLngLat(e,r),a.bearing=n,a.pitch=i,t.superFun("get","setCameraParameter",a)}window.requestAnimationFrame((function t(){c<n&&function(t){const e=g(d,p,t),r=g(m[0],m[1],t),n=function(t,e,r){if(!e&&0!==e)return t;let n;return n=Math.abs(e-t)<180?e:e>0?e-360:e+360,g(t,n,r)}(u.bearing,a,t);v(e,r,n,void 0!==o?g(u.pitch,o,t):u.pitch)}(c/n);let e=window.performance.now();if(c+=e-h,h=e,c>n)return c=0,window.cancelAnimationFrame(t),v(p,m[1],a,o),void(s&&s());window.requestAnimationFrame(t)}));const g=(t,e,r)=>{if(Array.isArray(t)&&Array.isArray(e)){const n=[];for(let i=0;i<Math.min(t.length,e.length);i++)n[i]=t[i]*(1-r)+e[i]*r;return n}return t*(1-r)+e*r}}const Projection={_projection:void 0,set projection(t){this._projection=t},get projection(){return this._projection}},CRS={EPSG3857:"EPSG:3857",EPSG4326:"EPSG:4326"};function getProj(t){return proj4(t)||void 0}function regProj(t,e,r){proj4(e,r),CRS[t]=e}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}var EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;function create$2(){var t=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function scale$1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function transformMat4(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t}function createMat4(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function transformVector(t,e){var r=transformMat4([],e,t);return scale$1(r,r,1/r[3]),r}function invert(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=r*s-n*o,_=r*u-i*o,b=r*l-a*o,x=n*u-i*s,w=n*l-a*s,M=i*l-a*u,A=c*m-h*p,E=c*v-f*p,S=c*g-d*p,T=h*v-f*m,C=h*g-d*m,O=f*g-d*v,P=y*O-_*C+b*T+x*S-w*E+M*A;return P?(t[0]=(s*O-u*C+l*T)*(P=1/P),t[1]=(i*C-n*O-a*T)*P,t[2]=(m*M-v*w+g*x)*P,t[3]=(f*w-h*M-d*x)*P,t[4]=(u*S-o*O-l*E)*P,t[5]=(r*O-i*S+a*E)*P,t[6]=(v*b-p*M-g*_)*P,t[7]=(c*M-f*b+d*_)*P,t[8]=(o*C-s*S+l*A)*P,t[9]=(n*S-r*C-a*A)*P,t[10]=(p*w-m*b+g*y)*P,t[11]=(h*b-c*w-d*y)*P,t[12]=(s*E-o*T-u*A)*P,t[13]=(r*T-n*E+i*A)*P,t[14]=(m*_-p*x-v*y)*P,t[15]=(c*x-h*_+f*y)*P,t):null}function multiply(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],m=e[12],v=e[13],g=e[14],y=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*n+b*s+x*h+w*m,t[1]=_*i+b*u+x*f+w*v,t[2]=_*a+b*l+x*d+w*g,t[3]=_*o+b*c+x*p+w*y,t[4]=(_=r[4])*n+(b=r[5])*s+(x=r[6])*h+(w=r[7])*m,t[5]=_*i+b*u+x*f+w*v,t[6]=_*a+b*l+x*d+w*g,t[7]=_*o+b*c+x*p+w*y,t[8]=(_=r[8])*n+(b=r[9])*s+(x=r[10])*h+(w=r[11])*m,t[9]=_*i+b*u+x*f+w*v,t[10]=_*a+b*l+x*d+w*g,t[11]=_*o+b*c+x*p+w*y,t[12]=(_=r[12])*n+(b=r[13])*s+(x=r[14])*h+(w=r[15])*m,t[13]=_*i+b*u+x*f+w*v,t[14]=_*a+b*l+x*d+w*g,t[15]=_*o+b*c+x*p+w*y,t}function translate(t,e,r){var n,i,a,o,s,u,l,c,h,f,d,p,m=r[0],v=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*v+e[8]*g+e[12],t[13]=e[1]*m+e[5]*v+e[9]*g+e[13],t[14]=e[2]*m+e[6]*v+e[10]*g+e[14],t[15]=e[3]*m+e[7]*v+e[11]*g+e[15]):(i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],p=e[11],t[0]=n=e[0],t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+s*v+h*g+e[12],t[13]=i*m+u*v+f*g+e[13],t[14]=a*m+l*v+d*g+e[14],t[15]=o*m+c*v+p*g+e[15]),t}function scale(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function rotateX(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+c*n,t[6]=s*i+h*n,t[7]=u*i+f*n,t[8]=l*i-a*n,t[9]=c*i-o*n,t[10]=h*i-s*n,t[11]=f*i-u*n,t}function rotateZ(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+c*n,t[2]=s*i+h*n,t[3]=u*i+f*n,t[4]=l*i-a*n,t[5]=c*i-o*n,t[6]=h*i-s*n,t[7]=f*i-u*n,t}function perspectiveNO(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),create$2();var perspective=perspectiveNO;function equals(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],g=t[15],y=e[0],_=e[1],b=e[2],x=e[3],w=e[4],M=e[5],A=e[6],E=e[7],S=e[8],T=e[9],C=e[10],O=e[11],P=e[12],L=e[13],I=e[14],k=e[15];return Math.abs(r-y)<=EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-_)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-x)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-w)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-M)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-A)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-E)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(c-S)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(h-T)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-C)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(d-O)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-P)<=EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-L)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(v-I)<=EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(g-k)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(k))}function create$1(){var t=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function add(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function negate$1(t,e){return t[0]=-e[0],t[1]=-e[1],t}function lerp(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}function create(){var t=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function assert$1(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}create$1(),create();var PI$1=Math.PI,PI_4=PI$1/4,DEGREES_TO_RADIANS$1=PI$1/180,RADIANS_TO_DEGREES=180/PI$1,TILE_SIZE$1=512,EARTH_CIRCUMFERENCE$1=4003e4,DEFAULT_ALTITUDE=1.5;function zoomToScale$1(t){return Math.pow(2,t)}function lngLatToWorld(t,e){var r=_slicedToArray(t,2),n=r[0],i=r[1];return assert$1(Number.isFinite(n)&&Number.isFinite(e)),assert$1(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),[(e*=TILE_SIZE$1)*(n*DEGREES_TO_RADIANS$1+PI$1)/(2*PI$1),e*(PI$1-Math.log(Math.tan(PI_4+i*DEGREES_TO_RADIANS$1*.5)))/(2*PI$1)]}function worldToLngLat(t,e){var r=_slicedToArray(t,2),n=r[0]/(e*=TILE_SIZE$1)*(2*PI$1)-PI$1,i=2*(Math.atan(Math.exp(PI$1-r[1]/e*(2*PI$1)))-PI_4);return[n*RADIANS_TO_DEGREES,i*RADIANS_TO_DEGREES]}function getDistanceScales$1(t){var e=t.latitude,r=t.longitude,n=t.scale,i=t.highPrecision,a=void 0!==i&&i;n=void 0!==n?n:zoomToScale$1(t.zoom),assert$1(Number.isFinite(e)&&Number.isFinite(r)&&Number.isFinite(n));var o={},s=TILE_SIZE$1*n,u=Math.cos(e*DEGREES_TO_RADIANS$1),l=s/360,c=l/u,h=s/EARTH_CIRCUMFERENCE$1/u;if(o.pixelsPerMeter=[h,-h,h],o.metersPerPixel=[1/h,-1/h,1/h],o.pixelsPerDegree=[l,-c,h],o.degreesPerPixel=[1/l,-1/c,1/h],a){var f=DEGREES_TO_RADIANS$1*Math.tan(e*DEGREES_TO_RADIANS$1)/u,d=s/EARTH_CIRCUMFERENCE$1*f,p=d/c*h;o.pixelsPerDegree2=[0,-l*f/2,d],o.pixelsPerMeter2=[p,0,p]}return o}function getViewMatrix(t){var e=t.height,r=t.pitch,n=t.bearing,i=t.altitude,a=t.center,o=void 0===a?null:a,s=t.flipY,u=void 0!==s&&s,l=createMat4();return translate(l,l,[0,0,-i]),scale(l,l,[1,1,1/e]),rotateX(l,l,-r*DEGREES_TO_RADIANS$1),rotateZ(l,l,n*DEGREES_TO_RADIANS$1),u&&scale(l,l,[1,-1,1]),o&&translate(l,l,negate([],o)),l}function getProjectionParameters(t){var e=t.width,r=t.height,n=t.altitude,i=void 0===n?DEFAULT_ALTITUDE:n,a=t.pitch,o=t.nearZMultiplier,s=void 0===o?1:o,u=t.farZMultiplier,l=void 0===u?1:u,c=(void 0===a?0:a)*DEGREES_TO_RADIANS$1,h=Math.atan(.5/i),f=Math.sin(h)*i/Math.sin(Math.PI/2-c-h),d=Math.cos(Math.PI/2-c)*f+i;return{fov:2*Math.atan(r/2/i),aspect:e/r,focalDistance:i,near:s,far:d*l}}function getProjectionMatrix(t){var e=getProjectionParameters({width:t.width,height:t.height,altitude:t.altitude,pitch:t.pitch,nearZMultiplier:t.nearZMultiplier,farZMultiplier:t.farZMultiplier});return perspective([],e.fov,e.aspect,e.near,e.far)}function worldToPixels(t,e){var r=_slicedToArray(t,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a;return assert$1(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),transformVector(e,[n,i,o,1])}function pixelsToWorld(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=_slicedToArray(t,3),i=n[0],a=n[1],o=n[2];if(assert$1(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=transformVector(e,[i,a,o,1]);return s}var u=transformVector(e,[i,a,0,1]),l=transformVector(e,[i,a,1,1]),c=u[2],h=l[2],f=c===h?0:((r||0)-c)/(h-c);return lerp([],u,l,f)}var IDENTITY=createMat4(),Viewport=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.width,n=e.height,i=e.viewMatrix,a=void 0===i?IDENTITY:i,o=e.projectionMatrix,s=void 0===o?IDENTITY:o;_classCallCheck(this,t),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var u=createMat4();multiply(u,u,this.projectionMatrix),multiply(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=createMat4();scale(l,l,[this.width/2,-this.height/2,1]),translate(l,l,[1,-1,0]),multiply(l,l,this.viewProjectionMatrix);var c=invert(createMat4(),l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return _createClass(t,[{key:"equals",value:function(e){return e instanceof t&&e.width===this.width&&e.height===this.height&&equals(e.projectionMatrix,this.projectionMatrix)&&equals(e.viewMatrix,this.viewMatrix)}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=this.projectPosition(t),a=worldToPixels(i,this.pixelProjectionMatrix),o=_slicedToArray(a,2),s=o[0],u=o[1],l=n?u:this.height-u;return 2===t.length?[s,l]:[s,l,a[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.topLeft,n=void 0===r||r,i=e.targetZ,a=_slicedToArray(t,3),o=a[0],s=a[1],u=a[2],l=n?s:this.height-s,c=i&&i*this.pixelsPerMeter,h=pixelsToWorld([o,l,u],this.pixelUnprojectionMatrix,c),f=this.unprojectPosition(h),d=_slicedToArray(f,3),p=d[0],m=d[1],v=d[2];return Number.isFinite(u)?[p,m,v]:Number.isFinite(i)?[p,m,i]:[p,m]}},{key:"projectPosition",value:function(t){var e=_slicedToArray(this.projectFlat(t),2);return[e[0],e[1],(t[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(t){var e=_slicedToArray(this.unprojectFlat(t),2);return[e[0],e[1],(t[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(t){return t}},{key:"unprojectFlat",value:function(t){return t}}]),t}();function fitBounds(t){var e=t.width,r=t.height,n=t.minExtent,i=void 0===n?0:n,a=t.maxZoom,o=void 0===a?24:a,s=t.padding,u=void 0===s?0:s,l=t.offset,c=void 0===l?[0,0]:l,h=_slicedToArray(t.bounds,2),f=_slicedToArray(h[0],2),d=f[0],p=f[1],m=_slicedToArray(h[1],2),v=m[0],g=m[1];Number.isFinite(u)?u={top:u,bottom:u,left:u,right:u}:assert$1(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var y=new WebMercatorViewport({width:e,height:r,longitude:0,latitude:0,zoom:0}),_=y.project([d,g]),b=y.project([v,p]),x=[Math.max(Math.abs(b[0]-_[0]),i),Math.max(Math.abs(b[1]-_[1]),i)],w=[e-u.left-u.right-2*Math.abs(c[0]),r-u.top-u.bottom-2*Math.abs(c[1])];assert$1(w[0]>0&&w[1]>0);var M=w[0]/x[0],A=w[1]/x[1],E=y.unproject([(b[0]+_[0])/2+(u.right-u.left)/2/M,(b[1]+_[1])/2+(u.bottom-u.top)/2/A]),S=y.zoom+Math.log2(Math.abs(Math.min(M,A)));return{longitude:E[0],latitude:E[1],zoom:Math.min(S,o)}}var WebMercatorViewport=function(t){function e(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.width,i=r.height,a=r.latitude,o=void 0===a?0:a,s=r.longitude,u=void 0===s?0:s,l=r.zoom,c=void 0===l?0:l,h=r.pitch,f=void 0===h?0:h,d=r.bearing,p=void 0===d?0:d,m=r.altitude,v=void 0===m?1.5:m,g=r.nearZMultiplier,y=r.farZMultiplier;_classCallCheck(this,e),n=n||1,i=i||1;var _=zoomToScale$1(c);v=Math.max(.75,v);var b=lngLatToWorld([u,o],_);b[2]=0;var x=getProjectionMatrix({width:n,height:i,pitch:f,bearing:p,altitude:v,nearZMultiplier:g||1/i,farZMultiplier:y||1.01}),w=getViewMatrix({height:i,center:b,pitch:f,bearing:p,altitude:v,flipY:!0});return(t=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,{width:n,height:i,viewMatrix:w,projectionMatrix:x}))).latitude=o,t.longitude=u,t.zoom=c,t.pitch=f,t.bearing=p,t.altitude=v,t.scale=_,t.center=b,t.pixelsPerMeter=getDistanceScales$1(_assertThisInitialized(_assertThisInitialized(t))).pixelsPerMeter[2],Object.freeze(_assertThisInitialized(_assertThisInitialized(t))),t}return _inherits(e,t),_createClass(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return lngLatToWorld(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return worldToLngLat(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,r=pixelsToWorld(t.pos,this.pixelUnprojectionMatrix),n=add([],lngLatToWorld(e,this.scale),negate$1([],r));return worldToLngLat(add([],this.center,n),this.scale)}},{key:"getLocationAtPoint",value:function(t){return this.getMapCenterByLngLatPosition({lngLat:t.lngLat,pos:t.pos})}},{key:"fitBounds",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,i=this.height,a=fitBounds(Object.assign({width:n,height:i,bounds:t},r)),o=a.longitude,s=a.latitude,u=a.zoom;return new e({width:n,height:i,longitude:o,latitude:s,zoom:u})}}]),e}(Viewport);function clamp(t,e,r){return t<e?e:t>r?r:t}function generateUrl(t,e={}){let r=[],n="?";for(let t in e)e[t]&&r.push(`${t}=${e[t]}`);return t.indexOf("?")>=0&&(n="&"),r.length?t+n+r.join("&"):t}const MAX_REQUEST_NUM=16,transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let requestNum=0,requestQuenes=[];function getImage(t,e){if(requestNum>MAX_REQUEST_NUM){let r={url:t,callback:e,canceled:!1,cancel:function(){this.canceled=!0}};return requestQuenes.push(r),r}let r=!1;requestNum++;let n=get(t,{type:"arraybuffer"},(function(t,n){if(function(){if(!r)for(r=!0,requestNum--;requestQuenes.length&&requestNum<MAX_REQUEST_NUM;){let t=requestQuenes.shift(),e=t.url,r=t.callback;t.canceled||(t.cancel=getImage(e,r).cancel)}}(),!t){let t=window.URL||window.webkitURL,r=new Blob([n],{type:"image/png"}),i=t.createObjectURL(r),a=new Image;a.src=i,a.onload=function(){e(a),t.revokeObjectURL(a.src)},a.src=n.byteLength?t.createObjectURL(r):transparentPngUrl}}));return{cancel:function(){n.abort()}}}function getJSON(t,e){let r=get(t,{type:"json"},(function(t,r){t||e(r)}));return{cancel:function(){r.abort()}}}function get(url,config={},callback,async){let xhr=new XMLHttpRequest;return xhr.open("GET",url,!1!==async),xhr.responseType=config.type,"json"===config.type&&(xhr.responseType="text",xhr.setRequestHeader("Accept","application/json")),xhr.onabort=function(t){callback(!0,null)},xhr.onload=function(event){if(!xhr.status||xhr.status>=200&&xhr.status<300){let data=xhr.response;if(data)try{data="json"===config.type?JSON.parse(xhr.response):eval("("+xhr.response+")")}catch(t){}callback(!1,data||null)}},xhr.onerror=function(t){callback(!0,null)},xhr.send(null),xhr}class GLFlow{constructor(t){this._gl=t,this._program=t.createProgram(),this._uvBuffer=t.createBuffer(),this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._attribLocations={},this._uniformLocations={},t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}get program(){return this._program}useProgram(){return this._gl.useProgram(this._program),this}setShaderSource(t,e){let r=this._gl.createShader(this._gl.VERTEX_SHADER);if(this._gl.shaderSource(r,t),this._gl.compileShader(r),!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))throw console.error("Shader Compile Error: "+this._gl.getShaderInfoLog(r)),"Shader Compile Error: "+this._gl.getShaderInfoLog(r);let n=this._gl.createShader(this._gl.FRAGMENT_SHADER);if(this._gl.shaderSource(n,e),this._gl.compileShader(n),!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS))throw console.error("Shader Compile Error: "+this._gl.getShaderInfoLog(n)),"Shader Compile Error: "+this._gl.getShaderInfoLog(n);return this._gl.attachShader(this._program,r),this._gl.attachShader(this._program,n),this._gl.linkProgram(this._program),this._gl.deleteShader(r),this._gl.deleteShader(n),this}getLocationsForAttrs(t=[]){return t.forEach((t=>{this._attribLocations[t]=this._gl.getAttribLocation(this._program,t)})),this._attribLocations}getLocationsForUniforms(t=[]){return t.forEach((t=>{let e=this._gl.getUniformLocation(this._program,t);e&&(this._uniformLocations[t]=e)})),this._uniformLocations}setVertexBuffer(t,e=3,r="position"){return t&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._vertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW),this._gl.vertexAttribPointer(this._attribLocations[r],e,this._gl.FLOAT,!1,0,0),this._gl.enableVertexAttribArray(this._attribLocations[r])),this}setUvBuffer(t,e=2,r="a_uv"){return t&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._uvBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,t,this._gl.STATIC_DRAW),this._gl.vertexAttribPointer(this._attribLocations[r],e,this._gl.FLOAT,!1,0,0),this._gl.enableVertexAttribArray(this._attribLocations[r])),this}createTexture(t){let e=this._gl.createTexture();return this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,0),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),this._gl.bindTexture(this._gl.TEXTURE_2D,null),e}setUniform(t,e,r="f"){if(!this._uniformLocations[t])return this;let n=this._uniformLocations[t];if(Array.isArray(e)){let t=e.length;2===t?("f"===r&&this._gl.uniform2fv(n,e),"i"===r&&this._gl.uniform2iv(n,e)):3===t?("f"===r&&this._gl.uniform3fv(n,e),"i"===r&&this._gl.uniform3iv(n,e)):4===t&&("f"===r&&this._gl.uniform4fv(n,e),"i"===r&&this._gl.uniform4iv(n,e))}else"f"===r&&this._gl.uniform1f(n,e),"i"===r&&this._gl.uniform1i(n,e);return this}setUniformMatrix(t,e,r=!1){if(!this._uniformLocations[t])return this;let n=this._uniformLocations[t],i=e.length;return 4===i?this._gl.uniformMatrix2fv(n,r,e):9===i?this._gl.uniformMatrix3fv(n,r,e):16===i&&this._gl.uniformMatrix4fv(n,r,e),this}activeTexture(t){return this._gl.activeTexture(0===t?this._gl.TEXTURE0:this._gl.TEXTURE1),this}bindTexture(t){return this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this}drawTexture(t=0,e){return this._gl.enable(this._gl.BLEND),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.drawArrays(this._gl.TRIANGLE_STRIP,t,e),this}}function getTileBBox(t,e,r){var n=getMercCoords(256*t,256*(e=Math.pow(2,r)-e-1),r),i=getMercCoords(256*(t+1),256*(e+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}function getMercCoords(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class Transform{static transformLngLat(t=[0,0],e,r){return proj4(proj4(e),proj4(r),t)}static transformWGS84ToWebMercator(t=0,e=0){return proj4(proj4(CRS.EPSG4326),proj4(CRS.EPSG3857),[t,e])}static transformWebMercatorToWGS84(t=0,e=0){return proj4(proj4(CRS.EPSG3857),proj4(CRS.EPSG4326),[t,e])}}class Tile{constructor(t,e,r){this.id=[r,e,t].join("/"),this.x=+t,this.y=+e,this.z=+r,this.origin=[-180,90],this.resolution=0,this.size=256,this.crs=CRS.EPSG3857,this.texture=null,this.request=null,this.parent=null,this.loaded=!1,this._coordBounds=[],this._mercatorBounds=[]}getCoordBounds(){if(this._coordBounds&&this._coordBounds.length)return this._coordBounds;let t=[],e=getTileBBox(this.x,this.y,this.z).split(",");if(this.resolution){let e=this.x*this.size*this.resolution+this.origin[0],r=e+this.size*this.resolution,n=this.origin[1]-this.y*this.size*this.resolution,i=Transform.transformLngLat([e,n-this.size*this.resolution],this.crs,CRS.EPSG4326),a=Transform.transformLngLat([r,n],this.crs,CRS.EPSG4326);t=[i[0],i[1],a[0],a[1]]}else if(this.crs!==CRS.EPSG3857||this.resolution){let r=Transform.transformLngLat([+e[0],+e[1]],CRS.EPSG3857,this.crs),n=Transform.transformLngLat([+e[2],+e[3]],CRS.EPSG3857,this.crs);t=[r[0],r[1],n[0],n[1]]}else{let r=Transform.transformWebMercatorToWGS84(+e[0],+e[1]),n=Transform.transformWebMercatorToWGS84(+e[2],+e[3]);t=[r[0],r[1],n[0],n[1]]}return this._coordBounds=t.map((t=>Math.fround(t))),this._coordBounds}getMercatorBounds(){if(this._mercatorBounds&&this._mercatorBounds.length)return this._mercatorBounds;let t=this.getCoordBounds(),e=Transform.transformWGS84ToWebMercator(+t[0],+t[1]),r=Transform.transformWGS84ToWebMercator(+t[2],+t[3]);return this._mercatorBounds=[e[0],e[1],r[0],r[1]],this._mercatorBounds}children(){let t=this.z+1,e=2*this.x,r=2*this.y;return[[t,r,e].join("/"),[t,r,e+1].join("/"),[t,r+1,e].join("/"),[t,r+1,e+1].join("/")]}}const PI=Math.PI,DEGREES_TO_RADIANS=PI/180,TILE_SIZE=512,EARTH_CIRCUMFERENCE=4003e4;function lng2Mercatortile(t,e){return Math.floor((t+180)/360*Math.pow(2,e))}function lat2Mercatortile(t,e){return Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e))}function zoomToScale(t){return Math.pow(2,t)}function getDistanceScales(t){let{latitude:e=0,zoom:r=1,scale:n,highPrecision:i=!1}=t;n=void 0!==n?n:zoomToScale(r);const a={},o=TILE_SIZE*n*window.devicePixelRatio,s=Math.cos(e*DEGREES_TO_RADIANS),u=o/360,l=u/s,c=o/EARTH_CIRCUMFERENCE/s;if(a.pixelsPerMeter=[c,-c,c],a.metersPerPixel=[1/c,-1/c,1/c],a.pixelsPerDegree=[u,-l,c],a.degreesPerPixel=[1/u,-1/l,1/c],i){const t=DEGREES_TO_RADIANS*Math.tan(e*DEGREES_TO_RADIANS)/s,r=o/EARTH_CIRCUMFERENCE*t,n=r/l*c;a.pixelsPerDegree2=[0,-u*t/2,r],a.pixelsPerMeter2=[n,0,n]}return a}var LayerVS="attribute vec2 a_pos;\r\nattribute vec2 a_uv;\r\nvarying vec2 v_uv;\r\nuniform mat4 u_matrix;\r\nuniform bool u_is_offset;\r\nuniform vec3 u_pixels_per_meter;\r\nuniform vec3 u_pixels_per_degree;\r\nuniform vec3 u_pixels_per_degree2;\r\nuniform vec2 u_viewport_center;\r\nuniform vec4 u_viewport_center_projection;\r\n\r\n\r\nconst float PI = 3.1415926536;\r\n\r\nfloat project_scale(float meters) {\r\n    return meters * u_pixels_per_meter.z;\r\n}\r\n\r\nvec2 project_mercator(vec2 lnglat) {\r\n    return vec2(\r\n    (180. + lnglat.x) / 360.,\r\n    (180. - (180. / PI * log(tan(PI / 4. + lnglat.y * PI / 360.)))) / 360.\r\n    );\r\n}\r\n\r\n\r\nvec4 project_offset(vec4 offset) {\r\n    float dy = offset.y;\r\n    dy = clamp(dy, -1., 1.);\r\n    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;\r\n    return vec4(offset.xyz * pixels_per_unit, offset.w);\r\n}\r\n\r\nvec4 project_position(vec4 position) {\r\n    if (u_is_offset) {\r\n        float X = position.x - u_viewport_center.x;\r\n        float Y = position.y - u_viewport_center.y;\r\n        return project_offset(vec4(X, Y, position.z, position.w));\r\n    } else {\r\n        return vec4(\r\n        project_mercator(position.xy),\r\n        project_scale(position.z),\r\n        position.w\r\n        );\r\n    }\r\n}\r\n\r\n\r\n\r\nvoid main(){\r\n    v_uv = a_uv;\r\n    vec4 project_pos = project_position(vec4(a_pos,0., 1.));\r\n    gl_Position = u_matrix * project_pos + u_viewport_center_projection;\r\n}",LayerFS="precision mediump float;\r\nvarying vec2 v_uv;\r\nuniform sampler2D texture;\r\nvoid main(){\r\n    vec4 textureColor = texture2D(texture,v_uv);\r\n    gl_FragColor = textureColor;\r\n}";class BaseTileLayer{constructor(t={}){this._id=t.id,this._glFlow=null,this._transform=null,this._url=t.url,this._subdomains=t.subdomains||[],this._crs=t.crs||CRS.EPSG3857,this._tileSize=+t.tileSize||256,this._origin=t.origin||[-180,90],this._resolutions=t.resolutions||[],this._scales=t.scales||[],this._minZoom=t.minZoom||0,this._maxZoom=t.maxZoom||25,this._zoomOffset=+t.zoomOffset||0,this._requestMode=t.requestMode||"ajax",this._sipsdToken=t.sipsdToken||"",this._ready=!1,this._viewTiles={},this._tileCache={},this._frameState={zoom:0,resolution:0,viewBounds:null}}get id(){return this._id}get type(){return"custom"}get renderingMode(){return"2d"}_formatUrl(t){return this._url.replace("{x}",String(t.x)).replace("{y}",String(t.y)).replace("{z}",String(t.z)).replace("{scale}",String(this._scales[t.z]))}_loadTile(t){if("ajax"===this._requestMode)t.request=getImage(this._formatUrl(t),(e=>{delete t.request,t.texture=this._glFlow.createTexture(e),t.loaded=!0,this._map.triggerRepaint()}));else{let e=new Image;e.crossOrigin=!0,e.src=this._formatUrl(t),e.onload=()=>{t.texture=this._glFlow.createTexture(e),t.loaded=!0,e=null,this._map.triggerRepaint()}}}_loadTileCallback(t){if(!t)return;let[e,r,n,i]=t.getCoordBounds(),a=new Float32Array([e,i,n,i,e,r,n,i,e,r,n,r]);this._glFlow.setVertexBuffer(a,2,"a_pos").activeTexture(0).bindTexture(t.texture).drawTexture(0,6)}_calcTilesInView(){let{viewBounds:t,level:e,resolution:r}=this._frameState,n=[],i={},a=r*this._tileSize,o=0,s=0,u=0,l=0,c=Object.keys(this._tileCache).map((t=>{let r=this._tileCache[t];return r.z>this._minZoom&&r.z===e-1?r:null})).filter((t=>!!t));if(this._crs&&r){let e=Transform.transformLngLat([t.getWest(),t.getNorth()],CRS.EPSG4326,this._crs),r=Transform.transformLngLat([t.getEast(),t.getSouth()],CRS.EPSG4326,this._crs);o=Math.floor((e[0]-this._origin[0])/a),s=Math.floor((this._origin[1]-e[1])/a),u=Math.ceil((r[0]-this._origin[0])/a),l=Math.ceil((this._origin[1]-r[1])/a)}else o=lng2Mercatortile(t.getWest(),e),s=lat2Mercatortile(t.getNorth(),e),u=lng2Mercatortile(t.getEast(),e),l=lat2Mercatortile(t.getSouth(),e);let h=Math.floor((o+u)/2),f=Math.ceil((s+l)/2);for(let t=o;t<=u;t++)for(let r=s;r<=l;r++)n.push({key:e+"/"+r+"/"+t,distanceSq:Math.sqrt(Math.pow(t-h,2)+Math.pow(r-f,2))});return n.sort(((t,e)=>t.distanceSq-e.distanceSq)).map((t=>t.key)).forEach((t=>{let[e,n,a]=t.split("/");if(this._viewTiles[t])i[t]=this._viewTiles[t],delete this._viewTiles[t];else if(this._tileCache[t])i[t]=this._tileCache[t];else{let o=new Tile(a,n,e);o.crs=this._crs,o.origin=this._origin,o.resolution=r,c.forEach((t=>{(t.children()||[]).indexOf(o.id)>=0&&(o.parent=t)})),i[t]=o,this._tileCache[t]=o,this._loadTile(o)}})),i}_updateUniform(t,e){let{zoom:r,center:n,bearing:i,pitch:a}=this._transform,o=new WebMercatorViewport({width:t.drawingBufferWidth,height:t.drawingBufferHeight,longitude:n.lng,latitude:n.lat,zoom:r,pitch:a,bearing:i}),{viewProjectionMatrix:s,projectionMatrix:u,viewMatrix:l,viewMatrixUncentered:c}=o,h={u_matrix:e,texture:0,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_viewport_center_projection:[0,0,0,0]};if(r>14){const{pixelsPerDegree:t,pixelsPerDegree2:i}=getDistanceScales({longitude:n.lng,latitude:n.lat,zoom:r,highPrecision:!0}),a=o.projectFlat([Math.fround(n.lng),Math.fround(n.lat)],Math.pow(2,r)),f=transformMat4([],[a[0],a[1],0,1],s);e=multiply([],u,c||l),e=multiply([],e,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),h.u_matrix=e,h.u_is_offset=!0,h.u_viewport_center=[Math.fround(n.lng),Math.fround(n.lat)],h.u_viewport_center_projection=f,h.u_pixels_per_degree=t&&t.map((t=>Math.fround(t))),h.u_pixels_per_degree2=i&&i.map((t=>Math.fround(t)))}for(let t in h)"u_matrix"===t?this._glFlow.setUniformMatrix(t,h[t]):"u_is_offset"===t||"texture"===t?this._glFlow.setUniform(t,h[t],"i"):this._glFlow.setUniform(t,h[t])}_onAdded(){this._ready=!0}_getTileParent(t){return t.parent?t.parent.loaded?t.parent:this._getTileParent(t.parent):null}onAdd(t,e){this._map=t,this._transform=t.transform,this._glFlow=new GLFlow(e),this._glFlow.setShaderSource(LayerVS,LayerFS),this._glFlow.getLocationsForAttrs(["a_pos","a_uv"]),this._glFlow.getLocationsForUniforms(["u_matrix","texture","u_is_offset","u_pixels_per_degree","u_pixels_per_degree2","u_pixels_per_meter","u_viewport_center","u_viewport_center_projection"]),this._glFlow.setUvBuffer(new Float32Array([0,0,1,0,0,1,1,0,0,1,1,1]),2,"a_uv"),this._onAdded()}render(t,e){if(!this._glFlow||!this._glFlow.program||!this._ready)return;let r=this._transform.getBounds(),n=clamp(this._transform.coveringZoomLevel({tileSize:this._tileSize||256,roundZoom:!0}),this._minZoom,this._maxZoom);this._frameState.level=n,this._frameState.viewBounds=r,this._resolutions&&this._resolutions.length&&(this._frameState.resolution=this._resolutions[n]),this._glFlow.useProgram(),this._updateUniform(t,e),this._viewTiles=this._calcTilesInView();for(let t in this._viewTiles){let e=this._viewTiles[t];(e.loaded||e.parent)&&(e.loaded?this._loadTileCallback(e):!e.loaded&&e.parent&&this._loadTileCallback(this._getTileParent(e.parent)))}}onRemove(t,e){this._tileCache={},this._glFlow=void 0,this._viewTiles={}}}class TileCoordLayer extends BaseTileLayer{constructor(t={}){super(t),this._color=t.color||"#f18a18"}_loadTile(t){let e=document.createElement("canvas");e.width=256,e.height=256;let r=e.getContext("2d");r.strokeStyle=this._color,r.lineWidth=2,r.strokeRect(1,1,255,255),r.font="bold 25px Arial",r.textAlign="center",r.fillStyle=this._color,r.fillText("L: "+ +t.z,124,86),r.fillText("X: "+ +t.x,124,136),r.fillText("Y: "+ +t.y,124,186),t.texture=this._glFlow.createTexture(e),t.loaded=!0}}class XYZTileLayer extends BaseTileLayer{constructor(t={}){if(super(t),!t.url)throw"missing the url"}_formatUrl(t){return generateUrl(this._url,{sipsdToken:this._sipsdToken}).replace("{s}",this._subdomains[Math.floor(Math.random()*this._subdomains.length)]).replace("{x}",String(t.x)).replace("{y}",String(t.y)).replace("{z}",String(t.z+this._zoomOffset))}}class WMSLayer extends BaseTileLayer{constructor(t={}){if(super(t),!t.url)throw"missing the url";this._bboxUnit=t.bboxUnit||"degree"}_formatUrl(t){let e="degree"===this._bboxUnit?t.getCoordBounds().join(","):t.getMercatorBounds().join(",");return generateUrl(this._url,{sipsdToken:this._sipsdToken}).replace("{s}",this._subdomains[Math.floor(Math.random()*this._subdomains.length)]).replace(/\{bbox-epsg-\w+\}/g,e)}}class WMTSLayer extends BaseTileLayer{constructor(t={}){if(super(t),!t.url)throw"missing the url";this._layer=t.layer,this._style=t.style||"default",this._format=t.format||"image/jpeg",this._tilematrixset=t.tilematrixset||"EPSG:4326"}_formatUrl(t){return generateUrl(this._url+`?service=WMTS&request=GetTile&version=1.0.0&${this._style}`,{layer:encodeURIComponent(this._layer),tilematrixset:encodeURIComponent(this._tilematrixset),format:encodeURIComponent(this._format),tileMatrix:encodeURIComponent(this._tilematrixset)+":{z}",TileCol:"{x}",TileRow:"{y}",sipsdToken:this._sipsdToken}).replace("{s}",this._subdomains[Math.floor(Math.random()*this._subdomains.length)]).replace("{x}",String(t.x)).replace("{y}",String(t.y)).replace("{z}",String(t.z+this._zoomOffset))}}class ArcGisMapServerLayer extends BaseTileLayer{constructor(t={}){if(super(t),!t.url)throw"missing the url"}_onAdded(){let t=generateUrl(this._url,{sipsdToken:this._sipsdToken});t=t.replace("{s}",this._subdomains[Math.floor(Math.random()*this._subdomains.length)]),getJSON(t,(t=>{if(!t.tileInfo)throw"missing the tileInfo";let e=t.tileInfo;if(!e.lods.length)throw"missing the lods";this._maxZoom=Math.min(e.lods.length,this._maxZoom),this._origin=[e.origin.x,e.origin.y],this._resolutions=e.lods.map((t=>t.resolution)),this._ready=!0}))}_formatUrl(t){return generateUrl(`${this._url}/tile/{z}/{y}/{x}`,{sipsdToken:this._sipsdToken}).replace("{s}",this._subdomains[Math.floor(Math.random()*this._subdomains.length)]).replace("{x}",String(t.x)).replace("{y}",String(t.y)).replace("{z}",String(t.z+this._zoomOffset))}}function getLayerOptions(t){if("SZ2000"===Projection.projection){if(t.type&&"raster"===t.type){if(t.source&&t.source.tiles){let e=function(t){let e={};for(let r in t)if("source"===r){let n=t[r];for(let t in n)e[t]=n[t]}else e[r]=t[r];return e}(t);return t.source.tiles[0].indexOf("bbox")>-1?new sipsdmapgl.WMSLayer({...e,url:t.source.tiles[0],crs:sipsdmapgl.CRS.EPSG4326,bboxUnit:"meter"}):new sipsdmapgl.XYZTileLayer({...e,url:t.source.tiles[0]})}return t}return t}console.warn("暂不支持此类型服务！")}sipsdmapgl.CRS=CRS,sipsdmapgl.getProj=getProj,sipsdmapgl.regProj=regProj,sipsdmapgl.Transform=Transform,sipsdmapgl.TileCoordLayer=TileCoordLayer,sipsdmapgl.XYZTileLayer=XYZTileLayer,sipsdmapgl.WMSLayer=WMSLayer,sipsdmapgl.WMTSLayer=WMTSLayer,sipsdmapgl.ArcGisMapServerLayer=ArcGisMapServerLayer;var earthRadius=6371008.8,factors={centimeters:100*earthRadius,centimetres:100*earthRadius,degrees:earthRadius/111325,feet:3.28084*earthRadius,inches:39.37*earthRadius,kilometers:earthRadius/1e3,kilometres:earthRadius/1e3,meters:earthRadius,metres:earthRadius,miles:earthRadius/1609.344,millimeters:1e3*earthRadius,millimetres:1e3*earthRadius,nauticalmiles:earthRadius/1852,radians:1,yards:1.0936*earthRadius};function feature(t,e,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}function point(t,e,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber(t[0])||!isNumber(t[1]))throw new Error("coordinates must contain numbers");return feature({type:"Point",coordinates:t},e,r)}function polygon(t,e,r){void 0===r&&(r={});for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}return feature({type:"Polygon",coordinates:t},e,r)}function lineString(t,e,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return feature({type:"LineString",coordinates:t},e,r)}function radiansToLength(t,e){void 0===e&&(e="kilometers");var r=factors[e];if(!r)throw new Error(e+" units is invalid");return t*r}function degreesToRadians(t){return t%360*Math.PI/180}function isNumber(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function coordEach(t,e,r){if(null!==t)for(var n,i,a,o,s,u,l,c,h=0,f=0,d=t.type,p="FeatureCollection"===d,m="Feature"===d,v=p?t.features.length:1,g=0;g<v;g++){s=(c=!!(l=p?t.features[g].geometry:m?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var y=0;y<s;y++){var _=0,b=0;if(null!==(o=c?l.geometries[y]:l)){u=o.coordinates;var x=o.type;switch(h=!r||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===e(u,f,g,_,b))return!1;f++,_++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===e(u[n],f,g,_,b))return!1;f++,"MultiPoint"===x&&_++}"LineString"===x&&_++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-h;i++){if(!1===e(u[n][i],f,g,_,b))return!1;f++}"MultiLineString"===x&&_++,"Polygon"===x&&b++}"Polygon"===x&&_++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(b=0,i=0;i<u[n].length;i++){for(a=0;a<u[n][i].length-h;a++){if(!1===e(u[n][i][a],f,g,_,b))return!1;f++}b++}_++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(!1===coordEach(o.geometries[n],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function geomEach(t,e){var r,n,i,a,o,s,u,l,c,h,f=0,d="FeatureCollection"===t.type,p="Feature"===t.type,m=d?t.features.length:1;for(r=0;r<m;r++){for(l=d?t.features[r].properties:p?t.properties:{},c=d?t.features[r].bbox:p?t.bbox:void 0,h=d?t.features[r].id:p?t.id:void 0,o=(u=!!(s=d?t.features[r].geometry:p?t.geometry:t)&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<o;i++)if(null!==(a=u?s.geometries[i]:s))switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(a,f,l,c,h))return!1;break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===e(a.geometries[n],f,l,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,l,c,h))return!1;f++}}function geomReduce(t,e,r){var n=r;return geomEach(t,(function(t,i,a,o,s){n=0===i&&void 0===r?t:e(n,t,i,a,o,s)})),n}function flattenEach(t,e){geomEach(t,(function(t,r,n,i,a){var o,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(feature(t,n,{bbox:i,id:a}),r,0)&&void 0}switch(s){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var u=0;u<t.coordinates.length;u++)if(!1===e(feature({type:o,coordinates:t.coordinates[u]},n),r,u))return!1}))}function segmentEach(t,e){flattenEach(t,(function(t,r,n){var i=0;if(t.geometry){var a=t.geometry.type;if("Point"!==a&&"MultiPoint"!==a){var o,s=0,u=0,l=0;return!1!==coordEach(t,(function(a,c,h,f,d){if(void 0===o||r>s||f>u||d>l)return o=a,s=r,u=f,l=d,void(i=0);var p=lineString([o,a],t.properties);if(!1===e(p,r,n,d,i))return!1;i++,o=a}))&&void 0}}}))}function segmentReduce(t,e,r){var n=r,i=!1;return segmentEach(t,(function(t,a,o,s,u){n=!1===i&&void 0===r?t:e(n,t,a,o,s,u),i=!0})),n}var RADIUS=6378137;function area$1(t){return geomReduce(t,(function(t,e){return t+calculateArea(e)}),0)}function calculateArea(t){var e,r=0;switch(t.type){case"Polygon":return polygonArea(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)r+=polygonArea(t.coordinates[e]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function polygonArea(t){var e=0;if(t&&t.length>0){e+=Math.abs(ringArea(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(ringArea(t[r]))}return e}function ringArea(t){var e,r,n,i,a,o,s=0,u=t.length;if(u>2){for(o=0;o<u;o++)o===u-2?(n=u-2,i=u-1,a=0):o===u-1?(n=u-1,i=0,a=1):(n=o,i=o+1,a=o+2),e=t[n],r=t[i],s+=(rad(t[a][0])-rad(e[0]))*Math.sin(rad(r[1]));s=s*RADIUS*RADIUS/2}return s}function rad(t){return t*Math.PI/180}function getCoord(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function getType(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}function distance$1(t,e,r){void 0===r&&(r={});var n=getCoord(t),i=getCoord(e),a=degreesToRadians(i[1]-n[1]),o=degreesToRadians(i[0]-n[0]),s=degreesToRadians(n[1]),u=degreesToRadians(i[1]),l=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(s)*Math.cos(u);return radiansToLength(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),r.units)}function length(t,e){return void 0===e&&(e={}),segmentReduce(t,(function(t,r){var n=r.geometry.coordinates;return t+distance$1(n[0],n[1],e)}),0)}var rbush_min=createCommonjsModule((function(t,e){t.exports=function(){function t(t,n,i,a,o){!function t(r,n,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(i,Math.floor(n-u*c/s+h)),Math.min(a,Math.floor(n+(s-u)*c/s+h)),o)}var f=r[n],d=i,p=a;for(e(r,i,n),o(r[a],f)>0&&e(r,i,a);d<p;){for(e(r,d,p),d++,p--;o(r[d],f)<0;)d++;for(;o(r[p],f)>0;)p--}0===o(r[i],f)?e(r,i,p):e(r,++p,a),p<=n&&(i=p+1),n<=p&&(a=p-1)}}(t,n,i||0,a||t.length-1,o||r)}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function a(t,e){o(t,0,t.children.length,e,t)}function o(t,e,r,n,i){i||(i=p(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a=e;a<r;a++){var o=t.children[a];s(i,t.leaf?n(o):o)}return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function d(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(e,r,n,i,a){for(var o=[r,n];o.length;)if(!((n=o.pop())-(r=o.pop())<=i)){var s=r+Math.ceil((n-r)/i/2)*i;t(e,s,r,n,a),o.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,r=[];if(!d(t,e))return r;for(var n=this.toBBox,i=[];e;){for(var a=0;a<e.children.length;a++){var o=e.children[a],s=e.leaf?n(o):o;d(t,s)&&(e.leaf?r.push(o):f(t,s)?this._all(o,r):i.push(o))}e=i.pop()}return r},n.prototype.collides=function(t){var e=this.data;if(!d(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var i=e.children[n],a=e.leaf?this.toBBox(i):i;if(d(t,a)){if(e.leaf||f(t,a))return!0;r.push(i)}}e=r.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=p([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var r,n,a,o=this.data,s=this.toBBox(t),u=[],l=[];o||u.length;){if(o||(o=u.pop(),n=u[u.length-1],r=l.pop(),a=!0),o.leaf){var c=i(t,o.children,e);if(-1!==c)return o.children.splice(c,1),u.push(o),this._condense(u),this}a||o.leaf||!f(o,s)?n?(r++,o=n.children[r],a=!1):o=null:(u.push(o),l.push(r),r=0,n=o,o=o.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},n.prototype._build=function(t,e,r,n){var i,o=r-e+1,s=this._maxEntries;if(o<=s)return a(i=p(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),(i=p([])).leaf=!1,i.height=n;var u=Math.ceil(o/s),l=u*Math.ceil(Math.sqrt(s));m(t,e,r,l,this.compareMinX);for(var c=e;c<=r;c+=l){var h=Math.min(c+l-1,r);m(t,c,h,u,this.compareMinY);for(var f=c;f<=h;f+=u){var d=Math.min(f+u-1,h);i.children.push(this._build(t,f,d,n-1))}}return a(i,this.toBBox),i},n.prototype._chooseSubtree=function(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){for(var i=1/0,a=1/0,o=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=c(u),h=(f=t,d=u,(Math.max(d.maxX,f.maxX)-Math.min(d.minX,f.minX))*(Math.max(d.maxY,f.maxY)-Math.min(d.minY,f.minY))-l);h<a?(a=h,i=l<i?l:i,o=u):h===a&&l<i&&(i=l,o=u)}e=o||e.children[0]}var f,d;return e},n.prototype._insert=function(t,e,r){var n=r?t:this.toBBox(t),i=[],a=this._chooseSubtree(n,this.data,e,i);for(a.children.push(t),s(a,n);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(n,i,e)},n.prototype._split=function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var o=this._chooseSplitIndex(r,i,n),s=p(r.children.splice(o,r.children.length-o));s.height=r.height,s.leaf=r.leaf,a(r,this.toBBox),a(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,r){for(var n,i,a,s,u,l,h,f=1/0,d=1/0,p=e;p<=r-e;p++){var m=o(t,0,p,this.toBBox),v=o(t,p,r,this.toBBox),g=(i=m,a=v,s=Math.max(i.minX,a.minX),u=Math.max(i.minY,a.minY),l=Math.min(i.maxX,a.maxX),h=Math.min(i.maxY,a.maxY),Math.max(0,l-s)*Math.max(0,h-u)),y=c(m)+c(v);g<f?(f=g,n=p,d=y<d?y:d):g===f&&y<d&&(d=y,n=p)}return n||r-e},n.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var i=this.toBBox,a=o(t,0,e,i),u=o(t,r-e,r,i),l=h(a)+h(u),c=e;c<r-e;c++){var f=t.children[c];s(a,t.leaf?i(f):f),l+=h(a)}for(var d=r-e-1;d>=e;d--){var p=t.children[d];s(u,t.leaf?i(p):p),l+=h(u)}return l},n.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;n>=0;n--)s(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,r=void 0;e>=0;e--)0===t[e].children.length?e>0?(r=t[e-1].children).splice(r.indexOf(t[e]),1):this.clear():a(t[e],this.toBBox)},n}()}));class TinyQueue{constructor(t=[],e=defaultCompare){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:r}=this,n=e[t];for(;t>0;){const i=t-1>>1,a=e[i];if(r(n,a)>=0)break;e[t]=a,t=i}e[t]=n}_down(t){const{data:e,compare:r}=this,n=this.length>>1,i=e[t];for(;t<n;){let n=1+(t<<1),a=e[n];const o=n+1;if(o<this.length&&r(e[o],a)<0&&(n=o,a=e[o]),r(a,i)>=0)break;e[t]=a,t=n}e[t]=i}}function defaultCompare(t,e){return t<e?-1:t>e?1:0}var flat$1=function(t,e,r,n){var i=t[0],a=t[1],o=!1;void 0===r&&(r=0),void 0===n&&(n=e.length);for(var s=(n-r)/2,u=0,l=s-1;u<s;l=u++){var c=e[r+2*u+0],h=e[r+2*u+1],f=e[r+2*l+1];h>a!=f>a&&i<(e[r+2*l+0]-c)*(a-h)/(f-h)+c&&(o=!o)}return o},nested$1=function(t,e,r,n){var i=t[0],a=t[1],o=!1;void 0===r&&(r=0),void 0===n&&(n=e.length);for(var s=n-r,u=0,l=s-1;u<s;l=u++){var c=e[u+r][0],h=e[u+r][1],f=e[l+r][1];h>a!=f>a&&i<(e[l+r][0]-c)*(a-h)/(f-h)+c&&(o=!o)}return o},pointInPolygon=function(t,e,r,n){return e.length>0&&Array.isArray(e[0])?nested$1(t,e,r,n):flat$1(t,e,r,n)},nested=nested$1,flat=flat$1;pointInPolygon.nested=nested,pointInPolygon.flat=flat;var orient2d_min=createCommonjsModule((function(t,e){!function(t){const e=134217729;function r(t,e,r,n,i){let a,o,s,u,l=e[0],c=n[0],h=0,f=0;c>l==c>-l?(a=l,l=e[++h]):(a=c,c=n[++f]);let d=0;if(h<t&&f<r)for(c>l==c>-l?(s=a-((o=l+a)-l),l=e[++h]):(s=a-((o=c+a)-c),c=n[++f]),a=o,0!==s&&(i[d++]=s);h<t&&f<r;)c>l==c>-l?(s=a-((o=a+l)-(u=o-a))+(l-u),l=e[++h]):(s=a-((o=a+c)-(u=o-a))+(c-u),c=n[++f]),a=o,0!==s&&(i[d++]=s);for(;h<t;)s=a-((o=a+l)-(u=o-a))+(l-u),l=e[++h],a=o,0!==s&&(i[d++]=s);for(;f<r;)s=a-((o=a+c)-(u=o-a))+(c-u),c=n[++f],a=o,0!==s&&(i[d++]=s);return 0===a&&0!==d||(i[d++]=a),d}function n(t){return new Float64Array(t)}const i=n(4),a=n(8),o=n(12),s=n(16),u=n(4);t.orient2d=function(t,n,l,c,h,f){const d=(n-f)*(l-h),p=(t-h)*(c-f),m=d-p;if(0===d||0===p||d>0!=p>0)return m;const v=Math.abs(d+p);return Math.abs(m)>=33306690738754716e-32*v?m:-function(t,n,l,c,h,f,d){let p,m,v,g,y,_,b,x,w,M,A,E,S,T,C,O,P,L;const I=t-h,k=l-h,R=n-f,D=c-f;y=(C=(x=I-(b=(_=e*I)-(_-I)))*(M=D-(w=(_=e*D)-(_-D)))-((T=I*D)-b*w-x*w-b*M))-(A=C-(P=(x=R-(b=(_=e*R)-(_-R)))*(M=k-(w=(_=e*k)-(_-k)))-((O=R*k)-b*w-x*w-b*M))),i[0]=C-(A+y)+(y-P),y=(S=T-((E=T+A)-(y=E-T))+(A-y))-(A=S-O),i[1]=S-(A+y)+(y-O),y=(L=E+A)-E,i[2]=E-(L-y)+(A-y),i[3]=L;let B=function(t,e){let r=e[0];for(let t=1;t<4;t++)r+=e[t];return r}(0,i),F=22204460492503146e-32*d;if(B>=F||-B>=F)return B;if(p=t-(I+(y=t-I))+(y-h),v=l-(k+(y=l-k))+(y-h),m=n-(R+(y=n-R))+(y-f),g=c-(D+(y=c-D))+(y-f),0===p&&0===m&&0===v&&0===g)return B;if(F=11093356479670487e-47*d+33306690738754706e-32*Math.abs(B),(B+=I*g+D*p-(R*v+k*m))>=F||-B>=F)return B;y=(C=(x=p-(b=(_=e*p)-(_-p)))*(M=D-(w=(_=e*D)-(_-D)))-((T=p*D)-b*w-x*w-b*M))-(A=C-(P=(x=m-(b=(_=e*m)-(_-m)))*(M=k-(w=(_=e*k)-(_-k)))-((O=m*k)-b*w-x*w-b*M))),u[0]=C-(A+y)+(y-P),y=(S=T-((E=T+A)-(y=E-T))+(A-y))-(A=S-O),u[1]=S-(A+y)+(y-O),y=(L=E+A)-E,u[2]=E-(L-y)+(A-y),u[3]=L;const j=r(4,i,4,u,a);y=(C=(x=I-(b=(_=e*I)-(_-I)))*(M=g-(w=(_=e*g)-(_-g)))-((T=I*g)-b*w-x*w-b*M))-(A=C-(P=(x=R-(b=(_=e*R)-(_-R)))*(M=v-(w=(_=e*v)-(_-v)))-((O=R*v)-b*w-x*w-b*M))),u[0]=C-(A+y)+(y-P),y=(S=T-((E=T+A)-(y=E-T))+(A-y))-(A=S-O),u[1]=S-(A+y)+(y-O),y=(L=E+A)-E,u[2]=E-(L-y)+(A-y),u[3]=L;const N=r(j,a,4,u,o);y=(C=(x=p-(b=(_=e*p)-(_-p)))*(M=g-(w=(_=e*g)-(_-g)))-((T=p*g)-b*w-x*w-b*M))-(A=C-(P=(x=m-(b=(_=e*m)-(_-m)))*(M=v-(w=(_=e*v)-(_-v)))-((O=m*v)-b*w-x*w-b*M))),u[0]=C-(A+y)+(y-P),y=(S=T-((E=T+A)-(y=E-T))+(A-y))-(A=S-O),u[1]=S-(A+y)+(y-O),y=(L=E+A)-E,u[2]=E-(L-y)+(A-y),u[3]=L;const U=r(N,o,4,u,s);return s[U-1]}(t,n,l,c,h,f,v)},t.orient2dfast=function(t,e,r,n,i,a){return(e-a)*(r-i)-(t-i)*(n-a)},Object.defineProperty(t,"__esModule",{value:!0})}(e)}));unwrapExports(orient2d_min);var Queue=TinyQueue,orient=orient2d_min.orient2d;Queue.default&&(Queue=Queue.default);var concaveman_1=concaveman,default_1=concaveman;function concaveman(t,e,r){e=Math.max(0,void 0===e?2:e),r=r||0;var n=fastConvexHull(t),i=new rbush_min(16);i.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},i.compareMinX=function(t,e){return t[0]-e[0]},i.compareMinY=function(t,e){return t[1]-e[1]},i.load(t);for(var a,o=[],s=0;s<n.length;s++){var u=n[s];i.remove(u),a=insertNode(u,a),o.push(a)}var l=new rbush_min(16);for(s=0;s<o.length;s++)l.insert(updateBBox(o[s]));for(var c=e*e,h=r*r;o.length;){var f=o.shift(),d=f.p,p=f.next.p,m=getSqDist(d,p);if(!(m<h)){var v=m/c;(u=findCandidate(i,f.prev.p,d,p,f.next.next.p,v,l))&&Math.min(getSqDist(u,d),getSqDist(u,p))<=v&&(o.push(f),o.push(insertNode(u,f)),i.remove(u),l.remove(f),l.insert(updateBBox(f)),l.insert(updateBBox(f.next)))}}f=a;var g=[];do{g.push(f.p),f=f.next}while(f!==a);return g.push(f.p),g}function findCandidate(t,e,r,n,i,a,o){for(var s=new Queue([],compareDist),u=t.data;u;){for(var l=0;l<u.children.length;l++){var c=u.children[l],h=u.leaf?sqSegDist(c,r,n):sqSegBoxDist(r,n,c);h>a||s.push({node:c,dist:h})}for(;s.length&&!s.peek().node.children;){var f=s.pop(),d=f.node,p=sqSegDist(d,e,r),m=sqSegDist(d,n,i);if(f.dist<p&&f.dist<m&&noIntersections(r,d,o)&&noIntersections(n,d,o))return d}(u=s.pop())&&(u=u.node)}return null}function compareDist(t,e){return t.dist-e.dist}function sqSegBoxDist(t,e,r){if(inside(t,r)||inside(e,r))return 0;var n=sqSegSegDist(t[0],t[1],e[0],e[1],r.minX,r.minY,r.maxX,r.minY);if(0===n)return 0;var i=sqSegSegDist(t[0],t[1],e[0],e[1],r.minX,r.minY,r.minX,r.maxY);if(0===i)return 0;var a=sqSegSegDist(t[0],t[1],e[0],e[1],r.maxX,r.minY,r.maxX,r.maxY);if(0===a)return 0;var o=sqSegSegDist(t[0],t[1],e[0],e[1],r.minX,r.maxY,r.maxX,r.maxY);return 0===o?0:Math.min(n,i,a,o)}function inside(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function noIntersections(t,e,r){for(var n=Math.min(t[0],e[0]),i=Math.min(t[1],e[1]),a=Math.max(t[0],e[0]),o=Math.max(t[1],e[1]),s=r.search({minX:n,minY:i,maxX:a,maxY:o}),u=0;u<s.length;u++)if(intersects(s[u].p,s[u].next.p,t,e))return!1;return!0}function cross(t,e,r){return orient(t[0],t[1],e[0],e[1],r[0],r[1])}function intersects(t,e,r,n){return t!==n&&e!==r&&cross(t,e,r)>0!=cross(t,e,n)>0&&cross(r,n,t)>0!=cross(r,n,e)>0}function updateBBox(t){var e=t.p,r=t.next.p;return t.minX=Math.min(e[0],r[0]),t.minY=Math.min(e[1],r[1]),t.maxX=Math.max(e[0],r[0]),t.maxY=Math.max(e[1],r[1]),t}function fastConvexHull(t){for(var e=t[0],r=t[0],n=t[0],i=t[0],a=0;a<t.length;a++){var o=t[a];o[0]<e[0]&&(e=o),o[0]>n[0]&&(n=o),o[1]<r[1]&&(r=o),o[1]>i[1]&&(i=o)}var s=[e,r,n,i],u=s.slice();for(a=0;a<t.length;a++)pointInPolygon(t[a],s)||u.push(t[a]);return convexHull(u)}function insertNode(t,e){var r={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(r.next=e.next,r.prev=e,e.next.prev=r,e.next=r):(r.prev=r,r.next=r),r}function getSqDist(t,e){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function sqSegDist(t,e,r){var n=e[0],i=e[1],a=r[0]-n,o=r[1]-i;if(0!==a||0!==o){var s=((t[0]-n)*a+(t[1]-i)*o)/(a*a+o*o);s>1?(n=r[0],i=r[1]):s>0&&(n+=a*s,i+=o*s)}return(a=t[0]-n)*a+(o=t[1]-i)*o}function sqSegSegDist(t,e,r,n,i,a,o,s){var u,l,c,h,f=r-t,d=n-e,p=o-i,m=s-a,v=t-i,g=e-a,y=f*f+d*d,_=f*p+d*m,b=p*p+m*m,x=f*v+d*g,w=p*v+m*g,M=y*b-_*_,A=M,E=M;0===M?(l=0,A=1,h=w,E=b):(h=y*w-_*x,(l=_*w-b*x)<0?(l=0,h=w,E=b):l>A&&(l=A,h=w+_,E=b)),h<0?(h=0,-x<0?l=0:-x>y?l=A:(l=-x,A=y)):h>E&&(h=E,-x+_<0?l=0:-x+_>y?l=A:(l=-x+_,A=y));var S=(1-(c=0===h?0:h/E))*i+c*o-((1-(u=0===l?0:l/A))*t+u*r),T=(1-c)*a+c*s-((1-u)*e+u*n);return S*S+T*T}function compareByX(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function convexHull(t){t.sort(compareByX);for(var e=[],r=0;r<t.length;r++){for(;e.length>=2&&cross(e[e.length-2],e[e.length-1],t[r])<=0;)e.pop();e.push(t[r])}for(var n=[],i=t.length-1;i>=0;i--){for(;n.length>=2&&cross(n[n.length-2],n[n.length-1],t[i])<=0;)n.pop();n.push(t[i])}return n.pop(),e.pop(),e.concat(n)}var concaveman$1=concaveman_1;function convex(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var r=[];if(coordEach(t,(function(t){r.push([t[0],t[1]])})),!r.length)return null;var n=concaveman$1(r,e.concavity);return n.length>3?polygon([n]):null}function centroid(t,e){void 0===e&&(e={});var r=0,n=0,i=0;return coordEach(t,(function(t){r+=t[0],n+=t[1],i++}),!0),point([r/i,n/i],e.properties)}function centerOfMass$1(t,e){switch(void 0===e&&(e={}),getType(t)){case"Point":return point(getCoord(t),e.properties);case"Polygon":var r=[];coordEach(t,(function(t){r.push(t)}));var n,i,a,o,s,u,l,c,h=centroid(t,{properties:e.properties}),f=h.geometry.coordinates,d=0,p=0,m=0,v=r.map((function(t){return[t[0]-f[0],t[1]-f[1]]}));for(n=0;n<r.length-1;n++)m+=c=(o=(i=v[n])[0])*(l=(a=v[n+1])[1])-(s=a[0])*(u=i[1]),d+=(o+s)*c,p+=(u+l)*c;if(0===m)return h;var g=1/(.5*m*6);return point([f[0]+g*d,f[1]+g*p],e.properties);default:var y=convex(t);return y?centerOfMass$1(y,{properties:e.properties}):centroid(t,{properties:e.properties})}}function distance(t){let e=0;return e=Projection.projection?function(t){let e=0;if(t.length>0){let r=t;for(let t=1;t<r.length;t++){let n=r[t-1],i=r[t];e+=Math.sqrt(Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2))}return e}}(t):function(t){let e=0;return t.length>0&&(e=length(lineString(t),{units:"meters"})),e}(t),e}function area(t){let e=0;return e=Projection.projection?function(t){let e=0,r=t[0];for(let t=1;t<r.length;t++){let n=r[t-1],i=r[t];e+=n[0]*i[1]-i[0]*n[1]}return e/=2,Math.abs(e)}(t):function(t){let e=0;return t.length>0&&(e=area$1(polygon(t))),e}(t),e}function centerOfMass(t){if(t.length>0)return centerOfMass$1(polygon(t))}concaveman_1.default=default_1;var Utils=Object.freeze({__proto__:null,distance:distance,area:area,centerOfMass:centerOfMass});class Map$1 extends sipsdmapgl.Map{constructor(t){t.sipsdCopyright&&"hidden"===t.sipsdCopyright||console.log(`Mapmost for WebGL v${version} Copyright (c) 2021-2022, 苏州工业园区测绘地理信息有限公司`),t.projection&&"SZ2000"===t.projection&&(t.center=projSZ2000(t.center)),super(t),this.projection=Projection.projection=t.projection}addLayer(t,e){if("sky"!==t.type){if("skysky"===t.type&&(t.type="sky"),this.projection){if(t.type&&("model"===t.type||"buildings"===t.type||"heatmap-3d"===t.type))return void console.warn("当前坐标系统下暂不支持此功能！");let r=getLayerOptions(t);return super.addLayer(r,e),this}{let r;switch(t.type){case"model":r=addModelLayer(t);break;case"buildings":r=addBuildingsLayer(t);break;case"heatmap-3d":r=addHeatmapLayer(t);break;default:r=t}return super.addLayer(r,e),this}}}add3dTreesLayer(t){this.projection?console.warn("当前坐标系统下暂不支持此功能！"):(this.trees3dLayer=new Trees3DLayer({map:this,...t}),this.trees3dLayer.loadLayer())}remove3dTreesLayer(t){this.trees3dLayer&&(this.trees3dLayer.turnoffListener(),this.trees3dLayer.removeLayer(t),delete this.trees3dLayer)}addMigrationLayer(t){return new MigrationLayer(this,t)}loadModel(t){LoadObj(t)}addOnlineVideo(t){if(this.projection)return void console.warn("当前坐标系统下暂不支持此功能！");const{id:e,coordinates:r,url:n}=t;if(n&&""!==n)if(e&&!super.getLayer(e))if(4===r.length||5===r.length&&(i=r[0],a=r[4],Math.abs(i[0]-a[0])<1e-5&&Math.abs(i[1]-a[1])<1e-5)){let r=new VideoOnline(t);window.mapmost_videos||(window.mapmost_videos={}),window.mapmost_videos[e]=r;const n=r.getLayerOptions();super.addLayer(n)}else console.log("坐标不符合规则");else console.log("id 为空或已存在");else console.log("视频地址为空");var i,a}removeOnlineVideo(t){this.getLayer(t)&&(window.mapmost_videos[t].removeVideo(),super.removeLayer(t),delete window.mapmost_videos[t],function(t){for(var e in t)return!0;return!1}(window.mapmost_videos)||delete window.mapmost_videos)}removeLayer(t){super.removeLayer(t),window.mapmost_materialCache&&window.mapmost_materialCache[t]&&delete window.mapmost_materialCache[t]}proj(t,e,r){return transformProj4(t,e,r)}flyTo(t,e){let r=(t=convertOption(t,this.projection)).center;if(3===r.length){let e=getFlyCenter(r,t.pitch||this.getPitch(),t.bearing||this.getBearing());t.center=e}super.flyTo(t,e)}panTo(t,e,r){let n=convertCoor(t,this.projection);super.panTo(n,e,r)}easeTo(t,e){t=convertOption(t,this.projection),super.easeTo(t,e)}jumpTo(t,e){t=convertOption(t,this.projection),super.jumpTo(t,e)}getCenter(){let t=super.getCenter();return this.projection&&"SZ2000"===this.projection&&(t=unprojSZ2000([t.lng,t.lat])),t}setCenter(t,e){let r=convertCoor(t,this.projection);super.setCenter(r,e)}getBounds(){let t=super.getBounds();if(this.projection&&"SZ2000"===this.projection){let e=[];e.push(unprojSZ2000([t._ne.lng,t._ne.lat])),e.push(unprojSZ2000([t._sw.lng,t._sw.lat])),t=e}return t}setMaxBounds(t){let e=t;if(this.projection){let r=[];r.push(convertCoor(t[0],this.projection)),r.push(convertCoor(t[1],this.projection)),e=r}super.setMaxBounds(e)}getMaxBounds(){let t=super.getMaxBounds();if(t&&this.projection&&"SZ2000"===this.projection){let e=[];e.push(unprojSZ2000([t._ne.lng,t._ne.lat])),e.push(unprojSZ2000([t._sw.lng,t._sw.lat])),t=e}return t}add3dTilesLayer(t){this.getLayer("mapmost_3dtiles_sky")||this.addLayer({id:"mapmost_3dtiles_sky",type:"skysky",paint:{"sky-type":"gradient","sky-gradient":["interpolate",["linear"],["sky-radial-progress"],0,"rgb(255,255,255)",1,"rgb(255,255,255)"]}}),this.projection?console.warn("当前坐标系统下暂不支持此功能！"):super.addLayer(new deck.MapboxLayer({...t,type:deck.Tile3DLayer,id:t.id,pointSize:t.pointSize||2,loadOptions:function(t){let e={};return t&&(t.draco&&t.draco.libsUrl&&(t.draco={libsUrl:t.draco.libsUrl,workerUrl:t.draco.libsUrl+"/draco-worker.js"}),e=t),e}(t.loadOptions)}))}pick3dTilesCoordinate(t,e){if(this.getLayer(e)){let r=this.getLayer(e).implementation.deck.pickObject({x:t.x,y:t.y,radius:0,unproject3D:!0});if(r)return r.coordinate}}setCameraParameter(t){let e=convertCoor(t.position,this.projection);t.position=sipsdmapgl.MercatorCoordinate.fromLngLat([e[0],e[1]],e[2]),t.pitch&&(t.pitch>85&&(t.pitch=85),t.pitch<0&&(t.pitch=0)),super.setCameraParameter(t)}getCameraParameter(){let t=super.getCameraParameter(),e=t.position,r=[e.toLngLat().lng,e.toLngLat().lat,e.toAltitude()];return t.position=this.projection&&"SZ2000"===this.projection?unprojSZ2000(r):r,t.position[2]=parseFloat(t.position[2].toFixed(4)),t}superFun(t,e,r){if("get"===t)return super[e](r);super[e](r)}cameraFlyTo(t){cameraFlyTo(this,t,this.projection)}}var index={...sipsdmapgl,Map:Map$1,THREE:THREE$1,LoadObj:LoadObj,Matrix4:Matrix4,Utils:Utils};return index}));
